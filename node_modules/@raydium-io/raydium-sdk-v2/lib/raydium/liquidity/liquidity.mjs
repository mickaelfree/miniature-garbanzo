var io=Object.defineProperty,oo=Object.defineProperties;var so=Object.getOwnPropertyDescriptors;var nn=Object.getOwnPropertySymbols;var Er=Object.prototype.hasOwnProperty,_r=Object.prototype.propertyIsEnumerable;var Cr=(r,e,t)=>e in r?io(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Y=(r,e)=>{for(var t in e||(e={}))Er.call(e,t)&&Cr(r,t,e[t]);if(nn)for(var t of nn(e))_r.call(e,t)&&Cr(r,t,e[t]);return r},ee=(r,e)=>oo(r,so(e));var Fe=(r,e)=>{var t={};for(var n in r)Er.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&nn)for(var n of nn(r))e.indexOf(n)<0&&_r.call(r,n)&&(t[n]=r[n]);return t};import{PublicKey as pt}from"@solana/web3.js";import{NATIVE_MINT as ro,TOKEN_PROGRAM_ID as Vn}from"@solana/spl-token";import As from"big.js";import wn from"bn.js";import Le from"bn.js";var xt=9e15,it=1e9,Dn="0123456789abcdef",on="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",sn="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",qn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-xt,maxE:xt,crypto:!1},Vr,Ze,W=!0,un="[DecimalError] ",rt=un+"Invalid argument: ",Or=un+"Precision limit exceeded",Wr=un+"crypto unavailable",Dr="[object Decimal]",ke=Math.floor,fe=Math.pow,ao=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,uo=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,co=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,qr=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ve=1e7,V=7,lo=9007199254740991,mo=on.length-1,Gn=sn.length-1,T={toStringTag:Dr};T.absoluteValue=T.abs=function(){var r=new this.constructor(this);return r.s<0&&(r.s=1),E(r)};T.ceil=function(){return E(new this.constructor(this),this.e+1,2)};T.clampedTo=T.clamp=function(r,e){var t,n=this,i=n.constructor;if(r=new i(r),e=new i(e),!r.s||!e.s)return new i(NaN);if(r.gt(e))throw Error(rt+e);return t=n.cmp(r),t<0?r:n.cmp(e)>0?e:new i(n)};T.comparedTo=T.cmp=function(r){var e,t,n,i,o=this,s=o.d,a=(r=new o.constructor(r)).d,u=o.s,c=r.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==r.e)return o.e>r.e^u<0?1:-1;for(n=s.length,i=a.length,e=0,t=n<i?n:i;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===i?0:n>i^u<0?1:-1};T.cosine=T.cos=function(){var r,e,t=this,n=t.constructor;return t.d?t.d[0]?(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+V,n.rounding=1,t=po(n,Yr(n,t)),n.precision=r,n.rounding=e,E(Ze==2||Ze==3?t.neg():t,r,e,!0)):new n(1):new n(NaN)};T.cubeRoot=T.cbrt=function(){var r,e,t,n,i,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(W=!1,o=l.s*fe(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=ge(l.d),r=l.e,(o=(r-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=fe(t,1/3),r=ke((r+1)/3)-(r%3==(r<0?-1:2)),o==1/0?t="5e"+r:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+r),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(r=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=ie(c.plus(l).times(a),c.plus(u),s+2,1),ge(a.d).slice(0,s)===(t=ge(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!i&&t=="4999"){if(!i&&(E(a,r+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(E(n,r+1,1),e=!n.times(n).times(n).eq(l));break}return W=!0,E(n,r,m.rounding,e)};T.decimalPlaces=T.dp=function(){var r,e=this.d,t=NaN;if(e){if(r=e.length-1,t=(r-ke(this.e/V))*V,r=e[r],r)for(;r%10==0;r/=10)t--;t<0&&(t=0)}return t};T.dividedBy=T.div=function(r){return ie(this,new this.constructor(r))};T.dividedToIntegerBy=T.divToInt=function(r){var e=this,t=e.constructor;return E(ie(e,new t(r),0,1,1),t.precision,t.rounding)};T.equals=T.eq=function(r){return this.cmp(r)===0};T.floor=function(){return E(new this.constructor(this),this.e+1,3)};T.greaterThan=T.gt=function(r){return this.cmp(r)>0};T.greaterThanOrEqualTo=T.gte=function(r){var e=this.cmp(r);return e==1||e===0};T.hyperbolicCosine=T.cosh=function(){var r,e,t,n,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(r=Math.ceil(i/3),e=(1/ln(4,r)).toString()):(r=16,e="2.3283064365386962890625e-10"),o=It(s,1,o.times(e),new s(1),!0);for(var u,c=r,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return E(o,s.precision=t,s.rounding=n,!0)};T.hyperbolicSine=T.sinh=function(){var r,e,t,n,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(i.e,i.sd())+4,o.rounding=1,n=i.d.length,n<3)i=It(o,2,i,i,!0);else{r=1.4*Math.sqrt(n),r=r>16?16:r|0,i=i.times(1/ln(5,r)),i=It(o,2,i,i,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);r--;)s=i.times(i),i=i.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,E(i,e,t,!0)};T.hyperbolicTangent=T.tanh=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+7,n.rounding=1,ie(t.sinh(),t.cosh(),n.precision=r,n.rounding=e)):new n(t.s)};T.inverseCosine=T.acos=function(){var r,e=this,t=e.constructor,n=e.abs().cmp(1),i=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?ve(t,i,o):new t(0):new t(NaN):e.isZero()?ve(t,i+4,o).times(.5):(t.precision=i+6,t.rounding=1,e=e.asin(),r=ve(t,i+4,o).times(.5),t.precision=i,t.rounding=o,r.minus(e))};T.inverseHyperbolicCosine=T.acosh=function(){var r,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(r=n.precision,e=n.rounding,n.precision=r+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,W=!1,t=t.times(t).minus(1).sqrt().plus(t),W=!0,n.precision=r,n.rounding=e,t.ln()):new n(t)};T.inverseHyperbolicSine=T.asinh=function(){var r,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,W=!1,t=t.times(t).plus(1).sqrt().plus(t),W=!0,n.precision=r,n.rounding=e,t.ln())};T.inverseHyperbolicTangent=T.atanh=function(){var r,e,t,n,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(r=o.precision,e=o.rounding,n=i.sd(),Math.max(n,r)<2*-i.e-1?E(new o(i),r,e,!0):(o.precision=t=n-i.e,i=ie(i.plus(1),new o(1).minus(i),t+r,1),o.precision=r+4,o.rounding=1,i=i.ln(),o.precision=r,o.rounding=e,i.times(.5))):new o(NaN)};T.inverseSine=T.asin=function(){var r,e,t,n,i=this,o=i.constructor;return i.isZero()?new o(i):(e=i.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(r=ve(o,t+4,n).times(.5),r.s=i.s,r):new o(NaN):(o.precision=t+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,i.times(2)))};T.inverseTangent=T.atan=function(){var r,e,t,n,i,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=Gn)return s=ve(l,m+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=Gn)return s=ve(l,m+4,d).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/V+2|0),r=t;r;--r)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(W=!1,e=Math.ceil(a/V),n=1,u=c.times(c),s=new l(c),i=c;r!==-1;)if(i=i.times(u),o=s.minus(i.div(n+=2)),i=i.times(u),s=o.plus(i.div(n+=2)),s.d[e]!==void 0)for(r=e;s.d[r]===o.d[r]&&r--;);return t&&(s=s.times(2<<t-1)),W=!0,E(s,l.precision=m,l.rounding=d,!0)};T.isFinite=function(){return!!this.d};T.isInteger=T.isInt=function(){return!!this.d&&ke(this.e/V)>this.d.length-2};T.isNaN=function(){return!this.s};T.isNegative=T.isNeg=function(){return this.s<0};T.isPositive=T.isPos=function(){return this.s>0};T.isZero=function(){return!!this.d&&this.d[0]===0};T.lessThan=T.lt=function(r){return this.cmp(r)<0};T.lessThanOrEqualTo=T.lte=function(r){return this.cmp(r)<1};T.logarithm=T.log=function(r){var e,t,n,i,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding,p=5;if(r==null)r=new l(10),e=!0;else{if(r=new l(r),t=r.d,r.s<0||!t||!t[0]||r.eq(1))return new l(NaN);e=r.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(i=t[0];i%10===0;)i/=10;o=i!==1}if(W=!1,a=m+p,s=nt(c,a),n=e?an(l,a+10):nt(r,a),u=ie(s,n,a,1),Ft(u.d,i=m,d))do if(a+=10,s=nt(c,a),n=e?an(l,a+10):nt(r,a),u=ie(s,n,a,1),!o){+ge(u.d).slice(i+1,i+15)+1==1e14&&(u=E(u,m+1,0));break}while(Ft(u.d,i+=10,d));return W=!0,E(u,m,d)};T.minus=T.sub=function(r){var e,t,n,i,o,s,a,u,c,l,m,d,p=this,y=p.constructor;if(r=new y(r),!p.d||!r.d)return!p.s||!r.s?r=new y(NaN):p.d?r.s=-r.s:r=new y(r.d||p.s!==r.s?p:NaN),r;if(p.s!=r.s)return r.s=-r.s,p.plus(r);if(c=p.d,d=r.d,a=y.precision,u=y.rounding,!c[0]||!d[0]){if(d[0])r.s=-r.s;else if(c[0])r=new y(p);else return new y(u===3?-0:0);return W?E(r,a,u):r}if(t=ke(r.e/V),l=ke(p.e/V),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=d.length):(e=d,t=l,s=c.length),n=Math.max(Math.ceil(a/V),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){m=c[n]<d[n];break}o=0}for(m&&(e=c,c=d,d=e,r.s=-r.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(i=n;i&&c[--i]===0;)c[i]=Ve-1;--c[i],c[n]+=Ve}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(r.d=c,r.e=cn(c,t),W?E(r,a,u):r):new y(u===3?-0:0)};T.modulo=T.mod=function(r){var e,t=this,n=t.constructor;return r=new n(r),!t.d||!r.s||r.d&&!r.d[0]?new n(NaN):!r.d||t.d&&!t.d[0]?E(new n(t),n.precision,n.rounding):(W=!1,n.modulo==9?(e=ie(t,r.abs(),0,3,1),e.s*=r.s):e=ie(t,r,0,n.modulo,1),e=e.times(r),W=!0,t.minus(e))};T.naturalExponential=T.exp=function(){return Un(this)};T.naturalLogarithm=T.ln=function(){return nt(this)};T.negated=T.neg=function(){var r=new this.constructor(this);return r.s=-r.s,E(r)};T.plus=T.add=function(r){var e,t,n,i,o,s,a,u,c,l,m=this,d=m.constructor;if(r=new d(r),!m.d||!r.d)return!m.s||!r.s?r=new d(NaN):m.d||(r=new d(r.d||m.s===r.s?m:NaN)),r;if(m.s!=r.s)return r.s=-r.s,m.minus(r);if(c=m.d,l=r.d,a=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(r=new d(m)),W?E(r,a,u):r;if(o=ke(m.e/V),n=ke(r.e/V),c=c.slice(),i=o-n,i){for(i<0?(t=c,i=-i,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/V),s=o>s?o+1:s+1,i>s&&(i=s,t.length=1),t.reverse();i--;)t.push(0);t.reverse()}for(s=c.length,i=l.length,s-i<0&&(i=s,t=l,l=c,c=t),e=0;i;)e=(c[--i]=c[i]+l[i]+e)/Ve|0,c[i]%=Ve;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return r.d=c,r.e=cn(c,n),W?E(r,a,u):r};T.precision=T.sd=function(r){var e,t=this;if(r!==void 0&&r!==!!r&&r!==1&&r!==0)throw Error(rt+r);return t.d?(e=Gr(t.d),r&&t.e+1>e&&(e=t.e+1)):e=NaN,e};T.round=function(){var r=this,e=r.constructor;return E(new e(r),r.e+1,e.rounding)};T.sine=T.sin=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+V,n.rounding=1,t=bo(n,Yr(n,t)),n.precision=r,n.rounding=e,E(Ze>2?t.neg():t,r,e,!0)):new n(NaN)};T.squareRoot=T.sqrt=function(){var r,e,t,n,i,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(W=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=ge(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=ke((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(ie(s,o,t+2,1)).times(.5),ge(o.d).slice(0,t)===(e=ge(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!i&&e=="4999"){if(!i&&(E(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,i=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(E(n,u+1,1),r=!n.times(n).eq(s));break}return W=!0,E(n,u,l.rounding,r)};T.tangent=T.tan=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+10,n.rounding=1,t=t.sin(),t.s=1,t=ie(t,new n(1).minus(t.times(t)).sqrt(),r+10,0),n.precision=r,n.rounding=e,E(Ze==2||Ze==4?t.neg():t,r,e,!0)):new n(NaN)};T.times=T.mul=function(r){var e,t,n,i,o,s,a,u,c,l=this,m=l.constructor,d=l.d,p=(r=new m(r)).d;if(r.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!r.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?r.s/0:r.s*0);for(t=ke(l.e/V)+ke(r.e/V),u=d.length,c=p.length,u<c&&(o=d,d=p,p=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,i=u+n;i>n;)a=o[i]+p[n]*d[i-n-1]+e,o[i--]=a%Ve|0,e=a/Ve|0;o[i]=(o[i]+e)%Ve|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),r.d=o,r.e=cn(o,t),W?E(r,m.precision,m.rounding):r};T.toBinary=function(r,e){return zn(this,2,r,e)};T.toDecimalPlaces=T.toDP=function(r,e){var t=this,n=t.constructor;return t=new n(t),r===void 0?t:(Ke(r,0,it),e===void 0?e=n.rounding:Ke(e,0,8),E(t,r+t.e+1,e))};T.toExponential=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=qe(n,!0):(Ke(r,0,it),e===void 0?e=i.rounding:Ke(e,0,8),n=E(new i(n),r+1,e),t=qe(n,!0,r+1)),n.isNeg()&&!n.isZero()?"-"+t:t};T.toFixed=function(r,e){var t,n,i=this,o=i.constructor;return r===void 0?t=qe(i):(Ke(r,0,it),e===void 0?e=o.rounding:Ke(e,0,8),n=E(new o(i),r+i.e+1,e),t=qe(n,!1,r+n.e+1)),i.isNeg()&&!i.isZero()?"-"+t:t};T.toFraction=function(r){var e,t,n,i,o,s,a,u,c,l,m,d,p=this,y=p.d,f=p.constructor;if(!y)return new f(p);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=Gr(y)-p.e-1,s=o%V,e.d[0]=fe(10,s<0?V+s:s),r==null)r=o>0?e:c;else{if(a=new f(r),!a.isInt()||a.lt(c))throw Error(rt+a);r=a.gt(e)?o>0?e:c:a}for(W=!1,a=new f(ge(y)),l=f.precision,f.precision=o=y.length*V*2;m=ie(a,e,0,1,1),i=t.plus(m.times(n)),i.cmp(r)!=1;)t=n,n=i,i=c,c=u.plus(m.times(i)),u=i,i=e,e=a.minus(m.times(i)),a=i;return i=ie(r.minus(t),n,0,1,1),u=u.plus(i.times(c)),t=t.plus(i.times(n)),u.s=c.s=p.s,d=ie(c,n,o,1).minus(p).abs().cmp(ie(u,t,o,1).minus(p).abs())<1?[c,n]:[u,t],f.precision=l,W=!0,d};T.toHexadecimal=T.toHex=function(r,e){return zn(this,16,r,e)};T.toNearest=function(r,e){var t=this,n=t.constructor;if(t=new n(t),r==null){if(!t.d)return t;r=new n(1),e=n.rounding}else{if(r=new n(r),e===void 0?e=n.rounding:Ke(e,0,8),!t.d)return r.s?t:r;if(!r.d)return r.s&&(r.s=t.s),r}return r.d[0]?(W=!1,t=ie(t,r,0,e,1).times(r),W=!0,E(t)):(r.s=t.s,t=r),t};T.toNumber=function(){return+this};T.toOctal=function(r,e){return zn(this,8,r,e)};T.toPower=T.pow=function(r){var e,t,n,i,o,s,a=this,u=a.constructor,c=+(r=new u(r));if(!a.d||!r.d||!a.d[0]||!r.d[0])return new u(fe(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,r.eq(1))return E(a,n,o);if(e=ke(r.e/V),e>=r.d.length-1&&(t=c<0?-c:c)<=lo)return i=Ur(u,a,t,n),r.s<0?new u(1).div(i):E(i,n,o);if(s=a.s,s<0){if(e<r.d.length-1)return new u(NaN);if((r.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=fe(+a,c),e=t==0||!isFinite(t)?ke(c*(Math.log("0."+ge(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(W=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),i=Un(r.times(nt(a,n+t)),n),i.d&&(i=E(i,n+5,1),Ft(i.d,n,o)&&(e=n+10,i=E(Un(r.times(nt(a,e+t)),e),e+5,1),+ge(i.d).slice(n+1,n+15)+1==1e14&&(i=E(i,n+1,0)))),i.s=s,W=!0,u.rounding=o,E(i,n,o))};T.toPrecision=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=qe(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(Ke(r,1,it),e===void 0?e=i.rounding:Ke(e,0,8),n=E(new i(n),r,e),t=qe(n,r<=n.e||n.e<=i.toExpNeg,r)),n.isNeg()&&!n.isZero()?"-"+t:t};T.toSignificantDigits=T.toSD=function(r,e){var t=this,n=t.constructor;return r===void 0?(r=n.precision,e=n.rounding):(Ke(r,1,it),e===void 0?e=n.rounding:Ke(e,0,8)),E(new n(t),r,e)};T.toString=function(){var r=this,e=r.constructor,t=qe(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()&&!r.isZero()?"-"+t:t};T.truncated=T.trunc=function(){return E(new this.constructor(this),this.e+1,1)};T.valueOf=T.toJSON=function(){var r=this,e=r.constructor,t=qe(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()?"-"+t:t};function ge(r){var e,t,n,i=r.length-1,o="",s=r[0];if(i>0){for(o+=s,e=1;e<i;e++)n=r[e]+"",t=V-n.length,t&&(o+=tt(t)),o+=n;s=r[e],n=s+"",t=V-n.length,t&&(o+=tt(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Ke(r,e,t){if(r!==~~r||r<e||r>t)throw Error(rt+r)}function Ft(r,e,t,n){var i,o,s,a;for(o=r[0];o>=10;o/=10)--e;return--e<0?(e+=V,i=0):(i=Math.ceil((e+1)/V),e%=V),o=fe(10,V-e),a=r[i]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(r[i+1]/o/100|0)==fe(10,e-2)-1||(a==o/2||a==0)&&(r[i+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(r[i+1]/o/1e3|0)==fe(10,e-3)-1,s}function rn(r,e,t){for(var n,i=[0],o,s=0,a=r.length;s<a;){for(o=i.length;o--;)i[o]*=e;for(i[0]+=Dn.indexOf(r.charAt(s++)),n=0;n<i.length;n++)i[n]>t-1&&(i[n+1]===void 0&&(i[n+1]=0),i[n+1]+=i[n]/t|0,i[n]%=t)}return i.reverse()}function po(r,e){var t,n,i;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),i=(1/ln(4,t)).toString()):(t=16,i="2.3283064365386962890625e-10"),r.precision+=t,e=It(r,1,e.times(i),new r(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return r.precision-=t,e}var ie=function(){function r(n,i,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*i+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,i,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=i[a]){u=n[a]>i[a]?1:-1;break}return u}function t(n,i,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<i[o]?1:0,n[o]=a*s+n[o]-i[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,o,s,a,u){var c,l,m,d,p,y,f,g,w,A,h,P,k,I,B,M,z,U,X,ae,se=n.constructor,Z=n.s==i.s?1:-1,re=n.d,j=i.d;if(!re||!re[0]||!j||!j[0])return new se(!n.s||!i.s||(re?j&&re[0]==j[0]:!j)?NaN:re&&re[0]==0||!j?Z*0:Z/0);for(u?(p=1,l=n.e-i.e):(u=Ve,p=V,l=ke(n.e/p)-ke(i.e/p)),X=j.length,z=re.length,w=new se(Z),A=w.d=[],m=0;j[m]==(re[m]||0);m++);if(j[m]>(re[m]||0)&&l--,o==null?(I=o=se.precision,s=se.rounding):a?I=o+(n.e-i.e)+1:I=o,I<0)A.push(1),y=!0;else{if(I=I/p+2|0,m=0,X==1){for(d=0,j=j[0],I++;(m<z||d)&&I--;m++)B=d*u+(re[m]||0),A[m]=B/j|0,d=B%j|0;y=d||m<z}else{for(d=u/(j[0]+1)|0,d>1&&(j=r(j,d,u),re=r(re,d,u),X=j.length,z=re.length),M=X,h=re.slice(0,X),P=h.length;P<X;)h[P++]=0;ae=j.slice(),ae.unshift(0),U=j[0],j[1]>=u/2&&++U;do d=0,c=e(j,h,X,P),c<0?(k=h[0],X!=P&&(k=k*u+(h[1]||0)),d=k/U|0,d>1?(d>=u&&(d=u-1),f=r(j,d,u),g=f.length,P=h.length,c=e(f,h,g,P),c==1&&(d--,t(f,X<g?ae:j,g,u))):(d==0&&(c=d=1),f=j.slice()),g=f.length,g<P&&f.unshift(0),t(h,f,P,u),c==-1&&(P=h.length,c=e(j,h,X,P),c<1&&(d++,t(h,X<P?ae:j,P,u))),P=h.length):c===0&&(d++,h=[0]),A[m++]=d,c&&h[0]?h[P++]=re[M]||0:(h=[re[M]],P=1);while((M++<z||h[0]!==void 0)&&I--);y=h[0]!==void 0}A[0]||A.shift()}if(p==1)w.e=l,Vr=y;else{for(m=1,d=A[0];d>=10;d/=10)m++;w.e=m+l*p-1,E(w,a?o+w.e+1:o,s,y)}return w}}();function E(r,e,t,n){var i,o,s,a,u,c,l,m,d,p=r.constructor;e:if(e!=null){if(m=r.d,!m)return r;for(i=1,a=m[0];a>=10;a/=10)i++;if(o=e-i,o<0)o+=V,s=e,l=m[d=0],u=l/fe(10,i-s-1)%10|0;else if(d=Math.ceil((o+1)/V),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=u=0,i=1,o%=V,s=o-V+1}else break e;else{for(l=a=m[d],i=1;a>=10;a/=10)i++;o%=V,s=o-V+i,u=s<0?0:l/fe(10,i-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%fe(10,i-s-1)),c=t<4?(u||n)&&(t==0||t==(r.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/fe(10,i-s):0:m[d-1])%10&1||t==(r.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=r.e+1,m[0]=fe(10,(V-e%V)%V),r.e=-e||0):m[0]=r.e=0,r;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=fe(10,V-o),m[d]=s>0?(l/fe(10,i-s)%fe(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(r.e++,m[0]==Ve&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=Ve)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return W&&(r.e>p.maxE?(r.d=null,r.e=NaN):r.e<p.minE&&(r.e=0,r.d=[0])),r}function qe(r,e,t){if(!r.isFinite())return zr(r);var n,i=r.e,o=ge(r.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+tt(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(r.e<0?"e":"e+")+r.e):i<0?(o="0."+tt(-i-1)+o,t&&(n=t-s)>0&&(o+=tt(n))):i>=s?(o+=tt(i+1-s),t&&(n=t-i-1)>0&&(o=o+"."+tt(n))):((n=i+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(i+1===s&&(o+="."),o+=tt(n))),o}function cn(r,e){var t=r[0];for(e*=V;t>=10;t/=10)e++;return e}function an(r,e,t){if(e>mo)throw W=!0,t&&(r.precision=t),Error(Or);return E(new r(on),e,1,!0)}function ve(r,e,t){if(e>Gn)throw Error(Or);return E(new r(sn),e,t,!0)}function Gr(r){var e=r.length-1,t=e*V+1;if(e=r[e],e){for(;e%10==0;e/=10)t--;for(e=r[0];e>=10;e/=10)t++}return t}function tt(r){for(var e="";r--;)e+="0";return e}function Ur(r,e,t,n){var i,o=new r(1),s=Math.ceil(n/V+4);for(W=!1;;){if(t%2&&(o=o.times(e),Fr(o.d,s)&&(i=!0)),t=ke(t/2),t===0){t=o.d.length-1,i&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Fr(e.d,s)}return W=!0,o}function Mr(r){return r.d[r.d.length-1]&1}function Xr(r,e,t){for(var n,i=new r(e[0]),o=0;++o<e.length;)if(n=new r(e[o]),n.s)i[t](n)&&(i=n);else{i=n;break}return i}function Un(r,e){var t,n,i,o,s,a,u,c=0,l=0,m=0,d=r.constructor,p=d.rounding,y=d.precision;if(!r.d||!r.d[0]||r.e>17)return new d(r.d?r.d[0]?r.s<0?0:1/0:1:r.s?r.s<0?0:r:0/0);for(e==null?(W=!1,u=y):u=e,a=new d(.03125);r.e>-2;)r=r.times(a),m+=5;for(n=Math.log(fe(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=E(o.times(r),u,1),t=t.times(++l),a=s.plus(ie(o,t,u,1)),ge(a.d).slice(0,u)===ge(s.d).slice(0,u)){for(i=m;i--;)s=E(s.times(s),u,1);if(e==null)if(c<3&&Ft(s.d,u-n,p,c))d.precision=u+=10,t=o=a=new d(1),l=0,c++;else return E(s,d.precision=y,p,W=!0);else return d.precision=y,s}s=a}}function nt(r,e){var t,n,i,o,s,a,u,c,l,m,d,p=1,y=10,f=r,g=f.d,w=f.constructor,A=w.rounding,h=w.precision;if(f.s<0||!g||!g[0]||!f.e&&g[0]==1&&g.length==1)return new w(g&&!g[0]?-1/0:f.s!=1?NaN:g?0:f);if(e==null?(W=!1,l=h):l=e,w.precision=l+=y,t=ge(g),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(r),t=ge(f.d),n=t.charAt(0),p++;o=f.e,n>1?(f=new w("0."+t),o++):f=new w(n+"."+t.slice(1))}else return c=an(w,l+2,h).times(o+""),f=nt(new w(n+"."+t.slice(1)),l-y).plus(c),w.precision=h,e==null?E(f,h,A,W=!0):f;for(m=f,u=s=f=ie(f.minus(1),f.plus(1),l,1),d=E(f.times(f),l,1),i=3;;){if(s=E(s.times(d),l,1),c=u.plus(ie(s,new w(i),l,1)),ge(c.d).slice(0,l)===ge(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(an(w,l+2,h).times(o+""))),u=ie(u,new w(p),l,1),e==null)if(Ft(u.d,l-y,A,a))w.precision=l+=y,c=s=f=ie(m.minus(1),m.plus(1),l,1),d=E(f.times(f),l,1),i=a=1;else return E(u,w.precision=h,A,W=!0);else return w.precision=h,u;u=c,i+=2}}function zr(r){return String(r.s*r.s/0)}function Xn(r,e){var t,n,i;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(i=e.length;e.charCodeAt(i-1)===48;--i);if(e=e.slice(n,i),e){if(i-=n,r.e=t=t-n-1,r.d=[],n=(t+1)%V,t<0&&(n+=V),n<i){for(n&&r.d.push(+e.slice(0,n)),i-=V;n<i;)r.d.push(+e.slice(n,n+=V));e=e.slice(n),n=V-e.length}else n-=i;for(;n--;)e+="0";r.d.push(+e),W&&(r.e>r.constructor.maxE?(r.d=null,r.e=NaN):r.e<r.constructor.minE&&(r.e=0,r.d=[0]))}else r.e=0,r.d=[0];return r}function fo(r,e){var t,n,i,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),qr.test(e))return Xn(r,e)}else if(e==="Infinity"||e==="NaN")return+e||(r.s=NaN),r.e=NaN,r.d=null,r;if(uo.test(e))t=16,e=e.toLowerCase();else if(ao.test(e))t=2;else if(co.test(e))t=8;else throw Error(rt+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=r.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,i=Ur(n,new n(t),o,o*2)),c=rn(e,t,Ve),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(r.s*0):(r.e=cn(c,l),r.d=c,W=!1,s&&(r=ie(r,i,a*4)),u&&(r=r.times(Math.abs(u)<54?fe(2,u):vt.pow(2,u))),W=!0,r)}function bo(r,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:It(r,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/ln(5,t)),e=It(r,2,e,e);for(var i,o=new r(5),s=new r(16),a=new r(20);t--;)i=e.times(e),e=e.times(o.plus(i.times(s.times(i).minus(a))));return e}function It(r,e,t,n,i){var o,s,a,u,c=1,l=r.precision,m=Math.ceil(l/V);for(W=!1,u=t.times(t),a=new r(n);;){if(s=ie(a.times(u),new r(e++*e++),l,1),a=i?n.plus(s):n.minus(s),n=ie(s.times(u),new r(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return W=!0,s.d.length=m+1,s}function ln(r,e){for(var t=r;--e;)t*=r;return t}function Yr(r,e){var t,n=e.s<0,i=ve(r,r.precision,1),o=i.times(.5);if(e=e.abs(),e.lte(o))return Ze=n?4:1,e;if(t=e.divToInt(i),t.isZero())Ze=n?3:2;else{if(e=e.minus(t.times(i)),e.lte(o))return Ze=Mr(t)?n?2:3:n?4:1,e;Ze=Mr(t)?n?1:4:n?3:2}return e.minus(i).abs()}function zn(r,e,t,n){var i,o,s,a,u,c,l,m,d,p=r.constructor,y=t!==void 0;if(y?(Ke(t,1,it),n===void 0?n=p.rounding:Ke(n,0,8)):(t=p.precision,n=p.rounding),!r.isFinite())l=zr(r);else{for(l=qe(r),s=l.indexOf("."),y?(i=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):i=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=rn(qe(d),10,i),d.e=d.d.length),m=rn(l,10,i),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=y?"0p+0":"0";else{if(s<0?o--:(r=new p(r),r.d=m,r.e=o,r=ie(r,d,t,n,0,i),m=r.d,o=r.e,c=Vr),s=m[t],a=i/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(r.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(r.s<0?8:7)),m.length=t,c)for(;++m[--t]>i-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=Dn.charAt(m[s]);if(y){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=rn(l,i,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=Dn.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return r.s<0?"-"+l:l}function Fr(r,e){if(r.length>e)return r.length=e,!0}function yo(r){return new this(r).abs()}function go(r){return new this(r).acos()}function wo(r){return new this(r).acosh()}function ho(r,e){return new this(r).plus(e)}function ko(r){return new this(r).asin()}function Ao(r){return new this(r).asinh()}function To(r){return new this(r).atan()}function Po(r){return new this(r).atanh()}function xo(r,e){r=new this(r),e=new this(e);var t,n=this.precision,i=this.rounding,o=n+4;return!r.s||!e.s?t=new this(NaN):!r.d&&!e.d?(t=ve(this,o,1).times(e.s>0?.25:.75),t.s=r.s):!e.d||r.isZero()?(t=e.s<0?ve(this,n,i):new this(0),t.s=r.s):!r.d||e.isZero()?(t=ve(this,o,1).times(.5),t.s=r.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(ie(r,e,o,1)),e=ve(this,o,1),this.precision=n,this.rounding=i,t=r.s<0?t.minus(e):t.plus(e)):t=this.atan(ie(r,e,o,1)),t}function Io(r){return new this(r).cbrt()}function Bo(r){return E(r=new this(r),r.e+1,2)}function So(r,e,t){return new this(r).clamp(e,t)}function Ko(r){if(!r||typeof r!="object")throw Error(un+"Object expected");var e,t,n,i=r.defaults===!0,o=["precision",1,it,"rounding",0,8,"toExpNeg",-xt,0,"toExpPos",0,xt,"maxE",0,xt,"minE",-xt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],i&&(this[t]=qn[t]),(n=r[t])!==void 0)if(ke(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(rt+t+": "+n);if(t="crypto",i&&(this[t]=qn[t]),(n=r[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Wr);else this[t]=!1;else throw Error(rt+t+": "+n);return this}function Lo(r){return new this(r).cos()}function No(r){return new this(r).cosh()}function jr(r){var e,t,n;function i(o){var s,a,u,c=this;if(!(c instanceof i))return new i(o);if(c.constructor=i,vr(o)){c.s=o.s,W?!o.d||o.e>i.maxE?(c.e=NaN,c.d=null):o.e<i.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;W?s>i.maxE?(c.e=NaN,c.d=null):s<i.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return Xn(c,o.toString())}else if(u!=="string")throw Error(rt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),qr.test(o)?Xn(c,o):fo(c,o)}if(i.prototype=T,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=Ko,i.clone=jr,i.isDecimal=vr,i.abs=yo,i.acos=go,i.acosh=wo,i.add=ho,i.asin=ko,i.asinh=Ao,i.atan=To,i.atanh=Po,i.atan2=xo,i.cbrt=Io,i.ceil=Bo,i.clamp=So,i.cos=Lo,i.cosh=No,i.div=Ro,i.exp=Co,i.floor=Eo,i.hypot=_o,i.ln=Mo,i.log=Fo,i.log10=Vo,i.log2=vo,i.max=Oo,i.min=Wo,i.mod=Do,i.mul=qo,i.pow=Go,i.random=Uo,i.round=Xo,i.sign=zo,i.sin=Yo,i.sinh=jo,i.sqrt=Ho,i.sub=Qo,i.sum=Zo,i.tan=$o,i.tanh=Jo,i.trunc=es,r===void 0&&(r={}),r&&r.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)r.hasOwnProperty(t=n[e++])||(r[t]=this[t]);return i.config(r),i}function Ro(r,e){return new this(r).div(e)}function Co(r){return new this(r).exp()}function Eo(r){return E(r=new this(r),r.e+1,3)}function _o(){var r,e,t=new this(0);for(W=!1,r=0;r<arguments.length;)if(e=new this(arguments[r++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return W=!0,new this(1/0);t=e}return W=!0,t.sqrt()}function vr(r){return r instanceof vt||r&&r.toStringTag===Dr||!1}function Mo(r){return new this(r).ln()}function Fo(r,e){return new this(r).log(e)}function vo(r){return new this(r).log(2)}function Vo(r){return new this(r).log(10)}function Oo(){return Xr(this,arguments,"lt")}function Wo(){return Xr(this,arguments,"gt")}function Do(r,e){return new this(r).mod(e)}function qo(r,e){return new this(r).mul(e)}function Go(r,e){return new this(r).pow(e)}function Uo(r){var e,t,n,i,o=0,s=new this(1),a=[];if(r===void 0?r=this.precision:Ke(r,1,it),n=Math.ceil(r/V),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)i=e[o],i>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)i=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(i%1e7),o+=4);o=n/4}else throw Error(Wr);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],r%=V,n&&r&&(i=fe(10,V-r),a[o]=(n/i|0)*i);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=V)a.shift();for(n=1,i=a[0];i>=10;i/=10)n++;n<V&&(t-=V-n)}return s.e=t,s.d=a,s}function Xo(r){return E(r=new this(r),r.e+1,this.rounding)}function zo(r){return r=new this(r),r.d?r.d[0]?r.s:0*r.s:r.s||NaN}function Yo(r){return new this(r).sin()}function jo(r){return new this(r).sinh()}function Ho(r){return new this(r).sqrt()}function Qo(r,e){return new this(r).sub(e)}function Zo(){var r=0,e=arguments,t=new this(e[r]);for(W=!1;t.s&&++r<e.length;)t=t.plus(e[r]);return W=!0,E(t,this.precision,this.rounding)}function $o(r){return new this(r).tan()}function Jo(r){return new this(r).tanh()}function es(r){return E(r=new this(r),r.e+1,1)}T[Symbol.for("nodejs.util.inspect.custom")]=T.toString;T[Symbol.toStringTag]="Decimal";var vt=T.constructor=jr(qn);on=new vt(on);sn=new vt(sn);var v=vt;import{PublicKey as Hn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ts}from"@solana/spl-token";import{PublicKey as ue,SystemProgram as ns,SYSVAR_RENT_PUBKEY as rs}from"@solana/web3.js";function S({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var is=[S({pubkey:ts,isWritable:!1}),S({pubkey:ns.programId,isWritable:!1}),S({pubkey:rs,isWritable:!1})];function Yn({publicKey:r,transformSol:e}){let t=jn(r.toString());if(t instanceof ue)return e&&t.equals(ot)?mn:t;if(e&&t.toString()===ot.toBase58())return mn;if(typeof t=="string"){if(t===ue.default.toBase58())return ue.default;try{return new ue(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function jn(r){try{return new ue(r)}catch{return r}}var dn=new ue("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),st=new ue("SysvarRent111111111111111111111111111111111"),Qa=new ue("SysvarC1ock11111111111111111111111111111111"),Bt=new ue("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),os=new ue("Sysvar1nstructions1111111111111111111111111"),Za=new ue("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),$a=new ue("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ja=new ue("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),eu=new ue("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),tu=new ue("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),nu=new ue("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ru=new ue("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),iu=new ue("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),ou=new ue("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),su=new ue("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),au=new ue("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),mn=new ue("So11111111111111111111111111111111111111112"),ot=ue.default;function St(r){return Yn({publicKey:r,transformSol:!0})}import{PublicKey as ss}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Hr}from"@solana/spl-token";var Vt={chainId:101,address:ss.default.toBase58(),programId:Hr.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},at={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Hr.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Qn=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===ot.toBase58()||e instanceof Hn&&ot.equals(e)){this.decimals=at.decimals,this.symbol=at.symbol,this.name=at.name,this.mint=new Hn(at.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?Hn.default:Yn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ae=Qn;Ae.WSOL=new Qn(ee(Y({},at),{mint:at.address}));import{get as Qr,set as as}from"lodash";import $r from"dayjs";import us from"dayjs/plugin/utc";$r.extend(us);var Zn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return $r().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Zr={},cs={};function te(r){let e=Qr(Zr,r);if(!e){let t=Qr(cs,r);e=new Zn({name:r,logLevel:t}),as(Zr,r,e)}return e}import fn from"big.js";import ds from"bn.js";import ps from"decimal.js-light";import ls from"toformat";var ms=ls,Ot=ms;var pn=te("module/fraction"),$n=Ot(fn),Wt=Ot(ps),fs={[0]:Wt.ROUND_DOWN,[1]:Wt.ROUND_HALF_UP,[2]:Wt.ROUND_UP},bs={[0]:fn.roundDown,[1]:fn.roundHalfUp,[2]:fn.roundUp},$=class{constructor(e,t=new ds(1)){this.numerator=oe(e),this.denominator=oe(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new $(this.denominator,this.numerator)}add(e){let t=e instanceof $?e:new $(oe(e));return this.denominator.eq(t.denominator)?new $(this.numerator.add(t.numerator),this.denominator):new $(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof $?e:new $(oe(e));return this.denominator.eq(t.denominator)?new $(this.numerator.sub(t.numerator),this.denominator):new $(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof $?e:new $(oe(e));return new $(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof $?e:new $(oe(e));return new $(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||pn.logWithError(`${e} is not an integer.`),e<=0&&pn.logWithError(`${e} is not positive.`),Wt.set({precision:e+1,rounding:fs[n]});let i=new Wt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||pn.logWithError(`${e} is not an integer.`),e<0&&pn.logWithError(`${e} is negative.`),$n.DP=e,$n.RM=bs[n]||1,new $n(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var gs=te("Raydium_price"),Me=class extends ${constructor(t){let{baseToken:n,quoteToken:i,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=i,this.scalar=new $(Jn(n.decimals),Jn(i.decimals))}get raw(){return new $(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Me({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&gs.logWithError("mul token not equals");let n=super.mul(t);return new Me({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,i){return this.adjusted.toSignificant(t,n,i)}toFixed(t=this.quoteToken.decimals,n,i){return this.adjusted.toFixed(t,n,i)}};var er=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},bn=er;bn.SOL=new er(Vt);import ws from"bn.js";var Jr=new $(new ws(100)),Ge=class extends ${toSignificant(e=5,t,n){return this.mul(Jr).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Jr).toFixed(e,t,n)}};import{PublicKey as hs}from"@solana/web3.js";import ks from"bn.js";function ei(r){return typeof r=="object"&&r!==null&&![Ae,ce,hs,$,ks,Me,Ge].some(e=>typeof e=="object"&&r instanceof e)}function qt(r){return typeof r=="string"?jn(r):Array.isArray(r)?r.map(e=>qt(e)):ei(r)?Object.fromEntries(Object.entries(r).map(([e,t])=>[e,qt(t)])):r}var Dt=new Le(0),yn=new Le(1),dc=new Le(2),pc=new Le(3),fc=new Le(5),tr=new Le(10),bc=new Le(100),yc=new Le(1e3),gc=new Le(1e4),ti=9007199254740991;function oe(r){let e=te("Raydium_parseBigNumberish");if(r instanceof Le)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new Le(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=ti||r<=-ti)&&e.logWithError(`BigNumberish number overflow: ${r}`),new Le(String(r))):typeof r=="bigint"?new Le(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new Le(0))}function Jn(r){return tr.pow(oe(r))}function gn(r,e){let t=r.divmod(e);return t.mod.isZero()?t.div:t.div.isNeg()?t.div.isubn(1):t.div.iaddn(1)}var Ts=te("Raydium_amount"),ni=Ot(As);function Ps(r,e){let t="0",n="0";if(r.includes(".")){let i=r.split(".");i.length===2?([t,n]=i,n=n.padEnd(e,"0")):Ts.logWithError(`invalid number string, num: ${r}`)}else t=r;return[t,n.slice(0,e)||n]}var ce=class extends ${constructor(t,n,i=!0,o){let s=new wn(0),a=tr.pow(new wn(t.decimals));if(i)s=oe(n);else{let u=new wn(0),c=new wn(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=Ps(n.toString(),t.decimals);u=oe(l),c=oe(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=te(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new ce(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new ce(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,i=0){return super.toSignificant(t,n,i)}toFixed(t=this.token.decimals,n,i=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,i)}toExact(t={groupSeparator:""}){return ni.DP=this.token.decimals,new ni(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Cs}from"@solana/web3.js";import si,{isBN as ai}from"bn.js";import{bits as Oc,BitStructure as Wc,blob as xs,Blob as Dc,cstr as qc,f32 as Gc,f32be as Uc,f64 as Xc,f64be as zc,greedy as Yc,Layout as Is,ns64 as jc,ns64be as Hc,nu64 as Qc,nu64be as Zc,offset as $c,s16 as Jc,s16be as el,s24 as tl,s24be as nl,s32 as Bs,s32be as rl,s40 as il,s40be as ol,s48 as sl,s48be as al,s8 as ul,seq as Ss,struct as cl,Structure as Ks,u16 as Ls,u16be as ll,u24 as ml,u24be as dl,u32 as pl,u32be as fl,u40 as bl,u40be as yl,u48 as gl,u48be as wl,u8 as Ns,UInt as Rs,union as hl,Union as kl,unionLayoutDiscriminator as Al,utf8 as Tl}from"@solana/buffer-layout";var nr=Is,ri=Ks;var rr=Rs;var ii=Ns,Kt=Ls;var we=Bs;var oi=Ss;var Te=xs;var bt=class extends nr{constructor(t,n,i){super(t,i);this.blob=Te(t),this.signed=n}decode(t,n=0){let i=new si(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new si(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function _(r){return new rr(1,r)}function Ce(r){return new rr(4,r)}function b(r){return new bt(8,!1,r)}function F(r){return new bt(16,!1,r)}function ui(r){return new bt(1,!0,r)}function kn(r){return new bt(8,!0,r)}function ci(r){return new bt(16,!0,r)}var hn=class extends nr{constructor(t,n,i,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function x(r){return new hn(Te(32),e=>new Cs(e),e=>e.toBuffer(),r)}function Ne(r){return new hn(ii(),Es,_s,r)}function Es(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function _s(r){return r?1:0}var ir=class extends ri{decode(e,t){return super.decode(e,t)}};function L(r,e,t){return new ir(r,e,t)}function O(r,e,t){let n,i=typeof e=="number"?e:ai(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=ai(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return oi(r,i,t)}var Fl=L([Ce("mintAuthorityOption"),x("mintAuthority"),b("supply"),_("decimals"),_("isInitialized"),Ce("freezeAuthorityOption"),x("freezeAuthority")]);import{PublicKey as Wl}from"@solana/web3.js";import{MintLayout as ql,TOKEN_PROGRAM_ID as Ul}from"@solana/spl-token";var li=r=>new Ae({mint:r.address,decimals:r.decimals,symbol:r.symbol,name:r.name});import{PublicKey as Ws}from"@solana/web3.js";import{PublicKey as Ms,ComputeBudgetProgram as mi,Transaction as pi,TransactionMessage as Fs,Keypair as fi,VersionedTransaction as bi}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as vs}from"@solana/spl-token";var J={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw"};var di=te("Raydium_txUtil"),yi=1644;function An(r){let e=[],t=[];return r.microLamports&&(e.push(mi.setComputeUnitPrice({microLamports:r.microLamports})),t.push(J.SetComputeUnitPrice)),r.units&&(e.push(mi.setComputeUnitLimit({units:r.units})),t.push(J.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Lt(r){var e,t;try{return((t=await((e=r.getLatestBlockhash)==null?void 0:e.call(r)))==null?void 0:t.blockhash)||(await r.getRecentBlockhash()).blockhash}catch{return(await r.getRecentBlockhash()).blockhash}}function Vs(r,e){r.length<1&&di.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&di.logWithError(`no signers provided:, ${e.toString()}`);let t=new pi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<yi}catch{return!1}}function me(r,e){let[t,n]=Ms.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function Gt({instructions:r,payer:e,signers:t}){return Vs(r,[e,...t])}function Ut({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=fi.generate().publicKey.toString()}){let o=new Fs({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new bi(o).serialize()).toString("base64").length<yi}catch{return!1}}var Os=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r);function yt(r){let e=[];return r.forEach(t=>{t instanceof pi&&(t.recentBlockhash||(t.recentBlockhash=vs.toBase58()),t.feePayer||(t.feePayer=fi.generate().publicKey));let n=t.serialize({requireAllSignatures:!1,verifySignatures:!1});t instanceof bi&&(n=Os(n));let i=n.toString("base64");e.push(i)}),console.log("simulate tx string:",e),e}import{TOKEN_PROGRAM_ID as Ds}from"@solana/spl-token";function Ee(r,e,t){return me([r.toBuffer(),(t!=null?t:Ds).toBuffer(),e.toBuffer()],new Ws("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as Xt,sendAndConfirmTransaction as ur,Transaction as zt,TransactionMessage as Yt,VersionedTransaction as jt}from"@solana/web3.js";import Us from"axios";import{PublicKey as ki,AddressLookupTableAccount as xn}from"@solana/web3.js";import{PublicKey as qs}from"@solana/web3.js";import{getTransferFeeConfig as Jm,unpackMint as ed}from"@solana/spl-token";function or(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Re}from"@solana/web3.js";var gi=new Re("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),wi=new Re("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),hi=new Re("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),gm=new Re("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),wm=new Re("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),hm=new Re("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),km=new Re("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Am=new Re("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Tm=new Re("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Pm=new Re("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),xm=new Re("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Im=new Re("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Bm=new Re("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Sm=new Re("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi");import de from"bn.js";var Ue=1e4;function Tn(r,e,t,n){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let i=t.epoch<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new de(i.maximumFee.toString()),s=t.epoch<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(i.transferFeeBasisPoints===Ue){let a=new de(i.maximumFee.toString());return{amount:r.add(a),fee:a,expirationTime:s}}else{let a=Nt(r.mul(new de(Ue)),new de(Ue-i.transferFeeBasisPoints)),u=new de(i.maximumFee.toString()),c=a.sub(r).gt(u)?r.add(u):a,l=Nt(c.mul(new de(i.transferFeeBasisPoints)),new de(Ue)),m=l.gt(o)?o:l;return{amount:c,fee:m,expirationTime:s}}else{let a=Nt(r.mul(new de(i.transferFeeBasisPoints)),new de(Ue)),u=a.gt(o)?o:a;return{amount:r,fee:u,expirationTime:s}}}function Pe(r,e,t,n){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let i=ee(Y({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,s=new de(o.maximumFee.toString()),a=t.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Ue){let u=new de(o.maximumFee.toString());return{amount:r.add(u),fee:u,expirationTime:a}}else{let u=Nt(r.mul(new de(Ue)),new de(Ue-o.transferFeeBasisPoints)),c=new de(o.maximumFee.toString()),l=u.sub(r).gt(c)?r.add(c):u,m=Nt(l.mul(new de(o.transferFeeBasisPoints)),new de(Ue)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let u=Nt(r.mul(new de(o.transferFeeBasisPoints)),new de(Ue)),c=u.gt(s)?s:u;return{amount:r,fee:c,expirationTime:a}}}function gt(r,e){return r===void 0?e:e===void 0?r:Math.min(r,e)}function Nt(r,e){let{div:t,mod:n}=r.divmod(e);return n.gt(new de(0))?t.add(new de(1)):t}var sr=te("Raydium_accountInfo_util");async function ut(r,e,t){let{batchRequest:n,commitment:i="confirmed"}=Y({batchRequest:!1},t),o=or(e,100),s=new Array(o.length).fill([]);if(n){let a=o.map(l=>{let m=r._buildArgs([l.map(d=>d.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:m}}),u=or(a,10);s=(await(await Promise.all(u.map(async l=>await r._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&sr.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(m=>{if(m){let{data:d,executable:p,lamports:y,owner:f,rentEpoch:g}=m;return d.length!==2&&d[1]!=="base64"&&sr.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:p,lamports:y,owner:new qs(f),rentEpoch:g}}return null})))}else try{s=await Promise.all(o.map(a=>r.getMultipleAccountsInfo(a,i)))}catch(a){a instanceof Error&&sr.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function Pn(r,e,t){let n=await ut(r,e.map(i=>i.pubkey),t);return e.map((i,o)=>ee(Y({},i),{accountInfo:n[o]}))}async function ar({connection:r,address:e}){let t=await ut(r,[...new Set(e.map(i=>i.toString()))].map(i=>new ki(i))),n={};for(let i=0;i<e.length;i++){let o=t[i],s=e[i];if(!o)continue;let a=new xn({key:s,state:xn.deserialize(o.data)});n[s.toString()]=a,In[s.toString()]=a}return n}var In={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new xn({key:new ki("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:xn.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var Bn=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Us.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=An(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Xt.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(Y({},t||{})):this.build(t)}build(e){let t=new zt;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async()=>{var i;let n=await Lt(this.connection);if(t.recentBlockhash=n,this.signers.length&&t.sign(...this.signers),yt([t]),(i=this.owner)!=null&&i.isKeyPair)return{txId:await ur(this.connection,t,this.signers),signedTx:t};if(this.signAllTransactions){let o=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(o[0].serialize(),{skipPreflight:!0}),signedTx:o[0]}}throw new Error("please connect wallet first")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:i}=this.build(n),o=t.filter(c=>c.transaction.instructions.length>0),s=[i,...o.map(c=>c.transaction)],a=[this.signers,...o.map(c=>c.signers)],u=[...this.instructionTypes,...o.map(c=>c.instructionTypes).flat()];return{builder:this,transactions:s,signers:a,instructionTypes:u,execute:async c=>{var p;let{sequentially:l,onTxUpdate:m}=c||{},d=await Lt(this.connection);if((p=this.owner)!=null&&p.isKeyPair)return{txIds:await await Promise.all(s.map(async(y,f)=>(y.recentBlockhash=d,await ur(this.connection,y,a[f])))),signedTxs:s};if(this.signAllTransactions){let y=s.map((g,w)=>(g.recentBlockhash=d,a[w].length&&g.sign(...a[w]),g));yt(y);let f=await this.signAllTransactions(y);if(l){let g=0,w=[],A=async()=>{if(!f[g])return;let h=await this.connection.sendRawTransaction(f[g].serialize(),{skipPreflight:!0});w.push({txId:h,status:"sent",signedTx:f[g]}),m==null||m([...w]),g++,this.connection.onSignature(h,P=>{let k=w.findIndex(I=>I.txId===h);k>-1&&(w[k].status=P.err?"error":"success"),m==null||m([...w]),A()},"processed"),this.connection.getSignatureStatus(h)};return await A(),{txIds:w.map(h=>h.txId),signedTxs:f}}else{let g=[];for(let w=0;w<f.length;w+=1){let A=await this.connection.sendRawTransaction(f[w].serialize(),{skipPreflight:!0});g.push(A)}return{txIds:g,signedTxs:f}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){let d=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:i}=d,o=Fe(d,["lookupTableCache","lookupTableAddress","forerunCreate"]),s=Y(Y({},In),t),a=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let p of a)s[p]===void 0&&u.push(new Xt(p));let c=await ar({connection:this.connection,address:u});for(let[p,y]of Object.entries(c))s[p]=y;let l=new Yt({payerKey:this.feePayer,recentBlockhash:i?Xt.default.toBase58():await Lt(this.connection),instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s)),m=new jt(l);return m.sign(this.signers),{builder:this,transaction:m,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async()=>{var p;if(yt([m]),(p=this.owner)!=null&&p.isKeyPair)return m.sign([this.owner.signer]),{txId:await this.connection.sendTransaction(m,{skipPreflight:!0}),signedTx:m};if(this.signAllTransactions){let y=await this.signAllTransactions([m]);return{txId:await this.connection.sendTransaction(y[0],{skipPreflight:!0}),signedTx:y[0]}}throw new Error("please connect wallet first")},extInfo:o||{}}}async buildV0MultiTx(e){let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:i}=await this.buildV0(n),o=t.filter(c=>c.builder.instructions.length>0),s=[i,...o.map(c=>c.transaction)],a=[this.signers,...o.map(c=>c.signers)],u=[...this.instructionTypes,...o.map(c=>c.instructionTypes).flat()];return s.forEach(async(c,l)=>{c.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:u,buildProps:n,execute:async c=>{var d;yt(s);let{sequentially:l,onTxUpdate:m}=c||{};if((d=this.owner)!=null&&d.isKeyPair)return s.forEach(p=>p.sign([this.owner.signer])),{txIds:await Promise.all(s.map(async p=>await this.connection.sendTransaction(p))),signedTxs:s};if(this.signAllTransactions){let p=await this.signAllTransactions(s);if(l){let y=0,f=[],g=async()=>{if(!p[y])return;let w=await this.connection.sendTransaction(p[y],{skipPreflight:!0});f.push({txId:w,status:"sent",signedTx:p[y]}),m==null||m([...f]),y++,this.connection.onSignature(w,A=>{let h=f.findIndex(P=>P.txId===w);h>-1&&(f[h].status=A.err?"error":"success"),m==null||m([...f]),g()},"processed"),this.connection.getSignatureStatus(w)};return g(),{txIds:[],signedTxs:p}}else{let y=[];for(let f=0;f<p.length;f+=1){let g=await this.connection.sendTransaction(p[f],{skipPreflight:!0});y.push(g)}return{txIds:y,signedTxs:p}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async sizeCheckBuild(e){let c=e||{},{autoComputeBudget:t=!1}=c,n=Fe(c,["autoComputeBudget"]),i={instructions:[],instructionTypes:[]};if(t){let l=t?await this.getComputeBudgetConfig():void 0;i=t&&l?An(l):{instructions:[],instructionTypes:[]}}let o=this.signers.reduce((l,m)=>ee(Y({},l),{[m.publicKey.toBase58()]:m}),{}),s=[],a=[],u=[];if(this.allInstructions.forEach(l=>{let m=[...u,l],d=t?[...i.instructions,...m]:m,y=[...new Set(m.map(f=>f.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(f=>new Xt(f));if(u.length<12&&Gt({instructions:d,payer:this.feePayer,signers:y})||Gt({instructions:m,payer:this.feePayer,signers:y}))u.push(l);else{if(u.length===0)throw Error("item ins too big");Gt({instructions:t?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:y})?s.push(new zt().add(...i.instructions,...u)):s.push(new zt().add(...u)),a.push(Array.from(new Set(u.map(f=>f.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat())).map(f=>o[f]).filter(f=>f!==void 0)),u=[l]}}),u.length>0){let m=[...new Set(u.map(d=>d.keys.filter(p=>p.isSigner).map(p=>p.pubkey.toString())).flat()).values()].map(d=>o[d]).filter(d=>d!==void 0);Gt({instructions:t?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:m.map(d=>d.publicKey)})?s.push(new zt().add(...i.instructions,...u)):s.push(new zt().add(...u)),a.push(m)}return s.forEach(l=>l.feePayer=this.feePayer),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async l=>{var y;let{sequentially:m,onTxUpdate:d}=l||{},p=await Lt(this.connection);if(s.forEach(async(f,g)=>{f.recentBlockhash=p,a[g].length&&f.sign(...a[g])}),yt(s),(y=this.owner)!=null&&y.isKeyPair)return{txIds:await Promise.all(s.map(async(f,g)=>await ur(this.connection,f,a[g]))),signedTxs:s};if(this.signAllTransactions){let f=await this.signAllTransactions(s);if(m){let g=0,w=[],A=async()=>{if(!f[g])return;let h=await this.connection.sendRawTransaction(f[g].serialize(),{skipPreflight:!0});w.push({txId:h,status:"sent",signedTx:f[g]}),d==null||d([...w]),g++,this.connection.onSignature(h,P=>{let k=w.findIndex(I=>I.txId===h);k>-1&&(w[k].status=P.err?"error":"success"),d==null||d([...w]),A()},"processed"),this.connection.getSignatureStatus(h)};return await A(),{txIds:w.map(h=>h.txId),signedTxs:f}}else{let g=[];for(let w=0;w<f.length;w+=1){let A=await this.connection.sendRawTransaction(f[w].serialize(),{skipPreflight:!0});g.push(A)}return{txIds:g,signedTxs:f}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async sizeCheckBuildV0(e){let g=e||{},{autoComputeBudget:t=!1,lookupTableCache:n={},lookupTableAddress:i=[]}=g,o=Fe(g,["autoComputeBudget","lookupTableCache","lookupTableAddress"]),s=Y(Y({},In),n),a=Array.from(new Set([...this.lookupTableAddress,...i])),u=[];for(let w of a)s[w]===void 0&&u.push(new Xt(w));let c=await ar({connection:this.connection,address:u});for(let[w,A]of Object.entries(c))s[w]=A;let l={instructions:[],instructionTypes:[]};if(t){let w=t?await this.getComputeBudgetConfig():void 0;l=t&&w?An(w):{instructions:[],instructionTypes:[]}}let m=await Lt(this.connection),d=this.signers.reduce((w,A)=>ee(Y({},w),{[A.publicKey.toBase58()]:A}),{}),p=[],y=[],f=[];if(this.allInstructions.forEach(w=>{let A=[...f,w],h=t?[...l.instructions,...A]:A;if(f.length<12&&Ut({instructions:h,payer:this.feePayer,lookupTableAddressAccount:s})||Ut({instructions:A,payer:this.feePayer,lookupTableAddressAccount:s}))f.push(w);else{if(f.length===0)throw Error("item ins too big");let P={};for(let k of[...new Set(a)])s[k]!==void 0&&(P[k]=s[k]);if(t&&Ut({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let k=new Yt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new jt(k))}else{let k=new Yt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new jt(k))}y.push(Array.from(new Set(f.map(k=>k.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat())).map(k=>d[k]).filter(k=>k!==void 0)),f=[w]}}),f.length>0){let A=[...new Set(f.map(h=>h.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(h=>d[h]).filter(h=>h!==void 0);if(t&&Ut({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let h=new Yt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new jt(h))}else{let h=new Yt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new jt(h))}y.push(A)}return{builder:this,transactions:p,buildProps:e,signers:y,instructionTypes:this.instructionTypes,execute:async w=>{var P;let{sequentially:A,onTxUpdate:h}=w||{};if(p.map(async(k,I)=>{y[I].length&&k.sign(y[I])}),yt(p),(P=this.owner)!=null&&P.isKeyPair)return{txIds:await Promise.all(p.map(async k=>await this.connection.sendTransaction(k,{skipPreflight:!0}))),signedTxs:p};if(this.signAllTransactions){let k=await this.signAllTransactions(p);if(A){let I=0,B=[],M=async()=>{if(!k[I])return;let z=await this.connection.sendTransaction(k[I],{skipPreflight:!0});B.push({txId:z,status:"sent",signedTx:k[I]}),h==null||h([...B]),I++,this.connection.onSignature(z,U=>{let X=B.findIndex(ae=>ae.txId===z);X>-1&&(B[X].status=U.err?"error":"success"),h==null||h([...B]),M()},"processed"),this.connection.getSignatureStatus(z)};return M(),{txIds:[],signedTxs:k}}else{let I=[];for(let B=0;B<k.length;B+=1){let M=await this.connection.sendTransaction(k[B],{skipPreflight:!0});I.push(M)}return{txIds:I,signedTxs:k}}}throw new Error("please connect wallet first")},extInfo:o||{}}}};var cr=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Ht=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=te(t)}createTxBuilder(e){return this.scope.checkOwner(),new Bn({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(cr(e))}logInfo(...e){this.logger.info(cr(e))}logAndCreateError(...e){let t=cr(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{TOKEN_PROGRAM_ID as pr,ASSOCIATED_TOKEN_PROGRAM_ID as Zs}from"@solana/spl-token";import{PublicKey as Xe,TransactionInstruction as Sn,SystemProgram as $s,SYSVAR_RENT_PUBKEY as Md}from"@solana/web3.js";var Xs=L([_("instruction"),b("amountIn"),b("minAmountOut")]),zs=L([_("instruction"),b("maxAmountIn"),b("amountOut")]),xd=L([_("instruction"),_("nonce")]),Ys=L([_("instruction"),_("nonce"),b("startTime")]),Id=L([b("status"),b("nonce"),b("maxOrder"),b("depth"),b("baseDecimal"),b("quoteDecimal"),b("state"),b("resetFlag"),b("minSize"),b("volMaxCutRatio"),b("amountWaveRatio"),b("baseLotSize"),b("quoteLotSize"),b("minPriceMultiplier"),b("maxPriceMultiplier"),b("systemDecimalValue"),b("minSeparateNumerator"),b("minSeparateDenominator"),b("tradeFeeNumerator"),b("tradeFeeDenominator"),b("pnlNumerator"),b("pnlDenominator"),b("swapFeeNumerator"),b("swapFeeDenominator"),b("baseNeedTakePnl"),b("quoteNeedTakePnl"),b("quoteTotalPnl"),b("baseTotalPnl"),b("poolOpenTime"),b("punishPcAmount"),b("punishCoinAmount"),b("orderbookToInitTime"),F("swapBaseInAmount"),F("swapQuoteOutAmount"),b("swapBase2QuoteFee"),F("swapQuoteInAmount"),F("swapBaseOutAmount"),b("swapQuote2BaseFee"),x("baseVault"),x("quoteVault"),x("baseMint"),x("quoteMint"),x("lpMint"),x("openOrders"),x("marketId"),x("marketProgramId"),x("targetOrders"),x("withdrawQueue"),x("lpVault"),x("owner"),b("lpReserve"),O(b(),3,"padding")]),Bd=L([b("accountType"),b("status"),b("nonce"),b("maxOrder"),b("depth"),b("baseDecimal"),b("quoteDecimal"),b("state"),b("resetFlag"),b("minSize"),b("volMaxCutRatio"),b("amountWaveRatio"),b("baseLotSize"),b("quoteLotSize"),b("minPriceMultiplier"),b("maxPriceMultiplier"),b("systemDecimalsValue"),b("abortTradeFactor"),b("priceTickMultiplier"),b("priceTick"),b("minSeparateNumerator"),b("minSeparateDenominator"),b("tradeFeeNumerator"),b("tradeFeeDenominator"),b("pnlNumerator"),b("pnlDenominator"),b("swapFeeNumerator"),b("swapFeeDenominator"),b("baseNeedTakePnl"),b("quoteNeedTakePnl"),b("quoteTotalPnl"),b("baseTotalPnl"),b("poolOpenTime"),b("punishPcAmount"),b("punishCoinAmount"),b("orderbookToInitTime"),F("swapBaseInAmount"),F("swapQuoteOutAmount"),F("swapQuoteInAmount"),F("swapBaseOutAmount"),b("swapQuote2BaseFee"),b("swapBase2QuoteFee"),x("baseVault"),x("quoteVault"),x("baseMint"),x("quoteMint"),x("lpMint"),x("modelDataAccount"),x("openOrders"),x("marketId"),x("marketProgramId"),x("targetOrders"),x("owner"),O(b(),64,"padding")]),lr=L([_("instruction"),b("baseAmountIn"),b("quoteAmountIn"),b("fixedSide")]),mr=L([_("instruction"),b("amountIn")]);var Ai=L([b("fee")]);import{PublicKey as js}from"@solana/web3.js";var dr=new js("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Hs=5e4,Qs=L([b("x"),b("y"),b("price")]),Rd=L([b("accountType"),b("status"),b("multiplier"),b("validDataCount"),O(Qs,Hs,"DataElement")]);var Ud=te("Raydium_liquidity_instruction");function Ti(r){let{poolInfo:e,poolKeys:t,userKeys:n,baseAmountIn:i,quoteAmountIn:o,fixedSide:s}=r,a=Buffer.alloc(lr.span);lr.encode({instruction:3,baseAmountIn:oe(i),quoteAmountIn:oe(o),fixedSide:s==="base"?Dt:yn},a);let u=[S({pubkey:pr,isWritable:!1}),S({pubkey:new Xe(e.id)}),S({pubkey:new Xe(t.authority),isWritable:!1}),S({pubkey:new Xe(t.openOrders),isWritable:!1}),S({pubkey:new Xe(t.targetOrders)}),S({pubkey:new Xe(e.lpMint.address)}),S({pubkey:new Xe(t.vault.A)}),S({pubkey:new Xe(t.vault.B)})];return e.pooltype.includes("StablePool")&&u.push(S({pubkey:dr})),u.push(S({pubkey:new Xe(e.marketId),isWritable:!1}),S({pubkey:n.baseTokenAccount}),S({pubkey:n.quoteTokenAccount}),S({pubkey:n.lpTokenAccount}),S({pubkey:n.owner,isWritable:!1,isSigner:!0}),S({pubkey:new Xe(t.marketEventQueue),isWritable:!1})),new Sn({programId:new Xe(e.programId),keys:u,data:a})}function fr(r){let{poolInfo:e,poolKeys:t,userKeys:n,amountIn:i}=r,o=qt(t),s=4;if(e.pooltype.includes("StablePool")&&(s=5),s===4||s===5){let a=Buffer.alloc(mr.span);mr.encode({instruction:4,amountIn:oe(i)},a);let u=[S({pubkey:pr,isWritable:!1}),S({pubkey:o.id}),S({pubkey:o.authority,isWritable:!1}),S({pubkey:o.openOrders}),S({pubkey:o.targetOrders}),S({pubkey:o.mintLp.address}),S({pubkey:o.vault.A}),S({pubkey:o.vault.B})];return s===5?u.push(S({pubkey:dr})):(u.push(S({pubkey:o.withdrawQueue})),u.push(S({pubkey:o.vault.Lp}))),u.push(S({pubkey:o.marketProgramId,isWritable:!1}),S({pubkey:o.marketId}),S({pubkey:o.marketBaseVault}),S({pubkey:o.marketQuoteVault}),S({pubkey:o.marketAuthority,isWritable:!1}),S({pubkey:n.lpTokenAccount}),S({pubkey:n.baseTokenAccount}),S({pubkey:n.quoteTokenAccount}),S({pubkey:n.owner,isWritable:!1,isSigner:!0}),S({pubkey:o.marketEventQueue}),S({pubkey:o.marketBids}),S({pubkey:o.marketAsks})),new Sn({programId:o.programId,keys:u,data:a})}return new Sn({programId:o.programId,keys:[]})}function Pi({programId:r,ammId:e,ammAuthority:t,ammOpenOrders:n,lpMint:i,coinMint:o,pcMint:s,coinVault:a,pcVault:u,withdrawQueue:c,ammTargetOrders:l,poolTempLp:m,marketProgramId:d,marketId:p,userWallet:y,userCoinVault:f,userPcVault:g,userLpVault:w,nonce:A,openTime:h,coinAmount:P,pcAmount:k,ammConfigId:I,feeDestinationId:B}){let M=L([_("instruction"),_("nonce"),b("openTime"),b("pcAmount"),b("coinAmount")]),z=[{pubkey:pr,isSigner:!1,isWritable:!1},{pubkey:Zs,isSigner:!1,isWritable:!1},{pubkey:$s.programId,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:I,isSigner:!1,isWritable:!1},{pubkey:B,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!0,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:w,isSigner:!1,isWritable:!0}],U=Buffer.alloc(M.span);return M.encode({instruction:1,nonce:A,openTime:h,coinAmount:P,pcAmount:k},U),{instruction:new Sn({keys:z,programId:r,data:U}),instructionType:J.AmmV4CreatePool}}import{TOKEN_PROGRAM_ID as he,TOKEN_2022_PROGRAM_ID as dt,ASSOCIATED_TOKEN_PROGRAM_ID as Ui}from"@solana/spl-token";import{PublicKey as K,TransactionInstruction as We,SystemProgram as Et,Keypair as Sr}from"@solana/web3.js";import Xi from"bn.js";import aa from"bn.js";function Kn(r){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,r,!1),new Uint8Array(e)}function br(r,e){let t=0;for(let n=r-1;n>=0&&!e.testn(n);n--)t++;return t}function yr(r,e){let t=0;for(let n=0;n<r&&!e.testn(n);n++)t++;return t}function Qt(r,e){for(let t=0;t<r;t++)if(e.testn(t))return!1;return!0}function xi(r,e){return Qt(r,e)?null:br(r,e)}function Ii(r,e){return Qt(r,e)?null:yr(r,e)}var Qd=Buffer.from("amm_config","utf8"),Js=Buffer.from("pool","utf8"),ea=Buffer.from("pool_vault","utf8"),ta=Buffer.from("pool_reward_vault","utf8"),Bi=Buffer.from("position","utf8"),na=Buffer.from("tick_array","utf8"),ra=Buffer.from("operation","utf8"),ia=Buffer.from("pool_tick_array_bitmap_extension","utf8");function Si(r,e,t,n){return me([Js,e.toBuffer(),t.toBuffer(),n.toBuffer()],r)}function gr(r,e,t){return me([ea,e.toBuffer(),t.toBuffer()],r)}function Ki(r,e,t){return me([ta,e.toBuffer(),t.toBuffer()],r)}function ne(r,e,t){return me([na,e.toBuffer(),Kn(t)],r)}function wt(r,e,t,n){return me([Bi,e.toBuffer(),Kn(t),Kn(n)],r)}function ze(r,e){return me([Bi,e.toBuffer()],r)}function Ln(r){return me([Buffer.from("metadata","utf8"),Bt.toBuffer(),r.toBuffer()],Bt)}function wr(r){return me([ra],r)}function ct(r,e){return me([ia,e.toBuffer()],r)}import Ye from"bn.js";var pe=new Ye(0),je=new Ye(1),$e=new Ye(-1),_e=new Ye(1).shln(64),Nn=new Ye(1).shln(128),hr=_e.sub(je),Zt=64,Li=Nn.subn(1),xe=-443636,Be=-xe,Rt=new Ye("4295048016"),Ct=new Ye("79226673521066979257578248091"),Ni=16,Ri="59543866431248",Ci="184467440737095516",Ei="15793534762490258745",Rn=new Ye(10).pow(new Ye(6));var Jd=new Ye("18446744073700000000");var oa=15,H=class{static async getTickArrays(e,t,n,i,o,s,a){let u=[],c=C.getTickArrayStartIndexByTick(i,o),l=C.getInitializedTickArrayInRange(s,a,o,c,Math.floor(oa/2));for(let p=0;p<l.length;p++){let{publicKey:y}=ne(t,n,l[p]);u.push(y)}let m=(await ut(e,u)).map(p=>p!==null?$t.decode(p.data):null),d={};for(let p=0;p<u.length;p++){let y=m[p];y!==null&&(d[y.startTickIndex]=ee(Y({},y),{address:u[p]}))}return d}static nextInitializedTick(e,t,n,i,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,i,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=C.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,i,o){let s=Math.floor(e/H.tickCount(t)),a=n?C.searchLowBitFromStart(i,o,s-1,1,t):C.searchHightBitFromStart(i,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,i){let o;if(i){let a=be-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<be;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=ne(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,i,o,s){let a=C.getTickArrayStartIndexByTick(i,o),u=Math.floor((i-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u-1}else for(u=u+1;u<be;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u+1}let{publicKey:m}=ne(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(C.checkIsOutOfBoundary(e)){if(e>Be)return!1;let n=C.getTickArrayStartIndexByTick(xe,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return be*e}};import G from"bn.js";import{PublicKey as _i}from"@solana/web3.js";import le from"bn.js";var kr=14,Je=class{static maxTickInTickarrayBitmap(e){return e*be*ht}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(i+=1);let o=n*i;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,i){if(!H.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=i?t-H.tickCount(n):t+H.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*be,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(i){let l=e.shln(1024-c-1),m=xi(1024,l);if(m!==null){let d=(c-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=Ii(1024,l);if(m!==null){let d=(c+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-H.tickCount(n)}}}},Jt=class{static getBitmapOffset(e,t){if(!H.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=Je.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&i--,i}static getBitmap(e,t,n){let i=this.getBitmapOffset(e,t);return e<0?{offset:i,tickarrayBitmap:n.negativeTickArrayBitmap[i]}:{offset:i,tickarrayBitmap:n.positiveTickArrayBitmap[i]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:i}=this.extensionTickBoundary(t);if(e>=i&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=Je.maxTickInTickarrayBitmap(e),n=-t;if(Be<=t)throw Error(`extensionTickBoundary check error: ${Be}, ${t}`);if(n<=xe)throw Error(`extensionTickBoundary check error: ${n}, ${xe}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:i}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:C.mergeTickArrayBitmap(i).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,i){let o=H.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,i);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,i){let{minValue:o,maxValue:s}=Je.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(i){let u=C.mergeTickArrayBitmap(e).shln(ht-1-a),c=Qt(512,u)?null:br(512,u);if(c!==null){let l=t-c*H.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=C.mergeTickArrayBitmap(e).shrn(a),c=Qt(512,u)?null:yr(512,u);if(c!==null){let l=t+c*H.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-H.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%Je.maxTickInTickarrayBitmap(t),i=Math.floor(n/H.tickCount(t));return e<0&&n!=0&&(i=ht-i),i}};import He from"bn.js";var en=class{static getfeeGrowthInside(e,t,n){let i=new He(0),o=new He(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new He(0),a=new He(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=D.wrappingSubU128(D.wrappingSubU128(e.feeGrowthGlobalX64A,i),s),c=D.wrappingSubU128(D.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=D.mulDivFloor(D.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,_e),u=t.tokenFeesOwedA.add(a),c=D.mulDivFloor(D.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,_e),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=D.mulDivFloor(D.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,_e),u=t.tokenFeesOwedA.add(a),c=D.mulDivFloor(D.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,_e),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,i){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=D.wrappingSubU128(u,c.growthInsideLastX64),m=D.mulDivFloor(l,t.liquidity,_e),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,i){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=D.wrappingSubU128(u,c.growthInsideLastX64),m=D.mulDivFloor(l,t.liquidity,_e),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new He(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new He(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(D.wrappingSubU128(D.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new He(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new He(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(D.wrappingSubU128(D.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:o,epochInfo:s}){var g,w,A,h;let a=q.priceToSqrtPriceX64(new v(e.price),e.mintA.decimals,e.mintB.decimals),u=q.getSqrtPriceX64FromTick(t.tickLower),c=q.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+i:1-i,m=Q.getAmountsFromLiquidity(a,u,c,n,o),[d,p]=[Pe(m.amountA,(g=e.mintA.extensions)==null?void 0:g.feeConfig,s,!0),Pe(m.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)],[y,f]=[Pe(new He(new v(m.amountA.toString()).mul(l).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,s,!0),Pe(new He(new v(m.amountB.toString()).mul(l).toFixed(0)),(h=e.mintB.extensions)==null?void 0:h.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:y,amountSlippageB:f,expirationTime:gt(d.expirationTime,p.expirationTime)}}};var Se=class{static getOutputAmountAndRemainAccounts(e,t,n,i,o){let s=n.equals(e.mintA.mint),a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:y}=kt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i,c,o);return a.push(...d),{expectedAmountOut:m.mul($e),remainingAccounts:a,executionPrice:p,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,i,o){let s=n.equals(e.mintB.mint),a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:g}=ne(e.programId,e.id,f.nextStartIndex);a.push(g)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:y}=kt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i.mul($e),c,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:p,feeAmount:y}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:i}=Se.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Jt.checkTickArrayIsInit(H.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):C.checkTickArrayIsInitialized(C.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=ne(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,H.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=ne(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/H.tickCount(e.tickSpacing)),i=t?C.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):C.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=H.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:i,tickIndex:o}=Je.nextInitializedTickArrayStartIndex(C.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(i)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Jt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<xe||t>Be)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:i,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let p=ee(Y({},m),{perSecond:D.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new _i(d)});if(p.tokenMint.equals(_i.default))continue;if(n<=p.openTime.toNumber()||i.eq(pe)){s.push(p);continue}let y=new le(Math.min(p.endTime.toNumber(),n)),f=y.sub(p.lastUpdateTime),g=D.mulDivFloor(f,p.emissionsPerSecondX64,i),w=p.rewardGrowthGlobalX64.add(g),A=D.mulDivFloor(f,p.emissionsPerSecondX64,_e),h=p.rewardTotalEmissioned.add(A);s.push(ee(Y({},p),{rewardGrowthGlobalX64:w,rewardTotalEmissioned:h,lastUpdateTime:y}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:i}=this.tickRange(e);for(let o of t){let s=C.getTickArrayStartIndexByTick(o,e);if(s>=n||s<i)return!0}return!1}static tickRange(e){let t=Je.maxTickInTickarrayBitmap(e),n=-t;return t>Be&&(t=H.getArrayStartIndex(Be,e)+H.tickCount(e)),n<xe&&(n=H.getArrayStartIndex(xe,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!H.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/H.tickCount(t)*ht}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let i=await Pn(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of i)s.accountInfo!==null&&(o[s.pubkey.toString()]=Fi.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let i={},o=[];for(let u of t){let c=C.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=C.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:d}=ne(u.programId,u.id,m);o.push({pubkey:d}),i[d.toString()]=u.id}}let s=await Pn(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=i[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=$t.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]=ee(Y({},l),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:i=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let p of s)c.push(ze(p,d).publicKey);let l=await ut(t,c,{batchRequest:i}),m={};for(let d of l){if(d===null)continue;let p=Mi.decode(d.data),y=p.poolId.toString(),f=e.find(M=>M.state.id.toBase58()===y);if(f===void 0)continue;let g=f.state,w=C._getTickPriceLegacy({poolInfo:g,tick:p.tickLower,baseIn:!0}),A=C._getTickPriceLegacy({poolInfo:g,tick:p.tickUpper,baseIn:!0}),{amountA:h,amountB:P}=Q.getAmountsFromLiquidity(g.sqrtPriceX64,w.tickSqrtPriceX64,A.tickSqrtPriceX64,p.liquidity,!1),k=1/(1-Math.sqrt(Math.sqrt(w.price.div(A.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:w.price,priceUpper:A.price,amountA:h,amountB:P,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(M=>ee(Y({},M),{pendingReward:new le(0)})),leverage:k,tokenFeeAmountA:new le(0),tokenFeeAmountB:new le(0)}];let I=await C.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),B=await C.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=I,m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=B}if(o){let d=Object.values(m),p=await ut(t,d,{batchRequest:i}),y={};for(let f=0;f<d.length;f++){let g=p[f];if(g===null)continue;let w=d[f].toString();y[w]=$t.decode(g.data)}for(let{state:f,positionAccount:g}of e)if(!!g)for(let w of g){let A=`${f.programId.toString()}-${f.id.toString()}-${w.tickLower}`,h=`${f.programId.toString()}-${f.id.toString()}-${w.tickUpper}`,P=y[m[A].toString()],k=y[m[h].toString()],I=P.ticks[C.getTickOffsetInArray(w.tickLower,f.tickSpacing)],B=k.ticks[C.getTickOffsetInArray(w.tickUpper,f.tickSpacing)],{tokenFeeAmountA:M,tokenFeeAmountB:z}=await en.GetPositionFees(f,w,I,B),U=await en.GetPositionRewards(f,w,I,B);w.tokenFeeAmountA=M.gte(new le(0))?M:new le(0),w.tokenFeeAmountB=z.gte(new le(0))?z:new le(0);for(let X=0;X<U.length;X++)w.rewardInfos[X].pendingReward=U[X].gte(new le(0))?U[X]:new le(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,token2022Infos:i,epochInfo:o,amountIn:s,slippage:a,priceLimit:u=new v(0)}){var z,U,X,ae;let c;u.equals(new v(0))?c=n.equals(e.mintA.mint)?Rt.add(new le(1)):Ct.sub(new le(1)):c=q.priceToSqrtPriceX64(u,e.mintA.decimals,e.mintB.decimals);let l=Tn(s,(z=i[n.toString()])==null?void 0:z.feeConfig,o,!1),{expectedAmountOut:m,remainingAccounts:d,executionPrice:p,feeAmount:y}=Se.getOutputAmountAndRemainAccounts(e,t,n,l.amount.sub((U=l.fee)!=null?U:pe),c),f=e.mintA.mint.equals(n)?e.mintB.mint:e.mintA.mint,g=Tn(m,(X=i[f.toString()])==null?void 0:X.feeConfig,o,!1),w=q.sqrtPriceX64ToPrice(p,e.mintA.decimals,e.mintB.decimals),A=n.equals(e.mintA.mint)?w:new v(1).div(w),h=m.mul(new le(Math.floor((1-a)*1e10))).div(new le(1e10)),P=Tn(h,(ae=i[f.toString()])==null?void 0:ae.feeConfig,o,!1),k=e.mintA.mint.equals(n)?e.currentPrice:new v(1).div(e.currentPrice),I=new v(A).sub(k).abs(),B=k,M=new Ge(new v(I).mul(10**15).toFixed(0),new v(B).mul(10**15).toFixed(0));return{realAmountIn:l,amountOut:g,minAmountOut:P,expirationTime:gt(l.expirationTime,g.expirationTime),currentPrice:e.currentPrice,executionPrice:A,priceImpact:M,fee:y,remainingAccounts:d}}static async computeAmountOutFormat({poolInfo:e,tickArrayCache:t,token2022Infos:n,amountIn:i,tokenOut:o,slippage:s,epochInfo:a}){let u=i.token.equals(Ae.WSOL)?mn:i.token.mint,c=s.numerator.toNumber()/s.denominator.toNumber(),l=o.mint.equals(ot)?new Ae({mint:"sol",decimals:Vt.decimals}):o,{realAmountIn:m,amountOut:d,minAmountOut:p,expirationTime:y,currentPrice:f,executionPrice:g,priceImpact:w,fee:A,remainingAccounts:h}=await Se.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:u,amountIn:i.raw,slippage:c,token2022Infos:n,epochInfo:a}),P=ee(Y({},m),{amount:new ce(i.token,m.amount),fee:m.fee===void 0?void 0:new ce(i.token,m.fee)}),k=ee(Y({},d),{amount:new ce(l,d.amount),fee:d.fee===void 0?void 0:new ce(l,d.fee)}),I=ee(Y({},p),{amount:new ce(l,p.amount),fee:p.fee===void 0?void 0:new ce(l,p.fee)}),B=new Me({baseToken:i.token,denominator:new le(10).pow(new le(20+i.token.decimals)),quoteToken:l,numerator:f.mul(new v(10**(20+l.decimals))).toFixed(0)}),M=new Me({baseToken:i.token,denominator:new le(10).pow(new le(20+i.token.decimals)),quoteToken:l,numerator:g.mul(new v(10**(20+l.decimals))).toFixed(0)}),z=new ce(i.token,A);return{realAmountIn:P,amountOut:k,minAmountOut:I,expirationTime:y,currentPrice:B,executionPrice:M,priceImpact:w,fee:z,remainingAccounts:h}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:i}){var y,f,g;let o=e[t],s=C.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=C.getTickPrice({poolInfo:e,tick:i,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,d=o.priceMax-o.priceMin,p;return l<=0?p=0:m===l?p=d/l:d===l?p=l/m:p=l/d*(l/m),{feeApr:o.feeApr*p,rewardsApr:[(y=o.rewardApr[0])!=null?y:0*p,(f=o.rewardApr[1])!=null?f:0*p,(g=o.rewardApr[2])!=null?g:0*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:i,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=i[St(e.mintA.address).toString()],d=i[St(e.mintB.address).toString()],p=e.mintA.decimals,y=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=q.priceToSqrtPriceX64(new v(e.price),e.mintA.decimals,e.mintB.decimals),g=q.getSqrtPriceX64FromTick(s),w=q.getSqrtPriceX64FromTick(a),{amountSlippageA:A,amountSlippageB:h}=Q.getAmountsFromLiquidityWithSlippage(f,g,w,t,!1,!1,0),{amountSlippageA:P,amountSlippageB:k}=Q.getAmountsFromLiquidityWithSlippage(f,g,w,o,!1,!1,0),I=new v(A.toString()).div(new v(10).pow(p)).mul(m.value).add(new v(h.toString()).div(new v(10).pow(y)).mul(d.value)),B=new v(P.toString()).div(new v(10).pow(p)).mul(m.value).add(new v(k.toString()).div(new v(10).pow(y)).mul(d.value)),M=B.div(I.add(B)).div(B),U=new v(l.volumeFee).mul(365).div(c).mul(M).mul(100).toNumber(),X=3600*24*365,ae=e.rewardDefaultInfos.map(se=>{var j,et;let Z=se.mint.decimals,re=i[se.mint.address];return u<((j=se.startTime)!=null?j:0)||u>((et=se.endTime)!=null?et:0)||!se.perSecond||!re||Z===void 0?0:new v(re.value).mul(new v(se.perSecond).mul(X)).div(new v(10).pow(Z)).mul(M).mul(100).toNumber()});return{feeApr:U,rewardsApr:ae,apr:U+ae.reduce((se,Z)=>se+Z,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:i,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var w,A;let l=q.priceToSqrtPriceX64(new v(e.price),e.mintA.decimals,e.mintB.decimals),m=q.getSqrtPriceX64FromTick(n),d=q.getSqrtPriceX64FromTick(i),p=a?1-s:1+s,y=Pe(o,(w=e[t?"mintA":"mintB"].extensions)==null?void 0:w.feeConfig,u,!c),f=new le(new v(y.amount.sub((A=y.fee)!=null?A:pe).toString()).mul(p).toFixed(0)),g;if(l.lte(m))g=t?Q.getLiquidityFromTokenAmountA(m,d,f,!a):new le(0);else if(l.lte(d)){let h=Q.getLiquidityFromTokenAmountA(l,d,f,!a),P=Q.getLiquidityFromTokenAmountB(m,l,f);g=t?h:P}else g=t?new le(0):Q.getLiquidityFromTokenAmountB(m,d,f);return Se.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:i,liquidity:g,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:i,liquidity:o,slippage:s,add:a}){var g,w,A,h;let u=q.getSqrtPriceX64FromTick(n),c=q.getSqrtPriceX64FromTick(i),l=a?1+s:1-s,m=Q.getAmountsFromLiquidity(q.priceToSqrtPriceX64(new v(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,p]=[Pe(m.amountA,(g=t.mintA.extensions)==null?void 0:g.feeConfig,e,!0),Pe(m.amountB,(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)],[y,f]=[Pe(m.amountA.muln(l),(A=t.mintA.extensions)==null?void 0:A.feeConfig,e,!0),Pe(m.amountB.muln(l),(h=t.mintB.extensions)==null?void 0:h.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:p,amountSlippageA:y,amountSlippageB:f,expirationTime:gt(d.expirationTime,p.expirationTime)}}};var D=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),o=i.div(n);return i.mod(n).eq(pe)||(o=o.add(je)),o}static mulDivFloor(e,t,n){if(n.eq(pe))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(pe))throw new Error("division by 0");return e.mul(t).add(n.sub(je)).div(n)}static x64ToDecimal(e,t){return new v(e.toString()).div(v.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new G(e.mul(v.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Nn).sub(t).mod(Nn)}};function ye(r,e){return Ar(r.mul(e),64,256)}function sa(r,e,t){let n=r.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Ar(r,e,t){let n=r.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var q=class{static sqrtPriceX64ToPrice(e,t,n){return D.x64ToDecimal(e).pow(2).mul(v.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return D.decimalToX64(e.mul(v.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(pe))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(pe))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(pe))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(pe))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(pe))return e;let o=t.shln(Zt);if(i){let s=o,a=o.add(n.mul(e));return a.gte(s)?D.mulDivCeil(s,e,a):D.mulDivRoundingUp(s,je,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return D.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let o=n.shln(Zt);if(i)return e.add(o.div(t));{let s=D.mulDivRoundingUp(o,je,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<xe||e>Be)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new G("18445821805675395072"):new G("18446744073709551616");return(t&2)!=0&&(n=ye(n,new G("18444899583751176192"))),(t&4)!=0&&(n=ye(n,new G("18443055278223355904"))),(t&8)!=0&&(n=ye(n,new G("18439367220385607680"))),(t&16)!=0&&(n=ye(n,new G("18431993317065453568"))),(t&32)!=0&&(n=ye(n,new G("18417254355718170624"))),(t&64)!=0&&(n=ye(n,new G("18387811781193609216"))),(t&128)!=0&&(n=ye(n,new G("18329067761203558400"))),(t&256)!=0&&(n=ye(n,new G("18212142134806163456"))),(t&512)!=0&&(n=ye(n,new G("17980523815641700352"))),(t&1024)!=0&&(n=ye(n,new G("17526086738831433728"))),(t&2048)!=0&&(n=ye(n,new G("16651378430235570176"))),(t&4096)!=0&&(n=ye(n,new G("15030750278694412288"))),(t&8192)!=0&&(n=ye(n,new G("12247334978884435968"))),(t&16384)!=0&&(n=ye(n,new G("8131365268886854656"))),(t&32768)!=0&&(n=ye(n,new G("3584323654725218816"))),(t&65536)!=0&&(n=ye(n,new G("696457651848324352"))),(t&131072)!=0&&(n=ye(n,new G("26294789957507116"))),(t&262144)!=0&&(n=ye(n,new G("37481735321082"))),e>0&&(n=Li.div(n)),n}static getTickFromPrice(e,t,n){return q.getTickFromSqrtPriceX64(q.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Ct)||e.lt(Rt))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new G(t-64),i=sa(n,32,128),o=new G("8000000000000000","hex"),s=0,a=new G(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new G(0))&&s<Ni;){u=u.mul(u);let y=u.shrn(127);u=u.shrn(63+y.toNumber()),a=a.add(o.mul(y)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=i.add(c).mul(new G(Ri)),d=Ar(m.sub(new G(Ci)),64,128).toNumber(),p=Ar(m.add(new G(Ei)),64,128).toNumber();return d==p?d:q.getSqrtPriceX64FromTick(p).lte(e)?p:d}},At=class{static getTickWithPriceAndTickspacing(e,t,n,i){let s=q.getTickFromSqrtPriceX64(q.priceToSqrtPriceX64(e,n,i))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,i){let o=At.getTickWithPriceAndTickspacing(e,t,n,i),s=q.getSqrtPriceX64FromTick(o);return q.sqrtPriceX64ToPrice(s,n,i)}},Q=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(pe))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Zt),s=t.sub(e);return i?D.mulDivRoundingUp(D.mulDivCeil(o,s,t),je,e):D.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(pe))throw new Error("sqrtPriceX64A must greater than 0");return i?D.mulDivCeil(n,t.sub(e),_e):D.mulDivFloor(n,t.sub(e),_e)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return i?D.mulDivRoundingUp(a,je,hr):a.shrn(Zt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),D.mulDivFloor(n,hr,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return Q.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){let s=Q.getLiquidityFromTokenAmountA(e,n,i,!1),a=Q.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return Q.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:Q.getTokenAmountAFromLiquidity(t,n,i,o),amountB:new G(0)};if(e.lt(n)){let s=Q.getTokenAmountAFromLiquidity(e,n,i,o),a=Q.getTokenAmountBFromLiquidity(t,e,i,o);return{amountA:s,amountB:a}}else return{amountA:new G(0),amountB:Q.getTokenAmountBFromLiquidity(t,n,i,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,o,s,a){let{amountA:u,amountB:c}=Q.getAmountsFromLiquidity(e,t,n,i,s),l=o?1+a:1-a,m=new G(new v(u.toString()).mul(l).toFixed(0)),d=new G(new v(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var A,h,P,k;let c=q.priceToSqrtPriceX64(new v(e.price),e.mintA.decimals,e.mintB.decimals),l=q.getSqrtPriceX64FromTick(t),m=q.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,p=Q.getAmountsFromLiquidity(c,l,m,i,s),[y,f]=[Pe(p.amountA,(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,u),Pe(p.amountB,(h=e.mintB.extensions)==null?void 0:h.feeConfig,a,u)],[g,w]=[Pe(new G(new v(p.amountA.toString()).mul(d).toFixed(0)),(P=e.mintA.extensions)==null?void 0:P.feeConfig,a,u),Pe(new G(new v(p.amountB.toString()).mul(d).toFixed(0)),(k=e.mintB.extensions)==null?void 0:k.feeConfig,a,u)];return{liquidity:i,amountA:y,amountB:f,amountSlippageA:g,amountSlippageB:w,expirationTime:gt(y.expirationTime,f.expirationTime)}}},kt=class{static swapCompute(e,t,n,i,o,s,a,u,c,l,m,d,p,y){if(d.eq(pe))throw new Error("amountSpecified must not be 0");if(y||(y=s?Rt.add(je):Ct.sub(je)),s){if(y.lt(Rt))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(y.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(y.gt(Ct))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(y.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let f=d.gt(pe),g={amountSpecifiedRemaining:d,amountCalculated:pe,sqrtPriceX64:m,tick:c>p?Math.min(p+H.tickCount(l)-1,c):p,accounts:[],liquidity:u,feeAmount:new G(0)},w=p,A=n[p],h=0,P=!s&&A.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(pe)&&!g.sqrtPriceX64.eq(y);){if(h>10)throw Error("liquidity limit");let k={};k.sqrtPriceStartX64=g.sqrtPriceX64;let I=C.nextInitTick(A,g.tick,l,s,P),B=I||null,M=null;if(!(B!=null&&B.liquidityGross.gtn(0))){let U=Se.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:l,tickArrayBitmap:i,exBitmapInfo:o},w,s);if(!U.isExist)throw Error("swapCompute LiquidityInsufficient");w=U.nextStartIndex;let{publicKey:X}=ne(e,t,w);M=X,A=n[w],B=C.firstInitializedTick(A,s)}k.tickNext=B.tick,k.initialized=B.liquidityGross.gtn(0),p!==w&&M&&(g.accounts.push(M),p=w),k.tickNext<xe?k.tickNext=xe:k.tickNext>Be&&(k.tickNext=Be),k.sqrtPriceNextX64=q.getSqrtPriceX64FromTick(k.tickNext);let z;if(s&&k.sqrtPriceNextX64.lt(y)||!s&&k.sqrtPriceNextX64.gt(y)?z=y:z=k.sqrtPriceNextX64,[g.sqrtPriceX64,k.amountIn,k.amountOut,k.feeAmount]=kt.swapStepCompute(g.sqrtPriceX64,z,g.liquidity,g.amountSpecifiedRemaining,a),g.feeAmount=g.feeAmount.add(k.feeAmount),f?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(k.amountIn.add(k.feeAmount)),g.amountCalculated=g.amountCalculated.sub(k.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(k.amountOut),g.amountCalculated=g.amountCalculated.add(k.amountIn.add(k.feeAmount))),g.sqrtPriceX64.eq(k.sqrtPriceNextX64)){if(k.initialized){let U=B.liquidityNet;s&&(U=U.mul($e)),g.liquidity=Q.addDelta(g.liquidity,U)}P=k.tickNext!=g.tick&&!s&&A.startTickIndex===k.tickNext,g.tick=s?k.tickNext-1:k.tickNext}else if(g.sqrtPriceX64!=k.sqrtPriceStartX64){let U=q.getTickFromSqrtPriceX64(g.sqrtPriceX64);P=U!=g.tick&&!s&&A.startTickIndex===U,g.tick=U}++h}try{let{nextStartIndex:k,isExist:I}=H.nextInitializedTickArray(g.tick,l,s,i,o);I&&p!==k&&(g.accounts.push(ne(e,t,k).publicKey),p=k)}catch{}return{amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,i,o){let s={sqrtPriceX64Next:new G(0),amountIn:new G(0),amountOut:new G(0),feeAmount:new G(0)},a=e.gte(t),u=i.gte(pe);if(u){let l=D.mulDivFloor(i,Rn.sub(new G(o.toString())),Rn);s.amountIn=a?Q.getTokenAmountAFromLiquidity(t,e,n,!0):Q.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=q.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?Q.getTokenAmountBFromLiquidity(t,e,n,!1):Q.getTokenAmountAFromLiquidity(e,t,n,!1),i.mul($e).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=q.getNextSqrtPriceX64FromOutput(e,n,i.mul($e),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=Q.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=Q.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:Q.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:Q.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(i.mul($e))&&(s.amountOut=i.mul($e)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=i.sub(s.amountIn):s.feeAmount=D.mulDivCeil(s.amountIn,new G(o),Rn.sub(new G(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var be=60,ht=512,C=class{static getTickArrayAddressByTick(e,t,n,i){let o=C.getTickArrayStartIndexByTick(n,i),{publicKey:s}=ne(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=C.getTickArrayStartIndexByTick(e,t),i=Math.floor((e-n)/t);if(i<0||i>=be)throw new Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,t){let n=H.tickCount(t),i=e/n;return e<0&&e%n!=0?i=Math.ceil(i)-1:i=Math.floor(i),i}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*H.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*be,i=Math.floor(e/n)+512;return Math.abs(i)}static checkTickArrayIsInitialized(e,t,n){let i=n*be,o=Math.floor(t/i)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*i}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*be:e+t*be}static mergeTickArrayBitmap(e){let t=new aa(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,i,o){let s=Math.floor(i/(n*be));return[...C.searchLowBitFromStart(e,t,s-1,o,n),...C.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return C.searchHightBitFromStart(e,t,0,ht,n)}static getAllInitializedTickArrayInfo(e,t,n,i,o){let s=[],a=C.getAllInitializedTickArrayStartIndex(n,i,o);for(let u of a){let{publicKey:c}=ne(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>C.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===i)break}let u=H.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>C.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===i)break}let u=H.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<xe||e>Be}static nextInitTick(e,t,n,i,o){if(H.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(i)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<be;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=be-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<be;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let i=q.getSqrtPriceX64FromTick(t),o=q.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new v(1).div(o),tickSqrtPriceX64:i}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let i=n?t:new v(1).div(t),o=At.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=q.getSqrtPriceX64FromTick(o),a=q.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new v(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let i=q.getSqrtPriceX64FromTick(t),o=q.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new v(1).div(o),tickSqrtPriceX64:i}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let i=n?t:new v(1).div(t),o=At.getTickWithPriceAndTickspacing(i,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=q.getSqrtPriceX64FromTick(o),a=q.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new v(1).div(a)}}};var uf=L([Te(8),_("bump"),Kt("index"),x(""),Ce("protocolFeeRate"),Ce("tradeFeeRate"),Kt("tickSpacing"),O(b(),8,"")]),ua=L([Ce("blockTimestamp"),F("sqrtPriceX64"),F("cumulativeTimePriceX64"),O(F(),1,"")]),Tr=L([Te(8),Ne("initialized"),x("poolId"),O(ua,1e3,"observations"),O(F(),5,"")]),ca=L([_("rewardState"),b("openTime"),b("endTime"),b("lastUpdateTime"),F("emissionsPerSecondX64"),b("rewardTotalEmissioned"),b("rewardClaimed"),x("tokenMint"),x("tokenVault"),x("creator"),F("rewardGrowthGlobalX64")]),cf=L([Te(8),_("bump"),x("ammConfig"),x("creator"),x("mintA"),x("mintB"),x("vaultA"),x("vaultB"),x("observationId"),_("mintDecimalsA"),_("mintDecimalsB"),Kt("tickSpacing"),F("liquidity"),F("sqrtPriceX64"),we("tickCurrent"),Kt("observationIndex"),Kt("observationUpdateDuration"),F("feeGrowthGlobalX64A"),F("feeGrowthGlobalX64B"),b("protocolFeesTokenA"),b("protocolFeesTokenB"),F("swapInAmountTokenA"),F("swapOutAmountTokenB"),F("swapInAmountTokenB"),F("swapOutAmountTokenA"),_("status"),O(_(),7,""),O(ca,3,"rewardInfos"),O(b(),16,"tickArrayBitmap"),b("totalFeesTokenA"),b("totalFeesClaimedTokenA"),b("totalFeesTokenB"),b("totalFeesClaimedTokenB"),b("fundFeesTokenA"),b("fundFeesTokenB"),b("startTime"),O(b(),15*4-3,"padding")]),la=L([F("growthInsideLastX64"),b("rewardAmountOwed")]),Mi=L([Te(8),_("bump"),x("nftMint"),x("poolId"),we("tickLower"),we("tickUpper"),F("liquidity"),F("feeGrowthInsideLastX64A"),F("feeGrowthInsideLastX64B"),b("tokenFeesOwedA"),b("tokenFeesOwedB"),O(la,3,"rewardInfos"),O(b(),8,"")]),lf=L([Te(8),_("bump"),x("poolId"),we("tickLowerIndex"),we("tickUpperIndex"),F("liquidity"),F("feeGrowthInsideLastX64A"),F("feeGrowthInsideLastX64B"),b("tokenFeesOwedA"),b("tokenFeesOwedB"),O(F(),3,"rewardGrowthInside"),O(b(),8,"")]),ma=L([we("tick"),ci("liquidityNet"),F("liquidityGross"),F("feeGrowthOutsideX64A"),F("feeGrowthOutsideX64B"),O(F(),3,"rewardGrowthsOutsideX64"),O(Ce(),13,"")]),$t=L([Te(8),x("poolId"),we("startTickIndex"),O(ma,be,"ticks"),_("initializedTickCount"),O(_(),115,"")]),mf=L([Te(329),O(x(),100,"whitelistMints")]),Fi=L([Te(8),x("poolId"),O(O(b(),8),kr,"positiveTickArrayBitmap"),O(O(b(),8),kr,"negativeTickArrayBitmap")]);import{PublicKey as ya,Keypair as ga}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as wa}from"@solana/spl-token";import Cf from"bn.js";var vi=L([x("mint"),x("owner"),b("amount"),Ce("delegateOption"),x("delegate"),_("state"),Ce("isNativeOption"),b("isNative"),b("delegatedAmount"),Ce("closeAuthorityOption"),x("closeAuthority")]);function da(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function Pr(r,...e){if(!da(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function xr(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Vi(r,e){Pr(r);let t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var En=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Oe=(r,e)=>r<<32-e|r>>>e;var gf=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function pa(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function Ir(r){return typeof r=="string"&&(r=pa(r)),Pr(r),r}var Cn=class{clone(){return this._cloneInto()}},wf={}.toString;function Oi(r){let e=n=>r().update(Ir(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function fa(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let i=BigInt(32),o=BigInt(4294967295),s=Number(t>>i&o),a=Number(t&o),u=n?4:0,c=n?0:4;r.setUint32(e+u,s,n),r.setUint32(e+c,a,n)}var Wi=(r,e,t)=>r&e^~r&t,Di=(r,e,t)=>r&e^r&t^e&t,_n=class extends Cn{constructor(e,t,n,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=En(this.buffer)}update(e){xr(this);let{view:t,buffer:n,blockLen:i}=this;e=Ir(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(i-this.pos,o-s);if(a===i){let u=En(e);for(;i<=o-s;s+=i)this.process(u,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){xr(this),Vi(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:i,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(n,0),s=0);for(let m=s;m<i;m++)t[m]=0;fa(n,i-8,BigInt(this.length*8),o),this.process(n,0);let a=En(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let c=u/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<c;m++)a.setUint32(4*m,l[m],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:i,finished:o,destroyed:s,pos:a}=this;return e.length=i,e.pos=a,e.finished=o,e.destroyed=s,i%t&&e.buffer.set(n),e}};var ba=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),lt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),mt=new Uint32Array(64),Br=class extends _n{constructor(){super(64,32,8,!1),this.A=lt[0]|0,this.B=lt[1]|0,this.C=lt[2]|0,this.D=lt[3]|0,this.E=lt[4]|0,this.F=lt[5]|0,this.G=lt[6]|0,this.H=lt[7]|0}get(){let{A:e,B:t,C:n,D:i,E:o,F:s,G:a,H:u}=this;return[e,t,n,i,o,s,a,u]}set(e,t,n,i,o,s,a,u){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,t){for(let m=0;m<16;m++,t+=4)mt[m]=e.getUint32(t,!1);for(let m=16;m<64;m++){let d=mt[m-15],p=mt[m-2],y=Oe(d,7)^Oe(d,18)^d>>>3,f=Oe(p,17)^Oe(p,19)^p>>>10;mt[m]=f+mt[m-7]+y+mt[m-16]|0}let{A:n,B:i,C:o,D:s,E:a,F:u,G:c,H:l}=this;for(let m=0;m<64;m++){let d=Oe(a,6)^Oe(a,11)^Oe(a,25),p=l+d+Wi(a,u,c)+ba[m]+mt[m]|0,f=(Oe(n,2)^Oe(n,13)^Oe(n,22))+Di(n,i,o)|0;l=c,c=u,u=a,a=s+p|0,s=o,o=i,i=n,n=p+f|0}n=n+this.A|0,i=i+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,i,o,s,a,u,c,l)}roundClean(){mt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var qi=Oi(()=>new Br);var Ff=te("Raydium_Util");function Gi({fromPublicKey:r,programId:e=wa}){let t=ga.generate().publicKey.toBase58().slice(0,32);return{publicKey:ha(r,t,e),seed:t}}function ha(r,e,t){let n=Buffer.concat([r.toBuffer(),Buffer.from(e),t.toBuffer()]),i=qi(n);return new ya(i)}var zi=te("Raydium_Clmm"),De={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Mn=class{static createPoolInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y){let f=L([F("sqrtPriceX64"),b("startTime")]),g=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:Et.programId,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1}],w=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,startTime:y},w);let A=Buffer.from([...De.createPool,...w]);return new We({keys:g,programId:e,data:A})}static async createPoolInstructions(e){let{connection:t,programId:n,owner:i,mintA:o,mintB:s,ammConfigId:a,initialPriceX64:u,startTime:c,forerunCreate:l}=e,m=Gi({fromPublicKey:i,programId:n}),[d,p]=[new K(o.address),new K(s.address)],y=[Et.createAccountWithSeed({fromPubkey:i,basePubkey:i,seed:m.seed,newAccountPubkey:m.publicKey,lamports:l?0:await t.getMinimumBalanceForRentExemption(Tr.span),space:Tr.span,programId:n})],{publicKey:f}=Si(n,a,d,p),{publicKey:g}=gr(n,f,d),{publicKey:w}=gr(n,f,p);return y.push(this.createPoolInstruction(n,f,i,a,m.publicKey,d,g,new K(o.programId||he),p,w,new K(s.programId||he),ct(n,f).publicKey,u,c)),{signers:[],instructions:y,instructionTypes:[J.CreateAccount,J.ClmmCreatePool],address:{poolId:f,observationId:m.publicKey,mintAVault:g,mintBVault:w},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y,f,g,w,A,h,P,k,I,B,M,z,U){let X=L([we("tickLowerIndex"),we("tickUpperIndex"),we("tickArrayLowerStartIndex"),we("tickArrayUpperStartIndex"),F("liquidity"),b("amountMaxA"),b("amountMaxB"),Ne("withMetadata"),_("optionBaseFlag"),Ne("baseFlag")]),ae=[...U?[{pubkey:U,isSigner:!1,isWritable:!0}]:[]],se=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:Et.programId,isSigner:!1,isWritable:!1},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:Ui,isSigner:!1,isWritable:!1},{pubkey:Bt,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...ae],Z=Buffer.alloc(X.span);X.encode({tickLowerIndex:A,tickUpperIndex:h,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:k,liquidity:I,amountMaxA:B,amountMaxB:M,withMetadata:z==="create",baseFlag:!1,optionBaseFlag:0},Z);let re=Buffer.from([...De.openPosition,...Z]);return new We({keys:se,programId:e,data:re})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new K(e.programId),new K(e.id)],y;if(l)y=new K((await l(1))[0]);else{let M=Sr.generate();m.push(M),y=M.publicKey}let f=C.getTickArrayStartIndexByTick(i,e.config.tickSpacing),g=C.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=ne(d,p,f),{publicKey:A}=ne(d,p,g),{publicKey:h}=Ee(n.wallet,y,he),{publicKey:P}=Ln(y),{publicKey:k}=ze(d,y),{publicKey:I}=wt(d,p,i,o),B=this.openPositionFromLiquidityInstruction(d,n.feePayer,p,n.wallet,y,h,P,I,w,A,k,n.tokenAccountA,n.tokenAccountB,new K(t.vault.A),new K(t.vault.B),new K(e.mintA.address),new K(e.mintB.address),i,o,f,g,s,a,u,c);return{signers:m,instructions:[B],instructionTypes:[J.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:y,tickArrayLower:w,tickArrayUpper:A,positionNftAccount:h,metadataAccount:P,personalPosition:k,protocolPosition:I}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new K(e.programId),new K(e.id)],y;if(l)y=new K((await l(1))[0]);else{let M=Sr.generate();m.push(M),y=M.publicKey}let f=C.getTickArrayStartIndexByTick(i,e.config.tickSpacing),g=C.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=ne(d,p,f),{publicKey:A}=ne(d,p,g),{publicKey:h}=Ee(n.wallet,y,he),{publicKey:P}=Ln(y),{publicKey:k}=ze(d,y),{publicKey:I}=wt(d,p,i,o),B=this.openPositionFromBaseInstruction(d,n.feePayer,p,n.wallet,y,h,P,I,w,A,k,n.tokenAccountA,n.tokenAccountB,new K(t.vault.A),new K(t.vault.B),new K(e.mintA.address),new K(e.mintB.address),i,o,f,g,c,s,a,u,Se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,g])?ct(d,p).publicKey:void 0);return{address:{nftMint:y,tickArrayLower:w,tickArrayUpper:A,positionNftAccount:h,metadataAccount:P,personalPosition:k,protocolPosition:I},instructions:[B],signers:m,instructionTypes:[J.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y,f,g,w,A,h,P,k,I,B,M,z,U){let X=L([we("tickLowerIndex"),we("tickUpperIndex"),we("tickArrayLowerStartIndex"),we("tickArrayUpperStartIndex"),F("liquidity"),b("amountMaxA"),b("amountMaxB"),Ne("withMetadata"),_("optionBaseFlag"),Ne("baseFlag")]),ae=[...U?[{pubkey:U,isSigner:!1,isWritable:!0}]:[]],se=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:Et.programId,isSigner:!1,isWritable:!1},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:Ui,isSigner:!1,isWritable:!1},{pubkey:Bt,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...ae],Z=Buffer.alloc(X.span);X.encode({tickLowerIndex:A,tickUpperIndex:h,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:k,liquidity:new Xi(0),amountMaxA:B==="MintA"?M:z,amountMaxB:B==="MintA"?z:M,withMetadata:I==="create",baseFlag:B==="MintA",optionBaseFlag:1},Z);let re=Buffer.from([...De.openPosition,...Z]);return new We({keys:se,programId:e,data:re})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,d=[];if(l)m=new K((await l(1))[0]);else{let M=Sr.generate();d.push(M),m=M.publicKey}let[p,y]=[new K(e.programId),new K(e.id)],f=C.getTickArrayStartIndexByTick(i,e.config.tickSpacing),g=C.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=ne(p,y,f),{publicKey:A}=ne(p,y,g),{publicKey:h}=Ee(n.wallet,m,he),{publicKey:P}=Ln(m),{publicKey:k}=ze(p,m),{publicKey:I}=wt(p,y,i,o),B=this.openPositionFromLiquidityInstruction(p,n.wallet,y,n.wallet,m,h,P,I,w,A,k,n.tokenAccountA,n.tokenAccountB,new K(t.vault.A),new K(t.vault.B),new K(t.mintA.address),new K(t.mintB.address),i,o,f,g,s,a,u,c,Se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,g])?ct(p,y).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:w,tickArrayUpper:A,positionNftAccount:h,metadataAccount:P,personalPosition:k,protocolPosition:I},instructions:[B],signers:d,instructionTypes:[J.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,i,o){let s=L([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:Et.programId,isSigner:!1,isWritable:!1},{pubkey:he,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...De.closePosition,...u]);return new We({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:i}){let o=new K(e.programId),{publicKey:s}=Ee(n.wallet,i.nftMint,he),{publicKey:a}=ze(o,i.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,i.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[J.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y,f,g,w,A){let h=L([F("liquidity"),b("amountMaxA"),b("amountMaxB"),_("optionBaseFlag"),Ne("baseFlag")]),P=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...P],I=Buffer.alloc(h.span);h.encode({liquidity:f,amountMaxA:g,amountMaxB:w,optionBaseFlag:0,baseFlag:!1},I);let B=Buffer.from([...De.increaseLiquidity,...I]);return new We({keys:k,programId:e,data:B})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new K(e.programId),new K(e.id)],l=C.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=C.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=ne(u,c,l),{publicKey:p}=ne(u,c,m),{publicKey:y}=Ee(i.wallet,n.nftMint,he),{publicKey:f}=ze(u,n.nftMint),{publicKey:g}=wt(u,c,n.tickLower,n.tickUpper),w=this.increasePositionFromLiquidityInstruction(u,i.wallet,y,f,c,g,d,p,i.tokenAccountA,i.tokenAccountB,new K(t.vault.A),new K(t.vault.B),new K(e.mintA.address),new K(e.mintB.address),o,s,a,Se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?ct(u,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:y,personalPosition:f,protocolPosition:g},signers:[],instructions:[w],instructionTypes:[J.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new K(e.programId),new K(e.id)],l=C.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=C.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=ne(u,c,l),{publicKey:p}=ne(u,c,m),{publicKey:y}=Ee(i.wallet,n.nftMint,he),{publicKey:f}=ze(u,n.nftMint),{publicKey:g}=wt(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:y,personalPosition:f,protocolPosition:g},instructions:[this.increasePositionFromBaseInstruction(u,i.wallet,y,f,c,g,d,p,i.tokenAccountA,i.tokenAccountB,new K(t.vault.A),new K(t.vault.B),new K(e.mintA.address),new K(e.mintB.address),o,s,a,Se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?ct(u,c).publicKey:void 0)],signers:[],instructionTypes:[J.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y,f,g,w,A){let h=L([F("liquidity"),b("amountMaxA"),b("amountMaxB"),_("optionBaseFlag"),Ne("baseFlag")]),P=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...P],I=Buffer.alloc(h.span);h.encode({liquidity:new Xi(0),amountMaxA:f==="MintA"?g:w,amountMaxB:f==="MintA"?w:g,baseFlag:f==="MintA",optionBaseFlag:1},I);let B=Buffer.from([...De.increaseLiquidity,...I]);return new We({keys:k,programId:e,data:B})}static decreaseLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y,f,g,w,A,h){let P=L([F("liquidity"),b("amountMinA"),b("amountMinB")]),k=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[],...f.map(z=>[{pubkey:z.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:z.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:z.rewardMint,isSigner:!1,isWritable:!1}]).flat()],I=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:dn,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...k],B=Buffer.alloc(P.span);P.encode({liquidity:g,amountMinA:w,amountMinB:A},B);let M=Buffer.from([...De.decreaseLiquidity,...B]);return new We({keys:I,programId:e,data:M})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new K(e.programId),new K(e.id)],m=C.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=C.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=ne(c,l,m),{publicKey:y}=ne(c,l,d),{publicKey:f}=Ee(i.wallet,n.nftMint,u),{publicKey:g}=ze(c,n.nftMint),{publicKey:w}=wt(c,l,n.tickLower,n.tickUpper),A=[];for(let P=0;P<e.rewardDefaultInfos.length;P++)A.push({poolRewardVault:new K(t.rewardInfos[P].vault),ownerRewardVault:i.rewardAccounts[P],rewardMint:new K(e.rewardDefaultInfos[P].mint.address)});let h=[];return h.push(this.decreaseLiquidityInstruction(c,i.wallet,f,g,l,w,p,y,i.tokenAccountA,i.tokenAccountB,new K(t.vault.A),new K(t.vault.B),new K(e.mintA.address),new K(e.mintB.address),A,o,s,a,Se.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?ct(c,l).publicKey:void 0)),{address:{tickArrayLower:p,tickArrayUpper:y,positionNftAccount:f,personalPosition:g,protocolPosition:w},signers:[],instructions:h,instructionTypes:[J.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y,f,g,w){let A=L([b("amount"),b("otherAmountThreshold"),F("sqrtPriceLimitX64"),Ne("isBaseInput")]),h=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...m.map(B=>({pubkey:B,isSigner:!1,isWritable:!0}))],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:dn,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...h],k=Buffer.alloc(A.span);A.encode({amount:p,otherAmountThreshold:y,sqrtPriceLimitX64:f,isBaseInput:g},k);let I=Buffer.from([...De.swap,...k]);return new We({keys:P,programId:e,data:I})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,inputMint:i,amountIn:o,amountOutMin:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new K(e.programId),new K(e.id)],[m,d]=[new K(t.vault.A),new K(t.vault.B)],[p,y]=[new K(e.mintA.address),new K(e.mintB.address)],f=e.mintA.address===i.toString(),g=[this.swapInstruction(c,n.wallet,l,new K(e.config.id),f?n.tokenAccountA:n.tokenAccountB,f?n.tokenAccountB:n.tokenAccountA,f?m:d,f?d:m,f?p:y,f?y:p,u,m,o,s,a,!0,ct(c,l).publicKey)];return{signers:[],instructions:g,instructionTypes:[J.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,i,o,s,a,u,c,l,m,d){let p=L([b("openTime"),b("endTime"),F("emissionsPerSecondX64")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Et.programId,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:oe(l),endTime:oe(m),emissionsPerSecondX64:d},f);let g=Buffer.from([...De.initReward,...f]);return new We({keys:y,programId:e,data:g})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new K(e.programId),new K(e.id)],a=Ki(o,s,i.mint).publicKey,u=wr(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new K(e.config.id),n.tokenAccount,i.programId,i.mint,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[J.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,i,o,s,a,u,c,l,m,d){let p=L([_("rewardIndex"),F("emissionsPerSecondX64"),b("openTime"),b("endTime")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:oe(l),endTime:oe(m)},f);let g=Buffer.from([...De.setRewardEmissions,...f]);return new We({keys:y,programId:e,data:g})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new K(e.programId),new K(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===i.mint.toString()&&(a=d,u=new K(t.rewardInfos[d].vault),c=new K(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&zi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=wr(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new K(e.config.id),n.tokenAccount,u,c,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[J.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,i,o,s,a){let u=L([_("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:dn,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...De.collectReward,...l]);return new We({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:i}){let[o,s]=[new K(e.programId),new K(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===i.toString()&&(a=l,u=new K(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&zi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,i,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[J.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapBaseOutInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,outputMint:i,amountOut:o,amountInMax:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new K(e.programId),new K(e.id)],[m,d]=[new K(t.vault.A),new K(t.vault.B)],[p,y]=[new K(e.mintA.address),new K(e.mintB.address)],f=e.mintA.address===i.toString(),g=[this.swapInstruction(c,n.wallet,l,new K(e.config.id),f?n.tokenAccountB:n.tokenAccountA,f?n.tokenAccountA:n.tokenAccountB,f?d:m,f?m:d,f?p:y,f?y:p,u,m,o,s,a,!1)];return{signers:[],instructions:g,instructionTypes:[J.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}};import{PublicKey as Ta}from"@solana/web3.js";import{PublicKey as ka}from"@solana/web3.js";import Yi from"bn.js";var eb=new Yi(25),tb=new Yi(1e4);var Aa=te("Raydium_liquidity_serum");function ji({programId:r,marketId:e}){let t=[e.toBuffer()],n=0,i;for(;n<100;){try{let o=t.concat(Buffer.from([n]),Buffer.alloc(7));i=ka.createProgramAddressSync(o,r)}catch(o){if(o instanceof TypeError)throw o;n++;continue}return{publicKey:i,nonce:n}}throw Aa.logWithError("unable to find a viable program address nonce","params",{programId:r,marketId:e}),new Error("unable to find a viable program address nonce")}import kb from"bn.js";function Kr({programId:r}){let{publicKey:e}=me([Buffer.from("amm_config_account_seed","utf-8")],r);return e}function Tt({name:r,programId:e,marketId:t}){let{publicKey:n}=me([e.toBuffer(),t.toBuffer(),Buffer.from(r,"utf-8")],e);return n}function Pa({programId:r,marketId:e}){let{publicKey:t}=me([r.toBuffer(),e.toBuffer(),Buffer.from("open_order_associated_seed","utf-8")],r);return t}function xa({programId:r}){return me([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],r)}function Hi({version:r,marketVersion:e,marketId:t,baseMint:n,quoteMint:i,baseDecimals:o,quoteDecimals:s,programId:a,marketProgramId:u}){let c=Tt({name:"amm_associated_seed",programId:a,marketId:t}),l=Tt({name:"lp_mint_associated_seed",programId:a,marketId:t}),{publicKey:m,nonce:d}=xa({programId:a}),p=Tt({name:"coin_vault_associated_seed",programId:a,marketId:t}),y=Tt({name:"pc_vault_associated_seed",programId:a,marketId:t}),f=Tt({name:"temp_lp_token_associated_seed",programId:a,marketId:t}),g=Pa({programId:a,marketId:t}),w=Tt({name:"target_associated_seed",programId:a,marketId:t}),A=Tt({name:"withdraw_associated_seed",programId:a,marketId:t}),{publicKey:h}=ji({programId:u,marketId:t});return{id:c,baseMint:n,quoteMint:i,lpMint:l,baseDecimals:o,quoteDecimals:s,lpDecimals:o,version:r,programId:a,authority:m,nonce:d,baseVault:p,quoteVault:y,lpVault:f,openOrders:g,targetOrders:w,withdrawQueue:A,marketVersion:e,marketProgramId:u,marketId:t,marketAuthority:h,lookupTableAccount:Ta.default,configId:Kr({programId:a})}}import{PublicKey as Qi}from"@solana/web3.js";var Kb=te("Raydium_farm_config"),Lb=new Qi("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Nb=new Qi("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var Fn={"Standard SPL":0,"Option tokens":1},Zi={[gi.toString()]:3,[wi.toString()]:5,[hi.toString()]:6};var Na=L([_("instruction")]),Ra=L([_("instruction")]),Ca=L([b("rewardState"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardLastUpdateTime"),b("totalReward"),b("totalRewardEmissioned"),b("rewardClaimed"),b("rewardPerSecond"),F("accRewardPerShare"),x("rewardVault"),x("rewardMint"),x("rewardSender"),b("rewardType"),O(b(),15,"padding")]),Ea=L([b("state"),b("nonce"),x("lpVault"),x("rewardVault"),x(),x(),b(),b(),b("totalReward"),F("perShareReward"),b("lastSlot"),b("perSlotReward")]),_a=L([b("state"),b("nonce"),x("lpVault"),x("rewardVaultA"),b("totalRewardA"),F("perShareRewardA"),b("perSlotRewardA"),_("option"),x("rewardVaultB"),Te(7),b("totalRewardB"),F("perShareRewardB"),b("perSlotRewardB"),b("lastSlot"),x()]),Ma=L([b(),b("state"),b("nonce"),b("validRewardTokenNum"),F("rewardMultiplier"),b("rewardPeriodMax"),b("rewardPeriodMin"),b("rewardPeriodExtend"),x("lpMint"),x("lpVault"),O(Ca,5,"rewardInfos"),x("creator"),x(),O(b(),32,"padding")]),Ia=new Proxy(Ea,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return ee(Y({},i),{version:3,rewardInfos:[{rewardVault:i.rewardVault,totalReward:i.totalReward,perSlotReward:i.perSlotReward,perShareReward:i.perShareReward}]})}:Reflect.get(r,e,t)}}),Ba=new Proxy(_a,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return ee(Y({},i),{version:5,rewardInfos:[{rewardVault:i.rewardVaultA,totalReward:i.totalRewardA,perSlotReward:i.perSlotRewardA,perShareReward:i.perShareRewardA},{rewardVault:i.rewardVaultB,totalReward:i.totalRewardB,perSlotReward:i.perSlotRewardB,perShareReward:i.perShareRewardB}]})}:Reflect.get(r,e,t)}}),Sa=new Proxy(Ma,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return ee(Y({},i),{version:6,rewardInfos:i.rewardInfos.map(o=>{var s;return ee(Y({},o),{rewardType:((s=Object.entries(Fn).find(a=>String(a[1])===o.rewardType.toString()))!=null?s:["Standard SPL"])[0]})})})}:Reflect.get(r,e,t)}}),Fa=L([b("isSet"),b("rewardPerSecond"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardType")]),va=L([_("instruction"),b("nonce"),O(Fa,5,"rewardTimeInfo")]),Va=L([_("instruction"),b("rewardReopenTime"),b("rewardEndTime"),b("rewardPerSecond")]),Oa=L([_("instruction"),b("isSet"),b("rewardPerSecond"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardType")]),vb=L([b("state"),x("id"),x("owner"),b("deposited"),O(b(),1,"rewardDebts")]),$i=L([b("state"),x("id"),x("owner"),b("deposited"),O(F(),1,"rewardDebts"),b(""),b("voteLockedBalance"),O(b(),15)]),Vb=L([b("state"),x("id"),x("owner"),b("deposited"),O(b(),2,"rewardDebts")]),Ka=L([b("state"),x("id"),x("owner"),b("deposited"),O(F(),2,"rewardDebts"),O(b(),17)]),La=L([b(),b("state"),x("id"),x("owner"),b("deposited"),O(F(),5,"rewardDebts"),O(b(),16)]),Pt=L([_("instruction"),b("amount")]),Wa=L([x("mint"),x("grantAuthority"),b("baselineVoteWeightScaledFactor"),b("maxExtraLockupVoteWeightScaledFactor"),b("lockupSaturationSecs"),ui("digitShift"),O(_(),7,"reserved1"),O(b(),7,"reserved2")]),Da=L([Te(8),x("governanceProgramId"),x("realm"),x("realmGoverningTokenMint"),x("realmAuthority"),O(_(),32,"reserved1"),O(Wa,4,"votingMints"),kn("timeOffset"),_("bump"),O(_(),7,"reserved2"),O(b(),11,"reserved3")]),qa=L([kn("startTime"),kn("endTime"),_("kind"),O(_(),15,"reserved")]),Ga=L([O(qa,1,"lockup"),b("amountDeposited_native"),b("amountInitiallyLockedNative"),Ne("isUsed"),Ne("allowClawback"),_("votingMintConfigIdx"),O(_(),29,"reserved")]),Ua=L([Te(8),x("voterAuthority"),x("registrar"),O(Ga,32,"deposits"),_("voterBump"),_("voterWweightRecordBump"),O(_(),94,"reserved")]);import Xb from"bn.js";var iy=te("Raydium.farm.util");function vn({programId:r,poolId:e,owner:t,version:n}){let{publicKey:i}=me([e.toBuffer(),t.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],r);return i}import{PublicKey as Ie,SystemProgram as yy,SYSVAR_RENT_PUBKEY as gy,SYSVAR_CLOCK_PUBKEY as Ji,TransactionInstruction as Lr}from"@solana/web3.js";import{createAssociatedTokenAccountInstruction as ky,TOKEN_PROGRAM_ID as Nr,ASSOCIATED_TOKEN_PROGRAM_ID as Ay}from"@solana/spl-token";import Py from"bn.js";var My=te("Raydium_farm_instruction"),Fy={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function eo(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s}=r,[a,u]=[new Ie(e.programId),new Ie(e.id)],c=vn({programId:a,poolId:u,owner:o,version:6}),l=Buffer.alloc(Pt.span);Pt.encode({instruction:2,amount:oe(s)},l);let m=[S({pubkey:Nr,isWritable:!1}),S({pubkey:u}),S({pubkey:new Ie(t.authority),isWritable:!1}),S({pubkey:new Ie(t.lpVault)}),S({pubkey:c}),S({pubkey:o,isWritable:!1,isSigner:!0}),S({pubkey:n})];for(let d=0;d<t.rewardInfos.length;d++)m.push(S({pubkey:new Ie(t.rewardInfos[d].vault)})),m.push(S({pubkey:i[d]}));return new Lr({programId:a,keys:m,data:l})}function to(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s,userAuxiliaryLedgers:a}=r,[u,c]=[new Ie(e.programId),new Ie(e.id)],l=vn({programId:u,poolId:c,owner:o,version:5}),m=Buffer.alloc(Pt.span);Pt.encode({instruction:12,amount:oe(s)},m);let d=[S({pubkey:c}),S({pubkey:new Ie(t.authority),isWritable:!1}),S({pubkey:l}),S({pubkey:o,isWritable:!1,isSigner:!0}),S({pubkey:n}),S({pubkey:new Ie(t.lpVault)}),S({pubkey:i[0]}),S({pubkey:new Ie(t.rewardInfos[0].vault)}),S({pubkey:Ji,isWritable:!1}),S({pubkey:Nr,isWritable:!1})];for(let p=1;p<t.rewardInfos.length;p++)d.push(S({pubkey:i[p]})),d.push(S({pubkey:new Ie(t.rewardInfos[p].vault)}));if(a)for(let p of a)d.push(S({pubkey:p}));return new Lr({programId:u,keys:d,data:m})}function no(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s,userAuxiliaryLedgers:a}=r,[u,c]=[new Ie(e.programId),new Ie(e.id)],l=vn({programId:u,poolId:c,owner:o,version:3}),m=Buffer.alloc(Pt.span);Pt.encode({instruction:11,amount:oe(s)},m);let d=[S({pubkey:c}),S({pubkey:new Ie(t.authority),isWritable:!1}),S({pubkey:l}),S({pubkey:o,isWritable:!1,isSigner:!0}),S({pubkey:n}),S({pubkey:new Ie(t.lpVault)}),S({pubkey:i[0]}),S({pubkey:new Ie(t.rewardInfos[0].vault)}),S({pubkey:Ji,isWritable:!1}),S({pubkey:Nr,isWritable:!1})];if(a)for(let p of a)d.push(S({pubkey:p}));return new Lr({programId:u,keys:d,data:m})}import Qe from"bn.js";var Rr=class extends Ht{constructor(e){super(e)}async load(){this.checkDisabled()}computePairAmount({poolInfo:e,amount:t,slippage:n,baseIn:i}){let o=new Qe(new v(t).mul(10**e[i?"mintA":"mintB"].decimals).toFixed(0)),s=li(e[i?"mintB":"mintA"]),[a,u]=[new Qe(new v(e.mintAmountA).mul(10**e.mintA.decimals).toString()),new Qe(new v(e.mintAmountB).mul(10**e.mintB.decimals).toString())];this.logDebug("baseReserve:",a.toString(),"quoteReserve:",u.toString()),this.logDebug("tokenIn:",i?e.mintA.symbol:e.mintB.symbol,"amountIn:",o.toString(),"anotherToken:",i?e.mintB.symbol:e.mintA.symbol,"slippage:",`${n.toSignificant()}%`);let c=i?"base":"quote";this.logDebug("input side:",c);let l=Dt;o.isZero()||(l=c==="base"?gn(o.mul(u),a):gn(o.mul(a),u));let m=gn(o.mul(new Qe(e.lpAmount).mul(new Qe(10).pow(new Qe(e.lpMint.decimals)))),new Qe(c==="base"?e.mintAmountA:e.mintAmountB).mul(new Qe(10).pow(new Qe(e[c==="base"?"mintA":"mintB"].decimals)))),p=new Ge(yn).add(n).mul(l).quotient,y=new ce(s,l),f=new ce(s,p);return this.logDebug("anotherAmount:",y.toFixed(),"maxAnotherAmount:",f.toFixed()),{anotherAmount:y,maxAnotherAmount:f,liquidity:m}}async addLiquidity(e){let{poolInfo:t,amountInA:n,amountInB:i,fixedSide:o,config:s,txVersion:a}=e;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region");let u=this.scope.mintToTokenAmount({mint:St(t.mintA.address),amount:n.toString()}),c=this.scope.mintToTokenAmount({mint:St(t.mintB.address),amount:i.toString()});this.logDebug("amountInA:",u,"amountInB:",c),(u.isZero()||c.isZero())&&this.logAndCreateError("amounts must greater than zero","amountInA & amountInB",{amountInA:u.toFixed(),amountInB:c.toFixed()});let{account:l}=this.scope,{bypassAssociatedCheck:m,checkCreateATAOwner:d}=Y({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},s),[p,y]=[u.token,c.token],f=await l.getCreatedTokenAccount({mint:p.mint,associatedOnly:!1}),g=await l.getCreatedTokenAccount({mint:y.mint,associatedOnly:!1});!f&&!g&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",l.tokenAccounts);let w=await l.getCreatedTokenAccount({mint:new pt(t.lpMint.address)}),A=[p,y],h=[f,g],P=[u.raw,c.raw],k=u.token.mint.toBase58()===t.mintA.address?"base":"quote",I="base";["quote","base"].includes(k)||this.logAndCreateError("invalid fixedSide","fixedSide",o),k==="quote"?(A.reverse(),h.reverse(),P.reverse(),I=o==="a"?"quote":"base"):k==="base"&&(I=o==="a"?"base":"quote");let[B,M]=A,[z,U]=h,[X,ae]=P,se=await this.scope.api.fetchPoolKeysById({id:t.id}),Z=this.createTxBuilder(),tn=await l.handleTokenAccount({side:"in",amount:X,mint:B.mint,tokenAccount:z,bypassAssociatedCheck:m,checkCreateATAOwner:d}),{tokenAccount:re}=tn,j=Fe(tn,["tokenAccount"]);Z.addInstruction(j);let _t=await l.handleTokenAccount({side:"in",amount:ae,mint:M.mint,tokenAccount:U,bypassAssociatedCheck:m,checkCreateATAOwner:d}),{tokenAccount:et}=_t,On=Fe(_t,["tokenAccount"]);Z.addInstruction(On);let Mt=await l.handleTokenAccount({side:"out",amount:0,mint:new pt(t.lpMint.address),tokenAccount:w,bypassAssociatedCheck:m,checkCreateATAOwner:d}),{tokenAccount:Wn}=Mt,ft=Fe(Mt,["tokenAccount"]);return Z.addInstruction(ft),Z.addInstruction({instructions:[Ti({poolInfo:t,poolKeys:se,userKeys:{baseTokenAccount:re,quoteTokenAccount:et,lpTokenAccount:Wn,owner:this.scope.ownerPubKey},baseAmountIn:X,quoteAmountIn:ae,fixedSide:I})],instructionTypes:[t.pooltype.includes("StablePool")?J.AmmV5AddLiquidity:J.AmmV4AddLiquidity],lookupTableAddress:se.lookupTableAccount?[se.lookupTableAccount]:[]}),a===0&&await Z.buildV0(),Z.build()}async removeLiquidity(e){this.scope.availability.removeStandardPosition===!1&&this.logAndCreateError("remove liquidity feature disabled in your region");let{poolInfo:t,amountIn:n,config:i,txVersion:o}=e,s=await this.scope.api.fetchPoolKeysById({id:t.id}),[a,u,c]=[new pt(t.mintA.address),new pt(t.mintB.address),new pt(t.lpMint.address)];this.logDebug("amountIn:",n),n.isZero()&&this.logAndCreateError("amount must greater than zero","amountIn",n.toString());let{account:l}=this.scope,m=await l.getCreatedTokenAccount({mint:c,associatedOnly:!1});m||this.logAndCreateError("cannot found lpTokenAccount","tokenAccounts",l.tokenAccounts);let d=await l.getCreatedTokenAccount({mint:a}),p=await l.getCreatedTokenAccount({mint:u}),y=this.createTxBuilder(),{bypassAssociatedCheck:f,checkCreateATAOwner:g}=Y({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},i),k=await l.handleTokenAccount({side:"out",amount:0,mint:a,tokenAccount:d,bypassAssociatedCheck:f,checkCreateATAOwner:g}),{tokenAccount:w}=k,A=Fe(k,["tokenAccount"]);y.addInstruction(A);let I=await l.handleTokenAccount({side:"out",amount:0,mint:u,tokenAccount:p,bypassAssociatedCheck:f,checkCreateATAOwner:g}),{tokenAccount:h}=I,P=Fe(I,["tokenAccount"]);return y.addInstruction(P),y.addInstruction({instructions:[fr({poolInfo:t,poolKeys:s,userKeys:{lpTokenAccount:m,baseTokenAccount:w,quoteTokenAccount:h,owner:this.scope.ownerPubKey},amountIn:n})],lookupTableAddress:s.lookupTableAccount?[s.lookupTableAccount]:[],instructionTypes:[t.pooltype.includes("StablePool")?J.AmmV5RemoveLiquidity:J.AmmV4RemoveLiquidity]}),o===0?await y.buildV0():y.build()}async removeAllLpAndCreateClmmPosition({poolInfo:e,clmmPoolInfo:t,removeLpAmount:n,createPositionInfo:i,farmInfo:o,userFarmLpAmount:s,base:a,computeBudgetConfig:u,payer:c,tokenProgram:l=Vn,checkCreateATAOwner:m=!0,getEphemeralSigners:d,txVersion:p}){if((this.scope.availability.removeStandardPosition===!1||this.scope.availability.createConcentratedPosition===!1)&&this.logAndCreateError("remove liquidity or create position feature disabled in your region"),!(e.mintA.address===t.mintA.address||e.mintA.address===t.mintB.address)||!(e.mintB.address===t.mintA.address||e.mintB.address===t.mintB.address))throw Error("mint check error");let y=this.createTxBuilder();y.addCustomComputeBudget(u);let f={};for(let Z of this.scope.account.tokenAccountRawInfos)(f[Z.accountInfo.mint.toString()]===void 0||Ee(this.scope.ownerPubKey,Z.accountInfo.mint,Vn).publicKey.equals(Z.pubkey))&&(f[Z.accountInfo.mint.toString()]=Z.pubkey);let g=f[e.lpMint.address];if(g===void 0)throw Error("find lp account error in trade accounts");let w=n.add(s!=null?s:new Qe(0)),A=e.mintA.address===Ae.WSOL.mint.toString(),h=e.mintB.address===Ae.WSOL.mint.toString(),{account:P,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:Vn,mint:new pt(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:A?{payer:this.scope.ownerPubKey}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:!0,checkCreateATAOwner:m});if(y.addInstruction(k||{}),P===void 0)throw new Error("base token account not found");let{account:I,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:Vn,mint:new pt(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:h?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:!0,checkCreateATAOwner:m});if(y.addInstruction(B||{}),I===void 0)throw new Error("quote token account not found");if(f[e.mintA.address]=P,f[e.mintB.address]=I,o!==void 0&&!(s!=null&&s.isZero())){let Z=[];for(let ft of o.rewardInfos){let tn=ft.mint.address===Ae.WSOL.mint.toString();if(f[ft.mint.address])Z.push(f[ft.mint.address]);else{let{account:_t,instructionParams:Mt}=await this.scope.account.getOrCreateTokenAccount({mint:new pt(ft.mint.address),tokenProgram:l,owner:this.scope.ownerPubKey,skipCloseAccount:!tn,createInfo:{payer:c||this.scope.ownerPubKey},associatedOnly:!0,checkCreateATAOwner:m});_t||this.logAndCreateError("farm reward account not found:",ft.mint.address),Mt&&y.addInstruction(Mt),Z.push(_t)}}let re=(await this.scope.api.fetchFarmKeysById({ids:o.id}))[0],j={amount:s,owner:this.scope.ownerPubKey,farmInfo:o,farmKeys:re,lpAccount:g,rewardAccounts:Z},et=Zi[o.programId],On=et===6?eo(j):et===5?to(j):no(j),Wn={3:J.FarmV3Withdraw,5:J.FarmV5Withdraw,6:J.FarmV6Withdraw};y.addInstruction({instructions:[On],instructionTypes:[Wn[et]]})}let M=await this.scope.api.fetchPoolKeysById({id:e.id}),z=fr({poolInfo:e,poolKeys:M,userKeys:{lpTokenAccount:g,baseTokenAccount:P,quoteTokenAccount:I,owner:this.scope.ownerPubKey},amountIn:w});y.addInstruction({instructions:[z],instructionTypes:[e.pooltype.includes("StablePool")?J.AmmV5RemoveLiquidity:J.AmmV4RemoveLiquidity],lookupTableAddress:M.lookupTableAccount?[M.lookupTableAccount]:[]});let[U,X]=e.mintA.address===t.mintA.address?[P,I]:[I,P],ae=await this.scope.api.fetchPoolKeysById({id:t.id}),se=await Mn.openPositionFromBaseInstructions(ee(Y({poolInfo:t,poolKeys:ae,ownerInfo:{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:U,tokenAccountB:X},withMetadata:"create"},i),{base:a,getEphemeralSigners:d}));return y.addInstruction({instructions:[...se.instructions],signers:se.signers,instructionTypes:[...se.instructionTypes],lookupTableAddress:ae.lookupTableAccount?[ae.lookupTableAccount]:[]}),p===0?y.sizeCheckBuildV0():y.sizeCheckBuild()}async createPoolV4({programId:e,marketInfo:t,baseMintInfo:n,quoteMintInfo:i,baseAmount:o,quoteAmount:s,startTime:a,ownerInfo:u,associatedOnly:c=!1,checkCreateATAOwner:l=!1,tokenProgram:m,txVersion:d,feeDestinationId:p,computeBudgetConfig:y}){var X;let f=u.feePayer||((X=this.scope.owner)==null?void 0:X.publicKey),g=u.useSOLBalance&&n.mint.equals(ro),w=u.useSOLBalance&&i.mint.equals(ro),A=this.createTxBuilder(),{account:h,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({mint:n.mint,owner:this.scope.ownerPubKey,createInfo:g?{payer:f,amount:o}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:c,checkCreateATAOwner:l});A.addInstruction(P||{});let{account:k,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({mint:i.mint,owner:this.scope.ownerPubKey,createInfo:w?{payer:f,amount:s}:void 0,notUseTokenAccount:w,skipCloseAccount:!w,associatedOnly:w?!1:c,checkCreateATAOwner:l});if(A.addInstruction(I||{}),h===void 0||k===void 0)throw Error("you don't has some token account");let B=Hi({version:4,marketVersion:3,marketId:t.marketId,baseMint:n.mint,quoteMint:i.mint,baseDecimals:n.decimals,quoteDecimals:i.decimals,programId:e,marketProgramId:t.programId}),M={programId:e,ammId:B.id,ammAuthority:B.authority,ammOpenOrders:B.openOrders,lpMint:B.lpMint,coinMint:B.baseMint,pcMint:B.quoteMint,coinVault:B.baseVault,pcVault:B.quoteVault,withdrawQueue:B.withdrawQueue,ammTargetOrders:B.targetOrders,poolTempLp:B.lpVault,marketProgramId:B.marketProgramId,marketId:B.marketId,ammConfigId:B.configId,feeDestinationId:p},{instruction:z,instructionType:U}=Pi(ee(Y({},M),{userWallet:this.scope.ownerPubKey,userCoinVault:h,userPcVault:k,userLpVault:Ee(this.scope.ownerPubKey,B.lpMint,m).publicKey,nonce:B.nonce,openTime:a,coinAmount:o,pcAmount:s}));return A.addInstruction({instructions:[z],instructionTypes:[U]}),A.addCustomComputeBudget(y),A.versionBuild({txVersion:d,extInfo:{address:M}})}async getCreatePoolFee({programId:e}){let t=Kr({programId:e}),n=await this.scope.connection.getAccountInfo(t,{dataSlice:{offset:536,length:8}});if(n===null)throw Error("get config account error");return Ai.decode(n.data).fee}};export{Rr as default};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=liquidity.mjs.map