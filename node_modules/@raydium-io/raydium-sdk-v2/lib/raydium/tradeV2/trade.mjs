var Kr=Object.defineProperty,Cr=Object.defineProperties;var Nr=Object.getOwnPropertyDescriptors;var jt=Object.getOwnPropertySymbols;var ki=Object.prototype.hasOwnProperty,hi=Object.prototype.propertyIsEnumerable;var wi=(i,e,t)=>e in i?Kr(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Q=(i,e)=>{for(var t in e||(e={}))ki.call(e,t)&&wi(i,t,e[t]);if(jt)for(var t of jt(e))hi.call(e,t)&&wi(i,t,e[t]);return i},ne=(i,e)=>Cr(i,Nr(e));var Jt=(i,e)=>{var t={};for(var n in i)ki.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&jt)for(var n of jt(i))e.indexOf(n)<0&&hi.call(i,n)&&(t[n]=i[n]);return t};import{PublicKey as ta}from"@solana/web3.js";import{createTransferInstruction as na}from"@solana/spl-token";import{get as Ai,set as Lr}from"lodash";import Ti from"dayjs";import Rr from"dayjs/plugin/utc";Ti.extend(Rr);var Sn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Ti().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Pi={},Or={};function se(i){let e=Ai(Pi,i);if(!e){let t=Ai(Or,i);e=new Sn({name:i,logLevel:t}),Lr(Pi,i,e)}return e}import{PublicKey as Xo}from"@solana/web3.js";import zo from"bn.js";import qo from"big.js";import mn from"bn.js";import Be from"bn.js";var gt=9e15,ot=1e9,Kn="0123456789abcdef",en="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",tn="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Cn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-gt,maxE:gt,crypto:!1},Si,He,E=!0,rn="[DecimalError] ",rt=rn+"Invalid argument: ",Ki=rn+"Precision limit exceeded",Ci=rn+"crypto unavailable",Ni="[object Decimal]",we=Math.floor,me=Math.pow,Mr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Fr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Er=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Li=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Me=1e7,L=7,Wr=9007199254740991,vr=en.length-1,Nn=tn.length-1,A={toStringTag:Ni};A.absoluteValue=A.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),N(i)};A.ceil=function(){return N(new this.constructor(this),this.e+1,2)};A.clampedTo=A.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(rt+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};A.comparedTo=A.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};A.cosine=A.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+L,n.rounding=1,t=Dr(n,Ei(n,t)),n.precision=i,n.rounding=e,N(He==2||He==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};A.cubeRoot=A.cbrt=function(){var i,e,t,n,r,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(E=!1,o=l.s*me(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=fe(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=me(t,1/3),i=we((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=ee(c.plus(l).times(a),c.plus(u),s+2,1),fe(a.d).slice(0,s)===(t=fe(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(N(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(N(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return E=!0,N(n,i,m.rounding,e)};A.decimalPlaces=A.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-we(this.e/L))*L,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};A.dividedBy=A.div=function(i){return ee(this,new this.constructor(i))};A.dividedToIntegerBy=A.divToInt=function(i){var e=this,t=e.constructor;return N(ee(e,new t(i),0,1,1),t.precision,t.rounding)};A.equals=A.eq=function(i){return this.cmp(i)===0};A.floor=function(){return N(new this.constructor(this),this.e+1,3)};A.greaterThan=A.gt=function(i){return this.cmp(i)>0};A.greaterThanOrEqualTo=A.gte=function(i){var e=this.cmp(i);return e==1||e===0};A.hyperbolicCosine=A.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/sn(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=wt(s,1,o.times(e),new s(1),!0);for(var u,c=i,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return N(o,s.precision=t,s.rounding=n,!0)};A.hyperbolicSine=A.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=wt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/sn(5,i)),r=wt(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,N(r,e,t,!0)};A.hyperbolicTangent=A.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,ee(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};A.inverseCosine=A.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Oe(t,r,o):new t(0):new t(NaN):e.isZero()?Oe(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Oe(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};A.inverseHyperbolicCosine=A.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,E=!1,t=t.times(t).minus(1).sqrt().plus(t),E=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};A.inverseHyperbolicSine=A.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,E=!1,t=t.times(t).plus(1).sqrt().plus(t),E=!0,n.precision=i,n.rounding=e,t.ln())};A.inverseHyperbolicTangent=A.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?N(new o(r),i,e,!0):(o.precision=t=n-r.e,r=ee(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};A.inverseSine=A.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Oe(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};A.inverseTangent=A.atan=function(){var i,e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=Nn)return s=Oe(l,m+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=Nn)return s=Oe(l,m+4,d).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/L+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(E=!1,e=Math.ceil(a/L),n=1,u=c.times(c),s=new l(c),r=c;i!==-1;)if(r=r.times(u),o=s.minus(r.div(n+=2)),r=r.times(u),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),E=!0,N(s,l.precision=m,l.rounding=d,!0)};A.isFinite=function(){return!!this.d};A.isInteger=A.isInt=function(){return!!this.d&&we(this.e/L)>this.d.length-2};A.isNaN=function(){return!this.s};A.isNegative=A.isNeg=function(){return this.s<0};A.isPositive=A.isPos=function(){return this.s>0};A.isZero=function(){return!!this.d&&this.d[0]===0};A.lessThan=A.lt=function(i){return this.cmp(i)<0};A.lessThanOrEqualTo=A.lte=function(i){return this.cmp(i)<1};A.logarithm=A.log=function(i){var e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding,p=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(E=!1,a=m+p,s=it(c,a),n=e?nn(l,a+10):it(i,a),u=ee(s,n,a,1),Nt(u.d,r=m,d))do if(a+=10,s=it(c,a),n=e?nn(l,a+10):it(i,a),u=ee(s,n,a,1),!o){+fe(u.d).slice(r+1,r+15)+1==1e14&&(u=N(u,m+1,0));break}while(Nt(u.d,r+=10,d));return E=!0,N(u,m,d)};A.minus=A.sub=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,p=this,b=p.constructor;if(i=new b(i),!p.d||!i.d)return!p.s||!i.s?i=new b(NaN):p.d?i.s=-i.s:i=new b(i.d||p.s!==i.s?p:NaN),i;if(p.s!=i.s)return i.s=-i.s,p.plus(i);if(c=p.d,d=i.d,a=b.precision,u=b.rounding,!c[0]||!d[0]){if(d[0])i.s=-i.s;else if(c[0])i=new b(p);else return new b(u===3?-0:0);return E?N(i,a,u):i}if(t=we(i.e/L),l=we(p.e/L),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=d.length):(e=d,t=l,s=c.length),n=Math.max(Math.ceil(a/L),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){m=c[n]<d[n];break}o=0}for(m&&(e=c,c=d,d=e,i.s=-i.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(r=n;r&&c[--r]===0;)c[r]=Me-1;--c[r],c[n]+=Me}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=on(c,t),E?N(i,a,u):i):new b(u===3?-0:0)};A.modulo=A.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?N(new n(t),n.precision,n.rounding):(E=!1,n.modulo==9?(e=ee(t,i.abs(),0,3,1),e.s*=i.s):e=ee(t,i,0,n.modulo,1),e=e.times(i),E=!0,t.minus(e))};A.naturalExponential=A.exp=function(){return Ln(this)};A.naturalLogarithm=A.ln=function(){return it(this)};A.negated=A.neg=function(){var i=new this.constructor(this);return i.s=-i.s,N(i)};A.plus=A.add=function(i){var e,t,n,r,o,s,a,u,c,l,m=this,d=m.constructor;if(i=new d(i),!m.d||!i.d)return!m.s||!i.s?i=new d(NaN):m.d||(i=new d(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(c=m.d,l=i.d,a=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(i=new d(m)),E?N(i,a,u):i;if(o=we(m.e/L),n=we(i.e/L),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/L),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=c.length,r=l.length,s-r<0&&(r=s,t=l,l=c,c=t),e=0;r;)e=(c[--r]=c[r]+l[r]+e)/Me|0,c[r]%=Me;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=on(c,n),E?N(i,a,u):i};A.precision=A.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(rt+i);return t.d?(e=Ri(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};A.round=function(){var i=this,e=i.constructor;return N(new e(i),i.e+1,e.rounding)};A.sine=A.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+L,n.rounding=1,t=_r(n,Ei(n,t)),n.precision=i,n.rounding=e,N(He>2?t.neg():t,i,e,!0)):new n(NaN)};A.squareRoot=A.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(E=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=fe(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=we((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(ee(s,o,t+2,1)).times(.5),fe(o.d).slice(0,t)===(e=fe(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(N(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(N(n,u+1,1),i=!n.times(n).eq(s));break}return E=!0,N(n,u,l.rounding,i)};A.tangent=A.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=ee(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,N(He==2||He==4?t.neg():t,i,e,!0)):new n(NaN)};A.times=A.mul=function(i){var e,t,n,r,o,s,a,u,c,l=this,m=l.constructor,d=l.d,p=(i=new m(i)).d;if(i.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!i.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?i.s/0:i.s*0);for(t=we(l.e/L)+we(i.e/L),u=d.length,c=p.length,u<c&&(o=d,d=p,p=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)a=o[r]+p[n]*d[r-n-1]+e,o[r--]=a%Me|0,e=a/Me|0;o[r]=(o[r]+e)%Me|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=on(o,t),E?N(i,m.precision,m.rounding):i};A.toBinary=function(i,e){return On(this,2,i,e)};A.toDecimalPlaces=A.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(xe(i,0,ot),e===void 0?e=n.rounding:xe(e,0,8),N(t,i+t.e+1,e))};A.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=ve(n,!0):(xe(i,0,ot),e===void 0?e=r.rounding:xe(e,0,8),n=N(new r(n),i+1,e),t=ve(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};A.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=ve(r):(xe(i,0,ot),e===void 0?e=o.rounding:xe(e,0,8),n=N(new o(r),i+r.e+1,e),t=ve(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};A.toFraction=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,p=this,b=p.d,f=p.constructor;if(!b)return new f(p);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=Ri(b)-p.e-1,s=o%L,e.d[0]=me(10,s<0?L+s:s),i==null)i=o>0?e:c;else{if(a=new f(i),!a.isInt()||a.lt(c))throw Error(rt+a);i=a.gt(e)?o>0?e:c:a}for(E=!1,a=new f(fe(b)),l=f.precision,f.precision=o=b.length*L*2;m=ee(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(m.times(r)),u=r,r=e,e=a.minus(m.times(r)),a=r;return r=ee(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=p.s,d=ee(c,n,o,1).minus(p).abs().cmp(ee(u,t,o,1).minus(p).abs())<1?[c,n]:[u,t],f.precision=l,E=!0,d};A.toHexadecimal=A.toHex=function(i,e){return On(this,16,i,e)};A.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:xe(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(E=!1,t=ee(t,i,0,e,1).times(i),E=!0,N(t)):(i.s=t.s,t=i),t};A.toNumber=function(){return+this};A.toOctal=function(i,e){return On(this,8,i,e)};A.toPower=A.pow=function(i){var e,t,n,r,o,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(me(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,i.eq(1))return N(a,n,o);if(e=we(i.e/L),e>=i.d.length-1&&(t=c<0?-c:c)<=Wr)return r=Oi(u,a,t,n),i.s<0?new u(1).div(r):N(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=me(+a,c),e=t==0||!isFinite(t)?we(c*(Math.log("0."+fe(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(E=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=Ln(i.times(it(a,n+t)),n),r.d&&(r=N(r,n+5,1),Nt(r.d,n,o)&&(e=n+10,r=N(Ln(i.times(it(a,e+t)),e),e+5,1),+fe(r.d).slice(n+1,n+15)+1==1e14&&(r=N(r,n+1,0)))),r.s=s,E=!0,u.rounding=o,N(r,n,o))};A.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=ve(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(xe(i,1,ot),e===void 0?e=r.rounding:xe(e,0,8),n=N(new r(n),i,e),t=ve(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};A.toSignificantDigits=A.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(xe(i,1,ot),e===void 0?e=n.rounding:xe(e,0,8)),N(new n(t),i,e)};A.toString=function(){var i=this,e=i.constructor,t=ve(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};A.truncated=A.trunc=function(){return N(new this.constructor(this),this.e+1,1)};A.valueOf=A.toJSON=function(){var i=this,e=i.constructor,t=ve(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function fe(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=L-n.length,t&&(o+=nt(t)),o+=n;s=i[e],n=s+"",t=L-n.length,t&&(o+=nt(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function xe(i,e,t){if(i!==~~i||i<e||i>t)throw Error(rt+i)}function Nt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=L,r=0):(r=Math.ceil((e+1)/L),e%=L),o=me(10,L-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==me(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==me(10,e-3)-1,s}function $t(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=Kn.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function Dr(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/sn(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=wt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var ee=function(){function i(n,r,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*r+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=r[a]){u=n[a]>r[a]?1:-1;break}return u}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,u){var c,l,m,d,p,b,f,y,g,P,k,T,h,B,I,O,X,F,U,le,oe=n.constructor,Pe=n.s==r.s?1:-1,G=n.d,Z=r.d;if(!G||!G[0]||!Z||!Z[0])return new oe(!n.s||!r.s||(G?Z&&G[0]==Z[0]:!Z)?NaN:G&&G[0]==0||!Z?Pe*0:Pe/0);for(u?(p=1,l=n.e-r.e):(u=Me,p=L,l=we(n.e/p)-we(r.e/p)),U=Z.length,X=G.length,g=new oe(Pe),P=g.d=[],m=0;Z[m]==(G[m]||0);m++);if(Z[m]>(G[m]||0)&&l--,o==null?(B=o=oe.precision,s=oe.rounding):a?B=o+(n.e-r.e)+1:B=o,B<0)P.push(1),b=!0;else{if(B=B/p+2|0,m=0,U==1){for(d=0,Z=Z[0],B++;(m<X||d)&&B--;m++)I=d*u+(G[m]||0),P[m]=I/Z|0,d=I%Z|0;b=d||m<X}else{for(d=u/(Z[0]+1)|0,d>1&&(Z=i(Z,d,u),G=i(G,d,u),U=Z.length,X=G.length),O=U,k=G.slice(0,U),T=k.length;T<U;)k[T++]=0;le=Z.slice(),le.unshift(0),F=Z[0],Z[1]>=u/2&&++F;do d=0,c=e(Z,k,U,T),c<0?(h=k[0],U!=T&&(h=h*u+(k[1]||0)),d=h/F|0,d>1?(d>=u&&(d=u-1),f=i(Z,d,u),y=f.length,T=k.length,c=e(f,k,y,T),c==1&&(d--,t(f,U<y?le:Z,y,u))):(d==0&&(c=d=1),f=Z.slice()),y=f.length,y<T&&f.unshift(0),t(k,f,T,u),c==-1&&(T=k.length,c=e(Z,k,U,T),c<1&&(d++,t(k,U<T?le:Z,T,u))),T=k.length):c===0&&(d++,k=[0]),P[m++]=d,c&&k[0]?k[T++]=G[O]||0:(k=[G[O]],T=1);while((O++<X||k[0]!==void 0)&&B--);b=k[0]!==void 0}P[0]||P.shift()}if(p==1)g.e=l,Si=b;else{for(m=1,d=P[0];d>=10;d/=10)m++;g.e=m+l*p-1,N(g,a?o+g.e+1:o,s,b)}return g}}();function N(i,e,t,n){var r,o,s,a,u,c,l,m,d,p=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=L,s=e,l=m[d=0],u=l/me(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/L),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=u=0,r=1,o%=L,s=o-L+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=L,s=o-L+r,u=s<0?0:l/me(10,r-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%me(10,r-s-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/me(10,r-s):0:m[d-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=i.e+1,m[0]=me(10,(L-e%L)%L),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=me(10,L-o),m[d]=s>0?(l/me(10,r-s)%me(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==Me&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=Me)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return E&&(i.e>p.maxE?(i.d=null,i.e=NaN):i.e<p.minE&&(i.e=0,i.d=[0])),i}function ve(i,e,t){if(!i.isFinite())return Fi(i);var n,r=i.e,o=fe(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+nt(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+nt(-r-1)+o,t&&(n=t-s)>0&&(o+=nt(n))):r>=s?(o+=nt(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+nt(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=nt(n))),o}function on(i,e){var t=i[0];for(e*=L;t>=10;t/=10)e++;return e}function nn(i,e,t){if(e>vr)throw E=!0,t&&(i.precision=t),Error(Ki);return N(new i(en),e,1,!0)}function Oe(i,e,t){if(e>Nn)throw Error(Ki);return N(new i(tn),e,t,!0)}function Ri(i){var e=i.length-1,t=e*L+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function nt(i){for(var e="";i--;)e+="0";return e}function Oi(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/L+4);for(E=!1;;){if(t%2&&(o=o.times(e),Bi(o.d,s)&&(r=!0)),t=we(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Bi(e.d,s)}return E=!0,o}function xi(i){return i.d[i.d.length-1]&1}function Mi(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function Ln(i,e){var t,n,r,o,s,a,u,c=0,l=0,m=0,d=i.constructor,p=d.rounding,b=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(E=!1,u=b):u=e,a=new d(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(me(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=N(o.times(i),u,1),t=t.times(++l),a=s.plus(ee(o,t,u,1)),fe(a.d).slice(0,u)===fe(s.d).slice(0,u)){for(r=m;r--;)s=N(s.times(s),u,1);if(e==null)if(c<3&&Nt(s.d,u-n,p,c))d.precision=u+=10,t=o=a=new d(1),l=0,c++;else return N(s,d.precision=b,p,E=!0);else return d.precision=b,s}s=a}}function it(i,e){var t,n,r,o,s,a,u,c,l,m,d,p=1,b=10,f=i,y=f.d,g=f.constructor,P=g.rounding,k=g.precision;if(f.s<0||!y||!y[0]||!f.e&&y[0]==1&&y.length==1)return new g(y&&!y[0]?-1/0:f.s!=1?NaN:y?0:f);if(e==null?(E=!1,l=k):l=e,g.precision=l+=b,t=fe(y),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=fe(f.d),n=t.charAt(0),p++;o=f.e,n>1?(f=new g("0."+t),o++):f=new g(n+"."+t.slice(1))}else return c=nn(g,l+2,k).times(o+""),f=it(new g(n+"."+t.slice(1)),l-b).plus(c),g.precision=k,e==null?N(f,k,P,E=!0):f;for(m=f,u=s=f=ee(f.minus(1),f.plus(1),l,1),d=N(f.times(f),l,1),r=3;;){if(s=N(s.times(d),l,1),c=u.plus(ee(s,new g(r),l,1)),fe(c.d).slice(0,l)===fe(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(nn(g,l+2,k).times(o+""))),u=ee(u,new g(p),l,1),e==null)if(Nt(u.d,l-b,P,a))g.precision=l+=b,c=s=f=ee(m.minus(1),m.plus(1),l,1),d=N(f.times(f),l,1),r=a=1;else return N(u,g.precision=k,P,E=!0);else return g.precision=k,u;u=c,r+=2}}function Fi(i){return String(i.s*i.s/0)}function Rn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%L,t<0&&(n+=L),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=L;n<r;)i.d.push(+e.slice(n,n+=L));e=e.slice(n),n=L-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),E&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function Vr(i,e){var t,n,r,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Li.test(e))return Rn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(Fr.test(e))t=16,e=e.toLowerCase();else if(Mr.test(e))t=2;else if(Er.test(e))t=8;else throw Error(rt+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=Oi(n,new n(t),o,o*2)),c=$t(e,t,Me),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=on(c,l),i.d=c,E=!1,s&&(i=ee(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?me(2,u):Lt.pow(2,u))),E=!0,i)}function _r(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:wt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/sn(5,t)),e=wt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function wt(i,e,t,n,r){var o,s,a,u,c=1,l=i.precision,m=Math.ceil(l/L);for(E=!1,u=t.times(t),a=new i(n);;){if(s=ee(a.times(u),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=ee(s.times(u),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return E=!0,s.d.length=m+1,s}function sn(i,e){for(var t=i;--e;)t*=i;return t}function Ei(i,e){var t,n=e.s<0,r=Oe(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return He=n?4:1,e;if(t=e.divToInt(r),t.isZero())He=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return He=xi(t)?n?2:3:n?4:1,e;He=xi(t)?n?1:4:n?3:2}return e.minus(r).abs()}function On(i,e,t,n){var r,o,s,a,u,c,l,m,d,p=i.constructor,b=t!==void 0;if(b?(xe(t,1,ot),n===void 0?n=p.rounding:xe(n,0,8)):(t=p.precision,n=p.rounding),!i.isFinite())l=Fi(i);else{for(l=ve(i),s=l.indexOf("."),b?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=$t(ve(d),10,r),d.e=d.d.length),m=$t(l,10,r),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=b?"0p+0":"0";else{if(s<0?o--:(i=new p(i),i.d=m,i.e=o,i=ee(i,d,t,n,0,r),m=i.d,o=i.e,c=Si),s=m[t],a=r/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,c)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=Kn.charAt(m[s]);if(b){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=$t(l,r,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=Kn.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function Bi(i,e){if(i.length>e)return i.length=e,!0}function qr(i){return new this(i).abs()}function Gr(i){return new this(i).acos()}function Ur(i){return new this(i).acosh()}function Xr(i,e){return new this(i).plus(e)}function zr(i){return new this(i).asin()}function Qr(i){return new this(i).asinh()}function Hr(i){return new this(i).atan()}function Yr(i){return new this(i).atanh()}function Zr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Oe(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Oe(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Oe(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(ee(i,e,o,1)),e=Oe(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(ee(i,e,o,1)),t}function jr(i){return new this(i).cbrt()}function Jr(i){return N(i=new this(i),i.e+1,2)}function $r(i,e,t){return new this(i).clamp(e,t)}function eo(i){if(!i||typeof i!="object")throw Error(rn+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,ot,"rounding",0,8,"toExpNeg",-gt,0,"toExpPos",0,gt,"maxE",0,gt,"minE",-gt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=Cn[t]),(n=i[t])!==void 0)if(we(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(rt+t+": "+n);if(t="crypto",r&&(this[t]=Cn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Ci);else this[t]=!1;else throw Error(rt+t+": "+n);return this}function to(i){return new this(i).cos()}function no(i){return new this(i).cosh()}function Wi(i){var e,t,n;function r(o){var s,a,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,Ii(o)){c.s=o.s,E?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;E?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return Rn(c,o.toString())}else if(u!=="string")throw Error(rt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),Li.test(o)?Rn(c,o):Vr(c,o)}if(r.prototype=A,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=eo,r.clone=Wi,r.isDecimal=Ii,r.abs=qr,r.acos=Gr,r.acosh=Ur,r.add=Xr,r.asin=zr,r.asinh=Qr,r.atan=Hr,r.atanh=Yr,r.atan2=Zr,r.cbrt=jr,r.ceil=Jr,r.clamp=$r,r.cos=to,r.cosh=no,r.div=io,r.exp=ro,r.floor=oo,r.hypot=so,r.ln=ao,r.log=uo,r.log10=lo,r.log2=co,r.max=mo,r.min=po,r.mod=fo,r.mul=bo,r.pow=yo,r.random=go,r.round=wo,r.sign=ko,r.sin=ho,r.sinh=Ao,r.sqrt=Po,r.sub=To,r.sum=xo,r.tan=Bo,r.tanh=Io,r.trunc=So,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function io(i,e){return new this(i).div(e)}function ro(i){return new this(i).exp()}function oo(i){return N(i=new this(i),i.e+1,3)}function so(){var i,e,t=new this(0);for(E=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return E=!0,new this(1/0);t=e}return E=!0,t.sqrt()}function Ii(i){return i instanceof Lt||i&&i.toStringTag===Ni||!1}function ao(i){return new this(i).ln()}function uo(i,e){return new this(i).log(e)}function co(i){return new this(i).log(2)}function lo(i){return new this(i).log(10)}function mo(){return Mi(this,arguments,"lt")}function po(){return Mi(this,arguments,"gt")}function fo(i,e){return new this(i).mod(e)}function bo(i,e){return new this(i).mul(e)}function yo(i,e){return new this(i).pow(e)}function go(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:xe(i,1,ot),n=Math.ceil(i/L),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(Ci);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=L,n&&i&&(r=me(10,L-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=L)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<L&&(t-=L-n)}return s.e=t,s.d=a,s}function wo(i){return N(i=new this(i),i.e+1,this.rounding)}function ko(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function ho(i){return new this(i).sin()}function Ao(i){return new this(i).sinh()}function Po(i){return new this(i).sqrt()}function To(i,e){return new this(i).sub(e)}function xo(){var i=0,e=arguments,t=new this(e[i]);for(E=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return E=!0,N(t,this.precision,this.rounding)}function Bo(i){return new this(i).tan()}function Io(i){return new this(i).tanh()}function So(i){return N(i=new this(i),i.e+1,1)}A[Symbol.for("nodejs.util.inspect.custom")]=A.toString;A[Symbol.toStringTag]="Decimal";var Lt=A.constructor=Wi(Cn);en=new Lt(en);tn=new Lt(tn);var R=Lt;import{PublicKey as En}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ko}from"@solana/spl-token";import{PublicKey as re,SystemProgram as Co,SYSVAR_RENT_PUBKEY as No}from"@solana/web3.js";function _({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var da=[_({pubkey:Ko,isWritable:!1}),_({pubkey:Co.programId,isWritable:!1}),_({pubkey:No,isWritable:!1})];function Mn({publicKey:i,transformSol:e}){let t=Fn(i.toString());if(t instanceof re)return e&&t.equals(De)?lt:t;if(e&&t.toString()===De.toBase58())return lt;if(typeof t=="string"){if(t===re.default.toBase58())return re.default;try{return new re(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Fn(i){try{return new re(i)}catch{return i}}var kt=new re("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ht=new re("SysvarRent111111111111111111111111111111111"),pa=new re("SysvarC1ock11111111111111111111111111111111"),At=new re("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),fa=new re("Sysvar1nstructions1111111111111111111111111"),ba=new re("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ya=new re("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ga=new re("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),wa=new re("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),ka=new re("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),ha=new re("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Aa=new re("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Pa=new re("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ta=new re("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),xa=new re("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ba=new re("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),lt=new re("So11111111111111111111111111111111111111112"),De=re.default;function Rt(i){return Mn({publicKey:i,transformSol:!0})}import{PublicKey as Lo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as vi}from"@solana/spl-token";var an={chainId:101,address:Lo.default.toBase58(),programId:vi.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Ye={chainId:101,address:"So11111111111111111111111111111111111111112",programId:vi.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Wn=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===De.toBase58()||e instanceof En&&De.equals(e)){this.decimals=Ye.decimals,this.symbol=Ye.symbol,this.name=Ye.name,this.mint=new En(Ye.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?En.default:Mn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ke=Wn;Ke.WSOL=new Wn(ne(Q({},Ye),{mint:Ye.address}));import cn from"big.js";import Mo from"bn.js";import Fo from"decimal.js-light";import Ro from"toformat";var Oo=Ro,Ot=Oo;var un=se("module/fraction"),vn=Ot(cn),Mt=Ot(Fo),Eo={[0]:Mt.ROUND_DOWN,[1]:Mt.ROUND_HALF_UP,[2]:Mt.ROUND_UP},Wo={[0]:cn.roundDown,[1]:cn.roundHalfUp,[2]:cn.roundUp},j=class{constructor(e,t=new Mo(1)){this.numerator=ie(e),this.denominator=ie(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new j(this.denominator,this.numerator)}add(e){let t=e instanceof j?e:new j(ie(e));return this.denominator.eq(t.denominator)?new j(this.numerator.add(t.numerator),this.denominator):new j(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof j?e:new j(ie(e));return this.denominator.eq(t.denominator)?new j(this.numerator.sub(t.numerator),this.denominator):new j(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof j?e:new j(ie(e));return new j(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof j?e:new j(ie(e));return new j(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||un.logWithError(`${e} is not an integer.`),e<=0&&un.logWithError(`${e} is not positive.`),Mt.set({precision:e+1,rounding:Eo[n]});let r=new Mt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||un.logWithError(`${e} is not an integer.`),e<0&&un.logWithError(`${e} is negative.`),vn.DP=e,vn.RM=Wo[n]||1,new vn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Do=se("Raydium_price"),Ne=class extends j{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new j(Dn(n.decimals),Dn(r.decimals))}get raw(){return new j(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Ne({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Do.logWithError("mul token not equals");let n=super.mul(t);return new Ne({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var Vn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},ln=Vn;ln.SOL=new Vn(an);import Vo from"bn.js";var Di=new j(new Vo(100)),Ze=class extends j{toSignificant(e=5,t,n){return this.mul(Di).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Di).toFixed(e,t,n)}};var Ft=new Be(0),_o=new Be(1),Au=new Be(2),Pu=new Be(3),Tu=new Be(5),_n=new Be(10),xu=new Be(100),Bu=new Be(1e3),Iu=new Be(1e4),Vi=9007199254740991;function ie(i){let e=se("Raydium_parseBigNumberish");if(i instanceof Be)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Be(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=Vi||i<=-Vi)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Be(String(i))):typeof i=="bigint"?new Be(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Be(0))}function Dn(i){return _n.pow(ie(i))}var Go=se("Raydium_amount"),qi=Ot(qo);function Uo(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):Go.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var be=class extends j{constructor(t,n,r=!0,o){let s=new mn(0),a=_n.pow(new mn(t.decimals));if(r)s=ie(n);else{let u=new mn(0),c=new mn(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=Uo(n.toString(),t.decimals);u=ie(l),c=ie(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=se(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new be(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new be(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return qi.DP=this.token.decimals,new qi(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};function _i(i){return typeof i=="object"&&i!==null&&![Ke,be,Xo,j,zo,Ne,Ze].some(e=>typeof e=="object"&&i instanceof e)}function Ve(i){return typeof i=="string"?Fn(i):Array.isArray(i)?i.map(e=>Ve(e)):_i(i)?Object.fromEntries(Object.entries(i).map(([e,t])=>[e,Ve(t)])):i}import{PublicKey as vt,sendAndConfirmTransaction as zn,Transaction as Dt,TransactionMessage as Vt,VersionedTransaction as _t}from"@solana/web3.js";import $o from"axios";var J={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw"};import{PublicKey as Qo,ComputeBudgetProgram as Gi,Transaction as Xi,TransactionMessage as Ho,Keypair as zi,VersionedTransaction as Qi}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Yo}from"@solana/spl-token";var Ui=se("Raydium_txUtil"),Hi=1644;function Pt(i){let e=[],t=[];return i.microLamports&&(e.push(Gi.setComputeUnitPrice({microLamports:i.microLamports})),t.push(J.SetComputeUnitPrice)),i.units&&(e.push(Gi.setComputeUnitLimit({units:i.units})),t.push(J.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Tt(i){var e,t;try{return((t=await((e=i.getLatestBlockhash)==null?void 0:e.call(i)))==null?void 0:t.blockhash)||(await i.getRecentBlockhash()).blockhash}catch{return(await i.getRecentBlockhash()).blockhash}}function xt(i,e){i.length<1&&Ui.logWithError(`no instructions provided: ${i.toString()}`),e.length<1&&Ui.logWithError(`no signers provided:, ${e.toString()}`);let t=new Xi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...i);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Hi}catch{return!1}}function Le(i,e){let[t,n]=Qo.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function Et({instructions:i,payer:e,signers:t}){return xt(i,[e,...t])}function Wt({instructions:i,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=zi.generate().publicKey.toString()}){let o=new Ho({payerKey:e,recentBlockhash:n,instructions:i}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Qi(o).serialize()).toString("base64").length<Hi}catch{return!1}}var Zo=i=>Buffer.isBuffer(i)?i:i instanceof Uint8Array?Buffer.from(i.buffer,i.byteOffset,i.byteLength):Buffer.from(i);function mt(i){let e=[];return i.forEach(t=>{t instanceof Xi&&(t.recentBlockhash||(t.recentBlockhash=Yo.toBase58()),t.feePayer||(t.feePayer=zi.generate().publicKey));let n=t.serialize({requireAllSignatures:!1,verifySignatures:!1});t instanceof Qi&&(n=Zo(n));let r=n.toString("base64");e.push(r)}),console.log("simulate tx string:",e),e}import{PublicKey as Yi,AddressLookupTableAccount as dn}from"@solana/web3.js";import{PublicKey as jo}from"@solana/web3.js";import{getTransferFeeConfig as pc,unpackMint as fc}from"@solana/spl-token";var qn=se("Raydium_accountInfo_util");async function st(i,e,t){let{batchRequest:n,commitment:r="confirmed"}=Q({batchRequest:!1},t),o=Gn(e,100),s=new Array(o.length).fill([]);if(n){let a=o.map(l=>{let m=i._buildArgs([l.map(d=>d.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:m}}),u=Gn(a,10);s=(await(await Promise.all(u.map(async l=>await i._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&qn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(m=>{if(m){let{data:d,executable:p,lamports:b,owner:f,rentEpoch:y}=m;return d.length!==2&&d[1]!=="base64"&&qn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:p,lamports:b,owner:new jo(f),rentEpoch:y}}return null})))}else try{s=await Promise.all(o.map(a=>i.getMultipleAccountsInfo(a,r)))}catch(a){a instanceof Error&&qn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function Un(i,e,t){let n=await st(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>ne(Q({},r),{accountInfo:n[o]}))}async function Xn({connection:i,address:e}){let t=await st(i,[...new Set(e.map(r=>r.toString()))].map(r=>new Yi(r))),n={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new dn({key:s,state:dn.deserialize(o.data)});n[s.toString()]=a,pn[s.toString()]=a}return n}var pn={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new dn({key:new Yi("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:dn.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var fn=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await $o.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=Pt(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==vt.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(Q({},t||{})):this.build(t)}build(e){let t=new Dt;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async()=>{var r;let n=await Tt(this.connection);if(t.recentBlockhash=n,this.signers.length&&t.sign(...this.signers),mt([t]),(r=this.owner)!=null&&r.isKeyPair)return{txId:await zn(this.connection,t,this.signers),signedTx:t};if(this.signAllTransactions){let o=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(o[0].serialize(),{skipPreflight:!0}),signedTx:o[0]}}throw new Error("please connect wallet first")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:r}=this.build(n),o=t.filter(c=>c.transaction.instructions.length>0),s=[r,...o.map(c=>c.transaction)],a=[this.signers,...o.map(c=>c.signers)],u=[...this.instructionTypes,...o.map(c=>c.instructionTypes).flat()];return{builder:this,transactions:s,signers:a,instructionTypes:u,execute:async c=>{var p;let{sequentially:l,onTxUpdate:m}=c||{},d=await Tt(this.connection);if((p=this.owner)!=null&&p.isKeyPair)return{txIds:await await Promise.all(s.map(async(b,f)=>(b.recentBlockhash=d,await zn(this.connection,b,a[f])))),signedTxs:s};if(this.signAllTransactions){let b=s.map((y,g)=>(y.recentBlockhash=d,a[g].length&&y.sign(...a[g]),y));mt(b);let f=await this.signAllTransactions(b);if(l){let y=0,g=[],P=async()=>{if(!f[y])return;let k=await this.connection.sendRawTransaction(f[y].serialize(),{skipPreflight:!0});g.push({txId:k,status:"sent"}),m==null||m([...g]),y++,this.connection.onSignature(k,T=>{let h=g.findIndex(B=>B.txId===k);h>-1&&(g[h].status=T.err?"error":"success"),m==null||m([...g]),P()},"processed"),this.connection.getSignatureStatus(k)};return await P(),{txIds:g.map(k=>k.txId),signedTxs:f}}else{let y=[];for(let g=0;g<f.length;g+=1){let P=await this.connection.sendRawTransaction(f[g].serialize(),{skipPreflight:!0});y.push(P)}return{txIds:y,signedTxs:f}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){let d=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:r}=d,o=Jt(d,["lookupTableCache","lookupTableAddress","forerunCreate"]),s=Q(Q({},pn),t),a=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let p of a)s[p]===void 0&&u.push(new vt(p));let c=await Xn({connection:this.connection,address:u});for(let[p,b]of Object.entries(c))s[p]=b;let l=new Vt({payerKey:this.feePayer,recentBlockhash:r?vt.default.toBase58():await Tt(this.connection),instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s)),m=new _t(l);return m.sign(this.signers),{builder:this,transaction:m,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async()=>{var p;if(mt([m]),(p=this.owner)!=null&&p.isKeyPair)return m.sign([this.owner.signer]),{txId:await this.connection.sendTransaction(m,{skipPreflight:!0}),signedTx:m};if(this.signAllTransactions){let b=await this.signAllTransactions([m]);return{txId:await this.connection.sendTransaction(b[0],{skipPreflight:!0}),signedTx:b[0]}}throw new Error("please connect wallet first")},extInfo:o||{}}}async buildV0MultiTx(e){let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:r}=await this.buildV0(n),o=t.filter(c=>c.builder.instructions.length>0),s=[r,...o.map(c=>c.transaction)],a=[this.signers,...o.map(c=>c.signers)],u=[...this.instructionTypes,...o.map(c=>c.instructionTypes).flat()];return s.forEach(async(c,l)=>{c.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:u,buildProps:n,execute:async c=>{var d;mt(s);let{sequentially:l,onTxUpdate:m}=c||{};if((d=this.owner)!=null&&d.isKeyPair)return s.forEach(p=>p.sign([this.owner.signer])),{txIds:await Promise.all(s.map(async p=>await this.connection.sendTransaction(p))),signedTxs:s};if(this.signAllTransactions){let p=await this.signAllTransactions(s);if(l){let b=0,f=[],y=async()=>{if(!p[b])return;let g=await this.connection.sendTransaction(p[b],{skipPreflight:!0});f.push({txId:g,status:"sent"}),m==null||m([...f]),b++,this.connection.onSignature(g,P=>{let k=f.findIndex(T=>T.txId===g);k>-1&&(f[k].status=P.err?"error":"success"),m==null||m([...f]),y()},"processed"),this.connection.getSignatureStatus(g)};return y(),{txIds:[],signedTxs:p}}else{let b=[];for(let f=0;f<p.length;f+=1){let y=await this.connection.sendTransaction(p[f],{skipPreflight:!0});b.push(y)}return{txIds:b,signedTxs:p}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async sizeCheckBuild(e){let c=e||{},{autoComputeBudget:t=!1}=c,n=Jt(c,["autoComputeBudget"]),r={instructions:[],instructionTypes:[]};if(t){let l=t?await this.getComputeBudgetConfig():void 0;r=t&&l?Pt(l):{instructions:[],instructionTypes:[]}}let o=this.signers.reduce((l,m)=>ne(Q({},l),{[m.publicKey.toBase58()]:m}),{}),s=[],a=[],u=[];if(this.allInstructions.forEach(l=>{let m=[...u,l],d=t?[...r.instructions,...m]:m,b=[...new Set(m.map(f=>f.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(f=>new vt(f));if(u.length<12&&Et({instructions:d,payer:this.feePayer,signers:b})||Et({instructions:m,payer:this.feePayer,signers:b}))u.push(l);else{if(u.length===0)throw Error("item ins too big");Et({instructions:t?[...r.instructions,...u]:[...u],payer:this.feePayer,signers:b})?s.push(new Dt().add(...r.instructions,...u)):s.push(new Dt().add(...u)),a.push(Array.from(new Set(u.map(f=>f.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat())).map(f=>o[f]).filter(f=>f!==void 0)),u=[l]}}),u.length>0){let m=[...new Set(u.map(d=>d.keys.filter(p=>p.isSigner).map(p=>p.pubkey.toString())).flat()).values()].map(d=>o[d]).filter(d=>d!==void 0);Et({instructions:t?[...r.instructions,...u]:[...u],payer:this.feePayer,signers:m.map(d=>d.publicKey)})?s.push(new Dt().add(...r.instructions,...u)):s.push(new Dt().add(...u)),a.push(m)}return s.forEach(l=>l.feePayer=this.feePayer),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async l=>{var b;let{sequentially:m,onTxUpdate:d}=l||{},p=await Tt(this.connection);if(s.forEach(async(f,y)=>{f.recentBlockhash=p,a[y].length&&f.sign(...a[y])}),mt(s),(b=this.owner)!=null&&b.isKeyPair)return{txIds:await Promise.all(s.map(async(f,y)=>await zn(this.connection,f,a[y]))),signedTxs:s};if(this.signAllTransactions){let f=await this.signAllTransactions(s);if(m){let y=0,g=[],P=async()=>{if(!f[y])return;let k=await this.connection.sendRawTransaction(f[y].serialize(),{skipPreflight:!0});g.push({txId:k,status:"sent"}),d==null||d([...g]),y++,this.connection.onSignature(k,T=>{let h=g.findIndex(B=>B.txId===k);h>-1&&(g[h].status=T.err?"error":"success"),d==null||d([...g]),P()},"processed"),this.connection.getSignatureStatus(k)};return await P(),{txIds:g.map(k=>k.txId),signedTxs:f}}else{let y=[];for(let g=0;g<f.length;g+=1){let P=await this.connection.sendRawTransaction(f[g].serialize(),{skipPreflight:!0});y.push(P)}return{txIds:y,signedTxs:f}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async sizeCheckBuildV0(e){let y=e||{},{autoComputeBudget:t=!1,lookupTableCache:n={},lookupTableAddress:r=[]}=y,o=Jt(y,["autoComputeBudget","lookupTableCache","lookupTableAddress"]),s=Q(Q({},pn),n),a=Array.from(new Set([...this.lookupTableAddress,...r])),u=[];for(let g of a)s[g]===void 0&&u.push(new vt(g));let c=await Xn({connection:this.connection,address:u});for(let[g,P]of Object.entries(c))s[g]=P;let l={instructions:[],instructionTypes:[]};if(t){let g=t?await this.getComputeBudgetConfig():void 0;l=t&&g?Pt(g):{instructions:[],instructionTypes:[]}}let m=await Tt(this.connection),d=this.signers.reduce((g,P)=>ne(Q({},g),{[P.publicKey.toBase58()]:P}),{}),p=[],b=[],f=[];if(this.allInstructions.forEach(g=>{let P=[...f,g],k=t?[...l.instructions,...P]:P;if(f.length<12&&Wt({instructions:k,payer:this.feePayer,lookupTableAddressAccount:s})||Wt({instructions:P,payer:this.feePayer,lookupTableAddressAccount:s}))f.push(g);else{if(f.length===0)throw Error("item ins too big");let T={};for(let h of[...new Set(a)])s[h]!==void 0&&(T[h]=s[h]);if(t&&Wt({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let h=new Vt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new _t(h))}else{let h=new Vt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new _t(h))}b.push(Array.from(new Set(f.map(h=>h.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat())).map(h=>d[h]).filter(h=>h!==void 0)),f=[g]}}),f.length>0){let P=[...new Set(f.map(k=>k.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat()).values()].map(k=>d[k]).filter(k=>k!==void 0);if(t&&Wt({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let k=new Vt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new _t(k))}else{let k=new Vt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new _t(k))}b.push(P)}return{builder:this,transactions:p,buildProps:e,signers:b,instructionTypes:this.instructionTypes,execute:async g=>{var T;let{sequentially:P,onTxUpdate:k}=g||{};if(p.map(async(h,B)=>{b[B].length&&h.sign(b[B])}),mt(p),(T=this.owner)!=null&&T.isKeyPair)return{txIds:await Promise.all(p.map(async h=>await this.connection.sendTransaction(h,{skipPreflight:!0}))),signedTxs:p};if(this.signAllTransactions){let h=await this.signAllTransactions(p);if(P){let B=0,I=[],O=async()=>{if(!h[B])return;let X=await this.connection.sendTransaction(h[B],{skipPreflight:!0});I.push({txId:X,status:"sent"}),k==null||k([...I]),B++,this.connection.onSignature(X,F=>{let U=I.findIndex(le=>le.txId===X);U>-1&&(I[U].status=F.err?"error":"success"),k==null||k([...I]),O()},"processed"),this.connection.getSignatureStatus(X)};return O(),{txIds:[],signedTxs:h}}else{let B=[];for(let I=0;I<h.length;I+=1){let O=await this.connection.sendTransaction(h[I],{skipPreflight:!0});B.push(O)}return{txIds:B,signedTxs:h}}}throw new Error("please connect wallet first")},extInfo:o||{}}}};function Gn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Ie}from"@solana/web3.js";var Ec=new Ie("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Wc=new Ie("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),vc=new Ie("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Dc=new Ie("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Vc=new Ie("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),_c=new Ie("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),qc=new Ie("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Gc=new Ie("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Uc=new Ie("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Xc=new Ie("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),zc=new Ie("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Qc=new Ie("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Hc=new Ie("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Yc=new Ie("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi");import{PublicKey as es}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ts}from"@solana/spl-token";function _e(i,e,t){return Le([i.toBuffer(),(t!=null?t:ts).toBuffer(),e.toBuffer()],new es("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import ue from"bn.js";var qe=1e4;function qt(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=t.epoch<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new ue(r.maximumFee.toString()),s=t.epoch<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(r.transferFeeBasisPoints===qe){let a=new ue(r.maximumFee.toString());return{amount:i.add(a),fee:a,expirationTime:s}}else{let a=Bt(i.mul(new ue(qe)),new ue(qe-r.transferFeeBasisPoints)),u=new ue(r.maximumFee.toString()),c=a.sub(i).gt(u)?i.add(u):a,l=Bt(c.mul(new ue(r.transferFeeBasisPoints)),new ue(qe)),m=l.gt(o)?o:l;return{amount:c,fee:m,expirationTime:s}}else{let a=Bt(i.mul(new ue(r.transferFeeBasisPoints)),new ue(qe)),u=a.gt(o)?o:a;return{amount:i,fee:u,expirationTime:s}}}function ke(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=ne(Q({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new ue(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===qe){let u=new ue(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:a}}else{let u=Bt(i.mul(new ue(qe)),new ue(qe-o.transferFeeBasisPoints)),c=new ue(o.maximumFee.toString()),l=u.sub(i).gt(c)?i.add(c):u,m=Bt(l.mul(new ue(o.transferFeeBasisPoints)),new ue(qe)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let u=Bt(i.mul(new ue(o.transferFeeBasisPoints)),new ue(qe)),c=u.gt(s)?s:u;return{amount:i,fee:c,expirationTime:a}}}function dt(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function Bt(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new ue(0))?t.add(new ue(1)):t}var Qn=(...i)=>i.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),It=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=se(t)}createTxBuilder(e){return this.scope.checkOwner(),new fn({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Qn(e))}logInfo(...e){this.logger.info(Qn(e))}logAndCreateError(...e){let t=Qn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{TOKEN_PROGRAM_ID as Xs,TOKEN_2022_PROGRAM_ID as di}from"@solana/spl-token";import{PublicKey as In,TransactionInstruction as zs,SystemProgram as Gf}from"@solana/web3.js";import pi from"bn.js";import{PublicKey as Kp}from"@solana/web3.js";import Ge from"bn.js";var ce=new Ge(0),Se=new Ge(1),je=new Ge(-1),Ce=new Ge(1).shln(64),bn=new Ge(1).shln(128),Hn=Ce.sub(Se),Gt=64,Zi=bn.subn(1),he=-443636,Te=-he,Je=new Ge("4295048016"),$e=new Ge("79226673521066979257578248091"),ji=16,Ji="59543866431248",$i="184467440737095516",er="15793534762490258745",yn=new Ge(10).pow(new Ge(6));var Bl=new Ge("18446744073700000000");import q from"bn.js";function gn(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Yn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Zn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Ut(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function tr(i,e){return Ut(i,e)?null:Yn(i,e)}function nr(i,e){return Ut(i,e)?null:Zn(i,e)}var Ll=Buffer.from("amm_config","utf8"),ns=Buffer.from("pool","utf8"),is=Buffer.from("pool_vault","utf8"),rs=Buffer.from("pool_reward_vault","utf8"),ir=Buffer.from("position","utf8"),os=Buffer.from("tick_array","utf8"),ss=Buffer.from("operation","utf8"),as=Buffer.from("pool_tick_array_bitmap_extension","utf8");function rr(i,e,t,n){return Le([ns,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function jn(i,e,t){return Le([is,e.toBuffer(),t.toBuffer()],i)}function or(i,e,t){return Le([rs,e.toBuffer(),t.toBuffer()],i)}function $(i,e,t){return Le([os,e.toBuffer(),gn(t)],i)}function pt(i,e,t,n){return Le([ir,e.toBuffer(),gn(t),gn(n)],i)}function Ue(i,e){return Le([ir,e.toBuffer()],i)}function wn(i){return Le([Buffer.from("metadata","utf8"),At.toBuffer(),i.toBuffer()],At)}function kn(i){return Le([ss],i)}function Xe(i,e){return Le([as,e.toBuffer()],i)}import{PublicKey as fr}from"@solana/web3.js";import ae from"bn.js";import Bs from"bn.js";import{PublicKey as ys}from"@solana/web3.js";import cr,{isBN as lr}from"bn.js";import{bits as Ml,BitStructure as Fl,blob as us,Blob as El,cstr as Wl,f32 as vl,f32be as Dl,f64 as Vl,f64be as _l,greedy as ql,Layout as cs,ns64 as Gl,ns64be as Ul,nu64 as Xl,nu64be as zl,offset as Ql,s16 as Hl,s16be as Yl,s24 as Zl,s24be as jl,s32 as ls,s32be as Jl,s40 as $l,s40be as em,s48 as tm,s48be as nm,s8 as im,seq as ms,struct as rm,Structure as ds,u16 as ps,u16be as om,u24 as sm,u24be as am,u32 as um,u32be as cm,u40 as lm,u40be as mm,u48 as dm,u48be as pm,u8 as fs,UInt as bs,union as fm,Union as bm,unionLayoutDiscriminator as ym,utf8 as gm}from"@solana/buffer-layout";var Jn=cs,sr=ds;var $n=bs;var ar=fs,St=ps;var ye=ls;var ur=ms;var Re=us;var Xt=class extends Jn{constructor(t,n,r){super(t,r);this.blob=Re(t),this.signed=n}decode(t,n=0){let r=new cr(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new cr(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function H(i){return new $n(1,i)}function et(i){return new $n(4,i)}function w(i){return new Xt(8,!1,i)}function W(i){return new Xt(16,!1,i)}function mr(i){return new Xt(16,!0,i)}var hn=class extends Jn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function M(i){return new hn(Re(32),e=>new ys(e),e=>e.toBuffer(),i)}function ze(i){return new hn(ar(),gs,ws,i)}function gs(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function ws(i){return i?1:0}var ei=class extends sr{decode(e,t){return super.decode(e,t)}};function v(i,e,t){return new ei(i,e,t)}function te(i,e,t){let n,r=typeof e=="number"?e:lr(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=lr(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return ur(i,r,t)}var ti=14,tt=class{static maxTickInTickarrayBitmap(e){return e*de*ft}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!z.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-z.tickCount(n):t+z.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*de,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(r){let l=e.shln(1024-c-1),m=tr(1024,l);if(m!==null){let d=(c-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=nr(1024,l);if(m!==null){let d=(c+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-z.tickCount(n)}}}},zt=class{static getBitmapOffset(e,t){if(!z.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=tt.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=tt.maxTickInTickarrayBitmap(e),n=-t;if(Te<=t)throw Error(`extensionTickBoundary check error: ${Te}, ${t}`);if(n<=he)throw Error(`extensionTickBoundary check error: ${n}, ${he}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:S.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=z.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=tt.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let u=S.mergeTickArrayBitmap(e).shln(ft-1-a),c=Ut(512,u)?null:Yn(512,u);if(c!==null){let l=t-c*z.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=S.mergeTickArrayBitmap(e).shrn(a),c=Ut(512,u)?null:Zn(512,u);if(c!==null){let l=t+c*z.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-z.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%tt.maxTickInTickarrayBitmap(t),r=Math.floor(n/z.tickCount(t));return e<0&&n!=0&&(r=ft-r),r}};var vm=v([Re(8),H("bump"),St("index"),M(""),et("protocolFeeRate"),et("tradeFeeRate"),St("tickSpacing"),te(w(),8,"")]),ks=v([et("blockTimestamp"),W("sqrtPriceX64"),W("cumulativeTimePriceX64"),te(W(),1,"")]),ni=v([Re(8),ze("initialized"),M("poolId"),te(ks,1e3,"observations"),te(W(),5,"")]),hs=v([H("rewardState"),w("openTime"),w("endTime"),w("lastUpdateTime"),W("emissionsPerSecondX64"),w("rewardTotalEmissioned"),w("rewardClaimed"),M("tokenMint"),M("tokenVault"),M("creator"),W("rewardGrowthGlobalX64")]),Dm=v([Re(8),H("bump"),M("ammConfig"),M("creator"),M("mintA"),M("mintB"),M("vaultA"),M("vaultB"),M("observationId"),H("mintDecimalsA"),H("mintDecimalsB"),St("tickSpacing"),W("liquidity"),W("sqrtPriceX64"),ye("tickCurrent"),St("observationIndex"),St("observationUpdateDuration"),W("feeGrowthGlobalX64A"),W("feeGrowthGlobalX64B"),w("protocolFeesTokenA"),w("protocolFeesTokenB"),W("swapInAmountTokenA"),W("swapOutAmountTokenB"),W("swapInAmountTokenB"),W("swapOutAmountTokenA"),H("status"),te(H(),7,""),te(hs,3,"rewardInfos"),te(w(),16,"tickArrayBitmap"),w("totalFeesTokenA"),w("totalFeesClaimedTokenA"),w("totalFeesTokenB"),w("totalFeesClaimedTokenB"),w("fundFeesTokenA"),w("fundFeesTokenB"),w("startTime"),te(w(),15*4-3,"padding")]),As=v([W("growthInsideLastX64"),w("rewardAmountOwed")]),dr=v([Re(8),H("bump"),M("nftMint"),M("poolId"),ye("tickLower"),ye("tickUpper"),W("liquidity"),W("feeGrowthInsideLastX64A"),W("feeGrowthInsideLastX64B"),w("tokenFeesOwedA"),w("tokenFeesOwedB"),te(As,3,"rewardInfos"),te(w(),8,"")]),Vm=v([Re(8),H("bump"),M("poolId"),ye("tickLowerIndex"),ye("tickUpperIndex"),W("liquidity"),W("feeGrowthInsideLastX64A"),W("feeGrowthInsideLastX64B"),w("tokenFeesOwedA"),w("tokenFeesOwedB"),te(W(),3,"rewardGrowthInside"),te(w(),8,"")]),Ps=v([ye("tick"),mr("liquidityNet"),W("liquidityGross"),W("feeGrowthOutsideX64A"),W("feeGrowthOutsideX64B"),te(W(),3,"rewardGrowthsOutsideX64"),te(et(),13,"")]),Qt=v([Re(8),M("poolId"),ye("startTickIndex"),te(Ps,de,"ticks"),H("initializedTickCount"),te(H(),115,"")]),Ts=v([Re(329),te(M(),100,"whitelistMints")]),pr=v([Re(8),M("poolId"),te(te(w(),8),ti,"positiveTickArrayBitmap"),te(te(w(),8),ti,"negativeTickArrayBitmap")]);var xs=15,z=class{static async getTickArrays(e,t,n,r,o,s,a){let u=[],c=S.getTickArrayStartIndexByTick(r,o),l=S.getInitializedTickArrayInRange(s,a,o,c,Math.floor(xs/2));for(let p=0;p<l.length;p++){let{publicKey:b}=$(t,n,l[p]);u.push(b)}let m=(await st(e,u)).map(p=>p!==null?Qt.decode(p.data):null),d={};for(let p=0;p<u.length;p++){let b=m[p];b!==null&&(d[b.startTickIndex]=ne(Q({},b),{address:u[p]}))}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=S.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/z.tickCount(t)),a=n?S.searchLowBitFromStart(r,o,s-1,1,t):S.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=de-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<de;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=$(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=S.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u-1}else for(u=u+1;u<de;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u+1}let{publicKey:m}=$(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(S.checkIsOutOfBoundary(e)){if(e>Te)return!1;let n=S.getTickArrayStartIndexByTick(he,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return de*e}};var de=60,ft=512,S=class{static getTickArrayAddressByTick(e,t,n,r){let o=S.getTickArrayStartIndexByTick(n,r),{publicKey:s}=$(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=S.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=de)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=z.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*z.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*de,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*de,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*de:e+t*de}static mergeTickArrayBitmap(e){let t=new Bs(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*de));return[...S.searchLowBitFromStart(e,t,s-1,o,n),...S.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return S.searchHightBitFromStart(e,t,0,ft,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=S.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of a){let{publicKey:c}=$(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>S.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===r)break}let u=z.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>S.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===r)break}let u=z.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<he||e>Te}static nextInitTick(e,t,n,r,o){if(z.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<de;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=de-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<de;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=D.getSqrtPriceX64FromTick(t),o=D.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new R(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new R(1).div(t),o=bt.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=D.getSqrtPriceX64FromTick(o),a=D.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new R(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=D.getSqrtPriceX64FromTick(t),o=D.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new R(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new R(1).div(t),o=bt.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=D.getSqrtPriceX64FromTick(o),a=D.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new R(1).div(a)}}};import Qe from"bn.js";var Ht=class{static getfeeGrowthInside(e,t,n){let r=new Qe(0),o=new Qe(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new Qe(0),a=new Qe(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=V.wrappingSubU128(V.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),c=V.wrappingSubU128(V.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=V.mulDivFloor(V.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ce),u=t.tokenFeesOwedA.add(a),c=V.mulDivFloor(V.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ce),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=V.mulDivFloor(V.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ce),u=t.tokenFeesOwedA.add(a),c=V.mulDivFloor(V.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ce),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=V.wrappingSubU128(u,c.growthInsideLastX64),m=V.mulDivFloor(l,t.liquidity,Ce),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=V.wrappingSubU128(u,c.growthInsideLastX64),m=V.mulDivFloor(l,t.liquidity,Ce),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Qe(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Qe(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(V.wrappingSubU128(V.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Qe(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Qe(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(V.wrappingSubU128(V.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var y,g,P,k;let a=D.priceToSqrtPriceX64(new R(e.price),e.mintA.decimals,e.mintB.decimals),u=D.getSqrtPriceX64FromTick(t.tickLower),c=D.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=Y.getAmountsFromLiquidity(a,u,c,n,o),[d,p]=[ke(m.amountA,(y=e.mintA.extensions)==null?void 0:y.feeConfig,s,!0),ke(m.amountB,(g=e.mintB.extensions)==null?void 0:g.feeConfig,s,!0)],[b,f]=[ke(new Qe(new R(m.amountA.toString()).mul(l).toFixed(0)),(P=e.mintA.extensions)==null?void 0:P.feeConfig,s,!0),ke(new Qe(new R(m.amountB.toString()).mul(l).toFixed(0)),(k=e.mintB.extensions)==null?void 0:k.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:b,amountSlippageB:f,expirationTime:dt(d.expirationTime,p.expirationTime)}}};var Ae=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o){let s=n.equals(e.mintA.mint),a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:b}=yt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,c,o);return a.push(...d),{expectedAmountOut:m.mul(je),remainingAccounts:a,executionPrice:p,feeAmount:b}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.equals(e.mintB.mint),a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:y}=$(e.programId,e.id,f.nextStartIndex);a.push(y)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:b}=yt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(je),c,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:p,feeAmount:b}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=Ae.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?zt.checkTickArrayIsInit(z.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):S.checkTickArrayIsInitialized(S.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=$(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,z.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=$(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/z.tickCount(e.tickSpacing)),r=t?S.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):S.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=z.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=tt.nextInitializedTickArrayStartIndex(S.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=zt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<he||t>Te)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let p=ne(Q({},m),{perSecond:V.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new fr(d)});if(p.tokenMint.equals(fr.default))continue;if(n<=p.openTime.toNumber()||r.eq(ce)){s.push(p);continue}let b=new ae(Math.min(p.endTime.toNumber(),n)),f=b.sub(p.lastUpdateTime),y=V.mulDivFloor(f,p.emissionsPerSecondX64,r),g=p.rewardGrowthGlobalX64.add(y),P=V.mulDivFloor(f,p.emissionsPerSecondX64,Ce),k=p.rewardTotalEmissioned.add(P);s.push(ne(Q({},p),{rewardGrowthGlobalX64:g,rewardTotalEmissioned:k,lastUpdateTime:b}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=S.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=tt.maxTickInTickarrayBitmap(e),n=-t;return t>Te&&(t=z.getArrayStartIndex(Te,e)+z.tickCount(e)),n<he&&(n=z.getArrayStartIndex(he,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!z.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/z.tickCount(t)*ft}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await Un(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=pr.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=S.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=S.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:d}=$(u.programId,u.id,m);o.push({pubkey:d}),r[d.toString()]=u.id}}let s=await Un(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=Qt.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]=ne(Q({},l),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let p of s)c.push(Ue(p,d).publicKey);let l=await st(t,c,{batchRequest:r}),m={};for(let d of l){if(d===null)continue;let p=dr.decode(d.data),b=p.poolId.toString(),f=e.find(O=>O.state.id.toBase58()===b);if(f===void 0)continue;let y=f.state,g=S._getTickPriceLegacy({poolInfo:y,tick:p.tickLower,baseIn:!0}),P=S._getTickPriceLegacy({poolInfo:y,tick:p.tickUpper,baseIn:!0}),{amountA:k,amountB:T}=Y.getAmountsFromLiquidity(y.sqrtPriceX64,g.tickSqrtPriceX64,P.tickSqrtPriceX64,p.liquidity,!1),h=1/(1-Math.sqrt(Math.sqrt(g.price.div(P.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:g.price,priceUpper:P.price,amountA:k,amountB:T,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(O=>ne(Q({},O),{pendingReward:new ae(0)})),leverage:h,tokenFeeAmountA:new ae(0),tokenFeeAmountB:new ae(0)}];let B=await S.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),I=await S.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=B,m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=I}if(o){let d=Object.values(m),p=await st(t,d,{batchRequest:r}),b={};for(let f=0;f<d.length;f++){let y=p[f];if(y===null)continue;let g=d[f].toString();b[g]=Qt.decode(y.data)}for(let{state:f,positionAccount:y}of e)if(!!y)for(let g of y){let P=`${f.programId.toString()}-${f.id.toString()}-${g.tickLower}`,k=`${f.programId.toString()}-${f.id.toString()}-${g.tickUpper}`,T=b[m[P].toString()],h=b[m[k].toString()],B=T.ticks[S.getTickOffsetInArray(g.tickLower,f.tickSpacing)],I=h.ticks[S.getTickOffsetInArray(g.tickUpper,f.tickSpacing)],{tokenFeeAmountA:O,tokenFeeAmountB:X}=await Ht.GetPositionFees(f,g,B,I),F=await Ht.GetPositionRewards(f,g,B,I);g.tokenFeeAmountA=O.gte(new ae(0))?O:new ae(0),g.tokenFeeAmountB=X.gte(new ae(0))?X:new ae(0);for(let U=0;U<F.length;U++)g.rewardInfos[U].pendingReward=F[U].gte(new ae(0))?F[U]:new ae(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,token2022Infos:r,epochInfo:o,amountIn:s,slippage:a,priceLimit:u=new R(0)}){var X,F,U,le;let c;u.equals(new R(0))?c=n.equals(e.mintA.mint)?Je.add(new ae(1)):$e.sub(new ae(1)):c=D.priceToSqrtPriceX64(u,e.mintA.decimals,e.mintB.decimals);let l=qt(s,(X=r[n.toString()])==null?void 0:X.feeConfig,o,!1),{expectedAmountOut:m,remainingAccounts:d,executionPrice:p,feeAmount:b}=Ae.getOutputAmountAndRemainAccounts(e,t,n,l.amount.sub((F=l.fee)!=null?F:ce),c),f=e.mintA.mint.equals(n)?e.mintB.mint:e.mintA.mint,y=qt(m,(U=r[f.toString()])==null?void 0:U.feeConfig,o,!1),g=D.sqrtPriceX64ToPrice(p,e.mintA.decimals,e.mintB.decimals),P=n.equals(e.mintA.mint)?g:new R(1).div(g),k=m.mul(new ae(Math.floor((1-a)*1e10))).div(new ae(1e10)),T=qt(k,(le=r[f.toString()])==null?void 0:le.feeConfig,o,!1),h=e.mintA.mint.equals(n)?e.currentPrice:new R(1).div(e.currentPrice),B=new R(P).sub(h).abs(),I=h,O=new Ze(new R(B).mul(10**15).toFixed(0),new R(I).mul(10**15).toFixed(0));return{realAmountIn:l,amountOut:y,minAmountOut:T,expirationTime:dt(l.expirationTime,y.expirationTime),currentPrice:e.currentPrice,executionPrice:P,priceImpact:O,fee:b,remainingAccounts:d}}static async computeAmountOutFormat({poolInfo:e,tickArrayCache:t,token2022Infos:n,amountIn:r,tokenOut:o,slippage:s,epochInfo:a}){let u=r.token.equals(Ke.WSOL)?lt:r.token.mint,c=s.numerator.toNumber()/s.denominator.toNumber(),l=o.mint.equals(De)?new Ke({mint:"sol",decimals:an.decimals}):o,{realAmountIn:m,amountOut:d,minAmountOut:p,expirationTime:b,currentPrice:f,executionPrice:y,priceImpact:g,fee:P,remainingAccounts:k}=await Ae.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:u,amountIn:r.raw,slippage:c,token2022Infos:n,epochInfo:a}),T=ne(Q({},m),{amount:new be(r.token,m.amount),fee:m.fee===void 0?void 0:new be(r.token,m.fee)}),h=ne(Q({},d),{amount:new be(l,d.amount),fee:d.fee===void 0?void 0:new be(l,d.fee)}),B=ne(Q({},p),{amount:new be(l,p.amount),fee:p.fee===void 0?void 0:new be(l,p.fee)}),I=new Ne({baseToken:r.token,denominator:new ae(10).pow(new ae(20+r.token.decimals)),quoteToken:l,numerator:f.mul(new R(10**(20+l.decimals))).toFixed(0)}),O=new Ne({baseToken:r.token,denominator:new ae(10).pow(new ae(20+r.token.decimals)),quoteToken:l,numerator:y.mul(new R(10**(20+l.decimals))).toFixed(0)}),X=new be(r.token,P);return{realAmountIn:T,amountOut:h,minAmountOut:B,expirationTime:b,currentPrice:I,executionPrice:O,priceImpact:g,fee:X,remainingAccounts:k}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var b,f,y;let o=e[t],s=S.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=S.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,d=o.priceMax-o.priceMin,p;return l<=0?p=0:m===l?p=d/l:d===l?p=l/m:p=l/d*(l/m),{feeApr:o.feeApr*p,rewardsApr:[(b=o.rewardApr[0])!=null?b:0*p,(f=o.rewardApr[1])!=null?f:0*p,(y=o.rewardApr[2])!=null?y:0*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[Rt(e.mintA.address).toString()],d=r[Rt(e.mintB.address).toString()],p=e.mintA.decimals,b=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=D.priceToSqrtPriceX64(new R(e.price),e.mintA.decimals,e.mintB.decimals),y=D.getSqrtPriceX64FromTick(s),g=D.getSqrtPriceX64FromTick(a),{amountSlippageA:P,amountSlippageB:k}=Y.getAmountsFromLiquidityWithSlippage(f,y,g,t,!1,!1,0),{amountSlippageA:T,amountSlippageB:h}=Y.getAmountsFromLiquidityWithSlippage(f,y,g,o,!1,!1,0),B=new R(P.toString()).div(new R(10).pow(p)).mul(m.value).add(new R(k.toString()).div(new R(10).pow(b)).mul(d.value)),I=new R(T.toString()).div(new R(10).pow(p)).mul(m.value).add(new R(h.toString()).div(new R(10).pow(b)).mul(d.value)),O=I.div(B.add(I)).div(I),F=new R(l.volumeFee).mul(365).div(c).mul(O).mul(100).toNumber(),U=3600*24*365,le=e.rewardDefaultInfos.map(oe=>{var Z,gi;let Pe=oe.mint.decimals,G=r[oe.mint.address];return u<((Z=oe.startTime)!=null?Z:0)||u>((gi=oe.endTime)!=null?gi:0)||!oe.perSecond||!G||Pe===void 0?0:new R(G.value).mul(new R(oe.perSecond).mul(U)).div(new R(10).pow(Pe)).mul(O).mul(100).toNumber()});return{feeApr:F,rewardsApr:le,apr:F+le.reduce((oe,Pe)=>oe+Pe,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var g,P;let l=D.priceToSqrtPriceX64(new R(e.price),e.mintA.decimals,e.mintB.decimals),m=D.getSqrtPriceX64FromTick(n),d=D.getSqrtPriceX64FromTick(r),p=a?1-s:1+s,b=ke(o,(g=e[t?"mintA":"mintB"].extensions)==null?void 0:g.feeConfig,u,!c),f=new ae(new R(b.amount.sub((P=b.fee)!=null?P:ce).toString()).mul(p).toFixed(0)),y;if(l.lte(m))y=t?Y.getLiquidityFromTokenAmountA(m,d,f,!a):new ae(0);else if(l.lte(d)){let k=Y.getLiquidityFromTokenAmountA(l,d,f,!a),T=Y.getLiquidityFromTokenAmountB(m,l,f);y=t?k:T}else y=t?new ae(0):Y.getLiquidityFromTokenAmountB(m,d,f);return Ae.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:y,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var y,g,P,k;let u=D.getSqrtPriceX64FromTick(n),c=D.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=Y.getAmountsFromLiquidity(D.priceToSqrtPriceX64(new R(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,p]=[ke(m.amountA,(y=t.mintA.extensions)==null?void 0:y.feeConfig,e,!0),ke(m.amountB,(g=t.mintB.extensions)==null?void 0:g.feeConfig,e,!0)],[b,f]=[ke(m.amountA.muln(l),(P=t.mintA.extensions)==null?void 0:P.feeConfig,e,!0),ke(m.amountB.muln(l),(k=t.mintB.extensions)==null?void 0:k.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:p,amountSlippageA:b,amountSlippageB:f,expirationTime:dt(d.expirationTime,p.expirationTime)}}};var V=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(ce)||(o=o.add(Se)),o}static mulDivFloor(e,t,n){if(n.eq(ce))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ce))throw new Error("division by 0");return e.mul(t).add(n.sub(Se)).div(n)}static x64ToDecimal(e,t){return new R(e.toString()).div(R.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new q(e.mul(R.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(bn).sub(t).mod(bn)}};function pe(i,e){return ii(i.mul(e),64,256)}function Is(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function ii(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var D=class{static sqrtPriceX64ToPrice(e,t,n){return V.x64ToDecimal(e).pow(2).mul(R.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return V.decimalToX64(e.mul(R.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(ce))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ce))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(ce))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ce))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(ce))return e;let o=t.shln(Gt);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?V.mulDivCeil(s,e,a):V.mulDivRoundingUp(s,Se,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return V.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Gt);if(r)return e.add(o.div(t));{let s=V.mulDivRoundingUp(o,Se,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<he||e>Te)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new q("18445821805675395072"):new q("18446744073709551616");return(t&2)!=0&&(n=pe(n,new q("18444899583751176192"))),(t&4)!=0&&(n=pe(n,new q("18443055278223355904"))),(t&8)!=0&&(n=pe(n,new q("18439367220385607680"))),(t&16)!=0&&(n=pe(n,new q("18431993317065453568"))),(t&32)!=0&&(n=pe(n,new q("18417254355718170624"))),(t&64)!=0&&(n=pe(n,new q("18387811781193609216"))),(t&128)!=0&&(n=pe(n,new q("18329067761203558400"))),(t&256)!=0&&(n=pe(n,new q("18212142134806163456"))),(t&512)!=0&&(n=pe(n,new q("17980523815641700352"))),(t&1024)!=0&&(n=pe(n,new q("17526086738831433728"))),(t&2048)!=0&&(n=pe(n,new q("16651378430235570176"))),(t&4096)!=0&&(n=pe(n,new q("15030750278694412288"))),(t&8192)!=0&&(n=pe(n,new q("12247334978884435968"))),(t&16384)!=0&&(n=pe(n,new q("8131365268886854656"))),(t&32768)!=0&&(n=pe(n,new q("3584323654725218816"))),(t&65536)!=0&&(n=pe(n,new q("696457651848324352"))),(t&131072)!=0&&(n=pe(n,new q("26294789957507116"))),(t&262144)!=0&&(n=pe(n,new q("37481735321082"))),e>0&&(n=Zi.div(n)),n}static getTickFromPrice(e,t,n){return D.getTickFromSqrtPriceX64(D.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt($e)||e.lt(Je))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new q(t-64),r=Is(n,32,128),o=new q("8000000000000000","hex"),s=0,a=new q(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new q(0))&&s<ji;){u=u.mul(u);let b=u.shrn(127);u=u.shrn(63+b.toNumber()),a=a.add(o.mul(b)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=r.add(c).mul(new q(Ji)),d=ii(m.sub(new q($i)),64,128).toNumber(),p=ii(m.add(new q(er)),64,128).toNumber();return d==p?d:D.getSqrtPriceX64FromTick(p).lte(e)?p:d}},bt=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=D.getTickFromSqrtPriceX64(D.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=bt.getTickWithPriceAndTickspacing(e,t,n,r),s=D.getSqrtPriceX64FromTick(o);return D.sqrtPriceX64ToPrice(s,n,r)}},Y=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ce))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Gt),s=t.sub(e);return r?V.mulDivRoundingUp(V.mulDivCeil(o,s,t),Se,e):V.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ce))throw new Error("sqrtPriceX64A must greater than 0");return r?V.mulDivCeil(n,t.sub(e),Ce):V.mulDivFloor(n,t.sub(e),Ce)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?V.mulDivRoundingUp(a,Se,Hn):a.shrn(Gt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),V.mulDivFloor(n,Hn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return Y.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=Y.getLiquidityFromTokenAmountA(e,n,r,!1),a=Y.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return Y.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:Y.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new q(0)};if(e.lt(n)){let s=Y.getTokenAmountAFromLiquidity(e,n,r,o),a=Y.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new q(0),amountB:Y.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:u,amountB:c}=Y.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new q(new R(u.toString()).mul(l).toFixed(0)),d=new q(new R(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var P,k,T,h;let c=D.priceToSqrtPriceX64(new R(e.price),e.mintA.decimals,e.mintB.decimals),l=D.getSqrtPriceX64FromTick(t),m=D.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,p=Y.getAmountsFromLiquidity(c,l,m,r,s),[b,f]=[ke(p.amountA,(P=e.mintA.extensions)==null?void 0:P.feeConfig,a,u),ke(p.amountB,(k=e.mintB.extensions)==null?void 0:k.feeConfig,a,u)],[y,g]=[ke(new q(new R(p.amountA.toString()).mul(d).toFixed(0)),(T=e.mintA.extensions)==null?void 0:T.feeConfig,a,u),ke(new q(new R(p.amountB.toString()).mul(d).toFixed(0)),(h=e.mintB.extensions)==null?void 0:h.feeConfig,a,u)];return{liquidity:r,amountA:b,amountB:f,amountSlippageA:y,amountSlippageB:g,expirationTime:dt(b.expirationTime,f.expirationTime)}}},yt=class{static swapCompute(e,t,n,r,o,s,a,u,c,l,m,d,p,b){if(d.eq(ce))throw new Error("amountSpecified must not be 0");if(b||(b=s?Je.add(Se):$e.sub(Se)),s){if(b.lt(Je))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(b.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(b.gt($e))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(b.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let f=d.gt(ce),y={amountSpecifiedRemaining:d,amountCalculated:ce,sqrtPriceX64:m,tick:c>p?Math.min(p+z.tickCount(l)-1,c):p,accounts:[],liquidity:u,feeAmount:new q(0)},g=p,P=n[p],k=0,T=!s&&P.startTickIndex===y.tick;for(;!y.amountSpecifiedRemaining.eq(ce)&&!y.sqrtPriceX64.eq(b);){if(k>10)throw Error("liquidity limit");let h={};h.sqrtPriceStartX64=y.sqrtPriceX64;let B=S.nextInitTick(P,y.tick,l,s,T),I=B||null,O=null;if(!(I!=null&&I.liquidityGross.gtn(0))){let F=Ae.nextInitializedTickArrayStartIndex({tickCurrent:y.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},g,s);if(!F.isExist)throw Error("swapCompute LiquidityInsufficient");g=F.nextStartIndex;let{publicKey:U}=$(e,t,g);O=U,P=n[g],I=S.firstInitializedTick(P,s)}h.tickNext=I.tick,h.initialized=I.liquidityGross.gtn(0),p!==g&&O&&(y.accounts.push(O),p=g),h.tickNext<he?h.tickNext=he:h.tickNext>Te&&(h.tickNext=Te),h.sqrtPriceNextX64=D.getSqrtPriceX64FromTick(h.tickNext);let X;if(s&&h.sqrtPriceNextX64.lt(b)||!s&&h.sqrtPriceNextX64.gt(b)?X=b:X=h.sqrtPriceNextX64,[y.sqrtPriceX64,h.amountIn,h.amountOut,h.feeAmount]=yt.swapStepCompute(y.sqrtPriceX64,X,y.liquidity,y.amountSpecifiedRemaining,a),y.feeAmount=y.feeAmount.add(h.feeAmount),f?(y.amountSpecifiedRemaining=y.amountSpecifiedRemaining.sub(h.amountIn.add(h.feeAmount)),y.amountCalculated=y.amountCalculated.sub(h.amountOut)):(y.amountSpecifiedRemaining=y.amountSpecifiedRemaining.add(h.amountOut),y.amountCalculated=y.amountCalculated.add(h.amountIn.add(h.feeAmount))),y.sqrtPriceX64.eq(h.sqrtPriceNextX64)){if(h.initialized){let F=I.liquidityNet;s&&(F=F.mul(je)),y.liquidity=Y.addDelta(y.liquidity,F)}T=h.tickNext!=y.tick&&!s&&P.startTickIndex===h.tickNext,y.tick=s?h.tickNext-1:h.tickNext}else if(y.sqrtPriceX64!=h.sqrtPriceStartX64){let F=D.getTickFromSqrtPriceX64(y.sqrtPriceX64);T=F!=y.tick&&!s&&P.startTickIndex===F,y.tick=F}++k}try{let{nextStartIndex:h,isExist:B}=z.nextInitializedTickArray(y.tick,l,s,r,o);B&&p!==h&&(y.accounts.push($(e,t,h).publicKey),p=h)}catch{}return{amountCalculated:y.amountCalculated,feeAmount:y.feeAmount,sqrtPriceX64:y.sqrtPriceX64,liquidity:y.liquidity,tickCurrent:y.tick,accounts:y.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new q(0),amountIn:new q(0),amountOut:new q(0),feeAmount:new q(0)},a=e.gte(t),u=r.gte(ce);if(u){let l=V.mulDivFloor(r,yn.sub(new q(o.toString())),yn);s.amountIn=a?Y.getTokenAmountAFromLiquidity(t,e,n,!0):Y.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=D.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?Y.getTokenAmountBFromLiquidity(t,e,n,!1):Y.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(je).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=D.getNextSqrtPriceX64FromOutput(e,n,r.mul(je),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=Y.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=Y.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:Y.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:Y.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul(je))&&(s.amountOut=r.mul(je)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=V.mulDivCeil(s.amountIn,new q(o),yn.sub(new q(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};import{TOKEN_PROGRAM_ID as ge,TOKEN_2022_PROGRAM_ID as ct,ASSOCIATED_TOKEN_PROGRAM_ID as hr}from"@solana/spl-token";import{PublicKey as x,TransactionInstruction as Ee,SystemProgram as Kt,Keypair as ui}from"@solana/web3.js";import Ar from"bn.js";import{PublicKey as Ls,Keypair as Rs}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Os}from"@solana/spl-token";import op from"bn.js";var An=v([M("mint"),M("owner"),w("amount"),et("delegateOption"),M("delegate"),H("state"),et("isNativeOption"),w("isNative"),w("delegatedAmount"),et("closeAuthorityOption"),M("closeAuthority")]);function Ss(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}function ri(i,...e){if(!Ss(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}function oi(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function br(i,e){ri(i);let t=e.outputLen;if(i.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var Tn=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),Fe=(i,e)=>i<<32-e|i>>>e;var Ud=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Ks(i){if(typeof i!="string")throw new Error(`utf8ToBytes expected string, got ${typeof i}`);return new Uint8Array(new TextEncoder().encode(i))}function si(i){return typeof i=="string"&&(i=Ks(i)),ri(i),i}var Pn=class{clone(){return this._cloneInto()}},Xd={}.toString;function yr(i){let e=n=>i().update(si(n)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function Cs(i,e,t,n){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,n);let r=BigInt(32),o=BigInt(4294967295),s=Number(t>>r&o),a=Number(t&o),u=n?4:0,c=n?0:4;i.setUint32(e+u,s,n),i.setUint32(e+c,a,n)}var gr=(i,e,t)=>i&e^~i&t,wr=(i,e,t)=>i&e^i&t^e&t,xn=class extends Pn{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Tn(this.buffer)}update(e){oi(this);let{view:t,buffer:n,blockLen:r}=this;e=si(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(r-this.pos,o-s);if(a===r){let u=Tn(e);for(;r<=o-s;s+=r)this.process(u,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){oi(this),br(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let m=s;m<r;m++)t[m]=0;Cs(n,r-8,BigInt(this.length*8),o),this.process(n,0);let a=Tn(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let c=u/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<c;m++)a.setUint32(4*m,l[m],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:o,destroyed:s,pos:a}=this;return e.length=r,e.pos=a,e.finished=o,e.destroyed=s,r%t&&e.buffer.set(n),e}};var Ns=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),at=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ut=new Uint32Array(64),ai=class extends xn{constructor(){super(64,32,8,!1),this.A=at[0]|0,this.B=at[1]|0,this.C=at[2]|0,this.D=at[3]|0,this.E=at[4]|0,this.F=at[5]|0,this.G=at[6]|0,this.H=at[7]|0}get(){let{A:e,B:t,C:n,D:r,E:o,F:s,G:a,H:u}=this;return[e,t,n,r,o,s,a,u]}set(e,t,n,r,o,s,a,u){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,t){for(let m=0;m<16;m++,t+=4)ut[m]=e.getUint32(t,!1);for(let m=16;m<64;m++){let d=ut[m-15],p=ut[m-2],b=Fe(d,7)^Fe(d,18)^d>>>3,f=Fe(p,17)^Fe(p,19)^p>>>10;ut[m]=f+ut[m-7]+b+ut[m-16]|0}let{A:n,B:r,C:o,D:s,E:a,F:u,G:c,H:l}=this;for(let m=0;m<64;m++){let d=Fe(a,6)^Fe(a,11)^Fe(a,25),p=l+d+gr(a,u,c)+Ns[m]+ut[m]|0,f=(Fe(n,2)^Fe(n,13)^Fe(n,22))+wr(n,r,o)|0;l=c,c=u,u=a,a=s+p|0,s=o,o=r,r=n,n=p+f|0}n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,o,s,a,u,c,l)}roundClean(){ut.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var kr=yr(()=>new ai);var cp=se("Raydium_Util");function Bn({fromPublicKey:i,programId:e=Os}){let t=Rs.generate().publicKey.toBase58().slice(0,32);return{publicKey:Ms(i,t,e),seed:t}}function Ms(i,e,t){let n=Buffer.concat([i.toBuffer(),Buffer.from(e),t.toBuffer()]),r=kr(n);return new Ls(r)}var Pr=se("Raydium_Clmm"),We={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Yt=class{static createPoolInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,b){let f=v([W("sqrtPriceX64"),w("startTime")]),y=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:Kt.programId,isSigner:!1,isWritable:!1},{pubkey:ht,isSigner:!1,isWritable:!1}],g=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,startTime:b},g);let P=Buffer.from([...We.createPool,...g]);return new Ee({keys:y,programId:e,data:P})}static async createPoolInstructions(e){let{connection:t,programId:n,owner:r,mintA:o,mintB:s,ammConfigId:a,initialPriceX64:u,startTime:c,forerunCreate:l}=e,m=Bn({fromPublicKey:r,programId:n}),[d,p]=[new x(o.address),new x(s.address)],b=[Kt.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:m.seed,newAccountPubkey:m.publicKey,lamports:l?0:await t.getMinimumBalanceForRentExemption(ni.span),space:ni.span,programId:n})],{publicKey:f}=rr(n,a,d,p),{publicKey:y}=jn(n,f,d),{publicKey:g}=jn(n,f,p);return b.push(this.createPoolInstruction(n,f,r,a,m.publicKey,d,y,new x(o.programId||ge),p,g,new x(s.programId||ge),Xe(n,f).publicKey,u,c)),{signers:[],instructions:b,instructionTypes:[J.CreateAccount,J.ClmmCreatePool],address:{poolId:f,observationId:m.publicKey,mintAVault:y,mintBVault:g},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,b,f,y,g,P,k,T,h,B,I,O,X,F){let U=v([ye("tickLowerIndex"),ye("tickUpperIndex"),ye("tickArrayLowerStartIndex"),ye("tickArrayUpperStartIndex"),W("liquidity"),w("amountMaxA"),w("amountMaxB"),ze("withMetadata"),H("optionBaseFlag"),ze("baseFlag")]),le=[...F?[{pubkey:F,isSigner:!1,isWritable:!0}]:[]],oe=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:ht,isSigner:!1,isWritable:!1},{pubkey:Kt.programId,isSigner:!1,isWritable:!1},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:hr,isSigner:!1,isWritable:!1},{pubkey:At,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...le],Pe=Buffer.alloc(U.span);U.encode({tickLowerIndex:P,tickUpperIndex:k,tickArrayLowerStartIndex:T,tickArrayUpperStartIndex:h,liquidity:B,amountMaxA:I,amountMaxB:O,withMetadata:X==="create",baseFlag:!1,optionBaseFlag:0},Pe);let G=Buffer.from([...We.openPosition,...Pe]);return new Ee({keys:oe,programId:e,data:G})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new x(e.programId),new x(e.id)],b;if(l)b=new x((await l(1))[0]);else{let O=ui.generate();m.push(O),b=O.publicKey}let f=S.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=S.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:g}=$(d,p,f),{publicKey:P}=$(d,p,y),{publicKey:k}=_e(n.wallet,b,ge),{publicKey:T}=wn(b),{publicKey:h}=Ue(d,b),{publicKey:B}=pt(d,p,r,o),I=this.openPositionFromLiquidityInstruction(d,n.feePayer,p,n.wallet,b,k,T,B,g,P,h,n.tokenAccountA,n.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),r,o,f,y,s,a,u,c);return{signers:m,instructions:[I],instructionTypes:[J.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:b,tickArrayLower:g,tickArrayUpper:P,positionNftAccount:k,metadataAccount:T,personalPosition:h,protocolPosition:B}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new x(e.programId),new x(e.id)],b;if(l)b=new x((await l(1))[0]);else{let O=ui.generate();m.push(O),b=O.publicKey}let f=S.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=S.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:g}=$(d,p,f),{publicKey:P}=$(d,p,y),{publicKey:k}=_e(n.wallet,b,ge),{publicKey:T}=wn(b),{publicKey:h}=Ue(d,b),{publicKey:B}=pt(d,p,r,o),I=this.openPositionFromBaseInstruction(d,n.feePayer,p,n.wallet,b,k,T,B,g,P,h,n.tokenAccountA,n.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),r,o,f,y,c,s,a,u,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,y])?Xe(d,p).publicKey:void 0);return{address:{nftMint:b,tickArrayLower:g,tickArrayUpper:P,positionNftAccount:k,metadataAccount:T,personalPosition:h,protocolPosition:B},instructions:[I],signers:m,instructionTypes:[J.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,b,f,y,g,P,k,T,h,B,I,O,X,F){let U=v([ye("tickLowerIndex"),ye("tickUpperIndex"),ye("tickArrayLowerStartIndex"),ye("tickArrayUpperStartIndex"),W("liquidity"),w("amountMaxA"),w("amountMaxB"),ze("withMetadata"),H("optionBaseFlag"),ze("baseFlag")]),le=[...F?[{pubkey:F,isSigner:!1,isWritable:!0}]:[]],oe=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:ht,isSigner:!1,isWritable:!1},{pubkey:Kt.programId,isSigner:!1,isWritable:!1},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:hr,isSigner:!1,isWritable:!1},{pubkey:At,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...le],Pe=Buffer.alloc(U.span);U.encode({tickLowerIndex:P,tickUpperIndex:k,tickArrayLowerStartIndex:T,tickArrayUpperStartIndex:h,liquidity:new Ar(0),amountMaxA:I==="MintA"?O:X,amountMaxB:I==="MintA"?X:O,withMetadata:B==="create",baseFlag:I==="MintA",optionBaseFlag:1},Pe);let G=Buffer.from([...We.openPosition,...Pe]);return new Ee({keys:oe,programId:e,data:G})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,d=[];if(l)m=new x((await l(1))[0]);else{let O=ui.generate();d.push(O),m=O.publicKey}let[p,b]=[new x(e.programId),new x(e.id)],f=S.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=S.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:g}=$(p,b,f),{publicKey:P}=$(p,b,y),{publicKey:k}=_e(n.wallet,m,ge),{publicKey:T}=wn(m),{publicKey:h}=Ue(p,m),{publicKey:B}=pt(p,b,r,o),I=this.openPositionFromLiquidityInstruction(p,n.wallet,b,n.wallet,m,k,T,B,g,P,h,n.tokenAccountA,n.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(t.mintA.address),new x(t.mintB.address),r,o,f,y,s,a,u,c,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,y])?Xe(p,b).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:g,tickArrayUpper:P,positionNftAccount:k,metadataAccount:T,personalPosition:h,protocolPosition:B},instructions:[I],signers:d,instructionTypes:[J.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=v([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:Kt.programId,isSigner:!1,isWritable:!1},{pubkey:ge,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...We.closePosition,...u]);return new Ee({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new x(e.programId),{publicKey:s}=_e(n.wallet,r.nftMint,ge),{publicKey:a}=Ue(o,r.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[J.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,b,f,y,g,P){let k=v([W("liquidity"),w("amountMaxA"),w("amountMaxB"),H("optionBaseFlag"),ze("baseFlag")]),T=[...P?[{pubkey:P,isSigner:!1,isWritable:!0}]:[]],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...T],B=Buffer.alloc(k.span);k.encode({liquidity:f,amountMaxA:y,amountMaxB:g,optionBaseFlag:0,baseFlag:!1},B);let I=Buffer.from([...We.increaseLiquidity,...B]);return new Ee({keys:h,programId:e,data:I})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new x(e.programId),new x(e.id)],l=S.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=S.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=$(u,c,l),{publicKey:p}=$(u,c,m),{publicKey:b}=_e(r.wallet,n.nftMint,ge),{publicKey:f}=Ue(u,n.nftMint),{publicKey:y}=pt(u,c,n.tickLower,n.tickUpper),g=this.increasePositionFromLiquidityInstruction(u,r.wallet,b,f,c,y,d,p,r.tokenAccountA,r.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),o,s,a,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Xe(u,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:b,personalPosition:f,protocolPosition:y},signers:[],instructions:[g],instructionTypes:[J.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new x(e.programId),new x(e.id)],l=S.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=S.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=$(u,c,l),{publicKey:p}=$(u,c,m),{publicKey:b}=_e(r.wallet,n.nftMint,ge),{publicKey:f}=Ue(u,n.nftMint),{publicKey:y}=pt(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:b,personalPosition:f,protocolPosition:y},instructions:[this.increasePositionFromBaseInstruction(u,r.wallet,b,f,c,y,d,p,r.tokenAccountA,r.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),o,s,a,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Xe(u,c).publicKey:void 0)],signers:[],instructionTypes:[J.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,b,f,y,g,P){let k=v([W("liquidity"),w("amountMaxA"),w("amountMaxB"),H("optionBaseFlag"),ze("baseFlag")]),T=[...P?[{pubkey:P,isSigner:!1,isWritable:!0}]:[]],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...T],B=Buffer.alloc(k.span);k.encode({liquidity:new Ar(0),amountMaxA:f==="MintA"?y:g,amountMaxB:f==="MintA"?g:y,baseFlag:f==="MintA",optionBaseFlag:1},B);let I=Buffer.from([...We.increaseLiquidity,...B]);return new Ee({keys:h,programId:e,data:I})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,b,f,y,g,P,k){let T=v([W("liquidity"),w("amountMinA"),w("amountMinB")]),h=[...k?[{pubkey:k,isSigner:!1,isWritable:!0}]:[],...f.map(X=>[{pubkey:X.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:X.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:X.rewardMint,isSigner:!1,isWritable:!1}]).flat()],B=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:kt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...h],I=Buffer.alloc(T.span);T.encode({liquidity:y,amountMinA:g,amountMinB:P},I);let O=Buffer.from([...We.decreaseLiquidity,...I]);return new Ee({keys:B,programId:e,data:O})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new x(e.programId),new x(e.id)],m=S.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=S.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=$(c,l,m),{publicKey:b}=$(c,l,d),{publicKey:f}=_e(r.wallet,n.nftMint,u),{publicKey:y}=Ue(c,n.nftMint),{publicKey:g}=pt(c,l,n.tickLower,n.tickUpper),P=[];for(let T=0;T<e.rewardDefaultInfos.length;T++)P.push({poolRewardVault:new x(t.rewardInfos[T].vault),ownerRewardVault:r.rewardAccounts[T],rewardMint:new x(e.rewardDefaultInfos[T].mint.address)});let k=[];return k.push(this.decreaseLiquidityInstruction(c,r.wallet,f,y,l,g,p,b,r.tokenAccountA,r.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),P,o,s,a,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?Xe(c,l).publicKey:void 0)),{address:{tickArrayLower:p,tickArrayUpper:b,positionNftAccount:f,personalPosition:y,protocolPosition:g},signers:[],instructions:k,instructionTypes:[J.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,b,f,y,g){let P=v([w("amount"),w("otherAmountThreshold"),W("sqrtPriceLimitX64"),ze("isBaseInput")]),k=[...g?[{pubkey:g,isSigner:!1,isWritable:!0}]:[],...m.map(I=>({pubkey:I,isSigner:!1,isWritable:!0}))],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:kt,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...k],h=Buffer.alloc(P.span);P.encode({amount:p,otherAmountThreshold:b,sqrtPriceLimitX64:f,isBaseInput:y},h);let B=Buffer.from([...We.swap,...h]);return new Ee({keys:T,programId:e,data:B})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,inputMint:r,amountIn:o,amountOutMin:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new x(e.programId),new x(e.id)],[m,d]=[new x(t.vault.A),new x(t.vault.B)],[p,b]=[new x(e.mintA.address),new x(e.mintB.address)],f=e.mintA.address===r.toString(),y=[this.swapInstruction(c,n.wallet,l,new x(e.config.id),f?n.tokenAccountA:n.tokenAccountB,f?n.tokenAccountB:n.tokenAccountA,f?m:d,f?d:m,f?p:b,f?b:p,u,m,o,s,a,!0,Xe(c,l).publicKey)];return{signers:[],instructions:y,instructionTypes:[J.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let p=v([w("openTime"),w("endTime"),W("emissionsPerSecondX64")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Kt.programId,isSigner:!1,isWritable:!1},{pubkey:ht,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:ie(l),endTime:ie(m),emissionsPerSecondX64:d},f);let y=Buffer.from([...We.initReward,...f]);return new Ee({keys:b,programId:e,data:y})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new x(e.programId),new x(e.id)],a=or(o,s,r.mint).publicKey,u=kn(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new x(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[J.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let p=v([H("rewardIndex"),W("emissionsPerSecondX64"),w("openTime"),w("endTime")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:ie(l),endTime:ie(m)},f);let y=Buffer.from([...We.setRewardEmissions,...f]);return new Ee({keys:b,programId:e,data:y})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new x(e.programId),new x(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,u=new x(t.rewardInfos[d].vault),c=new x(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&Pr.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=kn(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new x(e.config.id),n.tokenAccount,u,c,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[J.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let u=v([H("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:kt,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...We.collectReward,...l]);return new Ee({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new x(e.programId),new x(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,u=new x(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&Pr.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,r,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[J.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapBaseOutInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,outputMint:r,amountOut:o,amountInMax:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new x(e.programId),new x(e.id)],[m,d]=[new x(t.vault.A),new x(t.vault.B)],[p,b]=[new x(e.mintA.address),new x(e.mintB.address)],f=e.mintA.address===r.toString(),y=[this.swapInstruction(c,n.wallet,l,new x(e.config.id),f?n.tokenAccountB:n.tokenAccountA,f?n.tokenAccountA:n.tokenAccountB,f?d:m,f?m:d,f?p:b,f?b:p,u,m,o,s,a,!1)];return{signers:[],instructions:y,instructionTypes:[J.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}};import Xp from"bn.js";import{TOKEN_PROGRAM_ID as _s,ASSOCIATED_TOKEN_PROGRAM_ID as Kf}from"@solana/spl-token";import{PublicKey as Nf,TransactionInstruction as xr,SystemProgram as qs,SYSVAR_RENT_PUBKEY as Lf}from"@solana/web3.js";var ci=v([H("instruction"),w("amountIn"),w("minAmountOut")]),li=v([H("instruction"),w("maxAmountIn"),w("amountOut")]),gf=v([H("instruction"),H("nonce")]),Fs=v([H("instruction"),H("nonce"),w("startTime")]),wf=v([w("status"),w("nonce"),w("maxOrder"),w("depth"),w("baseDecimal"),w("quoteDecimal"),w("state"),w("resetFlag"),w("minSize"),w("volMaxCutRatio"),w("amountWaveRatio"),w("baseLotSize"),w("quoteLotSize"),w("minPriceMultiplier"),w("maxPriceMultiplier"),w("systemDecimalValue"),w("minSeparateNumerator"),w("minSeparateDenominator"),w("tradeFeeNumerator"),w("tradeFeeDenominator"),w("pnlNumerator"),w("pnlDenominator"),w("swapFeeNumerator"),w("swapFeeDenominator"),w("baseNeedTakePnl"),w("quoteNeedTakePnl"),w("quoteTotalPnl"),w("baseTotalPnl"),w("poolOpenTime"),w("punishPcAmount"),w("punishCoinAmount"),w("orderbookToInitTime"),W("swapBaseInAmount"),W("swapQuoteOutAmount"),w("swapBase2QuoteFee"),W("swapQuoteInAmount"),W("swapBaseOutAmount"),w("swapQuote2BaseFee"),M("baseVault"),M("quoteVault"),M("baseMint"),M("quoteMint"),M("lpMint"),M("openOrders"),M("marketId"),M("marketProgramId"),M("targetOrders"),M("withdrawQueue"),M("lpVault"),M("owner"),w("lpReserve"),te(w(),3,"padding")]),kf=v([w("accountType"),w("status"),w("nonce"),w("maxOrder"),w("depth"),w("baseDecimal"),w("quoteDecimal"),w("state"),w("resetFlag"),w("minSize"),w("volMaxCutRatio"),w("amountWaveRatio"),w("baseLotSize"),w("quoteLotSize"),w("minPriceMultiplier"),w("maxPriceMultiplier"),w("systemDecimalsValue"),w("abortTradeFactor"),w("priceTickMultiplier"),w("priceTick"),w("minSeparateNumerator"),w("minSeparateDenominator"),w("tradeFeeNumerator"),w("tradeFeeDenominator"),w("pnlNumerator"),w("pnlDenominator"),w("swapFeeNumerator"),w("swapFeeDenominator"),w("baseNeedTakePnl"),w("quoteNeedTakePnl"),w("quoteTotalPnl"),w("baseTotalPnl"),w("poolOpenTime"),w("punishPcAmount"),w("punishCoinAmount"),w("orderbookToInitTime"),W("swapBaseInAmount"),W("swapQuoteOutAmount"),W("swapQuoteInAmount"),W("swapBaseOutAmount"),w("swapQuote2BaseFee"),w("swapBase2QuoteFee"),M("baseVault"),M("quoteVault"),M("baseMint"),M("quoteMint"),M("lpMint"),M("modelDataAccount"),M("openOrders"),M("marketId"),M("marketProgramId"),M("targetOrders"),M("owner"),te(w(),64,"padding")]),Es=v([H("instruction"),w("baseAmountIn"),w("quoteAmountIn"),w("fixedSide")]),Ws=v([H("instruction"),w("amountIn")]);var hf=v([w("fee")]);import{PublicKey as vs}from"@solana/web3.js";var mi=new vs("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ds=5e4,Vs=v([w("x"),w("y"),w("price")]),Bf=v([w("accountType"),w("status"),w("multiplier"),w("validDataCount"),te(Vs,Ds,"DataElement")]);var Tr=se("Raydium_liquidity_instruction");function Gs({poolKeys:i,userKeys:e,amountIn:t,minAmountOut:n},r){let o=Ve(i),s=Buffer.alloc(ci.span);ci.encode({instruction:9,amountIn:ie(t),minAmountOut:ie(n)},s);let a=[_({pubkey:_s,isWritable:!1}),_({pubkey:o.id}),_({pubkey:o.authority,isWritable:!1}),_({pubkey:o.openOrders})];return r===4&&a.push(_({pubkey:o.targetOrders})),a.push(_({pubkey:o.vault.A}),_({pubkey:o.vault.B})),r===5&&a.push(_({pubkey:mi})),a.push(_({pubkey:o.marketProgramId,isWritable:!1}),_({pubkey:o.marketId}),_({pubkey:o.marketBids}),_({pubkey:o.marketAsks}),_({pubkey:o.marketEventQueue}),_({pubkey:o.marketBaseVault}),_({pubkey:o.marketQuoteVault}),_({pubkey:o.marketAuthority,isWritable:!1}),_({pubkey:e.tokenAccountIn}),_({pubkey:e.tokenAccountOut}),_({pubkey:e.owner,isWritable:!1})),new xr({programId:o.programId,keys:a,data:s})}function Us({poolKeys:i,userKeys:e,maxAmountIn:t,amountOut:n},r){let o=Ve(i),s=Buffer.alloc(li.span);li.encode({instruction:11,maxAmountIn:ie(t),amountOut:ie(n)},s);let a=[_({pubkey:qs.programId,isWritable:!1}),_({pubkey:o.id}),_({pubkey:o.authority,isWritable:!1}),_({pubkey:o.openOrders}),_({pubkey:o.targetOrders}),_({pubkey:o.vault.A}),_({pubkey:o.vault.B})];return r===5&&a.push(_({pubkey:mi})),a.push(_({pubkey:o.marketProgramId,isWritable:!1}),_({pubkey:o.marketId}),_({pubkey:o.marketBids}),_({pubkey:o.marketAsks}),_({pubkey:o.marketEventQueue}),_({pubkey:o.marketBaseVault}),_({pubkey:o.marketQuoteVault}),_({pubkey:o.marketAuthority,isWritable:!1}),_({pubkey:e.tokenAccountIn}),_({pubkey:e.tokenAccountOut}),_({pubkey:e.owner,isWritable:!1,isSigner:!0})),new xr({programId:o.programId,keys:a,data:s})}function Br(i){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:s}=i;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return Gs(ne(Q({},a),{amountIn:r,minAmountOut:o}),t);if(s==="out")return Us(ne(Q({},a),{maxAmountIn:r,amountOut:o}),t);Tr.logWithError("invalid params","params",i)}throw Tr.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}function Ir(i,e,t,n,r,o){if(i.pooltype.includes("StablePool")){let s=Ve(e);return[{pubkey:s.programId,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.authority,isSigner:!1,isWritable:!1},{pubkey:s.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:new In("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:s.openOrders,isSigner:!1,isWritable:!0},{pubkey:s.vault.A,isSigner:!1,isWritable:!0},{pubkey:s.vault.B,isSigner:!1,isWritable:!0},{pubkey:s.marketId,isSigner:!1,isWritable:!0},{pubkey:s.marketBids,isSigner:!1,isWritable:!0},{pubkey:s.marketAsks,isSigner:!1,isWritable:!0},{pubkey:s.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0}]}else if(i.type==="Concentrated"){let s=i,a=Ve(e),u=s.mintA.address===t;return[{pubkey:new In(String(i.programId)),isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a.config.id,isSigner:!1,isWritable:!1},{pubkey:a.id,isSigner:!1,isWritable:!0},{pubkey:u?a.vault.A:a.vault.B,isSigner:!1,isWritable:!0},{pubkey:u?a.vault.B:a.vault.A,isSigner:!1,isWritable:!0},{pubkey:a.id,isSigner:!1,isWritable:!0},...a.mintA.programId.equals(di)||a.mintB.programId.equals(di)?[{pubkey:di,isSigner:!1,isWritable:!1},{pubkey:kt,isSigner:!1,isWritable:!1},{pubkey:u?a.mintA.address:a.mintB.address,isSigner:!1,isWritable:!1},{pubkey:u?a.mintB.address:a.mintA.address,isSigner:!1,isWritable:!1}]:[],...(o!=null?o:[]).map(c=>({pubkey:c,isSigner:!1,isWritable:!0})),{pubkey:Xe(new In(String(i.programId)),new In(i.id)).publicKey,isSigner:!1,isWritable:!0}]}else{let s=Ve(e);return[{pubkey:s.programId,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.authority,isSigner:!1,isWritable:!1},{pubkey:s.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:s.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:s.openOrders,isSigner:!1,isWritable:!0},{pubkey:s.vault.A,isSigner:!1,isWritable:!0},{pubkey:s.vault.B,isSigner:!1,isWritable:!0},{pubkey:s.marketId,isSigner:!1,isWritable:!0},{pubkey:s.marketBids,isSigner:!1,isWritable:!0},{pubkey:s.marketAsks,isSigner:!1,isWritable:!0},{pubkey:s.marketEventQueue,isSigner:!1,isWritable:!0},...s.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:s.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:s.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0}]]}}function Qs(i,e,t,n,r,o,s,a,u,c,l,m,d,p){let b=v([H("instruction"),w("amountIn"),w("amountOut")]),f=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:Xs,isSigner:!1,isWritable:!1}];f.push(...Ir(a,c,o,t,n,p[0])),f.push(...Ir(u,l,s,n,r,p[1]));let y=Buffer.alloc(b.span);return b.encode({instruction:8,amountIn:m,amountOut:d},y),new zs({keys:f,programId:i,data:y})}async function Sr({routeProgram:i,ownerInfo:e,inputMint:t,swapInfo:n}){var r,o,s,a,u,c;if(n.routeType==="amm")if(n.poolInfo[0].type==="Concentrated"){let l=Ve(n.poolKey[0]),m=t.equals(l.mintA.address)?Je.add(Se):$e.sub(Se);return await Yt.makeSwapBaseInInstructions({poolInfo:l,poolKeys:l,ownerInfo:{wallet:e.wallet,tokenAccountA:l.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:l.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((o=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?o:new pi(0)),sqrtPriceLimitX64:m,remainingAccounts:n.remainingAccounts[0]})}else{let l=n.poolKey[0];return{signers:[],instructions:[Br({poolKeys:l,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((a=(s=n.minAmountOut.fee)==null?void 0:s.raw)!=null?a:new pi(0)),fixedSide:"in"})],lookupTableAddress:l.lookupTableAccount?[l.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?J.AmmV5SwapBaseIn:J.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let l=n.poolInfo[0],m=n.poolInfo[1],d=n.poolKey[0],p=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[Qs(i,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.minMiddleAmountFee.token.mint.toString(),l,m,d,p,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((c=(u=n.minAmountOut.fee)==null?void 0:u.raw)!=null?c:new pi(0)),n.remainingAccounts)],instructionTypes:[J.RouteSwap],lookupTableAddress:[d.lookupTableAccount,p.lookupTableAccount].filter(b=>b!==void 0),address:{}}}else throw Error("route type error")}import{createInitializeAccountInstruction as Hs,createCloseAccountInstruction as Ys,createTransferInstruction as Zs,TOKEN_PROGRAM_ID as Ct}from"@solana/spl-token";import{PublicKey as js,SystemProgram as Js}from"@solana/web3.js";import $s from"bn.js";function ea(i){let{mint:e,tokenAccount:t,owner:n,programId:r=Ct}=i;return Hs(t,e,n,r)}function Zt(i){let{tokenAccount:e,payer:t,multiSigners:n=[],owner:r,programId:o=Ct}=i;return Ys(e,t,r,n,o)}async function fi(i){let{connection:e,amount:t,commitment:n,payer:r,owner:o,skipCloseAccount:s}=i,a=await e.getMinimumBalanceForRentExemption(An.span,n),u=ie(t).add(new $s(a)),c=Bn({fromPublicKey:r,programId:Ct});return{addresses:{newAccount:c.publicKey},signers:[],instructions:[Js.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:c.seed,newAccountPubkey:c.publicKey,lamports:u.toNumber(),space:An.span,programId:Ct}),ea({mint:new js(Ye.address),tokenAccount:c.publicKey,owner:o,programId:Ct})],instructionTypes:[J.CreateAccount,J.InitAccount],endInstructionTypes:s?[]:[J.CloseAccount],endInstructions:s?[]:[Zt({tokenAccount:c.publicKey,payer:r,owner:o})]}}function bi({source:i,destination:e,owner:t,amount:n,multiSigners:r=[],tokenProgram:o=Ct}){return Zs(i,e,t,BigInt(String(n)),r,o)}var yi=class extends It{constructor(e){super(e)}static getAddLiquidityDefaultPool({addLiquidityPools:e,poolInfosCache:t}){if(e.length===0)return;if(e.length===1||(e.sort((r,o)=>o.version-r.version),e[0].version!==e[1].version))return e[0];let n=e.filter(r=>r.version===e[0].version);return n.sort((r,o)=>this.comparePoolSize(r,o,t)),n[0]}static comparePoolSize(e,t,n){let r=n[e.id],o=n[t.id];return r===void 0?1:o===void 0?-1:e.baseMint===t.baseMint?r.baseReserve.sub(o.baseReserve).gte(Ft)?-1:1:r.baseReserve.sub(o.quoteReserve).gte(Ft)?-1:1}async getWSolAccounts(){this.scope.checkOwner(),await this.scope.account.fetchWalletTokenAccounts();let e=this.scope.account.tokenAccounts.filter(t=>t.mint.equals(lt));return e.sort((t,n)=>t.isAssociated?1:n.isAssociated||t.amount.lt(n.amount)?-1:1),e}async unWrapWSol(e){let{amount:t,tokenProgram:n}=e,r=await this.getWSolAccounts(),o=this.createTxBuilder();o.addCustomComputeBudget(e.computeBudgetConfig);let s=await fi({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:0});o.addInstruction(s);let a=ie(t);for(let u=0;u<r.length;u++)a.gte(r[u].amount)?(o.addInstruction({instructions:[Zt({tokenAccount:r[u].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:n})]}),a.sub(r[u].amount)):(o.addInstruction({instructions:[Zt({tokenAccount:r[u].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:n})]}),bi({destination:s.addresses.newAccount,source:r[u].publicKey,amount:a,owner:this.scope.ownerPubKey,tokenProgram:n}));return o.build()}async wrapWSol(e,t){let n=await this.getWSolAccounts(),r=this.createTxBuilder(),o=await fi({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:e,skipCloseAccount:!0});return r.addInstruction(o),n.length&&r.addInstruction({instructions:[bi({destination:n[0].publicKey,source:o.addresses.newAccount,amount:e,owner:this.scope.ownerPubKey,tokenProgram:t})],endInstructions:[Zt({tokenAccount:o.addresses.newAccount,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:t})]}),r.build()}async swap({swapInfo:e,associatedOnly:t,checkCreateATAOwner:n,checkTransaction:r,routeProgram:o=new ta("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS")}){let s=ne(Q({},e),{amountIn:this.scope.solToWsolTransferAmountFee(e.amountIn),amountOut:this.scope.solToWsolTransferAmountFee(e.amountOut),minAmountOut:this.scope.solToWsolTransferAmountFee(e.minAmountOut),middleMint:e.minMiddleAmountFee?Rt(e.middleToken.mint):void 0}),a=s.amountIn,u=s.amountOut,c=a.amount.token.mint.equals(Ke.WSOL.mint)||a.amount.token.mint.equals(De),l=u.amount.token.mint.equals(Ke.WSOL.mint)||u.amount.token.mint.equals(De),m=a.amount.token.mint,d=s.middleMint,p=u.amount.token.mint,b=this.createTxBuilder(),{account:f,instructionParams:y}=await this.scope.account.getOrCreateTokenAccount({mint:m,notUseTokenAccount:c,createInfo:c?{payer:this.scope.ownerPubKey,amount:a.amount.raw}:void 0,owner:this.scope.ownerPubKey,skipCloseAccount:!c,associatedOnly:c?!1:t,checkCreateATAOwner:n});if(y&&b.addInstruction(y),f===void 0)throw Error("input account check error");let{account:g,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({mint:p,skipCloseAccount:!l,createInfo:{payer:this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,associatedOnly:t,checkCreateATAOwner:n});P&&b.addInstruction(P);let k;if(s.routeType==="route"){let G=await this.scope.account.getOrCreateTokenAccount({mint:d,createInfo:{payer:this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,associatedOnly:!1,checkCreateATAOwner:n});k=G.account,G.instructionParams&&b.addInstruction(G.instructionParams)}let T=await Sr({routeProgram:o,inputMint:m,swapInfo:s,ownerInfo:{wallet:this.scope.ownerPubKey,sourceToken:f,routeToken:k,destinationToken:g}}),h=s.feeConfig!==void 0?[na(f,s.feeConfig.feeAccount,this.scope.ownerPubKey,s.feeConfig.feeAmount.toNumber())]:[],B=s.feeConfig!==void 0?[J.TransferAmount]:[],I=[],O=[],X=await b.getComputeBudgetConfig();if(X){let{instructions:G,instructionTypes:Z}=Pt(X);I.push(...G),O.push(...Z)}let F=[],U=[...I,...h,...b.AllTxData.instructions,...T.instructions,...b.AllTxData.endInstructions],le=[...O,...B,...b.AllTxData.instructionTypes,...T.instructionTypes,...b.AllTxData.endInstructionTypes],oe=[...b.AllTxData.signers,...T.signers];if(r)if(xt(U,[this.scope.ownerPubKey,...oe.map(G=>G.publicKey)]))F.push(this.createTxBuilder().addInstruction({instructions:U,signers:oe,instructionTypes:le}));else{if(b.AllTxData.instructions.length>0&&F.push(this.createTxBuilder().addInstruction({instructions:b.AllTxData.instructions,signers:b.AllTxData.signers,instructionTypes:b.AllTxData.instructionTypes})),xt([...I,...h,...T.instructions],[this.scope.ownerPubKey]))F.push(this.createTxBuilder().addInstruction({instructions:[...I,...h,...T.instructions],signers:T.signers,instructionTypes:[...O,...B,...T.instructionTypes]}));else if(xt([...I,...T.instructions],[this.scope.ownerPubKey]))F.push(this.createTxBuilder().addInstruction({instructions:[...I,...T.instructions],signers:T.signers,instructionTypes:T.instructionTypes}));else if(xt(T.instructions,[this.scope.ownerPubKey]))F.push(this.createTxBuilder().addInstruction({instructions:[...T.instructions],signers:T.signers,instructionTypes:T.instructionTypes}));else for(let G=0;G<T.instructions.length;G++)F.push(this.createTxBuilder().addInstruction({instructions:[...I,T.instructions[G]],signers:T.signers,instructionTypes:[...O,T.instructionTypes[G]]}));b.AllTxData.endInstructions.length>0&&F.push(this.createTxBuilder().addInstruction({instructions:b.AllTxData.endInstructions,instructionTypes:b.AllTxData.endInstructionTypes}))}else s.routeType==="amm"?F.push(this.createTxBuilder().addInstruction({instructions:U,signers:oe,instructionTypes:le})):(b.AllTxData.instructions.length>0&&F.push(this.createTxBuilder().addInstruction({instructions:b.AllTxData.instructions,signers:b.AllTxData.signers,instructionTypes:b.AllTxData.instructionTypes})),F.push(this.createTxBuilder().addInstruction({instructions:T.instructions,signers:T.signers,instructionTypes:T.instructionTypes})),b.AllTxData.endInstructions.length>0&&F.push(this.createTxBuilder().addInstruction({instructions:b.AllTxData.endInstructions,instructionTypes:b.AllTxData.endInstructionTypes})));return F.shift().buildMultiTx({extraPreBuildData:F.map(G=>G.build())})}};export{yi as default};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=trade.mjs.map