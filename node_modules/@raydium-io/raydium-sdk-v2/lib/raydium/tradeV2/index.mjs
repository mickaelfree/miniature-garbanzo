var $i=Object.defineProperty,er=Object.defineProperties;var tr=Object.getOwnPropertyDescriptors;var Yn=Object.getOwnPropertySymbols;var nr=Object.prototype.hasOwnProperty,ir=Object.prototype.propertyIsEnumerable;var Zn=(i,e,t)=>e in i?$i(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,$=(i,e)=>{for(var t in e||(e={}))nr.call(e,t)&&Zn(i,t,e[t]);if(Yn)for(var t of Yn(e))ir.call(e,t)&&Zn(i,t,e[t]);return i},ie=(i,e)=>er(i,tr(e));import{PublicKey as ab}from"@solana/web3.js";import{createTransferInstruction as lb}from"@solana/spl-token";import{get as jn,set as rr}from"lodash";import $n from"dayjs";import or from"dayjs/plugin/utc";$n.extend(or);var sn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return $n().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Jn={},sr={};function se(i){let e=jn(Jn,i);if(!e){let t=jn(sr,i);e=new sn({name:i,logLevel:t}),rr(Jn,i,e)}return e}import{PublicKey as ko}from"@solana/web3.js";import wo from"bn.js";import bo from"big.js";import Yt from"bn.js";import Be from"bn.js";var yt=9e15,rt=1e9,an="0123456789abcdef",vt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Dt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",un={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-yt,maxE:yt,crypto:!1},ii,He,O=!0,_t="[DecimalError] ",it=_t+"Invalid argument: ",ri=_t+"Precision limit exceeded",oi=_t+"crypto unavailable",si="[object Decimal]",ge=Math.floor,ce=Math.pow,ar=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,ur=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,cr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,ai=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Fe=1e7,C=7,lr=9007199254740991,mr=vt.length-1,cn=Dt.length-1,k={toStringTag:si};k.absoluteValue=k.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),K(i)};k.ceil=function(){return K(new this.constructor(this),this.e+1,2)};k.clampedTo=k.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(it+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};k.comparedTo=k.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};k.cosine=k.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+C,n.rounding=1,t=dr(n,di(n,t)),n.precision=i,n.rounding=e,K(He==2||He==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};k.cubeRoot=k.cbrt=function(){var i,e,t,n,r,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(O=!1,o=l.s*ce(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=pe(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ce(t,1/3),i=ge((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=j(c.plus(l).times(a),c.plus(u),s+2,1),pe(a.d).slice(0,s)===(t=pe(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(K(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(K(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return O=!0,K(n,i,m.rounding,e)};k.decimalPlaces=k.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-ge(this.e/C))*C,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};k.dividedBy=k.div=function(i){return j(this,new this.constructor(i))};k.dividedToIntegerBy=k.divToInt=function(i){var e=this,t=e.constructor;return K(j(e,new t(i),0,1,1),t.precision,t.rounding)};k.equals=k.eq=function(i){return this.cmp(i)===0};k.floor=function(){return K(new this.constructor(this),this.e+1,3)};k.greaterThan=k.gt=function(i){return this.cmp(i)>0};k.greaterThanOrEqualTo=k.gte=function(i){var e=this.cmp(i);return e==1||e===0};k.hyperbolicCosine=k.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/Gt(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=gt(s,1,o.times(e),new s(1),!0);for(var u,c=i,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return K(o,s.precision=t,s.rounding=n,!0)};k.hyperbolicSine=k.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=gt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/Gt(5,i)),r=gt(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,K(r,e,t,!0)};k.hyperbolicTangent=k.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,j(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};k.inverseCosine=k.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Me(t,r,o):new t(0):new t(NaN):e.isZero()?Me(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Me(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};k.inverseHyperbolicCosine=k.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,O=!1,t=t.times(t).minus(1).sqrt().plus(t),O=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};k.inverseHyperbolicSine=k.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,O=!1,t=t.times(t).plus(1).sqrt().plus(t),O=!0,n.precision=i,n.rounding=e,t.ln())};k.inverseHyperbolicTangent=k.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?K(new o(r),i,e,!0):(o.precision=t=n-r.e,r=j(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};k.inverseSine=k.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Me(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};k.inverseTangent=k.atan=function(){var i,e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,p=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=cn)return s=Me(l,m+4,p).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=cn)return s=Me(l,m+4,p).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/C+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(O=!1,e=Math.ceil(a/C),n=1,u=c.times(c),s=new l(c),r=c;i!==-1;)if(r=r.times(u),o=s.minus(r.div(n+=2)),r=r.times(u),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),O=!0,K(s,l.precision=m,l.rounding=p,!0)};k.isFinite=function(){return!!this.d};k.isInteger=k.isInt=function(){return!!this.d&&ge(this.e/C)>this.d.length-2};k.isNaN=function(){return!this.s};k.isNegative=k.isNeg=function(){return this.s<0};k.isPositive=k.isPos=function(){return this.s>0};k.isZero=function(){return!!this.d&&this.d[0]===0};k.lessThan=k.lt=function(i){return this.cmp(i)<0};k.lessThanOrEqualTo=k.lte=function(i){return this.cmp(i)<1};k.logarithm=k.log=function(i){var e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,p=l.rounding,d=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(O=!1,a=m+d,s=nt(c,a),n=e?Vt(l,a+10):nt(i,a),u=j(s,n,a,1),It(u.d,r=m,p))do if(a+=10,s=nt(c,a),n=e?Vt(l,a+10):nt(i,a),u=j(s,n,a,1),!o){+pe(u.d).slice(r+1,r+15)+1==1e14&&(u=K(u,m+1,0));break}while(It(u.d,r+=10,p));return O=!0,K(u,m,p)};k.minus=k.sub=function(i){var e,t,n,r,o,s,a,u,c,l,m,p,d=this,b=d.constructor;if(i=new b(i),!d.d||!i.d)return!d.s||!i.s?i=new b(NaN):d.d?i.s=-i.s:i=new b(i.d||d.s!==i.s?d:NaN),i;if(d.s!=i.s)return i.s=-i.s,d.plus(i);if(c=d.d,p=i.d,a=b.precision,u=b.rounding,!c[0]||!p[0]){if(p[0])i.s=-i.s;else if(c[0])i=new b(d);else return new b(u===3?-0:0);return O?K(i,a,u):i}if(t=ge(i.e/C),l=ge(d.e/C),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=p.length):(e=p,t=l,s=c.length),n=Math.max(Math.ceil(a/C),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=p.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=p[n]){m=c[n]<p[n];break}o=0}for(m&&(e=c,c=p,p=e,i.s=-i.s),s=c.length,n=p.length-s;n>0;--n)c[s++]=0;for(n=p.length;n>o;){if(c[--n]<p[n]){for(r=n;r&&c[--r]===0;)c[r]=Fe-1;--c[r],c[n]+=Fe}c[n]-=p[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=qt(c,t),O?K(i,a,u):i):new b(u===3?-0:0)};k.modulo=k.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?K(new n(t),n.precision,n.rounding):(O=!1,n.modulo==9?(e=j(t,i.abs(),0,3,1),e.s*=i.s):e=j(t,i,0,n.modulo,1),e=e.times(i),O=!0,t.minus(e))};k.naturalExponential=k.exp=function(){return ln(this)};k.naturalLogarithm=k.ln=function(){return nt(this)};k.negated=k.neg=function(){var i=new this.constructor(this);return i.s=-i.s,K(i)};k.plus=k.add=function(i){var e,t,n,r,o,s,a,u,c,l,m=this,p=m.constructor;if(i=new p(i),!m.d||!i.d)return!m.s||!i.s?i=new p(NaN):m.d||(i=new p(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(c=m.d,l=i.d,a=p.precision,u=p.rounding,!c[0]||!l[0])return l[0]||(i=new p(m)),O?K(i,a,u):i;if(o=ge(m.e/C),n=ge(i.e/C),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/C),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=c.length,r=l.length,s-r<0&&(r=s,t=l,l=c,c=t),e=0;r;)e=(c[--r]=c[r]+l[r]+e)/Fe|0,c[r]%=Fe;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=qt(c,n),O?K(i,a,u):i};k.precision=k.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(it+i);return t.d?(e=ui(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};k.round=function(){var i=this,e=i.constructor;return K(new e(i),i.e+1,e.rounding)};k.sine=k.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+C,n.rounding=1,t=fr(n,di(n,t)),n.precision=i,n.rounding=e,K(He>2?t.neg():t,i,e,!0)):new n(NaN)};k.squareRoot=k.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(O=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=pe(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=ge((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(j(s,o,t+2,1)).times(.5),pe(o.d).slice(0,t)===(e=pe(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(K(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(K(n,u+1,1),i=!n.times(n).eq(s));break}return O=!0,K(n,u,l.rounding,i)};k.tangent=k.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=j(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,K(He==2||He==4?t.neg():t,i,e,!0)):new n(NaN)};k.times=k.mul=function(i){var e,t,n,r,o,s,a,u,c,l=this,m=l.constructor,p=l.d,d=(i=new m(i)).d;if(i.s*=l.s,!p||!p[0]||!d||!d[0])return new m(!i.s||p&&!p[0]&&!d||d&&!d[0]&&!p?NaN:!p||!d?i.s/0:i.s*0);for(t=ge(l.e/C)+ge(i.e/C),u=p.length,c=d.length,u<c&&(o=p,p=d,d=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)a=o[r]+d[n]*p[r-n-1]+e,o[r--]=a%Fe|0,e=a/Fe|0;o[r]=(o[r]+e)%Fe|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=qt(o,t),O?K(i,m.precision,m.rounding):i};k.toBinary=function(i,e){return dn(this,2,i,e)};k.toDecimalPlaces=k.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Ie(i,0,rt),e===void 0?e=n.rounding:Ie(e,0,8),K(t,i+t.e+1,e))};k.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Ve(n,!0):(Ie(i,0,rt),e===void 0?e=r.rounding:Ie(e,0,8),n=K(new r(n),i+1,e),t=Ve(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};k.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Ve(r):(Ie(i,0,rt),e===void 0?e=o.rounding:Ie(e,0,8),n=K(new o(r),i+r.e+1,e),t=Ve(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};k.toFraction=function(i){var e,t,n,r,o,s,a,u,c,l,m,p,d=this,b=d.d,f=d.constructor;if(!b)return new f(d);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=ui(b)-d.e-1,s=o%C,e.d[0]=ce(10,s<0?C+s:s),i==null)i=o>0?e:c;else{if(a=new f(i),!a.isInt()||a.lt(c))throw Error(it+a);i=a.gt(e)?o>0?e:c:a}for(O=!1,a=new f(pe(b)),l=f.precision,f.precision=o=b.length*C*2;m=j(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(m.times(r)),u=r,r=e,e=a.minus(m.times(r)),a=r;return r=j(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=d.s,p=j(c,n,o,1).minus(d).abs().cmp(j(u,t,o,1).minus(d).abs())<1?[c,n]:[u,t],f.precision=l,O=!0,p};k.toHexadecimal=k.toHex=function(i,e){return dn(this,16,i,e)};k.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Ie(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(O=!1,t=j(t,i,0,e,1).times(i),O=!0,K(t)):(i.s=t.s,t=i),t};k.toNumber=function(){return+this};k.toOctal=function(i,e){return dn(this,8,i,e)};k.toPower=k.pow=function(i){var e,t,n,r,o,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(ce(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,i.eq(1))return K(a,n,o);if(e=ge(i.e/C),e>=i.d.length-1&&(t=c<0?-c:c)<=lr)return r=ci(u,a,t,n),i.s<0?new u(1).div(r):K(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ce(+a,c),e=t==0||!isFinite(t)?ge(c*(Math.log("0."+pe(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(O=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=ln(i.times(nt(a,n+t)),n),r.d&&(r=K(r,n+5,1),It(r.d,n,o)&&(e=n+10,r=K(ln(i.times(nt(a,e+t)),e),e+5,1),+pe(r.d).slice(n+1,n+15)+1==1e14&&(r=K(r,n+1,0)))),r.s=s,O=!0,u.rounding=o,K(r,n,o))};k.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Ve(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Ie(i,1,rt),e===void 0?e=r.rounding:Ie(e,0,8),n=K(new r(n),i,e),t=Ve(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};k.toSignificantDigits=k.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Ie(i,1,rt),e===void 0?e=n.rounding:Ie(e,0,8)),K(new n(t),i,e)};k.toString=function(){var i=this,e=i.constructor,t=Ve(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};k.truncated=k.trunc=function(){return K(new this.constructor(this),this.e+1,1)};k.valueOf=k.toJSON=function(){var i=this,e=i.constructor,t=Ve(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function pe(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=C-n.length,t&&(o+=tt(t)),o+=n;s=i[e],n=s+"",t=C-n.length,t&&(o+=tt(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Ie(i,e,t){if(i!==~~i||i<e||i>t)throw Error(it+i)}function It(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=C,r=0):(r=Math.ceil((e+1)/C),e%=C),o=ce(10,C-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==ce(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==ce(10,e-3)-1,s}function Wt(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=an.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function dr(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/Gt(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=gt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var j=function(){function i(n,r,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*r+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=r[a]){u=n[a]>r[a]?1:-1;break}return u}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,u){var c,l,m,p,d,b,f,g,w,P,A,x,h,L,F,_,Z,z,Q,Te,de=n.constructor,xe=n.s==r.s?1:-1,ne=n.d,H=r.d;if(!ne||!ne[0]||!H||!H[0])return new de(!n.s||!r.s||(ne?H&&ne[0]==H[0]:!H)?NaN:ne&&ne[0]==0||!H?xe*0:xe/0);for(u?(d=1,l=n.e-r.e):(u=Fe,d=C,l=ge(n.e/d)-ge(r.e/d)),Q=H.length,Z=ne.length,w=new de(xe),P=w.d=[],m=0;H[m]==(ne[m]||0);m++);if(H[m]>(ne[m]||0)&&l--,o==null?(L=o=de.precision,s=de.rounding):a?L=o+(n.e-r.e)+1:L=o,L<0)P.push(1),b=!0;else{if(L=L/d+2|0,m=0,Q==1){for(p=0,H=H[0],L++;(m<Z||p)&&L--;m++)F=p*u+(ne[m]||0),P[m]=F/H|0,p=F%H|0;b=p||m<Z}else{for(p=u/(H[0]+1)|0,p>1&&(H=i(H,p,u),ne=i(ne,p,u),Q=H.length,Z=ne.length),_=Q,A=ne.slice(0,Q),x=A.length;x<Q;)A[x++]=0;Te=H.slice(),Te.unshift(0),z=H[0],H[1]>=u/2&&++z;do p=0,c=e(H,A,Q,x),c<0?(h=A[0],Q!=x&&(h=h*u+(A[1]||0)),p=h/z|0,p>1?(p>=u&&(p=u-1),f=i(H,p,u),g=f.length,x=A.length,c=e(f,A,g,x),c==1&&(p--,t(f,Q<g?Te:H,g,u))):(p==0&&(c=p=1),f=H.slice()),g=f.length,g<x&&f.unshift(0),t(A,f,x,u),c==-1&&(x=A.length,c=e(H,A,Q,x),c<1&&(p++,t(A,Q<x?Te:H,x,u))),x=A.length):c===0&&(p++,A=[0]),P[m++]=p,c&&A[0]?A[x++]=ne[_]||0:(A=[ne[_]],x=1);while((_++<Z||A[0]!==void 0)&&L--);b=A[0]!==void 0}P[0]||P.shift()}if(d==1)w.e=l,ii=b;else{for(m=1,p=P[0];p>=10;p/=10)m++;w.e=m+l*d-1,K(w,a?o+w.e+1:o,s,b)}return w}}();function K(i,e,t,n){var r,o,s,a,u,c,l,m,p,d=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=C,s=e,l=m[p=0],u=l/ce(10,r-s-1)%10|0;else if(p=Math.ceil((o+1)/C),a=m.length,p>=a)if(n){for(;a++<=p;)m.push(0);l=u=0,r=1,o%=C,s=o-C+1}else break e;else{for(l=a=m[p],r=1;a>=10;a/=10)r++;o%=C,s=o-C+r,u=s<0?0:l/ce(10,r-s-1)%10|0}if(n=n||e<0||m[p+1]!==void 0||(s<0?l:l%ce(10,r-s-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/ce(10,r-s):0:m[p-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=i.e+1,m[0]=ce(10,(C-e%C)%C),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=p,a=1,p--):(m.length=p+1,a=ce(10,C-o),m[p]=s>0?(l/ce(10,r-s)%ce(10,s)|0)*a:0),c)for(;;)if(p==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==Fe&&(m[0]=1));break}else{if(m[p]+=a,m[p]!=Fe)break;m[p--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return O&&(i.e>d.maxE?(i.d=null,i.e=NaN):i.e<d.minE&&(i.e=0,i.d=[0])),i}function Ve(i,e,t){if(!i.isFinite())return mi(i);var n,r=i.e,o=pe(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+tt(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+tt(-r-1)+o,t&&(n=t-s)>0&&(o+=tt(n))):r>=s?(o+=tt(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+tt(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=tt(n))),o}function qt(i,e){var t=i[0];for(e*=C;t>=10;t/=10)e++;return e}function Vt(i,e,t){if(e>mr)throw O=!0,t&&(i.precision=t),Error(ri);return K(new i(vt),e,1,!0)}function Me(i,e,t){if(e>cn)throw Error(ri);return K(new i(Dt),e,t,!0)}function ui(i){var e=i.length-1,t=e*C+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function tt(i){for(var e="";i--;)e+="0";return e}function ci(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/C+4);for(O=!1;;){if(t%2&&(o=o.times(e),ti(o.d,s)&&(r=!0)),t=ge(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),ti(e.d,s)}return O=!0,o}function ei(i){return i.d[i.d.length-1]&1}function li(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function ln(i,e){var t,n,r,o,s,a,u,c=0,l=0,m=0,p=i.constructor,d=p.rounding,b=p.precision;if(!i.d||!i.d[0]||i.e>17)return new p(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(O=!1,u=b):u=e,a=new p(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(ce(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new p(1),p.precision=u;;){if(o=K(o.times(i),u,1),t=t.times(++l),a=s.plus(j(o,t,u,1)),pe(a.d).slice(0,u)===pe(s.d).slice(0,u)){for(r=m;r--;)s=K(s.times(s),u,1);if(e==null)if(c<3&&It(s.d,u-n,d,c))p.precision=u+=10,t=o=a=new p(1),l=0,c++;else return K(s,p.precision=b,d,O=!0);else return p.precision=b,s}s=a}}function nt(i,e){var t,n,r,o,s,a,u,c,l,m,p,d=1,b=10,f=i,g=f.d,w=f.constructor,P=w.rounding,A=w.precision;if(f.s<0||!g||!g[0]||!f.e&&g[0]==1&&g.length==1)return new w(g&&!g[0]?-1/0:f.s!=1?NaN:g?0:f);if(e==null?(O=!1,l=A):l=e,w.precision=l+=b,t=pe(g),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=pe(f.d),n=t.charAt(0),d++;o=f.e,n>1?(f=new w("0."+t),o++):f=new w(n+"."+t.slice(1))}else return c=Vt(w,l+2,A).times(o+""),f=nt(new w(n+"."+t.slice(1)),l-b).plus(c),w.precision=A,e==null?K(f,A,P,O=!0):f;for(m=f,u=s=f=j(f.minus(1),f.plus(1),l,1),p=K(f.times(f),l,1),r=3;;){if(s=K(s.times(p),l,1),c=u.plus(j(s,new w(r),l,1)),pe(c.d).slice(0,l)===pe(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Vt(w,l+2,A).times(o+""))),u=j(u,new w(d),l,1),e==null)if(It(u.d,l-b,P,a))w.precision=l+=b,c=s=f=j(m.minus(1),m.plus(1),l,1),p=K(f.times(f),l,1),r=a=1;else return K(u,w.precision=A,P,O=!0);else return w.precision=A,u;u=c,r+=2}}function mi(i){return String(i.s*i.s/0)}function mn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%C,t<0&&(n+=C),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=C;n<r;)i.d.push(+e.slice(n,n+=C));e=e.slice(n),n=C-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),O&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function pr(i,e){var t,n,r,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),ai.test(e))return mn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(ur.test(e))t=16,e=e.toLowerCase();else if(ar.test(e))t=2;else if(cr.test(e))t=8;else throw Error(it+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=ci(n,new n(t),o,o*2)),c=Wt(e,t,Fe),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=qt(c,l),i.d=c,O=!1,s&&(i=j(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?ce(2,u):Bt.pow(2,u))),O=!0,i)}function fr(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:gt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Gt(5,t)),e=gt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function gt(i,e,t,n,r){var o,s,a,u,c=1,l=i.precision,m=Math.ceil(l/C);for(O=!1,u=t.times(t),a=new i(n);;){if(s=j(a.times(u),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=j(s.times(u),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return O=!0,s.d.length=m+1,s}function Gt(i,e){for(var t=i;--e;)t*=i;return t}function di(i,e){var t,n=e.s<0,r=Me(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return He=n?4:1,e;if(t=e.divToInt(r),t.isZero())He=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return He=ei(t)?n?2:3:n?4:1,e;He=ei(t)?n?1:4:n?3:2}return e.minus(r).abs()}function dn(i,e,t,n){var r,o,s,a,u,c,l,m,p,d=i.constructor,b=t!==void 0;if(b?(Ie(t,1,rt),n===void 0?n=d.rounding:Ie(n,0,8)):(t=d.precision,n=d.rounding),!i.isFinite())l=mi(i);else{for(l=Ve(i),s=l.indexOf("."),b?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),p=new d(1),p.e=l.length-s,p.d=Wt(Ve(p),10,r),p.e=p.d.length),m=Wt(l,10,r),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=b?"0p+0":"0";else{if(s<0?o--:(i=new d(i),i.d=m,i.e=o,i=j(i,p,t,n,0,r),m=i.d,o=i.e,c=ii),s=m[t],a=r/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,c)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=an.charAt(m[s]);if(b){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=Wt(l,r,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=an.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function ti(i,e){if(i.length>e)return i.length=e,!0}function br(i){return new this(i).abs()}function yr(i){return new this(i).acos()}function gr(i){return new this(i).acosh()}function kr(i,e){return new this(i).plus(e)}function wr(i){return new this(i).asin()}function Ar(i){return new this(i).asinh()}function hr(i){return new this(i).atan()}function Pr(i){return new this(i).atanh()}function Tr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Me(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Me(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Me(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(j(i,e,o,1)),e=Me(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(j(i,e,o,1)),t}function xr(i){return new this(i).cbrt()}function Ir(i){return K(i=new this(i),i.e+1,2)}function Br(i,e,t){return new this(i).clamp(e,t)}function Sr(i){if(!i||typeof i!="object")throw Error(_t+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,rt,"rounding",0,8,"toExpNeg",-yt,0,"toExpPos",0,yt,"maxE",0,yt,"minE",-yt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=un[t]),(n=i[t])!==void 0)if(ge(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(it+t+": "+n);if(t="crypto",r&&(this[t]=un[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(oi);else this[t]=!1;else throw Error(it+t+": "+n);return this}function Kr(i){return new this(i).cos()}function Cr(i){return new this(i).cosh()}function pi(i){var e,t,n;function r(o){var s,a,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,ni(o)){c.s=o.s,O?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;O?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return mn(c,o.toString())}else if(u!=="string")throw Error(it+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),ai.test(o)?mn(c,o):pr(c,o)}if(r.prototype=k,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Sr,r.clone=pi,r.isDecimal=ni,r.abs=br,r.acos=yr,r.acosh=gr,r.add=kr,r.asin=wr,r.asinh=Ar,r.atan=hr,r.atanh=Pr,r.atan2=Tr,r.cbrt=xr,r.ceil=Ir,r.clamp=Br,r.cos=Kr,r.cosh=Cr,r.div=Nr,r.exp=Lr,r.floor=Rr,r.hypot=Or,r.ln=Mr,r.log=Fr,r.log10=Wr,r.log2=Er,r.max=vr,r.min=Dr,r.mod=Vr,r.mul=_r,r.pow=qr,r.random=Gr,r.round=Ur,r.sign=Xr,r.sin=zr,r.sinh=Qr,r.sqrt=Hr,r.sub=Yr,r.sum=Zr,r.tan=jr,r.tanh=Jr,r.trunc=$r,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function Nr(i,e){return new this(i).div(e)}function Lr(i){return new this(i).exp()}function Rr(i){return K(i=new this(i),i.e+1,3)}function Or(){var i,e,t=new this(0);for(O=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return O=!0,new this(1/0);t=e}return O=!0,t.sqrt()}function ni(i){return i instanceof Bt||i&&i.toStringTag===si||!1}function Mr(i){return new this(i).ln()}function Fr(i,e){return new this(i).log(e)}function Er(i){return new this(i).log(2)}function Wr(i){return new this(i).log(10)}function vr(){return li(this,arguments,"lt")}function Dr(){return li(this,arguments,"gt")}function Vr(i,e){return new this(i).mod(e)}function _r(i,e){return new this(i).mul(e)}function qr(i,e){return new this(i).pow(e)}function Gr(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Ie(i,1,rt),n=Math.ceil(i/C),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(oi);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=C,n&&i&&(r=ce(10,C-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=C)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<C&&(t-=C-n)}return s.e=t,s.d=a,s}function Ur(i){return K(i=new this(i),i.e+1,this.rounding)}function Xr(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function zr(i){return new this(i).sin()}function Qr(i){return new this(i).sinh()}function Hr(i){return new this(i).sqrt()}function Yr(i,e){return new this(i).sub(e)}function Zr(){var i=0,e=arguments,t=new this(e[i]);for(O=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return O=!0,K(t,this.precision,this.rounding)}function jr(i){return new this(i).tan()}function Jr(i){return new this(i).tanh()}function $r(i){return K(i=new this(i),i.e+1,1)}k[Symbol.for("nodejs.util.inspect.custom")]=k.toString;k[Symbol.toStringTag]="Decimal";var Bt=k.constructor=pi(un);vt=new Bt(vt);Dt=new Bt(Dt);var N=Bt;import{PublicKey as bn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as eo}from"@solana/spl-token";import{PublicKey as re,SystemProgram as to,SYSVAR_RENT_PUBKEY as no}from"@solana/web3.js";function D({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var Cs=[D({pubkey:eo,isWritable:!1}),D({pubkey:to.programId,isWritable:!1}),D({pubkey:no,isWritable:!1})];function pn({publicKey:i,transformSol:e}){let t=fn(i.toString());if(t instanceof re)return e&&t.equals(ot)?kt:t;if(e&&t.toString()===ot.toBase58())return kt;if(typeof t=="string"){if(t===re.default.toBase58())return re.default;try{return new re(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function fn(i){try{return new re(i)}catch{return i}}var wt=new re("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),At=new re("SysvarRent111111111111111111111111111111111"),Ns=new re("SysvarC1ock11111111111111111111111111111111"),ht=new re("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Ls=new re("Sysvar1nstructions1111111111111111111111111"),Rs=new re("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Os=new re("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ms=new re("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Fs=new re("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Es=new re("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ws=new re("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),vs=new re("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ds=new re("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Vs=new re("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),_s=new re("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),qs=new re("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),kt=new re("So11111111111111111111111111111111111111112"),ot=re.default;function Ut(i){return pn({publicKey:i,transformSol:!0})}import{PublicKey as io}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as fi}from"@solana/spl-token";var Xt={chainId:101,address:io.default.toBase58(),programId:fi.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},st={chainId:101,address:"So11111111111111111111111111111111111111112",programId:fi.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var yn=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===ot.toBase58()||e instanceof bn&&ot.equals(e)){this.decimals=st.decimals,this.symbol=st.symbol,this.name=st.name,this.mint=new bn(st.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?bn.default:pn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ee=yn;Ee.WSOL=new yn(ie($({},st),{mint:st.address}));import Qt from"big.js";import so from"bn.js";import ao from"decimal.js-light";import ro from"toformat";var oo=ro,St=oo;var zt=se("module/fraction"),gn=St(Qt),Kt=St(ao),uo={[0]:Kt.ROUND_DOWN,[1]:Kt.ROUND_HALF_UP,[2]:Kt.ROUND_UP},co={[0]:Qt.roundDown,[1]:Qt.roundHalfUp,[2]:Qt.roundUp},X=class{constructor(e,t=new so(1)){this.numerator=ee(e),this.denominator=ee(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new X(this.denominator,this.numerator)}add(e){let t=e instanceof X?e:new X(ee(e));return this.denominator.eq(t.denominator)?new X(this.numerator.add(t.numerator),this.denominator):new X(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof X?e:new X(ee(e));return this.denominator.eq(t.denominator)?new X(this.numerator.sub(t.numerator),this.denominator):new X(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof X?e:new X(ee(e));return new X(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof X?e:new X(ee(e));return new X(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||zt.logWithError(`${e} is not an integer.`),e<=0&&zt.logWithError(`${e} is not positive.`),Kt.set({precision:e+1,rounding:uo[n]});let r=new Kt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||zt.logWithError(`${e} is not an integer.`),e<0&&zt.logWithError(`${e} is negative.`),gn.DP=e,gn.RM=co[n]||1,new gn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var mo=se("Raydium_price"),Ne=class extends X{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new X(kn(n.decimals),kn(r.decimals))}get raw(){return new X(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Ne({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&mo.logWithError("mul token not equals");let n=super.mul(t);return new Ne({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var wn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Ht=wn;Ht.SOL=new wn(Xt);import po from"bn.js";var bi=new X(new po(100)),Ye=class extends X{toSignificant(e=5,t,n){return this.mul(bi).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(bi).toFixed(e,t,n)}};var An=new Be(0),fo=new Be(1),va=new Be(2),Da=new Be(3),Va=new Be(5),hn=new Be(10),_a=new Be(100),qa=new Be(1e3),Ga=new Be(1e4),yi=9007199254740991;function ee(i){let e=se("Raydium_parseBigNumberish");if(i instanceof Be)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Be(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=yi||i<=-yi)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Be(String(i))):typeof i=="bigint"?new Be(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Be(0))}function kn(i){return hn.pow(ee(i))}var yo=se("Raydium_amount"),ki=St(bo);function go(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):yo.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var fe=class extends X{constructor(t,n,r=!0,o){let s=new Yt(0),a=hn.pow(new Yt(t.decimals));if(r)s=ee(n);else{let u=new Yt(0),c=new Yt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=go(n.toString(),t.decimals);u=ee(l),c=ee(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=se(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new fe(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new fe(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return ki.DP=this.token.decimals,new ki(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};function gi(i){return typeof i=="object"&&i!==null&&![Ee,fe,ko,X,wo,Ne,Ye].some(e=>typeof e=="object"&&i instanceof e)}function ke(i){return typeof i=="string"?fn(i):Array.isArray(i)?i.map(e=>ke(e)):gi(i)?Object.fromEntries(Object.entries(i).map(([e,t])=>[e,ke(t)])):i}import{PublicKey as ec,sendAndConfirmTransaction as tc,Transaction as ic,TransactionMessage as oc,VersionedTransaction as sc}from"@solana/web3.js";import uc from"axios";var te={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw"};import{PublicKey as Ao,ComputeBudgetProgram as ku,Transaction as Au,TransactionMessage as Pu,Keypair as Tu,VersionedTransaction as Iu}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Su}from"@solana/spl-token";var Nu=se("Raydium_txUtil");function Le(i,e){let[t,n]=Ao.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}import{PublicKey as Po,AddressLookupTableAccount as wi}from"@solana/web3.js";import{PublicKey as ho}from"@solana/web3.js";import{getTransferFeeConfig as Wu,unpackMint as vu}from"@solana/spl-token";var Pn=se("Raydium_accountInfo_util");async function lt(i,e,t){let{batchRequest:n,commitment:r="confirmed"}=$({batchRequest:!1},t),o=Tn(e,100),s=new Array(o.length).fill([]);if(n){let a=o.map(l=>{let m=i._buildArgs([l.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:m}}),u=Tn(a,10);s=(await(await Promise.all(u.map(async l=>await i._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&Pn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(m=>{if(m){let{data:p,executable:d,lamports:b,owner:f,rentEpoch:g}=m;return p.length!==2&&p[1]!=="base64"&&Pn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:d,lamports:b,owner:new ho(f),rentEpoch:g}}return null})))}else try{s=await Promise.all(o.map(a=>i.getMultipleAccountsInfo(a,r)))}catch(a){a instanceof Error&&Pn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function xn(i,e,t){let n=await lt(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>ie($({},r),{accountInfo:n[o]}))}var To={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new wi({key:new Po("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:wi.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};function Tn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Se}from"@solana/web3.js";var kc=new Se("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),wc=new Se("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ac=new Se("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),hc=new Se("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Pc=new Se("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Tc=new Se("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),xc=new Se("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Ic=new Se("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Bc=new Se("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Sc=new Se("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Kc=new Se("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Cc=new Se("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Nc=new Se("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Lc=new Se("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi");import{PublicKey as Bo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as So}from"@solana/spl-token";function _e(i,e,t){return Le([i.toBuffer(),(t!=null?t:So).toBuffer(),e.toBuffer()],new Bo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import ae from"bn.js";var qe=1e4;function Ct(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=t.epoch<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new ae(r.maximumFee.toString()),s=t.epoch<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(r.transferFeeBasisPoints===qe){let a=new ae(r.maximumFee.toString());return{amount:i.add(a),fee:a,expirationTime:s}}else{let a=Pt(i.mul(new ae(qe)),new ae(qe-r.transferFeeBasisPoints)),u=new ae(r.maximumFee.toString()),c=a.sub(i).gt(u)?i.add(u):a,l=Pt(c.mul(new ae(r.transferFeeBasisPoints)),new ae(qe)),m=l.gt(o)?o:l;return{amount:c,fee:m,expirationTime:s}}else{let a=Pt(i.mul(new ae(r.transferFeeBasisPoints)),new ae(qe)),u=a.gt(o)?o:a;return{amount:i,fee:u,expirationTime:s}}}function we(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=ie($({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new ae(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===qe){let u=new ae(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:a}}else{let u=Pt(i.mul(new ae(qe)),new ae(qe-o.transferFeeBasisPoints)),c=new ae(o.maximumFee.toString()),l=u.sub(i).gt(c)?i.add(c):u,m=Pt(l.mul(new ae(o.transferFeeBasisPoints)),new ae(qe)),p=m.gt(s)?s:m;return{amount:l,fee:p,expirationTime:a}}else{let u=Pt(i.mul(new ae(o.transferFeeBasisPoints)),new ae(qe)),c=u.gt(s)?s:u;return{amount:i,fee:c,expirationTime:a}}}function mt(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function Pt(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new ae(0))?t.add(new ae(1)):t}import{TOKEN_PROGRAM_ID as zn,TOKEN_2022_PROGRAM_ID as Un}from"@solana/spl-token";import{PublicKey as Oe,TransactionInstruction as Qn,SystemProgram as Ji}from"@solana/web3.js";import Xn from"bn.js";import{PublicKey as mp}from"@solana/web3.js";import Ge from"bn.js";var ue=new Ge(0),Ke=new Ge(1),Ze=new Ge(-1),Ce=new Ge(1).shln(64),Zt=new Ge(1).shln(128),In=Ce.sub(Ke),Nt=64,Ai=Zt.subn(1),Ae=-443636,Pe=-Ae,je=new Ge("4295048016"),Je=new Ge("79226673521066979257578248091"),hi=16,Pi="59543866431248",Ti="184467440737095516",xi="15793534762490258745",jt=new Ge(10).pow(new Ge(6));var ul=new Ge("18446744073700000000");import V from"bn.js";function Jt(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Bn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Sn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Lt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function Ii(i,e){return Lt(i,e)?null:Bn(i,e)}function Bi(i,e){return Lt(i,e)?null:Sn(i,e)}var fl=Buffer.from("amm_config","utf8"),Ko=Buffer.from("pool","utf8"),Co=Buffer.from("pool_vault","utf8"),No=Buffer.from("pool_reward_vault","utf8"),Si=Buffer.from("position","utf8"),Lo=Buffer.from("tick_array","utf8"),Ro=Buffer.from("operation","utf8"),Oo=Buffer.from("pool_tick_array_bitmap_extension","utf8");function Ki(i,e,t,n){return Le([Ko,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function Kn(i,e,t){return Le([Co,e.toBuffer(),t.toBuffer()],i)}function Ci(i,e,t){return Le([No,e.toBuffer(),t.toBuffer()],i)}function Y(i,e,t){return Le([Lo,e.toBuffer(),Jt(t)],i)}function dt(i,e,t,n){return Le([Si,e.toBuffer(),Jt(t),Jt(n)],i)}function Ue(i,e){return Le([Si,e.toBuffer()],i)}function $t(i){return Le([Buffer.from("metadata","utf8"),ht.toBuffer(),i.toBuffer()],ht)}function en(i){return Le([Ro],i)}function Xe(i,e){return Le([Oo,e.toBuffer()],i)}import{PublicKey as vi}from"@solana/web3.js";import oe from"bn.js";import jo from"bn.js";import{PublicKey as qo}from"@solana/web3.js";import Oi,{isBN as Mi}from"bn.js";import{bits as gl,BitStructure as kl,blob as Mo,Blob as wl,cstr as Al,f32 as hl,f32be as Pl,f64 as Tl,f64be as xl,greedy as Il,Layout as Fo,ns64 as Bl,ns64be as Sl,nu64 as Kl,nu64be as Cl,offset as Nl,s16 as Ll,s16be as Rl,s24 as Ol,s24be as Ml,s32 as Eo,s32be as Fl,s40 as El,s40be as Wl,s48 as vl,s48be as Dl,s8 as Vl,seq as Wo,struct as _l,Structure as vo,u16 as Do,u16be as ql,u24 as Gl,u24be as Ul,u32 as Xl,u32be as zl,u40 as Ql,u40be as Hl,u48 as Yl,u48be as Zl,u8 as Vo,UInt as _o,union as jl,Union as Jl,unionLayoutDiscriminator as $l,utf8 as em}from"@solana/buffer-layout";var Cn=Fo,Ni=vo;var Nn=_o;var Li=Vo,Tt=Do;var be=Eo;var Ri=Wo;var Re=Mo;var Rt=class extends Cn{constructor(t,n,r){super(t,r);this.blob=Re(t),this.signed=n}decode(t,n=0){let r=new Oi(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Oi(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function q(i){return new Nn(1,i)}function $e(i){return new Nn(4,i)}function y(i){return new Rt(8,!1,i)}function M(i){return new Rt(16,!1,i)}function Fi(i){return new Rt(16,!0,i)}var tn=class extends Cn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function R(i){return new tn(Re(32),e=>new qo(e),e=>e.toBuffer(),i)}function ze(i){return new tn(Li(),Go,Uo,i)}function Go(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function Uo(i){return i?1:0}var Ln=class extends Ni{decode(e,t){return super.decode(e,t)}};function E(i,e,t){return new Ln(i,e,t)}function J(i,e,t){let n,r=typeof e=="number"?e:Mi(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Mi(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Ri(i,r,t)}var Rn=14,et=class{static maxTickInTickarrayBitmap(e){return e*le*pt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!G.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-G.tickCount(n):t+G.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*le,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(r){let l=e.shln(1024-c-1),m=Ii(1024,l);if(m!==null){let p=(c-m-512)*a;return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=Bi(1024,l);if(m!==null){let p=(c+m-512)*a;return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:o-G.tickCount(n)}}}},Ot=class{static getBitmapOffset(e,t){if(!G.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=et.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=et.maxTickInTickarrayBitmap(e),n=-t;if(Pe<=t)throw Error(`extensionTickBoundary check error: ${Pe}, ${t}`);if(n<=Ae)throw Error(`extensionTickBoundary check error: ${n}, ${Ae}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:S.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=G.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=et.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let u=S.mergeTickArrayBitmap(e).shln(pt-1-a),c=Lt(512,u)?null:Bn(512,u);if(c!==null){let l=t-c*G.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=S.mergeTickArrayBitmap(e).shrn(a),c=Lt(512,u)?null:Sn(512,u);if(c!==null){let l=t+c*G.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-G.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%et.maxTickInTickarrayBitmap(t),r=Math.floor(n/G.tickCount(t));return e<0&&n!=0&&(r=pt-r),r}};var hm=E([Re(8),q("bump"),Tt("index"),R(""),$e("protocolFeeRate"),$e("tradeFeeRate"),Tt("tickSpacing"),J(y(),8,"")]),Xo=E([$e("blockTimestamp"),M("sqrtPriceX64"),M("cumulativeTimePriceX64"),J(M(),1,"")]),On=E([Re(8),ze("initialized"),R("poolId"),J(Xo,1e3,"observations"),J(M(),5,"")]),zo=E([q("rewardState"),y("openTime"),y("endTime"),y("lastUpdateTime"),M("emissionsPerSecondX64"),y("rewardTotalEmissioned"),y("rewardClaimed"),R("tokenMint"),R("tokenVault"),R("creator"),M("rewardGrowthGlobalX64")]),Pm=E([Re(8),q("bump"),R("ammConfig"),R("creator"),R("mintA"),R("mintB"),R("vaultA"),R("vaultB"),R("observationId"),q("mintDecimalsA"),q("mintDecimalsB"),Tt("tickSpacing"),M("liquidity"),M("sqrtPriceX64"),be("tickCurrent"),Tt("observationIndex"),Tt("observationUpdateDuration"),M("feeGrowthGlobalX64A"),M("feeGrowthGlobalX64B"),y("protocolFeesTokenA"),y("protocolFeesTokenB"),M("swapInAmountTokenA"),M("swapOutAmountTokenB"),M("swapInAmountTokenB"),M("swapOutAmountTokenA"),q("status"),J(q(),7,""),J(zo,3,"rewardInfos"),J(y(),16,"tickArrayBitmap"),y("totalFeesTokenA"),y("totalFeesClaimedTokenA"),y("totalFeesTokenB"),y("totalFeesClaimedTokenB"),y("fundFeesTokenA"),y("fundFeesTokenB"),y("startTime"),J(y(),15*4-3,"padding")]),Qo=E([M("growthInsideLastX64"),y("rewardAmountOwed")]),Ei=E([Re(8),q("bump"),R("nftMint"),R("poolId"),be("tickLower"),be("tickUpper"),M("liquidity"),M("feeGrowthInsideLastX64A"),M("feeGrowthInsideLastX64B"),y("tokenFeesOwedA"),y("tokenFeesOwedB"),J(Qo,3,"rewardInfos"),J(y(),8,"")]),Tm=E([Re(8),q("bump"),R("poolId"),be("tickLowerIndex"),be("tickUpperIndex"),M("liquidity"),M("feeGrowthInsideLastX64A"),M("feeGrowthInsideLastX64B"),y("tokenFeesOwedA"),y("tokenFeesOwedB"),J(M(),3,"rewardGrowthInside"),J(y(),8,"")]),Ho=E([be("tick"),Fi("liquidityNet"),M("liquidityGross"),M("feeGrowthOutsideX64A"),M("feeGrowthOutsideX64B"),J(M(),3,"rewardGrowthsOutsideX64"),J($e(),13,"")]),Mt=E([Re(8),R("poolId"),be("startTickIndex"),J(Ho,le,"ticks"),q("initializedTickCount"),J(q(),115,"")]),Yo=E([Re(329),J(R(),100,"whitelistMints")]),Wi=E([Re(8),R("poolId"),J(J(y(),8),Rn,"positiveTickArrayBitmap"),J(J(y(),8),Rn,"negativeTickArrayBitmap")]);var Zo=15,G=class{static async getTickArrays(e,t,n,r,o,s,a){let u=[],c=S.getTickArrayStartIndexByTick(r,o),l=S.getInitializedTickArrayInRange(s,a,o,c,Math.floor(Zo/2));for(let d=0;d<l.length;d++){let{publicKey:b}=Y(t,n,l[d]);u.push(b)}let m=(await lt(e,u)).map(d=>d!==null?Mt.decode(d.data):null),p={};for(let d=0;d<u.length;d++){let b=m[d];b!==null&&(p[b.startTickIndex]=ie($({},b),{address:u[d]}))}return p}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=S.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:p,tickArrayStartTickIndex:d}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,p,d]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/G.tickCount(t)),a=n?S.searchLowBitFromStart(r,o,s-1,1,t):S.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=le-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<le;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=Y(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=S.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let p=c.ticks[u];if(p.liquidityGross.gtn(0)){l=p;break}u=u-1}else for(u=u+1;u<le;){let p=c.ticks[u];if(p.liquidityGross.gtn(0)){l=p;break}u=u+1}let{publicKey:m}=Y(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(S.checkIsOutOfBoundary(e)){if(e>Pe)return!1;let n=S.getTickArrayStartIndexByTick(Ae,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return le*e}};var le=60,pt=512,S=class{static getTickArrayAddressByTick(e,t,n,r){let o=S.getTickArrayStartIndexByTick(n,r),{publicKey:s}=Y(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=S.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=le)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=G.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*G.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*le,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*le,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*le:e+t*le}static mergeTickArrayBitmap(e){let t=new jo(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*le));return[...S.searchLowBitFromStart(e,t,s-1,o,n),...S.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return S.searchHightBitFromStart(e,t,0,pt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=S.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of a){let{publicKey:c}=Y(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>S.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===r)break}let u=G.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>S.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===r)break}let u=G.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<Ae||e>Pe}static nextInitTick(e,t,n,r,o){if(G.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<le;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=le-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<le;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=W.getSqrtPriceX64FromTick(t),o=W.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new N(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new N(1).div(t),o=ft.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=W.getSqrtPriceX64FromTick(o),a=W.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new N(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=W.getSqrtPriceX64FromTick(t),o=W.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new N(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new N(1).div(t),o=ft.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=W.getSqrtPriceX64FromTick(o),a=W.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new N(1).div(a)}}};import Qe from"bn.js";var Ft=class{static getfeeGrowthInside(e,t,n){let r=new Qe(0),o=new Qe(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new Qe(0),a=new Qe(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=v.wrappingSubU128(v.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),c=v.wrappingSubU128(v.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=v.mulDivFloor(v.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ce),u=t.tokenFeesOwedA.add(a),c=v.mulDivFloor(v.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ce),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=v.mulDivFloor(v.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ce),u=t.tokenFeesOwedA.add(a),c=v.mulDivFloor(v.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ce),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=v.wrappingSubU128(u,c.growthInsideLastX64),m=v.mulDivFloor(l,t.liquidity,Ce),p=c.rewardAmountOwed.add(m);o.push(p)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=v.wrappingSubU128(u,c.growthInsideLastX64),m=v.mulDivFloor(l,t.liquidity,Ce),p=c.rewardAmountOwed.add(m);o.push(p)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Qe(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Qe(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(v.wrappingSubU128(v.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Qe(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Qe(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(v.wrappingSubU128(v.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var g,w,P,A;let a=W.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),u=W.getSqrtPriceX64FromTick(t.tickLower),c=W.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=U.getAmountsFromLiquidity(a,u,c,n,o),[p,d]=[we(m.amountA,(g=e.mintA.extensions)==null?void 0:g.feeConfig,s,!0),we(m.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)],[b,f]=[we(new Qe(new N(m.amountA.toString()).mul(l).toFixed(0)),(P=e.mintA.extensions)==null?void 0:P.feeConfig,s,!0),we(new Qe(new N(m.amountB.toString()).mul(l).toFixed(0)),(A=e.mintB.extensions)==null?void 0:A.feeConfig,s,!0)];return{liquidity:n,amountA:p,amountB:d,amountSlippageA:b,amountSlippageB:f,expirationTime:mt(p.expirationTime,d.expirationTime)}}};var he=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o){let s=n.equals(e.mintA.mint),a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");a.push(l);let{amountCalculated:m,accounts:p,sqrtPriceX64:d,feeAmount:b}=bt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,c,o);return a.push(...p),{expectedAmountOut:m.mul(Ze),remainingAccounts:a,executionPrice:d,feeAmount:b}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.equals(e.mintB.mint),a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:g}=Y(e.programId,e.id,f.nextStartIndex);a.push(g)}}catch{}a.push(l);let{amountCalculated:m,accounts:p,sqrtPriceX64:d,feeAmount:b}=bt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(Ze),c,o);return a.push(...p),{expectedAmountIn:m,remainingAccounts:a,executionPrice:d,feeAmount:b}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=he.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Ot.checkTickArrayIsInit(G.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):S.checkTickArrayIsInitialized(S.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=Y(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,G.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=Y(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/G.tickCount(e.tickSpacing)),r=t?S.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):S.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=G.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=et.nextInitializedTickArrayStartIndex(S.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Ot.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Ae||t>Pe)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],p=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(p===void 0)throw Error("get new reward mint info error");let d=ie($({},m),{perSecond:v.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new vi(p)});if(d.tokenMint.equals(vi.default))continue;if(n<=d.openTime.toNumber()||r.eq(ue)){s.push(d);continue}let b=new oe(Math.min(d.endTime.toNumber(),n)),f=b.sub(d.lastUpdateTime),g=v.mulDivFloor(f,d.emissionsPerSecondX64,r),w=d.rewardGrowthGlobalX64.add(g),P=v.mulDivFloor(f,d.emissionsPerSecondX64,Ce),A=d.rewardTotalEmissioned.add(P);s.push(ie($({},d),{rewardGrowthGlobalX64:w,rewardTotalEmissioned:A,lastUpdateTime:b}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=S.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=et.maxTickInTickarrayBitmap(e),n=-t;return t>Pe&&(t=G.getArrayStartIndex(Pe,e)+G.tickCount(e)),n<Ae&&(n=G.getArrayStartIndex(Ae,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!G.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/G.tickCount(t)*pt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await xn(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=Wi.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=S.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=S.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:p}=Y(u.programId,u.id,m);o.push({pubkey:p}),r[p.toString()]=u.id}}let s=await xn(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=Mt.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]=ie($({},l),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(p=>p.accountInfo.mint),c=[];for(let p of u)for(let d of s)c.push(Ue(d,p).publicKey);let l=await lt(t,c,{batchRequest:r}),m={};for(let p of l){if(p===null)continue;let d=Ei.decode(p.data),b=d.poolId.toString(),f=e.find(_=>_.state.id.toBase58()===b);if(f===void 0)continue;let g=f.state,w=S._getTickPriceLegacy({poolInfo:g,tick:d.tickLower,baseIn:!0}),P=S._getTickPriceLegacy({poolInfo:g,tick:d.tickUpper,baseIn:!0}),{amountA:A,amountB:x}=U.getAmountsFromLiquidity(g.sqrtPriceX64,w.tickSqrtPriceX64,P.tickSqrtPriceX64,d.liquidity,!1),h=1/(1-Math.sqrt(Math.sqrt(w.price.div(P.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:d.poolId,nftMint:d.nftMint,priceLower:w.price,priceUpper:P.price,amountA:A,amountB:x,tickLower:d.tickLower,tickUpper:d.tickUpper,liquidity:d.liquidity,feeGrowthInsideLastX64A:d.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:d.feeGrowthInsideLastX64B,tokenFeesOwedA:d.tokenFeesOwedA,tokenFeesOwedB:d.tokenFeesOwedB,rewardInfos:d.rewardInfos.map(_=>ie($({},_),{pendingReward:new oe(0)})),leverage:h,tokenFeeAmountA:new oe(0),tokenFeeAmountB:new oe(0)}];let L=await S.getTickArrayAddressByTick(f.state.programId,d.poolId,d.tickLower,f.state.tickSpacing),F=await S.getTickArrayAddressByTick(f.state.programId,d.poolId,d.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${d.poolId.toString()}-${d.tickLower}`]=L,m[`${f.state.programId.toString()}-${d.poolId.toString()}-${d.tickUpper}`]=F}if(o){let p=Object.values(m),d=await lt(t,p,{batchRequest:r}),b={};for(let f=0;f<p.length;f++){let g=d[f];if(g===null)continue;let w=p[f].toString();b[w]=Mt.decode(g.data)}for(let{state:f,positionAccount:g}of e)if(!!g)for(let w of g){let P=`${f.programId.toString()}-${f.id.toString()}-${w.tickLower}`,A=`${f.programId.toString()}-${f.id.toString()}-${w.tickUpper}`,x=b[m[P].toString()],h=b[m[A].toString()],L=x.ticks[S.getTickOffsetInArray(w.tickLower,f.tickSpacing)],F=h.ticks[S.getTickOffsetInArray(w.tickUpper,f.tickSpacing)],{tokenFeeAmountA:_,tokenFeeAmountB:Z}=await Ft.GetPositionFees(f,w,L,F),z=await Ft.GetPositionRewards(f,w,L,F);w.tokenFeeAmountA=_.gte(new oe(0))?_:new oe(0),w.tokenFeeAmountB=Z.gte(new oe(0))?Z:new oe(0);for(let Q=0;Q<z.length;Q++)w.rewardInfos[Q].pendingReward=z[Q].gte(new oe(0))?z[Q]:new oe(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,token2022Infos:r,epochInfo:o,amountIn:s,slippage:a,priceLimit:u=new N(0)}){var Z,z,Q,Te;let c;u.equals(new N(0))?c=n.equals(e.mintA.mint)?je.add(new oe(1)):Je.sub(new oe(1)):c=W.priceToSqrtPriceX64(u,e.mintA.decimals,e.mintB.decimals);let l=Ct(s,(Z=r[n.toString()])==null?void 0:Z.feeConfig,o,!1),{expectedAmountOut:m,remainingAccounts:p,executionPrice:d,feeAmount:b}=he.getOutputAmountAndRemainAccounts(e,t,n,l.amount.sub((z=l.fee)!=null?z:ue),c),f=e.mintA.mint.equals(n)?e.mintB.mint:e.mintA.mint,g=Ct(m,(Q=r[f.toString()])==null?void 0:Q.feeConfig,o,!1),w=W.sqrtPriceX64ToPrice(d,e.mintA.decimals,e.mintB.decimals),P=n.equals(e.mintA.mint)?w:new N(1).div(w),A=m.mul(new oe(Math.floor((1-a)*1e10))).div(new oe(1e10)),x=Ct(A,(Te=r[f.toString()])==null?void 0:Te.feeConfig,o,!1),h=e.mintA.mint.equals(n)?e.currentPrice:new N(1).div(e.currentPrice),L=new N(P).sub(h).abs(),F=h,_=new Ye(new N(L).mul(10**15).toFixed(0),new N(F).mul(10**15).toFixed(0));return{realAmountIn:l,amountOut:g,minAmountOut:x,expirationTime:mt(l.expirationTime,g.expirationTime),currentPrice:e.currentPrice,executionPrice:P,priceImpact:_,fee:b,remainingAccounts:p}}static async computeAmountOutFormat({poolInfo:e,tickArrayCache:t,token2022Infos:n,amountIn:r,tokenOut:o,slippage:s,epochInfo:a}){let u=r.token.equals(Ee.WSOL)?kt:r.token.mint,c=s.numerator.toNumber()/s.denominator.toNumber(),l=o.mint.equals(ot)?new Ee({mint:"sol",decimals:Xt.decimals}):o,{realAmountIn:m,amountOut:p,minAmountOut:d,expirationTime:b,currentPrice:f,executionPrice:g,priceImpact:w,fee:P,remainingAccounts:A}=await he.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:u,amountIn:r.raw,slippage:c,token2022Infos:n,epochInfo:a}),x=ie($({},m),{amount:new fe(r.token,m.amount),fee:m.fee===void 0?void 0:new fe(r.token,m.fee)}),h=ie($({},p),{amount:new fe(l,p.amount),fee:p.fee===void 0?void 0:new fe(l,p.fee)}),L=ie($({},d),{amount:new fe(l,d.amount),fee:d.fee===void 0?void 0:new fe(l,d.fee)}),F=new Ne({baseToken:r.token,denominator:new oe(10).pow(new oe(20+r.token.decimals)),quoteToken:l,numerator:f.mul(new N(10**(20+l.decimals))).toFixed(0)}),_=new Ne({baseToken:r.token,denominator:new oe(10).pow(new oe(20+r.token.decimals)),quoteToken:l,numerator:g.mul(new N(10**(20+l.decimals))).toFixed(0)}),Z=new fe(r.token,P);return{realAmountIn:x,amountOut:h,minAmountOut:L,expirationTime:b,currentPrice:F,executionPrice:_,priceImpact:w,fee:Z,remainingAccounts:A}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var b,f,g;let o=e[t],s=S.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=S.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,p=o.priceMax-o.priceMin,d;return l<=0?d=0:m===l?d=p/l:p===l?d=l/m:d=l/p*(l/m),{feeApr:o.feeApr*d,rewardsApr:[(b=o.rewardApr[0])!=null?b:0*d,(f=o.rewardApr[1])!=null?f:0*d,(g=o.rewardApr[2])!=null?g:0*d],apr:o.apr*d}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[Ut(e.mintA.address).toString()],p=r[Ut(e.mintB.address).toString()],d=e.mintA.decimals,b=e.mintB.decimals;if(!l||!m||!p)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=W.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),g=W.getSqrtPriceX64FromTick(s),w=W.getSqrtPriceX64FromTick(a),{amountSlippageA:P,amountSlippageB:A}=U.getAmountsFromLiquidityWithSlippage(f,g,w,t,!1,!1,0),{amountSlippageA:x,amountSlippageB:h}=U.getAmountsFromLiquidityWithSlippage(f,g,w,o,!1,!1,0),L=new N(P.toString()).div(new N(10).pow(d)).mul(m.value).add(new N(A.toString()).div(new N(10).pow(b)).mul(p.value)),F=new N(x.toString()).div(new N(10).pow(d)).mul(m.value).add(new N(h.toString()).div(new N(10).pow(b)).mul(p.value)),_=F.div(L.add(F)).div(F),z=new N(l.volumeFee).mul(365).div(c).mul(_).mul(100).toNumber(),Q=3600*24*365,Te=e.rewardDefaultInfos.map(de=>{var H,Hn;let xe=de.mint.decimals,ne=r[de.mint.address];return u<((H=de.startTime)!=null?H:0)||u>((Hn=de.endTime)!=null?Hn:0)||!de.perSecond||!ne||xe===void 0?0:new N(ne.value).mul(new N(de.perSecond).mul(Q)).div(new N(10).pow(xe)).mul(_).mul(100).toNumber()});return{feeApr:z,rewardsApr:Te,apr:z+Te.reduce((de,xe)=>de+xe,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var w,P;let l=W.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),m=W.getSqrtPriceX64FromTick(n),p=W.getSqrtPriceX64FromTick(r),d=a?1-s:1+s,b=we(o,(w=e[t?"mintA":"mintB"].extensions)==null?void 0:w.feeConfig,u,!c),f=new oe(new N(b.amount.sub((P=b.fee)!=null?P:ue).toString()).mul(d).toFixed(0)),g;if(l.lte(m))g=t?U.getLiquidityFromTokenAmountA(m,p,f,!a):new oe(0);else if(l.lte(p)){let A=U.getLiquidityFromTokenAmountA(l,p,f,!a),x=U.getLiquidityFromTokenAmountB(m,l,f);g=t?A:x}else g=t?new oe(0):U.getLiquidityFromTokenAmountB(m,p,f);return he.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:g,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var g,w,P,A;let u=W.getSqrtPriceX64FromTick(n),c=W.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=U.getAmountsFromLiquidity(W.priceToSqrtPriceX64(new N(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[p,d]=[we(m.amountA,(g=t.mintA.extensions)==null?void 0:g.feeConfig,e,!0),we(m.amountB,(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)],[b,f]=[we(m.amountA.muln(l),(P=t.mintA.extensions)==null?void 0:P.feeConfig,e,!0),we(m.amountB.muln(l),(A=t.mintB.extensions)==null?void 0:A.feeConfig,e,!0)];return{liquidity:o,amountA:p,amountB:d,amountSlippageA:b,amountSlippageB:f,expirationTime:mt(p.expirationTime,d.expirationTime)}}};var v=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(ue)||(o=o.add(Ke)),o}static mulDivFloor(e,t,n){if(n.eq(ue))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ue))throw new Error("division by 0");return e.mul(t).add(n.sub(Ke)).div(n)}static x64ToDecimal(e,t){return new N(e.toString()).div(N.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new V(e.mul(N.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Zt).sub(t).mod(Zt)}};function me(i,e){return Mn(i.mul(e),64,256)}function Jo(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Mn(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var W=class{static sqrtPriceX64ToPrice(e,t,n){return v.x64ToDecimal(e).pow(2).mul(N.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return v.decimalToX64(e.mul(N.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(ue))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ue))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(ue))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ue))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(ue))return e;let o=t.shln(Nt);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?v.mulDivCeil(s,e,a):v.mulDivRoundingUp(s,Ke,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return v.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Nt);if(r)return e.add(o.div(t));{let s=v.mulDivRoundingUp(o,Ke,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Ae||e>Pe)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new V("18445821805675395072"):new V("18446744073709551616");return(t&2)!=0&&(n=me(n,new V("18444899583751176192"))),(t&4)!=0&&(n=me(n,new V("18443055278223355904"))),(t&8)!=0&&(n=me(n,new V("18439367220385607680"))),(t&16)!=0&&(n=me(n,new V("18431993317065453568"))),(t&32)!=0&&(n=me(n,new V("18417254355718170624"))),(t&64)!=0&&(n=me(n,new V("18387811781193609216"))),(t&128)!=0&&(n=me(n,new V("18329067761203558400"))),(t&256)!=0&&(n=me(n,new V("18212142134806163456"))),(t&512)!=0&&(n=me(n,new V("17980523815641700352"))),(t&1024)!=0&&(n=me(n,new V("17526086738831433728"))),(t&2048)!=0&&(n=me(n,new V("16651378430235570176"))),(t&4096)!=0&&(n=me(n,new V("15030750278694412288"))),(t&8192)!=0&&(n=me(n,new V("12247334978884435968"))),(t&16384)!=0&&(n=me(n,new V("8131365268886854656"))),(t&32768)!=0&&(n=me(n,new V("3584323654725218816"))),(t&65536)!=0&&(n=me(n,new V("696457651848324352"))),(t&131072)!=0&&(n=me(n,new V("26294789957507116"))),(t&262144)!=0&&(n=me(n,new V("37481735321082"))),e>0&&(n=Ai.div(n)),n}static getTickFromPrice(e,t,n){return W.getTickFromSqrtPriceX64(W.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Je)||e.lt(je))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new V(t-64),r=Jo(n,32,128),o=new V("8000000000000000","hex"),s=0,a=new V(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new V(0))&&s<hi;){u=u.mul(u);let b=u.shrn(127);u=u.shrn(63+b.toNumber()),a=a.add(o.mul(b)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=r.add(c).mul(new V(Pi)),p=Mn(m.sub(new V(Ti)),64,128).toNumber(),d=Mn(m.add(new V(xi)),64,128).toNumber();return p==d?p:W.getSqrtPriceX64FromTick(d).lte(e)?d:p}},ft=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=W.getTickFromSqrtPriceX64(W.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=ft.getTickWithPriceAndTickspacing(e,t,n,r),s=W.getSqrtPriceX64FromTick(o);return W.sqrtPriceX64ToPrice(s,n,r)}},U=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ue))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Nt),s=t.sub(e);return r?v.mulDivRoundingUp(v.mulDivCeil(o,s,t),Ke,e):v.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ue))throw new Error("sqrtPriceX64A must greater than 0");return r?v.mulDivCeil(n,t.sub(e),Ce):v.mulDivFloor(n,t.sub(e),Ce)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?v.mulDivRoundingUp(a,Ke,In):a.shrn(Nt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),v.mulDivFloor(n,In,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return U.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=U.getLiquidityFromTokenAmountA(e,n,r,!1),a=U.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return U.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:U.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new V(0)};if(e.lt(n)){let s=U.getTokenAmountAFromLiquidity(e,n,r,o),a=U.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new V(0),amountB:U.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:u,amountB:c}=U.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new V(new N(u.toString()).mul(l).toFixed(0)),p=new V(new N(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:p}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var P,A,x,h;let c=W.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),l=W.getSqrtPriceX64FromTick(t),m=W.getSqrtPriceX64FromTick(n),p=s?1+o:1-o,d=U.getAmountsFromLiquidity(c,l,m,r,s),[b,f]=[we(d.amountA,(P=e.mintA.extensions)==null?void 0:P.feeConfig,a,u),we(d.amountB,(A=e.mintB.extensions)==null?void 0:A.feeConfig,a,u)],[g,w]=[we(new V(new N(d.amountA.toString()).mul(p).toFixed(0)),(x=e.mintA.extensions)==null?void 0:x.feeConfig,a,u),we(new V(new N(d.amountB.toString()).mul(p).toFixed(0)),(h=e.mintB.extensions)==null?void 0:h.feeConfig,a,u)];return{liquidity:r,amountA:b,amountB:f,amountSlippageA:g,amountSlippageB:w,expirationTime:mt(b.expirationTime,f.expirationTime)}}},bt=class{static swapCompute(e,t,n,r,o,s,a,u,c,l,m,p,d,b){if(p.eq(ue))throw new Error("amountSpecified must not be 0");if(b||(b=s?je.add(Ke):Je.sub(Ke)),s){if(b.lt(je))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(b.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(b.gt(Je))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(b.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let f=p.gt(ue),g={amountSpecifiedRemaining:p,amountCalculated:ue,sqrtPriceX64:m,tick:c>d?Math.min(d+G.tickCount(l)-1,c):d,accounts:[],liquidity:u,feeAmount:new V(0)},w=d,P=n[d],A=0,x=!s&&P.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(ue)&&!g.sqrtPriceX64.eq(b);){if(A>10)throw Error("liquidity limit");let h={};h.sqrtPriceStartX64=g.sqrtPriceX64;let L=S.nextInitTick(P,g.tick,l,s,x),F=L||null,_=null;if(!(F!=null&&F.liquidityGross.gtn(0))){let z=he.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},w,s);if(!z.isExist)throw Error("swapCompute LiquidityInsufficient");w=z.nextStartIndex;let{publicKey:Q}=Y(e,t,w);_=Q,P=n[w],F=S.firstInitializedTick(P,s)}h.tickNext=F.tick,h.initialized=F.liquidityGross.gtn(0),d!==w&&_&&(g.accounts.push(_),d=w),h.tickNext<Ae?h.tickNext=Ae:h.tickNext>Pe&&(h.tickNext=Pe),h.sqrtPriceNextX64=W.getSqrtPriceX64FromTick(h.tickNext);let Z;if(s&&h.sqrtPriceNextX64.lt(b)||!s&&h.sqrtPriceNextX64.gt(b)?Z=b:Z=h.sqrtPriceNextX64,[g.sqrtPriceX64,h.amountIn,h.amountOut,h.feeAmount]=bt.swapStepCompute(g.sqrtPriceX64,Z,g.liquidity,g.amountSpecifiedRemaining,a),g.feeAmount=g.feeAmount.add(h.feeAmount),f?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(h.amountIn.add(h.feeAmount)),g.amountCalculated=g.amountCalculated.sub(h.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(h.amountOut),g.amountCalculated=g.amountCalculated.add(h.amountIn.add(h.feeAmount))),g.sqrtPriceX64.eq(h.sqrtPriceNextX64)){if(h.initialized){let z=F.liquidityNet;s&&(z=z.mul(Ze)),g.liquidity=U.addDelta(g.liquidity,z)}x=h.tickNext!=g.tick&&!s&&P.startTickIndex===h.tickNext,g.tick=s?h.tickNext-1:h.tickNext}else if(g.sqrtPriceX64!=h.sqrtPriceStartX64){let z=W.getTickFromSqrtPriceX64(g.sqrtPriceX64);x=z!=g.tick&&!s&&P.startTickIndex===z,g.tick=z}++A}try{let{nextStartIndex:h,isExist:L}=G.nextInitializedTickArray(g.tick,l,s,r,o);L&&d!==h&&(g.accounts.push(Y(e,t,h).publicKey),d=h)}catch{}return{amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new V(0),amountIn:new V(0),amountOut:new V(0),feeAmount:new V(0)},a=e.gte(t),u=r.gte(ue);if(u){let l=v.mulDivFloor(r,jt.sub(new V(o.toString())),jt);s.amountIn=a?U.getTokenAmountAFromLiquidity(t,e,n,!0):U.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=W.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?U.getTokenAmountBFromLiquidity(t,e,n,!1):U.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(Ze).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=W.getNextSqrtPriceX64FromOutput(e,n,r.mul(Ze),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=U.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=U.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:U.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:U.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul(Ze))&&(s.amountOut=r.mul(Ze)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=v.mulDivCeil(s.amountIn,new V(o),jt.sub(new V(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};import{TOKEN_PROGRAM_ID as ye,TOKEN_2022_PROGRAM_ID as ct,ASSOCIATED_TOKEN_PROGRAM_ID as Xi}from"@solana/spl-token";import{PublicKey as T,TransactionInstruction as ve,SystemProgram as xt,Keypair as Vn}from"@solana/web3.js";import zi from"bn.js";import{PublicKey as is,Keypair as rs}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as os}from"@solana/spl-token";import qd from"bn.js";var Di=E([R("mint"),R("owner"),y("amount"),$e("delegateOption"),R("delegate"),q("state"),$e("isNativeOption"),y("isNative"),y("delegatedAmount"),$e("closeAuthorityOption"),R("closeAuthority")]);function $o(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}function Fn(i,...e){if(!$o(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}function En(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function Vi(i,e){Fn(i);let t=e.outputLen;if(i.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var rn=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),We=(i,e)=>i<<32-e|i>>>e;var Sd=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function es(i){if(typeof i!="string")throw new Error(`utf8ToBytes expected string, got ${typeof i}`);return new Uint8Array(new TextEncoder().encode(i))}function Wn(i){return typeof i=="string"&&(i=es(i)),Fn(i),i}var nn=class{clone(){return this._cloneInto()}},Kd={}.toString;function _i(i){let e=n=>i().update(Wn(n)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function ts(i,e,t,n){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,n);let r=BigInt(32),o=BigInt(4294967295),s=Number(t>>r&o),a=Number(t&o),u=n?4:0,c=n?0:4;i.setUint32(e+u,s,n),i.setUint32(e+c,a,n)}var qi=(i,e,t)=>i&e^~i&t,Gi=(i,e,t)=>i&e^i&t^e&t,on=class extends nn{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=rn(this.buffer)}update(e){En(this);let{view:t,buffer:n,blockLen:r}=this;e=Wn(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(r-this.pos,o-s);if(a===r){let u=rn(e);for(;r<=o-s;s+=r)this.process(u,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){En(this),Vi(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let m=s;m<r;m++)t[m]=0;ts(n,r-8,BigInt(this.length*8),o),this.process(n,0);let a=rn(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let c=u/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<c;m++)a.setUint32(4*m,l[m],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:o,destroyed:s,pos:a}=this;return e.length=r,e.pos=a,e.finished=o,e.destroyed=s,r%t&&e.buffer.set(n),e}};var ns=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),at=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ut=new Uint32Array(64),vn=class extends on{constructor(){super(64,32,8,!1),this.A=at[0]|0,this.B=at[1]|0,this.C=at[2]|0,this.D=at[3]|0,this.E=at[4]|0,this.F=at[5]|0,this.G=at[6]|0,this.H=at[7]|0}get(){let{A:e,B:t,C:n,D:r,E:o,F:s,G:a,H:u}=this;return[e,t,n,r,o,s,a,u]}set(e,t,n,r,o,s,a,u){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,t){for(let m=0;m<16;m++,t+=4)ut[m]=e.getUint32(t,!1);for(let m=16;m<64;m++){let p=ut[m-15],d=ut[m-2],b=We(p,7)^We(p,18)^p>>>3,f=We(d,17)^We(d,19)^d>>>10;ut[m]=f+ut[m-7]+b+ut[m-16]|0}let{A:n,B:r,C:o,D:s,E:a,F:u,G:c,H:l}=this;for(let m=0;m<64;m++){let p=We(a,6)^We(a,11)^We(a,25),d=l+p+qi(a,u,c)+ns[m]+ut[m]|0,f=(We(n,2)^We(n,13)^We(n,22))+Gi(n,r,o)|0;l=c,c=u,u=a,a=s+d|0,s=o,o=r,r=n,n=d+f|0}n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,o,s,a,u,c,l)}roundClean(){ut.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Ui=_i(()=>new vn);var zd=se("Raydium_Util");function Dn({fromPublicKey:i,programId:e=os}){let t=rs.generate().publicKey.toBase58().slice(0,32);return{publicKey:ss(i,t,e),seed:t}}function ss(i,e,t){let n=Buffer.concat([i.toBuffer(),Buffer.from(e),t.toBuffer()]),r=Ui(n);return new is(r)}var Qi=se("Raydium_Clmm"),De={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Et=class{static createPoolInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b){let f=E([M("sqrtPriceX64"),y("startTime")]),g=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:xt.programId,isSigner:!1,isWritable:!1},{pubkey:At,isSigner:!1,isWritable:!1}],w=Buffer.alloc(f.span);f.encode({sqrtPriceX64:d,startTime:b},w);let P=Buffer.from([...De.createPool,...w]);return new ve({keys:g,programId:e,data:P})}static async createPoolInstructions(e){let{connection:t,programId:n,owner:r,mintA:o,mintB:s,ammConfigId:a,initialPriceX64:u,startTime:c,forerunCreate:l}=e,m=Dn({fromPublicKey:r,programId:n}),[p,d]=[new T(o.address),new T(s.address)],b=[xt.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:m.seed,newAccountPubkey:m.publicKey,lamports:l?0:await t.getMinimumBalanceForRentExemption(On.span),space:On.span,programId:n})],{publicKey:f}=Ki(n,a,p,d),{publicKey:g}=Kn(n,f,p),{publicKey:w}=Kn(n,f,d);return b.push(this.createPoolInstruction(n,f,r,a,m.publicKey,p,g,new T(o.programId||ye),d,w,new T(s.programId||ye),Xe(n,f).publicKey,u,c)),{signers:[],instructions:b,instructionTypes:[te.CreateAccount,te.ClmmCreatePool],address:{poolId:f,observationId:m.publicKey,mintAVault:g,mintBVault:w},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b,f,g,w,P,A,x,h,L,F,_,Z,z){let Q=E([be("tickLowerIndex"),be("tickUpperIndex"),be("tickArrayLowerStartIndex"),be("tickArrayUpperStartIndex"),M("liquidity"),y("amountMaxA"),y("amountMaxB"),ze("withMetadata"),q("optionBaseFlag"),ze("baseFlag")]),Te=[...z?[{pubkey:z,isSigner:!1,isWritable:!0}]:[]],de=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:At,isSigner:!1,isWritable:!1},{pubkey:xt.programId,isSigner:!1,isWritable:!1},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:Xi,isSigner:!1,isWritable:!1},{pubkey:ht,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...Te],xe=Buffer.alloc(Q.span);Q.encode({tickLowerIndex:P,tickUpperIndex:A,tickArrayLowerStartIndex:x,tickArrayUpperStartIndex:h,liquidity:L,amountMaxA:F,amountMaxB:_,withMetadata:Z==="create",baseFlag:!1,optionBaseFlag:0},xe);let ne=Buffer.from([...De.openPosition,...xe]);return new ve({keys:de,programId:e,data:ne})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[p,d]=[new T(e.programId),new T(e.id)],b;if(l)b=new T((await l(1))[0]);else{let _=Vn.generate();m.push(_),b=_.publicKey}let f=S.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=S.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=Y(p,d,f),{publicKey:P}=Y(p,d,g),{publicKey:A}=_e(n.wallet,b,ye),{publicKey:x}=$t(b),{publicKey:h}=Ue(p,b),{publicKey:L}=dt(p,d,r,o),F=this.openPositionFromLiquidityInstruction(p,n.feePayer,d,n.wallet,b,A,x,L,w,P,h,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),r,o,f,g,s,a,u,c);return{signers:m,instructions:[F],instructionTypes:[te.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:b,tickArrayLower:w,tickArrayUpper:P,positionNftAccount:A,metadataAccount:x,personalPosition:h,protocolPosition:L}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[p,d]=[new T(e.programId),new T(e.id)],b;if(l)b=new T((await l(1))[0]);else{let _=Vn.generate();m.push(_),b=_.publicKey}let f=S.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=S.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=Y(p,d,f),{publicKey:P}=Y(p,d,g),{publicKey:A}=_e(n.wallet,b,ye),{publicKey:x}=$t(b),{publicKey:h}=Ue(p,b),{publicKey:L}=dt(p,d,r,o),F=this.openPositionFromBaseInstruction(p,n.feePayer,d,n.wallet,b,A,x,L,w,P,h,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),r,o,f,g,c,s,a,u,he.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,g])?Xe(p,d).publicKey:void 0);return{address:{nftMint:b,tickArrayLower:w,tickArrayUpper:P,positionNftAccount:A,metadataAccount:x,personalPosition:h,protocolPosition:L},instructions:[F],signers:m,instructionTypes:[te.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b,f,g,w,P,A,x,h,L,F,_,Z,z){let Q=E([be("tickLowerIndex"),be("tickUpperIndex"),be("tickArrayLowerStartIndex"),be("tickArrayUpperStartIndex"),M("liquidity"),y("amountMaxA"),y("amountMaxB"),ze("withMetadata"),q("optionBaseFlag"),ze("baseFlag")]),Te=[...z?[{pubkey:z,isSigner:!1,isWritable:!0}]:[]],de=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:At,isSigner:!1,isWritable:!1},{pubkey:xt.programId,isSigner:!1,isWritable:!1},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:Xi,isSigner:!1,isWritable:!1},{pubkey:ht,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...Te],xe=Buffer.alloc(Q.span);Q.encode({tickLowerIndex:P,tickUpperIndex:A,tickArrayLowerStartIndex:x,tickArrayUpperStartIndex:h,liquidity:new zi(0),amountMaxA:F==="MintA"?_:Z,amountMaxB:F==="MintA"?Z:_,withMetadata:L==="create",baseFlag:F==="MintA",optionBaseFlag:1},xe);let ne=Buffer.from([...De.openPosition,...xe]);return new ve({keys:de,programId:e,data:ne})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,p=[];if(l)m=new T((await l(1))[0]);else{let _=Vn.generate();p.push(_),m=_.publicKey}let[d,b]=[new T(e.programId),new T(e.id)],f=S.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=S.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=Y(d,b,f),{publicKey:P}=Y(d,b,g),{publicKey:A}=_e(n.wallet,m,ye),{publicKey:x}=$t(m),{publicKey:h}=Ue(d,m),{publicKey:L}=dt(d,b,r,o),F=this.openPositionFromLiquidityInstruction(d,n.wallet,b,n.wallet,m,A,x,L,w,P,h,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(t.mintA.address),new T(t.mintB.address),r,o,f,g,s,a,u,c,he.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,g])?Xe(d,b).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:w,tickArrayUpper:P,positionNftAccount:A,metadataAccount:x,personalPosition:h,protocolPosition:L},instructions:[F],signers:p,instructionTypes:[te.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=E([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:xt.programId,isSigner:!1,isWritable:!1},{pubkey:ye,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...De.closePosition,...u]);return new ve({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new T(e.programId),{publicKey:s}=_e(n.wallet,r.nftMint,ye),{publicKey:a}=Ue(o,r.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[te.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b,f,g,w,P){let A=E([M("liquidity"),y("amountMaxA"),y("amountMaxB"),q("optionBaseFlag"),ze("baseFlag")]),x=[...P?[{pubkey:P,isSigner:!1,isWritable:!0}]:[]],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...x],L=Buffer.alloc(A.span);A.encode({liquidity:f,amountMaxA:g,amountMaxB:w,optionBaseFlag:0,baseFlag:!1},L);let F=Buffer.from([...De.increaseLiquidity,...L]);return new ve({keys:h,programId:e,data:F})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new T(e.programId),new T(e.id)],l=S.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=S.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=Y(u,c,l),{publicKey:d}=Y(u,c,m),{publicKey:b}=_e(r.wallet,n.nftMint,ye),{publicKey:f}=Ue(u,n.nftMint),{publicKey:g}=dt(u,c,n.tickLower,n.tickUpper),w=this.increasePositionFromLiquidityInstruction(u,r.wallet,b,f,c,g,p,d,r.tokenAccountA,r.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),o,s,a,he.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Xe(u,c).publicKey:void 0);return{address:{tickArrayLower:p,tickArrayUpper:d,positionNftAccount:b,personalPosition:f,protocolPosition:g},signers:[],instructions:[w],instructionTypes:[te.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new T(e.programId),new T(e.id)],l=S.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=S.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=Y(u,c,l),{publicKey:d}=Y(u,c,m),{publicKey:b}=_e(r.wallet,n.nftMint,ye),{publicKey:f}=Ue(u,n.nftMint),{publicKey:g}=dt(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:p,tickArrayUpper:d,positionNftAccount:b,personalPosition:f,protocolPosition:g},instructions:[this.increasePositionFromBaseInstruction(u,r.wallet,b,f,c,g,p,d,r.tokenAccountA,r.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),o,s,a,he.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Xe(u,c).publicKey:void 0)],signers:[],instructionTypes:[te.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b,f,g,w,P){let A=E([M("liquidity"),y("amountMaxA"),y("amountMaxB"),q("optionBaseFlag"),ze("baseFlag")]),x=[...P?[{pubkey:P,isSigner:!1,isWritable:!0}]:[]],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...x],L=Buffer.alloc(A.span);A.encode({liquidity:new zi(0),amountMaxA:f==="MintA"?g:w,amountMaxB:f==="MintA"?w:g,baseFlag:f==="MintA",optionBaseFlag:1},L);let F=Buffer.from([...De.increaseLiquidity,...L]);return new ve({keys:h,programId:e,data:F})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b,f,g,w,P,A){let x=E([M("liquidity"),y("amountMinA"),y("amountMinB")]),h=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[],...f.map(Z=>[{pubkey:Z.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:Z.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:Z.rewardMint,isSigner:!1,isWritable:!1}]).flat()],L=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:wt,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...h],F=Buffer.alloc(x.span);x.encode({liquidity:g,amountMinA:w,amountMinB:P},F);let _=Buffer.from([...De.decreaseLiquidity,...F]);return new ve({keys:L,programId:e,data:_})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new T(e.programId),new T(e.id)],m=S.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),p=S.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=Y(c,l,m),{publicKey:b}=Y(c,l,p),{publicKey:f}=_e(r.wallet,n.nftMint,u),{publicKey:g}=Ue(c,n.nftMint),{publicKey:w}=dt(c,l,n.tickLower,n.tickUpper),P=[];for(let x=0;x<e.rewardDefaultInfos.length;x++)P.push({poolRewardVault:new T(t.rewardInfos[x].vault),ownerRewardVault:r.rewardAccounts[x],rewardMint:new T(e.rewardDefaultInfos[x].mint.address)});let A=[];return A.push(this.decreaseLiquidityInstruction(c,r.wallet,f,g,l,w,d,b,r.tokenAccountA,r.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),P,o,s,a,he.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,p])?Xe(c,l).publicKey:void 0)),{address:{tickArrayLower:d,tickArrayUpper:b,positionNftAccount:f,personalPosition:g,protocolPosition:w},signers:[],instructions:A,instructionTypes:[te.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b,f,g,w){let P=E([y("amount"),y("otherAmountThreshold"),M("sqrtPriceLimitX64"),ze("isBaseInput")]),A=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...m.map(F=>({pubkey:F,isSigner:!1,isWritable:!0}))],x=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:wt,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...A],h=Buffer.alloc(P.span);P.encode({amount:d,otherAmountThreshold:b,sqrtPriceLimitX64:f,isBaseInput:g},h);let L=Buffer.from([...De.swap,...h]);return new ve({keys:x,programId:e,data:L})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,inputMint:r,amountIn:o,amountOutMin:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new T(e.programId),new T(e.id)],[m,p]=[new T(t.vault.A),new T(t.vault.B)],[d,b]=[new T(e.mintA.address),new T(e.mintB.address)],f=e.mintA.address===r.toString(),g=[this.swapInstruction(c,n.wallet,l,new T(e.config.id),f?n.tokenAccountA:n.tokenAccountB,f?n.tokenAccountB:n.tokenAccountA,f?m:p,f?p:m,f?d:b,f?b:d,u,m,o,s,a,!0,Xe(c,l).publicKey)];return{signers:[],instructions:g,instructionTypes:[te.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,p){let d=E([y("openTime"),y("endTime"),M("emissionsPerSecondX64")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:xt.programId,isSigner:!1,isWritable:!1},{pubkey:At,isSigner:!1,isWritable:!1}],f=Buffer.alloc(d.span);d.encode({openTime:ee(l),endTime:ee(m),emissionsPerSecondX64:p},f);let g=Buffer.from([...De.initReward,...f]);return new ve({keys:b,programId:e,data:g})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new T(e.programId),new T(e.id)],a=Ci(o,s,r.mint).publicKey,u=en(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new T(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[te.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,p){let d=E([q("rewardIndex"),M("emissionsPerSecondX64"),y("openTime"),y("endTime")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(d.span);d.encode({rewardIndex:c,emissionsPerSecondX64:p,openTime:ee(l),endTime:ee(m)},f);let g=Buffer.from([...De.setRewardEmissions,...f]);return new ve({keys:b,programId:e,data:g})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new T(e.programId),new T(e.id)],a,u,c;for(let p=0;p<e.rewardDefaultInfos.length;p++)e.rewardDefaultInfos[p].mint.address===r.mint.toString()&&(a=p,u=new T(t.rewardInfos[p].vault),c=new T(t.rewardInfos[p].mint.address));(a===void 0||u===void 0)&&Qi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=en(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new T(e.config.id),n.tokenAccount,u,c,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[te.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let u=E([q("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:wt,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...De.collectReward,...l]);return new ve({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new T(e.programId),new T(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,u=new T(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&Qi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,r,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[te.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapBaseOutInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,outputMint:r,amountOut:o,amountInMax:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new T(e.programId),new T(e.id)],[m,p]=[new T(t.vault.A),new T(t.vault.B)],[d,b]=[new T(e.mintA.address),new T(e.mintB.address)],f=e.mintA.address===r.toString(),g=[this.swapInstruction(c,n.wallet,l,new T(e.config.id),f?n.tokenAccountB:n.tokenAccountA,f?n.tokenAccountA:n.tokenAccountB,f?p:m,f?m:p,f?d:b,f?b:d,u,m,o,s,a,!1)];return{signers:[],instructions:g,instructionTypes:[te.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}};import Kp from"bn.js";import{TOKEN_PROGRAM_ID as fs,ASSOCIATED_TOKEN_PROGRAM_ID as mf}from"@solana/spl-token";import{PublicKey as pf,TransactionInstruction as Yi,SystemProgram as bs,SYSVAR_RENT_PUBKEY as ff}from"@solana/web3.js";var _n=E([q("instruction"),y("amountIn"),y("minAmountOut")]),qn=E([q("instruction"),y("maxAmountIn"),y("amountOut")]),$p=E([q("instruction"),q("nonce")]),us=E([q("instruction"),q("nonce"),y("startTime")]),ef=E([y("status"),y("nonce"),y("maxOrder"),y("depth"),y("baseDecimal"),y("quoteDecimal"),y("state"),y("resetFlag"),y("minSize"),y("volMaxCutRatio"),y("amountWaveRatio"),y("baseLotSize"),y("quoteLotSize"),y("minPriceMultiplier"),y("maxPriceMultiplier"),y("systemDecimalValue"),y("minSeparateNumerator"),y("minSeparateDenominator"),y("tradeFeeNumerator"),y("tradeFeeDenominator"),y("pnlNumerator"),y("pnlDenominator"),y("swapFeeNumerator"),y("swapFeeDenominator"),y("baseNeedTakePnl"),y("quoteNeedTakePnl"),y("quoteTotalPnl"),y("baseTotalPnl"),y("poolOpenTime"),y("punishPcAmount"),y("punishCoinAmount"),y("orderbookToInitTime"),M("swapBaseInAmount"),M("swapQuoteOutAmount"),y("swapBase2QuoteFee"),M("swapQuoteInAmount"),M("swapBaseOutAmount"),y("swapQuote2BaseFee"),R("baseVault"),R("quoteVault"),R("baseMint"),R("quoteMint"),R("lpMint"),R("openOrders"),R("marketId"),R("marketProgramId"),R("targetOrders"),R("withdrawQueue"),R("lpVault"),R("owner"),y("lpReserve"),J(y(),3,"padding")]),tf=E([y("accountType"),y("status"),y("nonce"),y("maxOrder"),y("depth"),y("baseDecimal"),y("quoteDecimal"),y("state"),y("resetFlag"),y("minSize"),y("volMaxCutRatio"),y("amountWaveRatio"),y("baseLotSize"),y("quoteLotSize"),y("minPriceMultiplier"),y("maxPriceMultiplier"),y("systemDecimalsValue"),y("abortTradeFactor"),y("priceTickMultiplier"),y("priceTick"),y("minSeparateNumerator"),y("minSeparateDenominator"),y("tradeFeeNumerator"),y("tradeFeeDenominator"),y("pnlNumerator"),y("pnlDenominator"),y("swapFeeNumerator"),y("swapFeeDenominator"),y("baseNeedTakePnl"),y("quoteNeedTakePnl"),y("quoteTotalPnl"),y("baseTotalPnl"),y("poolOpenTime"),y("punishPcAmount"),y("punishCoinAmount"),y("orderbookToInitTime"),M("swapBaseInAmount"),M("swapQuoteOutAmount"),M("swapQuoteInAmount"),M("swapBaseOutAmount"),y("swapQuote2BaseFee"),y("swapBase2QuoteFee"),R("baseVault"),R("quoteVault"),R("baseMint"),R("quoteMint"),R("lpMint"),R("modelDataAccount"),R("openOrders"),R("marketId"),R("marketProgramId"),R("targetOrders"),R("owner"),J(y(),64,"padding")]),cs=E([q("instruction"),y("baseAmountIn"),y("quoteAmountIn"),y("fixedSide")]),ls=E([q("instruction"),y("amountIn")]);var nf=E([y("fee")]);import{PublicKey as ms}from"@solana/web3.js";var Gn=new ms("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ds=5e4,ps=E([y("x"),y("y"),y("price")]),uf=E([y("accountType"),y("status"),y("multiplier"),y("validDataCount"),J(ps,ds,"DataElement")]);var Hi=se("Raydium_liquidity_instruction");function ys({poolKeys:i,userKeys:e,amountIn:t,minAmountOut:n},r){let o=ke(i),s=Buffer.alloc(_n.span);_n.encode({instruction:9,amountIn:ee(t),minAmountOut:ee(n)},s);let a=[D({pubkey:fs,isWritable:!1}),D({pubkey:o.id}),D({pubkey:o.authority,isWritable:!1}),D({pubkey:o.openOrders})];return r===4&&a.push(D({pubkey:o.targetOrders})),a.push(D({pubkey:o.vault.A}),D({pubkey:o.vault.B})),r===5&&a.push(D({pubkey:Gn})),a.push(D({pubkey:o.marketProgramId,isWritable:!1}),D({pubkey:o.marketId}),D({pubkey:o.marketBids}),D({pubkey:o.marketAsks}),D({pubkey:o.marketEventQueue}),D({pubkey:o.marketBaseVault}),D({pubkey:o.marketQuoteVault}),D({pubkey:o.marketAuthority,isWritable:!1}),D({pubkey:e.tokenAccountIn}),D({pubkey:e.tokenAccountOut}),D({pubkey:e.owner,isWritable:!1})),new Yi({programId:o.programId,keys:a,data:s})}function gs({poolKeys:i,userKeys:e,maxAmountIn:t,amountOut:n},r){let o=ke(i),s=Buffer.alloc(qn.span);qn.encode({instruction:11,maxAmountIn:ee(t),amountOut:ee(n)},s);let a=[D({pubkey:bs.programId,isWritable:!1}),D({pubkey:o.id}),D({pubkey:o.authority,isWritable:!1}),D({pubkey:o.openOrders}),D({pubkey:o.targetOrders}),D({pubkey:o.vault.A}),D({pubkey:o.vault.B})];return r===5&&a.push(D({pubkey:Gn})),a.push(D({pubkey:o.marketProgramId,isWritable:!1}),D({pubkey:o.marketId}),D({pubkey:o.marketBids}),D({pubkey:o.marketAsks}),D({pubkey:o.marketEventQueue}),D({pubkey:o.marketBaseVault}),D({pubkey:o.marketQuoteVault}),D({pubkey:o.marketAuthority,isWritable:!1}),D({pubkey:e.tokenAccountIn}),D({pubkey:e.tokenAccountOut}),D({pubkey:e.owner,isWritable:!1,isSigner:!0})),new Yi({programId:o.programId,keys:a,data:s})}function Zi(i){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:s}=i;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return ys(ie($({},a),{amountIn:r,minAmountOut:o}),t);if(s==="out")return gs(ie($({},a),{maxAmountIn:r,amountOut:o}),t);Hi.logWithError("invalid params","params",i)}throw Hi.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}function Rf(i,e,t,n,r,o,s,a,u,c,l,m){let p=E([q("instruction"),y("amountIn"),y("amountOut")]),d=[{pubkey:Ji.programId,isSigner:!1,isWritable:!1},{pubkey:zn,isSigner:!1,isWritable:!1},{pubkey:new Oe(t.programId),isSigner:!1,isWritable:!1},{pubkey:new Oe(t.id),isSigner:!1,isWritable:!0},{pubkey:new Oe(n.id),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let f=ke(t);d.push({pubkey:f.config.id,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.A:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.B:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},...m.map(g=>({pubkey:g,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let f=ke(t);d.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:new Oe("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0})}else{let f=ke(t);d.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},...f.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:f.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:f.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0}])}let b=Buffer.alloc(p.span);return p.encode({instruction:4,amountIn:c,amountOut:l},b),new Qn({keys:d,programId:i,data:b})}function Of(i,e,t,n,r,o,s,a,u,c){let l=E([q("instruction")]),m=[{pubkey:Ji.programId,isSigner:!1,isWritable:!1},{pubkey:zn,isSigner:!1,isWritable:!1},{pubkey:new Oe(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new Oe(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new Oe(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let d=ke(n);m.push({pubkey:d.config.id,isSigner:!1,isWritable:!1},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.mintA.address.equals(u)?d.vault.A:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.mintA.address.equals(u)?d.vault.B:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0},...c.map(b=>({pubkey:b,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let d=ke(n);m.push({pubkey:d.authority,isSigner:!1,isWritable:!1},{pubkey:d.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:new Oe("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:d.openOrders,isSigner:!1,isWritable:!0},{pubkey:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.marketId,isSigner:!1,isWritable:!0},{pubkey:d.marketBids,isSigner:!1,isWritable:!0},{pubkey:d.marketAsks,isSigner:!1,isWritable:!0},{pubkey:d.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0})}else{let d=ke(n);m.push({pubkey:d.authority,isSigner:!1,isWritable:!1},{pubkey:d.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:d.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:d.openOrders,isSigner:!1,isWritable:!0},{pubkey:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.marketId,isSigner:!1,isWritable:!0},{pubkey:d.marketBids,isSigner:!1,isWritable:!0},{pubkey:d.marketAsks,isSigner:!1,isWritable:!0},{pubkey:d.marketEventQueue,isSigner:!1,isWritable:!0},...d.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:d.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:d.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0}])}let p=Buffer.alloc(l.span);return l.encode({instruction:5},p),new Qn({keys:m,programId:i,data:p})}function ji(i,e,t,n,r,o){if(i.pooltype.includes("StablePool")){let s=ke(e);return[{pubkey:s.programId,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.authority,isSigner:!1,isWritable:!1},{pubkey:s.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:new Oe("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:s.openOrders,isSigner:!1,isWritable:!0},{pubkey:s.vault.A,isSigner:!1,isWritable:!0},{pubkey:s.vault.B,isSigner:!1,isWritable:!0},{pubkey:s.marketId,isSigner:!1,isWritable:!0},{pubkey:s.marketBids,isSigner:!1,isWritable:!0},{pubkey:s.marketAsks,isSigner:!1,isWritable:!0},{pubkey:s.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0}]}else if(i.type==="Concentrated"){let s=i,a=ke(e),u=s.mintA.address===t;return[{pubkey:new Oe(String(i.programId)),isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a.config.id,isSigner:!1,isWritable:!1},{pubkey:a.id,isSigner:!1,isWritable:!0},{pubkey:u?a.vault.A:a.vault.B,isSigner:!1,isWritable:!0},{pubkey:u?a.vault.B:a.vault.A,isSigner:!1,isWritable:!0},{pubkey:a.id,isSigner:!1,isWritable:!0},...a.mintA.programId.equals(Un)||a.mintB.programId.equals(Un)?[{pubkey:Un,isSigner:!1,isWritable:!1},{pubkey:wt,isSigner:!1,isWritable:!1},{pubkey:u?a.mintA.address:a.mintB.address,isSigner:!1,isWritable:!1},{pubkey:u?a.mintB.address:a.mintA.address,isSigner:!1,isWritable:!1}]:[],...(o!=null?o:[]).map(c=>({pubkey:c,isSigner:!1,isWritable:!0})),{pubkey:Xe(new Oe(String(i.programId)),new Oe(i.id)).publicKey,isSigner:!1,isWritable:!0}]}else{let s=ke(e);return[{pubkey:s.programId,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.authority,isSigner:!1,isWritable:!1},{pubkey:s.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:s.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:s.openOrders,isSigner:!1,isWritable:!0},{pubkey:s.vault.A,isSigner:!1,isWritable:!0},{pubkey:s.vault.B,isSigner:!1,isWritable:!0},{pubkey:s.marketId,isSigner:!1,isWritable:!0},{pubkey:s.marketBids,isSigner:!1,isWritable:!0},{pubkey:s.marketAsks,isSigner:!1,isWritable:!0},{pubkey:s.marketEventQueue,isSigner:!1,isWritable:!0},...s.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:s.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:s.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0}]]}}function ks(i,e,t,n,r,o,s,a,u,c,l,m,p,d){let b=E([q("instruction"),y("amountIn"),y("amountOut")]),f=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:zn,isSigner:!1,isWritable:!1}];f.push(...ji(a,c,o,t,n,d[0])),f.push(...ji(u,l,s,n,r,d[1]));let g=Buffer.alloc(b.span);return b.encode({instruction:8,amountIn:m,amountOut:p},g),new Qn({keys:f,programId:i,data:g})}async function ws({routeProgram:i,ownerInfo:e,inputMint:t,swapInfo:n}){var r,o,s,a,u,c;if(n.routeType==="amm")if(n.poolInfo[0].type==="Concentrated"){let l=ke(n.poolKey[0]),m=t.equals(l.mintA.address)?je.add(Ke):Je.sub(Ke);return await Et.makeSwapBaseInInstructions({poolInfo:l,poolKeys:l,ownerInfo:{wallet:e.wallet,tokenAccountA:l.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:l.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((o=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?o:new Xn(0)),sqrtPriceLimitX64:m,remainingAccounts:n.remainingAccounts[0]})}else{let l=n.poolKey[0];return{signers:[],instructions:[Zi({poolKeys:l,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((a=(s=n.minAmountOut.fee)==null?void 0:s.raw)!=null?a:new Xn(0)),fixedSide:"in"})],lookupTableAddress:l.lookupTableAccount?[l.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?te.AmmV5SwapBaseIn:te.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let l=n.poolInfo[0],m=n.poolInfo[1],p=n.poolKey[0],d=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[ks(i,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.minMiddleAmountFee.token.mint.toString(),l,m,p,d,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((c=(u=n.minAmountOut.fee)==null?void 0:u.raw)!=null?c:new Xn(0)),n.remainingAccounts)],instructionTypes:[te.RouteSwap],lookupTableAddress:[p.lookupTableAccount,d.lookupTableAccount].filter(b=>b!==void 0),address:{}}}else throw Error("route type error")}import{createInitializeAccountInstruction as Ef,createCloseAccountInstruction as Wf,createTransferInstruction as vf,TOKEN_PROGRAM_ID as Df}from"@solana/spl-token";import{PublicKey as Gf,SystemProgram as Xf}from"@solana/web3.js";import Hf from"bn.js";export{ws as makeSwapInstruction,Rf as route1Instruction,Of as route2Instruction,ks as routeInstruction};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=index.mjs.map