var fn=Object.defineProperty,pn=Object.defineProperties;var dn=Object.getOwnPropertyDescriptors;var Le=Object.getOwnPropertySymbols;var At=Object.prototype.hasOwnProperty,St=Object.prototype.propertyIsEnumerable;var xt=(e,t,n)=>t in e?fn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,M=(e,t)=>{for(var n in t||(t={}))At.call(t,n)&&xt(e,n,t[n]);if(Le)for(var n of Le(t))St.call(t,n)&&xt(e,n,t[n]);return e},j=(e,t)=>pn(e,dn(t));var Ce=(e,t)=>{var n={};for(var r in e)At.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&Le)for(var r of Le(e))t.indexOf(r)<0&&St.call(e,r)&&(n[r]=e[r]);return n};import{PublicKey as Ie}from"@solana/web3.js";import{get as kt,set as mn}from"lodash";import It from"dayjs";import gn from"dayjs/plugin/utc";It.extend(gn);var Je=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return It().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let n=t.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(n)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},Bt={},hn={};function F(e){let t=kt(Bt,e);if(!t){let n=kt(hn,e);t=new Je({name:e,logLevel:n}),mn(Bt,e,t)}return t}import{PublicKey as Pe,sendAndConfirmTransaction as gt,Transaction as xe,TransactionMessage as Ae,VersionedTransaction as Se}from"@solana/web3.js";import Vr from"axios";var Xe={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw"};import{PublicKey as ei,ComputeBudgetProgram as Nt,Transaction as Ct,TransactionMessage as bn,Keypair as Dt,VersionedTransaction as Rt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as yn}from"@solana/spl-token";var Lt=F("Raydium_txUtil"),Et=1644;function De(e){let t=[],n=[];return e.microLamports&&(t.push(Nt.setComputeUnitPrice({microLamports:e.microLamports})),n.push(Xe.SetComputeUnitPrice)),e.units&&(t.push(Nt.setComputeUnitLimit({units:e.units})),n.push(Xe.SetComputeUnitLimit)),{instructions:t,instructionTypes:n}}async function ue(e){var t,n;try{return((n=await((t=e.getLatestBlockhash)==null?void 0:t.call(e)))==null?void 0:n.blockhash)||(await e.getRecentBlockhash()).blockhash}catch{return(await e.getRecentBlockhash()).blockhash}}function wn(e,t){e.length<1&&Lt.logWithError(`no instructions provided: ${e.toString()}`),t.length<1&&Lt.logWithError(`no signers provided:, ${t.toString()}`);let n=new Ct;n.recentBlockhash="11111111111111111111111111111111",n.feePayer=t[0],n.add(...e);try{return Buffer.from(n.serialize({verifySignatures:!1})).toString("base64").length<Et}catch{return!1}}function de({instructions:e,payer:t,signers:n}){return wn(e,[t,...n])}function me({instructions:e,payer:t,lookupTableAddressAccount:n,recentBlockhash:r=Dt.generate().publicKey.toString()}){let o=new bn({payerKey:t,recentBlockhash:r,instructions:e}).compileToV0Message(Object.values(n!=null?n:{}));try{return Buffer.from(new Rt(o).serialize()).toString("base64").length<Et}catch{return!1}}var Tn=e=>Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e.buffer,e.byteOffset,e.byteLength):Buffer.from(e);function ie(e){let t=[];return e.forEach(n=>{n instanceof Ct&&(n.recentBlockhash||(n.recentBlockhash=yn.toBase58()),n.feePayer||(n.feePayer=Dt.generate().publicKey));let r=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof Rt&&(r=Tn(r));let i=r.toString("base64");t.push(i)}),console.log("simulate tx string:",t),t}import{PublicKey as rn,AddressLookupTableAccount as je}from"@solana/web3.js";import{PublicKey as Fr}from"@solana/web3.js";import{getTransferFeeConfig as Zs,unpackMint as Js}from"@solana/spl-token";import{PublicKey as Rr}from"@solana/web3.js";import Er from"bn.js";import Lr from"big.js";import qe from"bn.js";import K from"bn.js";var ce=9e15,re=1e9,Qe="0123456789abcdef",Ee="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Me="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",$e={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-ce,maxE:ce,crypto:!1},_t,X,x=!0,Oe="[DecimalError] ",ne=Oe+"Invalid argument: ",Ft=Oe+"Precision limit exceeded",Vt=Oe+"crypto unavailable",Wt="[object Decimal]",_=Math.floor,E=Math.pow,Pn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,xn=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,An=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Kt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,z=1e7,P=7,Sn=9007199254740991,kn=Ee.length-1,et=Me.length-1,m={toStringTag:Wt};m.absoluteValue=m.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),T(e)};m.ceil=function(){return T(new this.constructor(this),this.e+1,2)};m.clampedTo=m.clamp=function(e,t){var n,r=this,i=r.constructor;if(e=new i(e),t=new i(t),!e.s||!t.s)return new i(NaN);if(e.gt(t))throw Error(ne+t);return n=r.cmp(e),n<0?e:r.cmp(t)>0?t:new i(r)};m.comparedTo=m.cmp=function(e){var t,n,r,i,o=this,s=o.d,a=(e=new o.constructor(e)).d,c=o.s,u=e.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==e.e)return o.e>e.e^c<0?1:-1;for(r=s.length,i=a.length,t=0,n=r<i?r:i;t<n;++t)if(s[t]!==a[t])return s[t]>a[t]^c<0?1:-1;return r===i?0:r>i^c<0?1:-1};m.cosine=m.cos=function(){var e,t,n=this,r=n.constructor;return n.d?n.d[0]?(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+P,r.rounding=1,n=Bn(r,Ht(r,n)),r.precision=e,r.rounding=t,T(X==2||X==3?n.neg():n,e,t,!0)):new r(1):new r(NaN)};m.cubeRoot=m.cbrt=function(){var e,t,n,r,i,o,s,a,c,u,l=this,f=l.constructor;if(!l.isFinite()||l.isZero())return new f(l);for(x=!1,o=l.s*E(l.s*l,1/3),!o||Math.abs(o)==1/0?(n=v(l.d),e=l.e,(o=(e-n.length+1)%3)&&(n+=o==1||o==-2?"0":"00"),o=E(n,1/3),e=_((e+1)/3)-(e%3==(e<0?-1:2)),o==1/0?n="5e"+e:(n=o.toExponential(),n=n.slice(0,n.indexOf("e")+1)+e),r=new f(n),r.s=l.s):r=new f(o.toString()),s=(e=f.precision)+3;;)if(a=r,c=a.times(a).times(a),u=c.plus(l),r=C(u.plus(l).times(a),u.plus(c),s+2,1),v(a.d).slice(0,s)===(n=v(r.d)).slice(0,s))if(n=n.slice(s-3,s+1),n=="9999"||!i&&n=="4999"){if(!i&&(T(a,e+1,0),a.times(a).times(a).eq(l))){r=a;break}s+=4,i=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(T(r,e+1,1),t=!r.times(r).times(r).eq(l));break}return x=!0,T(r,e,f.rounding,t)};m.decimalPlaces=m.dp=function(){var e,t=this.d,n=NaN;if(t){if(e=t.length-1,n=(e-_(this.e/P))*P,e=t[e],e)for(;e%10==0;e/=10)n--;n<0&&(n=0)}return n};m.dividedBy=m.div=function(e){return C(this,new this.constructor(e))};m.dividedToIntegerBy=m.divToInt=function(e){var t=this,n=t.constructor;return T(C(t,new n(e),0,1,1),n.precision,n.rounding)};m.equals=m.eq=function(e){return this.cmp(e)===0};m.floor=function(){return T(new this.constructor(this),this.e+1,3)};m.greaterThan=m.gt=function(e){return this.cmp(e)>0};m.greaterThanOrEqualTo=m.gte=function(e){var t=this.cmp(e);return t==1||t===0};m.hyperbolicCosine=m.cosh=function(){var e,t,n,r,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;n=s.precision,r=s.rounding,s.precision=n+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(e=Math.ceil(i/3),t=(1/Fe(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),o=le(s,1,o.times(t),new s(1),!0);for(var c,u=e,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return T(o,s.precision=n,s.rounding=r,!0)};m.hyperbolicSine=m.sinh=function(){var e,t,n,r,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(t=o.precision,n=o.rounding,o.precision=t+Math.max(i.e,i.sd())+4,o.rounding=1,r=i.d.length,r<3)i=le(o,2,i,i,!0);else{e=1.4*Math.sqrt(r),e=e>16?16:e|0,i=i.times(1/Fe(5,e)),i=le(o,2,i,i,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);e--;)s=i.times(i),i=i.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=t,o.rounding=n,T(i,t,n,!0)};m.hyperbolicTangent=m.tanh=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,C(n.sinh(),n.cosh(),r.precision=e,r.rounding=t)):new r(n.s)};m.inverseCosine=m.acos=function(){var e,t=this,n=t.constructor,r=t.abs().cmp(1),i=n.precision,o=n.rounding;return r!==-1?r===0?t.isNeg()?H(n,i,o):new n(0):new n(NaN):t.isZero()?H(n,i+4,o).times(.5):(n.precision=i+6,n.rounding=1,t=t.asin(),e=H(n,i+4,o).times(.5),n.precision=i,n.rounding=o,e.minus(t))};m.inverseHyperbolicCosine=m.acosh=function(){var e,t,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(e=r.precision,t=r.rounding,r.precision=e+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,x=!1,n=n.times(n).minus(1).sqrt().plus(n),x=!0,r.precision=e,r.rounding=t,n.ln()):new r(n)};m.inverseHyperbolicSine=m.asinh=function(){var e,t,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,x=!1,n=n.times(n).plus(1).sqrt().plus(n),x=!0,r.precision=e,r.rounding=t,n.ln())};m.inverseHyperbolicTangent=m.atanh=function(){var e,t,n,r,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(e=o.precision,t=o.rounding,r=i.sd(),Math.max(r,e)<2*-i.e-1?T(new o(i),e,t,!0):(o.precision=n=r-i.e,i=C(i.plus(1),new o(1).minus(i),n+e,1),o.precision=e+4,o.rounding=1,i=i.ln(),o.precision=e,o.rounding=t,i.times(.5))):new o(NaN)};m.inverseSine=m.asin=function(){var e,t,n,r,i=this,o=i.constructor;return i.isZero()?new o(i):(t=i.abs().cmp(1),n=o.precision,r=o.rounding,t!==-1?t===0?(e=H(o,n+4,r).times(.5),e.s=i.s,e):new o(NaN):(o.precision=n+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=n,o.rounding=r,i.times(2)))};m.inverseTangent=m.atan=function(){var e,t,n,r,i,o,s,a,c,u=this,l=u.constructor,f=l.precision,p=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&f+4<=et)return s=H(l,f+4,p).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(f+4<=et)return s=H(l,f+4,p).times(.5),s.s=u.s,s}for(l.precision=a=f+10,l.rounding=1,n=Math.min(28,a/P+2|0),e=n;e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(x=!1,t=Math.ceil(a/P),r=1,c=u.times(u),s=new l(u),i=u;e!==-1;)if(i=i.times(c),o=s.minus(i.div(r+=2)),i=i.times(c),s=o.plus(i.div(r+=2)),s.d[t]!==void 0)for(e=t;s.d[e]===o.d[e]&&e--;);return n&&(s=s.times(2<<n-1)),x=!0,T(s,l.precision=f,l.rounding=p,!0)};m.isFinite=function(){return!!this.d};m.isInteger=m.isInt=function(){return!!this.d&&_(this.e/P)>this.d.length-2};m.isNaN=function(){return!this.s};m.isNegative=m.isNeg=function(){return this.s<0};m.isPositive=m.isPos=function(){return this.s>0};m.isZero=function(){return!!this.d&&this.d[0]===0};m.lessThan=m.lt=function(e){return this.cmp(e)<0};m.lessThanOrEqualTo=m.lte=function(e){return this.cmp(e)<1};m.logarithm=m.log=function(e){var t,n,r,i,o,s,a,c,u=this,l=u.constructor,f=l.precision,p=l.rounding,g=5;if(e==null)e=new l(10),t=!0;else{if(e=new l(e),n=e.d,e.s<0||!n||!n[0]||e.eq(1))return new l(NaN);t=e.eq(10)}if(n=u.d,u.s<0||!n||!n[0]||u.eq(1))return new l(n&&!n[0]?-1/0:u.s!=1?NaN:n?0:1/0);if(t)if(n.length>1)o=!0;else{for(i=n[0];i%10===0;)i/=10;o=i!==1}if(x=!1,a=f+g,s=te(u,a),r=t?ve(l,a+10):te(e,a),c=C(s,r,a,1),ge(c.d,i=f,p))do if(a+=10,s=te(u,a),r=t?ve(l,a+10):te(e,a),c=C(s,r,a,1),!o){+v(c.d).slice(i+1,i+15)+1==1e14&&(c=T(c,f+1,0));break}while(ge(c.d,i+=10,p));return x=!0,T(c,f,p)};m.minus=m.sub=function(e){var t,n,r,i,o,s,a,c,u,l,f,p,g=this,b=g.constructor;if(e=new b(e),!g.d||!e.d)return!g.s||!e.s?e=new b(NaN):g.d?e.s=-e.s:e=new b(e.d||g.s!==e.s?g:NaN),e;if(g.s!=e.s)return e.s=-e.s,g.plus(e);if(u=g.d,p=e.d,a=b.precision,c=b.rounding,!u[0]||!p[0]){if(p[0])e.s=-e.s;else if(u[0])e=new b(g);else return new b(c===3?-0:0);return x?T(e,a,c):e}if(n=_(e.e/P),l=_(g.e/P),u=u.slice(),o=l-n,o){for(f=o<0,f?(t=u,o=-o,s=p.length):(t=p,n=l,s=u.length),r=Math.max(Math.ceil(a/P),s)+2,o>r&&(o=r,t.length=1),t.reverse(),r=o;r--;)t.push(0);t.reverse()}else{for(r=u.length,s=p.length,f=r<s,f&&(s=r),r=0;r<s;r++)if(u[r]!=p[r]){f=u[r]<p[r];break}o=0}for(f&&(t=u,u=p,p=t,e.s=-e.s),s=u.length,r=p.length-s;r>0;--r)u[s++]=0;for(r=p.length;r>o;){if(u[--r]<p[r]){for(i=r;i&&u[--i]===0;)u[i]=z-1;--u[i],u[r]+=z}u[r]-=p[r]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--n;return u[0]?(e.d=u,e.e=_e(u,n),x?T(e,a,c):e):new b(c===3?-0:0)};m.modulo=m.mod=function(e){var t,n=this,r=n.constructor;return e=new r(e),!n.d||!e.s||e.d&&!e.d[0]?new r(NaN):!e.d||n.d&&!n.d[0]?T(new r(n),r.precision,r.rounding):(x=!1,r.modulo==9?(t=C(n,e.abs(),0,3,1),t.s*=e.s):t=C(n,e,0,r.modulo,1),t=t.times(e),x=!0,n.minus(t))};m.naturalExponential=m.exp=function(){return tt(this)};m.naturalLogarithm=m.ln=function(){return te(this)};m.negated=m.neg=function(){var e=new this.constructor(this);return e.s=-e.s,T(e)};m.plus=m.add=function(e){var t,n,r,i,o,s,a,c,u,l,f=this,p=f.constructor;if(e=new p(e),!f.d||!e.d)return!f.s||!e.s?e=new p(NaN):f.d||(e=new p(e.d||f.s===e.s?f:NaN)),e;if(f.s!=e.s)return e.s=-e.s,f.minus(e);if(u=f.d,l=e.d,a=p.precision,c=p.rounding,!u[0]||!l[0])return l[0]||(e=new p(f)),x?T(e,a,c):e;if(o=_(f.e/P),r=_(e.e/P),u=u.slice(),i=o-r,i){for(i<0?(n=u,i=-i,s=l.length):(n=l,r=o,s=u.length),o=Math.ceil(a/P),s=o>s?o+1:s+1,i>s&&(i=s,n.length=1),n.reverse();i--;)n.push(0);n.reverse()}for(s=u.length,i=l.length,s-i<0&&(i=s,n=l,l=u,u=n),t=0;i;)t=(u[--i]=u[i]+l[i]+t)/z|0,u[i]%=z;for(t&&(u.unshift(t),++r),s=u.length;u[--s]==0;)u.pop();return e.d=u,e.e=_e(u,r),x?T(e,a,c):e};m.precision=m.sd=function(e){var t,n=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(ne+e);return n.d?(t=Ut(n.d),e&&n.e+1>t&&(t=n.e+1)):t=NaN,t};m.round=function(){var e=this,t=e.constructor;return T(new t(e),e.e+1,t.rounding)};m.sine=m.sin=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+P,r.rounding=1,n=Nn(r,Ht(r,n)),r.precision=e,r.rounding=t,T(X>2?n.neg():n,e,t,!0)):new r(NaN)};m.squareRoot=m.sqrt=function(){var e,t,n,r,i,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(x=!1,u=Math.sqrt(+s),u==0||u==1/0?(t=v(a),(t.length+c)%2==0&&(t+="0"),u=Math.sqrt(t),c=_((c+1)/2)-(c<0||c%2),u==1/0?t="5e"+c:(t=u.toExponential(),t=t.slice(0,t.indexOf("e")+1)+c),r=new l(t)):r=new l(u.toString()),n=(c=l.precision)+3;;)if(o=r,r=o.plus(C(s,o,n+2,1)).times(.5),v(o.d).slice(0,n)===(t=v(r.d)).slice(0,n))if(t=t.slice(n-3,n+1),t=="9999"||!i&&t=="4999"){if(!i&&(T(o,c+1,0),o.times(o).eq(s))){r=o;break}n+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(T(r,c+1,1),e=!r.times(r).eq(s));break}return x=!0,T(r,c,l.rounding,e)};m.tangent=m.tan=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+10,r.rounding=1,n=n.sin(),n.s=1,n=C(n,new r(1).minus(n.times(n)).sqrt(),e+10,0),r.precision=e,r.rounding=t,T(X==2||X==4?n.neg():n,e,t,!0)):new r(NaN)};m.times=m.mul=function(e){var t,n,r,i,o,s,a,c,u,l=this,f=l.constructor,p=l.d,g=(e=new f(e)).d;if(e.s*=l.s,!p||!p[0]||!g||!g[0])return new f(!e.s||p&&!p[0]&&!g||g&&!g[0]&&!p?NaN:!p||!g?e.s/0:e.s*0);for(n=_(l.e/P)+_(e.e/P),c=p.length,u=g.length,c<u&&(o=p,p=g,g=o,s=c,c=u,u=s),o=[],s=c+u,r=s;r--;)o.push(0);for(r=u;--r>=0;){for(t=0,i=c+r;i>r;)a=o[i]+g[r]*p[i-r-1]+t,o[i--]=a%z|0,t=a/z|0;o[i]=(o[i]+t)%z|0}for(;!o[--s];)o.pop();return t?++n:o.shift(),e.d=o,e.e=_e(o,n),x?T(e,f.precision,f.rounding):e};m.toBinary=function(e,t){return rt(this,2,e,t)};m.toDecimalPlaces=m.toDP=function(e,t){var n=this,r=n.constructor;return n=new r(n),e===void 0?n:(W(e,0,re),t===void 0?t=r.rounding:W(t,0,8),T(n,e+n.e+1,t))};m.toExponential=function(e,t){var n,r=this,i=r.constructor;return e===void 0?n=Z(r,!0):(W(e,0,re),t===void 0?t=i.rounding:W(t,0,8),r=T(new i(r),e+1,t),n=Z(r,!0,e+1)),r.isNeg()&&!r.isZero()?"-"+n:n};m.toFixed=function(e,t){var n,r,i=this,o=i.constructor;return e===void 0?n=Z(i):(W(e,0,re),t===void 0?t=o.rounding:W(t,0,8),r=T(new o(i),e+i.e+1,t),n=Z(r,!1,e+r.e+1)),i.isNeg()&&!i.isZero()?"-"+n:n};m.toFraction=function(e){var t,n,r,i,o,s,a,c,u,l,f,p,g=this,b=g.d,d=g.constructor;if(!b)return new d(g);if(u=n=new d(1),r=c=new d(0),t=new d(r),o=t.e=Ut(b)-g.e-1,s=o%P,t.d[0]=E(10,s<0?P+s:s),e==null)e=o>0?t:u;else{if(a=new d(e),!a.isInt()||a.lt(u))throw Error(ne+a);e=a.gt(t)?o>0?t:u:a}for(x=!1,a=new d(v(b)),l=d.precision,d.precision=o=b.length*P*2;f=C(a,t,0,1,1),i=n.plus(f.times(r)),i.cmp(e)!=1;)n=r,r=i,i=u,u=c.plus(f.times(i)),c=i,i=t,t=a.minus(f.times(i)),a=i;return i=C(e.minus(n),r,0,1,1),c=c.plus(i.times(u)),n=n.plus(i.times(r)),c.s=u.s=g.s,p=C(u,r,o,1).minus(g).abs().cmp(C(c,n,o,1).minus(g).abs())<1?[u,r]:[c,n],d.precision=l,x=!0,p};m.toHexadecimal=m.toHex=function(e,t){return rt(this,16,e,t)};m.toNearest=function(e,t){var n=this,r=n.constructor;if(n=new r(n),e==null){if(!n.d)return n;e=new r(1),t=r.rounding}else{if(e=new r(e),t===void 0?t=r.rounding:W(t,0,8),!n.d)return e.s?n:e;if(!e.d)return e.s&&(e.s=n.s),e}return e.d[0]?(x=!1,n=C(n,e,0,t,1).times(e),x=!0,T(n)):(e.s=n.s,n=e),n};m.toNumber=function(){return+this};m.toOctal=function(e,t){return rt(this,8,e,t)};m.toPower=m.pow=function(e){var t,n,r,i,o,s,a=this,c=a.constructor,u=+(e=new c(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new c(E(+a,u));if(a=new c(a),a.eq(1))return a;if(r=c.precision,o=c.rounding,e.eq(1))return T(a,r,o);if(t=_(e.e/P),t>=e.d.length-1&&(n=u<0?-u:u)<=Sn)return i=qt(c,a,n,r),e.s<0?new c(1).div(i):T(i,r,o);if(s=a.s,s<0){if(t<e.d.length-1)return new c(NaN);if((e.d[t]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return n=E(+a,u),t=n==0||!isFinite(n)?_(u*(Math.log("0."+v(a.d))/Math.LN10+a.e+1)):new c(n+"").e,t>c.maxE+1||t<c.minE-1?new c(t>0?s/0:0):(x=!1,c.rounding=a.s=1,n=Math.min(12,(t+"").length),i=tt(e.times(te(a,r+n)),r),i.d&&(i=T(i,r+5,1),ge(i.d,r,o)&&(t=r+10,i=T(tt(e.times(te(a,t+n)),t),t+5,1),+v(i.d).slice(r+1,r+15)+1==1e14&&(i=T(i,r+1,0)))),i.s=s,x=!0,c.rounding=o,T(i,r,o))};m.toPrecision=function(e,t){var n,r=this,i=r.constructor;return e===void 0?n=Z(r,r.e<=i.toExpNeg||r.e>=i.toExpPos):(W(e,1,re),t===void 0?t=i.rounding:W(t,0,8),r=T(new i(r),e,t),n=Z(r,e<=r.e||r.e<=i.toExpNeg,e)),r.isNeg()&&!r.isZero()?"-"+n:n};m.toSignificantDigits=m.toSD=function(e,t){var n=this,r=n.constructor;return e===void 0?(e=r.precision,t=r.rounding):(W(e,1,re),t===void 0?t=r.rounding:W(t,0,8)),T(new r(n),e,t)};m.toString=function(){var e=this,t=e.constructor,n=Z(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+n:n};m.truncated=m.trunc=function(){return T(new this.constructor(this),this.e+1,1)};m.valueOf=m.toJSON=function(){var e=this,t=e.constructor,n=Z(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+n:n};function v(e){var t,n,r,i=e.length-1,o="",s=e[0];if(i>0){for(o+=s,t=1;t<i;t++)r=e[t]+"",n=P-r.length,n&&(o+=ee(n)),o+=r;s=e[t],r=s+"",n=P-r.length,n&&(o+=ee(n))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function W(e,t,n){if(e!==~~e||e<t||e>n)throw Error(ne+e)}function ge(e,t,n,r){var i,o,s,a;for(o=e[0];o>=10;o/=10)--t;return--t<0?(t+=P,i=0):(i=Math.ceil((t+1)/P),t%=P),o=E(10,P-t),a=e[i]%o|0,r==null?t<3?(t==0?a=a/100|0:t==1&&(a=a/10|0),s=n<4&&a==99999||n>3&&a==49999||a==5e4||a==0):s=(n<4&&a+1==o||n>3&&a+1==o/2)&&(e[i+1]/o/100|0)==E(10,t-2)-1||(a==o/2||a==0)&&(e[i+1]/o/100|0)==0:t<4?(t==0?a=a/1e3|0:t==1?a=a/100|0:t==2&&(a=a/10|0),s=(r||n<4)&&a==9999||!r&&n>3&&a==4999):s=((r||n<4)&&a+1==o||!r&&n>3&&a+1==o/2)&&(e[i+1]/o/1e3|0)==E(10,t-3)-1,s}function Re(e,t,n){for(var r,i=[0],o,s=0,a=e.length;s<a;){for(o=i.length;o--;)i[o]*=t;for(i[0]+=Qe.indexOf(e.charAt(s++)),r=0;r<i.length;r++)i[r]>n-1&&(i[r+1]===void 0&&(i[r+1]=0),i[r+1]+=i[r]/n|0,i[r]%=n)}return i.reverse()}function Bn(e,t){var n,r,i;if(t.isZero())return t;r=t.d.length,r<32?(n=Math.ceil(r/3),i=(1/Fe(4,n)).toString()):(n=16,i="2.3283064365386962890625e-10"),e.precision+=n,t=le(e,1,t.times(i),new e(1));for(var o=n;o--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=n,t}var C=function(){function e(r,i,o){var s,a=0,c=r.length;for(r=r.slice();c--;)s=r[c]*i+a,r[c]=s%o|0,a=s/o|0;return a&&r.unshift(a),r}function t(r,i,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(r[a]!=i[a]){c=r[a]>i[a]?1:-1;break}return c}function n(r,i,o,s){for(var a=0;o--;)r[o]-=a,a=r[o]<i[o]?1:0,r[o]=a*s+r[o]-i[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,i,o,s,a,c){var u,l,f,p,g,b,d,w,h,A,y,I,S,L,q,J,Y,pe,V,ae,Ne=r.constructor,Ze=r.s==i.s?1:-1,O=r.d,D=i.d;if(!O||!O[0]||!D||!D[0])return new Ne(!r.s||!i.s||(O?D&&O[0]==D[0]:!D)?NaN:O&&O[0]==0||!D?Ze*0:Ze/0);for(c?(g=1,l=r.e-i.e):(c=z,g=P,l=_(r.e/g)-_(i.e/g)),V=D.length,Y=O.length,h=new Ne(Ze),A=h.d=[],f=0;D[f]==(O[f]||0);f++);if(D[f]>(O[f]||0)&&l--,o==null?(L=o=Ne.precision,s=Ne.rounding):a?L=o+(r.e-i.e)+1:L=o,L<0)A.push(1),b=!0;else{if(L=L/g+2|0,f=0,V==1){for(p=0,D=D[0],L++;(f<Y||p)&&L--;f++)q=p*c+(O[f]||0),A[f]=q/D|0,p=q%D|0;b=p||f<Y}else{for(p=c/(D[0]+1)|0,p>1&&(D=e(D,p,c),O=e(O,p,c),V=D.length,Y=O.length),J=V,y=O.slice(0,V),I=y.length;I<V;)y[I++]=0;ae=D.slice(),ae.unshift(0),pe=D[0],D[1]>=c/2&&++pe;do p=0,u=t(D,y,V,I),u<0?(S=y[0],V!=I&&(S=S*c+(y[1]||0)),p=S/pe|0,p>1?(p>=c&&(p=c-1),d=e(D,p,c),w=d.length,I=y.length,u=t(d,y,w,I),u==1&&(p--,n(d,V<w?ae:D,w,c))):(p==0&&(u=p=1),d=D.slice()),w=d.length,w<I&&d.unshift(0),n(y,d,I,c),u==-1&&(I=y.length,u=t(D,y,V,I),u<1&&(p++,n(y,V<I?ae:D,I,c))),I=y.length):u===0&&(p++,y=[0]),A[f++]=p,u&&y[0]?y[I++]=O[J]||0:(y=[O[J]],I=1);while((J++<Y||y[0]!==void 0)&&L--);b=y[0]!==void 0}A[0]||A.shift()}if(g==1)h.e=l,_t=b;else{for(f=1,p=A[0];p>=10;p/=10)f++;h.e=f+l*g-1,T(h,a?o+h.e+1:o,s,b)}return h}}();function T(e,t,n,r){var i,o,s,a,c,u,l,f,p,g=e.constructor;e:if(t!=null){if(f=e.d,!f)return e;for(i=1,a=f[0];a>=10;a/=10)i++;if(o=t-i,o<0)o+=P,s=t,l=f[p=0],c=l/E(10,i-s-1)%10|0;else if(p=Math.ceil((o+1)/P),a=f.length,p>=a)if(r){for(;a++<=p;)f.push(0);l=c=0,i=1,o%=P,s=o-P+1}else break e;else{for(l=a=f[p],i=1;a>=10;a/=10)i++;o%=P,s=o-P+i,c=s<0?0:l/E(10,i-s-1)%10|0}if(r=r||t<0||f[p+1]!==void 0||(s<0?l:l%E(10,i-s-1)),u=n<4?(c||r)&&(n==0||n==(e.s<0?3:2)):c>5||c==5&&(n==4||r||n==6&&(o>0?s>0?l/E(10,i-s):0:f[p-1])%10&1||n==(e.s<0?8:7)),t<1||!f[0])return f.length=0,u?(t-=e.e+1,f[0]=E(10,(P-t%P)%P),e.e=-t||0):f[0]=e.e=0,e;if(o==0?(f.length=p,a=1,p--):(f.length=p+1,a=E(10,P-o),f[p]=s>0?(l/E(10,i-s)%E(10,s)|0)*a:0),u)for(;;)if(p==0){for(o=1,s=f[0];s>=10;s/=10)o++;for(s=f[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(e.e++,f[0]==z&&(f[0]=1));break}else{if(f[p]+=a,f[p]!=z)break;f[p--]=0,a=1}for(o=f.length;f[--o]===0;)f.pop()}return x&&(e.e>g.maxE?(e.d=null,e.e=NaN):e.e<g.minE&&(e.e=0,e.d=[0])),e}function Z(e,t,n){if(!e.isFinite())return jt(e);var r,i=e.e,o=v(e.d),s=o.length;return t?(n&&(r=n-s)>0?o=o.charAt(0)+"."+o.slice(1)+ee(r):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(e.e<0?"e":"e+")+e.e):i<0?(o="0."+ee(-i-1)+o,n&&(r=n-s)>0&&(o+=ee(r))):i>=s?(o+=ee(i+1-s),n&&(r=n-i-1)>0&&(o=o+"."+ee(r))):((r=i+1)<s&&(o=o.slice(0,r)+"."+o.slice(r)),n&&(r=n-s)>0&&(i+1===s&&(o+="."),o+=ee(r))),o}function _e(e,t){var n=e[0];for(t*=P;n>=10;n/=10)t++;return t}function ve(e,t,n){if(t>kn)throw x=!0,n&&(e.precision=n),Error(Ft);return T(new e(Ee),t,1,!0)}function H(e,t,n){if(t>et)throw Error(Ft);return T(new e(Me),t,n,!0)}function Ut(e){var t=e.length-1,n=t*P+1;if(t=e[t],t){for(;t%10==0;t/=10)n--;for(t=e[0];t>=10;t/=10)n++}return n}function ee(e){for(var t="";e--;)t+="0";return t}function qt(e,t,n,r){var i,o=new e(1),s=Math.ceil(r/P+4);for(x=!1;;){if(n%2&&(o=o.times(t),vt(o.d,s)&&(i=!0)),n=_(n/2),n===0){n=o.d.length-1,i&&o.d[n]===0&&++o.d[n];break}t=t.times(t),vt(t.d,s)}return x=!0,o}function Mt(e){return e.d[e.d.length-1]&1}function Gt(e,t,n){for(var r,i=new e(t[0]),o=0;++o<t.length;)if(r=new e(t[o]),r.s)i[n](r)&&(i=r);else{i=r;break}return i}function tt(e,t){var n,r,i,o,s,a,c,u=0,l=0,f=0,p=e.constructor,g=p.rounding,b=p.precision;if(!e.d||!e.d[0]||e.e>17)return new p(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:0/0);for(t==null?(x=!1,c=b):c=t,a=new p(.03125);e.e>-2;)e=e.times(a),f+=5;for(r=Math.log(E(2,f))/Math.LN10*2+5|0,c+=r,n=o=s=new p(1),p.precision=c;;){if(o=T(o.times(e),c,1),n=n.times(++l),a=s.plus(C(o,n,c,1)),v(a.d).slice(0,c)===v(s.d).slice(0,c)){for(i=f;i--;)s=T(s.times(s),c,1);if(t==null)if(u<3&&ge(s.d,c-r,g,u))p.precision=c+=10,n=o=a=new p(1),l=0,u++;else return T(s,p.precision=b,g,x=!0);else return p.precision=b,s}s=a}}function te(e,t){var n,r,i,o,s,a,c,u,l,f,p,g=1,b=10,d=e,w=d.d,h=d.constructor,A=h.rounding,y=h.precision;if(d.s<0||!w||!w[0]||!d.e&&w[0]==1&&w.length==1)return new h(w&&!w[0]?-1/0:d.s!=1?NaN:w?0:d);if(t==null?(x=!1,l=y):l=t,h.precision=l+=b,n=v(w),r=n.charAt(0),Math.abs(o=d.e)<15e14){for(;r<7&&r!=1||r==1&&n.charAt(1)>3;)d=d.times(e),n=v(d.d),r=n.charAt(0),g++;o=d.e,r>1?(d=new h("0."+n),o++):d=new h(r+"."+n.slice(1))}else return u=ve(h,l+2,y).times(o+""),d=te(new h(r+"."+n.slice(1)),l-b).plus(u),h.precision=y,t==null?T(d,y,A,x=!0):d;for(f=d,c=s=d=C(d.minus(1),d.plus(1),l,1),p=T(d.times(d),l,1),i=3;;){if(s=T(s.times(p),l,1),u=c.plus(C(s,new h(i),l,1)),v(u.d).slice(0,l)===v(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(ve(h,l+2,y).times(o+""))),c=C(c,new h(g),l,1),t==null)if(ge(c.d,l-b,A,a))h.precision=l+=b,u=s=d=C(f.minus(1),f.plus(1),l,1),p=T(d.times(d),l,1),i=a=1;else return T(c,h.precision=y,A,x=!0);else return h.precision=y,c;c=u,i+=2}}function jt(e){return String(e.s*e.s/0)}function nt(e,t){var n,r,i;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(n<0&&(n=r),n+=+t.slice(r+1),t=t.substring(0,r)):n<0&&(n=t.length),r=0;t.charCodeAt(r)===48;r++);for(i=t.length;t.charCodeAt(i-1)===48;--i);if(t=t.slice(r,i),t){if(i-=r,e.e=n=n-r-1,e.d=[],r=(n+1)%P,n<0&&(r+=P),r<i){for(r&&e.d.push(+t.slice(0,r)),i-=P;r<i;)e.d.push(+t.slice(r,r+=P));t=t.slice(r),r=P-t.length}else r-=i;for(;r--;)t+="0";e.d.push(+t),x&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function In(e,t){var n,r,i,o,s,a,c,u,l;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),Kt.test(t))return nt(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(xn.test(t))n=16,t=t.toLowerCase();else if(Pn.test(t))n=2;else if(An.test(t))n=8;else throw Error(ne+t);for(o=t.search(/p/i),o>0?(c=+t.slice(o+1),t=t.substring(2,o)):t=t.slice(2),o=t.indexOf("."),s=o>=0,r=e.constructor,s&&(t=t.replace(".",""),a=t.length,o=a-o,i=qt(r,new r(n),o,o*2)),u=Re(t,n,z),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new r(e.s*0):(e.e=_e(u,l),e.d=u,x=!1,s&&(e=C(e,i,a*4)),c&&(e=e.times(Math.abs(c)<54?E(2,c):Ve.pow(2,c))),x=!0,e)}function Nn(e,t){var n,r=t.d.length;if(r<3)return t.isZero()?t:le(e,2,t,t);n=1.4*Math.sqrt(r),n=n>16?16:n|0,t=t.times(1/Fe(5,n)),t=le(e,2,t,t);for(var i,o=new e(5),s=new e(16),a=new e(20);n--;)i=t.times(t),t=t.times(o.plus(i.times(s.times(i).minus(a))));return t}function le(e,t,n,r,i){var o,s,a,c,u=1,l=e.precision,f=Math.ceil(l/P);for(x=!1,c=n.times(n),a=new e(r);;){if(s=C(a.times(c),new e(t++*t++),l,1),a=i?r.plus(s):r.minus(s),r=C(s.times(c),new e(t++*t++),l,1),s=a.plus(r),s.d[f]!==void 0){for(o=f;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=r,r=s,s=o,u++}return x=!0,s.d.length=f+1,s}function Fe(e,t){for(var n=e;--t;)n*=e;return n}function Ht(e,t){var n,r=t.s<0,i=H(e,e.precision,1),o=i.times(.5);if(t=t.abs(),t.lte(o))return X=r?4:1,t;if(n=t.divToInt(i),n.isZero())X=r?3:2;else{if(t=t.minus(n.times(i)),t.lte(o))return X=Mt(n)?r?2:3:r?4:1,t;X=Mt(n)?r?1:4:r?3:2}return t.minus(i).abs()}function rt(e,t,n,r){var i,o,s,a,c,u,l,f,p,g=e.constructor,b=n!==void 0;if(b?(W(n,1,re),r===void 0?r=g.rounding:W(r,0,8)):(n=g.precision,r=g.rounding),!e.isFinite())l=jt(e);else{for(l=Z(e),s=l.indexOf("."),b?(i=2,t==16?n=n*4-3:t==8&&(n=n*3-2)):i=t,s>=0&&(l=l.replace(".",""),p=new g(1),p.e=l.length-s,p.d=Re(Z(p),10,i),p.e=p.d.length),f=Re(l,10,i),o=c=f.length;f[--c]==0;)f.pop();if(!f[0])l=b?"0p+0":"0";else{if(s<0?o--:(e=new g(e),e.d=f,e.e=o,e=C(e,p,n,r,0,i),f=e.d,o=e.e,u=_t),s=f[n],a=i/2,u=u||f[n+1]!==void 0,u=r<4?(s!==void 0||u)&&(r===0||r===(e.s<0?3:2)):s>a||s===a&&(r===4||u||r===6&&f[n-1]&1||r===(e.s<0?8:7)),f.length=n,u)for(;++f[--n]>i-1;)f[n]=0,n||(++o,f.unshift(1));for(c=f.length;!f[c-1];--c);for(s=0,l="";s<c;s++)l+=Qe.charAt(f[s]);if(b){if(c>1)if(t==16||t==8){for(s=t==16?4:3,--c;c%s;c++)l+="0";for(f=Re(l,i,t),c=f.length;!f[c-1];--c);for(s=1,l="1.";s<c;s++)l+=Qe.charAt(f[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(t==16?"0x":t==2?"0b":t==8?"0o":"")+l}return e.s<0?"-"+l:l}function vt(e,t){if(e.length>t)return e.length=t,!0}function Ln(e){return new this(e).abs()}function Cn(e){return new this(e).acos()}function Dn(e){return new this(e).acosh()}function Rn(e,t){return new this(e).plus(t)}function En(e){return new this(e).asin()}function Mn(e){return new this(e).asinh()}function vn(e){return new this(e).atan()}function On(e){return new this(e).atanh()}function _n(e,t){e=new this(e),t=new this(t);var n,r=this.precision,i=this.rounding,o=r+4;return!e.s||!t.s?n=new this(NaN):!e.d&&!t.d?(n=H(this,o,1).times(t.s>0?.25:.75),n.s=e.s):!t.d||e.isZero()?(n=t.s<0?H(this,r,i):new this(0),n.s=e.s):!e.d||t.isZero()?(n=H(this,o,1).times(.5),n.s=e.s):t.s<0?(this.precision=o,this.rounding=1,n=this.atan(C(e,t,o,1)),t=H(this,o,1),this.precision=r,this.rounding=i,n=e.s<0?n.minus(t):n.plus(t)):n=this.atan(C(e,t,o,1)),n}function Fn(e){return new this(e).cbrt()}function Vn(e){return T(e=new this(e),e.e+1,2)}function Wn(e,t,n){return new this(e).clamp(t,n)}function Kn(e){if(!e||typeof e!="object")throw Error(Oe+"Object expected");var t,n,r,i=e.defaults===!0,o=["precision",1,re,"rounding",0,8,"toExpNeg",-ce,0,"toExpPos",0,ce,"maxE",0,ce,"minE",-ce,0,"modulo",0,9];for(t=0;t<o.length;t+=3)if(n=o[t],i&&(this[n]=$e[n]),(r=e[n])!==void 0)if(_(r)===r&&r>=o[t+1]&&r<=o[t+2])this[n]=r;else throw Error(ne+n+": "+r);if(n="crypto",i&&(this[n]=$e[n]),(r=e[n])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error(Vt);else this[n]=!1;else throw Error(ne+n+": "+r);return this}function Un(e){return new this(e).cos()}function qn(e){return new this(e).cosh()}function zt(e){var t,n,r;function i(o){var s,a,c,u=this;if(!(u instanceof i))return new i(o);if(u.constructor=i,Ot(o)){u.s=o.s,x?!o.d||o.e>i.maxE?(u.e=NaN,u.d=null):o.e<i.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;x?s>i.maxE?(u.e=NaN,u.d=null):s<i.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return nt(u,o.toString())}else if(c!=="string")throw Error(ne+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),Kt.test(o)?nt(u,o):In(u,o)}if(i.prototype=m,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=Kn,i.clone=zt,i.isDecimal=Ot,i.abs=Ln,i.acos=Cn,i.acosh=Dn,i.add=Rn,i.asin=En,i.asinh=Mn,i.atan=vn,i.atanh=On,i.atan2=_n,i.cbrt=Fn,i.ceil=Vn,i.clamp=Wn,i.cos=Un,i.cosh=qn,i.div=Gn,i.exp=jn,i.floor=Hn,i.hypot=zn,i.ln=Yn,i.log=Zn,i.log10=Xn,i.log2=Jn,i.max=Qn,i.min=$n,i.mod=er,i.mul=tr,i.pow=nr,i.random=rr,i.round=ir,i.sign=or,i.sin=sr,i.sinh=ar,i.sqrt=ur,i.sub=cr,i.sum=lr,i.tan=fr,i.tanh=pr,i.trunc=dr,e===void 0&&(e={}),e&&e.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<r.length;)e.hasOwnProperty(n=r[t++])||(e[n]=this[n]);return i.config(e),i}function Gn(e,t){return new this(e).div(t)}function jn(e){return new this(e).exp()}function Hn(e){return T(e=new this(e),e.e+1,3)}function zn(){var e,t,n=new this(0);for(x=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)n.d&&(n=n.plus(t.times(t)));else{if(t.s)return x=!0,new this(1/0);n=t}return x=!0,n.sqrt()}function Ot(e){return e instanceof Ve||e&&e.toStringTag===Wt||!1}function Yn(e){return new this(e).ln()}function Zn(e,t){return new this(e).log(t)}function Jn(e){return new this(e).log(2)}function Xn(e){return new this(e).log(10)}function Qn(){return Gt(this,arguments,"lt")}function $n(){return Gt(this,arguments,"gt")}function er(e,t){return new this(e).mod(t)}function tr(e,t){return new this(e).mul(t)}function nr(e,t){return new this(e).pow(t)}function rr(e){var t,n,r,i,o=0,s=new this(1),a=[];if(e===void 0?e=this.precision:W(e,1,re),r=Math.ceil(e/P),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(r));o<r;)i=t[o],i>=429e7?t[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(r*=4);o<r;)i=t[o]+(t[o+1]<<8)+(t[o+2]<<16)+((t[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(t,o):(a.push(i%1e7),o+=4);o=r/4}else throw Error(Vt);else for(;o<r;)a[o++]=Math.random()*1e7|0;for(r=a[--o],e%=P,r&&e&&(i=E(10,P-e),a[o]=(r/i|0)*i);a[o]===0;o--)a.pop();if(o<0)n=0,a=[0];else{for(n=-1;a[0]===0;n-=P)a.shift();for(r=1,i=a[0];i>=10;i/=10)r++;r<P&&(n-=P-r)}return s.e=n,s.d=a,s}function ir(e){return T(e=new this(e),e.e+1,this.rounding)}function or(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function sr(e){return new this(e).sin()}function ar(e){return new this(e).sinh()}function ur(e){return new this(e).sqrt()}function cr(e,t){return new this(e).sub(t)}function lr(){var e=0,t=arguments,n=new this(t[e]);for(x=!1;n.s&&++e<t.length;)n=n.plus(t[e]);return x=!0,T(n,this.precision,this.rounding)}function fr(e){return new this(e).tan()}function pr(e){return new this(e).tanh()}function dr(e){return T(e=new this(e),e.e+1,1)}m[Symbol.for("nodejs.util.inspect.custom")]=m.toString;m[Symbol.toStringTag]="Decimal";var Ve=m.constructor=zt($e);Ee=new Ve(Ee);Me=new Ve(Me);import{PublicKey as st}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as mr}from"@solana/spl-token";import{PublicKey as R,SystemProgram as gr,SYSVAR_RENT_PUBKEY as hr}from"@solana/web3.js";function it({pubkey:e,isSigner:t=!1,isWritable:n=!0}){return{pubkey:e,isWritable:n,isSigner:t}}var pi=[it({pubkey:mr,isWritable:!1}),it({pubkey:gr.programId,isWritable:!1}),it({pubkey:hr,isWritable:!1})];function Yt({publicKey:e,transformSol:t}){let n=ot(e.toString());if(n instanceof R)return t&&n.equals(be)?he:n;if(t&&n.toString()===be.toBase58())return he;if(typeof n=="string"){if(n===R.default.toBase58())return R.default;try{return new R(n)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ot(e){try{return new R(e)}catch{return e}}var di=new R("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),br=new R("SysvarRent111111111111111111111111111111111"),Zt=new R("SysvarC1ock11111111111111111111111111111111"),mi=new R("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),gi=new R("Sysvar1nstructions1111111111111111111111111"),hi=new R("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),bi=new R("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),yi=new R("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),wi=new R("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ti=new R("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Pi=new R("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),xi=new R("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ai=new R("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Si=new R("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),ki=new R("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Bi=new R("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),he=new R("So11111111111111111111111111111111111111112"),be=R.default;import{PublicKey as yr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Jt}from"@solana/spl-token";var Xt={chainId:101,address:yr.default.toBase58(),programId:Jt.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},oe={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Jt.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var at=class{constructor({mint:t,decimals:n,symbol:r,name:i,skipMint:o=!1,isToken2022:s=!1}){if(t===be.toBase58()||t instanceof st&&be.equals(t)){this.decimals=oe.decimals,this.symbol=oe.symbol,this.name=oe.name,this.mint=new st(oe.address),this.isToken2022=!1;return}this.decimals=n,this.symbol=r||t.toString().substring(0,6),this.name=i||t.toString().substring(0,6),this.mint=o?st.default:Yt({publicKey:t}),this.isToken2022=s}equals(t){return this===t?!0:this.mint.equals(t.mint)}},se=at;se.WSOL=new at(j(M({},oe),{mint:oe.address}));import Ke from"big.js";import Pr from"bn.js";import xr from"decimal.js-light";import wr from"toformat";var Tr=wr,ye=Tr;var We=F("module/fraction"),ut=ye(Ke),we=ye(xr),Ar={[0]:we.ROUND_DOWN,[1]:we.ROUND_HALF_UP,[2]:we.ROUND_UP},Sr={[0]:Ke.roundDown,[1]:Ke.roundHalfUp,[2]:Ke.roundUp},N=class{constructor(t,n=new Pr(1)){this.numerator=G(t),this.denominator=G(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new N(this.denominator,this.numerator)}add(t){let n=t instanceof N?t:new N(G(t));return this.denominator.eq(n.denominator)?new N(this.numerator.add(n.numerator),this.denominator):new N(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(t){let n=t instanceof N?t:new N(G(t));return this.denominator.eq(n.denominator)?new N(this.numerator.sub(n.numerator),this.denominator):new N(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(t){let n=t instanceof N?t:new N(G(t));return new N(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(t){let n=t instanceof N?t:new N(G(t));return new N(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(t,n={groupSeparator:""},r=1){Number.isInteger(t)||We.logWithError(`${t} is not an integer.`),t<=0&&We.logWithError(`${t} is not positive.`),we.set({precision:t+1,rounding:Ar[r]});let i=new we(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return i.toFormat(i.decimalPlaces(),n)}toFixed(t,n={groupSeparator:""},r=1){return Number.isInteger(t)||We.logWithError(`${t} is not an integer.`),t<0&&We.logWithError(`${t} is negative.`),ut.DP=t,ut.RM=Sr[r]||1,new ut(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,n)}isZero(){return this.numerator.isZero()}};var Br=F("Raydium_price"),Q=class extends N{constructor(n){let{baseToken:r,quoteToken:i,numerator:o,denominator:s}=n;super(o,s);this.baseToken=r,this.quoteToken=i,this.scalar=new N(ct(r.decimals),ct(i.decimals))}get raw(){return new N(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Q({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(n){this.quoteToken!==n.baseToken&&Br.logWithError("mul token not equals");let r=super.mul(n);return new Q({baseToken:this.baseToken,quoteToken:n.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(n=this.quoteToken.decimals,r,i){return this.adjusted.toSignificant(n,r,i)}toFixed(n=this.quoteToken.decimals,r,i){return this.adjusted.toFixed(n,r,i)}};var lt=class{constructor({decimals:t,symbol:n="UNKNOWN",name:r="UNKNOWN"}){this.decimals=t,this.symbol=n,this.name=r}equals(t){return this===t}},Ue=lt;Ue.SOL=new lt(Xt);import Ir from"bn.js";var Qt=new N(new Ir(100)),fe=class extends N{toSignificant(t=5,n,r){return this.mul(Qt).toSignificant(t,n,r)}toFixed(t=2,n,r){return this.mul(Qt).toFixed(t,n,r)}};var Nr=new K(0),So=new K(1),ko=new K(2),Bo=new K(3),Io=new K(5),ft=new K(10),No=new K(100),Lo=new K(1e3),Co=new K(1e4),$t=9007199254740991;function G(e){let t=F("Raydium_parseBigNumberish");if(e instanceof K)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new K(e);t.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&t.logWithError(`BigNumberish number underflow: ${e}`),(e>=$t||e<=-$t)&&t.logWithError(`BigNumberish number overflow: ${e}`),new K(String(e))):typeof e=="bigint"?new K(e.toString()):(t.error(`invalid BigNumberish value: ${e}`),new K(0))}function ct(e){return ft.pow(G(e))}var Cr=F("Raydium_amount"),tn=ye(Lr);function Dr(e,t){let n="0",r="0";if(e.includes(".")){let i=e.split(".");i.length===2?([n,r]=i,r=r.padEnd(t,"0")):Cr.logWithError(`invalid number string, num: ${e}`)}else n=e;return[n,r.slice(0,t)||r]}var $=class extends N{constructor(n,r,i=!0,o){let s=new qe(0),a=ft.pow(new qe(n.decimals));if(i)s=G(r);else{let c=new qe(0),u=new qe(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[l,f]=Dr(r.toString(),n.decimals);c=G(l),u=G(f)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=F(o||"TokenAmount"),this.token=n}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(n){return this.token.equals(n.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(n.raw)}lt(n){return this.token.equals(n.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(n.raw)}add(n){return this.token.equals(n.token)||this.logger.logWithError("add token not equals"),new $(this.token,this.raw.add(n.raw))}subtract(n){return this.token.equals(n.token)||this.logger.logWithError("sub token not equals"),new $(this.token,this.raw.sub(n.raw))}toSignificant(n=this.token.decimals,r,i=0){return super.toSignificant(n,r,i)}toFixed(n=this.token.decimals,r,i=0){return n>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(n,r,i)}toExact(n={groupSeparator:""}){return tn.DP=this.token.decimals,new tn(this.numerator.toString()).div(this.denominator.toString()).toFormat(n)}};function en(e){return typeof e=="object"&&e!==null&&![se,$,Rr,N,Er,Q,fe].some(t=>typeof t=="object"&&e instanceof t)}function Ge(e){return typeof e=="string"?ot(e):Array.isArray(e)?e.map(t=>Ge(t)):en(e)?Object.fromEntries(Object.entries(e).map(([t,n])=>[t,Ge(n)])):e}function pt(e,t=1,n=[]){let r=[...e];if(t<=0)return n;for(;r.length;)n.push(r.splice(0,t));return n}import{PublicKey as U}from"@solana/web3.js";var ss=new U("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),as=new U("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),us=new U("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),cs=new U("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),ls=new U("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),fs=new U("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ps=new U("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),ds=new U("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ms=new U("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),gs=new U("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Mr=new U("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),vr=new U("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Or=new U("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),_r=new U("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Te={IDO_PROGRAM_ID_V1:Mr,IDO_PROGRAM_ID_V2:vr,IDO_PROGRAM_ID_V3:Or,IDO_PROGRAM_ID_V4:_r};import{PublicKey as ws}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as xs}from"@solana/spl-token";import ks from"bn.js";var dt=F("Raydium_accountInfo_util");async function nn(e,t,n){let{batchRequest:r,commitment:i="confirmed"}=M({batchRequest:!1},n),o=pt(t,100),s=new Array(o.length).fill([]);if(r){let a=o.map(l=>{let f=e._buildArgs([l.map(p=>p.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:f}}),c=pt(a,10);s=(await(await Promise.all(c.map(async l=>await e._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&dt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(f=>{if(f){let{data:p,executable:g,lamports:b,owner:d,rentEpoch:w}=f;return p.length!==2&&p[1]!=="base64"&&dt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:g,lamports:b,owner:new Fr(d),rentEpoch:w}}return null})))}else try{s=await Promise.all(o.map(a=>e.getMultipleAccountsInfo(a,i)))}catch(a){a instanceof Error&&dt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function mt({connection:e,address:t}){let n=await nn(e,[...new Set(t.map(i=>i.toString()))].map(i=>new rn(i))),r={};for(let i=0;i<t.length;i++){let o=n[i],s=t[i];if(!o)continue;let a=new je({key:s,state:je.deserialize(o.data)});r[s.toString()]=a,He[s.toString()]=a}return r}var He={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new je({key:new rn("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:je.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var ze=class{constructor(t){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let t=(await Vr.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:n}=(r=t==null?void 0:t[15])!=null?r:{};if(!!n)return{units:6e5,microLamports:Math.min(Math.ceil(n*1e6/6e5),25e3)}}addCustomComputeBudget(t){if(t){let{instructions:n,instructionTypes:r}=De(t);return this.instructions.unshift(...n),this.instructionTypes.unshift(...r),!0}return!1}async calComputeBudget({config:t,defaultIns:n}){try{let r=t||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;n&&this.instructions.unshift(...n)}catch{n&&this.instructions.unshift(...n)}}addInstruction({instructions:t=[],endInstructions:n=[],signers:r=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...t),this.endInstructions.push(...n),this.signers.push(...r),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Pe.default.toString())),this}async versionBuild({txVersion:t,extInfo:n}){return t===0?await this.buildV0(M({},n||{})):this.build(n)}build(t){let n=new xe;return this.allInstructions.length&&n.add(...this.allInstructions),n.feePayer=this.feePayer,{builder:this,transaction:n,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async()=>{var i;let r=await ue(this.connection);if(n.recentBlockhash=r,this.signers.length&&n.sign(...this.signers),ie([n]),(i=this.owner)!=null&&i.isKeyPair)return{txId:await gt(this.connection,n,this.signers),signedTx:n};if(this.signAllTransactions){let o=await this.signAllTransactions([n]);return{txId:await this.connection.sendRawTransaction(o[0].serialize(),{skipPreflight:!0}),signedTx:o[0]}}throw new Error("please connect wallet first")},extInfo:t||{}}}buildMultiTx(t){let{extraPreBuildData:n=[],extInfo:r}=t,{transaction:i}=this.build(r),o=n.filter(u=>u.transaction.instructions.length>0),s=[i,...o.map(u=>u.transaction)],a=[this.signers,...o.map(u=>u.signers)],c=[...this.instructionTypes,...o.map(u=>u.instructionTypes).flat()];return{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async u=>{var g;let{sequentially:l,onTxUpdate:f}=u||{},p=await ue(this.connection);if((g=this.owner)!=null&&g.isKeyPair)return{txIds:await await Promise.all(s.map(async(b,d)=>(b.recentBlockhash=p,await gt(this.connection,b,a[d])))),signedTxs:s};if(this.signAllTransactions){let b=s.map((w,h)=>(w.recentBlockhash=p,a[h].length&&w.sign(...a[h]),w));ie(b);let d=await this.signAllTransactions(b);if(l){let w=0,h=[],A=async()=>{if(!d[w])return;let y=await this.connection.sendRawTransaction(d[w].serialize(),{skipPreflight:!0});h.push({txId:y,status:"sent",signedTx:d[w]}),f==null||f([...h]),w++,this.connection.onSignature(y,I=>{let S=h.findIndex(L=>L.txId===y);S>-1&&(h[S].status=I.err?"error":"success"),f==null||f([...h]),A()},"processed"),this.connection.getSignatureStatus(y)};return await A(),{txIds:h.map(y=>y.txId),signedTxs:d}}else{let w=[];for(let h=0;h<d.length;h+=1){let A=await this.connection.sendRawTransaction(d[h].serialize(),{skipPreflight:!0});w.push(A)}return{txIds:w,signedTxs:d}}}throw new Error("please connect wallet first")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:t,txVersion:n,extInfo:r}){return n===0?await this.buildV0MultiTx({extraPreBuildData:t,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:t,extInfo:r})}async buildV0(t){let p=t||{},{lookupTableCache:n={},lookupTableAddress:r=[],forerunCreate:i}=p,o=Ce(p,["lookupTableCache","lookupTableAddress","forerunCreate"]),s=M(M({},He),n),a=Array.from(new Set([...r,...this.lookupTableAddress])),c=[];for(let g of a)s[g]===void 0&&c.push(new Pe(g));let u=await mt({connection:this.connection,address:c});for(let[g,b]of Object.entries(u))s[g]=b;let l=new Ae({payerKey:this.feePayer,recentBlockhash:i?Pe.default.toBase58():await ue(this.connection),instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s)),f=new Se(l);return f.sign(this.signers),{builder:this,transaction:f,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async()=>{var g;if(ie([f]),(g=this.owner)!=null&&g.isKeyPair)return f.sign([this.owner.signer]),{txId:await this.connection.sendTransaction(f,{skipPreflight:!0}),signedTx:f};if(this.signAllTransactions){let b=await this.signAllTransactions([f]);return{txId:await this.connection.sendTransaction(b[0],{skipPreflight:!0}),signedTx:b[0]}}throw new Error("please connect wallet first")},extInfo:o||{}}}async buildV0MultiTx(t){let{extraPreBuildData:n=[],buildProps:r}=t,{transaction:i}=await this.buildV0(r),o=n.filter(u=>u.builder.instructions.length>0),s=[i,...o.map(u=>u.transaction)],a=[this.signers,...o.map(u=>u.signers)],c=[...this.instructionTypes,...o.map(u=>u.instructionTypes).flat()];return s.forEach(async(u,l)=>{u.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:r,execute:async u=>{var p;ie(s);let{sequentially:l,onTxUpdate:f}=u||{};if((p=this.owner)!=null&&p.isKeyPair)return s.forEach(g=>g.sign([this.owner.signer])),{txIds:await Promise.all(s.map(async g=>await this.connection.sendTransaction(g))),signedTxs:s};if(this.signAllTransactions){let g=await this.signAllTransactions(s);if(l){let b=0,d=[],w=async()=>{if(!g[b])return;let h=await this.connection.sendTransaction(g[b],{skipPreflight:!0});d.push({txId:h,status:"sent",signedTx:g[b]}),f==null||f([...d]),b++,this.connection.onSignature(h,A=>{let y=d.findIndex(I=>I.txId===h);y>-1&&(d[y].status=A.err?"error":"success"),f==null||f([...d]),w()},"processed"),this.connection.getSignatureStatus(h)};return w(),{txIds:[],signedTxs:g}}else{let b=[];for(let d=0;d<g.length;d+=1){let w=await this.connection.sendTransaction(g[d],{skipPreflight:!0});b.push(w)}return{txIds:b,signedTxs:g}}}throw new Error("please connect wallet first")},extInfo:r||{}}}async sizeCheckBuild(t){let u=t||{},{autoComputeBudget:n=!1}=u,r=Ce(u,["autoComputeBudget"]),i={instructions:[],instructionTypes:[]};if(n){let l=n?await this.getComputeBudgetConfig():void 0;i=n&&l?De(l):{instructions:[],instructionTypes:[]}}let o=this.signers.reduce((l,f)=>j(M({},l),{[f.publicKey.toBase58()]:f}),{}),s=[],a=[],c=[];if(this.allInstructions.forEach(l=>{let f=[...c,l],p=n?[...i.instructions,...f]:f,b=[...new Set(f.map(d=>d.keys.filter(w=>w.isSigner).map(w=>w.pubkey.toString())).flat()).values()].map(d=>new Pe(d));if(c.length<12&&de({instructions:p,payer:this.feePayer,signers:b})||de({instructions:f,payer:this.feePayer,signers:b}))c.push(l);else{if(c.length===0)throw Error("item ins too big");de({instructions:n?[...i.instructions,...c]:[...c],payer:this.feePayer,signers:b})?s.push(new xe().add(...i.instructions,...c)):s.push(new xe().add(...c)),a.push(Array.from(new Set(c.map(d=>d.keys.filter(w=>w.isSigner).map(w=>w.pubkey.toString())).flat())).map(d=>o[d]).filter(d=>d!==void 0)),c=[l]}}),c.length>0){let f=[...new Set(c.map(p=>p.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(p=>o[p]).filter(p=>p!==void 0);de({instructions:n?[...i.instructions,...c]:[...c],payer:this.feePayer,signers:f.map(p=>p.publicKey)})?s.push(new xe().add(...i.instructions,...c)):s.push(new xe().add(...c)),a.push(f)}return s.forEach(l=>l.feePayer=this.feePayer),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async l=>{var b;let{sequentially:f,onTxUpdate:p}=l||{},g=await ue(this.connection);if(s.forEach(async(d,w)=>{d.recentBlockhash=g,a[w].length&&d.sign(...a[w])}),ie(s),(b=this.owner)!=null&&b.isKeyPair)return{txIds:await Promise.all(s.map(async(d,w)=>await gt(this.connection,d,a[w]))),signedTxs:s};if(this.signAllTransactions){let d=await this.signAllTransactions(s);if(f){let w=0,h=[],A=async()=>{if(!d[w])return;let y=await this.connection.sendRawTransaction(d[w].serialize(),{skipPreflight:!0});h.push({txId:y,status:"sent",signedTx:d[w]}),p==null||p([...h]),w++,this.connection.onSignature(y,I=>{let S=h.findIndex(L=>L.txId===y);S>-1&&(h[S].status=I.err?"error":"success"),p==null||p([...h]),A()},"processed"),this.connection.getSignatureStatus(y)};return await A(),{txIds:h.map(y=>y.txId),signedTxs:d}}else{let w=[];for(let h=0;h<d.length;h+=1){let A=await this.connection.sendRawTransaction(d[h].serialize(),{skipPreflight:!0});w.push(A)}return{txIds:w,signedTxs:d}}}throw new Error("please connect wallet first")},extInfo:r||{}}}async sizeCheckBuildV0(t){let w=t||{},{autoComputeBudget:n=!1,lookupTableCache:r={},lookupTableAddress:i=[]}=w,o=Ce(w,["autoComputeBudget","lookupTableCache","lookupTableAddress"]),s=M(M({},He),r),a=Array.from(new Set([...this.lookupTableAddress,...i])),c=[];for(let h of a)s[h]===void 0&&c.push(new Pe(h));let u=await mt({connection:this.connection,address:c});for(let[h,A]of Object.entries(u))s[h]=A;let l={instructions:[],instructionTypes:[]};if(n){let h=n?await this.getComputeBudgetConfig():void 0;l=n&&h?De(h):{instructions:[],instructionTypes:[]}}let f=await ue(this.connection),p=this.signers.reduce((h,A)=>j(M({},h),{[A.publicKey.toBase58()]:A}),{}),g=[],b=[],d=[];if(this.allInstructions.forEach(h=>{let A=[...d,h],y=n?[...l.instructions,...A]:A;if(d.length<12&&me({instructions:y,payer:this.feePayer,lookupTableAddressAccount:s})||me({instructions:A,payer:this.feePayer,lookupTableAddressAccount:s}))d.push(h);else{if(d.length===0)throw Error("item ins too big");let I={};for(let S of[...new Set(a)])s[S]!==void 0&&(I[S]=s[S]);if(n&&me({instructions:[...l.instructions,...d],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:f})){let S=new Ae({payerKey:this.feePayer,recentBlockhash:f,instructions:[...l.instructions,...d]}).compileToV0Message(Object.values(s));g.push(new Se(S))}else{let S=new Ae({payerKey:this.feePayer,recentBlockhash:f,instructions:[...d]}).compileToV0Message(Object.values(s));g.push(new Se(S))}b.push(Array.from(new Set(d.map(S=>S.keys.filter(L=>L.isSigner).map(L=>L.pubkey.toString())).flat())).map(S=>p[S]).filter(S=>S!==void 0)),d=[h]}}),d.length>0){let A=[...new Set(d.map(y=>y.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat()).values()].map(y=>p[y]).filter(y=>y!==void 0);if(n&&me({instructions:[...l.instructions,...d],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:f})){let y=new Ae({payerKey:this.feePayer,recentBlockhash:f,instructions:[...l.instructions,...d]}).compileToV0Message(Object.values(s));g.push(new Se(y))}else{let y=new Ae({payerKey:this.feePayer,recentBlockhash:f,instructions:[...d]}).compileToV0Message(Object.values(s));g.push(new Se(y))}b.push(A)}return{builder:this,transactions:g,buildProps:t,signers:b,instructionTypes:this.instructionTypes,execute:async h=>{var I;let{sequentially:A,onTxUpdate:y}=h||{};if(g.map(async(S,L)=>{b[L].length&&S.sign(b[L])}),ie(g),(I=this.owner)!=null&&I.isKeyPair)return{txIds:await Promise.all(g.map(async S=>await this.connection.sendTransaction(S,{skipPreflight:!0}))),signedTxs:g};if(this.signAllTransactions){let S=await this.signAllTransactions(g);if(A){let L=0,q=[],J=async()=>{if(!S[L])return;let Y=await this.connection.sendTransaction(S[L],{skipPreflight:!0});q.push({txId:Y,status:"sent",signedTx:S[L]}),y==null||y([...q]),L++,this.connection.onSignature(Y,pe=>{let V=q.findIndex(ae=>ae.txId===Y);V>-1&&(q[V].status=pe.err?"error":"success"),y==null||y([...q]),J()},"processed"),this.connection.getSignatureStatus(Y)};return J(),{txIds:[],signedTxs:S}}else{let L=[];for(let q=0;q<S.length;q+=1){let J=await this.connection.sendTransaction(S[q],{skipPreflight:!0});L.push(J)}return{txIds:L,signedTxs:S}}}throw new Error("please connect wallet first")},extInfo:o||{}}}};var ht=(...e)=>e.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),ke=class{constructor({scope:t,moduleName:n}){this.disabled=!1;this.scope=t,this.logger=F(n)}createTxBuilder(t){return this.scope.checkOwner(),new ze({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(ht(t))}logInfo(...t){this.logger.info(ht(t))}logAndCreateError(...t){let n=ht(t);throw new Error(n)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as Du,TransactionInstruction as un,SYSVAR_CLOCK_PUBKEY as Gr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as cn}from"@solana/spl-token";import{PublicKey as Pu}from"@solana/web3.js";import Au,{isBN as Su}from"bn.js";import{bits as Ta,BitStructure as Pa,blob as xa,Blob as Aa,cstr as Sa,f32 as ka,f32be as Ba,f64 as Ia,f64be as Na,greedy as La,Layout as Ca,ns64 as Da,ns64be as Ra,nu64 as Wr,nu64be as Ea,offset as Ma,s16 as va,s16be as Oa,s24 as _a,s24be as Fa,s32 as Va,s32be as Wa,s40 as Ka,s40be as Ua,s48 as qa,s48be as Ga,s8 as ja,seq as Ha,struct as za,Structure as Kr,u16 as Ya,u16be as Za,u24 as Ja,u24be as Xa,u32 as Qa,u32be as $a,u40 as eu,u40be as tu,u48 as nu,u48be as ru,u8 as iu,UInt as Ur,union as ou,Union as su,unionLayoutDiscriminator as au,utf8 as uu}from"@solana/buffer-layout";var on=Kr;var sn=Ur;var an=Wr;function yt(e){return new sn(1,e)}var bt=class extends on{decode(t,n){return super.decode(t,n)}};function wt(e,t,n){return new bt(e,t,n)}var qr=wt([yt("instruction"),an("amount")]),Be=wt([yt("instruction")]);function Ye({programId:e},t){let n=[{pubkey:cn,isSigner:!1,isWritable:!1},{pubkey:Zt,isSigner:!1,isWritable:!1},...Object.entries(t).map(([i,o])=>({pubkey:o,isSigner:i==="userOwner",isWritable:!["authority","userOwner"].includes(i)}))],r=Buffer.alloc(Be.span);return Be.encode({instruction:2},r),new un({keys:n,programId:e,data:r})}function Tt(e){let{poolConfig:t,userKeys:n,side:r}=e,i=r==="base"?n.baseTokenAccount:n.quoteTokenAccount,o=r==="base"?t.baseVault:t.quoteVault,s=Buffer.alloc(Be.span);Be.encode({instruction:2},s);let a=[{pubkey:cn,isWritable:!1,isSigner:!1},{pubkey:Gr,isWritable:!1,isSigner:!1},{pubkey:t.id,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!1},{pubkey:o,isWritable:!0,isSigner:!1},{pubkey:i,isWritable:!0,isSigner:!1},{pubkey:n.ledgerAccount,isWritable:!0,isSigner:!1},{pubkey:n.owner,isWritable:!1,isSigner:!0}];return new un({programId:t.programId,keys:a,data:s})}import ln from"bn.js";var jr={[Te.IDO_PROGRAM_ID_V1.toString()]:1,[Te.IDO_PROGRAM_ID_V2.toString()]:2,[Te.IDO_PROGRAM_ID_V3.toString()]:3,[Te.IDO_PROGRAM_ID_V4.toString()]:4},Pt=class extends ke{async claim({ownerInfo:t,idoKeys:n,associatedOnly:r=!0,checkCreateATAOwner:i=!1,txVersion:o}){let s=this.createTxBuilder(),a=jr[n.programId];a||this.logAndCreateError("invalid version",a);let c=Ge(n),[u,l]=[!new ln(t.coin).isZero(),!new ln(t.pc).isZero()],f=c.projectInfo.mint.address.equals(he),{account:p,instructionParams:g}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:c.projectInfo.mint.programId,mint:c.projectInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!f,notUseTokenAccount:f,associatedOnly:f?!1:r,checkCreateATAOwner:i});!p&&u&&this.logAndCreateError("target token accounts not found","mint",n.projectInfo.mint.address),u&&g&&s.addInstruction(g);let b=c.buyInfo.mint.address.equals(he),{account:d,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:c.buyInfo.mint.programId,mint:c.buyInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!b,notUseTokenAccount:b,associatedOnly:b?!1:r,checkCreateATAOwner:i});if(!p&&l&&this.logAndCreateError("target token accounts not found","mint",n.projectInfo.mint.address),l&&w&&s.addInstruction(w),(!p||!d)&&this.logAndCreateError("target token accounts not found","mint",n.projectInfo.mint.address,n.buyInfo.mint.address),a===3)return s.addInstruction({instructions:[...u?[Ye({programId:c.programId},{idoId:c.id,authority:c.authority,poolTokenAccount:c.projectInfo.vault,userTokenAccount:p,userIdoInfo:new Ie(t.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[],...l?[Ye({programId:new Ie(n.programId)},{idoId:c.id,authority:c.authority,poolTokenAccount:c.buyInfo.vault,userTokenAccount:d,userIdoInfo:new Ie(t.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[]]}).versionBuild({txVersion:o});if(a<3)return!u&&!l&&this.logAndCreateError("no claimable rewards"),s.addInstruction({instructions:[Ye({programId:c.programId},{idoId:c.id,authority:c.authority,poolQuoteTokenAccount:c.buyInfo.vault,poolBaseTokenAccount:c.projectInfo.vault,userQuoteTokenAccount:d,userBaseTokenAccount:p,userIdoInfo:new Ie(t.userIdoInfo),userOwner:this.scope.ownerPubKey})]}).versionBuild({txVersion:o});let h={poolConfig:{id:c.id,programId:c.programId,authority:c.authority,baseVault:c.projectInfo.vault,quoteVault:c.buyInfo.vault,baseToken:n.projectInfo.mint,quoteToken:n.buyInfo.mint},userKeys:{baseTokenAccount:p,quoteTokenAccount:d,ledgerAccount:new Ie(t.userIdoInfo),owner:this.scope.ownerPubKey}};return s.addInstruction({instructions:[...u?[Tt(j(M({},h),{side:"base"}))]:[],...l?[Tt(j(M({},h),{side:"quote"}))]:[]]}).versionBuild({txVersion:o})}};export{Pt as default};
//# sourceMappingURL=ido.mjs.map