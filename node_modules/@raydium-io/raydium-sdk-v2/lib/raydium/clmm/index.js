var Fi=Object.create;var Ot=Object.defineProperty,Oi=Object.defineProperties,Mi=Object.getOwnPropertyDescriptor,Ei=Object.getOwnPropertyDescriptors,Di=Object.getOwnPropertyNames,Qt=Object.getOwnPropertySymbols,vi=Object.getPrototypeOf,Sn=Object.prototype.hasOwnProperty,kr=Object.prototype.propertyIsEnumerable;var Tr=(r,e,t)=>e in r?Ot(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,V=(r,e)=>{for(var t in e||(e={}))Sn.call(e,t)&&Tr(r,t,e[t]);if(Qt)for(var t of Qt(e))kr.call(e,t)&&Tr(r,t,e[t]);return r},ie=(r,e)=>Oi(r,Ei(e));var $t=(r,e)=>{var t={};for(var n in r)Sn.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&Qt)for(var n of Qt(r))e.indexOf(n)<0&&kr.call(r,n)&&(t[n]=r[n]);return t};var _i=(r,e)=>{for(var t in e)Ot(r,t,{get:e[t],enumerable:!0})},xr=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Di(e))!Sn.call(r,i)&&i!==t&&Ot(r,i,{get:()=>e[i],enumerable:!(n=Mi(e,i))||n.enumerable});return r};var oe=(r,e,t)=>(t=r!=null?Fi(vi(r)):{},xr(e||!r||!r.__esModule?Ot(t,"default",{value:r,enumerable:!0}):t,r)),Vi=r=>xr(Ot({},"__esModule",{value:!0}),r);var bs={};_i(bs,{AMM_CONFIG_SEED:()=>ai,AmmConfigLayout:()=>rs,BIT_PRECISION:()=>Qn,Clmm:()=>In,ClmmInstrument:()=>be,EXTENSION_TICKARRAY_BITMAP_SIZE:()=>An,FEE_RATE_DENOMINATOR:()=>Ht,FETCH_TICKARRAY_COUNT:()=>ki,Fee:()=>si,LOG_B_2_X32:()=>$n,LOG_B_P_ERR_MARGIN_LOWER_X64:()=>Jn,LOG_B_P_ERR_MARGIN_UPPER_X64:()=>er,LiquidityMath:()=>G,MAX_SQRT_PRICE_X64:()=>tt,MAX_TICK:()=>Se,MIN_SQRT_PRICE_X64:()=>et,MIN_TICK:()=>Te,MathUtil:()=>M,MaxU64:()=>bn,MaxUint128:()=>Zn,NEGATIVE_ONE:()=>Ye,ONE:()=>Le,OPERATION_SEED:()=>di,ObservationInfoLayout:()=>Pn,ObservationLayout:()=>hi,OperationLayout:()=>dr,POOL_REWARD_VAULT_SEED:()=>li,POOL_SEED:()=>ui,POOL_TICK_ARRAY_BITMAP_SEED:()=>pi,POOL_VAULT_SEED:()=>ci,POSITION_SEED:()=>or,PoolInfoLayout:()=>is,PoolUtils:()=>we,PositionInfoLayout:()=>mr,PositionRewardInfoLayout:()=>Pi,PositionUtils:()=>Ft,ProtocolPositionLayout:()=>os,Q128:()=>zt,Q64:()=>Fe,RewardInfo:()=>Ai,SqrtPriceMath:()=>F,SwapMath:()=>pt,TICK_ARRAY_BITMAP_SIZE:()=>mt,TICK_ARRAY_SEED:()=>mi,TICK_ARRAY_SIZE:()=>de,TICK_SPACINGS:()=>jo,TickArrayBitmap:()=>Ze,TickArrayBitmapExtensionLayout:()=>pr,TickArrayBitmapExtensionUtils:()=>Rt,TickArrayLayout:()=>Lt,TickLayout:()=>Ti,TickMath:()=>dt,TickQuery:()=>U,TickUtils:()=>S,U64Resolution:()=>It,U64_IGNORE_RANGE:()=>Qo,ZERO:()=>z,getLiquidityFromAmounts:()=>ss,getPdaAmmConfigId:()=>es,getPdaExBitmapAccount:()=>nt,getPdaMetadataKey:()=>jt,getPdaOperationAccount:()=>Ct,getPdaPersonalPositionAddress:()=>We,getPdaPoolId:()=>sr,getPdaPoolRewardVaulId:()=>ar,getPdaPoolVaultId:()=>wn,getPdaProtocolPositionAddress:()=>lt,getPdaTickArrayAddress:()=>Z,i16ToBytes:()=>$o,i32ToBytes:()=>Yt,isZero:()=>St,leadingZeros:()=>gn,leastSignificantBit:()=>ir,mockCreatePoolInfo:()=>Zo,mockV3CreatePoolInfo:()=>tr,mostSignificantBit:()=>rr,trailingZeros:()=>yn,u16ToBytes:()=>nr,u32ToBytes:()=>Jo});module.exports=Vi(bs);var X=require("@solana/web3.js");var At=9e15,at=1e9,Cn="0123456789abcdef",en="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",tn="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Kn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-At,maxE:At,crypto:!1},Cr,Qe,E=!0,rn="[DecimalError] ",st=rn+"Invalid argument: ",Kr=rn+"Precision limit exceeded",Nr=rn+"crypto unavailable",Rr="[object Decimal]",xe=Math.floor,pe=Math.pow,qi=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Wi=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Gi=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Lr=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ve=1e7,R=7,Ui=9007199254740991,Xi=en.length-1,Nn=tn.length-1,T={toStringTag:Rr};T.absoluteValue=T.abs=function(){var r=new this.constructor(this);return r.s<0&&(r.s=1),C(r)};T.ceil=function(){return C(new this.constructor(this),this.e+1,2)};T.clampedTo=T.clamp=function(r,e){var t,n=this,i=n.constructor;if(r=new i(r),e=new i(e),!r.s||!e.s)return new i(NaN);if(r.gt(e))throw Error(st+e);return t=n.cmp(r),t<0?r:n.cmp(e)>0?e:new i(n)};T.comparedTo=T.cmp=function(r){var e,t,n,i,o=this,s=o.d,a=(r=new o.constructor(r)).d,u=o.s,c=r.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==r.e)return o.e>r.e^u<0?1:-1;for(n=s.length,i=a.length,e=0,t=n<i?n:i;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===i?0:n>i^u<0?1:-1};T.cosine=T.cos=function(){var r,e,t=this,n=t.constructor;return t.d?t.d[0]?(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+R,n.rounding=1,t=zi(n,Dr(n,t)),n.precision=r,n.rounding=e,C(Qe==2||Qe==3?t.neg():t,r,e,!0)):new n(1):new n(NaN)};T.cubeRoot=T.cbrt=function(){var r,e,t,n,i,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(E=!1,o=l.s*pe(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=Ae(l.d),r=l.e,(o=(r-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=pe(t,1/3),r=xe((r+1)/3)-(r%3==(r<0?-1:2)),o==1/0?t="5e"+r:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+r),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(r=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=J(c.plus(l).times(a),c.plus(u),s+2,1),Ae(a.d).slice(0,s)===(t=Ae(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!i&&t=="4999"){if(!i&&(C(a,r+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(C(n,r+1,1),e=!n.times(n).times(n).eq(l));break}return E=!0,C(n,r,m.rounding,e)};T.decimalPlaces=T.dp=function(){var r,e=this.d,t=NaN;if(e){if(r=e.length-1,t=(r-xe(this.e/R))*R,r=e[r],r)for(;r%10==0;r/=10)t--;t<0&&(t=0)}return t};T.dividedBy=T.div=function(r){return J(this,new this.constructor(r))};T.dividedToIntegerBy=T.divToInt=function(r){var e=this,t=e.constructor;return C(J(e,new t(r),0,1,1),t.precision,t.rounding)};T.equals=T.eq=function(r){return this.cmp(r)===0};T.floor=function(){return C(new this.constructor(this),this.e+1,3)};T.greaterThan=T.gt=function(r){return this.cmp(r)>0};T.greaterThanOrEqualTo=T.gte=function(r){var e=this.cmp(r);return e==1||e===0};T.hyperbolicCosine=T.cosh=function(){var r,e,t,n,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(r=Math.ceil(i/3),e=(1/sn(4,r)).toString()):(r=16,e="2.3283064365386962890625e-10"),o=Pt(s,1,o.times(e),new s(1),!0);for(var u,c=r,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return C(o,s.precision=t,s.rounding=n,!0)};T.hyperbolicSine=T.sinh=function(){var r,e,t,n,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(i.e,i.sd())+4,o.rounding=1,n=i.d.length,n<3)i=Pt(o,2,i,i,!0);else{r=1.4*Math.sqrt(n),r=r>16?16:r|0,i=i.times(1/sn(5,r)),i=Pt(o,2,i,i,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);r--;)s=i.times(i),i=i.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,C(i,e,t,!0)};T.hyperbolicTangent=T.tanh=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+7,n.rounding=1,J(t.sinh(),t.cosh(),n.precision=r,n.rounding=e)):new n(t.s)};T.inverseCosine=T.acos=function(){var r,e=this,t=e.constructor,n=e.abs().cmp(1),i=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?De(t,i,o):new t(0):new t(NaN):e.isZero()?De(t,i+4,o).times(.5):(t.precision=i+6,t.rounding=1,e=e.asin(),r=De(t,i+4,o).times(.5),t.precision=i,t.rounding=o,r.minus(e))};T.inverseHyperbolicCosine=T.acosh=function(){var r,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(r=n.precision,e=n.rounding,n.precision=r+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,E=!1,t=t.times(t).minus(1).sqrt().plus(t),E=!0,n.precision=r,n.rounding=e,t.ln()):new n(t)};T.inverseHyperbolicSine=T.asinh=function(){var r,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,E=!1,t=t.times(t).plus(1).sqrt().plus(t),E=!0,n.precision=r,n.rounding=e,t.ln())};T.inverseHyperbolicTangent=T.atanh=function(){var r,e,t,n,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(r=o.precision,e=o.rounding,n=i.sd(),Math.max(n,r)<2*-i.e-1?C(new o(i),r,e,!0):(o.precision=t=n-i.e,i=J(i.plus(1),new o(1).minus(i),t+r,1),o.precision=r+4,o.rounding=1,i=i.ln(),o.precision=r,o.rounding=e,i.times(.5))):new o(NaN)};T.inverseSine=T.asin=function(){var r,e,t,n,i=this,o=i.constructor;return i.isZero()?new o(i):(e=i.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(r=De(o,t+4,n).times(.5),r.s=i.s,r):new o(NaN):(o.precision=t+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,i.times(2)))};T.inverseTangent=T.atan=function(){var r,e,t,n,i,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=Nn)return s=De(l,m+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=Nn)return s=De(l,m+4,d).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/R+2|0),r=t;r;--r)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(E=!1,e=Math.ceil(a/R),n=1,u=c.times(c),s=new l(c),i=c;r!==-1;)if(i=i.times(u),o=s.minus(i.div(n+=2)),i=i.times(u),s=o.plus(i.div(n+=2)),s.d[e]!==void 0)for(r=e;s.d[r]===o.d[r]&&r--;);return t&&(s=s.times(2<<t-1)),E=!0,C(s,l.precision=m,l.rounding=d,!0)};T.isFinite=function(){return!!this.d};T.isInteger=T.isInt=function(){return!!this.d&&xe(this.e/R)>this.d.length-2};T.isNaN=function(){return!this.s};T.isNegative=T.isNeg=function(){return this.s<0};T.isPositive=T.isPos=function(){return this.s>0};T.isZero=function(){return!!this.d&&this.d[0]===0};T.lessThan=T.lt=function(r){return this.cmp(r)<0};T.lessThanOrEqualTo=T.lte=function(r){return this.cmp(r)<1};T.logarithm=T.log=function(r){var e,t,n,i,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding,p=5;if(r==null)r=new l(10),e=!0;else{if(r=new l(r),t=r.d,r.s<0||!t||!t[0]||r.eq(1))return new l(NaN);e=r.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(i=t[0];i%10===0;)i/=10;o=i!==1}if(E=!1,a=m+p,s=ot(c,a),n=e?nn(l,a+10):ot(r,a),u=J(s,n,a,1),Mt(u.d,i=m,d))do if(a+=10,s=ot(c,a),n=e?nn(l,a+10):ot(r,a),u=J(s,n,a,1),!o){+Ae(u.d).slice(i+1,i+15)+1==1e14&&(u=C(u,m+1,0));break}while(Mt(u.d,i+=10,d));return E=!0,C(u,m,d)};T.minus=T.sub=function(r){var e,t,n,i,o,s,a,u,c,l,m,d,p=this,b=p.constructor;if(r=new b(r),!p.d||!r.d)return!p.s||!r.s?r=new b(NaN):p.d?r.s=-r.s:r=new b(r.d||p.s!==r.s?p:NaN),r;if(p.s!=r.s)return r.s=-r.s,p.plus(r);if(c=p.d,d=r.d,a=b.precision,u=b.rounding,!c[0]||!d[0]){if(d[0])r.s=-r.s;else if(c[0])r=new b(p);else return new b(u===3?-0:0);return E?C(r,a,u):r}if(t=xe(r.e/R),l=xe(p.e/R),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=d.length):(e=d,t=l,s=c.length),n=Math.max(Math.ceil(a/R),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){m=c[n]<d[n];break}o=0}for(m&&(e=c,c=d,d=e,r.s=-r.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(i=n;i&&c[--i]===0;)c[i]=ve-1;--c[i],c[n]+=ve}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(r.d=c,r.e=on(c,t),E?C(r,a,u):r):new b(u===3?-0:0)};T.modulo=T.mod=function(r){var e,t=this,n=t.constructor;return r=new n(r),!t.d||!r.s||r.d&&!r.d[0]?new n(NaN):!r.d||t.d&&!t.d[0]?C(new n(t),n.precision,n.rounding):(E=!1,n.modulo==9?(e=J(t,r.abs(),0,3,1),e.s*=r.s):e=J(t,r,0,n.modulo,1),e=e.times(r),E=!0,t.minus(e))};T.naturalExponential=T.exp=function(){return Rn(this)};T.naturalLogarithm=T.ln=function(){return ot(this)};T.negated=T.neg=function(){var r=new this.constructor(this);return r.s=-r.s,C(r)};T.plus=T.add=function(r){var e,t,n,i,o,s,a,u,c,l,m=this,d=m.constructor;if(r=new d(r),!m.d||!r.d)return!m.s||!r.s?r=new d(NaN):m.d||(r=new d(r.d||m.s===r.s?m:NaN)),r;if(m.s!=r.s)return r.s=-r.s,m.minus(r);if(c=m.d,l=r.d,a=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(r=new d(m)),E?C(r,a,u):r;if(o=xe(m.e/R),n=xe(r.e/R),c=c.slice(),i=o-n,i){for(i<0?(t=c,i=-i,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/R),s=o>s?o+1:s+1,i>s&&(i=s,t.length=1),t.reverse();i--;)t.push(0);t.reverse()}for(s=c.length,i=l.length,s-i<0&&(i=s,t=l,l=c,c=t),e=0;i;)e=(c[--i]=c[i]+l[i]+e)/ve|0,c[i]%=ve;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return r.d=c,r.e=on(c,n),E?C(r,a,u):r};T.precision=T.sd=function(r){var e,t=this;if(r!==void 0&&r!==!!r&&r!==1&&r!==0)throw Error(st+r);return t.d?(e=Fr(t.d),r&&t.e+1>e&&(e=t.e+1)):e=NaN,e};T.round=function(){var r=this,e=r.constructor;return C(new e(r),r.e+1,e.rounding)};T.sine=T.sin=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+R,n.rounding=1,t=Yi(n,Dr(n,t)),n.precision=r,n.rounding=e,C(Qe>2?t.neg():t,r,e,!0)):new n(NaN)};T.squareRoot=T.sqrt=function(){var r,e,t,n,i,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(E=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=Ae(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=xe((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(J(s,o,t+2,1)).times(.5),Ae(o.d).slice(0,t)===(e=Ae(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!i&&e=="4999"){if(!i&&(C(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,i=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(C(n,u+1,1),r=!n.times(n).eq(s));break}return E=!0,C(n,u,l.rounding,r)};T.tangent=T.tan=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+10,n.rounding=1,t=t.sin(),t.s=1,t=J(t,new n(1).minus(t.times(t)).sqrt(),r+10,0),n.precision=r,n.rounding=e,C(Qe==2||Qe==4?t.neg():t,r,e,!0)):new n(NaN)};T.times=T.mul=function(r){var e,t,n,i,o,s,a,u,c,l=this,m=l.constructor,d=l.d,p=(r=new m(r)).d;if(r.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!r.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?r.s/0:r.s*0);for(t=xe(l.e/R)+xe(r.e/R),u=d.length,c=p.length,u<c&&(o=d,d=p,p=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,i=u+n;i>n;)a=o[i]+p[n]*d[i-n-1]+e,o[i--]=a%ve|0,e=a/ve|0;o[i]=(o[i]+e)%ve|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),r.d=o,r.e=on(o,t),E?C(r,m.precision,m.rounding):r};T.toBinary=function(r,e){return Fn(this,2,r,e)};T.toDecimalPlaces=T.toDP=function(r,e){var t=this,n=t.constructor;return t=new n(t),r===void 0?t:(Re(r,0,at),e===void 0?e=n.rounding:Re(e,0,8),C(t,r+t.e+1,e))};T.toExponential=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=ze(n,!0):(Re(r,0,at),e===void 0?e=i.rounding:Re(e,0,8),n=C(new i(n),r+1,e),t=ze(n,!0,r+1)),n.isNeg()&&!n.isZero()?"-"+t:t};T.toFixed=function(r,e){var t,n,i=this,o=i.constructor;return r===void 0?t=ze(i):(Re(r,0,at),e===void 0?e=o.rounding:Re(e,0,8),n=C(new o(i),r+i.e+1,e),t=ze(n,!1,r+n.e+1)),i.isNeg()&&!i.isZero()?"-"+t:t};T.toFraction=function(r){var e,t,n,i,o,s,a,u,c,l,m,d,p=this,b=p.d,f=p.constructor;if(!b)return new f(p);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=Fr(b)-p.e-1,s=o%R,e.d[0]=pe(10,s<0?R+s:s),r==null)r=o>0?e:c;else{if(a=new f(r),!a.isInt()||a.lt(c))throw Error(st+a);r=a.gt(e)?o>0?e:c:a}for(E=!1,a=new f(Ae(b)),l=f.precision,f.precision=o=b.length*R*2;m=J(a,e,0,1,1),i=t.plus(m.times(n)),i.cmp(r)!=1;)t=n,n=i,i=c,c=u.plus(m.times(i)),u=i,i=e,e=a.minus(m.times(i)),a=i;return i=J(r.minus(t),n,0,1,1),u=u.plus(i.times(c)),t=t.plus(i.times(n)),u.s=c.s=p.s,d=J(c,n,o,1).minus(p).abs().cmp(J(u,t,o,1).minus(p).abs())<1?[c,n]:[u,t],f.precision=l,E=!0,d};T.toHexadecimal=T.toHex=function(r,e){return Fn(this,16,r,e)};T.toNearest=function(r,e){var t=this,n=t.constructor;if(t=new n(t),r==null){if(!t.d)return t;r=new n(1),e=n.rounding}else{if(r=new n(r),e===void 0?e=n.rounding:Re(e,0,8),!t.d)return r.s?t:r;if(!r.d)return r.s&&(r.s=t.s),r}return r.d[0]?(E=!1,t=J(t,r,0,e,1).times(r),E=!0,C(t)):(r.s=t.s,t=r),t};T.toNumber=function(){return+this};T.toOctal=function(r,e){return Fn(this,8,r,e)};T.toPower=T.pow=function(r){var e,t,n,i,o,s,a=this,u=a.constructor,c=+(r=new u(r));if(!a.d||!r.d||!a.d[0]||!r.d[0])return new u(pe(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,r.eq(1))return C(a,n,o);if(e=xe(r.e/R),e>=r.d.length-1&&(t=c<0?-c:c)<=Ui)return i=Or(u,a,t,n),r.s<0?new u(1).div(i):C(i,n,o);if(s=a.s,s<0){if(e<r.d.length-1)return new u(NaN);if((r.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=pe(+a,c),e=t==0||!isFinite(t)?xe(c*(Math.log("0."+Ae(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(E=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),i=Rn(r.times(ot(a,n+t)),n),i.d&&(i=C(i,n+5,1),Mt(i.d,n,o)&&(e=n+10,i=C(Rn(r.times(ot(a,e+t)),e),e+5,1),+Ae(i.d).slice(n+1,n+15)+1==1e14&&(i=C(i,n+1,0)))),i.s=s,E=!0,u.rounding=o,C(i,n,o))};T.toPrecision=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=ze(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(Re(r,1,at),e===void 0?e=i.rounding:Re(e,0,8),n=C(new i(n),r,e),t=ze(n,r<=n.e||n.e<=i.toExpNeg,r)),n.isNeg()&&!n.isZero()?"-"+t:t};T.toSignificantDigits=T.toSD=function(r,e){var t=this,n=t.constructor;return r===void 0?(r=n.precision,e=n.rounding):(Re(r,1,at),e===void 0?e=n.rounding:Re(e,0,8)),C(new n(t),r,e)};T.toString=function(){var r=this,e=r.constructor,t=ze(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()&&!r.isZero()?"-"+t:t};T.truncated=T.trunc=function(){return C(new this.constructor(this),this.e+1,1)};T.valueOf=T.toJSON=function(){var r=this,e=r.constructor,t=ze(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()?"-"+t:t};function Ae(r){var e,t,n,i=r.length-1,o="",s=r[0];if(i>0){for(o+=s,e=1;e<i;e++)n=r[e]+"",t=R-n.length,t&&(o+=it(t)),o+=n;s=r[e],n=s+"",t=R-n.length,t&&(o+=it(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Re(r,e,t){if(r!==~~r||r<e||r>t)throw Error(st+r)}function Mt(r,e,t,n){var i,o,s,a;for(o=r[0];o>=10;o/=10)--e;return--e<0?(e+=R,i=0):(i=Math.ceil((e+1)/R),e%=R),o=pe(10,R-e),a=r[i]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(r[i+1]/o/100|0)==pe(10,e-2)-1||(a==o/2||a==0)&&(r[i+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(r[i+1]/o/1e3|0)==pe(10,e-3)-1,s}function Jt(r,e,t){for(var n,i=[0],o,s=0,a=r.length;s<a;){for(o=i.length;o--;)i[o]*=e;for(i[0]+=Cn.indexOf(r.charAt(s++)),n=0;n<i.length;n++)i[n]>t-1&&(i[n+1]===void 0&&(i[n+1]=0),i[n+1]+=i[n]/t|0,i[n]%=t)}return i.reverse()}function zi(r,e){var t,n,i;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),i=(1/sn(4,t)).toString()):(t=16,i="2.3283064365386962890625e-10"),r.precision+=t,e=Pt(r,1,e.times(i),new r(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return r.precision-=t,e}var J=function(){function r(n,i,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*i+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,i,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=i[a]){u=n[a]>i[a]?1:-1;break}return u}function t(n,i,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<i[o]?1:0,n[o]=a*s+n[o]-i[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,o,s,a,u){var c,l,m,d,p,b,f,g,y,A,w,P,h,x,B,N,D,q,_,ge,le=n.constructor,Ne=n.s==i.s?1:-1,re=n.d,j=i.d;if(!re||!re[0]||!j||!j[0])return new le(!n.s||!i.s||(re?j&&re[0]==j[0]:!j)?NaN:re&&re[0]==0||!j?Ne*0:Ne/0);for(u?(p=1,l=n.e-i.e):(u=ve,p=R,l=xe(n.e/p)-xe(i.e/p)),_=j.length,D=re.length,y=new le(Ne),A=y.d=[],m=0;j[m]==(re[m]||0);m++);if(j[m]>(re[m]||0)&&l--,o==null?(x=o=le.precision,s=le.rounding):a?x=o+(n.e-i.e)+1:x=o,x<0)A.push(1),b=!0;else{if(x=x/p+2|0,m=0,_==1){for(d=0,j=j[0],x++;(m<D||d)&&x--;m++)B=d*u+(re[m]||0),A[m]=B/j|0,d=B%j|0;b=d||m<D}else{for(d=u/(j[0]+1)|0,d>1&&(j=r(j,d,u),re=r(re,d,u),_=j.length,D=re.length),N=_,w=re.slice(0,_),P=w.length;P<_;)w[P++]=0;ge=j.slice(),ge.unshift(0),q=j[0],j[1]>=u/2&&++q;do d=0,c=e(j,w,_,P),c<0?(h=w[0],_!=P&&(h=h*u+(w[1]||0)),d=h/q|0,d>1?(d>=u&&(d=u-1),f=r(j,d,u),g=f.length,P=w.length,c=e(f,w,g,P),c==1&&(d--,t(f,_<g?ge:j,g,u))):(d==0&&(c=d=1),f=j.slice()),g=f.length,g<P&&f.unshift(0),t(w,f,P,u),c==-1&&(P=w.length,c=e(j,w,_,P),c<1&&(d++,t(w,_<P?ge:j,P,u))),P=w.length):c===0&&(d++,w=[0]),A[m++]=d,c&&w[0]?w[P++]=re[N]||0:(w=[re[N]],P=1);while((N++<D||w[0]!==void 0)&&x--);b=w[0]!==void 0}A[0]||A.shift()}if(p==1)y.e=l,Cr=b;else{for(m=1,d=A[0];d>=10;d/=10)m++;y.e=m+l*p-1,C(y,a?o+y.e+1:o,s,b)}return y}}();function C(r,e,t,n){var i,o,s,a,u,c,l,m,d,p=r.constructor;e:if(e!=null){if(m=r.d,!m)return r;for(i=1,a=m[0];a>=10;a/=10)i++;if(o=e-i,o<0)o+=R,s=e,l=m[d=0],u=l/pe(10,i-s-1)%10|0;else if(d=Math.ceil((o+1)/R),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=u=0,i=1,o%=R,s=o-R+1}else break e;else{for(l=a=m[d],i=1;a>=10;a/=10)i++;o%=R,s=o-R+i,u=s<0?0:l/pe(10,i-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%pe(10,i-s-1)),c=t<4?(u||n)&&(t==0||t==(r.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/pe(10,i-s):0:m[d-1])%10&1||t==(r.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=r.e+1,m[0]=pe(10,(R-e%R)%R),r.e=-e||0):m[0]=r.e=0,r;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=pe(10,R-o),m[d]=s>0?(l/pe(10,i-s)%pe(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(r.e++,m[0]==ve&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=ve)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return E&&(r.e>p.maxE?(r.d=null,r.e=NaN):r.e<p.minE&&(r.e=0,r.d=[0])),r}function ze(r,e,t){if(!r.isFinite())return Er(r);var n,i=r.e,o=Ae(r.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+it(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(r.e<0?"e":"e+")+r.e):i<0?(o="0."+it(-i-1)+o,t&&(n=t-s)>0&&(o+=it(n))):i>=s?(o+=it(i+1-s),t&&(n=t-i-1)>0&&(o=o+"."+it(n))):((n=i+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(i+1===s&&(o+="."),o+=it(n))),o}function on(r,e){var t=r[0];for(e*=R;t>=10;t/=10)e++;return e}function nn(r,e,t){if(e>Xi)throw E=!0,t&&(r.precision=t),Error(Kr);return C(new r(en),e,1,!0)}function De(r,e,t){if(e>Nn)throw Error(Kr);return C(new r(tn),e,t,!0)}function Fr(r){var e=r.length-1,t=e*R+1;if(e=r[e],e){for(;e%10==0;e/=10)t--;for(e=r[0];e>=10;e/=10)t++}return t}function it(r){for(var e="";r--;)e+="0";return e}function Or(r,e,t,n){var i,o=new r(1),s=Math.ceil(n/R+4);for(E=!1;;){if(t%2&&(o=o.times(e),Ir(o.d,s)&&(i=!0)),t=xe(t/2),t===0){t=o.d.length-1,i&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Ir(e.d,s)}return E=!0,o}function Br(r){return r.d[r.d.length-1]&1}function Mr(r,e,t){for(var n,i=new r(e[0]),o=0;++o<e.length;)if(n=new r(e[o]),n.s)i[t](n)&&(i=n);else{i=n;break}return i}function Rn(r,e){var t,n,i,o,s,a,u,c=0,l=0,m=0,d=r.constructor,p=d.rounding,b=d.precision;if(!r.d||!r.d[0]||r.e>17)return new d(r.d?r.d[0]?r.s<0?0:1/0:1:r.s?r.s<0?0:r:0/0);for(e==null?(E=!1,u=b):u=e,a=new d(.03125);r.e>-2;)r=r.times(a),m+=5;for(n=Math.log(pe(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=C(o.times(r),u,1),t=t.times(++l),a=s.plus(J(o,t,u,1)),Ae(a.d).slice(0,u)===Ae(s.d).slice(0,u)){for(i=m;i--;)s=C(s.times(s),u,1);if(e==null)if(c<3&&Mt(s.d,u-n,p,c))d.precision=u+=10,t=o=a=new d(1),l=0,c++;else return C(s,d.precision=b,p,E=!0);else return d.precision=b,s}s=a}}function ot(r,e){var t,n,i,o,s,a,u,c,l,m,d,p=1,b=10,f=r,g=f.d,y=f.constructor,A=y.rounding,w=y.precision;if(f.s<0||!g||!g[0]||!f.e&&g[0]==1&&g.length==1)return new y(g&&!g[0]?-1/0:f.s!=1?NaN:g?0:f);if(e==null?(E=!1,l=w):l=e,y.precision=l+=b,t=Ae(g),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(r),t=Ae(f.d),n=t.charAt(0),p++;o=f.e,n>1?(f=new y("0."+t),o++):f=new y(n+"."+t.slice(1))}else return c=nn(y,l+2,w).times(o+""),f=ot(new y(n+"."+t.slice(1)),l-b).plus(c),y.precision=w,e==null?C(f,w,A,E=!0):f;for(m=f,u=s=f=J(f.minus(1),f.plus(1),l,1),d=C(f.times(f),l,1),i=3;;){if(s=C(s.times(d),l,1),c=u.plus(J(s,new y(i),l,1)),Ae(c.d).slice(0,l)===Ae(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(nn(y,l+2,w).times(o+""))),u=J(u,new y(p),l,1),e==null)if(Mt(u.d,l-b,A,a))y.precision=l+=b,c=s=f=J(m.minus(1),m.plus(1),l,1),d=C(f.times(f),l,1),i=a=1;else return C(u,y.precision=w,A,E=!0);else return y.precision=w,u;u=c,i+=2}}function Er(r){return String(r.s*r.s/0)}function Ln(r,e){var t,n,i;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(i=e.length;e.charCodeAt(i-1)===48;--i);if(e=e.slice(n,i),e){if(i-=n,r.e=t=t-n-1,r.d=[],n=(t+1)%R,t<0&&(n+=R),n<i){for(n&&r.d.push(+e.slice(0,n)),i-=R;n<i;)r.d.push(+e.slice(n,n+=R));e=e.slice(n),n=R-e.length}else n-=i;for(;n--;)e+="0";r.d.push(+e),E&&(r.e>r.constructor.maxE?(r.d=null,r.e=NaN):r.e<r.constructor.minE&&(r.e=0,r.d=[0]))}else r.e=0,r.d=[0];return r}function Hi(r,e){var t,n,i,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Lr.test(e))return Ln(r,e)}else if(e==="Infinity"||e==="NaN")return+e||(r.s=NaN),r.e=NaN,r.d=null,r;if(Wi.test(e))t=16,e=e.toLowerCase();else if(qi.test(e))t=2;else if(Gi.test(e))t=8;else throw Error(st+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=r.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,i=Or(n,new n(t),o,o*2)),c=Jt(e,t,ve),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(r.s*0):(r.e=on(c,l),r.d=c,E=!1,s&&(r=J(r,i,a*4)),u&&(r=r.times(Math.abs(u)<54?pe(2,u):Et.pow(2,u))),E=!0,r)}function Yi(r,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:Pt(r,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/sn(5,t)),e=Pt(r,2,e,e);for(var i,o=new r(5),s=new r(16),a=new r(20);t--;)i=e.times(e),e=e.times(o.plus(i.times(s.times(i).minus(a))));return e}function Pt(r,e,t,n,i){var o,s,a,u,c=1,l=r.precision,m=Math.ceil(l/R);for(E=!1,u=t.times(t),a=new r(n);;){if(s=J(a.times(u),new r(e++*e++),l,1),a=i?n.plus(s):n.minus(s),n=J(s.times(u),new r(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return E=!0,s.d.length=m+1,s}function sn(r,e){for(var t=r;--e;)t*=r;return t}function Dr(r,e){var t,n=e.s<0,i=De(r,r.precision,1),o=i.times(.5);if(e=e.abs(),e.lte(o))return Qe=n?4:1,e;if(t=e.divToInt(i),t.isZero())Qe=n?3:2;else{if(e=e.minus(t.times(i)),e.lte(o))return Qe=Br(t)?n?2:3:n?4:1,e;Qe=Br(t)?n?1:4:n?3:2}return e.minus(i).abs()}function Fn(r,e,t,n){var i,o,s,a,u,c,l,m,d,p=r.constructor,b=t!==void 0;if(b?(Re(t,1,at),n===void 0?n=p.rounding:Re(n,0,8)):(t=p.precision,n=p.rounding),!r.isFinite())l=Er(r);else{for(l=ze(r),s=l.indexOf("."),b?(i=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):i=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=Jt(ze(d),10,i),d.e=d.d.length),m=Jt(l,10,i),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=b?"0p+0":"0";else{if(s<0?o--:(r=new p(r),r.d=m,r.e=o,r=J(r,d,t,n,0,i),m=r.d,o=r.e,c=Cr),s=m[t],a=i/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(r.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(r.s<0?8:7)),m.length=t,c)for(;++m[--t]>i-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=Cn.charAt(m[s]);if(b){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=Jt(l,i,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=Cn.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return r.s<0?"-"+l:l}function Ir(r,e){if(r.length>e)return r.length=e,!0}function ji(r){return new this(r).abs()}function Zi(r){return new this(r).acos()}function Qi(r){return new this(r).acosh()}function $i(r,e){return new this(r).plus(e)}function Ji(r){return new this(r).asin()}function eo(r){return new this(r).asinh()}function to(r){return new this(r).atan()}function no(r){return new this(r).atanh()}function ro(r,e){r=new this(r),e=new this(e);var t,n=this.precision,i=this.rounding,o=n+4;return!r.s||!e.s?t=new this(NaN):!r.d&&!e.d?(t=De(this,o,1).times(e.s>0?.25:.75),t.s=r.s):!e.d||r.isZero()?(t=e.s<0?De(this,n,i):new this(0),t.s=r.s):!r.d||e.isZero()?(t=De(this,o,1).times(.5),t.s=r.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(J(r,e,o,1)),e=De(this,o,1),this.precision=n,this.rounding=i,t=r.s<0?t.minus(e):t.plus(e)):t=this.atan(J(r,e,o,1)),t}function io(r){return new this(r).cbrt()}function oo(r){return C(r=new this(r),r.e+1,2)}function so(r,e,t){return new this(r).clamp(e,t)}function ao(r){if(!r||typeof r!="object")throw Error(rn+"Object expected");var e,t,n,i=r.defaults===!0,o=["precision",1,at,"rounding",0,8,"toExpNeg",-At,0,"toExpPos",0,At,"maxE",0,At,"minE",-At,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],i&&(this[t]=Kn[t]),(n=r[t])!==void 0)if(xe(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(st+t+": "+n);if(t="crypto",i&&(this[t]=Kn[t]),(n=r[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Nr);else this[t]=!1;else throw Error(st+t+": "+n);return this}function uo(r){return new this(r).cos()}function co(r){return new this(r).cosh()}function vr(r){var e,t,n;function i(o){var s,a,u,c=this;if(!(c instanceof i))return new i(o);if(c.constructor=i,Sr(o)){c.s=o.s,E?!o.d||o.e>i.maxE?(c.e=NaN,c.d=null):o.e<i.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;E?s>i.maxE?(c.e=NaN,c.d=null):s<i.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return Ln(c,o.toString())}else if(u!=="string")throw Error(st+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),Lr.test(o)?Ln(c,o):Hi(c,o)}if(i.prototype=T,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=ao,i.clone=vr,i.isDecimal=Sr,i.abs=ji,i.acos=Zi,i.acosh=Qi,i.add=$i,i.asin=Ji,i.asinh=eo,i.atan=to,i.atanh=no,i.atan2=ro,i.cbrt=io,i.ceil=oo,i.clamp=so,i.cos=uo,i.cosh=co,i.div=lo,i.exp=mo,i.floor=po,i.hypot=fo,i.ln=bo,i.log=go,i.log10=wo,i.log2=yo,i.max=ho,i.min=Ao,i.mod=Po,i.mul=To,i.pow=ko,i.random=xo,i.round=Bo,i.sign=Io,i.sin=So,i.sinh=Co,i.sqrt=Ko,i.sub=No,i.sum=Ro,i.tan=Lo,i.tanh=Fo,i.trunc=Oo,r===void 0&&(r={}),r&&r.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)r.hasOwnProperty(t=n[e++])||(r[t]=this[t]);return i.config(r),i}function lo(r,e){return new this(r).div(e)}function mo(r){return new this(r).exp()}function po(r){return C(r=new this(r),r.e+1,3)}function fo(){var r,e,t=new this(0);for(E=!1,r=0;r<arguments.length;)if(e=new this(arguments[r++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return E=!0,new this(1/0);t=e}return E=!0,t.sqrt()}function Sr(r){return r instanceof Et||r&&r.toStringTag===Rr||!1}function bo(r){return new this(r).ln()}function go(r,e){return new this(r).log(e)}function yo(r){return new this(r).log(2)}function wo(r){return new this(r).log(10)}function ho(){return Mr(this,arguments,"lt")}function Ao(){return Mr(this,arguments,"gt")}function Po(r,e){return new this(r).mod(e)}function To(r,e){return new this(r).mul(e)}function ko(r,e){return new this(r).pow(e)}function xo(r){var e,t,n,i,o=0,s=new this(1),a=[];if(r===void 0?r=this.precision:Re(r,1,at),n=Math.ceil(r/R),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)i=e[o],i>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)i=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(i%1e7),o+=4);o=n/4}else throw Error(Nr);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],r%=R,n&&r&&(i=pe(10,R-r),a[o]=(n/i|0)*i);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=R)a.shift();for(n=1,i=a[0];i>=10;i/=10)n++;n<R&&(t-=R-n)}return s.e=t,s.d=a,s}function Bo(r){return C(r=new this(r),r.e+1,this.rounding)}function Io(r){return r=new this(r),r.d?r.d[0]?r.s:0*r.s:r.s||NaN}function So(r){return new this(r).sin()}function Co(r){return new this(r).sinh()}function Ko(r){return new this(r).sqrt()}function No(r,e){return new this(r).sub(e)}function Ro(){var r=0,e=arguments,t=new this(e[r]);for(E=!1;t.s&&++r<e.length;)t=t.plus(e[r]);return E=!0,C(t,this.precision,this.rounding)}function Lo(r){return new this(r).tan()}function Fo(r){return new this(r).tanh()}function Oo(r){return C(r=new this(r),r.e+1,1)}T[Symbol.for("nodejs.util.inspect.custom")]=T.toString;T[Symbol.toStringTag]="Decimal";var Et=T.constructor=vr(Kn);en=new Et(en);tn=new Et(tn);var I=Et;var Dt=require("lodash"),Mn=oe(require("dayjs")),Vr=oe(require("dayjs/plugin/utc"));Mn.default.extend(Vr.default);var On=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return(0,Mn.default)().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},_r={},Mo={};function fe(r){let e=(0,Dt.get)(_r,r);if(!e){let t=(0,Dt.get)(Mo,r);e=new On({name:r,logLevel:t}),(0,Dt.set)(_r,r,e)}return e}var Uo=require("@solana/web3.js"),Xo=oe(require("bn.js"));var Qr=oe(require("big.js")),Wt=oe(require("bn.js"));var Ce=oe(require("bn.js"));var cn=require("@solana/web3.js");var qr=require("@solana/spl-token"),Q=require("@solana/web3.js");function En({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var As=[En({pubkey:qr.TOKEN_PROGRAM_ID,isWritable:!1}),En({pubkey:Q.SystemProgram.programId,isWritable:!1}),En({pubkey:Q.SYSVAR_RENT_PUBKEY,isWritable:!1})];function Dn({publicKey:r,transformSol:e}){let t=Wr(r.toString());if(t instanceof Q.PublicKey)return e&&t.equals(gt)?te:t;if(e&&t.toString()===gt.toBase58())return te;if(typeof t=="string"){if(t===Q.PublicKey.default.toBase58())return Q.PublicKey.default;try{return new Q.PublicKey(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Wr(r){try{return new Q.PublicKey(r)}catch{return r}}var an=new Q.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),vt=new Q.PublicKey("SysvarRent111111111111111111111111111111111"),Ps=new Q.PublicKey("SysvarC1ock11111111111111111111111111111111"),Tt=new Q.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Ts=new Q.PublicKey("Sysvar1nstructions1111111111111111111111111"),ks=new Q.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),xs=new Q.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Bs=new Q.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Is=new Q.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ss=new Q.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Cs=new Q.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ks=new Q.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ns=new Q.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Rs=new Q.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ls=new Q.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Fs=new Q.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),te=new Q.PublicKey("So11111111111111111111111111111111111111112"),gt=Q.PublicKey.default;function vn(r){return Dn({publicKey:r,transformSol:!0})}var Gr=require("@solana/web3.js"),_n=require("@solana/spl-token"),un={chainId:101,address:Gr.PublicKey.default.toBase58(),programId:_n.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},yt={chainId:101,address:"So11111111111111111111111111111111111111112",programId:_n.TOKEN_PROGRAM_ID.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Vn=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===gt.toBase58()||e instanceof cn.PublicKey&&gt.equals(e)){this.decimals=yt.decimals,this.symbol=yt.symbol,this.name=yt.name,this.mint=new cn.PublicKey(yt.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?cn.PublicKey.default:Dn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},$e=Vn;$e.WSOL=new Vn(ie(V({},yt),{mint:yt.address}));var Vt=oe(require("big.js")),Xr=oe(require("bn.js")),zr=oe(require("decimal.js-light"));var Ur=oe(require("toformat")),Eo=Ur.default,_t=Eo;var ln=fe("module/fraction"),qn=_t(Vt.default),qt=_t(zr.default),Do={[0]:qt.ROUND_DOWN,[1]:qt.ROUND_HALF_UP,[2]:qt.ROUND_UP},vo={[0]:Vt.default.roundDown,[1]:Vt.default.roundHalfUp,[2]:Vt.default.roundUp},H=class{constructor(e,t=new Xr.default(1)){this.numerator=Pe(e),this.denominator=Pe(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new H(this.denominator,this.numerator)}add(e){let t=e instanceof H?e:new H(Pe(e));return this.denominator.eq(t.denominator)?new H(this.numerator.add(t.numerator),this.denominator):new H(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof H?e:new H(Pe(e));return this.denominator.eq(t.denominator)?new H(this.numerator.sub(t.numerator),this.denominator):new H(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof H?e:new H(Pe(e));return new H(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof H?e:new H(Pe(e));return new H(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||ln.logWithError(`${e} is not an integer.`),e<=0&&ln.logWithError(`${e} is not positive.`),qt.set({precision:e+1,rounding:Do[n]});let i=new qt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||ln.logWithError(`${e} is not an integer.`),e<0&&ln.logWithError(`${e} is negative.`),qn.DP=e,qn.RM=vo[n]||1,new qn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Vo=fe("Raydium_price"),_e=class extends H{constructor(t){let{baseToken:n,quoteToken:i,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=i,this.scalar=new H(Wn(n.decimals),Wn(i.decimals))}get raw(){return new H(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new _e({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Vo.logWithError("mul token not equals");let n=super.mul(t);return new _e({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,i){return this.adjusted.toSignificant(t,n,i)}toFixed(t=this.quoteToken.decimals,n,i){return this.adjusted.toFixed(t,n,i)}};var Gn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},mn=Gn;mn.SOL=new Gn(un);var Yr=oe(require("bn.js"));var Hr=new H(new Yr.default(100)),Je=class extends H{toSignificant(e=5,t,n){return this.mul(Hr).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Hr).toFixed(e,t,n)}};var qo=new Ce.default(0),Aa=new Ce.default(1),Pa=new Ce.default(2),Ta=new Ce.default(3),ka=new Ce.default(5),Un=new Ce.default(10),xa=new Ce.default(100),Ba=new Ce.default(1e3),Ia=new Ce.default(1e4),jr=9007199254740991;function Pe(r){let e=fe("Raydium_parseBigNumberish");if(r instanceof Ce.default)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new Ce.default(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=jr||r<=-jr)&&e.logWithError(`BigNumberish number overflow: ${r}`),new Ce.default(String(r))):typeof r=="bigint"?new Ce.default(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new Ce.default(0))}function Wn(r){return Un.pow(Pe(r))}var Wo=fe("Raydium_amount"),Zr=_t(Qr.default);function Go(r,e){let t="0",n="0";if(r.includes(".")){let i=r.split(".");i.length===2?([t,n]=i,n=n.padEnd(e,"0")):Wo.logWithError(`invalid number string, num: ${r}`)}else t=r;return[t,n.slice(0,e)||n]}var Be=class extends H{constructor(t,n,i=!0,o){let s=new Wt.default(0),a=Un.pow(new Wt.default(t.decimals));if(i)s=Pe(n);else{let u=new Wt.default(0),c=new Wt.default(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=Go(n.toString(),t.decimals);u=Pe(l),c=Pe(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=fe(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new Be(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new Be(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,i=0){return super.toSignificant(t,n,i)}toFixed(t=this.token.decimals,n,i=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,i)}toExact(t={groupSeparator:""}){return Zr.DP=this.token.decimals,new Zr(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};var $=require("@solana/web3.js"),ri=oe(require("axios"));var me={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw"};var Ie=require("@solana/web3.js"),Jr=require("@solana/spl-token");var $r=fe("Raydium_txUtil"),ei=1644;function dn(r){let e=[],t=[];return r.microLamports&&(e.push(Ie.ComputeBudgetProgram.setComputeUnitPrice({microLamports:r.microLamports})),t.push(me.SetComputeUnitPrice)),r.units&&(e.push(Ie.ComputeBudgetProgram.setComputeUnitLimit({units:r.units})),t.push(me.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function kt(r){var e,t;try{return((t=await((e=r.getLatestBlockhash)==null?void 0:e.call(r)))==null?void 0:t.blockhash)||(await r.getRecentBlockhash()).blockhash}catch{return(await r.getRecentBlockhash()).blockhash}}function zo(r,e){r.length<1&&$r.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&$r.logWithError(`no signers provided:, ${e.toString()}`);let t=new Ie.Transaction;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<ei}catch{return!1}}function Oe(r,e){let[t,n]=Ie.PublicKey.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function Gt({instructions:r,payer:e,signers:t}){return zo(r,[e,...t])}function Ut({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Ie.Keypair.generate().publicKey.toString()}){let o=new Ie.TransactionMessage({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Ie.VersionedTransaction(o).serialize()).toString("base64").length<ei}catch{return!1}}var Ho=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r);function wt(r){let e=[];return r.forEach(t=>{t instanceof Ie.Transaction&&(t.recentBlockhash||(t.recentBlockhash=Jr.TOKEN_PROGRAM_ID.toBase58()),t.feePayer||(t.feePayer=Ie.Keypair.generate().publicKey));let n=t.serialize({requireAllSignatures:!1,verifySignatures:!1});t instanceof Ie.VersionedTransaction&&(n=Ho(n));let i=n.toString("base64");e.push(i)}),console.log("simulate tx string:",e),e}var ct=require("@solana/web3.js");var ti=require("@solana/web3.js"),ni=require("@solana/spl-token");var Xn=fe("Raydium_accountInfo_util");async function ut(r,e,t){let{batchRequest:n,commitment:i="confirmed"}=V({batchRequest:!1},t),o=zn(e,100),s=new Array(o.length).fill([]);if(n){let a=o.map(l=>{let m=r._buildArgs([l.map(d=>d.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:m}}),u=zn(a,10);s=(await(await Promise.all(u.map(async l=>await r._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&Xn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(m=>{if(m){let{data:d,executable:p,lamports:b,owner:f,rentEpoch:g}=m;return d.length!==2&&d[1]!=="base64"&&Xn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:p,lamports:b,owner:new ti.PublicKey(f),rentEpoch:g}}return null})))}else try{s=await Promise.all(o.map(a=>r.getMultipleAccountsInfo(a,i)))}catch(a){a instanceof Error&&Xn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function Hn(r,e,t){let n=await ut(r,e.map(i=>i.pubkey),t);return e.map((i,o)=>ie(V({},i),{accountInfo:n[o]}))}async function Yn({connection:r,address:e}){let t=await ut(r,[...new Set(e.map(i=>i.toString()))].map(i=>new ct.PublicKey(i))),n={};for(let i=0;i<e.length;i++){let o=t[i],s=e[i];if(!o)continue;let a=new ct.AddressLookupTableAccount({key:s,state:ct.AddressLookupTableAccount.deserialize(o.data)});n[s.toString()]=a,pn[s.toString()]=a}return n}var pn={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new ct.AddressLookupTableAccount({key:new ct.PublicKey("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:ct.AddressLookupTableAccount.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var fn=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await ri.default.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=dn(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==$.PublicKey.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(V({},t||{})):this.build(t)}build(e){let t=new $.Transaction;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async()=>{var i;let n=await kt(this.connection);if(t.recentBlockhash=n,this.signers.length&&t.sign(...this.signers),wt([t]),(i=this.owner)!=null&&i.isKeyPair)return{txId:await(0,$.sendAndConfirmTransaction)(this.connection,t,this.signers),signedTx:t};if(this.signAllTransactions){let o=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(o[0].serialize(),{skipPreflight:!0}),signedTx:o[0]}}throw new Error("please connect wallet first")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:i}=this.build(n),o=t.filter(c=>c.transaction.instructions.length>0),s=[i,...o.map(c=>c.transaction)],a=[this.signers,...o.map(c=>c.signers)],u=[...this.instructionTypes,...o.map(c=>c.instructionTypes).flat()];return{builder:this,transactions:s,signers:a,instructionTypes:u,execute:async c=>{var p;let{sequentially:l,onTxUpdate:m}=c||{},d=await kt(this.connection);if((p=this.owner)!=null&&p.isKeyPair)return{txIds:await await Promise.all(s.map(async(b,f)=>(b.recentBlockhash=d,await(0,$.sendAndConfirmTransaction)(this.connection,b,a[f])))),signedTxs:s};if(this.signAllTransactions){let b=s.map((g,y)=>(g.recentBlockhash=d,a[y].length&&g.sign(...a[y]),g));wt(b);let f=await this.signAllTransactions(b);if(l){let g=0,y=[],A=async()=>{if(!f[g])return;let w=await this.connection.sendRawTransaction(f[g].serialize(),{skipPreflight:!0});y.push({txId:w,status:"sent",signedTx:f[g]}),m==null||m([...y]),g++,this.connection.onSignature(w,P=>{let h=y.findIndex(x=>x.txId===w);h>-1&&(y[h].status=P.err?"error":"success"),m==null||m([...y]),A()},"processed"),this.connection.getSignatureStatus(w)};return await A(),{txIds:y.map(w=>w.txId),signedTxs:f}}else{let g=[];for(let y=0;y<f.length;y+=1){let A=await this.connection.sendRawTransaction(f[y].serialize(),{skipPreflight:!0});g.push(A)}return{txIds:g,signedTxs:f}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){let d=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:i}=d,o=$t(d,["lookupTableCache","lookupTableAddress","forerunCreate"]),s=V(V({},pn),t),a=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let p of a)s[p]===void 0&&u.push(new $.PublicKey(p));let c=await Yn({connection:this.connection,address:u});for(let[p,b]of Object.entries(c))s[p]=b;let l=new $.TransactionMessage({payerKey:this.feePayer,recentBlockhash:i?$.PublicKey.default.toBase58():await kt(this.connection),instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s)),m=new $.VersionedTransaction(l);return m.sign(this.signers),{builder:this,transaction:m,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async()=>{var p;if(wt([m]),(p=this.owner)!=null&&p.isKeyPair)return m.sign([this.owner.signer]),{txId:await this.connection.sendTransaction(m,{skipPreflight:!0}),signedTx:m};if(this.signAllTransactions){let b=await this.signAllTransactions([m]);return{txId:await this.connection.sendTransaction(b[0],{skipPreflight:!0}),signedTx:b[0]}}throw new Error("please connect wallet first")},extInfo:o||{}}}async buildV0MultiTx(e){let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:i}=await this.buildV0(n),o=t.filter(c=>c.builder.instructions.length>0),s=[i,...o.map(c=>c.transaction)],a=[this.signers,...o.map(c=>c.signers)],u=[...this.instructionTypes,...o.map(c=>c.instructionTypes).flat()];return s.forEach(async(c,l)=>{c.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:u,buildProps:n,execute:async c=>{var d;wt(s);let{sequentially:l,onTxUpdate:m}=c||{};if((d=this.owner)!=null&&d.isKeyPair)return s.forEach(p=>p.sign([this.owner.signer])),{txIds:await Promise.all(s.map(async p=>await this.connection.sendTransaction(p))),signedTxs:s};if(this.signAllTransactions){let p=await this.signAllTransactions(s);if(l){let b=0,f=[],g=async()=>{if(!p[b])return;let y=await this.connection.sendTransaction(p[b],{skipPreflight:!0});f.push({txId:y,status:"sent",signedTx:p[b]}),m==null||m([...f]),b++,this.connection.onSignature(y,A=>{let w=f.findIndex(P=>P.txId===y);w>-1&&(f[w].status=A.err?"error":"success"),m==null||m([...f]),g()},"processed"),this.connection.getSignatureStatus(y)};return g(),{txIds:[],signedTxs:p}}else{let b=[];for(let f=0;f<p.length;f+=1){let g=await this.connection.sendTransaction(p[f],{skipPreflight:!0});b.push(g)}return{txIds:b,signedTxs:p}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async sizeCheckBuild(e){let c=e||{},{autoComputeBudget:t=!1}=c,n=$t(c,["autoComputeBudget"]),i={instructions:[],instructionTypes:[]};if(t){let l=t?await this.getComputeBudgetConfig():void 0;i=t&&l?dn(l):{instructions:[],instructionTypes:[]}}let o=this.signers.reduce((l,m)=>ie(V({},l),{[m.publicKey.toBase58()]:m}),{}),s=[],a=[],u=[];if(this.allInstructions.forEach(l=>{let m=[...u,l],d=t?[...i.instructions,...m]:m,b=[...new Set(m.map(f=>f.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(f=>new $.PublicKey(f));if(u.length<12&&Gt({instructions:d,payer:this.feePayer,signers:b})||Gt({instructions:m,payer:this.feePayer,signers:b}))u.push(l);else{if(u.length===0)throw Error("item ins too big");Gt({instructions:t?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:b})?s.push(new $.Transaction().add(...i.instructions,...u)):s.push(new $.Transaction().add(...u)),a.push(Array.from(new Set(u.map(f=>f.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat())).map(f=>o[f]).filter(f=>f!==void 0)),u=[l]}}),u.length>0){let m=[...new Set(u.map(d=>d.keys.filter(p=>p.isSigner).map(p=>p.pubkey.toString())).flat()).values()].map(d=>o[d]).filter(d=>d!==void 0);Gt({instructions:t?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:m.map(d=>d.publicKey)})?s.push(new $.Transaction().add(...i.instructions,...u)):s.push(new $.Transaction().add(...u)),a.push(m)}return s.forEach(l=>l.feePayer=this.feePayer),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async l=>{var b;let{sequentially:m,onTxUpdate:d}=l||{},p=await kt(this.connection);if(s.forEach(async(f,g)=>{f.recentBlockhash=p,a[g].length&&f.sign(...a[g])}),wt(s),(b=this.owner)!=null&&b.isKeyPair)return{txIds:await Promise.all(s.map(async(f,g)=>await(0,$.sendAndConfirmTransaction)(this.connection,f,a[g]))),signedTxs:s};if(this.signAllTransactions){let f=await this.signAllTransactions(s);if(m){let g=0,y=[],A=async()=>{if(!f[g])return;let w=await this.connection.sendRawTransaction(f[g].serialize(),{skipPreflight:!0});y.push({txId:w,status:"sent",signedTx:f[g]}),d==null||d([...y]),g++,this.connection.onSignature(w,P=>{let h=y.findIndex(x=>x.txId===w);h>-1&&(y[h].status=P.err?"error":"success"),d==null||d([...y]),A()},"processed"),this.connection.getSignatureStatus(w)};return await A(),{txIds:y.map(w=>w.txId),signedTxs:f}}else{let g=[];for(let y=0;y<f.length;y+=1){let A=await this.connection.sendRawTransaction(f[y].serialize(),{skipPreflight:!0});g.push(A)}return{txIds:g,signedTxs:f}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async sizeCheckBuildV0(e){let g=e||{},{autoComputeBudget:t=!1,lookupTableCache:n={},lookupTableAddress:i=[]}=g,o=$t(g,["autoComputeBudget","lookupTableCache","lookupTableAddress"]),s=V(V({},pn),n),a=Array.from(new Set([...this.lookupTableAddress,...i])),u=[];for(let y of a)s[y]===void 0&&u.push(new $.PublicKey(y));let c=await Yn({connection:this.connection,address:u});for(let[y,A]of Object.entries(c))s[y]=A;let l={instructions:[],instructionTypes:[]};if(t){let y=t?await this.getComputeBudgetConfig():void 0;l=t&&y?dn(y):{instructions:[],instructionTypes:[]}}let m=await kt(this.connection),d=this.signers.reduce((y,A)=>ie(V({},y),{[A.publicKey.toBase58()]:A}),{}),p=[],b=[],f=[];if(this.allInstructions.forEach(y=>{let A=[...f,y],w=t?[...l.instructions,...A]:A;if(f.length<12&&Ut({instructions:w,payer:this.feePayer,lookupTableAddressAccount:s})||Ut({instructions:A,payer:this.feePayer,lookupTableAddressAccount:s}))f.push(y);else{if(f.length===0)throw Error("item ins too big");let P={};for(let h of[...new Set(a)])s[h]!==void 0&&(P[h]=s[h]);if(t&&Ut({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let h=new $.TransactionMessage({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new $.VersionedTransaction(h))}else{let h=new $.TransactionMessage({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new $.VersionedTransaction(h))}b.push(Array.from(new Set(f.map(h=>h.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat())).map(h=>d[h]).filter(h=>h!==void 0)),f=[y]}}),f.length>0){let A=[...new Set(f.map(w=>w.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(w=>d[w]).filter(w=>w!==void 0);if(t&&Ut({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let w=new $.TransactionMessage({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new $.VersionedTransaction(w))}else{let w=new $.TransactionMessage({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new $.VersionedTransaction(w))}b.push(A)}return{builder:this,transactions:p,buildProps:e,signers:b,instructionTypes:this.instructionTypes,execute:async y=>{var P;let{sequentially:A,onTxUpdate:w}=y||{};if(p.map(async(h,x)=>{b[x].length&&h.sign(b[x])}),wt(p),(P=this.owner)!=null&&P.isKeyPair)return{txIds:await Promise.all(p.map(async h=>await this.connection.sendTransaction(h,{skipPreflight:!0}))),signedTxs:p};if(this.signAllTransactions){let h=await this.signAllTransactions(p);if(A){let x=0,B=[],N=async()=>{if(!h[x])return;let D=await this.connection.sendTransaction(h[x],{skipPreflight:!0});B.push({txId:D,status:"sent",signedTx:h[x]}),w==null||w([...B]),x++,this.connection.onSignature(D,q=>{let _=B.findIndex(ge=>ge.txId===D);_>-1&&(B[_].status=q.err?"error":"success"),w==null||w([...B]),N()},"processed"),this.connection.getSignatureStatus(D)};return N(),{txIds:[],signedTxs:h}}else{let x=[];for(let B=0;B<h.length;B+=1){let N=await this.connection.sendTransaction(h[B],{skipPreflight:!0});x.push(N)}return{txIds:x,signedTxs:h}}}throw new Error("please connect wallet first")},extInfo:o||{}}}};function zn(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var Ke=require("@solana/web3.js"),ku=new Ke.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),xu=new Ke.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Bu=new Ke.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Iu=new Ke.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Su=new Ke.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Cu=new Ke.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Ku=new Ke.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Nu=new Ke.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Ru=new Ke.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Lu=new Ke.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Fu=new Ke.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Ou=new Ke.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Mu=new Ke.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Eu=new Ke.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi");var ii=require("@solana/web3.js");var oi=require("@solana/spl-token");function Ve(r,e,t){return Oe([r.toBuffer(),(t!=null?t:oi.TOKEN_PROGRAM_ID).toBuffer(),e.toBuffer()],new ii.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}var ue=oe(require("bn.js")),He=1e4;function Bt(r,e,t,n){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let i=t.epoch<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new ue.default(i.maximumFee.toString()),s=t.epoch<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(i.transferFeeBasisPoints===He){let a=new ue.default(i.maximumFee.toString());return{amount:r.add(a),fee:a,expirationTime:s}}else{let a=xt(r.mul(new ue.default(He)),new ue.default(He-i.transferFeeBasisPoints)),u=new ue.default(i.maximumFee.toString()),c=a.sub(r).gt(u)?r.add(u):a,l=xt(c.mul(new ue.default(i.transferFeeBasisPoints)),new ue.default(He)),m=l.gt(o)?o:l;return{amount:c,fee:m,expirationTime:s}}else{let a=xt(r.mul(new ue.default(i.transferFeeBasisPoints)),new ue.default(He)),u=a.gt(o)?o:a;return{amount:r,fee:u,expirationTime:s}}}function ye(r,e,t,n){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let i=ie(V({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,s=new ue.default(o.maximumFee.toString()),a=t.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===He){let u=new ue.default(o.maximumFee.toString());return{amount:r.add(u),fee:u,expirationTime:a}}else{let u=xt(r.mul(new ue.default(He)),new ue.default(He-o.transferFeeBasisPoints)),c=new ue.default(o.maximumFee.toString()),l=u.sub(r).gt(c)?r.add(c):u,m=xt(l.mul(new ue.default(o.transferFeeBasisPoints)),new ue.default(He)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let u=xt(r.mul(new ue.default(o.transferFeeBasisPoints)),new ue.default(He)),c=u.gt(s)?s:u;return{amount:r,fee:c,expirationTime:a}}}function ht(r,e){return r===void 0?e:e===void 0?r:Math.min(r,e)}function xt(r,e){let{div:t,mod:n}=r.divmod(e);return n.gt(new ue.default(0))?t.add(new ue.default(1)):t}var jn=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Xt=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=fe(t)}createTxBuilder(e){return this.scope.checkOwner(),new fn({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(jn(e))}logInfo(...e){this.logger.info(jn(e))}logAndCreateError(...e){let t=jn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var qe=oe(require("bn.js")),z=new qe.default(0),Le=new qe.default(1),Ye=new qe.default(-1),Fe=new qe.default(1).shln(64),zt=new qe.default(1).shln(128),bn=Fe.sub(Le),It=64,Zn=zt.subn(1),Te=-443636,Se=-Te,et=new qe.default("4295048016"),tt=new qe.default("79226673521066979257578248091"),Qn=16,$n="59543866431248",Jn="184467440737095516",er="15793534762490258745",Ht=new qe.default(10).pow(new qe.default(6)),si=(n=>(n[n.rate_500=500]="rate_500",n[n.rate_3000=3e3]="rate_3000",n[n.rate_10000=1e4]="rate_10000",n))(si||{}),jo={[500]:10,[3e3]:60,[1e4]:200},Zo={version:6,liquidity:z,tickCurrent:0,observationIndex:0,observationUpdateDuration:0,feeGrowthGlobalX64A:z,feeGrowthGlobalX64B:z,protocolFeesTokenA:z,protocolFeesTokenB:z,swapInAmountTokenA:z,swapOutAmountTokenB:z,swapInAmountTokenB:z,swapOutAmountTokenA:z,tickArrayBitmap:[],rewardInfos:[],day:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},week:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},month:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},tvl:0},tr={tvl:0,volumeQuote:0,mintAmountA:0,mintAmountB:0,rewardDefaultInfos:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,day:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},week:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},month:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},pooltype:[]},Qo=new qe.default("18446744073700000000");var v=oe(require("bn.js"));function nr(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r,!1),new Uint8Array(e)}function $o(r){let e=new ArrayBuffer(2);return new DataView(e).setInt16(0,r,!1),new Uint8Array(e)}function Jo(r){let e=new ArrayBuffer(4);return new DataView(e).setUint32(0,r,!1),new Uint8Array(e)}function Yt(r){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,r,!1),new Uint8Array(e)}function gn(r,e){let t=0;for(let n=r-1;n>=0&&!e.testn(n);n--)t++;return t}function yn(r,e){let t=0;for(let n=0;n<r&&!e.testn(n);n++)t++;return t}function St(r,e){for(let t=0;t<r;t++)if(e.testn(t))return!1;return!0}function rr(r,e){return St(r,e)?null:gn(r,e)}function ir(r,e){return St(r,e)?null:yn(r,e)}var ai=Buffer.from("amm_config","utf8"),ui=Buffer.from("pool","utf8"),ci=Buffer.from("pool_vault","utf8"),li=Buffer.from("pool_reward_vault","utf8"),or=Buffer.from("position","utf8"),mi=Buffer.from("tick_array","utf8"),di=Buffer.from("operation","utf8"),pi=Buffer.from("pool_tick_array_bitmap_extension","utf8");function es(r,e){return Oe([ai,nr(e)],r)}function sr(r,e,t,n){return Oe([ui,e.toBuffer(),t.toBuffer(),n.toBuffer()],r)}function wn(r,e,t){return Oe([ci,e.toBuffer(),t.toBuffer()],r)}function ar(r,e,t){return Oe([li,e.toBuffer(),t.toBuffer()],r)}function Z(r,e,t){return Oe([mi,e.toBuffer(),Yt(t)],r)}function lt(r,e,t,n){return Oe([or,e.toBuffer(),Yt(t),Yt(n)],r)}function We(r,e){return Oe([or,e.toBuffer()],r)}function jt(r){return Oe([Buffer.from("metadata","utf8"),Tt.toBuffer(),r.toBuffer()],Tt)}function Ct(r){return Oe([di],r)}function nt(r,e){return Oe([pi,e.toBuffer()],r)}var fr=require("@solana/web3.js"),ae=oe(require("bn.js"));var xi=oe(require("bn.js"));var yi=require("@solana/web3.js"),Nt=oe(require("bn.js"));var K=require("@solana/buffer-layout"),ur=K.Layout,fi=K.Structure;var cr=K.UInt;var bi=K.u8,Kt=K.u16;var ke=K.s32;var gi=K.seq;var Ee=K.blob;var Zt=class extends ur{constructor(t,n,i){super(t,i);this.blob=Ee(t),this.signed=n}decode(t,n=0){let i=new Nt.default(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new Nt.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function ce(r){return new cr(1,r)}function rt(r){return new cr(4,r)}function O(r){return new Zt(8,!1,r)}function W(r){return new Zt(16,!1,r)}function wi(r){return new Zt(16,!0,r)}var hn=class extends ur{constructor(t,n,i,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function ne(r){return new hn(Ee(32),e=>new yi.PublicKey(e),e=>e.toBuffer(),r)}function je(r){return new hn(bi(),ts,ns,r)}function ts(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function ns(r){return r?1:0}var lr=class extends fi{decode(e,t){return super.decode(e,t)}};function ee(r,e,t){return new lr(r,e,t)}function se(r,e,t){let n,i=typeof e=="number"?e:(0,Nt.isBN)(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=(0,Nt.isBN)(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return gi(r,i,t)}var An=14,Ze=class{static maxTickInTickarrayBitmap(e){return e*de*mt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(i+=1);let o=n*i;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,i){if(!U.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=i?t-U.tickCount(n):t+U.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*de,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(i){let l=e.shln(1024-c-1),m=rr(1024,l);if(m!==null){let d=(c-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=ir(1024,l);if(m!==null){let d=(c+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-U.tickCount(n)}}}},Rt=class{static getBitmapOffset(e,t){if(!U.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=Ze.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&i--,i}static getBitmap(e,t,n){let i=this.getBitmapOffset(e,t);return e<0?{offset:i,tickarrayBitmap:n.negativeTickArrayBitmap[i]}:{offset:i,tickarrayBitmap:n.positiveTickArrayBitmap[i]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:i}=this.extensionTickBoundary(t);if(e>=i&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=Ze.maxTickInTickarrayBitmap(e),n=-t;if(Se<=t)throw Error(`extensionTickBoundary check error: ${Se}, ${t}`);if(n<=Te)throw Error(`extensionTickBoundary check error: ${n}, ${Te}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:i}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:S.mergeTickArrayBitmap(i).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,i){let o=U.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,i);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,i){let{minValue:o,maxValue:s}=Ze.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(i){let u=S.mergeTickArrayBitmap(e).shln(mt-1-a),c=St(512,u)?null:gn(512,u);if(c!==null){let l=t-c*U.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=S.mergeTickArrayBitmap(e).shrn(a),c=St(512,u)?null:yn(512,u);if(c!==null){let l=t+c*U.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-U.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%Ze.maxTickInTickarrayBitmap(t),i=Math.floor(n/U.tickCount(t));return e<0&&n!=0&&(i=mt-i),i}};var rs=ee([Ee(8),ce("bump"),Kt("index"),ne(""),rt("protocolFeeRate"),rt("tradeFeeRate"),Kt("tickSpacing"),se(O(),8,"")]),hi=ee([rt("blockTimestamp"),W("sqrtPriceX64"),W("cumulativeTimePriceX64"),se(W(),1,"")]),Pn=ee([Ee(8),je("initialized"),ne("poolId"),se(hi,1e3,"observations"),se(W(),5,"")]),Ai=ee([ce("rewardState"),O("openTime"),O("endTime"),O("lastUpdateTime"),W("emissionsPerSecondX64"),O("rewardTotalEmissioned"),O("rewardClaimed"),ne("tokenMint"),ne("tokenVault"),ne("creator"),W("rewardGrowthGlobalX64")]),is=ee([Ee(8),ce("bump"),ne("ammConfig"),ne("creator"),ne("mintA"),ne("mintB"),ne("vaultA"),ne("vaultB"),ne("observationId"),ce("mintDecimalsA"),ce("mintDecimalsB"),Kt("tickSpacing"),W("liquidity"),W("sqrtPriceX64"),ke("tickCurrent"),Kt("observationIndex"),Kt("observationUpdateDuration"),W("feeGrowthGlobalX64A"),W("feeGrowthGlobalX64B"),O("protocolFeesTokenA"),O("protocolFeesTokenB"),W("swapInAmountTokenA"),W("swapOutAmountTokenB"),W("swapInAmountTokenB"),W("swapOutAmountTokenA"),ce("status"),se(ce(),7,""),se(Ai,3,"rewardInfos"),se(O(),16,"tickArrayBitmap"),O("totalFeesTokenA"),O("totalFeesClaimedTokenA"),O("totalFeesTokenB"),O("totalFeesClaimedTokenB"),O("fundFeesTokenA"),O("fundFeesTokenB"),O("startTime"),se(O(),15*4-3,"padding")]),Pi=ee([W("growthInsideLastX64"),O("rewardAmountOwed")]),mr=ee([Ee(8),ce("bump"),ne("nftMint"),ne("poolId"),ke("tickLower"),ke("tickUpper"),W("liquidity"),W("feeGrowthInsideLastX64A"),W("feeGrowthInsideLastX64B"),O("tokenFeesOwedA"),O("tokenFeesOwedB"),se(Pi,3,"rewardInfos"),se(O(),8,"")]),os=ee([Ee(8),ce("bump"),ne("poolId"),ke("tickLowerIndex"),ke("tickUpperIndex"),W("liquidity"),W("feeGrowthInsideLastX64A"),W("feeGrowthInsideLastX64B"),O("tokenFeesOwedA"),O("tokenFeesOwedB"),se(W(),3,"rewardGrowthInside"),se(O(),8,"")]),Ti=ee([ke("tick"),wi("liquidityNet"),W("liquidityGross"),W("feeGrowthOutsideX64A"),W("feeGrowthOutsideX64B"),se(W(),3,"rewardGrowthsOutsideX64"),se(rt(),13,"")]),Lt=ee([Ee(8),ne("poolId"),ke("startTickIndex"),se(Ti,de,"ticks"),ce("initializedTickCount"),se(ce(),115,"")]),dr=ee([Ee(329),se(ne(),100,"whitelistMints")]),pr=ee([Ee(8),ne("poolId"),se(se(O(),8),An,"positiveTickArrayBitmap"),se(se(O(),8),An,"negativeTickArrayBitmap")]);var ki=15,U=class{static async getTickArrays(e,t,n,i,o,s,a){let u=[],c=S.getTickArrayStartIndexByTick(i,o),l=S.getInitializedTickArrayInRange(s,a,o,c,Math.floor(ki/2));for(let p=0;p<l.length;p++){let{publicKey:b}=Z(t,n,l[p]);u.push(b)}let m=(await ut(e,u)).map(p=>p!==null?Lt.decode(p.data):null),d={};for(let p=0;p<u.length;p++){let b=m[p];b!==null&&(d[b.startTickIndex]=ie(V({},b),{address:u[p]}))}return d}static nextInitializedTick(e,t,n,i,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,i,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=S.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,i,o){let s=Math.floor(e/U.tickCount(t)),a=n?S.searchLowBitFromStart(i,o,s-1,1,t):S.searchHightBitFromStart(i,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,i){let o;if(i){let a=de-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<de;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=Z(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,i,o,s){let a=S.getTickArrayStartIndexByTick(i,o),u=Math.floor((i-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u-1}else for(u=u+1;u<de;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u+1}let{publicKey:m}=Z(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(S.checkIsOutOfBoundary(e)){if(e>Se)return!1;let n=S.getTickArrayStartIndexByTick(Te,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return de*e}};var de=60,mt=512,S=class{static getTickArrayAddressByTick(e,t,n,i){let o=S.getTickArrayStartIndexByTick(n,i),{publicKey:s}=Z(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=S.getTickArrayStartIndexByTick(e,t),i=Math.floor((e-n)/t);if(i<0||i>=de)throw new Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,t){let n=U.tickCount(t),i=e/n;return e<0&&e%n!=0?i=Math.ceil(i)-1:i=Math.floor(i),i}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*U.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*de,i=Math.floor(e/n)+512;return Math.abs(i)}static checkTickArrayIsInitialized(e,t,n){let i=n*de,o=Math.floor(t/i)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*i}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*de:e+t*de}static mergeTickArrayBitmap(e){let t=new xi.default(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,i,o){let s=Math.floor(i/(n*de));return[...S.searchLowBitFromStart(e,t,s-1,o,n),...S.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return S.searchHightBitFromStart(e,t,0,mt,n)}static getAllInitializedTickArrayInfo(e,t,n,i,o){let s=[],a=S.getAllInitializedTickArrayStartIndex(n,i,o);for(let u of a){let{publicKey:c}=Z(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>S.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===i)break}let u=U.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>S.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===i)break}let u=U.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<Te||e>Se}static nextInitTick(e,t,n,i,o){if(U.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(i)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<de;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=de-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<de;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let i=F.getSqrtPriceX64FromTick(t),o=F.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new I(1).div(o),tickSqrtPriceX64:i}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let i=n?t:new I(1).div(t),o=dt.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=F.getSqrtPriceX64FromTick(o),a=F.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new I(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let i=F.getSqrtPriceX64FromTick(t),o=F.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new I(1).div(o),tickSqrtPriceX64:i}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let i=n?t:new I(1).div(t),o=dt.getTickWithPriceAndTickspacing(i,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=F.getSqrtPriceX64FromTick(o),a=F.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new I(1).div(a)}}};var Ge=oe(require("bn.js"));var Ft=class{static getfeeGrowthInside(e,t,n){let i=new Ge.default(0),o=new Ge.default(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new Ge.default(0),a=new Ge.default(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=M.wrappingSubU128(M.wrappingSubU128(e.feeGrowthGlobalX64A,i),s),c=M.wrappingSubU128(M.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=M.mulDivFloor(M.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Fe),u=t.tokenFeesOwedA.add(a),c=M.mulDivFloor(M.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Fe),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=M.mulDivFloor(M.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Fe),u=t.tokenFeesOwedA.add(a),c=M.mulDivFloor(M.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Fe),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,i){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=M.wrappingSubU128(u,c.growthInsideLastX64),m=M.mulDivFloor(l,t.liquidity,Fe),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,i){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=M.wrappingSubU128(u,c.growthInsideLastX64),m=M.mulDivFloor(l,t.liquidity,Fe),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new Ge.default(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Ge.default(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(M.wrappingSubU128(M.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new Ge.default(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Ge.default(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(M.wrappingSubU128(M.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:o,epochInfo:s}){var g,y,A,w;let a=F.priceToSqrtPriceX64(new I(e.price),e.mintA.decimals,e.mintB.decimals),u=F.getSqrtPriceX64FromTick(t.tickLower),c=F.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+i:1-i,m=G.getAmountsFromLiquidity(a,u,c,n,o),[d,p]=[ye(m.amountA,(g=e.mintA.extensions)==null?void 0:g.feeConfig,s,!0),ye(m.amountB,(y=e.mintB.extensions)==null?void 0:y.feeConfig,s,!0)],[b,f]=[ye(new Ge.default(new I(m.amountA.toString()).mul(l).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,s,!0),ye(new Ge.default(new I(m.amountB.toString()).mul(l).toFixed(0)),(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:b,amountSlippageB:f,expirationTime:ht(d.expirationTime,p.expirationTime)}}};var we=class{static getOutputAmountAndRemainAccounts(e,t,n,i,o){let s=n.equals(e.mintA.mint),a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:b}=pt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i,c,o);return a.push(...d),{expectedAmountOut:m.mul(Ye),remainingAccounts:a,executionPrice:p,feeAmount:b}}static getInputAmountAndRemainAccounts(e,t,n,i,o){let s=n.equals(e.mintB.mint),a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:g}=Z(e.programId,e.id,f.nextStartIndex);a.push(g)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:b}=pt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i.mul(Ye),c,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:p,feeAmount:b}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:i}=we.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Rt.checkTickArrayIsInit(U.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):S.checkTickArrayIsInitialized(S.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=Z(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,U.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=Z(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/U.tickCount(e.tickSpacing)),i=t?S.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):S.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=U.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:i,tickIndex:o}=Ze.nextInitializedTickArrayStartIndex(S.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(i)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Rt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Te||t>Se)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:i,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let p=ie(V({},m),{perSecond:M.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new fr.PublicKey(d)});if(p.tokenMint.equals(fr.PublicKey.default))continue;if(n<=p.openTime.toNumber()||i.eq(z)){s.push(p);continue}let b=new ae.default(Math.min(p.endTime.toNumber(),n)),f=b.sub(p.lastUpdateTime),g=M.mulDivFloor(f,p.emissionsPerSecondX64,i),y=p.rewardGrowthGlobalX64.add(g),A=M.mulDivFloor(f,p.emissionsPerSecondX64,Fe),w=p.rewardTotalEmissioned.add(A);s.push(ie(V({},p),{rewardGrowthGlobalX64:y,rewardTotalEmissioned:w,lastUpdateTime:b}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:i}=this.tickRange(e);for(let o of t){let s=S.getTickArrayStartIndexByTick(o,e);if(s>=n||s<i)return!0}return!1}static tickRange(e){let t=Ze.maxTickInTickarrayBitmap(e),n=-t;return t>Se&&(t=U.getArrayStartIndex(Se,e)+U.tickCount(e)),n<Te&&(n=U.getArrayStartIndex(Te,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!U.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/U.tickCount(t)*mt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let i=await Hn(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of i)s.accountInfo!==null&&(o[s.pubkey.toString()]=pr.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let i={},o=[];for(let u of t){let c=S.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=S.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:d}=Z(u.programId,u.id,m);o.push({pubkey:d}),i[d.toString()]=u.id}}let s=await Hn(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=i[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=Lt.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]=ie(V({},l),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:i=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let p of s)c.push(We(p,d).publicKey);let l=await ut(t,c,{batchRequest:i}),m={};for(let d of l){if(d===null)continue;let p=mr.decode(d.data),b=p.poolId.toString(),f=e.find(N=>N.state.id.toBase58()===b);if(f===void 0)continue;let g=f.state,y=S._getTickPriceLegacy({poolInfo:g,tick:p.tickLower,baseIn:!0}),A=S._getTickPriceLegacy({poolInfo:g,tick:p.tickUpper,baseIn:!0}),{amountA:w,amountB:P}=G.getAmountsFromLiquidity(g.sqrtPriceX64,y.tickSqrtPriceX64,A.tickSqrtPriceX64,p.liquidity,!1),h=1/(1-Math.sqrt(Math.sqrt(y.price.div(A.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:y.price,priceUpper:A.price,amountA:w,amountB:P,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(N=>ie(V({},N),{pendingReward:new ae.default(0)})),leverage:h,tokenFeeAmountA:new ae.default(0),tokenFeeAmountB:new ae.default(0)}];let x=await S.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),B=await S.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=x,m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=B}if(o){let d=Object.values(m),p=await ut(t,d,{batchRequest:i}),b={};for(let f=0;f<d.length;f++){let g=p[f];if(g===null)continue;let y=d[f].toString();b[y]=Lt.decode(g.data)}for(let{state:f,positionAccount:g}of e)if(!!g)for(let y of g){let A=`${f.programId.toString()}-${f.id.toString()}-${y.tickLower}`,w=`${f.programId.toString()}-${f.id.toString()}-${y.tickUpper}`,P=b[m[A].toString()],h=b[m[w].toString()],x=P.ticks[S.getTickOffsetInArray(y.tickLower,f.tickSpacing)],B=h.ticks[S.getTickOffsetInArray(y.tickUpper,f.tickSpacing)],{tokenFeeAmountA:N,tokenFeeAmountB:D}=await Ft.GetPositionFees(f,y,x,B),q=await Ft.GetPositionRewards(f,y,x,B);y.tokenFeeAmountA=N.gte(new ae.default(0))?N:new ae.default(0),y.tokenFeeAmountB=D.gte(new ae.default(0))?D:new ae.default(0);for(let _=0;_<q.length;_++)y.rewardInfos[_].pendingReward=q[_].gte(new ae.default(0))?q[_]:new ae.default(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,token2022Infos:i,epochInfo:o,amountIn:s,slippage:a,priceLimit:u=new I(0)}){var D,q,_,ge;let c;u.equals(new I(0))?c=n.equals(e.mintA.mint)?et.add(new ae.default(1)):tt.sub(new ae.default(1)):c=F.priceToSqrtPriceX64(u,e.mintA.decimals,e.mintB.decimals);let l=Bt(s,(D=i[n.toString()])==null?void 0:D.feeConfig,o,!1),{expectedAmountOut:m,remainingAccounts:d,executionPrice:p,feeAmount:b}=we.getOutputAmountAndRemainAccounts(e,t,n,l.amount.sub((q=l.fee)!=null?q:z),c),f=e.mintA.mint.equals(n)?e.mintB.mint:e.mintA.mint,g=Bt(m,(_=i[f.toString()])==null?void 0:_.feeConfig,o,!1),y=F.sqrtPriceX64ToPrice(p,e.mintA.decimals,e.mintB.decimals),A=n.equals(e.mintA.mint)?y:new I(1).div(y),w=m.mul(new ae.default(Math.floor((1-a)*1e10))).div(new ae.default(1e10)),P=Bt(w,(ge=i[f.toString()])==null?void 0:ge.feeConfig,o,!1),h=e.mintA.mint.equals(n)?e.currentPrice:new I(1).div(e.currentPrice),x=new I(A).sub(h).abs(),B=h,N=new Je(new I(x).mul(10**15).toFixed(0),new I(B).mul(10**15).toFixed(0));return{realAmountIn:l,amountOut:g,minAmountOut:P,expirationTime:ht(l.expirationTime,g.expirationTime),currentPrice:e.currentPrice,executionPrice:A,priceImpact:N,fee:b,remainingAccounts:d}}static async computeAmountOutFormat({poolInfo:e,tickArrayCache:t,token2022Infos:n,amountIn:i,tokenOut:o,slippage:s,epochInfo:a}){let u=i.token.equals($e.WSOL)?te:i.token.mint,c=s.numerator.toNumber()/s.denominator.toNumber(),l=o.mint.equals(gt)?new $e({mint:"sol",decimals:un.decimals}):o,{realAmountIn:m,amountOut:d,minAmountOut:p,expirationTime:b,currentPrice:f,executionPrice:g,priceImpact:y,fee:A,remainingAccounts:w}=await we.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:u,amountIn:i.raw,slippage:c,token2022Infos:n,epochInfo:a}),P=ie(V({},m),{amount:new Be(i.token,m.amount),fee:m.fee===void 0?void 0:new Be(i.token,m.fee)}),h=ie(V({},d),{amount:new Be(l,d.amount),fee:d.fee===void 0?void 0:new Be(l,d.fee)}),x=ie(V({},p),{amount:new Be(l,p.amount),fee:p.fee===void 0?void 0:new Be(l,p.fee)}),B=new _e({baseToken:i.token,denominator:new ae.default(10).pow(new ae.default(20+i.token.decimals)),quoteToken:l,numerator:f.mul(new I(10**(20+l.decimals))).toFixed(0)}),N=new _e({baseToken:i.token,denominator:new ae.default(10).pow(new ae.default(20+i.token.decimals)),quoteToken:l,numerator:g.mul(new I(10**(20+l.decimals))).toFixed(0)}),D=new Be(i.token,A);return{realAmountIn:P,amountOut:h,minAmountOut:x,expirationTime:b,currentPrice:B,executionPrice:N,priceImpact:y,fee:D,remainingAccounts:w}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:i}){var b,f,g;let o=e[t],s=S.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=S.getTickPrice({poolInfo:e,tick:i,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,d=o.priceMax-o.priceMin,p;return l<=0?p=0:m===l?p=d/l:d===l?p=l/m:p=l/d*(l/m),{feeApr:o.feeApr*p,rewardsApr:[(b=o.rewardApr[0])!=null?b:0*p,(f=o.rewardApr[1])!=null?f:0*p,(g=o.rewardApr[2])!=null?g:0*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:i,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=i[vn(e.mintA.address).toString()],d=i[vn(e.mintB.address).toString()],p=e.mintA.decimals,b=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=F.priceToSqrtPriceX64(new I(e.price),e.mintA.decimals,e.mintB.decimals),g=F.getSqrtPriceX64FromTick(s),y=F.getSqrtPriceX64FromTick(a),{amountSlippageA:A,amountSlippageB:w}=G.getAmountsFromLiquidityWithSlippage(f,g,y,t,!1,!1,0),{amountSlippageA:P,amountSlippageB:h}=G.getAmountsFromLiquidityWithSlippage(f,g,y,o,!1,!1,0),x=new I(A.toString()).div(new I(10).pow(p)).mul(m.value).add(new I(w.toString()).div(new I(10).pow(b)).mul(d.value)),B=new I(P.toString()).div(new I(10).pow(p)).mul(m.value).add(new I(h.toString()).div(new I(10).pow(b)).mul(d.value)),N=B.div(x.add(B)).div(B),q=new I(l.volumeFee).mul(365).div(c).mul(N).mul(100).toNumber(),_=3600*24*365,ge=e.rewardDefaultInfos.map(le=>{var j,Pr;let Ne=le.mint.decimals,re=i[le.mint.address];return u<((j=le.startTime)!=null?j:0)||u>((Pr=le.endTime)!=null?Pr:0)||!le.perSecond||!re||Ne===void 0?0:new I(re.value).mul(new I(le.perSecond).mul(_)).div(new I(10).pow(Ne)).mul(N).mul(100).toNumber()});return{feeApr:q,rewardsApr:ge,apr:q+ge.reduce((le,Ne)=>le+Ne,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:i,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var y,A;let l=F.priceToSqrtPriceX64(new I(e.price),e.mintA.decimals,e.mintB.decimals),m=F.getSqrtPriceX64FromTick(n),d=F.getSqrtPriceX64FromTick(i),p=a?1-s:1+s,b=ye(o,(y=e[t?"mintA":"mintB"].extensions)==null?void 0:y.feeConfig,u,!c),f=new ae.default(new I(b.amount.sub((A=b.fee)!=null?A:z).toString()).mul(p).toFixed(0)),g;if(l.lte(m))g=t?G.getLiquidityFromTokenAmountA(m,d,f,!a):new ae.default(0);else if(l.lte(d)){let w=G.getLiquidityFromTokenAmountA(l,d,f,!a),P=G.getLiquidityFromTokenAmountB(m,l,f);g=t?w:P}else g=t?new ae.default(0):G.getLiquidityFromTokenAmountB(m,d,f);return we.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:i,liquidity:g,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:i,liquidity:o,slippage:s,add:a}){var g,y,A,w;let u=F.getSqrtPriceX64FromTick(n),c=F.getSqrtPriceX64FromTick(i),l=a?1+s:1-s,m=G.getAmountsFromLiquidity(F.priceToSqrtPriceX64(new I(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,p]=[ye(m.amountA,(g=t.mintA.extensions)==null?void 0:g.feeConfig,e,!0),ye(m.amountB,(y=t.mintB.extensions)==null?void 0:y.feeConfig,e,!0)],[b,f]=[ye(m.amountA.muln(l),(A=t.mintA.extensions)==null?void 0:A.feeConfig,e,!0),ye(m.amountB.muln(l),(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:p,amountSlippageA:b,amountSlippageB:f,expirationTime:ht(d.expirationTime,p.expirationTime)}}};function ss({poolInfo:r,tickLower:e,tickUpper:t,amountA:n,amountB:i,slippage:o,add:s,epochInfo:a,amountHasFee:u}){var w,P,h,x;let[c,l,m,d]=e<t?[e,t,n,i]:[t,e,i,n],p=F.priceToSqrtPriceX64(new I(r.price),r.mintA.decimals,r.mintB.decimals),b=F.getSqrtPriceX64FromTick(c),f=F.getSqrtPriceX64FromTick(l),[g,y]=[ye(m,(w=r.mintA.extensions)==null?void 0:w.feeConfig,a,!u),ye(d,(P=r.mintB.extensions)==null?void 0:P.feeConfig,a,!u)],A=G.getLiquidityFromTokenAmounts(p,b,f,g.amount.sub((h=g.fee)!=null?h:z),y.amount.sub((x=y.fee)!=null?x:z));return G.getAmountsOutFromLiquidity({poolInfo:r,tickLower:e,tickUpper:t,liquidity:A,slippage:o,add:s,epochInfo:a,amountAddFee:!u})}var M=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),o=i.div(n);return i.mod(n).eq(z)||(o=o.add(Le)),o}static mulDivFloor(e,t,n){if(n.eq(z))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(z))throw new Error("division by 0");return e.mul(t).add(n.sub(Le)).div(n)}static x64ToDecimal(e,t){return new I(e.toString()).div(I.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new v.default(e.mul(I.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(zt).sub(t).mod(zt)}};function he(r,e){return br(r.mul(e),64,256)}function as(r,e,t){let n=r.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function br(r,e,t){let n=r.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var F=class{static sqrtPriceX64ToPrice(e,t,n){return M.x64ToDecimal(e).pow(2).mul(I.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return M.decimalToX64(e.mul(I.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(z))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(z))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(z))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(z))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(z))return e;let o=t.shln(It);if(i){let s=o,a=o.add(n.mul(e));return a.gte(s)?M.mulDivCeil(s,e,a):M.mulDivRoundingUp(s,Le,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return M.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let o=n.shln(It);if(i)return e.add(o.div(t));{let s=M.mulDivRoundingUp(o,Le,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Te||e>Se)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new v.default("18445821805675395072"):new v.default("18446744073709551616");return(t&2)!=0&&(n=he(n,new v.default("18444899583751176192"))),(t&4)!=0&&(n=he(n,new v.default("18443055278223355904"))),(t&8)!=0&&(n=he(n,new v.default("18439367220385607680"))),(t&16)!=0&&(n=he(n,new v.default("18431993317065453568"))),(t&32)!=0&&(n=he(n,new v.default("18417254355718170624"))),(t&64)!=0&&(n=he(n,new v.default("18387811781193609216"))),(t&128)!=0&&(n=he(n,new v.default("18329067761203558400"))),(t&256)!=0&&(n=he(n,new v.default("18212142134806163456"))),(t&512)!=0&&(n=he(n,new v.default("17980523815641700352"))),(t&1024)!=0&&(n=he(n,new v.default("17526086738831433728"))),(t&2048)!=0&&(n=he(n,new v.default("16651378430235570176"))),(t&4096)!=0&&(n=he(n,new v.default("15030750278694412288"))),(t&8192)!=0&&(n=he(n,new v.default("12247334978884435968"))),(t&16384)!=0&&(n=he(n,new v.default("8131365268886854656"))),(t&32768)!=0&&(n=he(n,new v.default("3584323654725218816"))),(t&65536)!=0&&(n=he(n,new v.default("696457651848324352"))),(t&131072)!=0&&(n=he(n,new v.default("26294789957507116"))),(t&262144)!=0&&(n=he(n,new v.default("37481735321082"))),e>0&&(n=Zn.div(n)),n}static getTickFromPrice(e,t,n){return F.getTickFromSqrtPriceX64(F.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(tt)||e.lt(et))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new v.default(t-64),i=as(n,32,128),o=new v.default("8000000000000000","hex"),s=0,a=new v.default(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new v.default(0))&&s<Qn;){u=u.mul(u);let b=u.shrn(127);u=u.shrn(63+b.toNumber()),a=a.add(o.mul(b)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=i.add(c).mul(new v.default($n)),d=br(m.sub(new v.default(Jn)),64,128).toNumber(),p=br(m.add(new v.default(er)),64,128).toNumber();return d==p?d:F.getSqrtPriceX64FromTick(p).lte(e)?p:d}},dt=class{static getTickWithPriceAndTickspacing(e,t,n,i){let s=F.getTickFromSqrtPriceX64(F.priceToSqrtPriceX64(e,n,i))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,i){let o=dt.getTickWithPriceAndTickspacing(e,t,n,i),s=F.getSqrtPriceX64FromTick(o);return F.sqrtPriceX64ToPrice(s,n,i)}},G=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(z))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(It),s=t.sub(e);return i?M.mulDivRoundingUp(M.mulDivCeil(o,s,t),Le,e):M.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(z))throw new Error("sqrtPriceX64A must greater than 0");return i?M.mulDivCeil(n,t.sub(e),Fe):M.mulDivFloor(n,t.sub(e),Fe)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return i?M.mulDivRoundingUp(a,Le,bn):a.shrn(It)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),M.mulDivFloor(n,bn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return G.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){let s=G.getLiquidityFromTokenAmountA(e,n,i,!1),a=G.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return G.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:G.getTokenAmountAFromLiquidity(t,n,i,o),amountB:new v.default(0)};if(e.lt(n)){let s=G.getTokenAmountAFromLiquidity(e,n,i,o),a=G.getTokenAmountBFromLiquidity(t,e,i,o);return{amountA:s,amountB:a}}else return{amountA:new v.default(0),amountB:G.getTokenAmountBFromLiquidity(t,n,i,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,o,s,a){let{amountA:u,amountB:c}=G.getAmountsFromLiquidity(e,t,n,i,s),l=o?1+a:1-a,m=new v.default(new I(u.toString()).mul(l).toFixed(0)),d=new v.default(new I(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var A,w,P,h;let c=F.priceToSqrtPriceX64(new I(e.price),e.mintA.decimals,e.mintB.decimals),l=F.getSqrtPriceX64FromTick(t),m=F.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,p=G.getAmountsFromLiquidity(c,l,m,i,s),[b,f]=[ye(p.amountA,(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,u),ye(p.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,a,u)],[g,y]=[ye(new v.default(new I(p.amountA.toString()).mul(d).toFixed(0)),(P=e.mintA.extensions)==null?void 0:P.feeConfig,a,u),ye(new v.default(new I(p.amountB.toString()).mul(d).toFixed(0)),(h=e.mintB.extensions)==null?void 0:h.feeConfig,a,u)];return{liquidity:i,amountA:b,amountB:f,amountSlippageA:g,amountSlippageB:y,expirationTime:ht(b.expirationTime,f.expirationTime)}}},pt=class{static swapCompute(e,t,n,i,o,s,a,u,c,l,m,d,p,b){if(d.eq(z))throw new Error("amountSpecified must not be 0");if(b||(b=s?et.add(Le):tt.sub(Le)),s){if(b.lt(et))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(b.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(b.gt(tt))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(b.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let f=d.gt(z),g={amountSpecifiedRemaining:d,amountCalculated:z,sqrtPriceX64:m,tick:c>p?Math.min(p+U.tickCount(l)-1,c):p,accounts:[],liquidity:u,feeAmount:new v.default(0)},y=p,A=n[p],w=0,P=!s&&A.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(z)&&!g.sqrtPriceX64.eq(b);){if(w>10)throw Error("liquidity limit");let h={};h.sqrtPriceStartX64=g.sqrtPriceX64;let x=S.nextInitTick(A,g.tick,l,s,P),B=x||null,N=null;if(!(B!=null&&B.liquidityGross.gtn(0))){let q=we.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:l,tickArrayBitmap:i,exBitmapInfo:o},y,s);if(!q.isExist)throw Error("swapCompute LiquidityInsufficient");y=q.nextStartIndex;let{publicKey:_}=Z(e,t,y);N=_,A=n[y],B=S.firstInitializedTick(A,s)}h.tickNext=B.tick,h.initialized=B.liquidityGross.gtn(0),p!==y&&N&&(g.accounts.push(N),p=y),h.tickNext<Te?h.tickNext=Te:h.tickNext>Se&&(h.tickNext=Se),h.sqrtPriceNextX64=F.getSqrtPriceX64FromTick(h.tickNext);let D;if(s&&h.sqrtPriceNextX64.lt(b)||!s&&h.sqrtPriceNextX64.gt(b)?D=b:D=h.sqrtPriceNextX64,[g.sqrtPriceX64,h.amountIn,h.amountOut,h.feeAmount]=pt.swapStepCompute(g.sqrtPriceX64,D,g.liquidity,g.amountSpecifiedRemaining,a),g.feeAmount=g.feeAmount.add(h.feeAmount),f?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(h.amountIn.add(h.feeAmount)),g.amountCalculated=g.amountCalculated.sub(h.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(h.amountOut),g.amountCalculated=g.amountCalculated.add(h.amountIn.add(h.feeAmount))),g.sqrtPriceX64.eq(h.sqrtPriceNextX64)){if(h.initialized){let q=B.liquidityNet;s&&(q=q.mul(Ye)),g.liquidity=G.addDelta(g.liquidity,q)}P=h.tickNext!=g.tick&&!s&&A.startTickIndex===h.tickNext,g.tick=s?h.tickNext-1:h.tickNext}else if(g.sqrtPriceX64!=h.sqrtPriceStartX64){let q=F.getTickFromSqrtPriceX64(g.sqrtPriceX64);P=q!=g.tick&&!s&&A.startTickIndex===q,g.tick=q}++w}try{let{nextStartIndex:h,isExist:x}=U.nextInitializedTickArray(g.tick,l,s,i,o);x&&p!==h&&(g.accounts.push(Z(e,t,h).publicKey),p=h)}catch{}return{amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,i,o){let s={sqrtPriceX64Next:new v.default(0),amountIn:new v.default(0),amountOut:new v.default(0),feeAmount:new v.default(0)},a=e.gte(t),u=i.gte(z);if(u){let l=M.mulDivFloor(i,Ht.sub(new v.default(o.toString())),Ht);s.amountIn=a?G.getTokenAmountAFromLiquidity(t,e,n,!0):G.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=F.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?G.getTokenAmountBFromLiquidity(t,e,n,!1):G.getTokenAmountAFromLiquidity(e,t,n,!1),i.mul(Ye).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=F.getNextSqrtPriceX64FromOutput(e,n,i.mul(Ye),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=G.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=G.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:G.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:G.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(i.mul(Ye))&&(s.amountOut=i.mul(Ye)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=i.sub(s.amountIn):s.feeAmount=M.mulDivCeil(s.amountIn,new v.default(o),Ht.sub(new v.default(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var Y=require("@solana/spl-token"),k=require("@solana/web3.js"),Ar=oe(require("bn.js"));var Bn=require("@solana/web3.js"),Ni=require("@solana/spl-token"),ps=oe(require("bn.js"));var us=ee([ne("mint"),ne("owner"),O("amount"),rt("delegateOption"),ne("delegate"),ce("state"),rt("isNativeOption"),O("isNative"),O("delegatedAmount"),rt("closeAuthorityOption"),ne("closeAuthority")]);function cs(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function gr(r,...e){if(!cs(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function yr(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Bi(r,e){gr(r);let t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var kn=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Ue=(r,e)=>r<<32-e|r>>>e;var Kl=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ls(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function wr(r){return typeof r=="string"&&(r=ls(r)),gr(r),r}var Tn=class{clone(){return this._cloneInto()}},Nl={}.toString;function Ii(r){let e=n=>r().update(wr(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function ms(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let i=BigInt(32),o=BigInt(4294967295),s=Number(t>>i&o),a=Number(t&o),u=n?4:0,c=n?0:4;r.setUint32(e+u,s,n),r.setUint32(e+c,a,n)}var Si=(r,e,t)=>r&e^~r&t,Ci=(r,e,t)=>r&e^r&t^e&t,xn=class extends Tn{constructor(e,t,n,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=kn(this.buffer)}update(e){yr(this);let{view:t,buffer:n,blockLen:i}=this;e=wr(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(i-this.pos,o-s);if(a===i){let u=kn(e);for(;i<=o-s;s+=i)this.process(u,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){yr(this),Bi(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:i,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(n,0),s=0);for(let m=s;m<i;m++)t[m]=0;ms(n,i-8,BigInt(this.length*8),o),this.process(n,0);let a=kn(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let c=u/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<c;m++)a.setUint32(4*m,l[m],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:i,finished:o,destroyed:s,pos:a}=this;return e.length=i,e.pos=a,e.finished=o,e.destroyed=s,i%t&&e.buffer.set(n),e}};var ds=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ft=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),bt=new Uint32Array(64),hr=class extends xn{constructor(){super(64,32,8,!1),this.A=ft[0]|0,this.B=ft[1]|0,this.C=ft[2]|0,this.D=ft[3]|0,this.E=ft[4]|0,this.F=ft[5]|0,this.G=ft[6]|0,this.H=ft[7]|0}get(){let{A:e,B:t,C:n,D:i,E:o,F:s,G:a,H:u}=this;return[e,t,n,i,o,s,a,u]}set(e,t,n,i,o,s,a,u){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,t){for(let m=0;m<16;m++,t+=4)bt[m]=e.getUint32(t,!1);for(let m=16;m<64;m++){let d=bt[m-15],p=bt[m-2],b=Ue(d,7)^Ue(d,18)^d>>>3,f=Ue(p,17)^Ue(p,19)^p>>>10;bt[m]=f+bt[m-7]+b+bt[m-16]|0}let{A:n,B:i,C:o,D:s,E:a,F:u,G:c,H:l}=this;for(let m=0;m<64;m++){let d=Ue(a,6)^Ue(a,11)^Ue(a,25),p=l+d+Si(a,u,c)+ds[m]+bt[m]|0,f=(Ue(n,2)^Ue(n,13)^Ue(n,22))+Ci(n,i,o)|0;l=c,c=u,u=a,a=s+p|0,s=o,o=i,i=n,n=p+f|0}n=n+this.A|0,i=i+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,i,o,s,a,u,c,l)}roundClean(){bt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Ki=Ii(()=>new hr);var Ul=fe("Raydium_Util");function Ri({fromPublicKey:r,programId:e=Ni.TOKEN_PROGRAM_ID}){let t=Bn.Keypair.generate().publicKey.toBase58().slice(0,32);return{publicKey:fs(r,t,e),seed:t}}function fs(r,e,t){let n=Buffer.concat([r.toBuffer(),Buffer.from(e),t.toBuffer()]),i=Ki(n);return new Bn.PublicKey(i)}var Li=fe("Raydium_Clmm"),Xe={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},be=class{static createPoolInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b){let f=ee([W("sqrtPriceX64"),O("startTime")]),g=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:k.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:vt,isSigner:!1,isWritable:!1}],y=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,startTime:b},y);let A=Buffer.from([...Xe.createPool,...y]);return new k.TransactionInstruction({keys:g,programId:e,data:A})}static async createPoolInstructions(e){let{connection:t,programId:n,owner:i,mintA:o,mintB:s,ammConfigId:a,initialPriceX64:u,startTime:c,forerunCreate:l}=e,m=Ri({fromPublicKey:i,programId:n}),[d,p]=[new k.PublicKey(o.address),new k.PublicKey(s.address)],b=[k.SystemProgram.createAccountWithSeed({fromPubkey:i,basePubkey:i,seed:m.seed,newAccountPubkey:m.publicKey,lamports:l?0:await t.getMinimumBalanceForRentExemption(Pn.span),space:Pn.span,programId:n})],{publicKey:f}=sr(n,a,d,p),{publicKey:g}=wn(n,f,d),{publicKey:y}=wn(n,f,p);return b.push(this.createPoolInstruction(n,f,i,a,m.publicKey,d,g,new k.PublicKey(o.programId||Y.TOKEN_PROGRAM_ID),p,y,new k.PublicKey(s.programId||Y.TOKEN_PROGRAM_ID),nt(n,f).publicKey,u,c)),{signers:[],instructions:b,instructionTypes:[me.CreateAccount,me.ClmmCreatePool],address:{poolId:f,observationId:m.publicKey,mintAVault:g,mintBVault:y},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f,g,y,A,w,P,h,x,B,N,D,q){let _=ee([ke("tickLowerIndex"),ke("tickUpperIndex"),ke("tickArrayLowerStartIndex"),ke("tickArrayUpperStartIndex"),W("liquidity"),O("amountMaxA"),O("amountMaxB"),je("withMetadata"),ce("optionBaseFlag"),je("baseFlag")]),ge=[...q?[{pubkey:q,isSigner:!1,isWritable:!0}]:[]],le=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:vt,isSigner:!1,isWritable:!1},{pubkey:k.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:Y.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Y.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Tt,isSigner:!1,isWritable:!1},{pubkey:Y.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...ge],Ne=Buffer.alloc(_.span);_.encode({tickLowerIndex:A,tickUpperIndex:w,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:h,liquidity:x,amountMaxA:B,amountMaxB:N,withMetadata:D==="create",baseFlag:!1,optionBaseFlag:0},Ne);let re=Buffer.from([...Xe.openPosition,...Ne]);return new k.TransactionInstruction({keys:le,programId:e,data:re})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new k.PublicKey(e.programId),new k.PublicKey(e.id)],b;if(l)b=new k.PublicKey((await l(1))[0]);else{let N=k.Keypair.generate();m.push(N),b=N.publicKey}let f=S.getTickArrayStartIndexByTick(i,e.config.tickSpacing),g=S.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:y}=Z(d,p,f),{publicKey:A}=Z(d,p,g),{publicKey:w}=Ve(n.wallet,b,Y.TOKEN_PROGRAM_ID),{publicKey:P}=jt(b),{publicKey:h}=We(d,b),{publicKey:x}=lt(d,p,i,o),B=this.openPositionFromLiquidityInstruction(d,n.feePayer,p,n.wallet,b,w,P,x,y,A,h,n.tokenAccountA,n.tokenAccountB,new k.PublicKey(t.vault.A),new k.PublicKey(t.vault.B),new k.PublicKey(e.mintA.address),new k.PublicKey(e.mintB.address),i,o,f,g,s,a,u,c);return{signers:m,instructions:[B],instructionTypes:[me.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:b,tickArrayLower:y,tickArrayUpper:A,positionNftAccount:w,metadataAccount:P,personalPosition:h,protocolPosition:x}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new k.PublicKey(e.programId),new k.PublicKey(e.id)],b;if(l)b=new k.PublicKey((await l(1))[0]);else{let N=k.Keypair.generate();m.push(N),b=N.publicKey}let f=S.getTickArrayStartIndexByTick(i,e.config.tickSpacing),g=S.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:y}=Z(d,p,f),{publicKey:A}=Z(d,p,g),{publicKey:w}=Ve(n.wallet,b,Y.TOKEN_PROGRAM_ID),{publicKey:P}=jt(b),{publicKey:h}=We(d,b),{publicKey:x}=lt(d,p,i,o),B=this.openPositionFromBaseInstruction(d,n.feePayer,p,n.wallet,b,w,P,x,y,A,h,n.tokenAccountA,n.tokenAccountB,new k.PublicKey(t.vault.A),new k.PublicKey(t.vault.B),new k.PublicKey(e.mintA.address),new k.PublicKey(e.mintB.address),i,o,f,g,c,s,a,u,we.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,g])?nt(d,p).publicKey:void 0);return{address:{nftMint:b,tickArrayLower:y,tickArrayUpper:A,positionNftAccount:w,metadataAccount:P,personalPosition:h,protocolPosition:x},instructions:[B],signers:m,instructionTypes:[me.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f,g,y,A,w,P,h,x,B,N,D,q){let _=ee([ke("tickLowerIndex"),ke("tickUpperIndex"),ke("tickArrayLowerStartIndex"),ke("tickArrayUpperStartIndex"),W("liquidity"),O("amountMaxA"),O("amountMaxB"),je("withMetadata"),ce("optionBaseFlag"),je("baseFlag")]),ge=[...q?[{pubkey:q,isSigner:!1,isWritable:!0}]:[]],le=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:vt,isSigner:!1,isWritable:!1},{pubkey:k.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:Y.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Y.ASSOCIATED_TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Tt,isSigner:!1,isWritable:!1},{pubkey:Y.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...ge],Ne=Buffer.alloc(_.span);_.encode({tickLowerIndex:A,tickUpperIndex:w,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:h,liquidity:new Ar.default(0),amountMaxA:B==="MintA"?N:D,amountMaxB:B==="MintA"?D:N,withMetadata:x==="create",baseFlag:B==="MintA",optionBaseFlag:1},Ne);let re=Buffer.from([...Xe.openPosition,...Ne]);return new k.TransactionInstruction({keys:le,programId:e,data:re})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,d=[];if(l)m=new k.PublicKey((await l(1))[0]);else{let N=k.Keypair.generate();d.push(N),m=N.publicKey}let[p,b]=[new k.PublicKey(e.programId),new k.PublicKey(e.id)],f=S.getTickArrayStartIndexByTick(i,e.config.tickSpacing),g=S.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:y}=Z(p,b,f),{publicKey:A}=Z(p,b,g),{publicKey:w}=Ve(n.wallet,m,Y.TOKEN_PROGRAM_ID),{publicKey:P}=jt(m),{publicKey:h}=We(p,m),{publicKey:x}=lt(p,b,i,o),B=this.openPositionFromLiquidityInstruction(p,n.wallet,b,n.wallet,m,w,P,x,y,A,h,n.tokenAccountA,n.tokenAccountB,new k.PublicKey(t.vault.A),new k.PublicKey(t.vault.B),new k.PublicKey(t.mintA.address),new k.PublicKey(t.mintB.address),i,o,f,g,s,a,u,c,we.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,g])?nt(p,b).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:y,tickArrayUpper:A,positionNftAccount:w,metadataAccount:P,personalPosition:h,protocolPosition:x},instructions:[B],signers:d,instructionTypes:[me.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,i,o){let s=ee([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:k.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:Y.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...Xe.closePosition,...u]);return new k.TransactionInstruction({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:i}){let o=new k.PublicKey(e.programId),{publicKey:s}=Ve(n.wallet,i.nftMint,Y.TOKEN_PROGRAM_ID),{publicKey:a}=We(o,i.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,i.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[me.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f,g,y,A){let w=ee([W("liquidity"),O("amountMaxA"),O("amountMaxB"),ce("optionBaseFlag"),je("baseFlag")]),P=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:Y.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Y.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...P],x=Buffer.alloc(w.span);w.encode({liquidity:f,amountMaxA:g,amountMaxB:y,optionBaseFlag:0,baseFlag:!1},x);let B=Buffer.from([...Xe.increaseLiquidity,...x]);return new k.TransactionInstruction({keys:h,programId:e,data:B})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new k.PublicKey(e.programId),new k.PublicKey(e.id)],l=S.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=S.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=Z(u,c,l),{publicKey:p}=Z(u,c,m),{publicKey:b}=Ve(i.wallet,n.nftMint,Y.TOKEN_PROGRAM_ID),{publicKey:f}=We(u,n.nftMint),{publicKey:g}=lt(u,c,n.tickLower,n.tickUpper),y=this.increasePositionFromLiquidityInstruction(u,i.wallet,b,f,c,g,d,p,i.tokenAccountA,i.tokenAccountB,new k.PublicKey(t.vault.A),new k.PublicKey(t.vault.B),new k.PublicKey(e.mintA.address),new k.PublicKey(e.mintB.address),o,s,a,we.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?nt(u,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:b,personalPosition:f,protocolPosition:g},signers:[],instructions:[y],instructionTypes:[me.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new k.PublicKey(e.programId),new k.PublicKey(e.id)],l=S.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=S.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=Z(u,c,l),{publicKey:p}=Z(u,c,m),{publicKey:b}=Ve(i.wallet,n.nftMint,Y.TOKEN_PROGRAM_ID),{publicKey:f}=We(u,n.nftMint),{publicKey:g}=lt(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:b,personalPosition:f,protocolPosition:g},instructions:[this.increasePositionFromBaseInstruction(u,i.wallet,b,f,c,g,d,p,i.tokenAccountA,i.tokenAccountB,new k.PublicKey(t.vault.A),new k.PublicKey(t.vault.B),new k.PublicKey(e.mintA.address),new k.PublicKey(e.mintB.address),o,s,a,we.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?nt(u,c).publicKey:void 0)],signers:[],instructionTypes:[me.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f,g,y,A){let w=ee([W("liquidity"),O("amountMaxA"),O("amountMaxB"),ce("optionBaseFlag"),je("baseFlag")]),P=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:Y.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Y.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...P],x=Buffer.alloc(w.span);w.encode({liquidity:new Ar.default(0),amountMaxA:f==="MintA"?g:y,amountMaxB:f==="MintA"?y:g,baseFlag:f==="MintA",optionBaseFlag:1},x);let B=Buffer.from([...Xe.increaseLiquidity,...x]);return new k.TransactionInstruction({keys:h,programId:e,data:B})}static decreaseLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f,g,y,A,w){let P=ee([W("liquidity"),O("amountMinA"),O("amountMinB")]),h=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...f.map(D=>[{pubkey:D.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:D.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:D.rewardMint,isSigner:!1,isWritable:!1}]).flat()],x=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:Y.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Y.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:an,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...h],B=Buffer.alloc(P.span);P.encode({liquidity:g,amountMinA:y,amountMinB:A},B);let N=Buffer.from([...Xe.decreaseLiquidity,...B]);return new k.TransactionInstruction({keys:x,programId:e,data:N})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new k.PublicKey(e.programId),new k.PublicKey(e.id)],m=S.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=S.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=Z(c,l,m),{publicKey:b}=Z(c,l,d),{publicKey:f}=Ve(i.wallet,n.nftMint,u),{publicKey:g}=We(c,n.nftMint),{publicKey:y}=lt(c,l,n.tickLower,n.tickUpper),A=[];for(let P=0;P<e.rewardDefaultInfos.length;P++)A.push({poolRewardVault:new k.PublicKey(t.rewardInfos[P].vault),ownerRewardVault:i.rewardAccounts[P],rewardMint:new k.PublicKey(e.rewardDefaultInfos[P].mint.address)});let w=[];return w.push(this.decreaseLiquidityInstruction(c,i.wallet,f,g,l,y,p,b,i.tokenAccountA,i.tokenAccountB,new k.PublicKey(t.vault.A),new k.PublicKey(t.vault.B),new k.PublicKey(e.mintA.address),new k.PublicKey(e.mintB.address),A,o,s,a,we.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?nt(c,l).publicKey:void 0)),{address:{tickArrayLower:p,tickArrayUpper:b,positionNftAccount:f,personalPosition:g,protocolPosition:y},signers:[],instructions:w,instructionTypes:[me.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f,g,y){let A=ee([O("amount"),O("otherAmountThreshold"),W("sqrtPriceLimitX64"),je("isBaseInput")]),w=[...y?[{pubkey:y,isSigner:!1,isWritable:!0}]:[],...m.map(B=>({pubkey:B,isSigner:!1,isWritable:!0}))],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:Y.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Y.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:an,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...w],h=Buffer.alloc(A.span);A.encode({amount:p,otherAmountThreshold:b,sqrtPriceLimitX64:f,isBaseInput:g},h);let x=Buffer.from([...Xe.swap,...h]);return new k.TransactionInstruction({keys:P,programId:e,data:x})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,inputMint:i,amountIn:o,amountOutMin:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new k.PublicKey(e.programId),new k.PublicKey(e.id)],[m,d]=[new k.PublicKey(t.vault.A),new k.PublicKey(t.vault.B)],[p,b]=[new k.PublicKey(e.mintA.address),new k.PublicKey(e.mintB.address)],f=e.mintA.address===i.toString(),g=[this.swapInstruction(c,n.wallet,l,new k.PublicKey(e.config.id),f?n.tokenAccountA:n.tokenAccountB,f?n.tokenAccountB:n.tokenAccountA,f?m:d,f?d:m,f?p:b,f?b:p,u,m,o,s,a,!0,nt(c,l).publicKey)];return{signers:[],instructions:g,instructionTypes:[me.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,i,o,s,a,u,c,l,m,d){let p=ee([O("openTime"),O("endTime"),W("emissionsPerSecondX64")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:k.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:vt,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:Pe(l),endTime:Pe(m),emissionsPerSecondX64:d},f);let g=Buffer.from([...Xe.initReward,...f]);return new k.TransactionInstruction({keys:b,programId:e,data:g})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new k.PublicKey(e.programId),new k.PublicKey(e.id)],a=ar(o,s,i.mint).publicKey,u=Ct(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new k.PublicKey(e.config.id),n.tokenAccount,i.programId,i.mint,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[me.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,i,o,s,a,u,c,l,m,d){let p=ee([ce("rewardIndex"),W("emissionsPerSecondX64"),O("openTime"),O("endTime")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:Y.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Y.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:Pe(l),endTime:Pe(m)},f);let g=Buffer.from([...Xe.setRewardEmissions,...f]);return new k.TransactionInstruction({keys:b,programId:e,data:g})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new k.PublicKey(e.programId),new k.PublicKey(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===i.mint.toString()&&(a=d,u=new k.PublicKey(t.rewardInfos[d].vault),c=new k.PublicKey(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&Li.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=Ct(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new k.PublicKey(e.config.id),n.tokenAccount,u,c,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[me.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,i,o,s,a){let u=ee([ce("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:Y.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:Y.TOKEN_2022_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:an,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...Xe.collectReward,...l]);return new k.TransactionInstruction({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:i}){let[o,s]=[new k.PublicKey(e.programId),new k.PublicKey(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===i.toString()&&(a=l,u=new k.PublicKey(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&Li.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,i,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[me.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapBaseOutInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,outputMint:i,amountOut:o,amountInMax:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new k.PublicKey(e.programId),new k.PublicKey(e.id)],[m,d]=[new k.PublicKey(t.vault.A),new k.PublicKey(t.vault.B)],[p,b]=[new k.PublicKey(e.mintA.address),new k.PublicKey(e.mintB.address)],f=e.mintA.address===i.toString(),g=[this.swapInstruction(c,n.wallet,l,new k.PublicKey(e.config.id),f?n.tokenAccountB:n.tokenAccountA,f?n.tokenAccountA:n.tokenAccountB,f?d:m,f?m:d,f?p:b,f?b:p,u,m,o,s,a,!1)];return{signers:[],instructions:g,instructionTypes:[me.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}};var Me=oe(require("bn.js")),In=class extends Xt{constructor(e){super(e)}async load(e){await this.scope.token.load(e)}async createPool(e){var A;let{programId:t,owner:n=((A=this.scope.owner)==null?void 0:A.publicKey)||X.PublicKey.default,mint1:i,mint2:o,ammConfig:s,initialPrice:a,startTime:u,computeBudgetConfig:c,forerunCreate:l,txVersion:m}=e,d=this.createTxBuilder(),[p,b,f]=new Me.default(new X.PublicKey(i.address).toBuffer()).gt(new Me.default(new X.PublicKey(o.address).toBuffer()))?[o,i,new I(1).div(a)]:[i,o,a],g=F.priceToSqrtPriceX64(f,p.decimals,b.decimals),y=await be.createPoolInstructions({connection:this.scope.connection,programId:t,owner:n,mintA:p,mintB:b,ammConfigId:s.id,initialPriceX64:g,startTime:u,forerunCreate:l});return d.addInstruction(y),d.addCustomComputeBudget(c),d.versionBuild({txVersion:m,extInfo:{address:ie(V({},y.address),{programId:t.toString(),id:y.address.poolId.toString(),mintA:p,mintB:b,openTime:u.toNumber(),vault:{A:y.address.mintAVault.toString(),B:y.address.mintBVault.toString()},rewardInfos:[],config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}}),mockPoolInfo:V({type:"Concentrated",rewardDefaultPoolInfos:"Clmm",id:y.address.poolId.toString(),mintA:p,mintB:b,feeRate:s.tradeFeeRate,openTime:u.toNumber(),programId:t.toString(),price:f.toNumber(),config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}},tr),forerunCreate:l}})}async openPositionFromBase({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,associatedOnly:c=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",getEphemeralSigners:d,computeBudgetConfig:p,txVersion:b}){this.scope.availability.addConcentratedPosition===!1&&this.logAndCreateError("add position feature disabled in your region"),this.scope.checkOwner();let f=this.createTxBuilder(),g=null,y=null,A=n.useSOLBalance&&e.mintA.address===te.toString(),w=n.useSOLBalance&&e.mintB.address===te.toString(),[P,h]=s==="MintA"?[a,u]:[u,a],{account:x,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new X.PublicKey(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:A||P.isZero()?{payer:this.scope.ownerPubKey,amount:P}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:c,checkCreateATAOwner:l});x&&(g=x),f.addInstruction(B||{});let{account:N,instructionParams:D}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new X.PublicKey(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:w||h.isZero()?{payer:this.scope.ownerPubKey,amount:h}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:c,checkCreateATAOwner:l});N&&(y=N),f.addInstruction(D||{}),(!g||!y)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let q=t||await this.scope.api.fetchPoolKeysById({id:e.id}),_=await be.openPositionFromBaseInstructions({poolInfo:e,poolKeys:q,ownerInfo:ie(V({},n),{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:g,tokenAccountB:y}),tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:m,getEphemeralSigners:d});return f.addInstruction(_),f.addCustomComputeBudget(p),f.versionBuild({txVersion:b,extInfo:_.address})}async openPositionFromLiquidity({poolInfo:e,poolKeys:t,ownerInfo:n,amountMaxA:i,amountMaxB:o,tickLower:s,tickUpper:a,liquidity:u,associatedOnly:c=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",txVersion:d,getEphemeralSigners:p}){this.scope.availability.createConcentratedPosition===!1&&this.logAndCreateError("open position feature disabled in your region");let b=this.createTxBuilder(),f=null,g=null,y=n.useSOLBalance&&e.mintA.address===te.toBase58(),A=n.useSOLBalance&&e.mintB.address===te.toBase58(),{account:w,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new X.PublicKey(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:y?{payer:this.scope.ownerPubKey,amount:i}:void 0,skipCloseAccount:!y,notUseTokenAccount:y,associatedOnly:y?!1:c,checkCreateATAOwner:l});w&&(f=w),b.addInstruction(P||{});let{account:h,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new X.PublicKey(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:A?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:c,checkCreateATAOwner:l});h&&(g=h),b.addInstruction(x||{}),(f===void 0||g===void 0)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let B=t||await this.scope.api.fetchPoolKeysById({id:e.id}),N=await be.openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:B,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:g},tickLower:s,tickUpper:a,liquidity:u,amountMaxA:i,amountMaxB:o,withMetadata:m,getEphemeralSigners:p});return b.addInstruction(N),b.versionBuild({txVersion:d,extInfo:{address:N.address}})}async increasePositionFromLiquidity(e){let{poolInfo:t,ownerPosition:n,amountMaxA:i,amountMaxB:o,liquidity:s,ownerInfo:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:l,txVersion:m}=e,d=this.createTxBuilder(),p,b,f=a.useSOLBalance&&t.mintA.address===te.toString(),g=a.useSOLBalance&&t.mintB.address===te.toString(),{account:y,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new X.PublicKey(t.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:f?{payer:this.scope.ownerPubKey,amount:i}:void 0,skipCloseAccount:!f,associatedOnly:f?!1:u,checkCreateATAOwner:c});y&&(p=y),d.addInstruction(A||{});let{account:w,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({mint:new X.PublicKey(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:g?{payer:this.scope.ownerPubKey,amount:o}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:u,checkCreateATAOwner:c});w&&(b=w),d.addInstruction(P||{}),!p&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let h=await this.scope.api.fetchPoolKeysById({id:t.id}),x=be.increasePositionFromLiquidityInstructions({poolInfo:t,poolKeys:h,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:b},liquidity:s,amountMaxA:i,amountMaxB:o});return d.addInstruction(x),d.addCustomComputeBudget(l),d.versionBuild({txVersion:m,extInfo:{address:x.address}})}async increasePositionFromBase(e){let{poolInfo:t,ownerPosition:n,base:i,baseAmount:o,otherAmountMax:s,ownerInfo:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:l,txVersion:m}=e,d=this.createTxBuilder(),p,b,f=a.useSOLBalance&&t.mintA.address===te.toString(),g=a.useSOLBalance&&t.mintB.address===te.toString(),{account:y,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new X.PublicKey(t.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:f?{payer:this.scope.ownerPubKey,amount:i==="MintA"?o:s}:void 0,skipCloseAccount:!f,associatedOnly:f?!1:u,checkCreateATAOwner:c});y&&(p=y),d.addInstruction(A||{});let{account:w,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({mint:new X.PublicKey(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:g?{payer:this.scope.ownerPubKey,amount:i==="MintA"?s:o}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:u,checkCreateATAOwner:c});w&&(b=w),d.addInstruction(P||{}),!p&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let h=await this.scope.api.fetchPoolKeysById({id:t.id}),x=be.increasePositionFromBaseInstructions({poolInfo:t,poolKeys:h,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:b},base:i,baseAmount:o,otherAmountMax:s});return d.addInstruction(x),d.addCustomComputeBudget(l),d.versionBuild({txVersion:m,extInfo:{address:x.address}})}async decreaseLiquidity(e){let{poolInfo:t,ownerPosition:n,ownerInfo:i,amountMinA:o,amountMinB:s,liquidity:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:l,txVersion:m}=e;this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let d=this.createTxBuilder(),p=i.useSOLBalance&&t.mintA.address===te.toString(),b=i.useSOLBalance&&t.mintB.address===te.toString(),f,g,{account:y,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new X.PublicKey(t.mintA.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!p,associatedOnly:p?!1:u,checkCreateATAOwner:c});f=y,A&&d.addInstruction(A);let{account:w,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new X.PublicKey(t.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!b,associatedOnly:b?!1:u,checkCreateATAOwner:c});g=w,P&&d.addInstruction(P);let h=[];for(let D of t.rewardDefaultInfos){let q=i.useSOLBalance&&D.mint.address===te.toString(),_;if(D.mint.address===t.mintA.address)_=f;else if(D.mint.address===t.mintB.address)_=g;else{let{account:ge,instructionParams:le}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X.PublicKey(D.mint.programId),mint:new X.PublicKey(D.mint.address),notUseTokenAccount:q,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!q,associatedOnly:q?!1:u,checkCreateATAOwner:c});_=ge,le&&d.addInstruction(le)}h.push(_)}!f&&!g&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccountRawInfos);let x=await this.scope.api.fetchPoolKeysById({id:t.id}),B=await be.decreaseLiquidityInstructions({poolInfo:t,poolKeys:x,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:g,rewardAccounts:h},liquidity:a,amountMinA:o,amountMinB:s});d.addInstruction({instructions:B.instructions,instructionTypes:[me.ClmmDecreasePosition]});let N=V({},B.address);if(i.closePosition){let D=await be.closePositionInstructions({poolInfo:t,poolKeys:x,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:n});d.addInstruction({endInstructions:D.instructions,endInstructionTypes:D.instructionTypes}),N=V(V({},N),D.address)}return d.addCustomComputeBudget(l),d.versionBuild({txVersion:m,extInfo:{address:N}})}async closePosition({poolInfo:e,ownerPosition:t,txVersion:n}){this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let i=this.createTxBuilder(),o=await this.scope.api.fetchPoolKeysById({id:e.id}),s=be.closePositionInstructions({poolInfo:e,poolKeys:o,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:t});return i.addInstruction(s).versionBuild({txVersion:n,extInfo:{address:s.address}})}async initReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let u=this.createTxBuilder(),c=t.useSOLBalance&&n.mint.address.toString()===te.toString(),l=n.perSecond.mul(n.endTime-n.openTime),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X.PublicKey(n.mint.address),mint:new X.PublicKey(n.mint.address),notUseTokenAccount:!!c,skipCloseAccount:!c,owner:this.scope.ownerPubKey,createInfo:c?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Me.default(new I(l.toFixed(0)).gte(l)?l.toFixed(0):l.add(1).toFixed(0))}:void 0,associatedOnly:c?!1:i,checkCreateATAOwner:o});d&&u.addInstruction(d),m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let p=await this.scope.api.fetchPoolKeysById({id:e.id}),b=be.initRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardInfo:{programId:new X.PublicKey(n.mint.programId),mint:new X.PublicKey(n.mint.address),openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:M.decimalToX64(n.perSecond)}});return u.addInstruction(b),u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:b.address}})}async initRewards({poolInfo:e,ownerInfo:t,rewardInfos:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){for(let l of n)l.endTime<=l.openTime&&this.logAndCreateError("reward time error","rewardInfo",l);let u=this.createTxBuilder(),c={};for(let l of n){let m=t.useSOLBalance&&l.mint.address===te.toString(),d=l.perSecond.mul(l.endTime-l.openTime),{account:p,instructionParams:b}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X.PublicKey(l.mint.programId),mint:new X.PublicKey(l.mint.address),notUseTokenAccount:!!m,skipCloseAccount:!m,owner:this.scope.ownerPubKey,createInfo:m?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Me.default(new I(d.toFixed(0)).gte(d)?d.toFixed(0):d.add(1).toFixed(0))}:void 0,associatedOnly:m?!1:i,checkCreateATAOwner:o});b&&u.addInstruction(b),p||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let f=await this.scope.api.fetchPoolKeysById({id:e.id}),g=be.initRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:p},rewardInfo:{programId:new X.PublicKey(l.mint.programId),mint:new X.PublicKey(l.mint.address),openTime:l.openTime,endTime:l.endTime,emissionsPerSecondX64:M.decimalToX64(l.perSecond)}});c=V(V({},c),g.address),u.addInstruction(g)}return u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:c}})}async setReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let u=this.createTxBuilder(),c=t.useSOLBalance&&n.mint.equals(te),{account:l,instructionParams:m}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.programId,mint:n.mint,notUseTokenAccount:c,owner:this.scope.ownerPubKey,createInfo:c?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Me.default(new I(n.perSecond.sub(n.endTime-n.openTime).toFixed(0)).gte(n.perSecond.sub(n.endTime-n.openTime))?n.perSecond.sub(n.endTime-n.openTime).toFixed(0):n.perSecond.sub(n.endTime-n.openTime).add(1).toFixed(0))}:void 0,associatedOnly:c?!1:i,checkCreateATAOwner:o});m&&u.addInstruction(m),l||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let d=await this.scope.api.fetchPoolKeysById({id:e.id}),p=be.setRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:l},rewardInfo:{mint:n.mint,openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:M.decimalToX64(n.perSecond)}});return u.addInstruction(p),u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:p.address}})}async setRewards({poolInfo:e,ownerInfo:t,rewardInfos:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){let u=this.createTxBuilder(),c={};for(let l of n){l.endTime<=l.openTime&&this.logAndCreateError("reward time error","rewardInfo",l);let m=t.useSOLBalance&&l.mint.address===te.toString(),{account:d,instructionParams:p}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X.PublicKey(l.mint.programId),mint:new X.PublicKey(l.mint.address),notUseTokenAccount:m,owner:this.scope.ownerPubKey,createInfo:m?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Me.default(new I(l.perSecond.sub(l.endTime-l.openTime).toFixed(0)).gte(l.perSecond.sub(l.endTime-l.openTime))?l.perSecond.sub(l.endTime-l.openTime).toFixed(0):l.perSecond.sub(l.endTime-l.openTime).add(1).toFixed(0))}:void 0,associatedOnly:m?!1:i,checkCreateATAOwner:o});p&&u.addInstruction(p),d||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let b=await this.scope.api.fetchPoolKeysById({id:e.id}),f=be.setRewardInstructions({poolInfo:e,poolKeys:b,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:d},rewardInfo:{mint:new X.PublicKey(l.mint.address),openTime:l.openTime,endTime:l.endTime,emissionsPerSecondX64:M.decimalToX64(l.perSecond)}});u.addInstruction(f),c=V(V({},c),f.address)}return u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:c}})}async collectReward({poolInfo:e,ownerInfo:t,rewardMint:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1}){let s=e.rewardDefaultInfos.find(p=>p.mint.address===n.toString());s||this.logAndCreateError("reward mint error","not found reward mint",n);let a=this.createTxBuilder(),u=t.useSOLBalance&&n.equals(te),{account:c,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X.PublicKey(s.mint.programId),mint:n,notUseTokenAccount:u,owner:this.scope.ownerPubKey,skipCloseAccount:!u,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:u?!1:i,checkCreateATAOwner:o});l&&a.addInstruction(l),c||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let m=await this.scope.api.fetchPoolKeysById({id:e.id}),d=be.collectRewardInstructions({poolInfo:e,poolKeys:m,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:c},rewardMint:n});return a.addInstruction(d),a.build({address:d.address})}async collectRewards({poolInfo:e,ownerInfo:t,rewardMints:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1}){let s=this.createTxBuilder(),a={};for(let u of n){let c=e.rewardDefaultInfos.find(f=>f.mint.address===u.toString());if(!c){this.logAndCreateError("reward mint error","not found reward mint",u);continue}let l=t.useSOLBalance&&u.equals(te),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X.PublicKey(c.mint.programId),mint:u,notUseTokenAccount:l,owner:this.scope.ownerPubKey,skipCloseAccount:!l,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:l?!1:i,checkCreateATAOwner:o});m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos),d&&s.addInstruction(d);let p=await this.scope.api.fetchPoolKeysById({id:e.id}),b=be.collectRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardMint:u});s.addInstruction(b),a=V(V({},a),b.address)}return s.build({address:a})}async harvestAllRewards({allPoolInfo:e,allPositions:t,ownerInfo:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,programId:s,txVersion:a,computeBudgetConfig:u}){let c={};for(let m of this.scope.account.tokenAccountRawInfos)i?Ve(this.scope.ownerPubKey,m.accountInfo.mint,s).publicKey.equals(m.pubkey)&&(c[m.accountInfo.mint.toString()]=m.pubkey):c[m.accountInfo.mint.toString()]=m.pubkey;let l=this.createTxBuilder();l.addCustomComputeBudget(u);for(let m of Object.values(e)){if(t[m.id]===void 0||!t[m.id].find(w=>!w.liquidity.isZero()||w.rewardInfos.find(P=>!P.rewardAmountOwed.isZero())))continue;let d=m,p=n.useSOLBalance&&d.mintA.address===te.toString(),b=n.useSOLBalance&&d.mintB.address===te.toString(),f=c[d.mintA.address];if(!f){let{account:w,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:d.mintA.programId,mint:new X.PublicKey(d.mintA.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,skipCloseAccount:!0,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:p?!1:i,checkCreateATAOwner:o});f=w,P&&l.addInstruction(P)}let g=c[d.mintB.address];if(!g){let{account:w,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:d.mintB.programId,mint:new X.PublicKey(d.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,skipCloseAccount:!0,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:b?!1:i,checkCreateATAOwner:o});g=w,P&&l.addInstruction(P)}c[d.mintA.address]=f,c[d.mintB.address]=g;let y=[];for(let w of d.rewardDefaultInfos){let P=n.useSOLBalance&&w.mint.address===te.toString(),h=c[w.mint.address];if(!h){let{account:x,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X.PublicKey(w.mint.programId),mint:new X.PublicKey(w.mint.address),notUseTokenAccount:P,owner:this.scope.ownerPubKey,skipCloseAccount:!P,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:P?!1:i});h=x,B&&l.addInstruction(B)}c[w.mint.address]=h,y.push(h)}let A=await this.scope.api.fetchPoolKeysById({id:d.id});for(let w of t[m.id]){let P=be.decreaseLiquidityInstructions({poolInfo:d,poolKeys:A,ownerPosition:w,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:g,rewardAccounts:y},liquidity:new Me.default(0),amountMinA:new Me.default(0),amountMinB:new Me.default(0)});l.addInstruction(P)}}return a===0?l.sizeCheckBuildV0():l.sizeCheckBuild()}async getWhiteListMint({programId:e}){let t=await this.scope.connection.getAccountInfo(Ct(e).publicKey);return t?dr.decode(t.data).whitelistMints.filter(i=>!i.equals(X.PublicKey.default)):[]}async computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,token2022Infos:i,amountOut:o,slippage:s,priceLimit:a=new I(0)}){var x;let u=await this.scope.fetchEpochInfo(),c;a.equals(new I(0))?c=n.toString()===e.mintB.address?et.add(Le):tt.sub(Le):c=F.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let l=Bt(o,(x=i[n.toString()])==null?void 0:x.feeConfig,u,!0),{expectedAmountIn:m,remainingAccounts:d,executionPrice:p,feeAmount:b}=we.getInputAmountAndRemainAccounts(e,t,n,l.amount.sub(l.fee||new Me.default(0)),c),f=F.sqrtPriceX64ToPrice(p,e.mintA.decimals,e.mintB.decimals),g=n.toString()===e.mintA.address?f:new I(1).div(f),y=m.mul(new Me.default(Math.floor((1+s)*1e10))).div(new Me.default(1e10)),A=e.mintA.address===n.toString()?e.price:new I(1).div(e.price),w=new I(g).sub(A).abs(),P=A,h=new Je(new I(w).mul(10**15).toFixed(0),new I(P).mul(10**15).toFixed(0));return{amountIn:m,maxAmountIn:y,currentPrice:new I(e.price),executionPrice:g,priceImpact:h,fee:b,remainingAccounts:d}}};0&&(module.exports={AMM_CONFIG_SEED,AmmConfigLayout,BIT_PRECISION,Clmm,ClmmInstrument,EXTENSION_TICKARRAY_BITMAP_SIZE,FEE_RATE_DENOMINATOR,FETCH_TICKARRAY_COUNT,Fee,LOG_B_2_X32,LOG_B_P_ERR_MARGIN_LOWER_X64,LOG_B_P_ERR_MARGIN_UPPER_X64,LiquidityMath,MAX_SQRT_PRICE_X64,MAX_TICK,MIN_SQRT_PRICE_X64,MIN_TICK,MathUtil,MaxU64,MaxUint128,NEGATIVE_ONE,ONE,OPERATION_SEED,ObservationInfoLayout,ObservationLayout,OperationLayout,POOL_REWARD_VAULT_SEED,POOL_SEED,POOL_TICK_ARRAY_BITMAP_SEED,POOL_VAULT_SEED,POSITION_SEED,PoolInfoLayout,PoolUtils,PositionInfoLayout,PositionRewardInfoLayout,PositionUtils,ProtocolPositionLayout,Q128,Q64,RewardInfo,SqrtPriceMath,SwapMath,TICK_ARRAY_BITMAP_SIZE,TICK_ARRAY_SEED,TICK_ARRAY_SIZE,TICK_SPACINGS,TickArrayBitmap,TickArrayBitmapExtensionLayout,TickArrayBitmapExtensionUtils,TickArrayLayout,TickLayout,TickMath,TickQuery,TickUtils,U64Resolution,U64_IGNORE_RANGE,ZERO,getLiquidityFromAmounts,getPdaAmmConfigId,getPdaExBitmapAccount,getPdaMetadataKey,getPdaOperationAccount,getPdaPersonalPositionAddress,getPdaPoolId,getPdaPoolRewardVaulId,getPdaPoolVaultId,getPdaProtocolPositionAddress,getPdaTickArrayAddress,i16ToBytes,i32ToBytes,isZero,leadingZeros,leastSignificantBit,mockCreatePoolInfo,mockV3CreatePoolInfo,mostSignificantBit,trailingZeros,u16ToBytes,u32ToBytes});
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=index.js.map