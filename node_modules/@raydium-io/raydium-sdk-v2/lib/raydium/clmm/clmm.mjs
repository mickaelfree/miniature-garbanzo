var mr=Object.defineProperty,fr=Object.defineProperties;var pr=Object.getOwnPropertyDescriptors;var Xt=Object.getOwnPropertySymbols;var ri=Object.prototype.hasOwnProperty,oi=Object.prototype.propertyIsEnumerable;var ii=(i,e,t)=>e in i?mr(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,q=(i,e)=>{for(var t in e||(e={}))ri.call(e,t)&&ii(i,t,e[t]);if(Xt)for(var t of Xt(e))oi.call(e,t)&&ii(i,t,e[t]);return i},ee=(i,e)=>fr(i,pr(e));var zt=(i,e)=>{var t={};for(var n in i)ri.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&Xt)for(var n of Xt(i))e.indexOf(n)<0&&oi.call(i,n)&&(t[n]=i[n]);return t};import{PublicKey as X}from"@solana/web3.js";var wt=9e15,nt=1e9,hn="0123456789abcdef",jt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Zt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",An={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-wt,maxE:wt,crypto:!1},ui,He,O=!0,Qt="[DecimalError] ",tt=Qt+"Invalid argument: ",li=Qt+"Precision limit exceeded",di=Qt+"crypto unavailable",mi="[object Decimal]",Ae=Math.floor,ue=Math.pow,gr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,br=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,yr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,fi=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Oe=1e7,C=7,wr=9007199254740991,hr=jt.length-1,Pn=Zt.length-1,k={toStringTag:mi};k.absoluteValue=k.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),N(i)};k.ceil=function(){return N(new this.constructor(this),this.e+1,2)};k.clampedTo=k.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(tt+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};k.comparedTo=k.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,c=o.s,u=i.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==i.e)return o.e>i.e^c<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return n===r?0:n>r^c<0?1:-1};k.cosine=k.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+C,n.rounding=1,t=Ar(n,wi(n,t)),n.precision=i,n.rounding=e,N(He==2||He==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};k.cubeRoot=k.cbrt=function(){var i,e,t,n,r,o,s,a,c,u,l=this,d=l.constructor;if(!l.isFinite()||l.isZero())return new d(l);for(O=!1,o=l.s*ue(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=ge(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ue(t,1/3),i=Ae((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new d(t),n.s=l.s):n=new d(o.toString()),s=(i=d.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(l),n=Z(u.plus(l).times(a),u.plus(c),s+2,1),ge(a.d).slice(0,s)===(t=ge(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(N(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(N(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return O=!0,N(n,i,d.rounding,e)};k.decimalPlaces=k.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-Ae(this.e/C))*C,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};k.dividedBy=k.div=function(i){return Z(this,new this.constructor(i))};k.dividedToIntegerBy=k.divToInt=function(i){var e=this,t=e.constructor;return N(Z(e,new t(i),0,1,1),t.precision,t.rounding)};k.equals=k.eq=function(i){return this.cmp(i)===0};k.floor=function(){return N(new this.constructor(this),this.e+1,3)};k.greaterThan=k.gt=function(i){return this.cmp(i)>0};k.greaterThanOrEqualTo=k.gte=function(i){var e=this.cmp(i);return e==1||e===0};k.hyperbolicCosine=k.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/Jt(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=ht(s,1,o.times(e),new s(1),!0);for(var c,u=i,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return N(o,s.precision=t,s.rounding=n,!0)};k.hyperbolicSine=k.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=ht(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/Jt(5,i)),r=ht(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,N(r,e,t,!0)};k.hyperbolicTangent=k.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,Z(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};k.inverseCosine=k.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Ee(t,r,o):new t(0):new t(NaN):e.isZero()?Ee(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Ee(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};k.inverseHyperbolicCosine=k.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,O=!1,t=t.times(t).minus(1).sqrt().plus(t),O=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};k.inverseHyperbolicSine=k.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,O=!1,t=t.times(t).plus(1).sqrt().plus(t),O=!0,n.precision=i,n.rounding=e,t.ln())};k.inverseHyperbolicTangent=k.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?N(new o(r),i,e,!0):(o.precision=t=n-r.e,r=Z(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};k.inverseSine=k.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Ee(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};k.inverseTangent=k.atan=function(){var i,e,t,n,r,o,s,a,c,u=this,l=u.constructor,d=l.precision,m=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&d+4<=Pn)return s=Ee(l,d+4,m).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(d+4<=Pn)return s=Ee(l,d+4,m).times(.5),s.s=u.s,s}for(l.precision=a=d+10,l.rounding=1,t=Math.min(28,a/C+2|0),i=t;i;--i)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(O=!1,e=Math.ceil(a/C),n=1,c=u.times(u),s=new l(u),r=u;i!==-1;)if(r=r.times(c),o=s.minus(r.div(n+=2)),r=r.times(c),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),O=!0,N(s,l.precision=d,l.rounding=m,!0)};k.isFinite=function(){return!!this.d};k.isInteger=k.isInt=function(){return!!this.d&&Ae(this.e/C)>this.d.length-2};k.isNaN=function(){return!this.s};k.isNegative=k.isNeg=function(){return this.s<0};k.isPositive=k.isPos=function(){return this.s>0};k.isZero=function(){return!!this.d&&this.d[0]===0};k.lessThan=k.lt=function(i){return this.cmp(i)<0};k.lessThanOrEqualTo=k.lte=function(i){return this.cmp(i)<1};k.logarithm=k.log=function(i){var e,t,n,r,o,s,a,c,u=this,l=u.constructor,d=l.precision,m=l.rounding,f=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(O=!1,a=d+f,s=et(u,a),n=e?Yt(l,a+10):et(i,a),c=Z(s,n,a,1),It(c.d,r=d,m))do if(a+=10,s=et(u,a),n=e?Yt(l,a+10):et(i,a),c=Z(s,n,a,1),!o){+ge(c.d).slice(r+1,r+15)+1==1e14&&(c=N(c,d+1,0));break}while(It(c.d,r+=10,m));return O=!0,N(c,d,m)};k.minus=k.sub=function(i){var e,t,n,r,o,s,a,c,u,l,d,m,f=this,g=f.constructor;if(i=new g(i),!f.d||!i.d)return!f.s||!i.s?i=new g(NaN):f.d?i.s=-i.s:i=new g(i.d||f.s!==i.s?f:NaN),i;if(f.s!=i.s)return i.s=-i.s,f.plus(i);if(u=f.d,m=i.d,a=g.precision,c=g.rounding,!u[0]||!m[0]){if(m[0])i.s=-i.s;else if(u[0])i=new g(f);else return new g(c===3?-0:0);return O?N(i,a,c):i}if(t=Ae(i.e/C),l=Ae(f.e/C),u=u.slice(),o=l-t,o){for(d=o<0,d?(e=u,o=-o,s=m.length):(e=m,t=l,s=u.length),n=Math.max(Math.ceil(a/C),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=u.length,s=m.length,d=n<s,d&&(s=n),n=0;n<s;n++)if(u[n]!=m[n]){d=u[n]<m[n];break}o=0}for(d&&(e=u,u=m,m=e,i.s=-i.s),s=u.length,n=m.length-s;n>0;--n)u[s++]=0;for(n=m.length;n>o;){if(u[--n]<m[n]){for(r=n;r&&u[--r]===0;)u[r]=Oe-1;--u[r],u[n]+=Oe}u[n]-=m[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(i.d=u,i.e=$t(u,t),O?N(i,a,c):i):new g(c===3?-0:0)};k.modulo=k.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?N(new n(t),n.precision,n.rounding):(O=!1,n.modulo==9?(e=Z(t,i.abs(),0,3,1),e.s*=i.s):e=Z(t,i,0,n.modulo,1),e=e.times(i),O=!0,t.minus(e))};k.naturalExponential=k.exp=function(){return kn(this)};k.naturalLogarithm=k.ln=function(){return et(this)};k.negated=k.neg=function(){var i=new this.constructor(this);return i.s=-i.s,N(i)};k.plus=k.add=function(i){var e,t,n,r,o,s,a,c,u,l,d=this,m=d.constructor;if(i=new m(i),!d.d||!i.d)return!d.s||!i.s?i=new m(NaN):d.d||(i=new m(i.d||d.s===i.s?d:NaN)),i;if(d.s!=i.s)return i.s=-i.s,d.minus(i);if(u=d.d,l=i.d,a=m.precision,c=m.rounding,!u[0]||!l[0])return l[0]||(i=new m(d)),O?N(i,a,c):i;if(o=Ae(d.e/C),n=Ae(i.e/C),u=u.slice(),r=o-n,r){for(r<0?(t=u,r=-r,s=l.length):(t=l,n=o,s=u.length),o=Math.ceil(a/C),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=l.length,s-r<0&&(r=s,t=l,l=u,u=t),e=0;r;)e=(u[--r]=u[r]+l[r]+e)/Oe|0,u[r]%=Oe;for(e&&(u.unshift(e),++n),s=u.length;u[--s]==0;)u.pop();return i.d=u,i.e=$t(u,n),O?N(i,a,c):i};k.precision=k.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(tt+i);return t.d?(e=pi(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};k.round=function(){var i=this,e=i.constructor;return N(new e(i),i.e+1,e.rounding)};k.sine=k.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+C,n.rounding=1,t=kr(n,wi(n,t)),n.precision=i,n.rounding=e,N(He>2?t.neg():t,i,e,!0)):new n(NaN)};k.squareRoot=k.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(O=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=ge(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=Ae((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),n=new l(e)):n=new l(u.toString()),t=(c=l.precision)+3;;)if(o=n,n=o.plus(Z(s,o,t+2,1)).times(.5),ge(o.d).slice(0,t)===(e=ge(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(N(o,c+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(N(n,c+1,1),i=!n.times(n).eq(s));break}return O=!0,N(n,c,l.rounding,i)};k.tangent=k.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=Z(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,N(He==2||He==4?t.neg():t,i,e,!0)):new n(NaN)};k.times=k.mul=function(i){var e,t,n,r,o,s,a,c,u,l=this,d=l.constructor,m=l.d,f=(i=new d(i)).d;if(i.s*=l.s,!m||!m[0]||!f||!f[0])return new d(!i.s||m&&!m[0]&&!f||f&&!f[0]&&!m?NaN:!m||!f?i.s/0:i.s*0);for(t=Ae(l.e/C)+Ae(i.e/C),c=m.length,u=f.length,c<u&&(o=m,m=f,f=o,s=c,c=u,u=s),o=[],s=c+u,n=s;n--;)o.push(0);for(n=u;--n>=0;){for(e=0,r=c+n;r>n;)a=o[r]+f[n]*m[r-n-1]+e,o[r--]=a%Oe|0,e=a/Oe|0;o[r]=(o[r]+e)%Oe|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=$t(o,t),O?N(i,d.precision,d.rounding):i};k.toBinary=function(i,e){return xn(this,2,i,e)};k.toDecimalPlaces=k.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Ie(i,0,nt),e===void 0?e=n.rounding:Ie(e,0,8),N(t,i+t.e+1,e))};k.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=We(n,!0):(Ie(i,0,nt),e===void 0?e=r.rounding:Ie(e,0,8),n=N(new r(n),i+1,e),t=We(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};k.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=We(r):(Ie(i,0,nt),e===void 0?e=o.rounding:Ie(e,0,8),n=N(new o(r),i+r.e+1,e),t=We(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};k.toFraction=function(i){var e,t,n,r,o,s,a,c,u,l,d,m,f=this,g=f.d,p=f.constructor;if(!g)return new p(f);if(u=t=new p(1),n=c=new p(0),e=new p(n),o=e.e=pi(g)-f.e-1,s=o%C,e.d[0]=ue(10,s<0?C+s:s),i==null)i=o>0?e:u;else{if(a=new p(i),!a.isInt()||a.lt(u))throw Error(tt+a);i=a.gt(e)?o>0?e:u:a}for(O=!1,a=new p(ge(g)),l=p.precision,p.precision=o=g.length*C*2;d=Z(a,e,0,1,1),r=t.plus(d.times(n)),r.cmp(i)!=1;)t=n,n=r,r=u,u=c.plus(d.times(r)),c=r,r=e,e=a.minus(d.times(r)),a=r;return r=Z(i.minus(t),n,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(n)),c.s=u.s=f.s,m=Z(u,n,o,1).minus(f).abs().cmp(Z(c,t,o,1).minus(f).abs())<1?[u,n]:[c,t],p.precision=l,O=!0,m};k.toHexadecimal=k.toHex=function(i,e){return xn(this,16,i,e)};k.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Ie(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(O=!1,t=Z(t,i,0,e,1).times(i),O=!0,N(t)):(i.s=t.s,t=i),t};k.toNumber=function(){return+this};k.toOctal=function(i,e){return xn(this,8,i,e)};k.toPower=k.pow=function(i){var e,t,n,r,o,s,a=this,c=a.constructor,u=+(i=new c(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new c(ue(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,o=c.rounding,i.eq(1))return N(a,n,o);if(e=Ae(i.e/C),e>=i.d.length-1&&(t=u<0?-u:u)<=wr)return r=gi(c,a,t,n),i.s<0?new c(1).div(r):N(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new c(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ue(+a,u),e=t==0||!isFinite(t)?Ae(u*(Math.log("0."+ge(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(O=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=kn(i.times(et(a,n+t)),n),r.d&&(r=N(r,n+5,1),It(r.d,n,o)&&(e=n+10,r=N(kn(i.times(et(a,e+t)),e),e+5,1),+ge(r.d).slice(n+1,n+15)+1==1e14&&(r=N(r,n+1,0)))),r.s=s,O=!0,c.rounding=o,N(r,n,o))};k.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=We(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Ie(i,1,nt),e===void 0?e=r.rounding:Ie(e,0,8),n=N(new r(n),i,e),t=We(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};k.toSignificantDigits=k.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Ie(i,1,nt),e===void 0?e=n.rounding:Ie(e,0,8)),N(new n(t),i,e)};k.toString=function(){var i=this,e=i.constructor,t=We(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};k.truncated=k.trunc=function(){return N(new this.constructor(this),this.e+1,1)};k.valueOf=k.toJSON=function(){var i=this,e=i.constructor,t=We(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function ge(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=C-n.length,t&&(o+=Je(t)),o+=n;s=i[e],n=s+"",t=C-n.length,t&&(o+=Je(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Ie(i,e,t){if(i!==~~i||i<e||i>t)throw Error(tt+i)}function It(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=C,r=0):(r=Math.ceil((e+1)/C),e%=C),o=ue(10,C-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==ue(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==ue(10,e-3)-1,s}function Ht(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=hn.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function Ar(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/Jt(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=ht(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var Z=function(){function i(n,r,o){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*r+a,n[c]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(n[a]!=r[a]){c=n[a]>r[a]?1:-1;break}return c}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,c){var u,l,d,m,f,g,p,b,y,A,w,P,h,T,B,K,D,W,v,me,oe=n.constructor,Be=n.s==r.s?1:-1,J=n.d,H=r.d;if(!J||!J[0]||!H||!H[0])return new oe(!n.s||!r.s||(J?H&&J[0]==H[0]:!H)?NaN:J&&J[0]==0||!H?Be*0:Be/0);for(c?(f=1,l=n.e-r.e):(c=Oe,f=C,l=Ae(n.e/f)-Ae(r.e/f)),v=H.length,D=J.length,y=new oe(Be),A=y.d=[],d=0;H[d]==(J[d]||0);d++);if(H[d]>(J[d]||0)&&l--,o==null?(T=o=oe.precision,s=oe.rounding):a?T=o+(n.e-r.e)+1:T=o,T<0)A.push(1),g=!0;else{if(T=T/f+2|0,d=0,v==1){for(m=0,H=H[0],T++;(d<D||m)&&T--;d++)B=m*c+(J[d]||0),A[d]=B/H|0,m=B%H|0;g=m||d<D}else{for(m=c/(H[0]+1)|0,m>1&&(H=i(H,m,c),J=i(J,m,c),v=H.length,D=J.length),K=v,w=J.slice(0,v),P=w.length;P<v;)w[P++]=0;me=H.slice(),me.unshift(0),W=H[0],H[1]>=c/2&&++W;do m=0,u=e(H,w,v,P),u<0?(h=w[0],v!=P&&(h=h*c+(w[1]||0)),m=h/W|0,m>1?(m>=c&&(m=c-1),p=i(H,m,c),b=p.length,P=w.length,u=e(p,w,b,P),u==1&&(m--,t(p,v<b?me:H,b,c))):(m==0&&(u=m=1),p=H.slice()),b=p.length,b<P&&p.unshift(0),t(w,p,P,c),u==-1&&(P=w.length,u=e(H,w,v,P),u<1&&(m++,t(w,v<P?me:H,P,c))),P=w.length):u===0&&(m++,w=[0]),A[d++]=m,u&&w[0]?w[P++]=J[K]||0:(w=[J[K]],P=1);while((K++<D||w[0]!==void 0)&&T--);g=w[0]!==void 0}A[0]||A.shift()}if(f==1)y.e=l,ui=g;else{for(d=1,m=A[0];m>=10;m/=10)d++;y.e=d+l*f-1,N(y,a?o+y.e+1:o,s,g)}return y}}();function N(i,e,t,n){var r,o,s,a,c,u,l,d,m,f=i.constructor;e:if(e!=null){if(d=i.d,!d)return i;for(r=1,a=d[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=C,s=e,l=d[m=0],c=l/ue(10,r-s-1)%10|0;else if(m=Math.ceil((o+1)/C),a=d.length,m>=a)if(n){for(;a++<=m;)d.push(0);l=c=0,r=1,o%=C,s=o-C+1}else break e;else{for(l=a=d[m],r=1;a>=10;a/=10)r++;o%=C,s=o-C+r,c=s<0?0:l/ue(10,r-s-1)%10|0}if(n=n||e<0||d[m+1]!==void 0||(s<0?l:l%ue(10,r-s-1)),u=t<4?(c||n)&&(t==0||t==(i.s<0?3:2)):c>5||c==5&&(t==4||n||t==6&&(o>0?s>0?l/ue(10,r-s):0:d[m-1])%10&1||t==(i.s<0?8:7)),e<1||!d[0])return d.length=0,u?(e-=i.e+1,d[0]=ue(10,(C-e%C)%C),i.e=-e||0):d[0]=i.e=0,i;if(o==0?(d.length=m,a=1,m--):(d.length=m+1,a=ue(10,C-o),d[m]=s>0?(l/ue(10,r-s)%ue(10,s)|0)*a:0),u)for(;;)if(m==0){for(o=1,s=d[0];s>=10;s/=10)o++;for(s=d[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,d[0]==Oe&&(d[0]=1));break}else{if(d[m]+=a,d[m]!=Oe)break;d[m--]=0,a=1}for(o=d.length;d[--o]===0;)d.pop()}return O&&(i.e>f.maxE?(i.d=null,i.e=NaN):i.e<f.minE&&(i.e=0,i.d=[0])),i}function We(i,e,t){if(!i.isFinite())return yi(i);var n,r=i.e,o=ge(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+Je(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+Je(-r-1)+o,t&&(n=t-s)>0&&(o+=Je(n))):r>=s?(o+=Je(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+Je(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=Je(n))),o}function $t(i,e){var t=i[0];for(e*=C;t>=10;t/=10)e++;return e}function Yt(i,e,t){if(e>hr)throw O=!0,t&&(i.precision=t),Error(li);return N(new i(jt),e,1,!0)}function Ee(i,e,t){if(e>Pn)throw Error(li);return N(new i(Zt),e,t,!0)}function pi(i){var e=i.length-1,t=e*C+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function Je(i){for(var e="";i--;)e+="0";return e}function gi(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/C+4);for(O=!1;;){if(t%2&&(o=o.times(e),ai(o.d,s)&&(r=!0)),t=Ae(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),ai(e.d,s)}return O=!0,o}function si(i){return i.d[i.d.length-1]&1}function bi(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function kn(i,e){var t,n,r,o,s,a,c,u=0,l=0,d=0,m=i.constructor,f=m.rounding,g=m.precision;if(!i.d||!i.d[0]||i.e>17)return new m(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(O=!1,c=g):c=e,a=new m(.03125);i.e>-2;)i=i.times(a),d+=5;for(n=Math.log(ue(2,d))/Math.LN10*2+5|0,c+=n,t=o=s=new m(1),m.precision=c;;){if(o=N(o.times(i),c,1),t=t.times(++l),a=s.plus(Z(o,t,c,1)),ge(a.d).slice(0,c)===ge(s.d).slice(0,c)){for(r=d;r--;)s=N(s.times(s),c,1);if(e==null)if(u<3&&It(s.d,c-n,f,u))m.precision=c+=10,t=o=a=new m(1),l=0,u++;else return N(s,m.precision=g,f,O=!0);else return m.precision=g,s}s=a}}function et(i,e){var t,n,r,o,s,a,c,u,l,d,m,f=1,g=10,p=i,b=p.d,y=p.constructor,A=y.rounding,w=y.precision;if(p.s<0||!b||!b[0]||!p.e&&b[0]==1&&b.length==1)return new y(b&&!b[0]?-1/0:p.s!=1?NaN:b?0:p);if(e==null?(O=!1,l=w):l=e,y.precision=l+=g,t=ge(b),n=t.charAt(0),Math.abs(o=p.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)p=p.times(i),t=ge(p.d),n=t.charAt(0),f++;o=p.e,n>1?(p=new y("0."+t),o++):p=new y(n+"."+t.slice(1))}else return u=Yt(y,l+2,w).times(o+""),p=et(new y(n+"."+t.slice(1)),l-g).plus(u),y.precision=w,e==null?N(p,w,A,O=!0):p;for(d=p,c=s=p=Z(p.minus(1),p.plus(1),l,1),m=N(p.times(p),l,1),r=3;;){if(s=N(s.times(m),l,1),u=c.plus(Z(s,new y(r),l,1)),ge(u.d).slice(0,l)===ge(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(Yt(y,l+2,w).times(o+""))),c=Z(c,new y(f),l,1),e==null)if(It(c.d,l-g,A,a))y.precision=l+=g,u=s=p=Z(d.minus(1),d.plus(1),l,1),m=N(p.times(p),l,1),r=a=1;else return N(c,y.precision=w,A,O=!0);else return y.precision=w,c;c=u,r+=2}}function yi(i){return String(i.s*i.s/0)}function Tn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%C,t<0&&(n+=C),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=C;n<r;)i.d.push(+e.slice(n,n+=C));e=e.slice(n),n=C-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),O&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function Pr(i,e){var t,n,r,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),fi.test(e))return Tn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(br.test(e))t=16,e=e.toLowerCase();else if(gr.test(e))t=2;else if(yr.test(e))t=8;else throw Error(tt+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=gi(n,new n(t),o,o*2)),u=Ht(e,t,Oe),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new n(i.s*0):(i.e=$t(u,l),i.d=u,O=!1,s&&(i=Z(i,r,a*4)),c&&(i=i.times(Math.abs(c)<54?ue(2,c):St.pow(2,c))),O=!0,i)}function kr(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:ht(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Jt(5,t)),e=ht(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function ht(i,e,t,n,r){var o,s,a,c,u=1,l=i.precision,d=Math.ceil(l/C);for(O=!1,c=t.times(t),a=new i(n);;){if(s=Z(a.times(c),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=Z(s.times(c),new i(e++*e++),l,1),s=a.plus(n),s.d[d]!==void 0){for(o=d;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,u++}return O=!0,s.d.length=d+1,s}function Jt(i,e){for(var t=i;--e;)t*=i;return t}function wi(i,e){var t,n=e.s<0,r=Ee(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return He=n?4:1,e;if(t=e.divToInt(r),t.isZero())He=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return He=si(t)?n?2:3:n?4:1,e;He=si(t)?n?1:4:n?3:2}return e.minus(r).abs()}function xn(i,e,t,n){var r,o,s,a,c,u,l,d,m,f=i.constructor,g=t!==void 0;if(g?(Ie(t,1,nt),n===void 0?n=f.rounding:Ie(n,0,8)):(t=f.precision,n=f.rounding),!i.isFinite())l=yi(i);else{for(l=We(i),s=l.indexOf("."),g?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),m=new f(1),m.e=l.length-s,m.d=Ht(We(m),10,r),m.e=m.d.length),d=Ht(l,10,r),o=c=d.length;d[--c]==0;)d.pop();if(!d[0])l=g?"0p+0":"0";else{if(s<0?o--:(i=new f(i),i.d=d,i.e=o,i=Z(i,m,t,n,0,r),d=i.d,o=i.e,u=ui),s=d[t],a=r/2,u=u||d[t+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&d[t-1]&1||n===(i.s<0?8:7)),d.length=t,u)for(;++d[--t]>r-1;)d[t]=0,t||(++o,d.unshift(1));for(c=d.length;!d[c-1];--c);for(s=0,l="";s<c;s++)l+=hn.charAt(d[s]);if(g){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(d=Ht(l,r,e),c=d.length;!d[c-1];--c);for(s=1,l="1.";s<c;s++)l+=hn.charAt(d[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function ai(i,e){if(i.length>e)return i.length=e,!0}function Tr(i){return new this(i).abs()}function xr(i){return new this(i).acos()}function Br(i){return new this(i).acosh()}function Ir(i,e){return new this(i).plus(e)}function Sr(i){return new this(i).asin()}function Nr(i){return new this(i).asinh()}function Kr(i){return new this(i).atan()}function Cr(i){return new this(i).atanh()}function Lr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Ee(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Ee(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Ee(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(Z(i,e,o,1)),e=Ee(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(Z(i,e,o,1)),t}function Rr(i){return new this(i).cbrt()}function Mr(i){return N(i=new this(i),i.e+1,2)}function Er(i,e,t){return new this(i).clamp(e,t)}function Or(i){if(!i||typeof i!="object")throw Error(Qt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,nt,"rounding",0,8,"toExpNeg",-wt,0,"toExpPos",0,wt,"maxE",0,wt,"minE",-wt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=An[t]),(n=i[t])!==void 0)if(Ae(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(tt+t+": "+n);if(t="crypto",r&&(this[t]=An[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(di);else this[t]=!1;else throw Error(tt+t+": "+n);return this}function Fr(i){return new this(i).cos()}function Dr(i){return new this(i).cosh()}function hi(i){var e,t,n;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,ci(o)){u.s=o.s,O?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;O?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return Tn(u,o.toString())}else if(c!=="string")throw Error(tt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),fi.test(o)?Tn(u,o):Pr(u,o)}if(r.prototype=k,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Or,r.clone=hi,r.isDecimal=ci,r.abs=Tr,r.acos=xr,r.acosh=Br,r.add=Ir,r.asin=Sr,r.asinh=Nr,r.atan=Kr,r.atanh=Cr,r.atan2=Lr,r.cbrt=Rr,r.ceil=Mr,r.clamp=Er,r.cos=Fr,r.cosh=Dr,r.div=_r,r.exp=vr,r.floor=qr,r.hypot=Wr,r.ln=Vr,r.log=Ur,r.log10=Xr,r.log2=Gr,r.max=zr,r.min=Hr,r.mod=jr,r.mul=Zr,r.pow=Yr,r.random=Qr,r.round=$r,r.sign=Jr,r.sin=eo,r.sinh=to,r.sqrt=no,r.sub=io,r.sum=ro,r.tan=oo,r.tanh=so,r.trunc=ao,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function _r(i,e){return new this(i).div(e)}function vr(i){return new this(i).exp()}function qr(i){return N(i=new this(i),i.e+1,3)}function Wr(){var i,e,t=new this(0);for(O=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return O=!0,new this(1/0);t=e}return O=!0,t.sqrt()}function ci(i){return i instanceof St||i&&i.toStringTag===mi||!1}function Vr(i){return new this(i).ln()}function Ur(i,e){return new this(i).log(e)}function Gr(i){return new this(i).log(2)}function Xr(i){return new this(i).log(10)}function zr(){return bi(this,arguments,"lt")}function Hr(){return bi(this,arguments,"gt")}function jr(i,e){return new this(i).mod(e)}function Zr(i,e){return new this(i).mul(e)}function Yr(i,e){return new this(i).pow(e)}function Qr(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Ie(i,1,nt),n=Math.ceil(i/C),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(di);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=C,n&&i&&(r=ue(10,C-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=C)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<C&&(t-=C-n)}return s.e=t,s.d=a,s}function $r(i){return N(i=new this(i),i.e+1,this.rounding)}function Jr(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function eo(i){return new this(i).sin()}function to(i){return new this(i).sinh()}function no(i){return new this(i).sqrt()}function io(i,e){return new this(i).sub(e)}function ro(){var i=0,e=arguments,t=new this(e[i]);for(O=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return O=!0,N(t,this.precision,this.rounding)}function oo(i){return new this(i).tan()}function so(i){return new this(i).tanh()}function ao(i){return N(i=new this(i),i.e+1,1)}k[Symbol.for("nodejs.util.inspect.custom")]=k.toString;k[Symbol.toStringTag]="Decimal";var St=k.constructor=hi(An);jt=new St(jt);Zt=new St(Zt);var I=St;import{get as Ai,set as co}from"lodash";import ki from"dayjs";import uo from"dayjs/plugin/utc";ki.extend(uo);var Bn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return ki().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Pi={},lo={};function le(i){let e=Ai(Pi,i);if(!e){let t=Ai(lo,i);e=new Bn({name:i,logLevel:t}),co(Pi,i,e)}return e}import{PublicKey as dc}from"@solana/web3.js";import fc from"bn.js";import Io from"big.js";import sn from"bn.js";import Se from"bn.js";import{PublicKey as Kn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as mo}from"@solana/spl-token";import{PublicKey as te,SystemProgram as fo,SYSVAR_RENT_PUBKEY as po}from"@solana/web3.js";function In({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var Ss=[In({pubkey:mo,isWritable:!1}),In({pubkey:fo.programId,isWritable:!1}),In({pubkey:po,isWritable:!1})];function Sn({publicKey:i,transformSol:e}){let t=Ti(i.toString());if(t instanceof te)return e&&t.equals(lt)?Q:t;if(e&&t.toString()===lt.toBase58())return Q;if(typeof t=="string"){if(t===te.default.toBase58())return te.default;try{return new te(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Ti(i){try{return new te(i)}catch{return i}}var en=new te("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Nt=new te("SysvarRent111111111111111111111111111111111"),Ns=new te("SysvarC1ock11111111111111111111111111111111"),At=new te("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Ks=new te("Sysvar1nstructions1111111111111111111111111"),Cs=new te("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ls=new te("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Rs=new te("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ms=new te("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Es=new te("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Os=new te("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Fs=new te("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ds=new te("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),_s=new te("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),vs=new te("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),qs=new te("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Q=new te("So11111111111111111111111111111111111111112"),lt=te.default;function Nn(i){return Sn({publicKey:i,transformSol:!0})}import{PublicKey as go}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as xi}from"@solana/spl-token";var tn={chainId:101,address:go.default.toBase58(),programId:xi.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},dt={chainId:101,address:"So11111111111111111111111111111111111111112",programId:xi.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Cn=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===lt.toBase58()||e instanceof Kn&&lt.equals(e)){this.decimals=dt.decimals,this.symbol=dt.symbol,this.name=dt.name,this.mint=new Kn(dt.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?Kn.default:Sn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},je=Cn;je.WSOL=new Cn(ee(q({},dt),{mint:dt.address}));import rn from"big.js";import wo from"bn.js";import ho from"decimal.js-light";import bo from"toformat";var yo=bo,Kt=yo;var nn=le("module/fraction"),Ln=Kt(rn),Ct=Kt(ho),Ao={[0]:Ct.ROUND_DOWN,[1]:Ct.ROUND_HALF_UP,[2]:Ct.ROUND_UP},Po={[0]:rn.roundDown,[1]:rn.roundHalfUp,[2]:rn.roundUp},z=class{constructor(e,t=new wo(1)){this.numerator=be(e),this.denominator=be(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new z(this.denominator,this.numerator)}add(e){let t=e instanceof z?e:new z(be(e));return this.denominator.eq(t.denominator)?new z(this.numerator.add(t.numerator),this.denominator):new z(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof z?e:new z(be(e));return this.denominator.eq(t.denominator)?new z(this.numerator.sub(t.numerator),this.denominator):new z(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof z?e:new z(be(e));return new z(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof z?e:new z(be(e));return new z(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||nn.logWithError(`${e} is not an integer.`),e<=0&&nn.logWithError(`${e} is not positive.`),Ct.set({precision:e+1,rounding:Ao[n]});let r=new Ct(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||nn.logWithError(`${e} is not an integer.`),e<0&&nn.logWithError(`${e} is negative.`),Ln.DP=e,Ln.RM=Po[n]||1,new Ln(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var To=le("Raydium_price"),Fe=class extends z{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new z(Rn(n.decimals),Rn(r.decimals))}get raw(){return new z(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Fe({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&To.logWithError("mul token not equals");let n=super.mul(t);return new Fe({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var Mn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},on=Mn;on.SOL=new Mn(tn);import xo from"bn.js";var Bi=new z(new xo(100)),Ze=class extends z{toSignificant(e=5,t,n){return this.mul(Bi).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Bi).toFixed(e,t,n)}};var Bo=new Se(0),Fa=new Se(1),Da=new Se(2),_a=new Se(3),va=new Se(5),En=new Se(10),qa=new Se(100),Wa=new Se(1e3),Va=new Se(1e4),Ii=9007199254740991;function be(i){let e=le("Raydium_parseBigNumberish");if(i instanceof Se)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Se(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=Ii||i<=-Ii)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Se(String(i))):typeof i=="bigint"?new Se(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Se(0))}function Rn(i){return En.pow(be(i))}var So=le("Raydium_amount"),Si=Kt(Io);function No(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):So.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var Pe=class extends z{constructor(t,n,r=!0,o){let s=new sn(0),a=En.pow(new sn(t.decimals));if(r)s=be(n);else{let c=new sn(0),u=new sn(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,d]=No(n.toString(),t.decimals);c=be(l),u=be(d)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=le(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new Pe(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new Pe(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return Si.DP=this.token.decimals,new Si(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Mt,sendAndConfirmTransaction as vn,Transaction as Et,TransactionMessage as Ot,VersionedTransaction as Ft}from"@solana/web3.js";import Fo from"axios";var se={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw"};import{PublicKey as Ko,ComputeBudgetProgram as Ni,Transaction as Ci,TransactionMessage as Co,Keypair as Li,VersionedTransaction as Ri}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Lo}from"@solana/spl-token";var Ki=le("Raydium_txUtil"),Mi=1644;function an(i){let e=[],t=[];return i.microLamports&&(e.push(Ni.setComputeUnitPrice({microLamports:i.microLamports})),t.push(se.SetComputeUnitPrice)),i.units&&(e.push(Ni.setComputeUnitLimit({units:i.units})),t.push(se.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Pt(i){var e,t;try{return((t=await((e=i.getLatestBlockhash)==null?void 0:e.call(i)))==null?void 0:t.blockhash)||(await i.getRecentBlockhash()).blockhash}catch{return(await i.getRecentBlockhash()).blockhash}}function Ro(i,e){i.length<1&&Ki.logWithError(`no instructions provided: ${i.toString()}`),e.length<1&&Ki.logWithError(`no signers provided:, ${e.toString()}`);let t=new Ci;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...i);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Mi}catch{return!1}}function Le(i,e){let[t,n]=Ko.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function Lt({instructions:i,payer:e,signers:t}){return Ro(i,[e,...t])}function Rt({instructions:i,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Li.generate().publicKey.toString()}){let o=new Co({payerKey:e,recentBlockhash:n,instructions:i}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Ri(o).serialize()).toString("base64").length<Mi}catch{return!1}}var Mo=i=>Buffer.isBuffer(i)?i:i instanceof Uint8Array?Buffer.from(i.buffer,i.byteOffset,i.byteLength):Buffer.from(i);function mt(i){let e=[];return i.forEach(t=>{t instanceof Ci&&(t.recentBlockhash||(t.recentBlockhash=Lo.toBase58()),t.feePayer||(t.feePayer=Li.generate().publicKey));let n=t.serialize({requireAllSignatures:!1,verifySignatures:!1});t instanceof Ri&&(n=Mo(n));let r=n.toString("base64");e.push(r)}),console.log("simulate tx string:",e),e}import{PublicKey as Ei,AddressLookupTableAccount as cn}from"@solana/web3.js";import{PublicKey as Eo}from"@solana/web3.js";import{getTransferFeeConfig as Rc,unpackMint as Mc}from"@solana/spl-token";var On=le("Raydium_accountInfo_util");async function it(i,e,t){let{batchRequest:n,commitment:r="confirmed"}=q({batchRequest:!1},t),o=Fn(e,100),s=new Array(o.length).fill([]);if(n){let a=o.map(l=>{let d=i._buildArgs([l.map(m=>m.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=Fn(a,10);s=(await(await Promise.all(c.map(async l=>await i._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&On.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(d=>{if(d){let{data:m,executable:f,lamports:g,owner:p,rentEpoch:b}=d;return m.length!==2&&m[1]!=="base64"&&On.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(m[0],"base64"),executable:f,lamports:g,owner:new Eo(p),rentEpoch:b}}return null})))}else try{s=await Promise.all(o.map(a=>i.getMultipleAccountsInfo(a,r)))}catch(a){a instanceof Error&&On.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function Dn(i,e,t){let n=await it(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>ee(q({},r),{accountInfo:n[o]}))}async function _n({connection:i,address:e}){let t=await it(i,[...new Set(e.map(r=>r.toString()))].map(r=>new Ei(r))),n={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new cn({key:s,state:cn.deserialize(o.data)});n[s.toString()]=a,un[s.toString()]=a}return n}var un={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new cn({key:new Ei("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:cn.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var ln=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Fo.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=an(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Mt.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(q({},t||{})):this.build(t)}build(e){let t=new Et;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async()=>{var r;let n=await Pt(this.connection);if(t.recentBlockhash=n,this.signers.length&&t.sign(...this.signers),mt([t]),(r=this.owner)!=null&&r.isKeyPair)return{txId:await vn(this.connection,t,this.signers),signedTx:t};if(this.signAllTransactions){let o=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(o[0].serialize(),{skipPreflight:!0}),signedTx:o[0]}}throw new Error("please connect wallet first")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:r}=this.build(n),o=t.filter(u=>u.transaction.instructions.length>0),s=[r,...o.map(u=>u.transaction)],a=[this.signers,...o.map(u=>u.signers)],c=[...this.instructionTypes,...o.map(u=>u.instructionTypes).flat()];return{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async u=>{var f;let{sequentially:l,onTxUpdate:d}=u||{},m=await Pt(this.connection);if((f=this.owner)!=null&&f.isKeyPair)return{txIds:await await Promise.all(s.map(async(g,p)=>(g.recentBlockhash=m,await vn(this.connection,g,a[p])))),signedTxs:s};if(this.signAllTransactions){let g=s.map((b,y)=>(b.recentBlockhash=m,a[y].length&&b.sign(...a[y]),b));mt(g);let p=await this.signAllTransactions(g);if(l){let b=0,y=[],A=async()=>{if(!p[b])return;let w=await this.connection.sendRawTransaction(p[b].serialize(),{skipPreflight:!0});y.push({txId:w,status:"sent",signedTx:p[b]}),d==null||d([...y]),b++,this.connection.onSignature(w,P=>{let h=y.findIndex(T=>T.txId===w);h>-1&&(y[h].status=P.err?"error":"success"),d==null||d([...y]),A()},"processed"),this.connection.getSignatureStatus(w)};return await A(),{txIds:y.map(w=>w.txId),signedTxs:p}}else{let b=[];for(let y=0;y<p.length;y+=1){let A=await this.connection.sendRawTransaction(p[y].serialize(),{skipPreflight:!0});b.push(A)}return{txIds:b,signedTxs:p}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){let m=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:r}=m,o=zt(m,["lookupTableCache","lookupTableAddress","forerunCreate"]),s=q(q({},un),t),a=Array.from(new Set([...n,...this.lookupTableAddress])),c=[];for(let f of a)s[f]===void 0&&c.push(new Mt(f));let u=await _n({connection:this.connection,address:c});for(let[f,g]of Object.entries(u))s[f]=g;let l=new Ot({payerKey:this.feePayer,recentBlockhash:r?Mt.default.toBase58():await Pt(this.connection),instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s)),d=new Ft(l);return d.sign(this.signers),{builder:this,transaction:d,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async()=>{var f;if(mt([d]),(f=this.owner)!=null&&f.isKeyPair)return d.sign([this.owner.signer]),{txId:await this.connection.sendTransaction(d,{skipPreflight:!0}),signedTx:d};if(this.signAllTransactions){let g=await this.signAllTransactions([d]);return{txId:await this.connection.sendTransaction(g[0],{skipPreflight:!0}),signedTx:g[0]}}throw new Error("please connect wallet first")},extInfo:o||{}}}async buildV0MultiTx(e){let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:r}=await this.buildV0(n),o=t.filter(u=>u.builder.instructions.length>0),s=[r,...o.map(u=>u.transaction)],a=[this.signers,...o.map(u=>u.signers)],c=[...this.instructionTypes,...o.map(u=>u.instructionTypes).flat()];return s.forEach(async(u,l)=>{u.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async u=>{var m;mt(s);let{sequentially:l,onTxUpdate:d}=u||{};if((m=this.owner)!=null&&m.isKeyPair)return s.forEach(f=>f.sign([this.owner.signer])),{txIds:await Promise.all(s.map(async f=>await this.connection.sendTransaction(f))),signedTxs:s};if(this.signAllTransactions){let f=await this.signAllTransactions(s);if(l){let g=0,p=[],b=async()=>{if(!f[g])return;let y=await this.connection.sendTransaction(f[g],{skipPreflight:!0});p.push({txId:y,status:"sent",signedTx:f[g]}),d==null||d([...p]),g++,this.connection.onSignature(y,A=>{let w=p.findIndex(P=>P.txId===y);w>-1&&(p[w].status=A.err?"error":"success"),d==null||d([...p]),b()},"processed"),this.connection.getSignatureStatus(y)};return b(),{txIds:[],signedTxs:f}}else{let g=[];for(let p=0;p<f.length;p+=1){let b=await this.connection.sendTransaction(f[p],{skipPreflight:!0});g.push(b)}return{txIds:g,signedTxs:f}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async sizeCheckBuild(e){let u=e||{},{autoComputeBudget:t=!1}=u,n=zt(u,["autoComputeBudget"]),r={instructions:[],instructionTypes:[]};if(t){let l=t?await this.getComputeBudgetConfig():void 0;r=t&&l?an(l):{instructions:[],instructionTypes:[]}}let o=this.signers.reduce((l,d)=>ee(q({},l),{[d.publicKey.toBase58()]:d}),{}),s=[],a=[],c=[];if(this.allInstructions.forEach(l=>{let d=[...c,l],m=t?[...r.instructions,...d]:d,g=[...new Set(d.map(p=>p.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat()).values()].map(p=>new Mt(p));if(c.length<12&&Lt({instructions:m,payer:this.feePayer,signers:g})||Lt({instructions:d,payer:this.feePayer,signers:g}))c.push(l);else{if(c.length===0)throw Error("item ins too big");Lt({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:g})?s.push(new Et().add(...r.instructions,...c)):s.push(new Et().add(...c)),a.push(Array.from(new Set(c.map(p=>p.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat())).map(p=>o[p]).filter(p=>p!==void 0)),c=[l]}}),c.length>0){let d=[...new Set(c.map(m=>m.keys.filter(f=>f.isSigner).map(f=>f.pubkey.toString())).flat()).values()].map(m=>o[m]).filter(m=>m!==void 0);Lt({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:d.map(m=>m.publicKey)})?s.push(new Et().add(...r.instructions,...c)):s.push(new Et().add(...c)),a.push(d)}return s.forEach(l=>l.feePayer=this.feePayer),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async l=>{var g;let{sequentially:d,onTxUpdate:m}=l||{},f=await Pt(this.connection);if(s.forEach(async(p,b)=>{p.recentBlockhash=f,a[b].length&&p.sign(...a[b])}),mt(s),(g=this.owner)!=null&&g.isKeyPair)return{txIds:await Promise.all(s.map(async(p,b)=>await vn(this.connection,p,a[b]))),signedTxs:s};if(this.signAllTransactions){let p=await this.signAllTransactions(s);if(d){let b=0,y=[],A=async()=>{if(!p[b])return;let w=await this.connection.sendRawTransaction(p[b].serialize(),{skipPreflight:!0});y.push({txId:w,status:"sent",signedTx:p[b]}),m==null||m([...y]),b++,this.connection.onSignature(w,P=>{let h=y.findIndex(T=>T.txId===w);h>-1&&(y[h].status=P.err?"error":"success"),m==null||m([...y]),A()},"processed"),this.connection.getSignatureStatus(w)};return await A(),{txIds:y.map(w=>w.txId),signedTxs:p}}else{let b=[];for(let y=0;y<p.length;y+=1){let A=await this.connection.sendRawTransaction(p[y].serialize(),{skipPreflight:!0});b.push(A)}return{txIds:b,signedTxs:p}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async sizeCheckBuildV0(e){let b=e||{},{autoComputeBudget:t=!1,lookupTableCache:n={},lookupTableAddress:r=[]}=b,o=zt(b,["autoComputeBudget","lookupTableCache","lookupTableAddress"]),s=q(q({},un),n),a=Array.from(new Set([...this.lookupTableAddress,...r])),c=[];for(let y of a)s[y]===void 0&&c.push(new Mt(y));let u=await _n({connection:this.connection,address:c});for(let[y,A]of Object.entries(u))s[y]=A;let l={instructions:[],instructionTypes:[]};if(t){let y=t?await this.getComputeBudgetConfig():void 0;l=t&&y?an(y):{instructions:[],instructionTypes:[]}}let d=await Pt(this.connection),m=this.signers.reduce((y,A)=>ee(q({},y),{[A.publicKey.toBase58()]:A}),{}),f=[],g=[],p=[];if(this.allInstructions.forEach(y=>{let A=[...p,y],w=t?[...l.instructions,...A]:A;if(p.length<12&&Rt({instructions:w,payer:this.feePayer,lookupTableAddressAccount:s})||Rt({instructions:A,payer:this.feePayer,lookupTableAddressAccount:s}))p.push(y);else{if(p.length===0)throw Error("item ins too big");let P={};for(let h of[...new Set(a)])s[h]!==void 0&&(P[h]=s[h]);if(t&&Rt({instructions:[...l.instructions,...p],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:d})){let h=new Ot({payerKey:this.feePayer,recentBlockhash:d,instructions:[...l.instructions,...p]}).compileToV0Message(Object.values(s));f.push(new Ft(h))}else{let h=new Ot({payerKey:this.feePayer,recentBlockhash:d,instructions:[...p]}).compileToV0Message(Object.values(s));f.push(new Ft(h))}g.push(Array.from(new Set(p.map(h=>h.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat())).map(h=>m[h]).filter(h=>h!==void 0)),p=[y]}}),p.length>0){let A=[...new Set(p.map(w=>w.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(w=>m[w]).filter(w=>w!==void 0);if(t&&Rt({instructions:[...l.instructions,...p],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:d})){let w=new Ot({payerKey:this.feePayer,recentBlockhash:d,instructions:[...l.instructions,...p]}).compileToV0Message(Object.values(s));f.push(new Ft(w))}else{let w=new Ot({payerKey:this.feePayer,recentBlockhash:d,instructions:[...p]}).compileToV0Message(Object.values(s));f.push(new Ft(w))}g.push(A)}return{builder:this,transactions:f,buildProps:e,signers:g,instructionTypes:this.instructionTypes,execute:async y=>{var P;let{sequentially:A,onTxUpdate:w}=y||{};if(f.map(async(h,T)=>{g[T].length&&h.sign(g[T])}),mt(f),(P=this.owner)!=null&&P.isKeyPair)return{txIds:await Promise.all(f.map(async h=>await this.connection.sendTransaction(h,{skipPreflight:!0}))),signedTxs:f};if(this.signAllTransactions){let h=await this.signAllTransactions(f);if(A){let T=0,B=[],K=async()=>{if(!h[T])return;let D=await this.connection.sendTransaction(h[T],{skipPreflight:!0});B.push({txId:D,status:"sent",signedTx:h[T]}),w==null||w([...B]),T++,this.connection.onSignature(D,W=>{let v=B.findIndex(me=>me.txId===D);v>-1&&(B[v].status=W.err?"error":"success"),w==null||w([...B]),K()},"processed"),this.connection.getSignatureStatus(D)};return K(),{txIds:[],signedTxs:h}}else{let T=[];for(let B=0;B<h.length;B+=1){let K=await this.connection.sendTransaction(h[B],{skipPreflight:!0});T.push(K)}return{txIds:T,signedTxs:h}}}throw new Error("please connect wallet first")},extInfo:o||{}}}};function Fn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Ne}from"@solana/web3.js";var tu=new Ne("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),nu=new Ne("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),iu=new Ne("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),ru=new Ne("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),ou=new Ne("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),su=new Ne("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),au=new Ne("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),cu=new Ne("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),uu=new Ne("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),lu=new Ne("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),du=new Ne("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),mu=new Ne("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),fu=new Ne("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),pu=new Ne("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi");import{PublicKey as Do}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as _o}from"@solana/spl-token";function De(i,e,t){return Le([i.toBuffer(),(t!=null?t:_o).toBuffer(),e.toBuffer()],new Do("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import ae from"bn.js";var Ve=1e4;function Tt(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=t.epoch<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new ae(r.maximumFee.toString()),s=t.epoch<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(r.transferFeeBasisPoints===Ve){let a=new ae(r.maximumFee.toString());return{amount:i.add(a),fee:a,expirationTime:s}}else{let a=kt(i.mul(new ae(Ve)),new ae(Ve-r.transferFeeBasisPoints)),c=new ae(r.maximumFee.toString()),u=a.sub(i).gt(c)?i.add(c):a,l=kt(u.mul(new ae(r.transferFeeBasisPoints)),new ae(Ve)),d=l.gt(o)?o:l;return{amount:u,fee:d,expirationTime:s}}else{let a=kt(i.mul(new ae(r.transferFeeBasisPoints)),new ae(Ve)),c=a.gt(o)?o:a;return{amount:i,fee:c,expirationTime:s}}}function ke(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=ee(q({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new ae(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Ve){let c=new ae(o.maximumFee.toString());return{amount:i.add(c),fee:c,expirationTime:a}}else{let c=kt(i.mul(new ae(Ve)),new ae(Ve-o.transferFeeBasisPoints)),u=new ae(o.maximumFee.toString()),l=c.sub(i).gt(u)?i.add(u):c,d=kt(l.mul(new ae(o.transferFeeBasisPoints)),new ae(Ve)),m=d.gt(s)?s:d;return{amount:l,fee:m,expirationTime:a}}else{let c=kt(i.mul(new ae(o.transferFeeBasisPoints)),new ae(Ve)),u=c.gt(s)?s:c;return{amount:i,fee:u,expirationTime:a}}}function ft(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function kt(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new ae(0))?t.add(new ae(1)):t}var qn=(...i)=>i.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Dt=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=le(t)}createTxBuilder(e){return this.scope.checkOwner(),new ln({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(qn(e))}logInfo(...e){this.logger.info(qn(e))}logAndCreateError(...e){let t=qn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import Ue from"bn.js";var ce=new Ue(0),Ke=new Ue(1),Ye=new Ue(-1),Ce=new Ue(1).shln(64),dn=new Ue(1).shln(128),Wn=Ce.sub(Ke),_t=64,Oi=dn.subn(1),Te=-443636,xe=-Te,rt=new Ue("4295048016"),ot=new Ue("79226673521066979257578248091"),Fi=16,Di="59543866431248",_i="184467440737095516",vi="15793534762490258745",mn=new Ue(10).pow(new Ue(6));var qi={tvl:0,volumeQuote:0,mintAmountA:0,mintAmountB:0,rewardDefaultInfos:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,day:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},week:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},month:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},pooltype:[]},Gu=new Ue("18446744073700000000");import _ from"bn.js";function fn(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Vn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Un(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function vt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function Wi(i,e){return vt(i,e)?null:Vn(i,e)}function Vi(i,e){return vt(i,e)?null:Un(i,e)}var Yu=Buffer.from("amm_config","utf8"),vo=Buffer.from("pool","utf8"),qo=Buffer.from("pool_vault","utf8"),Wo=Buffer.from("pool_reward_vault","utf8"),Ui=Buffer.from("position","utf8"),Vo=Buffer.from("tick_array","utf8"),Uo=Buffer.from("operation","utf8"),Go=Buffer.from("pool_tick_array_bitmap_extension","utf8");function Gi(i,e,t,n){return Le([vo,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function Gn(i,e,t){return Le([qo,e.toBuffer(),t.toBuffer()],i)}function Xi(i,e,t){return Le([Wo,e.toBuffer(),t.toBuffer()],i)}function j(i,e,t){return Le([Vo,e.toBuffer(),fn(t)],i)}function pt(i,e,t,n){return Le([Ui,e.toBuffer(),fn(t),fn(n)],i)}function Ge(i,e){return Le([Ui,e.toBuffer()],i)}function pn(i){return Le([Buffer.from("metadata","utf8"),At.toBuffer(),i.toBuffer()],At)}function qt(i){return Le([Uo],i)}function st(i,e){return Le([Go,e.toBuffer()],i)}import{PublicKey as tr}from"@solana/web3.js";import re from"bn.js";import as from"bn.js";import{PublicKey as Jo}from"@solana/web3.js";import Zi,{isBN as Yi}from"bn.js";import{bits as Ju,BitStructure as el,blob as Xo,Blob as tl,cstr as nl,f32 as il,f32be as rl,f64 as ol,f64be as sl,greedy as al,Layout as zo,ns64 as cl,ns64be as ul,nu64 as ll,nu64be as dl,offset as ml,s16 as fl,s16be as pl,s24 as gl,s24be as bl,s32 as Ho,s32be as yl,s40 as wl,s40be as hl,s48 as Al,s48be as Pl,s8 as kl,seq as jo,struct as Tl,Structure as Zo,u16 as Yo,u16be as xl,u24 as Bl,u24be as Il,u32 as Sl,u32be as Nl,u40 as Kl,u40be as Cl,u48 as Ll,u48be as Rl,u8 as Qo,UInt as $o,union as Ml,Union as El,unionLayoutDiscriminator as Ol,utf8 as Fl}from"@solana/buffer-layout";var Xn=zo,zi=Zo;var zn=$o;var Hi=Qo,xt=Yo;var ye=Ho;var ji=jo;var Re=Xo;var Wt=class extends Xn{constructor(t,n,r){super(t,r);this.blob=Re(t),this.signed=n}decode(t,n=0){let r=new Zi(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Zi(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function ie(i){return new zn(1,i)}function Qe(i){return new zn(4,i)}function L(i){return new Wt(8,!1,i)}function V(i){return new Wt(16,!1,i)}function Qi(i){return new Wt(16,!0,i)}var gn=class extends Xn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function $(i){return new gn(Re(32),e=>new Jo(e),e=>e.toBuffer(),i)}function Xe(i){return new gn(Hi(),es,ts,i)}function es(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function ts(i){return i?1:0}var Hn=class extends zi{decode(e,t){return super.decode(e,t)}};function Y(i,e,t){return new Hn(i,e,t)}function ne(i,e,t){let n,r=typeof e=="number"?e:Yi(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Yi(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return ji(i,r,t)}var jn=14,$e=class{static maxTickInTickarrayBitmap(e){return e*de*gt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!U.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-U.tickCount(n):t+U.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*de,c=s/a+512;s<0&&s%a!=0&&c--;let u=Math.abs(c);if(r){let l=e.shln(1024-u-1),d=Wi(1024,l);if(d!==null){let m=(u-d-512)*a;return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(u),d=Vi(1024,l);if(d!==null){let m=(u+d-512)*a;return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:o-U.tickCount(n)}}}},Vt=class{static getBitmapOffset(e,t){if(!U.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=$e.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=$e.maxTickInTickarrayBitmap(e),n=-t;if(xe<=t)throw Error(`extensionTickBoundary check error: ${xe}, ${t}`);if(n<=Te)throw Error(`extensionTickBoundary check error: ${n}, ${Te}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:S.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=U.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=$e.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let c=S.mergeTickArrayBitmap(e).shln(gt-1-a),u=vt(512,c)?null:Vn(512,c);if(u!==null){let l=t-u*U.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let c=S.mergeTickArrayBitmap(e).shrn(a),u=vt(512,c)?null:Un(512,c);if(u!==null){let l=t+u*U.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-U.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%$e.maxTickInTickarrayBitmap(t),r=Math.floor(n/U.tickCount(t));return e<0&&n!=0&&(r=gt-r),r}};var id=Y([Re(8),ie("bump"),xt("index"),$(""),Qe("protocolFeeRate"),Qe("tradeFeeRate"),xt("tickSpacing"),ne(L(),8,"")]),ns=Y([Qe("blockTimestamp"),V("sqrtPriceX64"),V("cumulativeTimePriceX64"),ne(V(),1,"")]),Zn=Y([Re(8),Xe("initialized"),$("poolId"),ne(ns,1e3,"observations"),ne(V(),5,"")]),is=Y([ie("rewardState"),L("openTime"),L("endTime"),L("lastUpdateTime"),V("emissionsPerSecondX64"),L("rewardTotalEmissioned"),L("rewardClaimed"),$("tokenMint"),$("tokenVault"),$("creator"),V("rewardGrowthGlobalX64")]),rd=Y([Re(8),ie("bump"),$("ammConfig"),$("creator"),$("mintA"),$("mintB"),$("vaultA"),$("vaultB"),$("observationId"),ie("mintDecimalsA"),ie("mintDecimalsB"),xt("tickSpacing"),V("liquidity"),V("sqrtPriceX64"),ye("tickCurrent"),xt("observationIndex"),xt("observationUpdateDuration"),V("feeGrowthGlobalX64A"),V("feeGrowthGlobalX64B"),L("protocolFeesTokenA"),L("protocolFeesTokenB"),V("swapInAmountTokenA"),V("swapOutAmountTokenB"),V("swapInAmountTokenB"),V("swapOutAmountTokenA"),ie("status"),ne(ie(),7,""),ne(is,3,"rewardInfos"),ne(L(),16,"tickArrayBitmap"),L("totalFeesTokenA"),L("totalFeesClaimedTokenA"),L("totalFeesTokenB"),L("totalFeesClaimedTokenB"),L("fundFeesTokenA"),L("fundFeesTokenB"),L("startTime"),ne(L(),15*4-3,"padding")]),rs=Y([V("growthInsideLastX64"),L("rewardAmountOwed")]),$i=Y([Re(8),ie("bump"),$("nftMint"),$("poolId"),ye("tickLower"),ye("tickUpper"),V("liquidity"),V("feeGrowthInsideLastX64A"),V("feeGrowthInsideLastX64B"),L("tokenFeesOwedA"),L("tokenFeesOwedB"),ne(rs,3,"rewardInfos"),ne(L(),8,"")]),od=Y([Re(8),ie("bump"),$("poolId"),ye("tickLowerIndex"),ye("tickUpperIndex"),V("liquidity"),V("feeGrowthInsideLastX64A"),V("feeGrowthInsideLastX64B"),L("tokenFeesOwedA"),L("tokenFeesOwedB"),ne(V(),3,"rewardGrowthInside"),ne(L(),8,"")]),os=Y([ye("tick"),Qi("liquidityNet"),V("liquidityGross"),V("feeGrowthOutsideX64A"),V("feeGrowthOutsideX64B"),ne(V(),3,"rewardGrowthsOutsideX64"),ne(Qe(),13,"")]),Ut=Y([Re(8),$("poolId"),ye("startTickIndex"),ne(os,de,"ticks"),ie("initializedTickCount"),ne(ie(),115,"")]),Ji=Y([Re(329),ne($(),100,"whitelistMints")]),er=Y([Re(8),$("poolId"),ne(ne(L(),8),jn,"positiveTickArrayBitmap"),ne(ne(L(),8),jn,"negativeTickArrayBitmap")]);var ss=15,U=class{static async getTickArrays(e,t,n,r,o,s,a){let c=[],u=S.getTickArrayStartIndexByTick(r,o),l=S.getInitializedTickArrayInRange(s,a,o,u,Math.floor(ss/2));for(let f=0;f<l.length;f++){let{publicKey:g}=j(t,n,l[f]);c.push(g)}let d=(await it(e,c)).map(f=>f!==null?Ut.decode(f.data):null),m={};for(let f=0;f<c.length;f++){let g=d[f];g!==null&&(m[g.startTickIndex]=ee(q({},g),{address:c[f]}))}return m}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(u=S.getNextTickArrayStartIndex(u,o,s),this.checkIsValidStartIndex(u,o))throw new Error("No enough initialized tickArray");let l=n[u];if(l===void 0)continue;let{nextTick:d,tickArrayAddress:m,tickArrayStartTickIndex:f}=this.firstInitializedTickInOneArray(e,t,l,s);[a,c,u]=[d,m,f]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/U.tickCount(t)),a=n?S.searchLowBitFromStart(r,o,s-1,1,t):S.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=de-1;for(;a>=0;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a-1}}else{let a=0;for(;a<de;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a+1}}let{publicKey:s}=j(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=S.getTickArrayStartIndexByTick(r,o),c=Math.floor((r-a)/o),u=n[a];if(u==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;c>=0;){let m=u.ticks[c];if(m.liquidityGross.gtn(0)){l=m;break}c=c-1}else for(c=c+1;c<de;){let m=u.ticks[c];if(m.liquidityGross.gtn(0)){l=m;break}c=c+1}let{publicKey:d}=j(e,t,a);return{initializedTick:l,tickArrayAddress:d,tickArrayStartTickIndex:u.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(S.checkIsOutOfBoundary(e)){if(e>xe)return!1;let n=S.getTickArrayStartIndexByTick(Te,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return de*e}};var de=60,gt=512,S=class{static getTickArrayAddressByTick(e,t,n,r){let o=S.getTickArrayStartIndexByTick(n,r),{publicKey:s}=j(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=S.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=de)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=U.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*U.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*de,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*de,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*de:e+t*de}static mergeTickArrayBitmap(e){let t=new as(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*de));return[...S.searchLowBitFromStart(e,t,s-1,o,n),...S.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return S.searchHightBitFromStart(e,t,0,gt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=S.getAllInitializedTickArrayStartIndex(n,r,o);for(let c of a){let{publicKey:u}=j(e,t,c);s.push({tickArrayStartIndex:c,tickArrayAddress:u})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>S.mergeTickArrayBitmap(u)),a=[];for(;n>=-7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n--,a.length===r)break}let c=U.tickCount(o);return a.map(u=>u*c)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>S.mergeTickArrayBitmap(u)),a=[];for(;n<7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n++,a.length===r)break}let c=U.tickCount(o);return a.map(u=>u*c)}static checkIsOutOfBoundary(e){return e<Te||e>xe}static nextInitTick(e,t,n,r,o){if(U.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<de;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=de-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<de;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=F.getSqrtPriceX64FromTick(t),o=F.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new I(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new I(1).div(t),o=bt.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=F.getSqrtPriceX64FromTick(o),a=F.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new I(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=F.getSqrtPriceX64FromTick(t),o=F.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new I(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new I(1).div(t),o=bt.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=F.getSqrtPriceX64FromTick(o),a=F.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new I(1).div(a)}}};import ze from"bn.js";var Gt=class{static getfeeGrowthInside(e,t,n){let r=new ze(0),o=new ze(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new ze(0),a=new ze(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let c=E.wrappingSubU128(E.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),u=E.wrappingSubU128(E.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:c,feeGrowthInsideBX64:u}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=E.mulDivFloor(E.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ce),c=t.tokenFeesOwedA.add(a),u=E.mulDivFloor(E.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ce),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=E.mulDivFloor(E.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ce),c=t.tokenFeesOwedA.add(a),u=E.mulDivFloor(E.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ce),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=E.wrappingSubU128(c,u.growthInsideLastX64),d=E.mulDivFloor(l,t.liquidity,Ce),m=u.rewardAmountOwed.add(d);o.push(m)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=E.wrappingSubU128(c,u.growthInsideLastX64),d=E.mulDivFloor(l,t.liquidity,Ce),m=u.rewardAmountOwed.add(d);o.push(m)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new ze(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new ze(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(E.wrappingSubU128(E.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new ze(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new ze(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(E.wrappingSubU128(E.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var b,y,A,w;let a=F.priceToSqrtPriceX64(new I(e.price),e.mintA.decimals,e.mintB.decimals),c=F.getSqrtPriceX64FromTick(t.tickLower),u=F.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,d=G.getAmountsFromLiquidity(a,c,u,n,o),[m,f]=[ke(d.amountA,(b=e.mintA.extensions)==null?void 0:b.feeConfig,s,!0),ke(d.amountB,(y=e.mintB.extensions)==null?void 0:y.feeConfig,s,!0)],[g,p]=[ke(new ze(new I(d.amountA.toString()).mul(l).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,s,!0),ke(new ze(new I(d.amountB.toString()).mul(l).toFixed(0)),(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)];return{liquidity:n,amountA:m,amountB:f,amountSlippageA:g,amountSlippageB:p,expirationTime:ft(m.expirationTime,f.expirationTime)}}};var we=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o){let s=n.equals(e.mintA.mint),a=[],{isExist:c,startIndex:u,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!c||u===void 0||!l)throw new Error("Invalid tick array");a.push(l);let{amountCalculated:d,accounts:m,sqrtPriceX64:f,feeAmount:g}=yt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,u,o);return a.push(...m),{expectedAmountOut:d.mul(Ye),remainingAccounts:a,executionPrice:f,feeAmount:g}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.equals(e.mintB.mint),a=[],{isExist:c,startIndex:u,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!c||u===void 0||!l)throw new Error("Invalid tick array");try{let p=this.preInitializedTickArrayStartIndex(e,s);if(p.isExist){let{publicKey:b}=j(e.programId,e.id,p.nextStartIndex);a.push(b)}}catch{}a.push(l);let{amountCalculated:d,accounts:m,sqrtPriceX64:f,feeAmount:g}=yt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(Ye),u,o);return a.push(...m),{expectedAmountIn:d,remainingAccounts:a,executionPrice:f,feeAmount:g}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=we.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Vt.checkTickArrayIsInit(U.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):S.checkTickArrayIsInitialized(S.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=j(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,U.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=j(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/U.tickCount(e.tickSpacing)),r=t?S.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):S.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=U.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=$e.nextInitializedTickArrayStartIndex(S.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Vt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Te||t>xe)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,c,u;let s=[];for(let l=0;l<o.length;l++){let d=o[l],m=(u=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?u:(c=await e.getAccountInfo(d.tokenMint))==null?void 0:c.owner;if(m===void 0)throw Error("get new reward mint info error");let f=ee(q({},d),{perSecond:E.x64ToDecimal(d.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new tr(m)});if(f.tokenMint.equals(tr.default))continue;if(n<=f.openTime.toNumber()||r.eq(ce)){s.push(f);continue}let g=new re(Math.min(f.endTime.toNumber(),n)),p=g.sub(f.lastUpdateTime),b=E.mulDivFloor(p,f.emissionsPerSecondX64,r),y=f.rewardGrowthGlobalX64.add(b),A=E.mulDivFloor(p,f.emissionsPerSecondX64,Ce),w=f.rewardTotalEmissioned.add(A);s.push(ee(q({},f),{rewardGrowthGlobalX64:y,rewardTotalEmissioned:w,lastUpdateTime:g}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=S.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=$e.maxTickInTickarrayBitmap(e),n=-t;return t>xe&&(t=U.getArrayStartIndex(xe,e)+U.tickCount(e)),n<Te&&(n=U.getArrayStartIndex(Te,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!U.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/U.tickCount(t)*gt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await Dn(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=er.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let c of t){let u=S.getTickArrayStartIndexByTick(c.tickCurrent,c.tickSpacing),l=S.getInitializedTickArrayInRange(c.tickArrayBitmap,c.exBitmapInfo,c.tickSpacing,u,7);for(let d of l){let{publicKey:m}=j(c.programId,c.id,d);o.push({pubkey:m}),r[m.toString()]=c.id}}let s=await Dn(e,o,{batchRequest:n}),a={};for(let c of s){if(!c.accountInfo)continue;let u=r[c.pubkey.toString()];if(!u)continue;a[u.toString()]===void 0&&(a[u.toString()]={});let l=Ut.decode(c.accountInfo.data);a[u.toString()][l.startTickIndex]=ee(q({},l),{address:c.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let c=0;c<e.length;c++){let u=e[c];u!==null&&(s.find(l=>l.equals(u.state.programId))||s.push(u.state.programId))}if(n){let c=n.tokenAccounts.map(m=>m.accountInfo.mint),u=[];for(let m of c)for(let f of s)u.push(Ge(f,m).publicKey);let l=await it(t,u,{batchRequest:r}),d={};for(let m of l){if(m===null)continue;let f=$i.decode(m.data),g=f.poolId.toString(),p=e.find(K=>K.state.id.toBase58()===g);if(p===void 0)continue;let b=p.state,y=S._getTickPriceLegacy({poolInfo:b,tick:f.tickLower,baseIn:!0}),A=S._getTickPriceLegacy({poolInfo:b,tick:f.tickUpper,baseIn:!0}),{amountA:w,amountB:P}=G.getAmountsFromLiquidity(b.sqrtPriceX64,y.tickSqrtPriceX64,A.tickSqrtPriceX64,f.liquidity,!1),h=1/(1-Math.sqrt(Math.sqrt(y.price.div(A.price).toNumber())));p.positionAccount=[...(a=p.positionAccount)!=null?a:[],{poolId:f.poolId,nftMint:f.nftMint,priceLower:y.price,priceUpper:A.price,amountA:w,amountB:P,tickLower:f.tickLower,tickUpper:f.tickUpper,liquidity:f.liquidity,feeGrowthInsideLastX64A:f.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:f.feeGrowthInsideLastX64B,tokenFeesOwedA:f.tokenFeesOwedA,tokenFeesOwedB:f.tokenFeesOwedB,rewardInfos:f.rewardInfos.map(K=>ee(q({},K),{pendingReward:new re(0)})),leverage:h,tokenFeeAmountA:new re(0),tokenFeeAmountB:new re(0)}];let T=await S.getTickArrayAddressByTick(p.state.programId,f.poolId,f.tickLower,p.state.tickSpacing),B=await S.getTickArrayAddressByTick(p.state.programId,f.poolId,f.tickUpper,p.state.tickSpacing);d[`${p.state.programId.toString()}-${f.poolId.toString()}-${f.tickLower}`]=T,d[`${p.state.programId.toString()}-${f.poolId.toString()}-${f.tickUpper}`]=B}if(o){let m=Object.values(d),f=await it(t,m,{batchRequest:r}),g={};for(let p=0;p<m.length;p++){let b=f[p];if(b===null)continue;let y=m[p].toString();g[y]=Ut.decode(b.data)}for(let{state:p,positionAccount:b}of e)if(!!b)for(let y of b){let A=`${p.programId.toString()}-${p.id.toString()}-${y.tickLower}`,w=`${p.programId.toString()}-${p.id.toString()}-${y.tickUpper}`,P=g[d[A].toString()],h=g[d[w].toString()],T=P.ticks[S.getTickOffsetInArray(y.tickLower,p.tickSpacing)],B=h.ticks[S.getTickOffsetInArray(y.tickUpper,p.tickSpacing)],{tokenFeeAmountA:K,tokenFeeAmountB:D}=await Gt.GetPositionFees(p,y,T,B),W=await Gt.GetPositionRewards(p,y,T,B);y.tokenFeeAmountA=K.gte(new re(0))?K:new re(0),y.tokenFeeAmountB=D.gte(new re(0))?D:new re(0);for(let v=0;v<W.length;v++)y.rewardInfos[v].pendingReward=W[v].gte(new re(0))?W[v]:new re(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,token2022Infos:r,epochInfo:o,amountIn:s,slippage:a,priceLimit:c=new I(0)}){var D,W,v,me;let u;c.equals(new I(0))?u=n.equals(e.mintA.mint)?rt.add(new re(1)):ot.sub(new re(1)):u=F.priceToSqrtPriceX64(c,e.mintA.decimals,e.mintB.decimals);let l=Tt(s,(D=r[n.toString()])==null?void 0:D.feeConfig,o,!1),{expectedAmountOut:d,remainingAccounts:m,executionPrice:f,feeAmount:g}=we.getOutputAmountAndRemainAccounts(e,t,n,l.amount.sub((W=l.fee)!=null?W:ce),u),p=e.mintA.mint.equals(n)?e.mintB.mint:e.mintA.mint,b=Tt(d,(v=r[p.toString()])==null?void 0:v.feeConfig,o,!1),y=F.sqrtPriceX64ToPrice(f,e.mintA.decimals,e.mintB.decimals),A=n.equals(e.mintA.mint)?y:new I(1).div(y),w=d.mul(new re(Math.floor((1-a)*1e10))).div(new re(1e10)),P=Tt(w,(me=r[p.toString()])==null?void 0:me.feeConfig,o,!1),h=e.mintA.mint.equals(n)?e.currentPrice:new I(1).div(e.currentPrice),T=new I(A).sub(h).abs(),B=h,K=new Ze(new I(T).mul(10**15).toFixed(0),new I(B).mul(10**15).toFixed(0));return{realAmountIn:l,amountOut:b,minAmountOut:P,expirationTime:ft(l.expirationTime,b.expirationTime),currentPrice:e.currentPrice,executionPrice:A,priceImpact:K,fee:g,remainingAccounts:m}}static async computeAmountOutFormat({poolInfo:e,tickArrayCache:t,token2022Infos:n,amountIn:r,tokenOut:o,slippage:s,epochInfo:a}){let c=r.token.equals(je.WSOL)?Q:r.token.mint,u=s.numerator.toNumber()/s.denominator.toNumber(),l=o.mint.equals(lt)?new je({mint:"sol",decimals:tn.decimals}):o,{realAmountIn:d,amountOut:m,minAmountOut:f,expirationTime:g,currentPrice:p,executionPrice:b,priceImpact:y,fee:A,remainingAccounts:w}=await we.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:c,amountIn:r.raw,slippage:u,token2022Infos:n,epochInfo:a}),P=ee(q({},d),{amount:new Pe(r.token,d.amount),fee:d.fee===void 0?void 0:new Pe(r.token,d.fee)}),h=ee(q({},m),{amount:new Pe(l,m.amount),fee:m.fee===void 0?void 0:new Pe(l,m.fee)}),T=ee(q({},f),{amount:new Pe(l,f.amount),fee:f.fee===void 0?void 0:new Pe(l,f.fee)}),B=new Fe({baseToken:r.token,denominator:new re(10).pow(new re(20+r.token.decimals)),quoteToken:l,numerator:p.mul(new I(10**(20+l.decimals))).toFixed(0)}),K=new Fe({baseToken:r.token,denominator:new re(10).pow(new re(20+r.token.decimals)),quoteToken:l,numerator:b.mul(new I(10**(20+l.decimals))).toFixed(0)}),D=new Pe(r.token,A);return{realAmountIn:P,amountOut:h,minAmountOut:T,expirationTime:g,currentPrice:B,executionPrice:K,priceImpact:y,fee:D,remainingAccounts:w}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var g,p,b;let o=e[t],s=S.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=S.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),c=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-c,d=a-s,m=o.priceMax-o.priceMin,f;return l<=0?f=0:d===l?f=m/l:m===l?f=l/d:f=l/m*(l/d),{feeApr:o.feeApr*f,rewardsApr:[(g=o.rewardApr[0])!=null?g:0*f,(p=o.rewardApr[1])!=null?p:0*f,(b=o.rewardApr[2])!=null?b:0*f],apr:o.apr*f}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:c}){let u=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],d=r[Nn(e.mintA.address).toString()],m=r[Nn(e.mintB.address).toString()],f=e.mintA.decimals,g=e.mintB.decimals;if(!l||!d||!m)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let p=F.priceToSqrtPriceX64(new I(e.price),e.mintA.decimals,e.mintB.decimals),b=F.getSqrtPriceX64FromTick(s),y=F.getSqrtPriceX64FromTick(a),{amountSlippageA:A,amountSlippageB:w}=G.getAmountsFromLiquidityWithSlippage(p,b,y,t,!1,!1,0),{amountSlippageA:P,amountSlippageB:h}=G.getAmountsFromLiquidityWithSlippage(p,b,y,o,!1,!1,0),T=new I(A.toString()).div(new I(10).pow(f)).mul(d.value).add(new I(w.toString()).div(new I(10).pow(g)).mul(m.value)),B=new I(P.toString()).div(new I(10).pow(f)).mul(d.value).add(new I(h.toString()).div(new I(10).pow(g)).mul(m.value)),K=B.div(T.add(B)).div(B),W=new I(l.volumeFee).mul(365).div(u).mul(K).mul(100).toNumber(),v=3600*24*365,me=e.rewardDefaultInfos.map(oe=>{var H,ni;let Be=oe.mint.decimals,J=r[oe.mint.address];return c<((H=oe.startTime)!=null?H:0)||c>((ni=oe.endTime)!=null?ni:0)||!oe.perSecond||!J||Be===void 0?0:new I(J.value).mul(new I(oe.perSecond).mul(v)).div(new I(10).pow(Be)).mul(K).mul(100).toNumber()});return{feeApr:W,rewardsApr:me,apr:W+me.reduce((oe,Be)=>oe+Be,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:c,amountHasFee:u}){var y,A;let l=F.priceToSqrtPriceX64(new I(e.price),e.mintA.decimals,e.mintB.decimals),d=F.getSqrtPriceX64FromTick(n),m=F.getSqrtPriceX64FromTick(r),f=a?1-s:1+s,g=ke(o,(y=e[t?"mintA":"mintB"].extensions)==null?void 0:y.feeConfig,c,!u),p=new re(new I(g.amount.sub((A=g.fee)!=null?A:ce).toString()).mul(f).toFixed(0)),b;if(l.lte(d))b=t?G.getLiquidityFromTokenAmountA(d,m,p,!a):new re(0);else if(l.lte(m)){let w=G.getLiquidityFromTokenAmountA(l,m,p,!a),P=G.getLiquidityFromTokenAmountB(d,l,p);b=t?w:P}else b=t?new re(0):G.getLiquidityFromTokenAmountB(d,m,p);return we.getAmountsFromLiquidity({epochInfo:c,poolInfo:e,tickLower:n,tickUpper:r,liquidity:b,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var b,y,A,w;let c=F.getSqrtPriceX64FromTick(n),u=F.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,d=G.getAmountsFromLiquidity(F.priceToSqrtPriceX64(new I(t.price),t.mintA.decimals,t.mintB.decimals),c,u,o,a),[m,f]=[ke(d.amountA,(b=t.mintA.extensions)==null?void 0:b.feeConfig,e,!0),ke(d.amountB,(y=t.mintB.extensions)==null?void 0:y.feeConfig,e,!0)],[g,p]=[ke(d.amountA.muln(l),(A=t.mintA.extensions)==null?void 0:A.feeConfig,e,!0),ke(d.amountB.muln(l),(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)];return{liquidity:o,amountA:m,amountB:f,amountSlippageA:g,amountSlippageB:p,expirationTime:ft(m.expirationTime,f.expirationTime)}}};var E=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(ce)||(o=o.add(Ke)),o}static mulDivFloor(e,t,n){if(n.eq(ce))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ce))throw new Error("division by 0");return e.mul(t).add(n.sub(Ke)).div(n)}static x64ToDecimal(e,t){return new I(e.toString()).div(I.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new _(e.mul(I.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(dn).sub(t).mod(dn)}};function fe(i,e){return Yn(i.mul(e),64,256)}function cs(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Yn(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var F=class{static sqrtPriceX64ToPrice(e,t,n){return E.x64ToDecimal(e).pow(2).mul(I.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return E.decimalToX64(e.mul(I.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(ce))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ce))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(ce))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ce))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(ce))return e;let o=t.shln(_t);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?E.mulDivCeil(s,e,a):E.mulDivRoundingUp(s,Ke,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return E.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(_t);if(r)return e.add(o.div(t));{let s=E.mulDivRoundingUp(o,Ke,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Te||e>xe)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new _("18445821805675395072"):new _("18446744073709551616");return(t&2)!=0&&(n=fe(n,new _("18444899583751176192"))),(t&4)!=0&&(n=fe(n,new _("18443055278223355904"))),(t&8)!=0&&(n=fe(n,new _("18439367220385607680"))),(t&16)!=0&&(n=fe(n,new _("18431993317065453568"))),(t&32)!=0&&(n=fe(n,new _("18417254355718170624"))),(t&64)!=0&&(n=fe(n,new _("18387811781193609216"))),(t&128)!=0&&(n=fe(n,new _("18329067761203558400"))),(t&256)!=0&&(n=fe(n,new _("18212142134806163456"))),(t&512)!=0&&(n=fe(n,new _("17980523815641700352"))),(t&1024)!=0&&(n=fe(n,new _("17526086738831433728"))),(t&2048)!=0&&(n=fe(n,new _("16651378430235570176"))),(t&4096)!=0&&(n=fe(n,new _("15030750278694412288"))),(t&8192)!=0&&(n=fe(n,new _("12247334978884435968"))),(t&16384)!=0&&(n=fe(n,new _("8131365268886854656"))),(t&32768)!=0&&(n=fe(n,new _("3584323654725218816"))),(t&65536)!=0&&(n=fe(n,new _("696457651848324352"))),(t&131072)!=0&&(n=fe(n,new _("26294789957507116"))),(t&262144)!=0&&(n=fe(n,new _("37481735321082"))),e>0&&(n=Oi.div(n)),n}static getTickFromPrice(e,t,n){return F.getTickFromSqrtPriceX64(F.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(ot)||e.lt(rt))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new _(t-64),r=cs(n,32,128),o=new _("8000000000000000","hex"),s=0,a=new _(0),c=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new _(0))&&s<Fi;){c=c.mul(c);let g=c.shrn(127);c=c.shrn(63+g.toNumber()),a=a.add(o.mul(g)),o=o.shrn(1),s+=1}let u=a.shrn(32),d=r.add(u).mul(new _(Di)),m=Yn(d.sub(new _(_i)),64,128).toNumber(),f=Yn(d.add(new _(vi)),64,128).toNumber();return m==f?m:F.getSqrtPriceX64FromTick(f).lte(e)?f:m}},bt=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=F.getTickFromSqrtPriceX64(F.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=bt.getTickWithPriceAndTickspacing(e,t,n,r),s=F.getSqrtPriceX64FromTick(o);return F.sqrtPriceX64ToPrice(s,n,r)}},G=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ce))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(_t),s=t.sub(e);return r?E.mulDivRoundingUp(E.mulDivCeil(o,s,t),Ke,e):E.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ce))throw new Error("sqrtPriceX64A must greater than 0");return r?E.mulDivCeil(n,t.sub(e),Ce):E.mulDivFloor(n,t.sub(e),Ce)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?E.mulDivRoundingUp(a,Ke,Wn):a.shrn(_t)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),E.mulDivFloor(n,Wn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return G.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=G.getLiquidityFromTokenAmountA(e,n,r,!1),a=G.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return G.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:G.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new _(0)};if(e.lt(n)){let s=G.getTokenAmountAFromLiquidity(e,n,r,o),a=G.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new _(0),amountB:G.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:c,amountB:u}=G.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,d=new _(new I(c.toString()).mul(l).toFixed(0)),m=new _(new I(u.toString()).mul(l).toFixed(0));return{amountSlippageA:d,amountSlippageB:m}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:c}){var A,w,P,h;let u=F.priceToSqrtPriceX64(new I(e.price),e.mintA.decimals,e.mintB.decimals),l=F.getSqrtPriceX64FromTick(t),d=F.getSqrtPriceX64FromTick(n),m=s?1+o:1-o,f=G.getAmountsFromLiquidity(u,l,d,r,s),[g,p]=[ke(f.amountA,(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,c),ke(f.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,a,c)],[b,y]=[ke(new _(new I(f.amountA.toString()).mul(m).toFixed(0)),(P=e.mintA.extensions)==null?void 0:P.feeConfig,a,c),ke(new _(new I(f.amountB.toString()).mul(m).toFixed(0)),(h=e.mintB.extensions)==null?void 0:h.feeConfig,a,c)];return{liquidity:r,amountA:g,amountB:p,amountSlippageA:b,amountSlippageB:y,expirationTime:ft(g.expirationTime,p.expirationTime)}}},yt=class{static swapCompute(e,t,n,r,o,s,a,c,u,l,d,m,f,g){if(m.eq(ce))throw new Error("amountSpecified must not be 0");if(g||(g=s?rt.add(Ke):ot.sub(Ke)),s){if(g.lt(rt))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(g.gte(d))throw new Error("sqrtPriceX64 must smaller than current")}else{if(g.gt(ot))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(g.lte(d))throw new Error("sqrtPriceX64 must greater than current")}let p=m.gt(ce),b={amountSpecifiedRemaining:m,amountCalculated:ce,sqrtPriceX64:d,tick:u>f?Math.min(f+U.tickCount(l)-1,u):f,accounts:[],liquidity:c,feeAmount:new _(0)},y=f,A=n[f],w=0,P=!s&&A.startTickIndex===b.tick;for(;!b.amountSpecifiedRemaining.eq(ce)&&!b.sqrtPriceX64.eq(g);){if(w>10)throw Error("liquidity limit");let h={};h.sqrtPriceStartX64=b.sqrtPriceX64;let T=S.nextInitTick(A,b.tick,l,s,P),B=T||null,K=null;if(!(B!=null&&B.liquidityGross.gtn(0))){let W=we.nextInitializedTickArrayStartIndex({tickCurrent:b.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},y,s);if(!W.isExist)throw Error("swapCompute LiquidityInsufficient");y=W.nextStartIndex;let{publicKey:v}=j(e,t,y);K=v,A=n[y],B=S.firstInitializedTick(A,s)}h.tickNext=B.tick,h.initialized=B.liquidityGross.gtn(0),f!==y&&K&&(b.accounts.push(K),f=y),h.tickNext<Te?h.tickNext=Te:h.tickNext>xe&&(h.tickNext=xe),h.sqrtPriceNextX64=F.getSqrtPriceX64FromTick(h.tickNext);let D;if(s&&h.sqrtPriceNextX64.lt(g)||!s&&h.sqrtPriceNextX64.gt(g)?D=g:D=h.sqrtPriceNextX64,[b.sqrtPriceX64,h.amountIn,h.amountOut,h.feeAmount]=yt.swapStepCompute(b.sqrtPriceX64,D,b.liquidity,b.amountSpecifiedRemaining,a),b.feeAmount=b.feeAmount.add(h.feeAmount),p?(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.sub(h.amountIn.add(h.feeAmount)),b.amountCalculated=b.amountCalculated.sub(h.amountOut)):(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.add(h.amountOut),b.amountCalculated=b.amountCalculated.add(h.amountIn.add(h.feeAmount))),b.sqrtPriceX64.eq(h.sqrtPriceNextX64)){if(h.initialized){let W=B.liquidityNet;s&&(W=W.mul(Ye)),b.liquidity=G.addDelta(b.liquidity,W)}P=h.tickNext!=b.tick&&!s&&A.startTickIndex===h.tickNext,b.tick=s?h.tickNext-1:h.tickNext}else if(b.sqrtPriceX64!=h.sqrtPriceStartX64){let W=F.getTickFromSqrtPriceX64(b.sqrtPriceX64);P=W!=b.tick&&!s&&A.startTickIndex===W,b.tick=W}++w}try{let{nextStartIndex:h,isExist:T}=U.nextInitializedTickArray(b.tick,l,s,r,o);T&&f!==h&&(b.accounts.push(j(e,t,h).publicKey),f=h)}catch{}return{amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new _(0),amountIn:new _(0),amountOut:new _(0),feeAmount:new _(0)},a=e.gte(t),c=r.gte(ce);if(c){let l=E.mulDivFloor(r,mn.sub(new _(o.toString())),mn);s.amountIn=a?G.getTokenAmountAFromLiquidity(t,e,n,!0):G.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=F.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?G.getTokenAmountBFromLiquidity(t,e,n,!1):G.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(Ye).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=F.getNextSqrtPriceX64FromOutput(e,n,r.mul(Ye),a);let u=t.eq(s.sqrtPriceX64Next);return a?(u&&c||(s.amountIn=G.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),u&&!c||(s.amountOut=G.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=u&&c?s.amountIn:G.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=u&&!c?s.amountOut:G.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!c&&s.amountOut.gt(r.mul(Ye))&&(s.amountOut=r.mul(Ye)),c&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=E.mulDivCeil(s.amountIn,new _(o),mn.sub(new _(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};import{TOKEN_PROGRAM_ID as he,TOKEN_2022_PROGRAM_ID as ut,ASSOCIATED_TOKEN_PROGRAM_ID as cr}from"@solana/spl-token";import{PublicKey as x,TransactionInstruction as ve,SystemProgram as Bt,Keypair as ti}from"@solana/web3.js";import ur from"bn.js";import{PublicKey as ps,Keypair as gs}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as bs}from"@solana/spl-token";import xm from"bn.js";var us=Y([$("mint"),$("owner"),L("amount"),Qe("delegateOption"),$("delegate"),ie("state"),Qe("isNativeOption"),L("isNative"),L("delegatedAmount"),Qe("closeAuthorityOption"),$("closeAuthority")]);function ls(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}function Qn(i,...e){if(!ls(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}function $n(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function nr(i,e){Qn(i);let t=e.outputLen;if(i.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var yn=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),_e=(i,e)=>i<<32-e|i>>>e;var um=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ds(i){if(typeof i!="string")throw new Error(`utf8ToBytes expected string, got ${typeof i}`);return new Uint8Array(new TextEncoder().encode(i))}function Jn(i){return typeof i=="string"&&(i=ds(i)),Qn(i),i}var bn=class{clone(){return this._cloneInto()}},lm={}.toString;function ir(i){let e=n=>i().update(Jn(n)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function ms(i,e,t,n){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,n);let r=BigInt(32),o=BigInt(4294967295),s=Number(t>>r&o),a=Number(t&o),c=n?4:0,u=n?0:4;i.setUint32(e+c,s,n),i.setUint32(e+u,a,n)}var rr=(i,e,t)=>i&e^~i&t,or=(i,e,t)=>i&e^i&t^e&t,wn=class extends bn{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=yn(this.buffer)}update(e){$n(this);let{view:t,buffer:n,blockLen:r}=this;e=Jn(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(r-this.pos,o-s);if(a===r){let c=yn(e);for(;r<=o-s;s+=r)this.process(c,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){$n(this),nr(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let d=s;d<r;d++)t[d]=0;ms(n,r-8,BigInt(this.length*8),o),this.process(n,0);let a=yn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<u;d++)a.setUint32(4*d,l[d],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:o,destroyed:s,pos:a}=this;return e.length=r,e.pos=a,e.finished=o,e.destroyed=s,r%t&&e.buffer.set(n),e}};var fs=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),at=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ct=new Uint32Array(64),ei=class extends wn{constructor(){super(64,32,8,!1),this.A=at[0]|0,this.B=at[1]|0,this.C=at[2]|0,this.D=at[3]|0,this.E=at[4]|0,this.F=at[5]|0,this.G=at[6]|0,this.H=at[7]|0}get(){let{A:e,B:t,C:n,D:r,E:o,F:s,G:a,H:c}=this;return[e,t,n,r,o,s,a,c]}set(e,t,n,r,o,s,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=c|0}process(e,t){for(let d=0;d<16;d++,t+=4)ct[d]=e.getUint32(t,!1);for(let d=16;d<64;d++){let m=ct[d-15],f=ct[d-2],g=_e(m,7)^_e(m,18)^m>>>3,p=_e(f,17)^_e(f,19)^f>>>10;ct[d]=p+ct[d-7]+g+ct[d-16]|0}let{A:n,B:r,C:o,D:s,E:a,F:c,G:u,H:l}=this;for(let d=0;d<64;d++){let m=_e(a,6)^_e(a,11)^_e(a,25),f=l+m+rr(a,c,u)+fs[d]+ct[d]|0,p=(_e(n,2)^_e(n,13)^_e(n,22))+or(n,r,o)|0;l=u,u=c,c=a,a=s+f|0,s=o,o=r,r=n,n=f+p|0}n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,r,o,s,a,c,u,l)}roundClean(){ct.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var sr=ir(()=>new ei);var Nm=le("Raydium_Util");function ar({fromPublicKey:i,programId:e=bs}){let t=gs.generate().publicKey.toBase58().slice(0,32);return{publicKey:ys(i,t,e),seed:t}}function ys(i,e,t){let n=Buffer.concat([i.toBuffer(),Buffer.from(e),t.toBuffer()]),r=sr(n);return new ps(r)}var lr=le("Raydium_Clmm"),qe={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},pe=class{static createPoolInstruction(e,t,n,r,o,s,a,c,u,l,d,m,f,g){let p=Y([V("sqrtPriceX64"),L("startTime")]),b=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:Bt.programId,isSigner:!1,isWritable:!1},{pubkey:Nt,isSigner:!1,isWritable:!1}],y=Buffer.alloc(p.span);p.encode({sqrtPriceX64:f,startTime:g},y);let A=Buffer.from([...qe.createPool,...y]);return new ve({keys:b,programId:e,data:A})}static async createPoolInstructions(e){let{connection:t,programId:n,owner:r,mintA:o,mintB:s,ammConfigId:a,initialPriceX64:c,startTime:u,forerunCreate:l}=e,d=ar({fromPublicKey:r,programId:n}),[m,f]=[new x(o.address),new x(s.address)],g=[Bt.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:d.seed,newAccountPubkey:d.publicKey,lamports:l?0:await t.getMinimumBalanceForRentExemption(Zn.span),space:Zn.span,programId:n})],{publicKey:p}=Gi(n,a,m,f),{publicKey:b}=Gn(n,p,m),{publicKey:y}=Gn(n,p,f);return g.push(this.createPoolInstruction(n,p,r,a,d.publicKey,m,b,new x(o.programId||he),f,y,new x(s.programId||he),st(n,p).publicKey,c,u)),{signers:[],instructions:g,instructionTypes:[se.CreateAccount,se.ClmmCreatePool],address:{poolId:p,observationId:d.publicKey,mintAVault:b,mintBVault:y},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,d,m,f,g,p,b,y,A,w,P,h,T,B,K,D,W){let v=Y([ye("tickLowerIndex"),ye("tickUpperIndex"),ye("tickArrayLowerStartIndex"),ye("tickArrayUpperStartIndex"),V("liquidity"),L("amountMaxA"),L("amountMaxB"),Xe("withMetadata"),ie("optionBaseFlag"),Xe("baseFlag")]),me=[...W?[{pubkey:W,isSigner:!1,isWritable:!0}]:[]],oe=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:Nt,isSigner:!1,isWritable:!1},{pubkey:Bt.programId,isSigner:!1,isWritable:!1},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:cr,isSigner:!1,isWritable:!1},{pubkey:At,isSigner:!1,isWritable:!1},{pubkey:ut,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...me],Be=Buffer.alloc(v.span);v.encode({tickLowerIndex:A,tickUpperIndex:w,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:h,liquidity:T,amountMaxA:B,amountMaxB:K,withMetadata:D==="create",baseFlag:!1,optionBaseFlag:0},Be);let J=Buffer.from([...qe.openPosition,...Be]);return new ve({keys:oe,programId:e,data:J})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l}){let d=[],[m,f]=[new x(e.programId),new x(e.id)],g;if(l)g=new x((await l(1))[0]);else{let K=ti.generate();d.push(K),g=K.publicKey}let p=S.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=S.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:y}=j(m,f,p),{publicKey:A}=j(m,f,b),{publicKey:w}=De(n.wallet,g,he),{publicKey:P}=pn(g),{publicKey:h}=Ge(m,g),{publicKey:T}=pt(m,f,r,o),B=this.openPositionFromLiquidityInstruction(m,n.feePayer,f,n.wallet,g,w,P,T,y,A,h,n.tokenAccountA,n.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),r,o,p,b,s,a,c,u);return{signers:d,instructions:[B],instructionTypes:[se.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:g,tickArrayLower:y,tickArrayUpper:A,positionNftAccount:w,metadataAccount:P,personalPosition:h,protocolPosition:T}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:u,getEphemeralSigners:l}){let d=[],[m,f]=[new x(e.programId),new x(e.id)],g;if(l)g=new x((await l(1))[0]);else{let K=ti.generate();d.push(K),g=K.publicKey}let p=S.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=S.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:y}=j(m,f,p),{publicKey:A}=j(m,f,b),{publicKey:w}=De(n.wallet,g,he),{publicKey:P}=pn(g),{publicKey:h}=Ge(m,g),{publicKey:T}=pt(m,f,r,o),B=this.openPositionFromBaseInstruction(m,n.feePayer,f,n.wallet,g,w,P,T,y,A,h,n.tokenAccountA,n.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),r,o,p,b,u,s,a,c,we.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,b])?st(m,f).publicKey:void 0);return{address:{nftMint:g,tickArrayLower:y,tickArrayUpper:A,positionNftAccount:w,metadataAccount:P,personalPosition:h,protocolPosition:T},instructions:[B],signers:d,instructionTypes:[se.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,d,m,f,g,p,b,y,A,w,P,h,T,B,K,D,W){let v=Y([ye("tickLowerIndex"),ye("tickUpperIndex"),ye("tickArrayLowerStartIndex"),ye("tickArrayUpperStartIndex"),V("liquidity"),L("amountMaxA"),L("amountMaxB"),Xe("withMetadata"),ie("optionBaseFlag"),Xe("baseFlag")]),me=[...W?[{pubkey:W,isSigner:!1,isWritable:!0}]:[]],oe=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:Nt,isSigner:!1,isWritable:!1},{pubkey:Bt.programId,isSigner:!1,isWritable:!1},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:cr,isSigner:!1,isWritable:!1},{pubkey:At,isSigner:!1,isWritable:!1},{pubkey:ut,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...me],Be=Buffer.alloc(v.span);v.encode({tickLowerIndex:A,tickUpperIndex:w,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:h,liquidity:new ur(0),amountMaxA:B==="MintA"?K:D,amountMaxB:B==="MintA"?D:K,withMetadata:T==="create",baseFlag:B==="MintA",optionBaseFlag:1},Be);let J=Buffer.from([...qe.openPosition,...Be]);return new ve({keys:oe,programId:e,data:J})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l}){let d,m=[];if(l)d=new x((await l(1))[0]);else{let K=ti.generate();m.push(K),d=K.publicKey}let[f,g]=[new x(e.programId),new x(e.id)],p=S.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=S.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:y}=j(f,g,p),{publicKey:A}=j(f,g,b),{publicKey:w}=De(n.wallet,d,he),{publicKey:P}=pn(d),{publicKey:h}=Ge(f,d),{publicKey:T}=pt(f,g,r,o),B=this.openPositionFromLiquidityInstruction(f,n.wallet,g,n.wallet,d,w,P,T,y,A,h,n.tokenAccountA,n.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(t.mintA.address),new x(t.mintB.address),r,o,p,b,s,a,c,u,we.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,b])?st(f,g).publicKey:void 0);return{address:{nftMint:d,tickArrayLower:y,tickArrayUpper:A,positionNftAccount:w,metadataAccount:P,personalPosition:h,protocolPosition:T},instructions:[B],signers:m,instructionTypes:[se.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=Y([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:Bt.programId,isSigner:!1,isWritable:!1},{pubkey:he,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);s.encode({},c);let u=Buffer.from([...qe.closePosition,...c]);return new ve({keys:a,programId:e,data:u})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new x(e.programId),{publicKey:s}=De(n.wallet,r.nftMint,he),{publicKey:a}=Ge(o,r.nftMint),c=[];return c.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:c,instructionTypes:[se.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,d,m,f,g,p,b,y,A){let w=Y([V("liquidity"),L("amountMaxA"),L("amountMaxB"),ie("optionBaseFlag"),Xe("baseFlag")]),P=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:ut,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...P],T=Buffer.alloc(w.span);w.encode({liquidity:p,amountMaxA:b,amountMaxB:y,optionBaseFlag:0,baseFlag:!1},T);let B=Buffer.from([...qe.increaseLiquidity,...T]);return new ve({keys:h,programId:e,data:B})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[c,u]=[new x(e.programId),new x(e.id)],l=S.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=S.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:m}=j(c,u,l),{publicKey:f}=j(c,u,d),{publicKey:g}=De(r.wallet,n.nftMint,he),{publicKey:p}=Ge(c,n.nftMint),{publicKey:b}=pt(c,u,n.tickLower,n.tickUpper),y=this.increasePositionFromLiquidityInstruction(c,r.wallet,g,p,u,b,m,f,r.tokenAccountA,r.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),o,s,a,we.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,d])?st(c,u).publicKey:void 0);return{address:{tickArrayLower:m,tickArrayUpper:f,positionNftAccount:g,personalPosition:p,protocolPosition:b},signers:[],instructions:[y],instructionTypes:[se.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[c,u]=[new x(e.programId),new x(e.id)],l=S.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=S.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:m}=j(c,u,l),{publicKey:f}=j(c,u,d),{publicKey:g}=De(r.wallet,n.nftMint,he),{publicKey:p}=Ge(c,n.nftMint),{publicKey:b}=pt(c,u,n.tickLower,n.tickUpper);return{address:{tickArrayLower:m,tickArrayUpper:f,positionNftAccount:g,personalPosition:p,protocolPosition:b},instructions:[this.increasePositionFromBaseInstruction(c,r.wallet,g,p,u,b,m,f,r.tokenAccountA,r.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),o,s,a,we.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,d])?st(c,u).publicKey:void 0)],signers:[],instructionTypes:[se.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,d,m,f,g,p,b,y,A){let w=Y([V("liquidity"),L("amountMaxA"),L("amountMaxB"),ie("optionBaseFlag"),Xe("baseFlag")]),P=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:ut,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...P],T=Buffer.alloc(w.span);w.encode({liquidity:new ur(0),amountMaxA:p==="MintA"?b:y,amountMaxB:p==="MintA"?y:b,baseFlag:p==="MintA",optionBaseFlag:1},T);let B=Buffer.from([...qe.increaseLiquidity,...T]);return new ve({keys:h,programId:e,data:B})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,d,m,f,g,p,b,y,A,w){let P=Y([V("liquidity"),L("amountMinA"),L("amountMinB")]),h=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...p.map(D=>[{pubkey:D.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:D.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:D.rewardMint,isSigner:!1,isWritable:!1}]).flat()],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:ut,isSigner:!1,isWritable:!1},{pubkey:en,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...h],B=Buffer.alloc(P.span);P.encode({liquidity:b,amountMinA:y,amountMinB:A},B);let K=Buffer.from([...qe.decreaseLiquidity,...B]);return new ve({keys:T,programId:e,data:K})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:c}){let[u,l]=[new x(e.programId),new x(e.id)],d=S.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=S.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:f}=j(u,l,d),{publicKey:g}=j(u,l,m),{publicKey:p}=De(r.wallet,n.nftMint,c),{publicKey:b}=Ge(u,n.nftMint),{publicKey:y}=pt(u,l,n.tickLower,n.tickUpper),A=[];for(let P=0;P<e.rewardDefaultInfos.length;P++)A.push({poolRewardVault:new x(t.rewardInfos[P].vault),ownerRewardVault:r.rewardAccounts[P],rewardMint:new x(e.rewardDefaultInfos[P].mint.address)});let w=[];return w.push(this.decreaseLiquidityInstruction(u,r.wallet,p,b,l,y,f,g,r.tokenAccountA,r.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),A,o,s,a,we.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[d,m])?st(u,l).publicKey:void 0)),{address:{tickArrayLower:f,tickArrayUpper:g,positionNftAccount:p,personalPosition:b,protocolPosition:y},signers:[],instructions:w,instructionTypes:[se.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,c,u,l,d,m,f,g,p,b,y){let A=Y([L("amount"),L("otherAmountThreshold"),V("sqrtPriceLimitX64"),Xe("isBaseInput")]),w=[...y?[{pubkey:y,isSigner:!1,isWritable:!0}]:[],...d.map(B=>({pubkey:B,isSigner:!1,isWritable:!0}))],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:ut,isSigner:!1,isWritable:!1},{pubkey:en,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...w],h=Buffer.alloc(A.span);A.encode({amount:f,otherAmountThreshold:g,sqrtPriceLimitX64:p,isBaseInput:b},h);let T=Buffer.from([...qe.swap,...h]);return new ve({keys:P,programId:e,data:T})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,inputMint:r,amountIn:o,amountOutMin:s,sqrtPriceLimitX64:a,remainingAccounts:c}){let[u,l]=[new x(e.programId),new x(e.id)],[d,m]=[new x(t.vault.A),new x(t.vault.B)],[f,g]=[new x(e.mintA.address),new x(e.mintB.address)],p=e.mintA.address===r.toString(),b=[this.swapInstruction(u,n.wallet,l,new x(e.config.id),p?n.tokenAccountA:n.tokenAccountB,p?n.tokenAccountB:n.tokenAccountA,p?d:m,p?m:d,p?f:g,p?g:f,c,d,o,s,a,!0,st(u,l).publicKey)];return{signers:[],instructions:b,instructionTypes:[se.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,c,u,l,d,m){let f=Y([L("openTime"),L("endTime"),V("emissionsPerSecondX64")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Bt.programId,isSigner:!1,isWritable:!1},{pubkey:Nt,isSigner:!1,isWritable:!1}],p=Buffer.alloc(f.span);f.encode({openTime:be(l),endTime:be(d),emissionsPerSecondX64:m},p);let b=Buffer.from([...qe.initReward,...p]);return new ve({keys:g,programId:e,data:b})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new x(e.programId),new x(e.id)],a=Xi(o,s,r.mint).publicKey,c=qt(o).publicKey,u=[this.initRewardInstruction(o,n.wallet,s,c,new x(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:c},signers:[],instructions:u,instructionTypes:[se.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,c,u,l,d,m){let f=Y([ie("rewardIndex"),V("emissionsPerSecondX64"),L("openTime"),L("endTime")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:ut,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0}],p=Buffer.alloc(f.span);f.encode({rewardIndex:u,emissionsPerSecondX64:m,openTime:be(l),endTime:be(d)},p);let b=Buffer.from([...qe.setRewardEmissions,...p]);return new ve({keys:g,programId:e,data:b})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new x(e.programId),new x(e.id)],a,c,u;for(let m=0;m<e.rewardDefaultInfos.length;m++)e.rewardDefaultInfos[m].mint.address===r.mint.toString()&&(a=m,c=new x(t.rewardInfos[m].vault),u=new x(t.rewardInfos[m].mint.address));(a===void 0||c===void 0)&&lr.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=qt(o).publicKey,d=[this.setRewardInstruction(o,n.wallet,s,l,new x(e.config.id),n.tokenAccount,c,u,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:c,operationId:l},signers:[],instructions:d,instructionTypes:[se.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let c=Y([ie("rewardIndex")]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:ut,isSigner:!1,isWritable:!1},{pubkey:en,isSigner:!1,isWritable:!1}],l=Buffer.alloc(c.span);c.encode({rewardIndex:a},l);let d=Buffer.from([...qe.collectReward,...l]);return new ve({keys:u,programId:e,data:d})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new x(e.programId),new x(e.id)],a,c;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,c=new x(t.rewardInfos[l].vault));(a===void 0||c===void 0)&&lr.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let u=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,c,r,a)];return{address:{rewardVault:c},signers:[],instructions:u,instructionTypes:[se.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapBaseOutInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,outputMint:r,amountOut:o,amountInMax:s,sqrtPriceLimitX64:a,remainingAccounts:c}){let[u,l]=[new x(e.programId),new x(e.id)],[d,m]=[new x(t.vault.A),new x(t.vault.B)],[f,g]=[new x(e.mintA.address),new x(e.mintB.address)],p=e.mintA.address===r.toString(),b=[this.swapInstruction(u,n.wallet,l,new x(e.config.id),p?n.tokenAccountB:n.tokenAccountA,p?n.tokenAccountA:n.tokenAccountB,p?m:d,p?d:m,p?f:g,p?g:f,c,d,o,s,a,!1)];return{signers:[],instructions:b,instructionTypes:[se.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}};import Me from"bn.js";var dr=class extends Dt{constructor(e){super(e)}async load(e){await this.scope.token.load(e)}async createPool(e){var A;let{programId:t,owner:n=((A=this.scope.owner)==null?void 0:A.publicKey)||X.default,mint1:r,mint2:o,ammConfig:s,initialPrice:a,startTime:c,computeBudgetConfig:u,forerunCreate:l,txVersion:d}=e,m=this.createTxBuilder(),[f,g,p]=new Me(new X(r.address).toBuffer()).gt(new Me(new X(o.address).toBuffer()))?[o,r,new I(1).div(a)]:[r,o,a],b=F.priceToSqrtPriceX64(p,f.decimals,g.decimals),y=await pe.createPoolInstructions({connection:this.scope.connection,programId:t,owner:n,mintA:f,mintB:g,ammConfigId:s.id,initialPriceX64:b,startTime:c,forerunCreate:l});return m.addInstruction(y),m.addCustomComputeBudget(u),m.versionBuild({txVersion:d,extInfo:{address:ee(q({},y.address),{programId:t.toString(),id:y.address.poolId.toString(),mintA:f,mintB:g,openTime:c.toNumber(),vault:{A:y.address.mintAVault.toString(),B:y.address.mintBVault.toString()},rewardInfos:[],config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}}),mockPoolInfo:q({type:"Concentrated",rewardDefaultPoolInfos:"Clmm",id:y.address.poolId.toString(),mintA:f,mintB:g,feeRate:s.tradeFeeRate,openTime:c.toNumber(),programId:t.toString(),price:p.toNumber(),config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}},qi),forerunCreate:l}})}async openPositionFromBase({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:d="create",getEphemeralSigners:m,computeBudgetConfig:f,txVersion:g}){this.scope.availability.addConcentratedPosition===!1&&this.logAndCreateError("add position feature disabled in your region"),this.scope.checkOwner();let p=this.createTxBuilder(),b=null,y=null,A=n.useSOLBalance&&e.mintA.address===Q.toString(),w=n.useSOLBalance&&e.mintB.address===Q.toString(),[P,h]=s==="MintA"?[a,c]:[c,a],{account:T,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new X(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:A||P.isZero()?{payer:this.scope.ownerPubKey,amount:P}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:u,checkCreateATAOwner:l});T&&(b=T),p.addInstruction(B||{});let{account:K,instructionParams:D}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new X(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:w||h.isZero()?{payer:this.scope.ownerPubKey,amount:h}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:u,checkCreateATAOwner:l});K&&(y=K),p.addInstruction(D||{}),(!b||!y)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let W=t||await this.scope.api.fetchPoolKeysById({id:e.id}),v=await pe.openPositionFromBaseInstructions({poolInfo:e,poolKeys:W,ownerInfo:ee(q({},n),{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:b,tokenAccountB:y}),tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:d,getEphemeralSigners:m});return p.addInstruction(v),p.addCustomComputeBudget(f),p.versionBuild({txVersion:g,extInfo:v.address})}async openPositionFromLiquidity({poolInfo:e,poolKeys:t,ownerInfo:n,amountMaxA:r,amountMaxB:o,tickLower:s,tickUpper:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:d="create",txVersion:m,getEphemeralSigners:f}){this.scope.availability.createConcentratedPosition===!1&&this.logAndCreateError("open position feature disabled in your region");let g=this.createTxBuilder(),p=null,b=null,y=n.useSOLBalance&&e.mintA.address===Q.toBase58(),A=n.useSOLBalance&&e.mintB.address===Q.toBase58(),{account:w,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new X(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:y?{payer:this.scope.ownerPubKey,amount:r}:void 0,skipCloseAccount:!y,notUseTokenAccount:y,associatedOnly:y?!1:u,checkCreateATAOwner:l});w&&(p=w),g.addInstruction(P||{});let{account:h,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new X(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:A?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:u,checkCreateATAOwner:l});h&&(b=h),g.addInstruction(T||{}),(p===void 0||b===void 0)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let B=t||await this.scope.api.fetchPoolKeysById({id:e.id}),K=await pe.openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:B,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:b},tickLower:s,tickUpper:a,liquidity:c,amountMaxA:r,amountMaxB:o,withMetadata:d,getEphemeralSigners:f});return g.addInstruction(K),g.versionBuild({txVersion:m,extInfo:{address:K.address}})}async increasePositionFromLiquidity(e){let{poolInfo:t,ownerPosition:n,amountMaxA:r,amountMaxB:o,liquidity:s,ownerInfo:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txVersion:d}=e,m=this.createTxBuilder(),f,g,p=a.useSOLBalance&&t.mintA.address===Q.toString(),b=a.useSOLBalance&&t.mintB.address===Q.toString(),{account:y,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new X(t.mintA.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,createInfo:p?{payer:this.scope.ownerPubKey,amount:r}:void 0,skipCloseAccount:!p,associatedOnly:p?!1:c,checkCreateATAOwner:u});y&&(f=y),m.addInstruction(A||{});let{account:w,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({mint:new X(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:b?{payer:this.scope.ownerPubKey,amount:o}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:c,checkCreateATAOwner:u});w&&(g=w),m.addInstruction(P||{}),!f&&!g&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let h=await this.scope.api.fetchPoolKeysById({id:t.id}),T=pe.increasePositionFromLiquidityInstructions({poolInfo:t,poolKeys:h,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:g},liquidity:s,amountMaxA:r,amountMaxB:o});return m.addInstruction(T),m.addCustomComputeBudget(l),m.versionBuild({txVersion:d,extInfo:{address:T.address}})}async increasePositionFromBase(e){let{poolInfo:t,ownerPosition:n,base:r,baseAmount:o,otherAmountMax:s,ownerInfo:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txVersion:d}=e,m=this.createTxBuilder(),f,g,p=a.useSOLBalance&&t.mintA.address===Q.toString(),b=a.useSOLBalance&&t.mintB.address===Q.toString(),{account:y,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new X(t.mintA.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,createInfo:p?{payer:this.scope.ownerPubKey,amount:r==="MintA"?o:s}:void 0,skipCloseAccount:!p,associatedOnly:p?!1:c,checkCreateATAOwner:u});y&&(f=y),m.addInstruction(A||{});let{account:w,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({mint:new X(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:b?{payer:this.scope.ownerPubKey,amount:r==="MintA"?s:o}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:c,checkCreateATAOwner:u});w&&(g=w),m.addInstruction(P||{}),!f&&!g&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let h=await this.scope.api.fetchPoolKeysById({id:t.id}),T=pe.increasePositionFromBaseInstructions({poolInfo:t,poolKeys:h,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:g},base:r,baseAmount:o,otherAmountMax:s});return m.addInstruction(T),m.addCustomComputeBudget(l),m.versionBuild({txVersion:d,extInfo:{address:T.address}})}async decreaseLiquidity(e){let{poolInfo:t,ownerPosition:n,ownerInfo:r,amountMinA:o,amountMinB:s,liquidity:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txVersion:d}=e;this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let m=this.createTxBuilder(),f=r.useSOLBalance&&t.mintA.address===Q.toString(),g=r.useSOLBalance&&t.mintB.address===Q.toString(),p,b,{account:y,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new X(t.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!f,associatedOnly:f?!1:c,checkCreateATAOwner:u});p=y,A&&m.addInstruction(A);let{account:w,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new X(t.mintB.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!g,associatedOnly:g?!1:c,checkCreateATAOwner:u});b=w,P&&m.addInstruction(P);let h=[];for(let D of t.rewardDefaultInfos){let W=r.useSOLBalance&&D.mint.address===Q.toString(),v;if(D.mint.address===t.mintA.address)v=p;else if(D.mint.address===t.mintB.address)v=b;else{let{account:me,instructionParams:oe}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X(D.mint.programId),mint:new X(D.mint.address),notUseTokenAccount:W,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!W,associatedOnly:W?!1:c,checkCreateATAOwner:u});v=me,oe&&m.addInstruction(oe)}h.push(v)}!p&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccountRawInfos);let T=await this.scope.api.fetchPoolKeysById({id:t.id}),B=await pe.decreaseLiquidityInstructions({poolInfo:t,poolKeys:T,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:b,rewardAccounts:h},liquidity:a,amountMinA:o,amountMinB:s});m.addInstruction({instructions:B.instructions,instructionTypes:[se.ClmmDecreasePosition]});let K=q({},B.address);if(r.closePosition){let D=await pe.closePositionInstructions({poolInfo:t,poolKeys:T,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:n});m.addInstruction({endInstructions:D.instructions,endInstructionTypes:D.instructionTypes}),K=q(q({},K),D.address)}return m.addCustomComputeBudget(l),m.versionBuild({txVersion:d,extInfo:{address:K}})}async closePosition({poolInfo:e,ownerPosition:t,txVersion:n}){this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let r=this.createTxBuilder(),o=await this.scope.api.fetchPoolKeysById({id:e.id}),s=pe.closePositionInstructions({poolInfo:e,poolKeys:o,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:t});return r.addInstruction(s).versionBuild({txVersion:n,extInfo:{address:s.address}})}async initReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.address.toString()===Q.toString(),l=n.perSecond.mul(n.endTime-n.openTime),{account:d,instructionParams:m}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X(n.mint.address),mint:new X(n.mint.address),notUseTokenAccount:!!u,skipCloseAccount:!u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Me(new I(l.toFixed(0)).gte(l)?l.toFixed(0):l.add(1).toFixed(0))}:void 0,associatedOnly:u?!1:r,checkCreateATAOwner:o});m&&c.addInstruction(m),d||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let f=await this.scope.api.fetchPoolKeysById({id:e.id}),g=pe.initRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:d},rewardInfo:{programId:new X(n.mint.programId),mint:new X(n.mint.address),openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:E.decimalToX64(n.perSecond)}});return c.addInstruction(g),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:g.address}})}async initRewards({poolInfo:e,ownerInfo:t,rewardInfos:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){for(let l of n)l.endTime<=l.openTime&&this.logAndCreateError("reward time error","rewardInfo",l);let c=this.createTxBuilder(),u={};for(let l of n){let d=t.useSOLBalance&&l.mint.address===Q.toString(),m=l.perSecond.mul(l.endTime-l.openTime),{account:f,instructionParams:g}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X(l.mint.programId),mint:new X(l.mint.address),notUseTokenAccount:!!d,skipCloseAccount:!d,owner:this.scope.ownerPubKey,createInfo:d?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Me(new I(m.toFixed(0)).gte(m)?m.toFixed(0):m.add(1).toFixed(0))}:void 0,associatedOnly:d?!1:r,checkCreateATAOwner:o});g&&c.addInstruction(g),f||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let p=await this.scope.api.fetchPoolKeysById({id:e.id}),b=pe.initRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:f},rewardInfo:{programId:new X(l.mint.programId),mint:new X(l.mint.address),openTime:l.openTime,endTime:l.endTime,emissionsPerSecondX64:E.decimalToX64(l.perSecond)}});u=q(q({},u),b.address),c.addInstruction(b)}return c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:u}})}async setReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.equals(Q),{account:l,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.programId,mint:n.mint,notUseTokenAccount:u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Me(new I(n.perSecond.sub(n.endTime-n.openTime).toFixed(0)).gte(n.perSecond.sub(n.endTime-n.openTime))?n.perSecond.sub(n.endTime-n.openTime).toFixed(0):n.perSecond.sub(n.endTime-n.openTime).add(1).toFixed(0))}:void 0,associatedOnly:u?!1:r,checkCreateATAOwner:o});d&&c.addInstruction(d),l||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let m=await this.scope.api.fetchPoolKeysById({id:e.id}),f=pe.setRewardInstructions({poolInfo:e,poolKeys:m,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:l},rewardInfo:{mint:n.mint,openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:E.decimalToX64(n.perSecond)}});return c.addInstruction(f),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:f.address}})}async setRewards({poolInfo:e,ownerInfo:t,rewardInfos:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){let c=this.createTxBuilder(),u={};for(let l of n){l.endTime<=l.openTime&&this.logAndCreateError("reward time error","rewardInfo",l);let d=t.useSOLBalance&&l.mint.address===Q.toString(),{account:m,instructionParams:f}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X(l.mint.programId),mint:new X(l.mint.address),notUseTokenAccount:d,owner:this.scope.ownerPubKey,createInfo:d?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Me(new I(l.perSecond.sub(l.endTime-l.openTime).toFixed(0)).gte(l.perSecond.sub(l.endTime-l.openTime))?l.perSecond.sub(l.endTime-l.openTime).toFixed(0):l.perSecond.sub(l.endTime-l.openTime).add(1).toFixed(0))}:void 0,associatedOnly:d?!1:r,checkCreateATAOwner:o});f&&c.addInstruction(f),m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let g=await this.scope.api.fetchPoolKeysById({id:e.id}),p=pe.setRewardInstructions({poolInfo:e,poolKeys:g,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardInfo:{mint:new X(l.mint.address),openTime:l.openTime,endTime:l.endTime,emissionsPerSecondX64:E.decimalToX64(l.perSecond)}});c.addInstruction(p),u=q(q({},u),p.address)}return c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:u}})}async collectReward({poolInfo:e,ownerInfo:t,rewardMint:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1}){let s=e.rewardDefaultInfos.find(f=>f.mint.address===n.toString());s||this.logAndCreateError("reward mint error","not found reward mint",n);let a=this.createTxBuilder(),c=t.useSOLBalance&&n.equals(Q),{account:u,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X(s.mint.programId),mint:n,notUseTokenAccount:c,owner:this.scope.ownerPubKey,skipCloseAccount:!c,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:c?!1:r,checkCreateATAOwner:o});l&&a.addInstruction(l),u||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let d=await this.scope.api.fetchPoolKeysById({id:e.id}),m=pe.collectRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:u},rewardMint:n});return a.addInstruction(m),a.build({address:m.address})}async collectRewards({poolInfo:e,ownerInfo:t,rewardMints:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1}){let s=this.createTxBuilder(),a={};for(let c of n){let u=e.rewardDefaultInfos.find(p=>p.mint.address===c.toString());if(!u){this.logAndCreateError("reward mint error","not found reward mint",c);continue}let l=t.useSOLBalance&&c.equals(Q),{account:d,instructionParams:m}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X(u.mint.programId),mint:c,notUseTokenAccount:l,owner:this.scope.ownerPubKey,skipCloseAccount:!l,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:l?!1:r,checkCreateATAOwner:o});d||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos),m&&s.addInstruction(m);let f=await this.scope.api.fetchPoolKeysById({id:e.id}),g=pe.collectRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:d},rewardMint:c});s.addInstruction(g),a=q(q({},a),g.address)}return s.build({address:a})}async harvestAllRewards({allPoolInfo:e,allPositions:t,ownerInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,programId:s,txVersion:a,computeBudgetConfig:c}){let u={};for(let d of this.scope.account.tokenAccountRawInfos)r?De(this.scope.ownerPubKey,d.accountInfo.mint,s).publicKey.equals(d.pubkey)&&(u[d.accountInfo.mint.toString()]=d.pubkey):u[d.accountInfo.mint.toString()]=d.pubkey;let l=this.createTxBuilder();l.addCustomComputeBudget(c);for(let d of Object.values(e)){if(t[d.id]===void 0||!t[d.id].find(w=>!w.liquidity.isZero()||w.rewardInfos.find(P=>!P.rewardAmountOwed.isZero())))continue;let m=d,f=n.useSOLBalance&&m.mintA.address===Q.toString(),g=n.useSOLBalance&&m.mintB.address===Q.toString(),p=u[m.mintA.address];if(!p){let{account:w,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:m.mintA.programId,mint:new X(m.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,skipCloseAccount:!0,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:f?!1:r,checkCreateATAOwner:o});p=w,P&&l.addInstruction(P)}let b=u[m.mintB.address];if(!b){let{account:w,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:m.mintB.programId,mint:new X(m.mintB.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,skipCloseAccount:!0,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:g?!1:r,checkCreateATAOwner:o});b=w,P&&l.addInstruction(P)}u[m.mintA.address]=p,u[m.mintB.address]=b;let y=[];for(let w of m.rewardDefaultInfos){let P=n.useSOLBalance&&w.mint.address===Q.toString(),h=u[w.mint.address];if(!h){let{account:T,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X(w.mint.programId),mint:new X(w.mint.address),notUseTokenAccount:P,owner:this.scope.ownerPubKey,skipCloseAccount:!P,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:P?!1:r});h=T,B&&l.addInstruction(B)}u[w.mint.address]=h,y.push(h)}let A=await this.scope.api.fetchPoolKeysById({id:m.id});for(let w of t[d.id]){let P=pe.decreaseLiquidityInstructions({poolInfo:m,poolKeys:A,ownerPosition:w,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:b,rewardAccounts:y},liquidity:new Me(0),amountMinA:new Me(0),amountMinB:new Me(0)});l.addInstruction(P)}}return a===0?l.sizeCheckBuildV0():l.sizeCheckBuild()}async getWhiteListMint({programId:e}){let t=await this.scope.connection.getAccountInfo(qt(e).publicKey);return t?Ji.decode(t.data).whitelistMints.filter(r=>!r.equals(X.default)):[]}async computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,token2022Infos:r,amountOut:o,slippage:s,priceLimit:a=new I(0)}){var T;let c=await this.scope.fetchEpochInfo(),u;a.equals(new I(0))?u=n.toString()===e.mintB.address?rt.add(Ke):ot.sub(Ke):u=F.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let l=Tt(o,(T=r[n.toString()])==null?void 0:T.feeConfig,c,!0),{expectedAmountIn:d,remainingAccounts:m,executionPrice:f,feeAmount:g}=we.getInputAmountAndRemainAccounts(e,t,n,l.amount.sub(l.fee||new Me(0)),u),p=F.sqrtPriceX64ToPrice(f,e.mintA.decimals,e.mintB.decimals),b=n.toString()===e.mintA.address?p:new I(1).div(p),y=d.mul(new Me(Math.floor((1+s)*1e10))).div(new Me(1e10)),A=e.mintA.address===n.toString()?e.price:new I(1).div(e.price),w=new I(b).sub(A).abs(),P=A,h=new Ze(new I(w).mul(10**15).toFixed(0),new I(P).mul(10**15).toFixed(0));return{amountIn:d,maxAmountIn:y,currentPrice:new I(e.price),executionPrice:b,priceImpact:h,fee:g,remainingAccounts:m}}};export{dr as Clmm};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=clmm.mjs.map