var pi=Object.defineProperty,fi=Object.defineProperties;var bi=Object.getOwnPropertyDescriptors;var Xt=Object.getOwnPropertySymbols;var or=Object.prototype.hasOwnProperty,sr=Object.prototype.propertyIsEnumerable;var ir=(r,e,t)=>e in r?pi(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,V=(r,e)=>{for(var t in e||(e={}))or.call(e,t)&&ir(r,t,e[t]);if(Xt)for(var t of Xt(e))sr.call(e,t)&&ir(r,t,e[t]);return r},te=(r,e)=>fi(r,bi(e));var zt=(r,e)=>{var t={};for(var n in r)or.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&Xt)for(var n of Xt(r))e.indexOf(n)<0&&sr.call(r,n)&&(t[n]=r[n]);return t};import{PublicKey as X}from"@solana/web3.js";var wt=9e15,nt=1e9,hn="0123456789abcdef",Yt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",jt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",An={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-wt,maxE:wt,crypto:!1},lr,He,E=!0,Qt="[DecimalError] ",tt=Qt+"Invalid argument: ",mr=Qt+"Precision limit exceeded",dr=Qt+"crypto unavailable",pr="[object Decimal]",Pe=Math.floor,ce=Math.pow,gi=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,yi=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,wi=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,fr=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Me=1e7,N=7,hi=9007199254740991,Ai=Yt.length-1,Pn=jt.length-1,T={toStringTag:pr};T.absoluteValue=T.abs=function(){var r=new this.constructor(this);return r.s<0&&(r.s=1),C(r)};T.ceil=function(){return C(new this.constructor(this),this.e+1,2)};T.clampedTo=T.clamp=function(r,e){var t,n=this,i=n.constructor;if(r=new i(r),e=new i(e),!r.s||!e.s)return new i(NaN);if(r.gt(e))throw Error(tt+e);return t=n.cmp(r),t<0?r:n.cmp(e)>0?e:new i(n)};T.comparedTo=T.cmp=function(r){var e,t,n,i,o=this,s=o.d,a=(r=new o.constructor(r)).d,u=o.s,c=r.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==r.e)return o.e>r.e^u<0?1:-1;for(n=s.length,i=a.length,e=0,t=n<i?n:i;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===i?0:n>i^u<0?1:-1};T.cosine=T.cos=function(){var r,e,t=this,n=t.constructor;return t.d?t.d[0]?(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+N,n.rounding=1,t=Pi(n,hr(n,t)),n.precision=r,n.rounding=e,C(He==2||He==3?t.neg():t,r,e,!0)):new n(1):new n(NaN)};T.cubeRoot=T.cbrt=function(){var r,e,t,n,i,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(E=!1,o=l.s*ce(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=ge(l.d),r=l.e,(o=(r-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ce(t,1/3),r=Pe((r+1)/3)-(r%3==(r<0?-1:2)),o==1/0?t="5e"+r:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+r),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(r=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=Z(c.plus(l).times(a),c.plus(u),s+2,1),ge(a.d).slice(0,s)===(t=ge(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!i&&t=="4999"){if(!i&&(C(a,r+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(C(n,r+1,1),e=!n.times(n).times(n).eq(l));break}return E=!0,C(n,r,m.rounding,e)};T.decimalPlaces=T.dp=function(){var r,e=this.d,t=NaN;if(e){if(r=e.length-1,t=(r-Pe(this.e/N))*N,r=e[r],r)for(;r%10==0;r/=10)t--;t<0&&(t=0)}return t};T.dividedBy=T.div=function(r){return Z(this,new this.constructor(r))};T.dividedToIntegerBy=T.divToInt=function(r){var e=this,t=e.constructor;return C(Z(e,new t(r),0,1,1),t.precision,t.rounding)};T.equals=T.eq=function(r){return this.cmp(r)===0};T.floor=function(){return C(new this.constructor(this),this.e+1,3)};T.greaterThan=T.gt=function(r){return this.cmp(r)>0};T.greaterThanOrEqualTo=T.gte=function(r){var e=this.cmp(r);return e==1||e===0};T.hyperbolicCosine=T.cosh=function(){var r,e,t,n,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(r=Math.ceil(i/3),e=(1/Jt(4,r)).toString()):(r=16,e="2.3283064365386962890625e-10"),o=ht(s,1,o.times(e),new s(1),!0);for(var u,c=r,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return C(o,s.precision=t,s.rounding=n,!0)};T.hyperbolicSine=T.sinh=function(){var r,e,t,n,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(i.e,i.sd())+4,o.rounding=1,n=i.d.length,n<3)i=ht(o,2,i,i,!0);else{r=1.4*Math.sqrt(n),r=r>16?16:r|0,i=i.times(1/Jt(5,r)),i=ht(o,2,i,i,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);r--;)s=i.times(i),i=i.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,C(i,e,t,!0)};T.hyperbolicTangent=T.tanh=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+7,n.rounding=1,Z(t.sinh(),t.cosh(),n.precision=r,n.rounding=e)):new n(t.s)};T.inverseCosine=T.acos=function(){var r,e=this,t=e.constructor,n=e.abs().cmp(1),i=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Oe(t,i,o):new t(0):new t(NaN):e.isZero()?Oe(t,i+4,o).times(.5):(t.precision=i+6,t.rounding=1,e=e.asin(),r=Oe(t,i+4,o).times(.5),t.precision=i,t.rounding=o,r.minus(e))};T.inverseHyperbolicCosine=T.acosh=function(){var r,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(r=n.precision,e=n.rounding,n.precision=r+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,E=!1,t=t.times(t).minus(1).sqrt().plus(t),E=!0,n.precision=r,n.rounding=e,t.ln()):new n(t)};T.inverseHyperbolicSine=T.asinh=function(){var r,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,E=!1,t=t.times(t).plus(1).sqrt().plus(t),E=!0,n.precision=r,n.rounding=e,t.ln())};T.inverseHyperbolicTangent=T.atanh=function(){var r,e,t,n,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(r=o.precision,e=o.rounding,n=i.sd(),Math.max(n,r)<2*-i.e-1?C(new o(i),r,e,!0):(o.precision=t=n-i.e,i=Z(i.plus(1),new o(1).minus(i),t+r,1),o.precision=r+4,o.rounding=1,i=i.ln(),o.precision=r,o.rounding=e,i.times(.5))):new o(NaN)};T.inverseSine=T.asin=function(){var r,e,t,n,i=this,o=i.constructor;return i.isZero()?new o(i):(e=i.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(r=Oe(o,t+4,n).times(.5),r.s=i.s,r):new o(NaN):(o.precision=t+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,i.times(2)))};T.inverseTangent=T.atan=function(){var r,e,t,n,i,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=Pn)return s=Oe(l,m+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=Pn)return s=Oe(l,m+4,d).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/N+2|0),r=t;r;--r)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(E=!1,e=Math.ceil(a/N),n=1,u=c.times(c),s=new l(c),i=c;r!==-1;)if(i=i.times(u),o=s.minus(i.div(n+=2)),i=i.times(u),s=o.plus(i.div(n+=2)),s.d[e]!==void 0)for(r=e;s.d[r]===o.d[r]&&r--;);return t&&(s=s.times(2<<t-1)),E=!0,C(s,l.precision=m,l.rounding=d,!0)};T.isFinite=function(){return!!this.d};T.isInteger=T.isInt=function(){return!!this.d&&Pe(this.e/N)>this.d.length-2};T.isNaN=function(){return!this.s};T.isNegative=T.isNeg=function(){return this.s<0};T.isPositive=T.isPos=function(){return this.s>0};T.isZero=function(){return!!this.d&&this.d[0]===0};T.lessThan=T.lt=function(r){return this.cmp(r)<0};T.lessThanOrEqualTo=T.lte=function(r){return this.cmp(r)<1};T.logarithm=T.log=function(r){var e,t,n,i,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding,p=5;if(r==null)r=new l(10),e=!0;else{if(r=new l(r),t=r.d,r.s<0||!t||!t[0]||r.eq(1))return new l(NaN);e=r.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(i=t[0];i%10===0;)i/=10;o=i!==1}if(E=!1,a=m+p,s=et(c,a),n=e?Zt(l,a+10):et(r,a),u=Z(s,n,a,1),It(u.d,i=m,d))do if(a+=10,s=et(c,a),n=e?Zt(l,a+10):et(r,a),u=Z(s,n,a,1),!o){+ge(u.d).slice(i+1,i+15)+1==1e14&&(u=C(u,m+1,0));break}while(It(u.d,i+=10,d));return E=!0,C(u,m,d)};T.minus=T.sub=function(r){var e,t,n,i,o,s,a,u,c,l,m,d,p=this,b=p.constructor;if(r=new b(r),!p.d||!r.d)return!p.s||!r.s?r=new b(NaN):p.d?r.s=-r.s:r=new b(r.d||p.s!==r.s?p:NaN),r;if(p.s!=r.s)return r.s=-r.s,p.plus(r);if(c=p.d,d=r.d,a=b.precision,u=b.rounding,!c[0]||!d[0]){if(d[0])r.s=-r.s;else if(c[0])r=new b(p);else return new b(u===3?-0:0);return E?C(r,a,u):r}if(t=Pe(r.e/N),l=Pe(p.e/N),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=d.length):(e=d,t=l,s=c.length),n=Math.max(Math.ceil(a/N),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){m=c[n]<d[n];break}o=0}for(m&&(e=c,c=d,d=e,r.s=-r.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(i=n;i&&c[--i]===0;)c[i]=Me-1;--c[i],c[n]+=Me}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(r.d=c,r.e=$t(c,t),E?C(r,a,u):r):new b(u===3?-0:0)};T.modulo=T.mod=function(r){var e,t=this,n=t.constructor;return r=new n(r),!t.d||!r.s||r.d&&!r.d[0]?new n(NaN):!r.d||t.d&&!t.d[0]?C(new n(t),n.precision,n.rounding):(E=!1,n.modulo==9?(e=Z(t,r.abs(),0,3,1),e.s*=r.s):e=Z(t,r,0,n.modulo,1),e=e.times(r),E=!0,t.minus(e))};T.naturalExponential=T.exp=function(){return Tn(this)};T.naturalLogarithm=T.ln=function(){return et(this)};T.negated=T.neg=function(){var r=new this.constructor(this);return r.s=-r.s,C(r)};T.plus=T.add=function(r){var e,t,n,i,o,s,a,u,c,l,m=this,d=m.constructor;if(r=new d(r),!m.d||!r.d)return!m.s||!r.s?r=new d(NaN):m.d||(r=new d(r.d||m.s===r.s?m:NaN)),r;if(m.s!=r.s)return r.s=-r.s,m.minus(r);if(c=m.d,l=r.d,a=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(r=new d(m)),E?C(r,a,u):r;if(o=Pe(m.e/N),n=Pe(r.e/N),c=c.slice(),i=o-n,i){for(i<0?(t=c,i=-i,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/N),s=o>s?o+1:s+1,i>s&&(i=s,t.length=1),t.reverse();i--;)t.push(0);t.reverse()}for(s=c.length,i=l.length,s-i<0&&(i=s,t=l,l=c,c=t),e=0;i;)e=(c[--i]=c[i]+l[i]+e)/Me|0,c[i]%=Me;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return r.d=c,r.e=$t(c,n),E?C(r,a,u):r};T.precision=T.sd=function(r){var e,t=this;if(r!==void 0&&r!==!!r&&r!==1&&r!==0)throw Error(tt+r);return t.d?(e=br(t.d),r&&t.e+1>e&&(e=t.e+1)):e=NaN,e};T.round=function(){var r=this,e=r.constructor;return C(new e(r),r.e+1,e.rounding)};T.sine=T.sin=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+N,n.rounding=1,t=ki(n,hr(n,t)),n.precision=r,n.rounding=e,C(He>2?t.neg():t,r,e,!0)):new n(NaN)};T.squareRoot=T.sqrt=function(){var r,e,t,n,i,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(E=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=ge(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=Pe((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(Z(s,o,t+2,1)).times(.5),ge(o.d).slice(0,t)===(e=ge(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!i&&e=="4999"){if(!i&&(C(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,i=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(C(n,u+1,1),r=!n.times(n).eq(s));break}return E=!0,C(n,u,l.rounding,r)};T.tangent=T.tan=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+10,n.rounding=1,t=t.sin(),t.s=1,t=Z(t,new n(1).minus(t.times(t)).sqrt(),r+10,0),n.precision=r,n.rounding=e,C(He==2||He==4?t.neg():t,r,e,!0)):new n(NaN)};T.times=T.mul=function(r){var e,t,n,i,o,s,a,u,c,l=this,m=l.constructor,d=l.d,p=(r=new m(r)).d;if(r.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!r.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?r.s/0:r.s*0);for(t=Pe(l.e/N)+Pe(r.e/N),u=d.length,c=p.length,u<c&&(o=d,d=p,p=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,i=u+n;i>n;)a=o[i]+p[n]*d[i-n-1]+e,o[i--]=a%Me|0,e=a/Me|0;o[i]=(o[i]+e)%Me|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),r.d=o,r.e=$t(o,t),E?C(r,m.precision,m.rounding):r};T.toBinary=function(r,e){return xn(this,2,r,e)};T.toDecimalPlaces=T.toDP=function(r,e){var t=this,n=t.constructor;return t=new n(t),r===void 0?t:(Ie(r,0,nt),e===void 0?e=n.rounding:Ie(e,0,8),C(t,r+t.e+1,e))};T.toExponential=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=qe(n,!0):(Ie(r,0,nt),e===void 0?e=i.rounding:Ie(e,0,8),n=C(new i(n),r+1,e),t=qe(n,!0,r+1)),n.isNeg()&&!n.isZero()?"-"+t:t};T.toFixed=function(r,e){var t,n,i=this,o=i.constructor;return r===void 0?t=qe(i):(Ie(r,0,nt),e===void 0?e=o.rounding:Ie(e,0,8),n=C(new o(i),r+i.e+1,e),t=qe(n,!1,r+n.e+1)),i.isNeg()&&!i.isZero()?"-"+t:t};T.toFraction=function(r){var e,t,n,i,o,s,a,u,c,l,m,d,p=this,b=p.d,f=p.constructor;if(!b)return new f(p);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=br(b)-p.e-1,s=o%N,e.d[0]=ce(10,s<0?N+s:s),r==null)r=o>0?e:c;else{if(a=new f(r),!a.isInt()||a.lt(c))throw Error(tt+a);r=a.gt(e)?o>0?e:c:a}for(E=!1,a=new f(ge(b)),l=f.precision,f.precision=o=b.length*N*2;m=Z(a,e,0,1,1),i=t.plus(m.times(n)),i.cmp(r)!=1;)t=n,n=i,i=c,c=u.plus(m.times(i)),u=i,i=e,e=a.minus(m.times(i)),a=i;return i=Z(r.minus(t),n,0,1,1),u=u.plus(i.times(c)),t=t.plus(i.times(n)),u.s=c.s=p.s,d=Z(c,n,o,1).minus(p).abs().cmp(Z(u,t,o,1).minus(p).abs())<1?[c,n]:[u,t],f.precision=l,E=!0,d};T.toHexadecimal=T.toHex=function(r,e){return xn(this,16,r,e)};T.toNearest=function(r,e){var t=this,n=t.constructor;if(t=new n(t),r==null){if(!t.d)return t;r=new n(1),e=n.rounding}else{if(r=new n(r),e===void 0?e=n.rounding:Ie(e,0,8),!t.d)return r.s?t:r;if(!r.d)return r.s&&(r.s=t.s),r}return r.d[0]?(E=!1,t=Z(t,r,0,e,1).times(r),E=!0,C(t)):(r.s=t.s,t=r),t};T.toNumber=function(){return+this};T.toOctal=function(r,e){return xn(this,8,r,e)};T.toPower=T.pow=function(r){var e,t,n,i,o,s,a=this,u=a.constructor,c=+(r=new u(r));if(!a.d||!r.d||!a.d[0]||!r.d[0])return new u(ce(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,r.eq(1))return C(a,n,o);if(e=Pe(r.e/N),e>=r.d.length-1&&(t=c<0?-c:c)<=hi)return i=gr(u,a,t,n),r.s<0?new u(1).div(i):C(i,n,o);if(s=a.s,s<0){if(e<r.d.length-1)return new u(NaN);if((r.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ce(+a,c),e=t==0||!isFinite(t)?Pe(c*(Math.log("0."+ge(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(E=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),i=Tn(r.times(et(a,n+t)),n),i.d&&(i=C(i,n+5,1),It(i.d,n,o)&&(e=n+10,i=C(Tn(r.times(et(a,e+t)),e),e+5,1),+ge(i.d).slice(n+1,n+15)+1==1e14&&(i=C(i,n+1,0)))),i.s=s,E=!0,u.rounding=o,C(i,n,o))};T.toPrecision=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=qe(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(Ie(r,1,nt),e===void 0?e=i.rounding:Ie(e,0,8),n=C(new i(n),r,e),t=qe(n,r<=n.e||n.e<=i.toExpNeg,r)),n.isNeg()&&!n.isZero()?"-"+t:t};T.toSignificantDigits=T.toSD=function(r,e){var t=this,n=t.constructor;return r===void 0?(r=n.precision,e=n.rounding):(Ie(r,1,nt),e===void 0?e=n.rounding:Ie(e,0,8)),C(new n(t),r,e)};T.toString=function(){var r=this,e=r.constructor,t=qe(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()&&!r.isZero()?"-"+t:t};T.truncated=T.trunc=function(){return C(new this.constructor(this),this.e+1,1)};T.valueOf=T.toJSON=function(){var r=this,e=r.constructor,t=qe(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()?"-"+t:t};function ge(r){var e,t,n,i=r.length-1,o="",s=r[0];if(i>0){for(o+=s,e=1;e<i;e++)n=r[e]+"",t=N-n.length,t&&(o+=Je(t)),o+=n;s=r[e],n=s+"",t=N-n.length,t&&(o+=Je(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Ie(r,e,t){if(r!==~~r||r<e||r>t)throw Error(tt+r)}function It(r,e,t,n){var i,o,s,a;for(o=r[0];o>=10;o/=10)--e;return--e<0?(e+=N,i=0):(i=Math.ceil((e+1)/N),e%=N),o=ce(10,N-e),a=r[i]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(r[i+1]/o/100|0)==ce(10,e-2)-1||(a==o/2||a==0)&&(r[i+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(r[i+1]/o/1e3|0)==ce(10,e-3)-1,s}function Ht(r,e,t){for(var n,i=[0],o,s=0,a=r.length;s<a;){for(o=i.length;o--;)i[o]*=e;for(i[0]+=hn.indexOf(r.charAt(s++)),n=0;n<i.length;n++)i[n]>t-1&&(i[n+1]===void 0&&(i[n+1]=0),i[n+1]+=i[n]/t|0,i[n]%=t)}return i.reverse()}function Pi(r,e){var t,n,i;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),i=(1/Jt(4,t)).toString()):(t=16,i="2.3283064365386962890625e-10"),r.precision+=t,e=ht(r,1,e.times(i),new r(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return r.precision-=t,e}var Z=function(){function r(n,i,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*i+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,i,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=i[a]){u=n[a]>i[a]?1:-1;break}return u}function t(n,i,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<i[o]?1:0,n[o]=a*s+n[o]-i[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,o,s,a,u){var c,l,m,d,p,b,f,g,y,A,w,P,h,k,B,K,D,q,_,de,se=n.constructor,Be=n.s==i.s?1:-1,ee=n.d,Y=i.d;if(!ee||!ee[0]||!Y||!Y[0])return new se(!n.s||!i.s||(ee?Y&&ee[0]==Y[0]:!Y)?NaN:ee&&ee[0]==0||!Y?Be*0:Be/0);for(u?(p=1,l=n.e-i.e):(u=Me,p=N,l=Pe(n.e/p)-Pe(i.e/p)),_=Y.length,D=ee.length,y=new se(Be),A=y.d=[],m=0;Y[m]==(ee[m]||0);m++);if(Y[m]>(ee[m]||0)&&l--,o==null?(k=o=se.precision,s=se.rounding):a?k=o+(n.e-i.e)+1:k=o,k<0)A.push(1),b=!0;else{if(k=k/p+2|0,m=0,_==1){for(d=0,Y=Y[0],k++;(m<D||d)&&k--;m++)B=d*u+(ee[m]||0),A[m]=B/Y|0,d=B%Y|0;b=d||m<D}else{for(d=u/(Y[0]+1)|0,d>1&&(Y=r(Y,d,u),ee=r(ee,d,u),_=Y.length,D=ee.length),K=_,w=ee.slice(0,_),P=w.length;P<_;)w[P++]=0;de=Y.slice(),de.unshift(0),q=Y[0],Y[1]>=u/2&&++q;do d=0,c=e(Y,w,_,P),c<0?(h=w[0],_!=P&&(h=h*u+(w[1]||0)),d=h/q|0,d>1?(d>=u&&(d=u-1),f=r(Y,d,u),g=f.length,P=w.length,c=e(f,w,g,P),c==1&&(d--,t(f,_<g?de:Y,g,u))):(d==0&&(c=d=1),f=Y.slice()),g=f.length,g<P&&f.unshift(0),t(w,f,P,u),c==-1&&(P=w.length,c=e(Y,w,_,P),c<1&&(d++,t(w,_<P?de:Y,P,u))),P=w.length):c===0&&(d++,w=[0]),A[m++]=d,c&&w[0]?w[P++]=ee[K]||0:(w=[ee[K]],P=1);while((K++<D||w[0]!==void 0)&&k--);b=w[0]!==void 0}A[0]||A.shift()}if(p==1)y.e=l,lr=b;else{for(m=1,d=A[0];d>=10;d/=10)m++;y.e=m+l*p-1,C(y,a?o+y.e+1:o,s,b)}return y}}();function C(r,e,t,n){var i,o,s,a,u,c,l,m,d,p=r.constructor;e:if(e!=null){if(m=r.d,!m)return r;for(i=1,a=m[0];a>=10;a/=10)i++;if(o=e-i,o<0)o+=N,s=e,l=m[d=0],u=l/ce(10,i-s-1)%10|0;else if(d=Math.ceil((o+1)/N),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=u=0,i=1,o%=N,s=o-N+1}else break e;else{for(l=a=m[d],i=1;a>=10;a/=10)i++;o%=N,s=o-N+i,u=s<0?0:l/ce(10,i-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%ce(10,i-s-1)),c=t<4?(u||n)&&(t==0||t==(r.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/ce(10,i-s):0:m[d-1])%10&1||t==(r.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=r.e+1,m[0]=ce(10,(N-e%N)%N),r.e=-e||0):m[0]=r.e=0,r;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=ce(10,N-o),m[d]=s>0?(l/ce(10,i-s)%ce(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(r.e++,m[0]==Me&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=Me)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return E&&(r.e>p.maxE?(r.d=null,r.e=NaN):r.e<p.minE&&(r.e=0,r.d=[0])),r}function qe(r,e,t){if(!r.isFinite())return wr(r);var n,i=r.e,o=ge(r.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+Je(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(r.e<0?"e":"e+")+r.e):i<0?(o="0."+Je(-i-1)+o,t&&(n=t-s)>0&&(o+=Je(n))):i>=s?(o+=Je(i+1-s),t&&(n=t-i-1)>0&&(o=o+"."+Je(n))):((n=i+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(i+1===s&&(o+="."),o+=Je(n))),o}function $t(r,e){var t=r[0];for(e*=N;t>=10;t/=10)e++;return e}function Zt(r,e,t){if(e>Ai)throw E=!0,t&&(r.precision=t),Error(mr);return C(new r(Yt),e,1,!0)}function Oe(r,e,t){if(e>Pn)throw Error(mr);return C(new r(jt),e,t,!0)}function br(r){var e=r.length-1,t=e*N+1;if(e=r[e],e){for(;e%10==0;e/=10)t--;for(e=r[0];e>=10;e/=10)t++}return t}function Je(r){for(var e="";r--;)e+="0";return e}function gr(r,e,t,n){var i,o=new r(1),s=Math.ceil(n/N+4);for(E=!1;;){if(t%2&&(o=o.times(e),ur(o.d,s)&&(i=!0)),t=Pe(t/2),t===0){t=o.d.length-1,i&&o.d[t]===0&&++o.d[t];break}e=e.times(e),ur(e.d,s)}return E=!0,o}function ar(r){return r.d[r.d.length-1]&1}function yr(r,e,t){for(var n,i=new r(e[0]),o=0;++o<e.length;)if(n=new r(e[o]),n.s)i[t](n)&&(i=n);else{i=n;break}return i}function Tn(r,e){var t,n,i,o,s,a,u,c=0,l=0,m=0,d=r.constructor,p=d.rounding,b=d.precision;if(!r.d||!r.d[0]||r.e>17)return new d(r.d?r.d[0]?r.s<0?0:1/0:1:r.s?r.s<0?0:r:0/0);for(e==null?(E=!1,u=b):u=e,a=new d(.03125);r.e>-2;)r=r.times(a),m+=5;for(n=Math.log(ce(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=C(o.times(r),u,1),t=t.times(++l),a=s.plus(Z(o,t,u,1)),ge(a.d).slice(0,u)===ge(s.d).slice(0,u)){for(i=m;i--;)s=C(s.times(s),u,1);if(e==null)if(c<3&&It(s.d,u-n,p,c))d.precision=u+=10,t=o=a=new d(1),l=0,c++;else return C(s,d.precision=b,p,E=!0);else return d.precision=b,s}s=a}}function et(r,e){var t,n,i,o,s,a,u,c,l,m,d,p=1,b=10,f=r,g=f.d,y=f.constructor,A=y.rounding,w=y.precision;if(f.s<0||!g||!g[0]||!f.e&&g[0]==1&&g.length==1)return new y(g&&!g[0]?-1/0:f.s!=1?NaN:g?0:f);if(e==null?(E=!1,l=w):l=e,y.precision=l+=b,t=ge(g),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(r),t=ge(f.d),n=t.charAt(0),p++;o=f.e,n>1?(f=new y("0."+t),o++):f=new y(n+"."+t.slice(1))}else return c=Zt(y,l+2,w).times(o+""),f=et(new y(n+"."+t.slice(1)),l-b).plus(c),y.precision=w,e==null?C(f,w,A,E=!0):f;for(m=f,u=s=f=Z(f.minus(1),f.plus(1),l,1),d=C(f.times(f),l,1),i=3;;){if(s=C(s.times(d),l,1),c=u.plus(Z(s,new y(i),l,1)),ge(c.d).slice(0,l)===ge(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Zt(y,l+2,w).times(o+""))),u=Z(u,new y(p),l,1),e==null)if(It(u.d,l-b,A,a))y.precision=l+=b,c=s=f=Z(m.minus(1),m.plus(1),l,1),d=C(f.times(f),l,1),i=a=1;else return C(u,y.precision=w,A,E=!0);else return y.precision=w,u;u=c,i+=2}}function wr(r){return String(r.s*r.s/0)}function kn(r,e){var t,n,i;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(i=e.length;e.charCodeAt(i-1)===48;--i);if(e=e.slice(n,i),e){if(i-=n,r.e=t=t-n-1,r.d=[],n=(t+1)%N,t<0&&(n+=N),n<i){for(n&&r.d.push(+e.slice(0,n)),i-=N;n<i;)r.d.push(+e.slice(n,n+=N));e=e.slice(n),n=N-e.length}else n-=i;for(;n--;)e+="0";r.d.push(+e),E&&(r.e>r.constructor.maxE?(r.d=null,r.e=NaN):r.e<r.constructor.minE&&(r.e=0,r.d=[0]))}else r.e=0,r.d=[0];return r}function Ti(r,e){var t,n,i,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),fr.test(e))return kn(r,e)}else if(e==="Infinity"||e==="NaN")return+e||(r.s=NaN),r.e=NaN,r.d=null,r;if(yi.test(e))t=16,e=e.toLowerCase();else if(gi.test(e))t=2;else if(wi.test(e))t=8;else throw Error(tt+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=r.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,i=gr(n,new n(t),o,o*2)),c=Ht(e,t,Me),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(r.s*0):(r.e=$t(c,l),r.d=c,E=!1,s&&(r=Z(r,i,a*4)),u&&(r=r.times(Math.abs(u)<54?ce(2,u):St.pow(2,u))),E=!0,r)}function ki(r,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:ht(r,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Jt(5,t)),e=ht(r,2,e,e);for(var i,o=new r(5),s=new r(16),a=new r(20);t--;)i=e.times(e),e=e.times(o.plus(i.times(s.times(i).minus(a))));return e}function ht(r,e,t,n,i){var o,s,a,u,c=1,l=r.precision,m=Math.ceil(l/N);for(E=!1,u=t.times(t),a=new r(n);;){if(s=Z(a.times(u),new r(e++*e++),l,1),a=i?n.plus(s):n.minus(s),n=Z(s.times(u),new r(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return E=!0,s.d.length=m+1,s}function Jt(r,e){for(var t=r;--e;)t*=r;return t}function hr(r,e){var t,n=e.s<0,i=Oe(r,r.precision,1),o=i.times(.5);if(e=e.abs(),e.lte(o))return He=n?4:1,e;if(t=e.divToInt(i),t.isZero())He=n?3:2;else{if(e=e.minus(t.times(i)),e.lte(o))return He=ar(t)?n?2:3:n?4:1,e;He=ar(t)?n?1:4:n?3:2}return e.minus(i).abs()}function xn(r,e,t,n){var i,o,s,a,u,c,l,m,d,p=r.constructor,b=t!==void 0;if(b?(Ie(t,1,nt),n===void 0?n=p.rounding:Ie(n,0,8)):(t=p.precision,n=p.rounding),!r.isFinite())l=wr(r);else{for(l=qe(r),s=l.indexOf("."),b?(i=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):i=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=Ht(qe(d),10,i),d.e=d.d.length),m=Ht(l,10,i),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=b?"0p+0":"0";else{if(s<0?o--:(r=new p(r),r.d=m,r.e=o,r=Z(r,d,t,n,0,i),m=r.d,o=r.e,c=lr),s=m[t],a=i/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(r.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(r.s<0?8:7)),m.length=t,c)for(;++m[--t]>i-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=hn.charAt(m[s]);if(b){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=Ht(l,i,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=hn.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return r.s<0?"-"+l:l}function ur(r,e){if(r.length>e)return r.length=e,!0}function xi(r){return new this(r).abs()}function Bi(r){return new this(r).acos()}function Ii(r){return new this(r).acosh()}function Si(r,e){return new this(r).plus(e)}function Ci(r){return new this(r).asin()}function Ki(r){return new this(r).asinh()}function Ni(r){return new this(r).atan()}function Ri(r){return new this(r).atanh()}function Li(r,e){r=new this(r),e=new this(e);var t,n=this.precision,i=this.rounding,o=n+4;return!r.s||!e.s?t=new this(NaN):!r.d&&!e.d?(t=Oe(this,o,1).times(e.s>0?.25:.75),t.s=r.s):!e.d||r.isZero()?(t=e.s<0?Oe(this,n,i):new this(0),t.s=r.s):!r.d||e.isZero()?(t=Oe(this,o,1).times(.5),t.s=r.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(Z(r,e,o,1)),e=Oe(this,o,1),this.precision=n,this.rounding=i,t=r.s<0?t.minus(e):t.plus(e)):t=this.atan(Z(r,e,o,1)),t}function Fi(r){return new this(r).cbrt()}function Oi(r){return C(r=new this(r),r.e+1,2)}function Mi(r,e,t){return new this(r).clamp(e,t)}function Ei(r){if(!r||typeof r!="object")throw Error(Qt+"Object expected");var e,t,n,i=r.defaults===!0,o=["precision",1,nt,"rounding",0,8,"toExpNeg",-wt,0,"toExpPos",0,wt,"maxE",0,wt,"minE",-wt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],i&&(this[t]=An[t]),(n=r[t])!==void 0)if(Pe(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(tt+t+": "+n);if(t="crypto",i&&(this[t]=An[t]),(n=r[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(dr);else this[t]=!1;else throw Error(tt+t+": "+n);return this}function Di(r){return new this(r).cos()}function vi(r){return new this(r).cosh()}function Ar(r){var e,t,n;function i(o){var s,a,u,c=this;if(!(c instanceof i))return new i(o);if(c.constructor=i,cr(o)){c.s=o.s,E?!o.d||o.e>i.maxE?(c.e=NaN,c.d=null):o.e<i.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;E?s>i.maxE?(c.e=NaN,c.d=null):s<i.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return kn(c,o.toString())}else if(u!=="string")throw Error(tt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),fr.test(o)?kn(c,o):Ti(c,o)}if(i.prototype=T,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=Ei,i.clone=Ar,i.isDecimal=cr,i.abs=xi,i.acos=Bi,i.acosh=Ii,i.add=Si,i.asin=Ci,i.asinh=Ki,i.atan=Ni,i.atanh=Ri,i.atan2=Li,i.cbrt=Fi,i.ceil=Oi,i.clamp=Mi,i.cos=Di,i.cosh=vi,i.div=_i,i.exp=Vi,i.floor=qi,i.hypot=Wi,i.ln=Gi,i.log=Ui,i.log10=zi,i.log2=Xi,i.max=Hi,i.min=Yi,i.mod=ji,i.mul=Zi,i.pow=Qi,i.random=$i,i.round=Ji,i.sign=eo,i.sin=to,i.sinh=no,i.sqrt=ro,i.sub=io,i.sum=oo,i.tan=so,i.tanh=ao,i.trunc=uo,r===void 0&&(r={}),r&&r.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)r.hasOwnProperty(t=n[e++])||(r[t]=this[t]);return i.config(r),i}function _i(r,e){return new this(r).div(e)}function Vi(r){return new this(r).exp()}function qi(r){return C(r=new this(r),r.e+1,3)}function Wi(){var r,e,t=new this(0);for(E=!1,r=0;r<arguments.length;)if(e=new this(arguments[r++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return E=!0,new this(1/0);t=e}return E=!0,t.sqrt()}function cr(r){return r instanceof St||r&&r.toStringTag===pr||!1}function Gi(r){return new this(r).ln()}function Ui(r,e){return new this(r).log(e)}function Xi(r){return new this(r).log(2)}function zi(r){return new this(r).log(10)}function Hi(){return yr(this,arguments,"lt")}function Yi(){return yr(this,arguments,"gt")}function ji(r,e){return new this(r).mod(e)}function Zi(r,e){return new this(r).mul(e)}function Qi(r,e){return new this(r).pow(e)}function $i(r){var e,t,n,i,o=0,s=new this(1),a=[];if(r===void 0?r=this.precision:Ie(r,1,nt),n=Math.ceil(r/N),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)i=e[o],i>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)i=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(i%1e7),o+=4);o=n/4}else throw Error(dr);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],r%=N,n&&r&&(i=ce(10,N-r),a[o]=(n/i|0)*i);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=N)a.shift();for(n=1,i=a[0];i>=10;i/=10)n++;n<N&&(t-=N-n)}return s.e=t,s.d=a,s}function Ji(r){return C(r=new this(r),r.e+1,this.rounding)}function eo(r){return r=new this(r),r.d?r.d[0]?r.s:0*r.s:r.s||NaN}function to(r){return new this(r).sin()}function no(r){return new this(r).sinh()}function ro(r){return new this(r).sqrt()}function io(r,e){return new this(r).sub(e)}function oo(){var r=0,e=arguments,t=new this(e[r]);for(E=!1;t.s&&++r<e.length;)t=t.plus(e[r]);return E=!0,C(t,this.precision,this.rounding)}function so(r){return new this(r).tan()}function ao(r){return new this(r).tanh()}function uo(r){return C(r=new this(r),r.e+1,1)}T[Symbol.for("nodejs.util.inspect.custom")]=T.toString;T[Symbol.toStringTag]="Decimal";var St=T.constructor=Ar(An);Yt=new St(Yt);jt=new St(jt);var I=St;import{get as Pr,set as co}from"lodash";import kr from"dayjs";import lo from"dayjs/plugin/utc";kr.extend(lo);var Bn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return kr().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Tr={},mo={};function le(r){let e=Pr(Tr,r);if(!e){let t=Pr(mo,r);e=new Bn({name:r,logLevel:t}),co(Tr,r,e)}return e}import{PublicKey as fu}from"@solana/web3.js";import gu from"bn.js";import So from"big.js";import sn from"bn.js";import Se from"bn.js";import{PublicKey as Kn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as po}from"@solana/spl-token";import{PublicKey as ne,SystemProgram as fo,SYSVAR_RENT_PUBKEY as bo}from"@solana/web3.js";function In({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var Ns=[In({pubkey:po,isWritable:!1}),In({pubkey:fo.programId,isWritable:!1}),In({pubkey:bo,isWritable:!1})];function Sn({publicKey:r,transformSol:e}){let t=xr(r.toString());if(t instanceof ne)return e&&t.equals(lt)?$:t;if(e&&t.toString()===lt.toBase58())return $;if(typeof t=="string"){if(t===ne.default.toBase58())return ne.default;try{return new ne(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function xr(r){try{return new ne(r)}catch{return r}}var en=new ne("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ct=new ne("SysvarRent111111111111111111111111111111111"),Rs=new ne("SysvarC1ock11111111111111111111111111111111"),At=new ne("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Ls=new ne("Sysvar1nstructions1111111111111111111111111"),Fs=new ne("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Os=new ne("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ms=new ne("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Es=new ne("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ds=new ne("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),vs=new ne("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),_s=new ne("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Vs=new ne("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),qs=new ne("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ws=new ne("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Gs=new ne("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),$=new ne("So11111111111111111111111111111111111111112"),lt=ne.default;function Cn(r){return Sn({publicKey:r,transformSol:!0})}import{PublicKey as go}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Br}from"@solana/spl-token";var tn={chainId:101,address:go.default.toBase58(),programId:Br.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},mt={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Br.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Nn=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===lt.toBase58()||e instanceof Kn&&lt.equals(e)){this.decimals=mt.decimals,this.symbol=mt.symbol,this.name=mt.name,this.mint=new Kn(mt.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?Kn.default:Sn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ye=Nn;Ye.WSOL=new Nn(te(V({},mt),{mint:mt.address}));import rn from"big.js";import ho from"bn.js";import Ao from"decimal.js-light";import yo from"toformat";var wo=yo,Kt=wo;var nn=le("module/fraction"),Rn=Kt(rn),Nt=Kt(Ao),Po={[0]:Nt.ROUND_DOWN,[1]:Nt.ROUND_HALF_UP,[2]:Nt.ROUND_UP},To={[0]:rn.roundDown,[1]:rn.roundHalfUp,[2]:rn.roundUp},H=class{constructor(e,t=new ho(1)){this.numerator=ye(e),this.denominator=ye(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new H(this.denominator,this.numerator)}add(e){let t=e instanceof H?e:new H(ye(e));return this.denominator.eq(t.denominator)?new H(this.numerator.add(t.numerator),this.denominator):new H(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof H?e:new H(ye(e));return this.denominator.eq(t.denominator)?new H(this.numerator.sub(t.numerator),this.denominator):new H(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof H?e:new H(ye(e));return new H(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof H?e:new H(ye(e));return new H(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||nn.logWithError(`${e} is not an integer.`),e<=0&&nn.logWithError(`${e} is not positive.`),Nt.set({precision:e+1,rounding:Po[n]});let i=new Nt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||nn.logWithError(`${e} is not an integer.`),e<0&&nn.logWithError(`${e} is negative.`),Rn.DP=e,Rn.RM=To[n]||1,new Rn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var xo=le("Raydium_price"),Ee=class extends H{constructor(t){let{baseToken:n,quoteToken:i,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=i,this.scalar=new H(Ln(n.decimals),Ln(i.decimals))}get raw(){return new H(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Ee({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&xo.logWithError("mul token not equals");let n=super.mul(t);return new Ee({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,i){return this.adjusted.toSignificant(t,n,i)}toFixed(t=this.quoteToken.decimals,n,i){return this.adjusted.toFixed(t,n,i)}};var Fn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},on=Fn;on.SOL=new Fn(tn);import Bo from"bn.js";var Ir=new H(new Bo(100)),je=class extends H{toSignificant(e=5,t,n){return this.mul(Ir).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Ir).toFixed(e,t,n)}};var Io=new Se(0),_a=new Se(1),Va=new Se(2),qa=new Se(3),Wa=new Se(5),On=new Se(10),Ga=new Se(100),Ua=new Se(1e3),Xa=new Se(1e4),Sr=9007199254740991;function ye(r){let e=le("Raydium_parseBigNumberish");if(r instanceof Se)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new Se(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=Sr||r<=-Sr)&&e.logWithError(`BigNumberish number overflow: ${r}`),new Se(String(r))):typeof r=="bigint"?new Se(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new Se(0))}function Ln(r){return On.pow(ye(r))}var Co=le("Raydium_amount"),Cr=Kt(So);function Ko(r,e){let t="0",n="0";if(r.includes(".")){let i=r.split(".");i.length===2?([t,n]=i,n=n.padEnd(e,"0")):Co.logWithError(`invalid number string, num: ${r}`)}else t=r;return[t,n.slice(0,e)||n]}var Te=class extends H{constructor(t,n,i=!0,o){let s=new sn(0),a=On.pow(new sn(t.decimals));if(i)s=ye(n);else{let u=new sn(0),c=new sn(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=Ko(n.toString(),t.decimals);u=ye(l),c=ye(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=le(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new Te(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new Te(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,i=0){return super.toSignificant(t,n,i)}toFixed(t=this.token.decimals,n,i=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,i)}toExact(t={groupSeparator:""}){return Cr.DP=this.token.decimals,new Cr(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Ft,sendAndConfirmTransaction as _n,Transaction as Ot,TransactionMessage as Mt,VersionedTransaction as Et}from"@solana/web3.js";import Do from"axios";var ae={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw"};import{PublicKey as No,ComputeBudgetProgram as Kr,Transaction as Rr,TransactionMessage as Ro,Keypair as Lr,VersionedTransaction as Fr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Lo}from"@solana/spl-token";var Nr=le("Raydium_txUtil"),Or=1644;function an(r){let e=[],t=[];return r.microLamports&&(e.push(Kr.setComputeUnitPrice({microLamports:r.microLamports})),t.push(ae.SetComputeUnitPrice)),r.units&&(e.push(Kr.setComputeUnitLimit({units:r.units})),t.push(ae.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Pt(r){var e,t;try{return((t=await((e=r.getLatestBlockhash)==null?void 0:e.call(r)))==null?void 0:t.blockhash)||(await r.getRecentBlockhash()).blockhash}catch{return(await r.getRecentBlockhash()).blockhash}}function Fo(r,e){r.length<1&&Nr.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&Nr.logWithError(`no signers provided:, ${e.toString()}`);let t=new Rr;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Or}catch{return!1}}function Ke(r,e){let[t,n]=No.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function Rt({instructions:r,payer:e,signers:t}){return Fo(r,[e,...t])}function Lt({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Lr.generate().publicKey.toString()}){let o=new Ro({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Fr(o).serialize()).toString("base64").length<Or}catch{return!1}}var Oo=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r);function dt(r){let e=[];return r.forEach(t=>{t instanceof Rr&&(t.recentBlockhash||(t.recentBlockhash=Lo.toBase58()),t.feePayer||(t.feePayer=Lr.generate().publicKey));let n=t.serialize({requireAllSignatures:!1,verifySignatures:!1});t instanceof Fr&&(n=Oo(n));let i=n.toString("base64");e.push(i)}),console.log("simulate tx string:",e),e}import{PublicKey as Mr,AddressLookupTableAccount as un}from"@solana/web3.js";import{PublicKey as Mo}from"@solana/web3.js";import{getTransferFeeConfig as Mu,unpackMint as Eu}from"@solana/spl-token";var Mn=le("Raydium_accountInfo_util");async function rt(r,e,t){let{batchRequest:n,commitment:i="confirmed"}=V({batchRequest:!1},t),o=En(e,100),s=new Array(o.length).fill([]);if(n){let a=o.map(l=>{let m=r._buildArgs([l.map(d=>d.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:m}}),u=En(a,10);s=(await(await Promise.all(u.map(async l=>await r._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&Mn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(m=>{if(m){let{data:d,executable:p,lamports:b,owner:f,rentEpoch:g}=m;return d.length!==2&&d[1]!=="base64"&&Mn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:p,lamports:b,owner:new Mo(f),rentEpoch:g}}return null})))}else try{s=await Promise.all(o.map(a=>r.getMultipleAccountsInfo(a,i)))}catch(a){a instanceof Error&&Mn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function Dn(r,e,t){let n=await rt(r,e.map(i=>i.pubkey),t);return e.map((i,o)=>te(V({},i),{accountInfo:n[o]}))}async function vn({connection:r,address:e}){let t=await rt(r,[...new Set(e.map(i=>i.toString()))].map(i=>new Mr(i))),n={};for(let i=0;i<e.length;i++){let o=t[i],s=e[i];if(!o)continue;let a=new un({key:s,state:un.deserialize(o.data)});n[s.toString()]=a,cn[s.toString()]=a}return n}var cn={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new un({key:new Mr("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:un.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var ln=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Do.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=an(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Ft.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(V({},t||{})):this.build(t)}build(e){let t=new Ot;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async()=>{var i;let n=await Pt(this.connection);if(t.recentBlockhash=n,this.signers.length&&t.sign(...this.signers),dt([t]),(i=this.owner)!=null&&i.isKeyPair)return{txId:await _n(this.connection,t,this.signers),signedTx:t};if(this.signAllTransactions){let o=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(o[0].serialize(),{skipPreflight:!0}),signedTx:o[0]}}throw new Error("please connect wallet first")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:i}=this.build(n),o=t.filter(c=>c.transaction.instructions.length>0),s=[i,...o.map(c=>c.transaction)],a=[this.signers,...o.map(c=>c.signers)],u=[...this.instructionTypes,...o.map(c=>c.instructionTypes).flat()];return{builder:this,transactions:s,signers:a,instructionTypes:u,execute:async c=>{var p;let{sequentially:l,onTxUpdate:m}=c||{},d=await Pt(this.connection);if((p=this.owner)!=null&&p.isKeyPair)return{txIds:await await Promise.all(s.map(async(b,f)=>(b.recentBlockhash=d,await _n(this.connection,b,a[f])))),signedTxs:s};if(this.signAllTransactions){let b=s.map((g,y)=>(g.recentBlockhash=d,a[y].length&&g.sign(...a[y]),g));dt(b);let f=await this.signAllTransactions(b);if(l){let g=0,y=[],A=async()=>{if(!f[g])return;let w=await this.connection.sendRawTransaction(f[g].serialize(),{skipPreflight:!0});y.push({txId:w,status:"sent",signedTx:f[g]}),m==null||m([...y]),g++,this.connection.onSignature(w,P=>{let h=y.findIndex(k=>k.txId===w);h>-1&&(y[h].status=P.err?"error":"success"),m==null||m([...y]),A()},"processed"),this.connection.getSignatureStatus(w)};return await A(),{txIds:y.map(w=>w.txId),signedTxs:f}}else{let g=[];for(let y=0;y<f.length;y+=1){let A=await this.connection.sendRawTransaction(f[y].serialize(),{skipPreflight:!0});g.push(A)}return{txIds:g,signedTxs:f}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){let d=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:i}=d,o=zt(d,["lookupTableCache","lookupTableAddress","forerunCreate"]),s=V(V({},cn),t),a=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let p of a)s[p]===void 0&&u.push(new Ft(p));let c=await vn({connection:this.connection,address:u});for(let[p,b]of Object.entries(c))s[p]=b;let l=new Mt({payerKey:this.feePayer,recentBlockhash:i?Ft.default.toBase58():await Pt(this.connection),instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s)),m=new Et(l);return m.sign(this.signers),{builder:this,transaction:m,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async()=>{var p;if(dt([m]),(p=this.owner)!=null&&p.isKeyPair)return m.sign([this.owner.signer]),{txId:await this.connection.sendTransaction(m,{skipPreflight:!0}),signedTx:m};if(this.signAllTransactions){let b=await this.signAllTransactions([m]);return{txId:await this.connection.sendTransaction(b[0],{skipPreflight:!0}),signedTx:b[0]}}throw new Error("please connect wallet first")},extInfo:o||{}}}async buildV0MultiTx(e){let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:i}=await this.buildV0(n),o=t.filter(c=>c.builder.instructions.length>0),s=[i,...o.map(c=>c.transaction)],a=[this.signers,...o.map(c=>c.signers)],u=[...this.instructionTypes,...o.map(c=>c.instructionTypes).flat()];return s.forEach(async(c,l)=>{c.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:u,buildProps:n,execute:async c=>{var d;dt(s);let{sequentially:l,onTxUpdate:m}=c||{};if((d=this.owner)!=null&&d.isKeyPair)return s.forEach(p=>p.sign([this.owner.signer])),{txIds:await Promise.all(s.map(async p=>await this.connection.sendTransaction(p))),signedTxs:s};if(this.signAllTransactions){let p=await this.signAllTransactions(s);if(l){let b=0,f=[],g=async()=>{if(!p[b])return;let y=await this.connection.sendTransaction(p[b],{skipPreflight:!0});f.push({txId:y,status:"sent",signedTx:p[b]}),m==null||m([...f]),b++,this.connection.onSignature(y,A=>{let w=f.findIndex(P=>P.txId===y);w>-1&&(f[w].status=A.err?"error":"success"),m==null||m([...f]),g()},"processed"),this.connection.getSignatureStatus(y)};return g(),{txIds:[],signedTxs:p}}else{let b=[];for(let f=0;f<p.length;f+=1){let g=await this.connection.sendTransaction(p[f],{skipPreflight:!0});b.push(g)}return{txIds:b,signedTxs:p}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async sizeCheckBuild(e){let c=e||{},{autoComputeBudget:t=!1}=c,n=zt(c,["autoComputeBudget"]),i={instructions:[],instructionTypes:[]};if(t){let l=t?await this.getComputeBudgetConfig():void 0;i=t&&l?an(l):{instructions:[],instructionTypes:[]}}let o=this.signers.reduce((l,m)=>te(V({},l),{[m.publicKey.toBase58()]:m}),{}),s=[],a=[],u=[];if(this.allInstructions.forEach(l=>{let m=[...u,l],d=t?[...i.instructions,...m]:m,b=[...new Set(m.map(f=>f.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(f=>new Ft(f));if(u.length<12&&Rt({instructions:d,payer:this.feePayer,signers:b})||Rt({instructions:m,payer:this.feePayer,signers:b}))u.push(l);else{if(u.length===0)throw Error("item ins too big");Rt({instructions:t?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:b})?s.push(new Ot().add(...i.instructions,...u)):s.push(new Ot().add(...u)),a.push(Array.from(new Set(u.map(f=>f.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat())).map(f=>o[f]).filter(f=>f!==void 0)),u=[l]}}),u.length>0){let m=[...new Set(u.map(d=>d.keys.filter(p=>p.isSigner).map(p=>p.pubkey.toString())).flat()).values()].map(d=>o[d]).filter(d=>d!==void 0);Rt({instructions:t?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:m.map(d=>d.publicKey)})?s.push(new Ot().add(...i.instructions,...u)):s.push(new Ot().add(...u)),a.push(m)}return s.forEach(l=>l.feePayer=this.feePayer),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async l=>{var b;let{sequentially:m,onTxUpdate:d}=l||{},p=await Pt(this.connection);if(s.forEach(async(f,g)=>{f.recentBlockhash=p,a[g].length&&f.sign(...a[g])}),dt(s),(b=this.owner)!=null&&b.isKeyPair)return{txIds:await Promise.all(s.map(async(f,g)=>await _n(this.connection,f,a[g]))),signedTxs:s};if(this.signAllTransactions){let f=await this.signAllTransactions(s);if(m){let g=0,y=[],A=async()=>{if(!f[g])return;let w=await this.connection.sendRawTransaction(f[g].serialize(),{skipPreflight:!0});y.push({txId:w,status:"sent",signedTx:f[g]}),d==null||d([...y]),g++,this.connection.onSignature(w,P=>{let h=y.findIndex(k=>k.txId===w);h>-1&&(y[h].status=P.err?"error":"success"),d==null||d([...y]),A()},"processed"),this.connection.getSignatureStatus(w)};return await A(),{txIds:y.map(w=>w.txId),signedTxs:f}}else{let g=[];for(let y=0;y<f.length;y+=1){let A=await this.connection.sendRawTransaction(f[y].serialize(),{skipPreflight:!0});g.push(A)}return{txIds:g,signedTxs:f}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async sizeCheckBuildV0(e){let g=e||{},{autoComputeBudget:t=!1,lookupTableCache:n={},lookupTableAddress:i=[]}=g,o=zt(g,["autoComputeBudget","lookupTableCache","lookupTableAddress"]),s=V(V({},cn),n),a=Array.from(new Set([...this.lookupTableAddress,...i])),u=[];for(let y of a)s[y]===void 0&&u.push(new Ft(y));let c=await vn({connection:this.connection,address:u});for(let[y,A]of Object.entries(c))s[y]=A;let l={instructions:[],instructionTypes:[]};if(t){let y=t?await this.getComputeBudgetConfig():void 0;l=t&&y?an(y):{instructions:[],instructionTypes:[]}}let m=await Pt(this.connection),d=this.signers.reduce((y,A)=>te(V({},y),{[A.publicKey.toBase58()]:A}),{}),p=[],b=[],f=[];if(this.allInstructions.forEach(y=>{let A=[...f,y],w=t?[...l.instructions,...A]:A;if(f.length<12&&Lt({instructions:w,payer:this.feePayer,lookupTableAddressAccount:s})||Lt({instructions:A,payer:this.feePayer,lookupTableAddressAccount:s}))f.push(y);else{if(f.length===0)throw Error("item ins too big");let P={};for(let h of[...new Set(a)])s[h]!==void 0&&(P[h]=s[h]);if(t&&Lt({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let h=new Mt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new Et(h))}else{let h=new Mt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new Et(h))}b.push(Array.from(new Set(f.map(h=>h.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat())).map(h=>d[h]).filter(h=>h!==void 0)),f=[y]}}),f.length>0){let A=[...new Set(f.map(w=>w.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(w=>d[w]).filter(w=>w!==void 0);if(t&&Lt({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let w=new Mt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new Et(w))}else{let w=new Mt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new Et(w))}b.push(A)}return{builder:this,transactions:p,buildProps:e,signers:b,instructionTypes:this.instructionTypes,execute:async y=>{var P;let{sequentially:A,onTxUpdate:w}=y||{};if(p.map(async(h,k)=>{b[k].length&&h.sign(b[k])}),dt(p),(P=this.owner)!=null&&P.isKeyPair)return{txIds:await Promise.all(p.map(async h=>await this.connection.sendTransaction(h,{skipPreflight:!0}))),signedTxs:p};if(this.signAllTransactions){let h=await this.signAllTransactions(p);if(A){let k=0,B=[],K=async()=>{if(!h[k])return;let D=await this.connection.sendTransaction(h[k],{skipPreflight:!0});B.push({txId:D,status:"sent",signedTx:h[k]}),w==null||w([...B]),k++,this.connection.onSignature(D,q=>{let _=B.findIndex(de=>de.txId===D);_>-1&&(B[_].status=q.err?"error":"success"),w==null||w([...B]),K()},"processed"),this.connection.getSignatureStatus(D)};return K(),{txIds:[],signedTxs:h}}else{let k=[];for(let B=0;B<h.length;B+=1){let K=await this.connection.sendTransaction(h[B],{skipPreflight:!0});k.push(K)}return{txIds:k,signedTxs:h}}}throw new Error("please connect wallet first")},extInfo:o||{}}}};function En(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Ce}from"@solana/web3.js";var ic=new Ce("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),oc=new Ce("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),sc=new Ce("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),ac=new Ce("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),uc=new Ce("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),cc=new Ce("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),lc=new Ce("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),mc=new Ce("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),dc=new Ce("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),pc=new Ce("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),fc=new Ce("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),bc=new Ce("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),gc=new Ce("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),yc=new Ce("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi");import{PublicKey as vo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as _o}from"@solana/spl-token";function De(r,e,t){return Ke([r.toBuffer(),(t!=null?t:_o).toBuffer(),e.toBuffer()],new vo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import ue from"bn.js";var We=1e4;function kt(r,e,t,n){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let i=t.epoch<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new ue(i.maximumFee.toString()),s=t.epoch<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(i.transferFeeBasisPoints===We){let a=new ue(i.maximumFee.toString());return{amount:r.add(a),fee:a,expirationTime:s}}else{let a=Tt(r.mul(new ue(We)),new ue(We-i.transferFeeBasisPoints)),u=new ue(i.maximumFee.toString()),c=a.sub(r).gt(u)?r.add(u):a,l=Tt(c.mul(new ue(i.transferFeeBasisPoints)),new ue(We)),m=l.gt(o)?o:l;return{amount:c,fee:m,expirationTime:s}}else{let a=Tt(r.mul(new ue(i.transferFeeBasisPoints)),new ue(We)),u=a.gt(o)?o:a;return{amount:r,fee:u,expirationTime:s}}}function pe(r,e,t,n){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let i=te(V({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,s=new ue(o.maximumFee.toString()),a=t.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===We){let u=new ue(o.maximumFee.toString());return{amount:r.add(u),fee:u,expirationTime:a}}else{let u=Tt(r.mul(new ue(We)),new ue(We-o.transferFeeBasisPoints)),c=new ue(o.maximumFee.toString()),l=u.sub(r).gt(c)?r.add(c):u,m=Tt(l.mul(new ue(o.transferFeeBasisPoints)),new ue(We)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let u=Tt(r.mul(new ue(o.transferFeeBasisPoints)),new ue(We)),c=u.gt(s)?s:u;return{amount:r,fee:c,expirationTime:a}}}function pt(r,e){return r===void 0?e:e===void 0?r:Math.min(r,e)}function Tt(r,e){let{div:t,mod:n}=r.divmod(e);return n.gt(new ue(0))?t.add(new ue(1)):t}var Vn=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Dt=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=le(t)}createTxBuilder(e){return this.scope.checkOwner(),new ln({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Vn(e))}logInfo(...e){this.logger.info(Vn(e))}logAndCreateError(...e){let t=Vn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import Ge from"bn.js";var z=new Ge(0),Ne=new Ge(1),Ze=new Ge(-1),Re=new Ge(1).shln(64),mn=new Ge(1).shln(128),qn=Re.sub(Ne),vt=64,Er=mn.subn(1),ke=-443636,xe=-ke,it=new Ge("4295048016"),ot=new Ge("79226673521066979257578248091"),Dr=16,vr="59543866431248",_r="184467440737095516",Vr="15793534762490258745",dn=new Ge(10).pow(new Ge(6)),Vo=(n=>(n[n.rate_500=500]="rate_500",n[n.rate_3000=3e3]="rate_3000",n[n.rate_10000=1e4]="rate_10000",n))(Vo||{}),Hc={[500]:10,[3e3]:60,[1e4]:200},Yc={version:6,liquidity:z,tickCurrent:0,observationIndex:0,observationUpdateDuration:0,feeGrowthGlobalX64A:z,feeGrowthGlobalX64B:z,protocolFeesTokenA:z,protocolFeesTokenB:z,swapInAmountTokenA:z,swapOutAmountTokenB:z,swapInAmountTokenB:z,swapOutAmountTokenA:z,tickArrayBitmap:[],rewardInfos:[],day:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},week:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},month:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},tvl:0},qr={tvl:0,volumeQuote:0,mintAmountA:0,mintAmountB:0,rewardDefaultInfos:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,day:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},week:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},month:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},pooltype:[]},jc=new Ge("18446744073700000000");import v from"bn.js";function Wr(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r,!1),new Uint8Array(e)}function Qc(r){let e=new ArrayBuffer(2);return new DataView(e).setInt16(0,r,!1),new Uint8Array(e)}function $c(r){let e=new ArrayBuffer(4);return new DataView(e).setUint32(0,r,!1),new Uint8Array(e)}function pn(r){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,r,!1),new Uint8Array(e)}function Wn(r,e){let t=0;for(let n=r-1;n>=0&&!e.testn(n);n--)t++;return t}function Gn(r,e){let t=0;for(let n=0;n<r&&!e.testn(n);n++)t++;return t}function _t(r,e){for(let t=0;t<r;t++)if(e.testn(t))return!1;return!0}function Gr(r,e){return _t(r,e)?null:Wn(r,e)}function Ur(r,e){return _t(r,e)?null:Gn(r,e)}var qo=Buffer.from("amm_config","utf8"),Wo=Buffer.from("pool","utf8"),Go=Buffer.from("pool_vault","utf8"),Uo=Buffer.from("pool_reward_vault","utf8"),Xr=Buffer.from("position","utf8"),Xo=Buffer.from("tick_array","utf8"),zo=Buffer.from("operation","utf8"),Ho=Buffer.from("pool_tick_array_bitmap_extension","utf8");function nl(r,e){return Ke([qo,Wr(e)],r)}function zr(r,e,t,n){return Ke([Wo,e.toBuffer(),t.toBuffer(),n.toBuffer()],r)}function Un(r,e,t){return Ke([Go,e.toBuffer(),t.toBuffer()],r)}function Hr(r,e,t){return Ke([Uo,e.toBuffer(),t.toBuffer()],r)}function j(r,e,t){return Ke([Xo,e.toBuffer(),pn(t)],r)}function ft(r,e,t,n){return Ke([Xr,e.toBuffer(),pn(t),pn(n)],r)}function Ue(r,e){return Ke([Xr,e.toBuffer()],r)}function fn(r){return Ke([Buffer.from("metadata","utf8"),At.toBuffer(),r.toBuffer()],At)}function Vt(r){return Ke([zo],r)}function st(r,e){return Ke([Ho,e.toBuffer()],r)}import{PublicKey as ri}from"@solana/web3.js";import oe from"bn.js";import ls from"bn.js";import{PublicKey as ns}from"@solana/web3.js";import Qr,{isBN as $r}from"bn.js";import{bits as ol,BitStructure as sl,blob as Yo,Blob as al,cstr as ul,f32 as cl,f32be as ll,f64 as ml,f64be as dl,greedy as pl,Layout as jo,ns64 as fl,ns64be as bl,nu64 as gl,nu64be as yl,offset as wl,s16 as hl,s16be as Al,s24 as Pl,s24be as Tl,s32 as Zo,s32be as kl,s40 as xl,s40be as Bl,s48 as Il,s48be as Sl,s8 as Cl,seq as Qo,struct as Kl,Structure as $o,u16 as Jo,u16be as Nl,u24 as Rl,u24be as Ll,u32 as Fl,u32be as Ol,u40 as Ml,u40be as El,u48 as Dl,u48be as vl,u8 as es,UInt as ts,union as _l,Union as Vl,unionLayoutDiscriminator as ql,utf8 as Wl}from"@solana/buffer-layout";var Xn=jo,Yr=$o;var zn=ts;var jr=es,xt=Jo;var we=Zo;var Zr=Qo;var Le=Yo;var qt=class extends Xn{constructor(t,n,i){super(t,i);this.blob=Le(t),this.signed=n}decode(t,n=0){let i=new Qr(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new Qr(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function ie(r){return new zn(1,r)}function Qe(r){return new zn(4,r)}function F(r){return new qt(8,!1,r)}function W(r){return new qt(16,!1,r)}function Jr(r){return new qt(16,!0,r)}var bn=class extends Xn{constructor(t,n,i,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function J(r){return new bn(Le(32),e=>new ns(e),e=>e.toBuffer(),r)}function Xe(r){return new bn(jr(),rs,is,r)}function rs(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function is(r){return r?1:0}var Hn=class extends Yr{decode(e,t){return super.decode(e,t)}};function Q(r,e,t){return new Hn(r,e,t)}function re(r,e,t){let n,i=typeof e=="number"?e:$r(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=$r(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Zr(r,i,t)}var Yn=14,$e=class{static maxTickInTickarrayBitmap(e){return e*me*bt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(i+=1);let o=n*i;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,i){if(!U.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=i?t-U.tickCount(n):t+U.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*me,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(i){let l=e.shln(1024-c-1),m=Gr(1024,l);if(m!==null){let d=(c-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=Ur(1024,l);if(m!==null){let d=(c+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-U.tickCount(n)}}}},Wt=class{static getBitmapOffset(e,t){if(!U.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=$e.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&i--,i}static getBitmap(e,t,n){let i=this.getBitmapOffset(e,t);return e<0?{offset:i,tickarrayBitmap:n.negativeTickArrayBitmap[i]}:{offset:i,tickarrayBitmap:n.positiveTickArrayBitmap[i]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:i}=this.extensionTickBoundary(t);if(e>=i&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=$e.maxTickInTickarrayBitmap(e),n=-t;if(xe<=t)throw Error(`extensionTickBoundary check error: ${xe}, ${t}`);if(n<=ke)throw Error(`extensionTickBoundary check error: ${n}, ${ke}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:i}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:S.mergeTickArrayBitmap(i).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,i){let o=U.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,i);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,i){let{minValue:o,maxValue:s}=$e.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(i){let u=S.mergeTickArrayBitmap(e).shln(bt-1-a),c=_t(512,u)?null:Wn(512,u);if(c!==null){let l=t-c*U.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=S.mergeTickArrayBitmap(e).shrn(a),c=_t(512,u)?null:Gn(512,u);if(c!==null){let l=t+c*U.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-U.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%$e.maxTickInTickarrayBitmap(t),i=Math.floor(n/U.tickCount(t));return e<0&&n!=0&&(i=bt-i),i}};var cm=Q([Le(8),ie("bump"),xt("index"),J(""),Qe("protocolFeeRate"),Qe("tradeFeeRate"),xt("tickSpacing"),re(F(),8,"")]),os=Q([Qe("blockTimestamp"),W("sqrtPriceX64"),W("cumulativeTimePriceX64"),re(W(),1,"")]),jn=Q([Le(8),Xe("initialized"),J("poolId"),re(os,1e3,"observations"),re(W(),5,"")]),ss=Q([ie("rewardState"),F("openTime"),F("endTime"),F("lastUpdateTime"),W("emissionsPerSecondX64"),F("rewardTotalEmissioned"),F("rewardClaimed"),J("tokenMint"),J("tokenVault"),J("creator"),W("rewardGrowthGlobalX64")]),lm=Q([Le(8),ie("bump"),J("ammConfig"),J("creator"),J("mintA"),J("mintB"),J("vaultA"),J("vaultB"),J("observationId"),ie("mintDecimalsA"),ie("mintDecimalsB"),xt("tickSpacing"),W("liquidity"),W("sqrtPriceX64"),we("tickCurrent"),xt("observationIndex"),xt("observationUpdateDuration"),W("feeGrowthGlobalX64A"),W("feeGrowthGlobalX64B"),F("protocolFeesTokenA"),F("protocolFeesTokenB"),W("swapInAmountTokenA"),W("swapOutAmountTokenB"),W("swapInAmountTokenB"),W("swapOutAmountTokenA"),ie("status"),re(ie(),7,""),re(ss,3,"rewardInfos"),re(F(),16,"tickArrayBitmap"),F("totalFeesTokenA"),F("totalFeesClaimedTokenA"),F("totalFeesTokenB"),F("totalFeesClaimedTokenB"),F("fundFeesTokenA"),F("fundFeesTokenB"),F("startTime"),re(F(),15*4-3,"padding")]),as=Q([W("growthInsideLastX64"),F("rewardAmountOwed")]),ei=Q([Le(8),ie("bump"),J("nftMint"),J("poolId"),we("tickLower"),we("tickUpper"),W("liquidity"),W("feeGrowthInsideLastX64A"),W("feeGrowthInsideLastX64B"),F("tokenFeesOwedA"),F("tokenFeesOwedB"),re(as,3,"rewardInfos"),re(F(),8,"")]),mm=Q([Le(8),ie("bump"),J("poolId"),we("tickLowerIndex"),we("tickUpperIndex"),W("liquidity"),W("feeGrowthInsideLastX64A"),W("feeGrowthInsideLastX64B"),F("tokenFeesOwedA"),F("tokenFeesOwedB"),re(W(),3,"rewardGrowthInside"),re(F(),8,"")]),us=Q([we("tick"),Jr("liquidityNet"),W("liquidityGross"),W("feeGrowthOutsideX64A"),W("feeGrowthOutsideX64B"),re(W(),3,"rewardGrowthsOutsideX64"),re(Qe(),13,"")]),Gt=Q([Le(8),J("poolId"),we("startTickIndex"),re(us,me,"ticks"),ie("initializedTickCount"),re(ie(),115,"")]),ti=Q([Le(329),re(J(),100,"whitelistMints")]),ni=Q([Le(8),J("poolId"),re(re(F(),8),Yn,"positiveTickArrayBitmap"),re(re(F(),8),Yn,"negativeTickArrayBitmap")]);var cs=15,U=class{static async getTickArrays(e,t,n,i,o,s,a){let u=[],c=S.getTickArrayStartIndexByTick(i,o),l=S.getInitializedTickArrayInRange(s,a,o,c,Math.floor(cs/2));for(let p=0;p<l.length;p++){let{publicKey:b}=j(t,n,l[p]);u.push(b)}let m=(await rt(e,u)).map(p=>p!==null?Gt.decode(p.data):null),d={};for(let p=0;p<u.length;p++){let b=m[p];b!==null&&(d[b.startTickIndex]=te(V({},b),{address:u[p]}))}return d}static nextInitializedTick(e,t,n,i,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,i,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=S.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,i,o){let s=Math.floor(e/U.tickCount(t)),a=n?S.searchLowBitFromStart(i,o,s-1,1,t):S.searchHightBitFromStart(i,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,i){let o;if(i){let a=me-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<me;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=j(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,i,o,s){let a=S.getTickArrayStartIndexByTick(i,o),u=Math.floor((i-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u-1}else for(u=u+1;u<me;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u+1}let{publicKey:m}=j(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(S.checkIsOutOfBoundary(e)){if(e>xe)return!1;let n=S.getTickArrayStartIndexByTick(ke,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return me*e}};var me=60,bt=512,S=class{static getTickArrayAddressByTick(e,t,n,i){let o=S.getTickArrayStartIndexByTick(n,i),{publicKey:s}=j(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=S.getTickArrayStartIndexByTick(e,t),i=Math.floor((e-n)/t);if(i<0||i>=me)throw new Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,t){let n=U.tickCount(t),i=e/n;return e<0&&e%n!=0?i=Math.ceil(i)-1:i=Math.floor(i),i}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*U.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*me,i=Math.floor(e/n)+512;return Math.abs(i)}static checkTickArrayIsInitialized(e,t,n){let i=n*me,o=Math.floor(t/i)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*i}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*me:e+t*me}static mergeTickArrayBitmap(e){let t=new ls(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,i,o){let s=Math.floor(i/(n*me));return[...S.searchLowBitFromStart(e,t,s-1,o,n),...S.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return S.searchHightBitFromStart(e,t,0,bt,n)}static getAllInitializedTickArrayInfo(e,t,n,i,o){let s=[],a=S.getAllInitializedTickArrayStartIndex(n,i,o);for(let u of a){let{publicKey:c}=j(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>S.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===i)break}let u=U.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>S.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===i)break}let u=U.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<ke||e>xe}static nextInitTick(e,t,n,i,o){if(U.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(i)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<me;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=me-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<me;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let i=O.getSqrtPriceX64FromTick(t),o=O.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new I(1).div(o),tickSqrtPriceX64:i}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let i=n?t:new I(1).div(t),o=gt.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=O.getSqrtPriceX64FromTick(o),a=O.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new I(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let i=O.getSqrtPriceX64FromTick(t),o=O.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new I(1).div(o),tickSqrtPriceX64:i}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let i=n?t:new I(1).div(t),o=gt.getTickWithPriceAndTickspacing(i,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=O.getSqrtPriceX64FromTick(o),a=O.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new I(1).div(a)}}};import ze from"bn.js";var Ut=class{static getfeeGrowthInside(e,t,n){let i=new ze(0),o=new ze(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new ze(0),a=new ze(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=M.wrappingSubU128(M.wrappingSubU128(e.feeGrowthGlobalX64A,i),s),c=M.wrappingSubU128(M.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=M.mulDivFloor(M.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Re),u=t.tokenFeesOwedA.add(a),c=M.mulDivFloor(M.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Re),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=M.mulDivFloor(M.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Re),u=t.tokenFeesOwedA.add(a),c=M.mulDivFloor(M.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Re),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,i){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=M.wrappingSubU128(u,c.growthInsideLastX64),m=M.mulDivFloor(l,t.liquidity,Re),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,i){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=M.wrappingSubU128(u,c.growthInsideLastX64),m=M.mulDivFloor(l,t.liquidity,Re),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new ze(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new ze(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(M.wrappingSubU128(M.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new ze(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new ze(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(M.wrappingSubU128(M.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:o,epochInfo:s}){var g,y,A,w;let a=O.priceToSqrtPriceX64(new I(e.price),e.mintA.decimals,e.mintB.decimals),u=O.getSqrtPriceX64FromTick(t.tickLower),c=O.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+i:1-i,m=G.getAmountsFromLiquidity(a,u,c,n,o),[d,p]=[pe(m.amountA,(g=e.mintA.extensions)==null?void 0:g.feeConfig,s,!0),pe(m.amountB,(y=e.mintB.extensions)==null?void 0:y.feeConfig,s,!0)],[b,f]=[pe(new ze(new I(m.amountA.toString()).mul(l).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,s,!0),pe(new ze(new I(m.amountB.toString()).mul(l).toFixed(0)),(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:b,amountSlippageB:f,expirationTime:pt(d.expirationTime,p.expirationTime)}}};var he=class{static getOutputAmountAndRemainAccounts(e,t,n,i,o){let s=n.equals(e.mintA.mint),a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:b}=yt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i,c,o);return a.push(...d),{expectedAmountOut:m.mul(Ze),remainingAccounts:a,executionPrice:p,feeAmount:b}}static getInputAmountAndRemainAccounts(e,t,n,i,o){let s=n.equals(e.mintB.mint),a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:g}=j(e.programId,e.id,f.nextStartIndex);a.push(g)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:b}=yt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i.mul(Ze),c,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:p,feeAmount:b}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:i}=he.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Wt.checkTickArrayIsInit(U.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):S.checkTickArrayIsInitialized(S.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=j(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,U.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=j(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/U.tickCount(e.tickSpacing)),i=t?S.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):S.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=U.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:i,tickIndex:o}=$e.nextInitializedTickArrayStartIndex(S.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(i)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Wt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<ke||t>xe)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:i,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let p=te(V({},m),{perSecond:M.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new ri(d)});if(p.tokenMint.equals(ri.default))continue;if(n<=p.openTime.toNumber()||i.eq(z)){s.push(p);continue}let b=new oe(Math.min(p.endTime.toNumber(),n)),f=b.sub(p.lastUpdateTime),g=M.mulDivFloor(f,p.emissionsPerSecondX64,i),y=p.rewardGrowthGlobalX64.add(g),A=M.mulDivFloor(f,p.emissionsPerSecondX64,Re),w=p.rewardTotalEmissioned.add(A);s.push(te(V({},p),{rewardGrowthGlobalX64:y,rewardTotalEmissioned:w,lastUpdateTime:b}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:i}=this.tickRange(e);for(let o of t){let s=S.getTickArrayStartIndexByTick(o,e);if(s>=n||s<i)return!0}return!1}static tickRange(e){let t=$e.maxTickInTickarrayBitmap(e),n=-t;return t>xe&&(t=U.getArrayStartIndex(xe,e)+U.tickCount(e)),n<ke&&(n=U.getArrayStartIndex(ke,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!U.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/U.tickCount(t)*bt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let i=await Dn(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of i)s.accountInfo!==null&&(o[s.pubkey.toString()]=ni.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let i={},o=[];for(let u of t){let c=S.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=S.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:d}=j(u.programId,u.id,m);o.push({pubkey:d}),i[d.toString()]=u.id}}let s=await Dn(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=i[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=Gt.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]=te(V({},l),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:i=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let p of s)c.push(Ue(p,d).publicKey);let l=await rt(t,c,{batchRequest:i}),m={};for(let d of l){if(d===null)continue;let p=ei.decode(d.data),b=p.poolId.toString(),f=e.find(K=>K.state.id.toBase58()===b);if(f===void 0)continue;let g=f.state,y=S._getTickPriceLegacy({poolInfo:g,tick:p.tickLower,baseIn:!0}),A=S._getTickPriceLegacy({poolInfo:g,tick:p.tickUpper,baseIn:!0}),{amountA:w,amountB:P}=G.getAmountsFromLiquidity(g.sqrtPriceX64,y.tickSqrtPriceX64,A.tickSqrtPriceX64,p.liquidity,!1),h=1/(1-Math.sqrt(Math.sqrt(y.price.div(A.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:y.price,priceUpper:A.price,amountA:w,amountB:P,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(K=>te(V({},K),{pendingReward:new oe(0)})),leverage:h,tokenFeeAmountA:new oe(0),tokenFeeAmountB:new oe(0)}];let k=await S.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),B=await S.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=k,m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=B}if(o){let d=Object.values(m),p=await rt(t,d,{batchRequest:i}),b={};for(let f=0;f<d.length;f++){let g=p[f];if(g===null)continue;let y=d[f].toString();b[y]=Gt.decode(g.data)}for(let{state:f,positionAccount:g}of e)if(!!g)for(let y of g){let A=`${f.programId.toString()}-${f.id.toString()}-${y.tickLower}`,w=`${f.programId.toString()}-${f.id.toString()}-${y.tickUpper}`,P=b[m[A].toString()],h=b[m[w].toString()],k=P.ticks[S.getTickOffsetInArray(y.tickLower,f.tickSpacing)],B=h.ticks[S.getTickOffsetInArray(y.tickUpper,f.tickSpacing)],{tokenFeeAmountA:K,tokenFeeAmountB:D}=await Ut.GetPositionFees(f,y,k,B),q=await Ut.GetPositionRewards(f,y,k,B);y.tokenFeeAmountA=K.gte(new oe(0))?K:new oe(0),y.tokenFeeAmountB=D.gte(new oe(0))?D:new oe(0);for(let _=0;_<q.length;_++)y.rewardInfos[_].pendingReward=q[_].gte(new oe(0))?q[_]:new oe(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,token2022Infos:i,epochInfo:o,amountIn:s,slippage:a,priceLimit:u=new I(0)}){var D,q,_,de;let c;u.equals(new I(0))?c=n.equals(e.mintA.mint)?it.add(new oe(1)):ot.sub(new oe(1)):c=O.priceToSqrtPriceX64(u,e.mintA.decimals,e.mintB.decimals);let l=kt(s,(D=i[n.toString()])==null?void 0:D.feeConfig,o,!1),{expectedAmountOut:m,remainingAccounts:d,executionPrice:p,feeAmount:b}=he.getOutputAmountAndRemainAccounts(e,t,n,l.amount.sub((q=l.fee)!=null?q:z),c),f=e.mintA.mint.equals(n)?e.mintB.mint:e.mintA.mint,g=kt(m,(_=i[f.toString()])==null?void 0:_.feeConfig,o,!1),y=O.sqrtPriceX64ToPrice(p,e.mintA.decimals,e.mintB.decimals),A=n.equals(e.mintA.mint)?y:new I(1).div(y),w=m.mul(new oe(Math.floor((1-a)*1e10))).div(new oe(1e10)),P=kt(w,(de=i[f.toString()])==null?void 0:de.feeConfig,o,!1),h=e.mintA.mint.equals(n)?e.currentPrice:new I(1).div(e.currentPrice),k=new I(A).sub(h).abs(),B=h,K=new je(new I(k).mul(10**15).toFixed(0),new I(B).mul(10**15).toFixed(0));return{realAmountIn:l,amountOut:g,minAmountOut:P,expirationTime:pt(l.expirationTime,g.expirationTime),currentPrice:e.currentPrice,executionPrice:A,priceImpact:K,fee:b,remainingAccounts:d}}static async computeAmountOutFormat({poolInfo:e,tickArrayCache:t,token2022Infos:n,amountIn:i,tokenOut:o,slippage:s,epochInfo:a}){let u=i.token.equals(Ye.WSOL)?$:i.token.mint,c=s.numerator.toNumber()/s.denominator.toNumber(),l=o.mint.equals(lt)?new Ye({mint:"sol",decimals:tn.decimals}):o,{realAmountIn:m,amountOut:d,minAmountOut:p,expirationTime:b,currentPrice:f,executionPrice:g,priceImpact:y,fee:A,remainingAccounts:w}=await he.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:u,amountIn:i.raw,slippage:c,token2022Infos:n,epochInfo:a}),P=te(V({},m),{amount:new Te(i.token,m.amount),fee:m.fee===void 0?void 0:new Te(i.token,m.fee)}),h=te(V({},d),{amount:new Te(l,d.amount),fee:d.fee===void 0?void 0:new Te(l,d.fee)}),k=te(V({},p),{amount:new Te(l,p.amount),fee:p.fee===void 0?void 0:new Te(l,p.fee)}),B=new Ee({baseToken:i.token,denominator:new oe(10).pow(new oe(20+i.token.decimals)),quoteToken:l,numerator:f.mul(new I(10**(20+l.decimals))).toFixed(0)}),K=new Ee({baseToken:i.token,denominator:new oe(10).pow(new oe(20+i.token.decimals)),quoteToken:l,numerator:g.mul(new I(10**(20+l.decimals))).toFixed(0)}),D=new Te(i.token,A);return{realAmountIn:P,amountOut:h,minAmountOut:k,expirationTime:b,currentPrice:B,executionPrice:K,priceImpact:y,fee:D,remainingAccounts:w}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:i}){var b,f,g;let o=e[t],s=S.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=S.getTickPrice({poolInfo:e,tick:i,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,d=o.priceMax-o.priceMin,p;return l<=0?p=0:m===l?p=d/l:d===l?p=l/m:p=l/d*(l/m),{feeApr:o.feeApr*p,rewardsApr:[(b=o.rewardApr[0])!=null?b:0*p,(f=o.rewardApr[1])!=null?f:0*p,(g=o.rewardApr[2])!=null?g:0*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:i,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=i[Cn(e.mintA.address).toString()],d=i[Cn(e.mintB.address).toString()],p=e.mintA.decimals,b=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=O.priceToSqrtPriceX64(new I(e.price),e.mintA.decimals,e.mintB.decimals),g=O.getSqrtPriceX64FromTick(s),y=O.getSqrtPriceX64FromTick(a),{amountSlippageA:A,amountSlippageB:w}=G.getAmountsFromLiquidityWithSlippage(f,g,y,t,!1,!1,0),{amountSlippageA:P,amountSlippageB:h}=G.getAmountsFromLiquidityWithSlippage(f,g,y,o,!1,!1,0),k=new I(A.toString()).div(new I(10).pow(p)).mul(m.value).add(new I(w.toString()).div(new I(10).pow(b)).mul(d.value)),B=new I(P.toString()).div(new I(10).pow(p)).mul(m.value).add(new I(h.toString()).div(new I(10).pow(b)).mul(d.value)),K=B.div(k.add(B)).div(B),q=new I(l.volumeFee).mul(365).div(c).mul(K).mul(100).toNumber(),_=3600*24*365,de=e.rewardDefaultInfos.map(se=>{var Y,rr;let Be=se.mint.decimals,ee=i[se.mint.address];return u<((Y=se.startTime)!=null?Y:0)||u>((rr=se.endTime)!=null?rr:0)||!se.perSecond||!ee||Be===void 0?0:new I(ee.value).mul(new I(se.perSecond).mul(_)).div(new I(10).pow(Be)).mul(K).mul(100).toNumber()});return{feeApr:q,rewardsApr:de,apr:q+de.reduce((se,Be)=>se+Be,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:i,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var y,A;let l=O.priceToSqrtPriceX64(new I(e.price),e.mintA.decimals,e.mintB.decimals),m=O.getSqrtPriceX64FromTick(n),d=O.getSqrtPriceX64FromTick(i),p=a?1-s:1+s,b=pe(o,(y=e[t?"mintA":"mintB"].extensions)==null?void 0:y.feeConfig,u,!c),f=new oe(new I(b.amount.sub((A=b.fee)!=null?A:z).toString()).mul(p).toFixed(0)),g;if(l.lte(m))g=t?G.getLiquidityFromTokenAmountA(m,d,f,!a):new oe(0);else if(l.lte(d)){let w=G.getLiquidityFromTokenAmountA(l,d,f,!a),P=G.getLiquidityFromTokenAmountB(m,l,f);g=t?w:P}else g=t?new oe(0):G.getLiquidityFromTokenAmountB(m,d,f);return he.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:i,liquidity:g,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:i,liquidity:o,slippage:s,add:a}){var g,y,A,w;let u=O.getSqrtPriceX64FromTick(n),c=O.getSqrtPriceX64FromTick(i),l=a?1+s:1-s,m=G.getAmountsFromLiquidity(O.priceToSqrtPriceX64(new I(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,p]=[pe(m.amountA,(g=t.mintA.extensions)==null?void 0:g.feeConfig,e,!0),pe(m.amountB,(y=t.mintB.extensions)==null?void 0:y.feeConfig,e,!0)],[b,f]=[pe(m.amountA.muln(l),(A=t.mintA.extensions)==null?void 0:A.feeConfig,e,!0),pe(m.amountB.muln(l),(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:p,amountSlippageA:b,amountSlippageB:f,expirationTime:pt(d.expirationTime,p.expirationTime)}}};function $m({poolInfo:r,tickLower:e,tickUpper:t,amountA:n,amountB:i,slippage:o,add:s,epochInfo:a,amountHasFee:u}){var w,P,h,k;let[c,l,m,d]=e<t?[e,t,n,i]:[t,e,i,n],p=O.priceToSqrtPriceX64(new I(r.price),r.mintA.decimals,r.mintB.decimals),b=O.getSqrtPriceX64FromTick(c),f=O.getSqrtPriceX64FromTick(l),[g,y]=[pe(m,(w=r.mintA.extensions)==null?void 0:w.feeConfig,a,!u),pe(d,(P=r.mintB.extensions)==null?void 0:P.feeConfig,a,!u)],A=G.getLiquidityFromTokenAmounts(p,b,f,g.amount.sub((h=g.fee)!=null?h:z),y.amount.sub((k=y.fee)!=null?k:z));return G.getAmountsOutFromLiquidity({poolInfo:r,tickLower:e,tickUpper:t,liquidity:A,slippage:o,add:s,epochInfo:a,amountAddFee:!u})}var M=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),o=i.div(n);return i.mod(n).eq(z)||(o=o.add(Ne)),o}static mulDivFloor(e,t,n){if(n.eq(z))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(z))throw new Error("division by 0");return e.mul(t).add(n.sub(Ne)).div(n)}static x64ToDecimal(e,t){return new I(e.toString()).div(I.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new v(e.mul(I.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(mn).sub(t).mod(mn)}};function fe(r,e){return Zn(r.mul(e),64,256)}function ms(r,e,t){let n=r.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Zn(r,e,t){let n=r.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var O=class{static sqrtPriceX64ToPrice(e,t,n){return M.x64ToDecimal(e).pow(2).mul(I.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return M.decimalToX64(e.mul(I.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(z))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(z))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(z))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(z))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(z))return e;let o=t.shln(vt);if(i){let s=o,a=o.add(n.mul(e));return a.gte(s)?M.mulDivCeil(s,e,a):M.mulDivRoundingUp(s,Ne,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return M.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let o=n.shln(vt);if(i)return e.add(o.div(t));{let s=M.mulDivRoundingUp(o,Ne,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<ke||e>xe)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new v("18445821805675395072"):new v("18446744073709551616");return(t&2)!=0&&(n=fe(n,new v("18444899583751176192"))),(t&4)!=0&&(n=fe(n,new v("18443055278223355904"))),(t&8)!=0&&(n=fe(n,new v("18439367220385607680"))),(t&16)!=0&&(n=fe(n,new v("18431993317065453568"))),(t&32)!=0&&(n=fe(n,new v("18417254355718170624"))),(t&64)!=0&&(n=fe(n,new v("18387811781193609216"))),(t&128)!=0&&(n=fe(n,new v("18329067761203558400"))),(t&256)!=0&&(n=fe(n,new v("18212142134806163456"))),(t&512)!=0&&(n=fe(n,new v("17980523815641700352"))),(t&1024)!=0&&(n=fe(n,new v("17526086738831433728"))),(t&2048)!=0&&(n=fe(n,new v("16651378430235570176"))),(t&4096)!=0&&(n=fe(n,new v("15030750278694412288"))),(t&8192)!=0&&(n=fe(n,new v("12247334978884435968"))),(t&16384)!=0&&(n=fe(n,new v("8131365268886854656"))),(t&32768)!=0&&(n=fe(n,new v("3584323654725218816"))),(t&65536)!=0&&(n=fe(n,new v("696457651848324352"))),(t&131072)!=0&&(n=fe(n,new v("26294789957507116"))),(t&262144)!=0&&(n=fe(n,new v("37481735321082"))),e>0&&(n=Er.div(n)),n}static getTickFromPrice(e,t,n){return O.getTickFromSqrtPriceX64(O.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(ot)||e.lt(it))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new v(t-64),i=ms(n,32,128),o=new v("8000000000000000","hex"),s=0,a=new v(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new v(0))&&s<Dr;){u=u.mul(u);let b=u.shrn(127);u=u.shrn(63+b.toNumber()),a=a.add(o.mul(b)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=i.add(c).mul(new v(vr)),d=Zn(m.sub(new v(_r)),64,128).toNumber(),p=Zn(m.add(new v(Vr)),64,128).toNumber();return d==p?d:O.getSqrtPriceX64FromTick(p).lte(e)?p:d}},gt=class{static getTickWithPriceAndTickspacing(e,t,n,i){let s=O.getTickFromSqrtPriceX64(O.priceToSqrtPriceX64(e,n,i))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,i){let o=gt.getTickWithPriceAndTickspacing(e,t,n,i),s=O.getSqrtPriceX64FromTick(o);return O.sqrtPriceX64ToPrice(s,n,i)}},G=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(z))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(vt),s=t.sub(e);return i?M.mulDivRoundingUp(M.mulDivCeil(o,s,t),Ne,e):M.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(z))throw new Error("sqrtPriceX64A must greater than 0");return i?M.mulDivCeil(n,t.sub(e),Re):M.mulDivFloor(n,t.sub(e),Re)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return i?M.mulDivRoundingUp(a,Ne,qn):a.shrn(vt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),M.mulDivFloor(n,qn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return G.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){let s=G.getLiquidityFromTokenAmountA(e,n,i,!1),a=G.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return G.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:G.getTokenAmountAFromLiquidity(t,n,i,o),amountB:new v(0)};if(e.lt(n)){let s=G.getTokenAmountAFromLiquidity(e,n,i,o),a=G.getTokenAmountBFromLiquidity(t,e,i,o);return{amountA:s,amountB:a}}else return{amountA:new v(0),amountB:G.getTokenAmountBFromLiquidity(t,n,i,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,o,s,a){let{amountA:u,amountB:c}=G.getAmountsFromLiquidity(e,t,n,i,s),l=o?1+a:1-a,m=new v(new I(u.toString()).mul(l).toFixed(0)),d=new v(new I(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var A,w,P,h;let c=O.priceToSqrtPriceX64(new I(e.price),e.mintA.decimals,e.mintB.decimals),l=O.getSqrtPriceX64FromTick(t),m=O.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,p=G.getAmountsFromLiquidity(c,l,m,i,s),[b,f]=[pe(p.amountA,(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,u),pe(p.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,a,u)],[g,y]=[pe(new v(new I(p.amountA.toString()).mul(d).toFixed(0)),(P=e.mintA.extensions)==null?void 0:P.feeConfig,a,u),pe(new v(new I(p.amountB.toString()).mul(d).toFixed(0)),(h=e.mintB.extensions)==null?void 0:h.feeConfig,a,u)];return{liquidity:i,amountA:b,amountB:f,amountSlippageA:g,amountSlippageB:y,expirationTime:pt(b.expirationTime,f.expirationTime)}}},yt=class{static swapCompute(e,t,n,i,o,s,a,u,c,l,m,d,p,b){if(d.eq(z))throw new Error("amountSpecified must not be 0");if(b||(b=s?it.add(Ne):ot.sub(Ne)),s){if(b.lt(it))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(b.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(b.gt(ot))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(b.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let f=d.gt(z),g={amountSpecifiedRemaining:d,amountCalculated:z,sqrtPriceX64:m,tick:c>p?Math.min(p+U.tickCount(l)-1,c):p,accounts:[],liquidity:u,feeAmount:new v(0)},y=p,A=n[p],w=0,P=!s&&A.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(z)&&!g.sqrtPriceX64.eq(b);){if(w>10)throw Error("liquidity limit");let h={};h.sqrtPriceStartX64=g.sqrtPriceX64;let k=S.nextInitTick(A,g.tick,l,s,P),B=k||null,K=null;if(!(B!=null&&B.liquidityGross.gtn(0))){let q=he.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:l,tickArrayBitmap:i,exBitmapInfo:o},y,s);if(!q.isExist)throw Error("swapCompute LiquidityInsufficient");y=q.nextStartIndex;let{publicKey:_}=j(e,t,y);K=_,A=n[y],B=S.firstInitializedTick(A,s)}h.tickNext=B.tick,h.initialized=B.liquidityGross.gtn(0),p!==y&&K&&(g.accounts.push(K),p=y),h.tickNext<ke?h.tickNext=ke:h.tickNext>xe&&(h.tickNext=xe),h.sqrtPriceNextX64=O.getSqrtPriceX64FromTick(h.tickNext);let D;if(s&&h.sqrtPriceNextX64.lt(b)||!s&&h.sqrtPriceNextX64.gt(b)?D=b:D=h.sqrtPriceNextX64,[g.sqrtPriceX64,h.amountIn,h.amountOut,h.feeAmount]=yt.swapStepCompute(g.sqrtPriceX64,D,g.liquidity,g.amountSpecifiedRemaining,a),g.feeAmount=g.feeAmount.add(h.feeAmount),f?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(h.amountIn.add(h.feeAmount)),g.amountCalculated=g.amountCalculated.sub(h.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(h.amountOut),g.amountCalculated=g.amountCalculated.add(h.amountIn.add(h.feeAmount))),g.sqrtPriceX64.eq(h.sqrtPriceNextX64)){if(h.initialized){let q=B.liquidityNet;s&&(q=q.mul(Ze)),g.liquidity=G.addDelta(g.liquidity,q)}P=h.tickNext!=g.tick&&!s&&A.startTickIndex===h.tickNext,g.tick=s?h.tickNext-1:h.tickNext}else if(g.sqrtPriceX64!=h.sqrtPriceStartX64){let q=O.getTickFromSqrtPriceX64(g.sqrtPriceX64);P=q!=g.tick&&!s&&A.startTickIndex===q,g.tick=q}++w}try{let{nextStartIndex:h,isExist:k}=U.nextInitializedTickArray(g.tick,l,s,i,o);k&&p!==h&&(g.accounts.push(j(e,t,h).publicKey),p=h)}catch{}return{amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,i,o){let s={sqrtPriceX64Next:new v(0),amountIn:new v(0),amountOut:new v(0),feeAmount:new v(0)},a=e.gte(t),u=i.gte(z);if(u){let l=M.mulDivFloor(i,dn.sub(new v(o.toString())),dn);s.amountIn=a?G.getTokenAmountAFromLiquidity(t,e,n,!0):G.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=O.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?G.getTokenAmountBFromLiquidity(t,e,n,!1):G.getTokenAmountAFromLiquidity(e,t,n,!1),i.mul(Ze).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=O.getNextSqrtPriceX64FromOutput(e,n,i.mul(Ze),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=G.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=G.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:G.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:G.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(i.mul(Ze))&&(s.amountOut=i.mul(Ze)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=i.sub(s.amountIn):s.feeAmount=M.mulDivCeil(s.amountIn,new v(o),dn.sub(new v(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};import{TOKEN_PROGRAM_ID as Ae,TOKEN_2022_PROGRAM_ID as ct,ASSOCIATED_TOKEN_PROGRAM_ID as li}from"@solana/spl-token";import{PublicKey as x,TransactionInstruction as _e,SystemProgram as Bt,Keypair as tr}from"@solana/web3.js";import mi from"bn.js";import{PublicKey as ys,Keypair as ws}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as hs}from"@solana/spl-token";import Rd from"bn.js";var ds=Q([J("mint"),J("owner"),F("amount"),Qe("delegateOption"),J("delegate"),ie("state"),Qe("isNativeOption"),F("isNative"),F("delegatedAmount"),Qe("closeAuthorityOption"),J("closeAuthority")]);function ps(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function Qn(r,...e){if(!ps(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function $n(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function ii(r,e){Qn(r);let t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var yn=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),ve=(r,e)=>r<<32-e|r>>>e;var gd=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function fs(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function Jn(r){return typeof r=="string"&&(r=fs(r)),Qn(r),r}var gn=class{clone(){return this._cloneInto()}},yd={}.toString;function oi(r){let e=n=>r().update(Jn(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function bs(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let i=BigInt(32),o=BigInt(4294967295),s=Number(t>>i&o),a=Number(t&o),u=n?4:0,c=n?0:4;r.setUint32(e+u,s,n),r.setUint32(e+c,a,n)}var si=(r,e,t)=>r&e^~r&t,ai=(r,e,t)=>r&e^r&t^e&t,wn=class extends gn{constructor(e,t,n,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=yn(this.buffer)}update(e){$n(this);let{view:t,buffer:n,blockLen:i}=this;e=Jn(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(i-this.pos,o-s);if(a===i){let u=yn(e);for(;i<=o-s;s+=i)this.process(u,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){$n(this),ii(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:i,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(n,0),s=0);for(let m=s;m<i;m++)t[m]=0;bs(n,i-8,BigInt(this.length*8),o),this.process(n,0);let a=yn(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let c=u/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<c;m++)a.setUint32(4*m,l[m],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:i,finished:o,destroyed:s,pos:a}=this;return e.length=i,e.pos=a,e.finished=o,e.destroyed=s,i%t&&e.buffer.set(n),e}};var gs=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),at=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ut=new Uint32Array(64),er=class extends wn{constructor(){super(64,32,8,!1),this.A=at[0]|0,this.B=at[1]|0,this.C=at[2]|0,this.D=at[3]|0,this.E=at[4]|0,this.F=at[5]|0,this.G=at[6]|0,this.H=at[7]|0}get(){let{A:e,B:t,C:n,D:i,E:o,F:s,G:a,H:u}=this;return[e,t,n,i,o,s,a,u]}set(e,t,n,i,o,s,a,u){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,t){for(let m=0;m<16;m++,t+=4)ut[m]=e.getUint32(t,!1);for(let m=16;m<64;m++){let d=ut[m-15],p=ut[m-2],b=ve(d,7)^ve(d,18)^d>>>3,f=ve(p,17)^ve(p,19)^p>>>10;ut[m]=f+ut[m-7]+b+ut[m-16]|0}let{A:n,B:i,C:o,D:s,E:a,F:u,G:c,H:l}=this;for(let m=0;m<64;m++){let d=ve(a,6)^ve(a,11)^ve(a,25),p=l+d+si(a,u,c)+gs[m]+ut[m]|0,f=(ve(n,2)^ve(n,13)^ve(n,22))+ai(n,i,o)|0;l=c,c=u,u=a,a=s+p|0,s=o,o=i,i=n,n=p+f|0}n=n+this.A|0,i=i+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,i,o,s,a,u,c,l)}roundClean(){ut.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var ui=oi(()=>new er);var Md=le("Raydium_Util");function ci({fromPublicKey:r,programId:e=hs}){let t=ws.generate().publicKey.toBase58().slice(0,32);return{publicKey:As(r,t,e),seed:t}}function As(r,e,t){let n=Buffer.concat([r.toBuffer(),Buffer.from(e),t.toBuffer()]),i=ui(n);return new ys(i)}var di=le("Raydium_Clmm"),Ve={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},be=class{static createPoolInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b){let f=Q([W("sqrtPriceX64"),F("startTime")]),g=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:Bt.programId,isSigner:!1,isWritable:!1},{pubkey:Ct,isSigner:!1,isWritable:!1}],y=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,startTime:b},y);let A=Buffer.from([...Ve.createPool,...y]);return new _e({keys:g,programId:e,data:A})}static async createPoolInstructions(e){let{connection:t,programId:n,owner:i,mintA:o,mintB:s,ammConfigId:a,initialPriceX64:u,startTime:c,forerunCreate:l}=e,m=ci({fromPublicKey:i,programId:n}),[d,p]=[new x(o.address),new x(s.address)],b=[Bt.createAccountWithSeed({fromPubkey:i,basePubkey:i,seed:m.seed,newAccountPubkey:m.publicKey,lamports:l?0:await t.getMinimumBalanceForRentExemption(jn.span),space:jn.span,programId:n})],{publicKey:f}=zr(n,a,d,p),{publicKey:g}=Un(n,f,d),{publicKey:y}=Un(n,f,p);return b.push(this.createPoolInstruction(n,f,i,a,m.publicKey,d,g,new x(o.programId||Ae),p,y,new x(s.programId||Ae),st(n,f).publicKey,u,c)),{signers:[],instructions:b,instructionTypes:[ae.CreateAccount,ae.ClmmCreatePool],address:{poolId:f,observationId:m.publicKey,mintAVault:g,mintBVault:y},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f,g,y,A,w,P,h,k,B,K,D,q){let _=Q([we("tickLowerIndex"),we("tickUpperIndex"),we("tickArrayLowerStartIndex"),we("tickArrayUpperStartIndex"),W("liquidity"),F("amountMaxA"),F("amountMaxB"),Xe("withMetadata"),ie("optionBaseFlag"),Xe("baseFlag")]),de=[...q?[{pubkey:q,isSigner:!1,isWritable:!0}]:[]],se=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:Ct,isSigner:!1,isWritable:!1},{pubkey:Bt.programId,isSigner:!1,isWritable:!1},{pubkey:Ae,isSigner:!1,isWritable:!1},{pubkey:li,isSigner:!1,isWritable:!1},{pubkey:At,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...de],Be=Buffer.alloc(_.span);_.encode({tickLowerIndex:A,tickUpperIndex:w,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:h,liquidity:k,amountMaxA:B,amountMaxB:K,withMetadata:D==="create",baseFlag:!1,optionBaseFlag:0},Be);let ee=Buffer.from([...Ve.openPosition,...Be]);return new _e({keys:se,programId:e,data:ee})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new x(e.programId),new x(e.id)],b;if(l)b=new x((await l(1))[0]);else{let K=tr.generate();m.push(K),b=K.publicKey}let f=S.getTickArrayStartIndexByTick(i,e.config.tickSpacing),g=S.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:y}=j(d,p,f),{publicKey:A}=j(d,p,g),{publicKey:w}=De(n.wallet,b,Ae),{publicKey:P}=fn(b),{publicKey:h}=Ue(d,b),{publicKey:k}=ft(d,p,i,o),B=this.openPositionFromLiquidityInstruction(d,n.feePayer,p,n.wallet,b,w,P,k,y,A,h,n.tokenAccountA,n.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),i,o,f,g,s,a,u,c);return{signers:m,instructions:[B],instructionTypes:[ae.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:b,tickArrayLower:y,tickArrayUpper:A,positionNftAccount:w,metadataAccount:P,personalPosition:h,protocolPosition:k}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new x(e.programId),new x(e.id)],b;if(l)b=new x((await l(1))[0]);else{let K=tr.generate();m.push(K),b=K.publicKey}let f=S.getTickArrayStartIndexByTick(i,e.config.tickSpacing),g=S.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:y}=j(d,p,f),{publicKey:A}=j(d,p,g),{publicKey:w}=De(n.wallet,b,Ae),{publicKey:P}=fn(b),{publicKey:h}=Ue(d,b),{publicKey:k}=ft(d,p,i,o),B=this.openPositionFromBaseInstruction(d,n.feePayer,p,n.wallet,b,w,P,k,y,A,h,n.tokenAccountA,n.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),i,o,f,g,c,s,a,u,he.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,g])?st(d,p).publicKey:void 0);return{address:{nftMint:b,tickArrayLower:y,tickArrayUpper:A,positionNftAccount:w,metadataAccount:P,personalPosition:h,protocolPosition:k},instructions:[B],signers:m,instructionTypes:[ae.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f,g,y,A,w,P,h,k,B,K,D,q){let _=Q([we("tickLowerIndex"),we("tickUpperIndex"),we("tickArrayLowerStartIndex"),we("tickArrayUpperStartIndex"),W("liquidity"),F("amountMaxA"),F("amountMaxB"),Xe("withMetadata"),ie("optionBaseFlag"),Xe("baseFlag")]),de=[...q?[{pubkey:q,isSigner:!1,isWritable:!0}]:[]],se=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:Ct,isSigner:!1,isWritable:!1},{pubkey:Bt.programId,isSigner:!1,isWritable:!1},{pubkey:Ae,isSigner:!1,isWritable:!1},{pubkey:li,isSigner:!1,isWritable:!1},{pubkey:At,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...de],Be=Buffer.alloc(_.span);_.encode({tickLowerIndex:A,tickUpperIndex:w,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:h,liquidity:new mi(0),amountMaxA:B==="MintA"?K:D,amountMaxB:B==="MintA"?D:K,withMetadata:k==="create",baseFlag:B==="MintA",optionBaseFlag:1},Be);let ee=Buffer.from([...Ve.openPosition,...Be]);return new _e({keys:se,programId:e,data:ee})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,d=[];if(l)m=new x((await l(1))[0]);else{let K=tr.generate();d.push(K),m=K.publicKey}let[p,b]=[new x(e.programId),new x(e.id)],f=S.getTickArrayStartIndexByTick(i,e.config.tickSpacing),g=S.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:y}=j(p,b,f),{publicKey:A}=j(p,b,g),{publicKey:w}=De(n.wallet,m,Ae),{publicKey:P}=fn(m),{publicKey:h}=Ue(p,m),{publicKey:k}=ft(p,b,i,o),B=this.openPositionFromLiquidityInstruction(p,n.wallet,b,n.wallet,m,w,P,k,y,A,h,n.tokenAccountA,n.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(t.mintA.address),new x(t.mintB.address),i,o,f,g,s,a,u,c,he.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,g])?st(p,b).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:y,tickArrayUpper:A,positionNftAccount:w,metadataAccount:P,personalPosition:h,protocolPosition:k},instructions:[B],signers:d,instructionTypes:[ae.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,i,o){let s=Q([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:Bt.programId,isSigner:!1,isWritable:!1},{pubkey:Ae,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...Ve.closePosition,...u]);return new _e({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:i}){let o=new x(e.programId),{publicKey:s}=De(n.wallet,i.nftMint,Ae),{publicKey:a}=Ue(o,i.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,i.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[ae.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f,g,y,A){let w=Q([W("liquidity"),F("amountMaxA"),F("amountMaxB"),ie("optionBaseFlag"),Xe("baseFlag")]),P=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:Ae,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...P],k=Buffer.alloc(w.span);w.encode({liquidity:f,amountMaxA:g,amountMaxB:y,optionBaseFlag:0,baseFlag:!1},k);let B=Buffer.from([...Ve.increaseLiquidity,...k]);return new _e({keys:h,programId:e,data:B})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new x(e.programId),new x(e.id)],l=S.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=S.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=j(u,c,l),{publicKey:p}=j(u,c,m),{publicKey:b}=De(i.wallet,n.nftMint,Ae),{publicKey:f}=Ue(u,n.nftMint),{publicKey:g}=ft(u,c,n.tickLower,n.tickUpper),y=this.increasePositionFromLiquidityInstruction(u,i.wallet,b,f,c,g,d,p,i.tokenAccountA,i.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),o,s,a,he.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?st(u,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:b,personalPosition:f,protocolPosition:g},signers:[],instructions:[y],instructionTypes:[ae.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new x(e.programId),new x(e.id)],l=S.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=S.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=j(u,c,l),{publicKey:p}=j(u,c,m),{publicKey:b}=De(i.wallet,n.nftMint,Ae),{publicKey:f}=Ue(u,n.nftMint),{publicKey:g}=ft(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:b,personalPosition:f,protocolPosition:g},instructions:[this.increasePositionFromBaseInstruction(u,i.wallet,b,f,c,g,d,p,i.tokenAccountA,i.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),o,s,a,he.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?st(u,c).publicKey:void 0)],signers:[],instructionTypes:[ae.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f,g,y,A){let w=Q([W("liquidity"),F("amountMaxA"),F("amountMaxB"),ie("optionBaseFlag"),Xe("baseFlag")]),P=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:Ae,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...P],k=Buffer.alloc(w.span);w.encode({liquidity:new mi(0),amountMaxA:f==="MintA"?g:y,amountMaxB:f==="MintA"?y:g,baseFlag:f==="MintA",optionBaseFlag:1},k);let B=Buffer.from([...Ve.increaseLiquidity,...k]);return new _e({keys:h,programId:e,data:B})}static decreaseLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f,g,y,A,w){let P=Q([W("liquidity"),F("amountMinA"),F("amountMinB")]),h=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...f.map(D=>[{pubkey:D.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:D.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:D.rewardMint,isSigner:!1,isWritable:!1}]).flat()],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:Ae,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:en,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...h],B=Buffer.alloc(P.span);P.encode({liquidity:g,amountMinA:y,amountMinB:A},B);let K=Buffer.from([...Ve.decreaseLiquidity,...B]);return new _e({keys:k,programId:e,data:K})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new x(e.programId),new x(e.id)],m=S.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=S.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=j(c,l,m),{publicKey:b}=j(c,l,d),{publicKey:f}=De(i.wallet,n.nftMint,u),{publicKey:g}=Ue(c,n.nftMint),{publicKey:y}=ft(c,l,n.tickLower,n.tickUpper),A=[];for(let P=0;P<e.rewardDefaultInfos.length;P++)A.push({poolRewardVault:new x(t.rewardInfos[P].vault),ownerRewardVault:i.rewardAccounts[P],rewardMint:new x(e.rewardDefaultInfos[P].mint.address)});let w=[];return w.push(this.decreaseLiquidityInstruction(c,i.wallet,f,g,l,y,p,b,i.tokenAccountA,i.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),A,o,s,a,he.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?st(c,l).publicKey:void 0)),{address:{tickArrayLower:p,tickArrayUpper:b,positionNftAccount:f,personalPosition:g,protocolPosition:y},signers:[],instructions:w,instructionTypes:[ae.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f,g,y){let A=Q([F("amount"),F("otherAmountThreshold"),W("sqrtPriceLimitX64"),Xe("isBaseInput")]),w=[...y?[{pubkey:y,isSigner:!1,isWritable:!0}]:[],...m.map(B=>({pubkey:B,isSigner:!1,isWritable:!0}))],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:Ae,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:en,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...w],h=Buffer.alloc(A.span);A.encode({amount:p,otherAmountThreshold:b,sqrtPriceLimitX64:f,isBaseInput:g},h);let k=Buffer.from([...Ve.swap,...h]);return new _e({keys:P,programId:e,data:k})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,inputMint:i,amountIn:o,amountOutMin:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new x(e.programId),new x(e.id)],[m,d]=[new x(t.vault.A),new x(t.vault.B)],[p,b]=[new x(e.mintA.address),new x(e.mintB.address)],f=e.mintA.address===i.toString(),g=[this.swapInstruction(c,n.wallet,l,new x(e.config.id),f?n.tokenAccountA:n.tokenAccountB,f?n.tokenAccountB:n.tokenAccountA,f?m:d,f?d:m,f?p:b,f?b:p,u,m,o,s,a,!0,st(c,l).publicKey)];return{signers:[],instructions:g,instructionTypes:[ae.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,i,o,s,a,u,c,l,m,d){let p=Q([F("openTime"),F("endTime"),W("emissionsPerSecondX64")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Bt.programId,isSigner:!1,isWritable:!1},{pubkey:Ct,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:ye(l),endTime:ye(m),emissionsPerSecondX64:d},f);let g=Buffer.from([...Ve.initReward,...f]);return new _e({keys:b,programId:e,data:g})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new x(e.programId),new x(e.id)],a=Hr(o,s,i.mint).publicKey,u=Vt(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new x(e.config.id),n.tokenAccount,i.programId,i.mint,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[ae.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,i,o,s,a,u,c,l,m,d){let p=Q([ie("rewardIndex"),W("emissionsPerSecondX64"),F("openTime"),F("endTime")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:Ae,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:ye(l),endTime:ye(m)},f);let g=Buffer.from([...Ve.setRewardEmissions,...f]);return new _e({keys:b,programId:e,data:g})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new x(e.programId),new x(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===i.mint.toString()&&(a=d,u=new x(t.rewardInfos[d].vault),c=new x(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&di.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=Vt(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new x(e.config.id),n.tokenAccount,u,c,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[ae.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,i,o,s,a){let u=Q([ie("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:Ae,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:en,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...Ve.collectReward,...l]);return new _e({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:i}){let[o,s]=[new x(e.programId),new x(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===i.toString()&&(a=l,u=new x(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&di.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,i,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[ae.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapBaseOutInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,outputMint:i,amountOut:o,amountInMax:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new x(e.programId),new x(e.id)],[m,d]=[new x(t.vault.A),new x(t.vault.B)],[p,b]=[new x(e.mintA.address),new x(e.mintB.address)],f=e.mintA.address===i.toString(),g=[this.swapInstruction(c,n.wallet,l,new x(e.config.id),f?n.tokenAccountB:n.tokenAccountA,f?n.tokenAccountA:n.tokenAccountB,f?d:m,f?m:d,f?p:b,f?b:p,u,m,o,s,a,!1)];return{signers:[],instructions:g,instructionTypes:[ae.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}};import Fe from"bn.js";var nr=class extends Dt{constructor(e){super(e)}async load(e){await this.scope.token.load(e)}async createPool(e){var A;let{programId:t,owner:n=((A=this.scope.owner)==null?void 0:A.publicKey)||X.default,mint1:i,mint2:o,ammConfig:s,initialPrice:a,startTime:u,computeBudgetConfig:c,forerunCreate:l,txVersion:m}=e,d=this.createTxBuilder(),[p,b,f]=new Fe(new X(i.address).toBuffer()).gt(new Fe(new X(o.address).toBuffer()))?[o,i,new I(1).div(a)]:[i,o,a],g=O.priceToSqrtPriceX64(f,p.decimals,b.decimals),y=await be.createPoolInstructions({connection:this.scope.connection,programId:t,owner:n,mintA:p,mintB:b,ammConfigId:s.id,initialPriceX64:g,startTime:u,forerunCreate:l});return d.addInstruction(y),d.addCustomComputeBudget(c),d.versionBuild({txVersion:m,extInfo:{address:te(V({},y.address),{programId:t.toString(),id:y.address.poolId.toString(),mintA:p,mintB:b,openTime:u.toNumber(),vault:{A:y.address.mintAVault.toString(),B:y.address.mintBVault.toString()},rewardInfos:[],config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}}),mockPoolInfo:V({type:"Concentrated",rewardDefaultPoolInfos:"Clmm",id:y.address.poolId.toString(),mintA:p,mintB:b,feeRate:s.tradeFeeRate,openTime:u.toNumber(),programId:t.toString(),price:f.toNumber(),config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}},qr),forerunCreate:l}})}async openPositionFromBase({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,associatedOnly:c=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",getEphemeralSigners:d,computeBudgetConfig:p,txVersion:b}){this.scope.availability.addConcentratedPosition===!1&&this.logAndCreateError("add position feature disabled in your region"),this.scope.checkOwner();let f=this.createTxBuilder(),g=null,y=null,A=n.useSOLBalance&&e.mintA.address===$.toString(),w=n.useSOLBalance&&e.mintB.address===$.toString(),[P,h]=s==="MintA"?[a,u]:[u,a],{account:k,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new X(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:A||P.isZero()?{payer:this.scope.ownerPubKey,amount:P}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:c,checkCreateATAOwner:l});k&&(g=k),f.addInstruction(B||{});let{account:K,instructionParams:D}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new X(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:w||h.isZero()?{payer:this.scope.ownerPubKey,amount:h}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:c,checkCreateATAOwner:l});K&&(y=K),f.addInstruction(D||{}),(!g||!y)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let q=t||await this.scope.api.fetchPoolKeysById({id:e.id}),_=await be.openPositionFromBaseInstructions({poolInfo:e,poolKeys:q,ownerInfo:te(V({},n),{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:g,tokenAccountB:y}),tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:m,getEphemeralSigners:d});return f.addInstruction(_),f.addCustomComputeBudget(p),f.versionBuild({txVersion:b,extInfo:_.address})}async openPositionFromLiquidity({poolInfo:e,poolKeys:t,ownerInfo:n,amountMaxA:i,amountMaxB:o,tickLower:s,tickUpper:a,liquidity:u,associatedOnly:c=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",txVersion:d,getEphemeralSigners:p}){this.scope.availability.createConcentratedPosition===!1&&this.logAndCreateError("open position feature disabled in your region");let b=this.createTxBuilder(),f=null,g=null,y=n.useSOLBalance&&e.mintA.address===$.toBase58(),A=n.useSOLBalance&&e.mintB.address===$.toBase58(),{account:w,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new X(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:y?{payer:this.scope.ownerPubKey,amount:i}:void 0,skipCloseAccount:!y,notUseTokenAccount:y,associatedOnly:y?!1:c,checkCreateATAOwner:l});w&&(f=w),b.addInstruction(P||{});let{account:h,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new X(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:A?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:c,checkCreateATAOwner:l});h&&(g=h),b.addInstruction(k||{}),(f===void 0||g===void 0)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let B=t||await this.scope.api.fetchPoolKeysById({id:e.id}),K=await be.openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:B,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:g},tickLower:s,tickUpper:a,liquidity:u,amountMaxA:i,amountMaxB:o,withMetadata:m,getEphemeralSigners:p});return b.addInstruction(K),b.versionBuild({txVersion:d,extInfo:{address:K.address}})}async increasePositionFromLiquidity(e){let{poolInfo:t,ownerPosition:n,amountMaxA:i,amountMaxB:o,liquidity:s,ownerInfo:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:l,txVersion:m}=e,d=this.createTxBuilder(),p,b,f=a.useSOLBalance&&t.mintA.address===$.toString(),g=a.useSOLBalance&&t.mintB.address===$.toString(),{account:y,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new X(t.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:f?{payer:this.scope.ownerPubKey,amount:i}:void 0,skipCloseAccount:!f,associatedOnly:f?!1:u,checkCreateATAOwner:c});y&&(p=y),d.addInstruction(A||{});let{account:w,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({mint:new X(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:g?{payer:this.scope.ownerPubKey,amount:o}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:u,checkCreateATAOwner:c});w&&(b=w),d.addInstruction(P||{}),!p&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let h=await this.scope.api.fetchPoolKeysById({id:t.id}),k=be.increasePositionFromLiquidityInstructions({poolInfo:t,poolKeys:h,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:b},liquidity:s,amountMaxA:i,amountMaxB:o});return d.addInstruction(k),d.addCustomComputeBudget(l),d.versionBuild({txVersion:m,extInfo:{address:k.address}})}async increasePositionFromBase(e){let{poolInfo:t,ownerPosition:n,base:i,baseAmount:o,otherAmountMax:s,ownerInfo:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:l,txVersion:m}=e,d=this.createTxBuilder(),p,b,f=a.useSOLBalance&&t.mintA.address===$.toString(),g=a.useSOLBalance&&t.mintB.address===$.toString(),{account:y,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new X(t.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:f?{payer:this.scope.ownerPubKey,amount:i==="MintA"?o:s}:void 0,skipCloseAccount:!f,associatedOnly:f?!1:u,checkCreateATAOwner:c});y&&(p=y),d.addInstruction(A||{});let{account:w,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({mint:new X(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:g?{payer:this.scope.ownerPubKey,amount:i==="MintA"?s:o}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:u,checkCreateATAOwner:c});w&&(b=w),d.addInstruction(P||{}),!p&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let h=await this.scope.api.fetchPoolKeysById({id:t.id}),k=be.increasePositionFromBaseInstructions({poolInfo:t,poolKeys:h,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:b},base:i,baseAmount:o,otherAmountMax:s});return d.addInstruction(k),d.addCustomComputeBudget(l),d.versionBuild({txVersion:m,extInfo:{address:k.address}})}async decreaseLiquidity(e){let{poolInfo:t,ownerPosition:n,ownerInfo:i,amountMinA:o,amountMinB:s,liquidity:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:l,txVersion:m}=e;this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let d=this.createTxBuilder(),p=i.useSOLBalance&&t.mintA.address===$.toString(),b=i.useSOLBalance&&t.mintB.address===$.toString(),f,g,{account:y,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new X(t.mintA.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!p,associatedOnly:p?!1:u,checkCreateATAOwner:c});f=y,A&&d.addInstruction(A);let{account:w,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new X(t.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!b,associatedOnly:b?!1:u,checkCreateATAOwner:c});g=w,P&&d.addInstruction(P);let h=[];for(let D of t.rewardDefaultInfos){let q=i.useSOLBalance&&D.mint.address===$.toString(),_;if(D.mint.address===t.mintA.address)_=f;else if(D.mint.address===t.mintB.address)_=g;else{let{account:de,instructionParams:se}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X(D.mint.programId),mint:new X(D.mint.address),notUseTokenAccount:q,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!q,associatedOnly:q?!1:u,checkCreateATAOwner:c});_=de,se&&d.addInstruction(se)}h.push(_)}!f&&!g&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccountRawInfos);let k=await this.scope.api.fetchPoolKeysById({id:t.id}),B=await be.decreaseLiquidityInstructions({poolInfo:t,poolKeys:k,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:g,rewardAccounts:h},liquidity:a,amountMinA:o,amountMinB:s});d.addInstruction({instructions:B.instructions,instructionTypes:[ae.ClmmDecreasePosition]});let K=V({},B.address);if(i.closePosition){let D=await be.closePositionInstructions({poolInfo:t,poolKeys:k,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:n});d.addInstruction({endInstructions:D.instructions,endInstructionTypes:D.instructionTypes}),K=V(V({},K),D.address)}return d.addCustomComputeBudget(l),d.versionBuild({txVersion:m,extInfo:{address:K}})}async closePosition({poolInfo:e,ownerPosition:t,txVersion:n}){this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let i=this.createTxBuilder(),o=await this.scope.api.fetchPoolKeysById({id:e.id}),s=be.closePositionInstructions({poolInfo:e,poolKeys:o,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:t});return i.addInstruction(s).versionBuild({txVersion:n,extInfo:{address:s.address}})}async initReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let u=this.createTxBuilder(),c=t.useSOLBalance&&n.mint.address.toString()===$.toString(),l=n.perSecond.mul(n.endTime-n.openTime),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X(n.mint.address),mint:new X(n.mint.address),notUseTokenAccount:!!c,skipCloseAccount:!c,owner:this.scope.ownerPubKey,createInfo:c?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Fe(new I(l.toFixed(0)).gte(l)?l.toFixed(0):l.add(1).toFixed(0))}:void 0,associatedOnly:c?!1:i,checkCreateATAOwner:o});d&&u.addInstruction(d),m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let p=await this.scope.api.fetchPoolKeysById({id:e.id}),b=be.initRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardInfo:{programId:new X(n.mint.programId),mint:new X(n.mint.address),openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:M.decimalToX64(n.perSecond)}});return u.addInstruction(b),u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:b.address}})}async initRewards({poolInfo:e,ownerInfo:t,rewardInfos:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){for(let l of n)l.endTime<=l.openTime&&this.logAndCreateError("reward time error","rewardInfo",l);let u=this.createTxBuilder(),c={};for(let l of n){let m=t.useSOLBalance&&l.mint.address===$.toString(),d=l.perSecond.mul(l.endTime-l.openTime),{account:p,instructionParams:b}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X(l.mint.programId),mint:new X(l.mint.address),notUseTokenAccount:!!m,skipCloseAccount:!m,owner:this.scope.ownerPubKey,createInfo:m?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Fe(new I(d.toFixed(0)).gte(d)?d.toFixed(0):d.add(1).toFixed(0))}:void 0,associatedOnly:m?!1:i,checkCreateATAOwner:o});b&&u.addInstruction(b),p||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let f=await this.scope.api.fetchPoolKeysById({id:e.id}),g=be.initRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:p},rewardInfo:{programId:new X(l.mint.programId),mint:new X(l.mint.address),openTime:l.openTime,endTime:l.endTime,emissionsPerSecondX64:M.decimalToX64(l.perSecond)}});c=V(V({},c),g.address),u.addInstruction(g)}return u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:c}})}async setReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let u=this.createTxBuilder(),c=t.useSOLBalance&&n.mint.equals($),{account:l,instructionParams:m}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.programId,mint:n.mint,notUseTokenAccount:c,owner:this.scope.ownerPubKey,createInfo:c?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Fe(new I(n.perSecond.sub(n.endTime-n.openTime).toFixed(0)).gte(n.perSecond.sub(n.endTime-n.openTime))?n.perSecond.sub(n.endTime-n.openTime).toFixed(0):n.perSecond.sub(n.endTime-n.openTime).add(1).toFixed(0))}:void 0,associatedOnly:c?!1:i,checkCreateATAOwner:o});m&&u.addInstruction(m),l||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let d=await this.scope.api.fetchPoolKeysById({id:e.id}),p=be.setRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:l},rewardInfo:{mint:n.mint,openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:M.decimalToX64(n.perSecond)}});return u.addInstruction(p),u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:p.address}})}async setRewards({poolInfo:e,ownerInfo:t,rewardInfos:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){let u=this.createTxBuilder(),c={};for(let l of n){l.endTime<=l.openTime&&this.logAndCreateError("reward time error","rewardInfo",l);let m=t.useSOLBalance&&l.mint.address===$.toString(),{account:d,instructionParams:p}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X(l.mint.programId),mint:new X(l.mint.address),notUseTokenAccount:m,owner:this.scope.ownerPubKey,createInfo:m?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Fe(new I(l.perSecond.sub(l.endTime-l.openTime).toFixed(0)).gte(l.perSecond.sub(l.endTime-l.openTime))?l.perSecond.sub(l.endTime-l.openTime).toFixed(0):l.perSecond.sub(l.endTime-l.openTime).add(1).toFixed(0))}:void 0,associatedOnly:m?!1:i,checkCreateATAOwner:o});p&&u.addInstruction(p),d||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let b=await this.scope.api.fetchPoolKeysById({id:e.id}),f=be.setRewardInstructions({poolInfo:e,poolKeys:b,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:d},rewardInfo:{mint:new X(l.mint.address),openTime:l.openTime,endTime:l.endTime,emissionsPerSecondX64:M.decimalToX64(l.perSecond)}});u.addInstruction(f),c=V(V({},c),f.address)}return u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:c}})}async collectReward({poolInfo:e,ownerInfo:t,rewardMint:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1}){let s=e.rewardDefaultInfos.find(p=>p.mint.address===n.toString());s||this.logAndCreateError("reward mint error","not found reward mint",n);let a=this.createTxBuilder(),u=t.useSOLBalance&&n.equals($),{account:c,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X(s.mint.programId),mint:n,notUseTokenAccount:u,owner:this.scope.ownerPubKey,skipCloseAccount:!u,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:u?!1:i,checkCreateATAOwner:o});l&&a.addInstruction(l),c||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let m=await this.scope.api.fetchPoolKeysById({id:e.id}),d=be.collectRewardInstructions({poolInfo:e,poolKeys:m,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:c},rewardMint:n});return a.addInstruction(d),a.build({address:d.address})}async collectRewards({poolInfo:e,ownerInfo:t,rewardMints:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1}){let s=this.createTxBuilder(),a={};for(let u of n){let c=e.rewardDefaultInfos.find(f=>f.mint.address===u.toString());if(!c){this.logAndCreateError("reward mint error","not found reward mint",u);continue}let l=t.useSOLBalance&&u.equals($),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X(c.mint.programId),mint:u,notUseTokenAccount:l,owner:this.scope.ownerPubKey,skipCloseAccount:!l,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:l?!1:i,checkCreateATAOwner:o});m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos),d&&s.addInstruction(d);let p=await this.scope.api.fetchPoolKeysById({id:e.id}),b=be.collectRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardMint:u});s.addInstruction(b),a=V(V({},a),b.address)}return s.build({address:a})}async harvestAllRewards({allPoolInfo:e,allPositions:t,ownerInfo:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,programId:s,txVersion:a,computeBudgetConfig:u}){let c={};for(let m of this.scope.account.tokenAccountRawInfos)i?De(this.scope.ownerPubKey,m.accountInfo.mint,s).publicKey.equals(m.pubkey)&&(c[m.accountInfo.mint.toString()]=m.pubkey):c[m.accountInfo.mint.toString()]=m.pubkey;let l=this.createTxBuilder();l.addCustomComputeBudget(u);for(let m of Object.values(e)){if(t[m.id]===void 0||!t[m.id].find(w=>!w.liquidity.isZero()||w.rewardInfos.find(P=>!P.rewardAmountOwed.isZero())))continue;let d=m,p=n.useSOLBalance&&d.mintA.address===$.toString(),b=n.useSOLBalance&&d.mintB.address===$.toString(),f=c[d.mintA.address];if(!f){let{account:w,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:d.mintA.programId,mint:new X(d.mintA.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,skipCloseAccount:!0,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:p?!1:i,checkCreateATAOwner:o});f=w,P&&l.addInstruction(P)}let g=c[d.mintB.address];if(!g){let{account:w,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:d.mintB.programId,mint:new X(d.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,skipCloseAccount:!0,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:b?!1:i,checkCreateATAOwner:o});g=w,P&&l.addInstruction(P)}c[d.mintA.address]=f,c[d.mintB.address]=g;let y=[];for(let w of d.rewardDefaultInfos){let P=n.useSOLBalance&&w.mint.address===$.toString(),h=c[w.mint.address];if(!h){let{account:k,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new X(w.mint.programId),mint:new X(w.mint.address),notUseTokenAccount:P,owner:this.scope.ownerPubKey,skipCloseAccount:!P,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:P?!1:i});h=k,B&&l.addInstruction(B)}c[w.mint.address]=h,y.push(h)}let A=await this.scope.api.fetchPoolKeysById({id:d.id});for(let w of t[m.id]){let P=be.decreaseLiquidityInstructions({poolInfo:d,poolKeys:A,ownerPosition:w,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:g,rewardAccounts:y},liquidity:new Fe(0),amountMinA:new Fe(0),amountMinB:new Fe(0)});l.addInstruction(P)}}return a===0?l.sizeCheckBuildV0():l.sizeCheckBuild()}async getWhiteListMint({programId:e}){let t=await this.scope.connection.getAccountInfo(Vt(e).publicKey);return t?ti.decode(t.data).whitelistMints.filter(i=>!i.equals(X.default)):[]}async computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,token2022Infos:i,amountOut:o,slippage:s,priceLimit:a=new I(0)}){var k;let u=await this.scope.fetchEpochInfo(),c;a.equals(new I(0))?c=n.toString()===e.mintB.address?it.add(Ne):ot.sub(Ne):c=O.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let l=kt(o,(k=i[n.toString()])==null?void 0:k.feeConfig,u,!0),{expectedAmountIn:m,remainingAccounts:d,executionPrice:p,feeAmount:b}=he.getInputAmountAndRemainAccounts(e,t,n,l.amount.sub(l.fee||new Fe(0)),c),f=O.sqrtPriceX64ToPrice(p,e.mintA.decimals,e.mintB.decimals),g=n.toString()===e.mintA.address?f:new I(1).div(f),y=m.mul(new Fe(Math.floor((1+s)*1e10))).div(new Fe(1e10)),A=e.mintA.address===n.toString()?e.price:new I(1).div(e.price),w=new I(g).sub(A).abs(),P=A,h=new je(new I(w).mul(10**15).toFixed(0),new I(P).mul(10**15).toFixed(0));return{amountIn:m,maxAmountIn:y,currentPrice:new I(e.price),executionPrice:g,priceImpact:h,fee:b,remainingAccounts:d}}};export{qo as AMM_CONFIG_SEED,cm as AmmConfigLayout,Dr as BIT_PRECISION,nr as Clmm,be as ClmmInstrument,Yn as EXTENSION_TICKARRAY_BITMAP_SIZE,dn as FEE_RATE_DENOMINATOR,cs as FETCH_TICKARRAY_COUNT,Vo as Fee,vr as LOG_B_2_X32,_r as LOG_B_P_ERR_MARGIN_LOWER_X64,Vr as LOG_B_P_ERR_MARGIN_UPPER_X64,G as LiquidityMath,ot as MAX_SQRT_PRICE_X64,xe as MAX_TICK,it as MIN_SQRT_PRICE_X64,ke as MIN_TICK,M as MathUtil,qn as MaxU64,Er as MaxUint128,Ze as NEGATIVE_ONE,Ne as ONE,zo as OPERATION_SEED,jn as ObservationInfoLayout,os as ObservationLayout,ti as OperationLayout,Uo as POOL_REWARD_VAULT_SEED,Wo as POOL_SEED,Ho as POOL_TICK_ARRAY_BITMAP_SEED,Go as POOL_VAULT_SEED,Xr as POSITION_SEED,lm as PoolInfoLayout,he as PoolUtils,ei as PositionInfoLayout,as as PositionRewardInfoLayout,Ut as PositionUtils,mm as ProtocolPositionLayout,mn as Q128,Re as Q64,ss as RewardInfo,O as SqrtPriceMath,yt as SwapMath,bt as TICK_ARRAY_BITMAP_SIZE,Xo as TICK_ARRAY_SEED,me as TICK_ARRAY_SIZE,Hc as TICK_SPACINGS,$e as TickArrayBitmap,ni as TickArrayBitmapExtensionLayout,Wt as TickArrayBitmapExtensionUtils,Gt as TickArrayLayout,us as TickLayout,gt as TickMath,U as TickQuery,S as TickUtils,vt as U64Resolution,jc as U64_IGNORE_RANGE,z as ZERO,$m as getLiquidityFromAmounts,nl as getPdaAmmConfigId,st as getPdaExBitmapAccount,fn as getPdaMetadataKey,Vt as getPdaOperationAccount,Ue as getPdaPersonalPositionAddress,zr as getPdaPoolId,Hr as getPdaPoolRewardVaulId,Un as getPdaPoolVaultId,ft as getPdaProtocolPositionAddress,j as getPdaTickArrayAddress,Qc as i16ToBytes,pn as i32ToBytes,_t as isZero,Wn as leadingZeros,Ur as leastSignificantBit,Yc as mockCreatePoolInfo,qr as mockV3CreatePoolInfo,Gr as mostSignificantBit,Gn as trailingZeros,Wr as u16ToBytes,$c as u32ToBytes};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=index.mjs.map