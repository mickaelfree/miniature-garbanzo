var wn=Object.defineProperty,Tn=Object.defineProperties;var xn=Object.getOwnPropertyDescriptors;var Ft=Object.getOwnPropertySymbols;var An=Object.prototype.hasOwnProperty,kn=Object.prototype.propertyIsEnumerable;var Ot=(t,e,n)=>e in t?wn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,oe=(t,e)=>{for(var n in e||(e={}))An.call(e,n)&&Ot(t,n,e[n]);if(Ft)for(var n of Ft(e))kn.call(e,n)&&Ot(t,n,e[n]);return t},le=(t,e)=>Tn(t,xn(e));import ue from"bn.js";import{get as Dt,set as Pn}from"lodash";import _t from"dayjs";import Bn from"dayjs/plugin/utc";_t.extend(Bn);var rt=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return _t().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let n=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(n)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Mt={},In={};function Z(t){let e=Dt(Mt,t);if(!e){let n=Dt(In,t);e=new rt({name:t,logLevel:n}),Pn(Mt,t,e)}return e}import{PublicKey as as}from"@solana/web3.js";import cs from"bn.js";import Dr from"big.js";import Go from"bn.js";import z from"bn.js";var ke=9e15,ge=1e9,it="0123456789abcdef",Ve="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Ue="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",ot={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-ke,maxE:ke,crypto:!1},Gt,me,y=!0,Xe="[DecimalError] ",pe=Xe+"Invalid argument: ",Vt=Xe+"Precision limit exceeded",Ut=Xe+"crypto unavailable",Wt="[object Decimal]",V=Math.floor,D=Math.pow,Nn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Sn=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Cn=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Xt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ne=1e7,h=7,Ln=9007199254740991,En=Ve.length-1,st=Ue.length-1,f={toStringTag:Wt};f.absoluteValue=f.abs=function(){var t=new this.constructor(this);return t.s<0&&(t.s=1),g(t)};f.ceil=function(){return g(new this.constructor(this),this.e+1,2)};f.clampedTo=f.clamp=function(t,e){var n,r=this,i=r.constructor;if(t=new i(t),e=new i(e),!t.s||!e.s)return new i(NaN);if(t.gt(e))throw Error(pe+e);return n=r.cmp(t),n<0?t:r.cmp(e)>0?e:new i(r)};f.comparedTo=f.cmp=function(t){var e,n,r,i,o=this,s=o.d,a=(t=new o.constructor(t)).d,c=o.s,u=t.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==t.e)return o.e>t.e^c<0?1:-1;for(r=s.length,i=a.length,e=0,n=r<i?r:i;e<n;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return r===i?0:r>i^c<0?1:-1};f.cosine=f.cos=function(){var t,e,n=this,r=n.constructor;return n.d?n.d[0]?(t=r.precision,e=r.rounding,r.precision=t+Math.max(n.e,n.sd())+h,r.rounding=1,n=Rn(r,jt(r,n)),r.precision=t,r.rounding=e,g(me==2||me==3?n.neg():n,t,e,!0)):new r(1):new r(NaN)};f.cubeRoot=f.cbrt=function(){var t,e,n,r,i,o,s,a,c,u,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(y=!1,o=l.s*D(l.s*l,1/3),!o||Math.abs(o)==1/0?(n=q(l.d),t=l.e,(o=(t-n.length+1)%3)&&(n+=o==1||o==-2?"0":"00"),o=D(n,1/3),t=V((t+1)/3)-(t%3==(t<0?-1:2)),o==1/0?n="5e"+t:(n=o.toExponential(),n=n.slice(0,n.indexOf("e")+1)+t),r=new m(n),r.s=l.s):r=new m(o.toString()),s=(t=m.precision)+3;;)if(a=r,c=a.times(a).times(a),u=c.plus(l),r=I(u.plus(l).times(a),u.plus(c),s+2,1),q(a.d).slice(0,s)===(n=q(r.d)).slice(0,s))if(n=n.slice(s-3,s+1),n=="9999"||!i&&n=="4999"){if(!i&&(g(a,t+1,0),a.times(a).times(a).eq(l))){r=a;break}s+=4,i=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(g(r,t+1,1),e=!r.times(r).times(r).eq(l));break}return y=!0,g(r,t,m.rounding,e)};f.decimalPlaces=f.dp=function(){var t,e=this.d,n=NaN;if(e){if(t=e.length-1,n=(t-V(this.e/h))*h,t=e[t],t)for(;t%10==0;t/=10)n--;n<0&&(n=0)}return n};f.dividedBy=f.div=function(t){return I(this,new this.constructor(t))};f.dividedToIntegerBy=f.divToInt=function(t){var e=this,n=e.constructor;return g(I(e,new n(t),0,1,1),n.precision,n.rounding)};f.equals=f.eq=function(t){return this.cmp(t)===0};f.floor=function(){return g(new this.constructor(this),this.e+1,3)};f.greaterThan=f.gt=function(t){return this.cmp(t)>0};f.greaterThanOrEqualTo=f.gte=function(t){var e=this.cmp(t);return e==1||e===0};f.hyperbolicCosine=f.cosh=function(){var t,e,n,r,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;n=s.precision,r=s.rounding,s.precision=n+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(t=Math.ceil(i/3),e=(1/He(4,t)).toString()):(t=16,e="2.3283064365386962890625e-10"),o=Pe(s,1,o.times(e),new s(1),!0);for(var c,u=t,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return g(o,s.precision=n,s.rounding=r,!0)};f.hyperbolicSine=f.sinh=function(){var t,e,n,r,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(e=o.precision,n=o.rounding,o.precision=e+Math.max(i.e,i.sd())+4,o.rounding=1,r=i.d.length,r<3)i=Pe(o,2,i,i,!0);else{t=1.4*Math.sqrt(r),t=t>16?16:t|0,i=i.times(1/He(5,t)),i=Pe(o,2,i,i,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);t--;)s=i.times(i),i=i.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=n,g(i,e,n,!0)};f.hyperbolicTangent=f.tanh=function(){var t,e,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+7,r.rounding=1,I(n.sinh(),n.cosh(),r.precision=t,r.rounding=e)):new r(n.s)};f.inverseCosine=f.acos=function(){var t,e=this,n=e.constructor,r=e.abs().cmp(1),i=n.precision,o=n.rounding;return r!==-1?r===0?e.isNeg()?te(n,i,o):new n(0):new n(NaN):e.isZero()?te(n,i+4,o).times(.5):(n.precision=i+6,n.rounding=1,e=e.asin(),t=te(n,i+4,o).times(.5),n.precision=i,n.rounding=o,t.minus(e))};f.inverseHyperbolicCosine=f.acosh=function(){var t,e,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(t=r.precision,e=r.rounding,r.precision=t+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,y=!1,n=n.times(n).minus(1).sqrt().plus(n),y=!0,r.precision=t,r.rounding=e,n.ln()):new r(n)};f.inverseHyperbolicSine=f.asinh=function(){var t,e,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,y=!1,n=n.times(n).plus(1).sqrt().plus(n),y=!0,r.precision=t,r.rounding=e,n.ln())};f.inverseHyperbolicTangent=f.atanh=function(){var t,e,n,r,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(t=o.precision,e=o.rounding,r=i.sd(),Math.max(r,t)<2*-i.e-1?g(new o(i),t,e,!0):(o.precision=n=r-i.e,i=I(i.plus(1),new o(1).minus(i),n+t,1),o.precision=t+4,o.rounding=1,i=i.ln(),o.precision=t,o.rounding=e,i.times(.5))):new o(NaN)};f.inverseSine=f.asin=function(){var t,e,n,r,i=this,o=i.constructor;return i.isZero()?new o(i):(e=i.abs().cmp(1),n=o.precision,r=o.rounding,e!==-1?e===0?(t=te(o,n+4,r).times(.5),t.s=i.s,t):new o(NaN):(o.precision=n+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=n,o.rounding=r,i.times(2)))};f.inverseTangent=f.atan=function(){var t,e,n,r,i,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&m+4<=st)return s=te(l,m+4,d).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(m+4<=st)return s=te(l,m+4,d).times(.5),s.s=u.s,s}for(l.precision=a=m+10,l.rounding=1,n=Math.min(28,a/h+2|0),t=n;t;--t)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(y=!1,e=Math.ceil(a/h),r=1,c=u.times(u),s=new l(u),i=u;t!==-1;)if(i=i.times(c),o=s.minus(i.div(r+=2)),i=i.times(c),s=o.plus(i.div(r+=2)),s.d[e]!==void 0)for(t=e;s.d[t]===o.d[t]&&t--;);return n&&(s=s.times(2<<n-1)),y=!0,g(s,l.precision=m,l.rounding=d,!0)};f.isFinite=function(){return!!this.d};f.isInteger=f.isInt=function(){return!!this.d&&V(this.e/h)>this.d.length-2};f.isNaN=function(){return!this.s};f.isNegative=f.isNeg=function(){return this.s<0};f.isPositive=f.isPos=function(){return this.s>0};f.isZero=function(){return!!this.d&&this.d[0]===0};f.lessThan=f.lt=function(t){return this.cmp(t)<0};f.lessThanOrEqualTo=f.lte=function(t){return this.cmp(t)<1};f.logarithm=f.log=function(t){var e,n,r,i,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding,p=5;if(t==null)t=new l(10),e=!0;else{if(t=new l(t),n=t.d,t.s<0||!n||!n[0]||t.eq(1))return new l(NaN);e=t.eq(10)}if(n=u.d,u.s<0||!n||!n[0]||u.eq(1))return new l(n&&!n[0]?-1/0:u.s!=1?NaN:n?0:1/0);if(e)if(n.length>1)o=!0;else{for(i=n[0];i%10===0;)i/=10;o=i!==1}if(y=!1,a=m+p,s=fe(u,a),r=e?We(l,a+10):fe(t,a),c=I(s,r,a,1),Ce(c.d,i=m,d))do if(a+=10,s=fe(u,a),r=e?We(l,a+10):fe(t,a),c=I(s,r,a,1),!o){+q(c.d).slice(i+1,i+15)+1==1e14&&(c=g(c,m+1,0));break}while(Ce(c.d,i+=10,d));return y=!0,g(c,m,d)};f.minus=f.sub=function(t){var e,n,r,i,o,s,a,c,u,l,m,d,p=this,w=p.constructor;if(t=new w(t),!p.d||!t.d)return!p.s||!t.s?t=new w(NaN):p.d?t.s=-t.s:t=new w(t.d||p.s!==t.s?p:NaN),t;if(p.s!=t.s)return t.s=-t.s,p.plus(t);if(u=p.d,d=t.d,a=w.precision,c=w.rounding,!u[0]||!d[0]){if(d[0])t.s=-t.s;else if(u[0])t=new w(p);else return new w(c===3?-0:0);return y?g(t,a,c):t}if(n=V(t.e/h),l=V(p.e/h),u=u.slice(),o=l-n,o){for(m=o<0,m?(e=u,o=-o,s=d.length):(e=d,n=l,s=u.length),r=Math.max(Math.ceil(a/h),s)+2,o>r&&(o=r,e.length=1),e.reverse(),r=o;r--;)e.push(0);e.reverse()}else{for(r=u.length,s=d.length,m=r<s,m&&(s=r),r=0;r<s;r++)if(u[r]!=d[r]){m=u[r]<d[r];break}o=0}for(m&&(e=u,u=d,d=e,t.s=-t.s),s=u.length,r=d.length-s;r>0;--r)u[s++]=0;for(r=d.length;r>o;){if(u[--r]<d[r]){for(i=r;i&&u[--i]===0;)u[i]=ne-1;--u[i],u[r]+=ne}u[r]-=d[r]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--n;return u[0]?(t.d=u,t.e=ze(u,n),y?g(t,a,c):t):new w(c===3?-0:0)};f.modulo=f.mod=function(t){var e,n=this,r=n.constructor;return t=new r(t),!n.d||!t.s||t.d&&!t.d[0]?new r(NaN):!t.d||n.d&&!n.d[0]?g(new r(n),r.precision,r.rounding):(y=!1,r.modulo==9?(e=I(n,t.abs(),0,3,1),e.s*=t.s):e=I(n,t,0,r.modulo,1),e=e.times(t),y=!0,n.minus(e))};f.naturalExponential=f.exp=function(){return at(this)};f.naturalLogarithm=f.ln=function(){return fe(this)};f.negated=f.neg=function(){var t=new this.constructor(this);return t.s=-t.s,g(t)};f.plus=f.add=function(t){var e,n,r,i,o,s,a,c,u,l,m=this,d=m.constructor;if(t=new d(t),!m.d||!t.d)return!m.s||!t.s?t=new d(NaN):m.d||(t=new d(t.d||m.s===t.s?m:NaN)),t;if(m.s!=t.s)return t.s=-t.s,m.minus(t);if(u=m.d,l=t.d,a=d.precision,c=d.rounding,!u[0]||!l[0])return l[0]||(t=new d(m)),y?g(t,a,c):t;if(o=V(m.e/h),r=V(t.e/h),u=u.slice(),i=o-r,i){for(i<0?(n=u,i=-i,s=l.length):(n=l,r=o,s=u.length),o=Math.ceil(a/h),s=o>s?o+1:s+1,i>s&&(i=s,n.length=1),n.reverse();i--;)n.push(0);n.reverse()}for(s=u.length,i=l.length,s-i<0&&(i=s,n=l,l=u,u=n),e=0;i;)e=(u[--i]=u[i]+l[i]+e)/ne|0,u[i]%=ne;for(e&&(u.unshift(e),++r),s=u.length;u[--s]==0;)u.pop();return t.d=u,t.e=ze(u,r),y?g(t,a,c):t};f.precision=f.sd=function(t){var e,n=this;if(t!==void 0&&t!==!!t&&t!==1&&t!==0)throw Error(pe+t);return n.d?(e=zt(n.d),t&&n.e+1>e&&(e=n.e+1)):e=NaN,e};f.round=function(){var t=this,e=t.constructor;return g(new e(t),t.e+1,e.rounding)};f.sine=f.sin=function(){var t,e,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+Math.max(n.e,n.sd())+h,r.rounding=1,n=On(r,jt(r,n)),r.precision=t,r.rounding=e,g(me>2?n.neg():n,t,e,!0)):new r(NaN)};f.squareRoot=f.sqrt=function(){var t,e,n,r,i,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(y=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=q(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=V((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),r=new l(e)):r=new l(u.toString()),n=(c=l.precision)+3;;)if(o=r,r=o.plus(I(s,o,n+2,1)).times(.5),q(o.d).slice(0,n)===(e=q(r.d)).slice(0,n))if(e=e.slice(n-3,n+1),e=="9999"||!i&&e=="4999"){if(!i&&(g(o,c+1,0),o.times(o).eq(s))){r=o;break}n+=4,i=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(g(r,c+1,1),t=!r.times(r).eq(s));break}return y=!0,g(r,c,l.rounding,t)};f.tangent=f.tan=function(){var t,e,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+10,r.rounding=1,n=n.sin(),n.s=1,n=I(n,new r(1).minus(n.times(n)).sqrt(),t+10,0),r.precision=t,r.rounding=e,g(me==2||me==4?n.neg():n,t,e,!0)):new r(NaN)};f.times=f.mul=function(t){var e,n,r,i,o,s,a,c,u,l=this,m=l.constructor,d=l.d,p=(t=new m(t)).d;if(t.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!t.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?t.s/0:t.s*0);for(n=V(l.e/h)+V(t.e/h),c=d.length,u=p.length,c<u&&(o=d,d=p,p=o,s=c,c=u,u=s),o=[],s=c+u,r=s;r--;)o.push(0);for(r=u;--r>=0;){for(e=0,i=c+r;i>r;)a=o[i]+p[r]*d[i-r-1]+e,o[i--]=a%ne|0,e=a/ne|0;o[i]=(o[i]+e)%ne|0}for(;!o[--s];)o.pop();return e?++n:o.shift(),t.d=o,t.e=ze(o,n),y?g(t,m.precision,m.rounding):t};f.toBinary=function(t,e){return ct(this,2,t,e)};f.toDecimalPlaces=f.toDP=function(t,e){var n=this,r=n.constructor;return n=new r(n),t===void 0?n:(X(t,0,ge),e===void 0?e=r.rounding:X(e,0,8),g(n,t+n.e+1,e))};f.toExponential=function(t,e){var n,r=this,i=r.constructor;return t===void 0?n=se(r,!0):(X(t,0,ge),e===void 0?e=i.rounding:X(e,0,8),r=g(new i(r),t+1,e),n=se(r,!0,t+1)),r.isNeg()&&!r.isZero()?"-"+n:n};f.toFixed=function(t,e){var n,r,i=this,o=i.constructor;return t===void 0?n=se(i):(X(t,0,ge),e===void 0?e=o.rounding:X(e,0,8),r=g(new o(i),t+i.e+1,e),n=se(r,!1,t+r.e+1)),i.isNeg()&&!i.isZero()?"-"+n:n};f.toFraction=function(t){var e,n,r,i,o,s,a,c,u,l,m,d,p=this,w=p.d,b=p.constructor;if(!w)return new b(p);if(u=n=new b(1),r=c=new b(0),e=new b(r),o=e.e=zt(w)-p.e-1,s=o%h,e.d[0]=D(10,s<0?h+s:s),t==null)t=o>0?e:u;else{if(a=new b(t),!a.isInt()||a.lt(u))throw Error(pe+a);t=a.gt(e)?o>0?e:u:a}for(y=!1,a=new b(q(w)),l=b.precision,b.precision=o=w.length*h*2;m=I(a,e,0,1,1),i=n.plus(m.times(r)),i.cmp(t)!=1;)n=r,r=i,i=u,u=c.plus(m.times(i)),c=i,i=e,e=a.minus(m.times(i)),a=i;return i=I(t.minus(n),r,0,1,1),c=c.plus(i.times(u)),n=n.plus(i.times(r)),c.s=u.s=p.s,d=I(u,r,o,1).minus(p).abs().cmp(I(c,n,o,1).minus(p).abs())<1?[u,r]:[c,n],b.precision=l,y=!0,d};f.toHexadecimal=f.toHex=function(t,e){return ct(this,16,t,e)};f.toNearest=function(t,e){var n=this,r=n.constructor;if(n=new r(n),t==null){if(!n.d)return n;t=new r(1),e=r.rounding}else{if(t=new r(t),e===void 0?e=r.rounding:X(e,0,8),!n.d)return t.s?n:t;if(!t.d)return t.s&&(t.s=n.s),t}return t.d[0]?(y=!1,n=I(n,t,0,e,1).times(t),y=!0,g(n)):(t.s=n.s,n=t),n};f.toNumber=function(){return+this};f.toOctal=function(t,e){return ct(this,8,t,e)};f.toPower=f.pow=function(t){var e,n,r,i,o,s,a=this,c=a.constructor,u=+(t=new c(t));if(!a.d||!t.d||!a.d[0]||!t.d[0])return new c(D(+a,u));if(a=new c(a),a.eq(1))return a;if(r=c.precision,o=c.rounding,t.eq(1))return g(a,r,o);if(e=V(t.e/h),e>=t.d.length-1&&(n=u<0?-u:u)<=Ln)return i=Ht(c,a,n,r),t.s<0?new c(1).div(i):g(i,r,o);if(s=a.s,s<0){if(e<t.d.length-1)return new c(NaN);if((t.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return n=D(+a,u),e=n==0||!isFinite(n)?V(u*(Math.log("0."+q(a.d))/Math.LN10+a.e+1)):new c(n+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(y=!1,c.rounding=a.s=1,n=Math.min(12,(e+"").length),i=at(t.times(fe(a,r+n)),r),i.d&&(i=g(i,r+5,1),Ce(i.d,r,o)&&(e=r+10,i=g(at(t.times(fe(a,e+n)),e),e+5,1),+q(i.d).slice(r+1,r+15)+1==1e14&&(i=g(i,r+1,0)))),i.s=s,y=!0,c.rounding=o,g(i,r,o))};f.toPrecision=function(t,e){var n,r=this,i=r.constructor;return t===void 0?n=se(r,r.e<=i.toExpNeg||r.e>=i.toExpPos):(X(t,1,ge),e===void 0?e=i.rounding:X(e,0,8),r=g(new i(r),t,e),n=se(r,t<=r.e||r.e<=i.toExpNeg,t)),r.isNeg()&&!r.isZero()?"-"+n:n};f.toSignificantDigits=f.toSD=function(t,e){var n=this,r=n.constructor;return t===void 0?(t=r.precision,e=r.rounding):(X(t,1,ge),e===void 0?e=r.rounding:X(e,0,8)),g(new r(n),t,e)};f.toString=function(){var t=this,e=t.constructor,n=se(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()&&!t.isZero()?"-"+n:n};f.truncated=f.trunc=function(){return g(new this.constructor(this),this.e+1,1)};f.valueOf=f.toJSON=function(){var t=this,e=t.constructor,n=se(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()?"-"+n:n};function q(t){var e,n,r,i=t.length-1,o="",s=t[0];if(i>0){for(o+=s,e=1;e<i;e++)r=t[e]+"",n=h-r.length,n&&(o+=de(n)),o+=r;s=t[e],r=s+"",n=h-r.length,n&&(o+=de(n))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function X(t,e,n){if(t!==~~t||t<e||t>n)throw Error(pe+t)}function Ce(t,e,n,r){var i,o,s,a;for(o=t[0];o>=10;o/=10)--e;return--e<0?(e+=h,i=0):(i=Math.ceil((e+1)/h),e%=h),o=D(10,h-e),a=t[i]%o|0,r==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=n<4&&a==99999||n>3&&a==49999||a==5e4||a==0):s=(n<4&&a+1==o||n>3&&a+1==o/2)&&(t[i+1]/o/100|0)==D(10,e-2)-1||(a==o/2||a==0)&&(t[i+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(r||n<4)&&a==9999||!r&&n>3&&a==4999):s=((r||n<4)&&a+1==o||!r&&n>3&&a+1==o/2)&&(t[i+1]/o/1e3|0)==D(10,e-3)-1,s}function Ge(t,e,n){for(var r,i=[0],o,s=0,a=t.length;s<a;){for(o=i.length;o--;)i[o]*=e;for(i[0]+=it.indexOf(t.charAt(s++)),r=0;r<i.length;r++)i[r]>n-1&&(i[r+1]===void 0&&(i[r+1]=0),i[r+1]+=i[r]/n|0,i[r]%=n)}return i.reverse()}function Rn(t,e){var n,r,i;if(e.isZero())return e;r=e.d.length,r<32?(n=Math.ceil(r/3),i=(1/He(4,n)).toString()):(n=16,i="2.3283064365386962890625e-10"),t.precision+=n,e=Pe(t,1,e.times(i),new t(1));for(var o=n;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return t.precision-=n,e}var I=function(){function t(r,i,o){var s,a=0,c=r.length;for(r=r.slice();c--;)s=r[c]*i+a,r[c]=s%o|0,a=s/o|0;return a&&r.unshift(a),r}function e(r,i,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(r[a]!=i[a]){c=r[a]>i[a]?1:-1;break}return c}function n(r,i,o,s){for(var a=0;o--;)r[o]-=a,a=r[o]<i[o]?1:0,r[o]=a*s+r[o]-i[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,i,o,s,a,c){var u,l,m,d,p,w,b,F,B,K,P,O,we,ce,et,ve,Se,tt,ee,Ke,qe=r.constructor,nt=r.s==i.s?1:-1,G=r.d,C=i.d;if(!G||!G[0]||!C||!C[0])return new qe(!r.s||!i.s||(G?C&&G[0]==C[0]:!C)?NaN:G&&G[0]==0||!C?nt*0:nt/0);for(c?(p=1,l=r.e-i.e):(c=ne,p=h,l=V(r.e/p)-V(i.e/p)),ee=C.length,Se=G.length,B=new qe(nt),K=B.d=[],m=0;C[m]==(G[m]||0);m++);if(C[m]>(G[m]||0)&&l--,o==null?(ce=o=qe.precision,s=qe.rounding):a?ce=o+(r.e-i.e)+1:ce=o,ce<0)K.push(1),w=!0;else{if(ce=ce/p+2|0,m=0,ee==1){for(d=0,C=C[0],ce++;(m<Se||d)&&ce--;m++)et=d*c+(G[m]||0),K[m]=et/C|0,d=et%C|0;w=d||m<Se}else{for(d=c/(C[0]+1)|0,d>1&&(C=t(C,d,c),G=t(G,d,c),ee=C.length,Se=G.length),ve=ee,P=G.slice(0,ee),O=P.length;O<ee;)P[O++]=0;Ke=C.slice(),Ke.unshift(0),tt=C[0],C[1]>=c/2&&++tt;do d=0,u=e(C,P,ee,O),u<0?(we=P[0],ee!=O&&(we=we*c+(P[1]||0)),d=we/tt|0,d>1?(d>=c&&(d=c-1),b=t(C,d,c),F=b.length,O=P.length,u=e(b,P,F,O),u==1&&(d--,n(b,ee<F?Ke:C,F,c))):(d==0&&(u=d=1),b=C.slice()),F=b.length,F<O&&b.unshift(0),n(P,b,O,c),u==-1&&(O=P.length,u=e(C,P,ee,O),u<1&&(d++,n(P,ee<O?Ke:C,O,c))),O=P.length):u===0&&(d++,P=[0]),K[m++]=d,u&&P[0]?P[O++]=G[ve]||0:(P=[G[ve]],O=1);while((ve++<Se||P[0]!==void 0)&&ce--);w=P[0]!==void 0}K[0]||K.shift()}if(p==1)B.e=l,Gt=w;else{for(m=1,d=K[0];d>=10;d/=10)m++;B.e=m+l*p-1,g(B,a?o+B.e+1:o,s,w)}return B}}();function g(t,e,n,r){var i,o,s,a,c,u,l,m,d,p=t.constructor;e:if(e!=null){if(m=t.d,!m)return t;for(i=1,a=m[0];a>=10;a/=10)i++;if(o=e-i,o<0)o+=h,s=e,l=m[d=0],c=l/D(10,i-s-1)%10|0;else if(d=Math.ceil((o+1)/h),a=m.length,d>=a)if(r){for(;a++<=d;)m.push(0);l=c=0,i=1,o%=h,s=o-h+1}else break e;else{for(l=a=m[d],i=1;a>=10;a/=10)i++;o%=h,s=o-h+i,c=s<0?0:l/D(10,i-s-1)%10|0}if(r=r||e<0||m[d+1]!==void 0||(s<0?l:l%D(10,i-s-1)),u=n<4?(c||r)&&(n==0||n==(t.s<0?3:2)):c>5||c==5&&(n==4||r||n==6&&(o>0?s>0?l/D(10,i-s):0:m[d-1])%10&1||n==(t.s<0?8:7)),e<1||!m[0])return m.length=0,u?(e-=t.e+1,m[0]=D(10,(h-e%h)%h),t.e=-e||0):m[0]=t.e=0,t;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=D(10,h-o),m[d]=s>0?(l/D(10,i-s)%D(10,s)|0)*a:0),u)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(t.e++,m[0]==ne&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=ne)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return y&&(t.e>p.maxE?(t.d=null,t.e=NaN):t.e<p.minE&&(t.e=0,t.d=[0])),t}function se(t,e,n){if(!t.isFinite())return Zt(t);var r,i=t.e,o=q(t.d),s=o.length;return e?(n&&(r=n-s)>0?o=o.charAt(0)+"."+o.slice(1)+de(r):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(t.e<0?"e":"e+")+t.e):i<0?(o="0."+de(-i-1)+o,n&&(r=n-s)>0&&(o+=de(r))):i>=s?(o+=de(i+1-s),n&&(r=n-i-1)>0&&(o=o+"."+de(r))):((r=i+1)<s&&(o=o.slice(0,r)+"."+o.slice(r)),n&&(r=n-s)>0&&(i+1===s&&(o+="."),o+=de(r))),o}function ze(t,e){var n=t[0];for(e*=h;n>=10;n/=10)e++;return e}function We(t,e,n){if(e>En)throw y=!0,n&&(t.precision=n),Error(Vt);return g(new t(Ve),e,1,!0)}function te(t,e,n){if(e>st)throw Error(Vt);return g(new t(Ue),e,n,!0)}function zt(t){var e=t.length-1,n=e*h+1;if(e=t[e],e){for(;e%10==0;e/=10)n--;for(e=t[0];e>=10;e/=10)n++}return n}function de(t){for(var e="";t--;)e+="0";return e}function Ht(t,e,n,r){var i,o=new t(1),s=Math.ceil(r/h+4);for(y=!1;;){if(n%2&&(o=o.times(e),Kt(o.d,s)&&(i=!0)),n=V(n/2),n===0){n=o.d.length-1,i&&o.d[n]===0&&++o.d[n];break}e=e.times(e),Kt(e.d,s)}return y=!0,o}function vt(t){return t.d[t.d.length-1]&1}function Yt(t,e,n){for(var r,i=new t(e[0]),o=0;++o<e.length;)if(r=new t(e[o]),r.s)i[n](r)&&(i=r);else{i=r;break}return i}function at(t,e){var n,r,i,o,s,a,c,u=0,l=0,m=0,d=t.constructor,p=d.rounding,w=d.precision;if(!t.d||!t.d[0]||t.e>17)return new d(t.d?t.d[0]?t.s<0?0:1/0:1:t.s?t.s<0?0:t:0/0);for(e==null?(y=!1,c=w):c=e,a=new d(.03125);t.e>-2;)t=t.times(a),m+=5;for(r=Math.log(D(2,m))/Math.LN10*2+5|0,c+=r,n=o=s=new d(1),d.precision=c;;){if(o=g(o.times(t),c,1),n=n.times(++l),a=s.plus(I(o,n,c,1)),q(a.d).slice(0,c)===q(s.d).slice(0,c)){for(i=m;i--;)s=g(s.times(s),c,1);if(e==null)if(u<3&&Ce(s.d,c-r,p,u))d.precision=c+=10,n=o=a=new d(1),l=0,u++;else return g(s,d.precision=w,p,y=!0);else return d.precision=w,s}s=a}}function fe(t,e){var n,r,i,o,s,a,c,u,l,m,d,p=1,w=10,b=t,F=b.d,B=b.constructor,K=B.rounding,P=B.precision;if(b.s<0||!F||!F[0]||!b.e&&F[0]==1&&F.length==1)return new B(F&&!F[0]?-1/0:b.s!=1?NaN:F?0:b);if(e==null?(y=!1,l=P):l=e,B.precision=l+=w,n=q(F),r=n.charAt(0),Math.abs(o=b.e)<15e14){for(;r<7&&r!=1||r==1&&n.charAt(1)>3;)b=b.times(t),n=q(b.d),r=n.charAt(0),p++;o=b.e,r>1?(b=new B("0."+n),o++):b=new B(r+"."+n.slice(1))}else return u=We(B,l+2,P).times(o+""),b=fe(new B(r+"."+n.slice(1)),l-w).plus(u),B.precision=P,e==null?g(b,P,K,y=!0):b;for(m=b,c=s=b=I(b.minus(1),b.plus(1),l,1),d=g(b.times(b),l,1),i=3;;){if(s=g(s.times(d),l,1),u=c.plus(I(s,new B(i),l,1)),q(u.d).slice(0,l)===q(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(We(B,l+2,P).times(o+""))),c=I(c,new B(p),l,1),e==null)if(Ce(c.d,l-w,K,a))B.precision=l+=w,u=s=b=I(m.minus(1),m.plus(1),l,1),d=g(b.times(b),l,1),i=a=1;else return g(c,B.precision=P,K,y=!0);else return B.precision=P,c;c=u,i+=2}}function Zt(t){return String(t.s*t.s/0)}function ut(t,e){var n,r,i;for((n=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(n<0&&(n=r),n+=+e.slice(r+1),e=e.substring(0,r)):n<0&&(n=e.length),r=0;e.charCodeAt(r)===48;r++);for(i=e.length;e.charCodeAt(i-1)===48;--i);if(e=e.slice(r,i),e){if(i-=r,t.e=n=n-r-1,t.d=[],r=(n+1)%h,n<0&&(r+=h),r<i){for(r&&t.d.push(+e.slice(0,r)),i-=h;r<i;)t.d.push(+e.slice(r,r+=h));e=e.slice(r),r=h-e.length}else r-=i;for(;r--;)e+="0";t.d.push(+e),y&&(t.e>t.constructor.maxE?(t.d=null,t.e=NaN):t.e<t.constructor.minE&&(t.e=0,t.d=[0]))}else t.e=0,t.d=[0];return t}function Fn(t,e){var n,r,i,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Xt.test(e))return ut(t,e)}else if(e==="Infinity"||e==="NaN")return+e||(t.s=NaN),t.e=NaN,t.d=null,t;if(Sn.test(e))n=16,e=e.toLowerCase();else if(Nn.test(e))n=2;else if(Cn.test(e))n=8;else throw Error(pe+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,r=t.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,i=Ht(r,new r(n),o,o*2)),u=Ge(e,n,ne),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new r(t.s*0):(t.e=ze(u,l),t.d=u,y=!1,s&&(t=I(t,i,a*4)),c&&(t=t.times(Math.abs(c)<54?D(2,c):Le.pow(2,c))),y=!0,t)}function On(t,e){var n,r=e.d.length;if(r<3)return e.isZero()?e:Pe(t,2,e,e);n=1.4*Math.sqrt(r),n=n>16?16:n|0,e=e.times(1/He(5,n)),e=Pe(t,2,e,e);for(var i,o=new t(5),s=new t(16),a=new t(20);n--;)i=e.times(e),e=e.times(o.plus(i.times(s.times(i).minus(a))));return e}function Pe(t,e,n,r,i){var o,s,a,c,u=1,l=t.precision,m=Math.ceil(l/h);for(y=!1,c=n.times(n),a=new t(r);;){if(s=I(a.times(c),new t(e++*e++),l,1),a=i?r.plus(s):r.minus(s),r=I(s.times(c),new t(e++*e++),l,1),s=a.plus(r),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=r,r=s,s=o,u++}return y=!0,s.d.length=m+1,s}function He(t,e){for(var n=t;--e;)n*=t;return n}function jt(t,e){var n,r=e.s<0,i=te(t,t.precision,1),o=i.times(.5);if(e=e.abs(),e.lte(o))return me=r?4:1,e;if(n=e.divToInt(i),n.isZero())me=r?3:2;else{if(e=e.minus(n.times(i)),e.lte(o))return me=vt(n)?r?2:3:r?4:1,e;me=vt(n)?r?1:4:r?3:2}return e.minus(i).abs()}function ct(t,e,n,r){var i,o,s,a,c,u,l,m,d,p=t.constructor,w=n!==void 0;if(w?(X(n,1,ge),r===void 0?r=p.rounding:X(r,0,8)):(n=p.precision,r=p.rounding),!t.isFinite())l=Zt(t);else{for(l=se(t),s=l.indexOf("."),w?(i=2,e==16?n=n*4-3:e==8&&(n=n*3-2)):i=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=Ge(se(d),10,i),d.e=d.d.length),m=Ge(l,10,i),o=c=m.length;m[--c]==0;)m.pop();if(!m[0])l=w?"0p+0":"0";else{if(s<0?o--:(t=new p(t),t.d=m,t.e=o,t=I(t,d,n,r,0,i),m=t.d,o=t.e,u=Gt),s=m[n],a=i/2,u=u||m[n+1]!==void 0,u=r<4?(s!==void 0||u)&&(r===0||r===(t.s<0?3:2)):s>a||s===a&&(r===4||u||r===6&&m[n-1]&1||r===(t.s<0?8:7)),m.length=n,u)for(;++m[--n]>i-1;)m[n]=0,n||(++o,m.unshift(1));for(c=m.length;!m[c-1];--c);for(s=0,l="";s<c;s++)l+=it.charAt(m[s]);if(w){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(m=Ge(l,i,e),c=m.length;!m[c-1];--c);for(s=1,l="1.";s<c;s++)l+=it.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return t.s<0?"-"+l:l}function Kt(t,e){if(t.length>e)return t.length=e,!0}function Dn(t){return new this(t).abs()}function Mn(t){return new this(t).acos()}function _n(t){return new this(t).acosh()}function vn(t,e){return new this(t).plus(e)}function Kn(t){return new this(t).asin()}function qn(t){return new this(t).asinh()}function Gn(t){return new this(t).atan()}function Vn(t){return new this(t).atanh()}function Un(t,e){t=new this(t),e=new this(e);var n,r=this.precision,i=this.rounding,o=r+4;return!t.s||!e.s?n=new this(NaN):!t.d&&!e.d?(n=te(this,o,1).times(e.s>0?.25:.75),n.s=t.s):!e.d||t.isZero()?(n=e.s<0?te(this,r,i):new this(0),n.s=t.s):!t.d||e.isZero()?(n=te(this,o,1).times(.5),n.s=t.s):e.s<0?(this.precision=o,this.rounding=1,n=this.atan(I(t,e,o,1)),e=te(this,o,1),this.precision=r,this.rounding=i,n=t.s<0?n.minus(e):n.plus(e)):n=this.atan(I(t,e,o,1)),n}function Wn(t){return new this(t).cbrt()}function Xn(t){return g(t=new this(t),t.e+1,2)}function zn(t,e,n){return new this(t).clamp(e,n)}function Hn(t){if(!t||typeof t!="object")throw Error(Xe+"Object expected");var e,n,r,i=t.defaults===!0,o=["precision",1,ge,"rounding",0,8,"toExpNeg",-ke,0,"toExpPos",0,ke,"maxE",0,ke,"minE",-ke,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(n=o[e],i&&(this[n]=ot[n]),(r=t[n])!==void 0)if(V(r)===r&&r>=o[e+1]&&r<=o[e+2])this[n]=r;else throw Error(pe+n+": "+r);if(n="crypto",i&&(this[n]=ot[n]),(r=t[n])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error(Ut);else this[n]=!1;else throw Error(pe+n+": "+r);return this}function Yn(t){return new this(t).cos()}function Zn(t){return new this(t).cosh()}function Qt(t){var e,n,r;function i(o){var s,a,c,u=this;if(!(u instanceof i))return new i(o);if(u.constructor=i,qt(o)){u.s=o.s,y?!o.d||o.e>i.maxE?(u.e=NaN,u.d=null):o.e<i.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;y?s>i.maxE?(u.e=NaN,u.d=null):s<i.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return ut(u,o.toString())}else if(c!=="string")throw Error(pe+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),Xt.test(o)?ut(u,o):Fn(u,o)}if(i.prototype=f,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=Hn,i.clone=Qt,i.isDecimal=qt,i.abs=Dn,i.acos=Mn,i.acosh=_n,i.add=vn,i.asin=Kn,i.asinh=qn,i.atan=Gn,i.atanh=Vn,i.atan2=Un,i.cbrt=Wn,i.ceil=Xn,i.clamp=zn,i.cos=Yn,i.cosh=Zn,i.div=jn,i.exp=Qn,i.floor=Jn,i.hypot=$n,i.ln=er,i.log=tr,i.log10=rr,i.log2=nr,i.max=ir,i.min=or,i.mod=sr,i.mul=ar,i.pow=ur,i.random=cr,i.round=lr,i.sign=mr,i.sin=dr,i.sinh=fr,i.sqrt=pr,i.sub=gr,i.sum=hr,i.tan=br,i.tanh=yr,i.trunc=wr,t===void 0&&(t={}),t&&t.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<r.length;)t.hasOwnProperty(n=r[e++])||(t[n]=this[n]);return i.config(t),i}function jn(t,e){return new this(t).div(e)}function Qn(t){return new this(t).exp()}function Jn(t){return g(t=new this(t),t.e+1,3)}function $n(){var t,e,n=new this(0);for(y=!1,t=0;t<arguments.length;)if(e=new this(arguments[t++]),e.d)n.d&&(n=n.plus(e.times(e)));else{if(e.s)return y=!0,new this(1/0);n=e}return y=!0,n.sqrt()}function qt(t){return t instanceof Le||t&&t.toStringTag===Wt||!1}function er(t){return new this(t).ln()}function tr(t,e){return new this(t).log(e)}function nr(t){return new this(t).log(2)}function rr(t){return new this(t).log(10)}function ir(){return Yt(this,arguments,"lt")}function or(){return Yt(this,arguments,"gt")}function sr(t,e){return new this(t).mod(e)}function ar(t,e){return new this(t).mul(e)}function ur(t,e){return new this(t).pow(e)}function cr(t){var e,n,r,i,o=0,s=new this(1),a=[];if(t===void 0?t=this.precision:X(t,1,ge),r=Math.ceil(t/h),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(r));o<r;)i=e[o],i>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(r*=4);o<r;)i=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(i%1e7),o+=4);o=r/4}else throw Error(Ut);else for(;o<r;)a[o++]=Math.random()*1e7|0;for(r=a[--o],t%=h,r&&t&&(i=D(10,h-t),a[o]=(r/i|0)*i);a[o]===0;o--)a.pop();if(o<0)n=0,a=[0];else{for(n=-1;a[0]===0;n-=h)a.shift();for(r=1,i=a[0];i>=10;i/=10)r++;r<h&&(n-=h-r)}return s.e=n,s.d=a,s}function lr(t){return g(t=new this(t),t.e+1,this.rounding)}function mr(t){return t=new this(t),t.d?t.d[0]?t.s:0*t.s:t.s||NaN}function dr(t){return new this(t).sin()}function fr(t){return new this(t).sinh()}function pr(t){return new this(t).sqrt()}function gr(t,e){return new this(t).sub(e)}function hr(){var t=0,e=arguments,n=new this(e[t]);for(y=!1;n.s&&++t<e.length;)n=n.plus(e[t]);return y=!0,g(n,this.precision,this.rounding)}function br(t){return new this(t).tan()}function yr(t){return new this(t).tanh()}function wr(t){return g(t=new this(t),t.e+1,1)}f[Symbol.for("nodejs.util.inspect.custom")]=f.toString;f[Symbol.toStringTag]="Decimal";var Le=f.constructor=Qt(ot);Ve=new Le(Ve);Ue=new Le(Ue);var _=Le;import{PublicKey as ft}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Tr}from"@solana/spl-token";import{PublicKey as E,SystemProgram as xr,SYSVAR_RENT_PUBKEY as Ar}from"@solana/web3.js";function lt({pubkey:t,isSigner:e=!1,isWritable:n=!0}){return{pubkey:t,isWritable:n,isSigner:e}}var pi=[lt({pubkey:Tr,isWritable:!1}),lt({pubkey:xr.programId,isWritable:!1}),lt({pubkey:Ar,isWritable:!1})];function Jt({publicKey:t,transformSol:e}){let n=$t(t.toString());if(n instanceof E)return e&&n.equals(Be)?mt:n;if(e&&n.toString()===Be.toBase58())return mt;if(typeof n=="string"){if(n===E.default.toBase58())return E.default;try{return new E(n)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function $t(t){try{return new E(t)}catch{return t}}var gi=new E("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),hi=new E("SysvarRent111111111111111111111111111111111"),bi=new E("SysvarC1ock11111111111111111111111111111111"),kr=new E("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),yi=new E("Sysvar1nstructions1111111111111111111111111"),wi=new E("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ti=new E("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),xi=new E("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ai=new E("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),ki=new E("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Pi=new E("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Bi=new E("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ii=new E("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ni=new E("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Si=new E("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ci=new E("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),mt=new E("So11111111111111111111111111111111111111112"),Be=E.default;import{PublicKey as Pr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as en}from"@solana/spl-token";var dt={chainId:101,address:Pr.default.toBase58(),programId:en.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Te={chainId:101,address:"So11111111111111111111111111111111111111112",programId:en.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var pt=class{constructor({mint:e,decimals:n,symbol:r,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===Be.toBase58()||e instanceof ft&&Be.equals(e)){this.decimals=Te.decimals,this.symbol=Te.symbol,this.name=Te.name,this.mint=new ft(Te.address),this.isToken2022=!1;return}this.decimals=n,this.symbol=r||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?ft.default:Jt({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},xe=pt;xe.WSOL=new pt(le(oe({},Te),{mint:Te.address}));import Ze from"big.js";import Nr from"bn.js";import Sr from"decimal.js-light";import Br from"toformat";var Ir=Br,Ee=Ir;var Ye=Z("module/fraction"),gt=Ee(Ze),Re=Ee(Sr),Cr={[0]:Re.ROUND_DOWN,[1]:Re.ROUND_HALF_UP,[2]:Re.ROUND_UP},Lr={[0]:Ze.roundDown,[1]:Ze.roundHalfUp,[2]:Ze.roundUp},L=class{constructor(e,n=new Nr(1)){this.numerator=he(e),this.denominator=he(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new L(this.denominator,this.numerator)}add(e){let n=e instanceof L?e:new L(he(e));return this.denominator.eq(n.denominator)?new L(this.numerator.add(n.numerator),this.denominator):new L(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(e){let n=e instanceof L?e:new L(he(e));return this.denominator.eq(n.denominator)?new L(this.numerator.sub(n.numerator),this.denominator):new L(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(e){let n=e instanceof L?e:new L(he(e));return new L(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(e){let n=e instanceof L?e:new L(he(e));return new L(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(e,n={groupSeparator:""},r=1){Number.isInteger(e)||Ye.logWithError(`${e} is not an integer.`),e<=0&&Ye.logWithError(`${e} is not positive.`),Re.set({precision:e+1,rounding:Cr[r]});let i=new Re(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),n)}toFixed(e,n={groupSeparator:""},r=1){return Number.isInteger(e)||Ye.logWithError(`${e} is not an integer.`),e<0&&Ye.logWithError(`${e} is negative.`),gt.DP=e,gt.RM=Lr[r]||1,new gt(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,n)}isZero(){return this.numerator.isZero()}};var to=Z("Raydium_price");var ht=class{constructor({decimals:e,symbol:n="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=n,this.name=r}equals(e){return this===e}},je=ht;je.SOL=new ht(dt);import Rr from"bn.js";var co=new L(new Rr(100));var Fr=new z(0),Co=new z(1),Lo=new z(2),Eo=new z(3),Ro=new z(5),Or=new z(10),Fo=new z(100),Oo=new z(1e3),Do=new z(1e4),tn=9007199254740991;function he(t){let e=Z("Raydium_parseBigNumberish");if(t instanceof z)return t;if(typeof t=="string"){if(t.match(/^-?[0-9]+$/))return new z(t);e.logWithError(`invalid BigNumberish string: ${t}`)}return typeof t=="number"?(t%1&&e.logWithError(`BigNumberish number underflow: ${t}`),(t>=tn||t<=-tn)&&e.logWithError(`BigNumberish number overflow: ${t}`),new z(String(t))):typeof t=="bigint"?new z(t.toString()):(e.error(`invalid BigNumberish value: ${t}`),new z(0))}var Zo=Z("Raydium_amount"),jo=Ee(Dr);import{PublicKey as oa,sendAndConfirmTransaction as sa,Transaction as ua,TransactionMessage as la,VersionedTransaction as ma}from"@solana/web3.js";import fa from"axios";import{PublicKey as bs,ComputeBudgetProgram as ys,Transaction as Ts,TransactionMessage as As,Keypair as ks,VersionedTransaction as Bs}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ns}from"@solana/spl-token";var Ls=Z("Raydium_txUtil");import{PublicKey as Mr,AddressLookupTableAccount as nn}from"@solana/web3.js";import{PublicKey as Ms}from"@solana/web3.js";import{getTransferFeeConfig as vs,unpackMint as Ks}from"@solana/spl-token";var Vs=Z("Raydium_accountInfo_util");var _r={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new nn({key:new Mr("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:nn.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as H}from"@solana/web3.js";var ka=new H("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Pa=new H("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ba=new H("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Ia=new H("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Na=new H("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Sa=new H("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Ca=new H("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),La=new H("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Ea=new H("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Ra=new H("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Fa=new H("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Oa=new H("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Da=new H("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Ma=new H("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi");import{PublicKey as Ka}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Va}from"@solana/spl-token";import re from"bn.js";var Fe=1e4;function ie(t,e,n,r){if(e===void 0)return{amount:t,fee:void 0,expirationTime:void 0};let i=le(oe({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=n.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,s=new re(o.maximumFee.toString()),a=n.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*n.slotsInEpoch-n.absoluteSlot)*400/1e3:void 0;if(r)if(o.transferFeeBasisPoints===Fe){let c=new re(o.maximumFee.toString());return{amount:t.add(c),fee:c,expirationTime:a}}else{let c=Tt(t.mul(new re(Fe)),new re(Fe-o.transferFeeBasisPoints)),u=new re(o.maximumFee.toString()),l=c.sub(t).gt(u)?t.add(u):c,m=Tt(l.mul(new re(o.transferFeeBasisPoints)),new re(Fe)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let c=Tt(t.mul(new re(o.transferFeeBasisPoints)),new re(Fe)),u=c.gt(s)?s:c;return{amount:t,fee:u,expirationTime:a}}}function Oe(t,e){return t===void 0?e:e===void 0?t:Math.min(t,e)}function Tt(t,e){let{div:n,mod:r}=t.divmod(e);return r.gt(new re(0))?n.add(new re(1)):n}import ae from"bn.js";var j=new ae(0),be=new ae(1),on=new ae(-1),Q=new ae(1).shln(64),Qe=new ae(1).shln(128),xt=Q.sub(be),De=64,sn=Qe.subn(1),Ae=-443636,Ie=-Ae,At=new ae("4295048016"),kt=new ae("79226673521066979257578248091"),an=16,un="59543866431248",cn="184467440737095516",ln="15793534762490258745",Kr=new ae(10).pow(new ae(6));var lu=new ae("18446744073700000000");import k from"bn.js";var bu=Buffer.from("amm_config","utf8"),yu=Buffer.from("pool","utf8"),wu=Buffer.from("pool_vault","utf8"),Tu=Buffer.from("pool_reward_vault","utf8"),xu=Buffer.from("position","utf8"),Au=Buffer.from("tick_array","utf8"),ku=Buffer.from("operation","utf8"),Pu=Buffer.from("pool_tick_array_bitmap_extension","utf8");import{PublicKey as dl}from"@solana/web3.js";import hl from"bn.js";import Qc from"bn.js";import{PublicKey as Yr}from"@solana/web3.js";import pn,{isBN as gn}from"bn.js";import{bits as Nu,BitStructure as Su,blob as qr,Blob as Cu,cstr as Lu,f32 as Eu,f32be as Ru,f64 as Fu,f64be as Ou,greedy as Du,Layout as Gr,ns64 as Mu,ns64be as _u,nu64 as vu,nu64be as Ku,offset as qu,s16 as Gu,s16be as Vu,s24 as Uu,s24be as Wu,s32 as Vr,s32be as Xu,s40 as zu,s40be as Hu,s48 as Yu,s48be as Zu,s8 as ju,seq as Ur,struct as Qu,Structure as Wr,u16 as Xr,u16be as Ju,u24 as $u,u24be as ec,u32 as tc,u32be as nc,u40 as rc,u40be as ic,u48 as oc,u48be as sc,u8 as zr,UInt as Hr,union as ac,Union as uc,unionLayoutDiscriminator as cc,utf8 as lc}from"@solana/buffer-layout";var Pt=Gr,mn=Wr;var Bt=Hr;var dn=zr,Ne=Xr;var ye=Vr;var fn=Ur;var J=qr;var Me=class extends Pt{constructor(n,r,i){super(n,i);this.blob=J(n),this.signed=r}decode(n,r=0){let i=new pn(this.blob.decode(n,r),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(n,r,i=0){return typeof n=="number"&&(n=new pn(n)),this.signed&&(n=n.toTwos(this.span*8)),this.blob.encode(n.toArrayLike(Buffer,"le",this.span),r,i)}};function $(t){return new Bt(1,t)}function _e(t){return new Bt(4,t)}function N(t){return new Me(8,!1,t)}function S(t){return new Me(16,!1,t)}function hn(t){return new Me(16,!0,t)}var Je=class extends Pt{constructor(n,r,i,o){super(n.span,o);this.layout=n,this.decoder=r,this.encoder=i}decode(n,r){return this.decoder(this.layout.decode(n,r))}encode(n,r,i){return this.layout.encode(this.encoder(n),r,i)}getSpan(n,r){return this.layout.getSpan(n,r)}};function M(t){return new Je(J(32),e=>new Yr(e),e=>e.toBuffer(),t)}function bn(t){return new Je(dn(),Zr,jr,t)}function Zr(t){if(t===0)return!1;if(t===1)return!0;throw new Error("Invalid bool: "+t)}function jr(t){return t?1:0}var It=class extends mn{decode(e,n){return super.decode(e,n)}};function Y(t,e,n){return new It(t,e,n)}function R(t,e,n){let r,i=typeof e=="number"?e:gn(e)?e.toNumber():new Proxy(e,{get(o,s){if(!r){let a=Reflect.get(o,"count");r=gn(a)?a.toNumber():a,Reflect.set(o,"count",r)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(r=a),Reflect.set(o,s,a)}});return fn(t,i,n)}var Nt=14;var Mc=Y([J(8),$("bump"),Ne("index"),M(""),_e("protocolFeeRate"),_e("tradeFeeRate"),Ne("tickSpacing"),R(N(),8,"")]),Jr=Y([_e("blockTimestamp"),S("sqrtPriceX64"),S("cumulativeTimePriceX64"),R(S(),1,"")]),_c=Y([J(8),bn("initialized"),M("poolId"),R(Jr,1e3,"observations"),R(S(),5,"")]),$r=Y([$("rewardState"),N("openTime"),N("endTime"),N("lastUpdateTime"),S("emissionsPerSecondX64"),N("rewardTotalEmissioned"),N("rewardClaimed"),M("tokenMint"),M("tokenVault"),M("creator"),S("rewardGrowthGlobalX64")]),vc=Y([J(8),$("bump"),M("ammConfig"),M("creator"),M("mintA"),M("mintB"),M("vaultA"),M("vaultB"),M("observationId"),$("mintDecimalsA"),$("mintDecimalsB"),Ne("tickSpacing"),S("liquidity"),S("sqrtPriceX64"),ye("tickCurrent"),Ne("observationIndex"),Ne("observationUpdateDuration"),S("feeGrowthGlobalX64A"),S("feeGrowthGlobalX64B"),N("protocolFeesTokenA"),N("protocolFeesTokenB"),S("swapInAmountTokenA"),S("swapOutAmountTokenB"),S("swapInAmountTokenB"),S("swapOutAmountTokenA"),$("status"),R($(),7,""),R($r,3,"rewardInfos"),R(N(),16,"tickArrayBitmap"),N("totalFeesTokenA"),N("totalFeesClaimedTokenA"),N("totalFeesTokenB"),N("totalFeesClaimedTokenB"),N("fundFeesTokenA"),N("fundFeesTokenB"),N("startTime"),R(N(),15*4-3,"padding")]),ei=Y([S("growthInsideLastX64"),N("rewardAmountOwed")]),ti=Y([J(8),$("bump"),M("nftMint"),M("poolId"),ye("tickLower"),ye("tickUpper"),S("liquidity"),S("feeGrowthInsideLastX64A"),S("feeGrowthInsideLastX64B"),N("tokenFeesOwedA"),N("tokenFeesOwedB"),R(ei,3,"rewardInfos"),R(N(),8,"")]),Kc=Y([J(8),$("bump"),M("poolId"),ye("tickLowerIndex"),ye("tickUpperIndex"),S("liquidity"),S("feeGrowthInsideLastX64A"),S("feeGrowthInsideLastX64B"),N("tokenFeesOwedA"),N("tokenFeesOwedB"),R(S(),3,"rewardGrowthInside"),R(N(),8,"")]),ni=Y([ye("tick"),hn("liquidityNet"),S("liquidityGross"),S("feeGrowthOutsideX64A"),S("feeGrowthOutsideX64B"),R(S(),3,"rewardGrowthsOutsideX64"),R(_e(),13,"")]),yn=Y([J(8),M("poolId"),ye("startTickIndex"),R(ni,$e,"ticks"),$("initializedTickCount"),R($(),115,"")]),qc=Y([J(329),R(M(),100,"whitelistMints")]),ri=Y([J(8),M("poolId"),R(R(N(),8),Nt,"positiveTickArrayBitmap"),R(R(N(),8),Nt,"negativeTickArrayBitmap")]);var $e=60;var A=class{static mulDivRoundingUp(e,n,r){let i=e.mul(n),o=i.div(r);return i.mod(r).eq(j)||(o=o.add(be)),o}static mulDivFloor(e,n,r){if(r.eq(j))throw new Error("division by 0");return e.mul(n).div(r)}static mulDivCeil(e,n,r){if(r.eq(j))throw new Error("division by 0");return e.mul(n).add(r.sub(be)).div(r)}static x64ToDecimal(e,n){return new _(e.toString()).div(_.pow(2,64)).toDecimalPlaces(n)}static decimalToX64(e){return new k(e.mul(_.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,n){return e.add(Qe).sub(n).mod(Qe)}};function v(t,e){return Rt(t.mul(e),64,256)}function ii(t,e,n){let r=t.toTwos(n).shln(e);return r.imaskn(n+1),r.fromTwos(n)}function Rt(t,e,n){let r=t.toTwos(n).shrn(e);return r.imaskn(n-e+1),r.fromTwos(n-e)}var W=class{static sqrtPriceX64ToPrice(e,n,r){return A.x64ToDecimal(e).pow(2).mul(_.pow(10,n-r))}static priceToSqrtPriceX64(e,n,r){return A.decimalToX64(e.mul(_.pow(10,r-n)).sqrt())}static getNextSqrtPriceX64FromInput(e,n,r,i){if(!e.gt(j))throw new Error("sqrtPriceX64 must greater than 0");if(!n.gt(j))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,n,r,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,n,r,!0)}static getNextSqrtPriceX64FromOutput(e,n,r,i){if(!e.gt(j))throw new Error("sqrtPriceX64 must greater than 0");if(!n.gt(j))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,n,r,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,n,r,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,n,r,i){if(r.eq(j))return e;let o=n.shln(De);if(i){let s=o,a=o.add(r.mul(e));return a.gte(s)?A.mulDivCeil(s,e,a):A.mulDivRoundingUp(s,be,s.div(e).add(r))}else{let s=r.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return A.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,n,r,i){let o=r.shln(De);if(i)return e.add(o.div(n));{let s=A.mulDivRoundingUp(o,be,n);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Ae||e>Ie)throw new Error("tick must be in MIN_TICK and MAX_TICK");let n=e<0?e*-1:e,r=(n&1)!=0?new k("18445821805675395072"):new k("18446744073709551616");return(n&2)!=0&&(r=v(r,new k("18444899583751176192"))),(n&4)!=0&&(r=v(r,new k("18443055278223355904"))),(n&8)!=0&&(r=v(r,new k("18439367220385607680"))),(n&16)!=0&&(r=v(r,new k("18431993317065453568"))),(n&32)!=0&&(r=v(r,new k("18417254355718170624"))),(n&64)!=0&&(r=v(r,new k("18387811781193609216"))),(n&128)!=0&&(r=v(r,new k("18329067761203558400"))),(n&256)!=0&&(r=v(r,new k("18212142134806163456"))),(n&512)!=0&&(r=v(r,new k("17980523815641700352"))),(n&1024)!=0&&(r=v(r,new k("17526086738831433728"))),(n&2048)!=0&&(r=v(r,new k("16651378430235570176"))),(n&4096)!=0&&(r=v(r,new k("15030750278694412288"))),(n&8192)!=0&&(r=v(r,new k("12247334978884435968"))),(n&16384)!=0&&(r=v(r,new k("8131365268886854656"))),(n&32768)!=0&&(r=v(r,new k("3584323654725218816"))),(n&65536)!=0&&(r=v(r,new k("696457651848324352"))),(n&131072)!=0&&(r=v(r,new k("26294789957507116"))),(n&262144)!=0&&(r=v(r,new k("37481735321082"))),e>0&&(r=sn.div(r)),r}static getTickFromPrice(e,n,r){return W.getTickFromSqrtPriceX64(W.priceToSqrtPriceX64(e,n,r))}static getTickFromSqrtPriceX64(e){if(e.gt(kt)||e.lt(At))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let n=e.bitLength()-1,r=new k(n-64),i=ii(r,32,128),o=new k("8000000000000000","hex"),s=0,a=new k(0),c=n>=64?e.shrn(n-63):e.shln(63-n);for(;o.gt(new k(0))&&s<an;){c=c.mul(c);let w=c.shrn(127);c=c.shrn(63+w.toNumber()),a=a.add(o.mul(w)),o=o.shrn(1),s+=1}let u=a.shrn(32),m=i.add(u).mul(new k(un)),d=Rt(m.sub(new k(cn)),64,128).toNumber(),p=Rt(m.add(new k(ln)),64,128).toNumber();return d==p?d:W.getSqrtPriceX64FromTick(p).lte(e)?p:d}};var U=class{static addDelta(e,n){return e.add(n)}static getTokenAmountAFromLiquidity(e,n,r,i){if(e.gt(n)&&([e,n]=[n,e]),!e.gt(j))throw new Error("sqrtPriceX64A must greater than 0");let o=r.ushln(De),s=n.sub(e);return i?A.mulDivRoundingUp(A.mulDivCeil(o,s,n),be,e):A.mulDivFloor(o,s,n).div(e)}static getTokenAmountBFromLiquidity(e,n,r,i){if(e.gt(n)&&([e,n]=[n,e]),!e.gt(j))throw new Error("sqrtPriceX64A must greater than 0");return i?A.mulDivCeil(r,n.sub(e),Q):A.mulDivFloor(r,n.sub(e),Q)}static getLiquidityFromTokenAmountA(e,n,r,i){e.gt(n)&&([e,n]=[n,e]);let o=r.mul(e).mul(n),s=n.sub(e),a=o.div(s);return i?A.mulDivRoundingUp(a,be,xt):a.shrn(De)}static getLiquidityFromTokenAmountB(e,n,r){return e.gt(n)&&([e,n]=[n,e]),A.mulDivFloor(r,xt,n.sub(e))}static getLiquidityFromTokenAmounts(e,n,r,i,o){if(n.gt(r)&&([n,r]=[r,n]),e.lte(n))return U.getLiquidityFromTokenAmountA(n,r,i,!1);if(e.lt(r)){let s=U.getLiquidityFromTokenAmountA(e,r,i,!1),a=U.getLiquidityFromTokenAmountB(n,e,o);return s.lt(a)?s:a}else return U.getLiquidityFromTokenAmountB(n,r,o)}static getAmountsFromLiquidity(e,n,r,i,o){if(n.gt(r)&&([n,r]=[r,n]),e.lte(n))return{amountA:U.getTokenAmountAFromLiquidity(n,r,i,o),amountB:new k(0)};if(e.lt(r)){let s=U.getTokenAmountAFromLiquidity(e,r,i,o),a=U.getTokenAmountBFromLiquidity(n,e,i,o);return{amountA:s,amountB:a}}else return{amountA:new k(0),amountB:U.getTokenAmountBFromLiquidity(n,r,i,o)}}static getAmountsFromLiquidityWithSlippage(e,n,r,i,o,s,a){let{amountA:c,amountB:u}=U.getAmountsFromLiquidity(e,n,r,i,s),l=o?1+a:1-a,m=new k(new _(c.toString()).mul(l).toFixed(0)),d=new k(new _(u.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:n,tickUpper:r,liquidity:i,slippage:o,add:s,epochInfo:a,amountAddFee:c}){var K,P,O,we;let u=W.priceToSqrtPriceX64(new _(e.price),e.mintA.decimals,e.mintB.decimals),l=W.getSqrtPriceX64FromTick(n),m=W.getSqrtPriceX64FromTick(r),d=s?1+o:1-o,p=U.getAmountsFromLiquidity(u,l,m,i,s),[w,b]=[ie(p.amountA,(K=e.mintA.extensions)==null?void 0:K.feeConfig,a,c),ie(p.amountB,(P=e.mintB.extensions)==null?void 0:P.feeConfig,a,c)],[F,B]=[ie(new k(new _(p.amountA.toString()).mul(d).toFixed(0)),(O=e.mintA.extensions)==null?void 0:O.feeConfig,a,c),ie(new k(new _(p.amountB.toString()).mul(d).toFixed(0)),(we=e.mintB.extensions)==null?void 0:we.feeConfig,a,c)];return{liquidity:i,amountA:w,amountB:b,amountSlippageA:F,amountSlippageB:B,expirationTime:Oe(w.expirationTime,b.expirationTime)}}};var Et=class{static getfeeGrowthInside(e,n,r){let i=new ue(0),o=new ue(0);e.tickCurrent>=n.tick?(i=n.feeGrowthOutsideX64A,o=n.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let s=new ue(0),a=new ue(0);e.tickCurrent<r.tick?(s=r.feeGrowthOutsideX64A,a=r.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(r.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(r.feeGrowthOutsideX64B));let c=A.wrappingSubU128(A.wrappingSubU128(e.feeGrowthGlobalX64A,i),s),u=A.wrappingSubU128(A.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:c,feeGrowthInsideBX64:u}}static GetPositionFees(e,n,r,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,r,i),a=A.mulDivFloor(A.wrappingSubU128(o,n.feeGrowthInsideLastX64A),n.liquidity,Q),c=n.tokenFeesOwedA.add(a),u=A.mulDivFloor(A.wrappingSubU128(s,n.feeGrowthInsideLastX64B),n.liquidity,Q),l=n.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionFeesV2(e,n,r,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,r,i),a=A.mulDivFloor(A.wrappingSubU128(o,n.feeGrowthInsideLastX64A),n.liquidity,Q),c=n.tokenFeesOwedA.add(a),u=A.mulDivFloor(A.wrappingSubU128(s,n.feeGrowthInsideLastX64B),n.liquidity,Q),l=n.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,n,r,i){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,r,i,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=n.rewardInfos[a],l=A.wrappingSubU128(c,u.growthInsideLastX64),m=A.mulDivFloor(l,n.liquidity,Q),d=u.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,n,r,i){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,r,i,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=n.rewardInfos[a],l=A.wrappingSubU128(c,u.growthInsideLastX64),m=A.mulDivFloor(l,n.liquidity,Q),d=u.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,n,r,i){let o=[];for(let s=0;s<i.length;s++){let a=new ue(0);n.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<n.tick?a=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s]):a=n.rewardGrowthsOutsideX64[s];let c=new ue(0);r.liquidityGross.eqn(0)||(e<r.tick?c=r.rewardGrowthsOutsideX64[s]:c=i[s].rewardGrowthGlobalX64.sub(r.rewardGrowthsOutsideX64[s])),o.push(A.wrappingSubU128(A.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),c))}return o}static getRewardGrowthInsideV2(e,n,r,i){let o=[];for(let s=0;s<i.length;s++){let a=new ue(0);n.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<n.tick?a=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s]):a=n.rewardGrowthsOutsideX64[s];let c=new ue(0);r.liquidityGross.eqn(0)||(e<r.tick?c=r.rewardGrowthsOutsideX64[s]:c=i[s].rewardGrowthGlobalX64.sub(r.rewardGrowthsOutsideX64[s])),o.push(A.wrappingSubU128(A.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),c))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:n,liquidity:r,slippage:i,add:o,epochInfo:s}){var F,B,K,P;let a=W.priceToSqrtPriceX64(new _(e.price),e.mintA.decimals,e.mintB.decimals),c=W.getSqrtPriceX64FromTick(n.tickLower),u=W.getSqrtPriceX64FromTick(n.tickUpper),l=o?1+i:1-i,m=U.getAmountsFromLiquidity(a,c,u,r,o),[d,p]=[ie(m.amountA,(F=e.mintA.extensions)==null?void 0:F.feeConfig,s,!0),ie(m.amountB,(B=e.mintB.extensions)==null?void 0:B.feeConfig,s,!0)],[w,b]=[ie(new ue(new _(m.amountA.toString()).mul(l).toFixed(0)),(K=e.mintA.extensions)==null?void 0:K.feeConfig,s,!0),ie(new ue(new _(m.amountB.toString()).mul(l).toFixed(0)),(P=e.mintB.extensions)==null?void 0:P.feeConfig,s,!0)];return{liquidity:r,amountA:d,amountB:p,amountSlippageA:w,amountSlippageB:b,expirationTime:Oe(d.expirationTime,p.expirationTime)}}};export{Et as PositionUtils};
//# sourceMappingURL=position.mjs.map