var Oi=Object.defineProperty,Di=Object.defineProperties;var _i=Object.getOwnPropertyDescriptors;var On=Object.getOwnPropertySymbols;var vi=Object.prototype.hasOwnProperty,Wi=Object.prototype.propertyIsEnumerable;var Dn=(i,e,t)=>e in i?Oi(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,te=(i,e)=>{for(var t in e||(e={}))vi.call(e,t)&&Dn(i,t,e[t]);if(On)for(var t of On(e))Wi.call(e,t)&&Dn(i,t,e[t]);return i},se=(i,e)=>Di(i,_i(e));import{TOKEN_PROGRAM_ID as fe,TOKEN_2022_PROGRAM_ID as tt,ASSOCIATED_TOKEN_PROGRAM_ID as Ri}from"@solana/spl-token";import{PublicKey as T,TransactionInstruction as Ee,SystemProgram as ht,Keypair as Mn}from"@solana/web3.js";import Ei from"bn.js";import{get as _n,set as qi}from"lodash";import Wn from"dayjs";import Gi from"dayjs/plugin/utc";Wn.extend(Gi);var Jt=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Wn().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},vn={},Vi={};function ce(i){let e=_n(vn,i);if(!e){let t=_n(Vi,i);e=new Jt({name:i,logLevel:t}),qi(vn,i,e)}return e}import{PublicKey as Ea}from"@solana/web3.js";import Fa from"bn.js";import Qr from"big.js";import Vt from"bn.js";import Pe from"bn.js";var mt=9e15,Qe=1e9,en="0123456789abcdef",Lt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Rt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",tn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-mt,maxE:mt,crypto:!1},Un,Ge,C=!0,Mt="[DecimalError] ",Ze=Mt+"Invalid argument: ",Xn=Mt+"Precision limit exceeded",zn=Mt+"crypto unavailable",Hn="[object Decimal]",pe=Math.floor,re=Math.pow,Ui=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Xi=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,zi=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,jn=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ce=1e7,I=7,Hi=9007199254740991,ji=Lt.length-1,nn=Rt.length-1,y={toStringTag:Hn};y.absoluteValue=y.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),B(i)};y.ceil=function(){return B(new this.constructor(this),this.e+1,2)};y.clampedTo=y.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(Ze+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};y.comparedTo=y.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};y.cosine=y.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+I,n.rounding=1,t=Yi(n,Jn(n,t)),n.precision=i,n.rounding=e,B(Ge==2||Ge==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};y.cubeRoot=y.cbrt=function(){var i,e,t,n,r,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(C=!1,o=l.s*re(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=le(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=re(t,1/3),i=pe((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=H(c.plus(l).times(a),c.plus(u),s+2,1),le(a.d).slice(0,s)===(t=le(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(B(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(B(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return C=!0,B(n,i,m.rounding,e)};y.decimalPlaces=y.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-pe(this.e/I))*I,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};y.dividedBy=y.div=function(i){return H(this,new this.constructor(i))};y.dividedToIntegerBy=y.divToInt=function(i){var e=this,t=e.constructor;return B(H(e,new t(i),0,1,1),t.precision,t.rounding)};y.equals=y.eq=function(i){return this.cmp(i)===0};y.floor=function(){return B(new this.constructor(this),this.e+1,3)};y.greaterThan=y.gt=function(i){return this.cmp(i)>0};y.greaterThanOrEqualTo=y.gte=function(i){var e=this.cmp(i);return e==1||e===0};y.hyperbolicCosine=y.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/Ot(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=dt(s,1,o.times(e),new s(1),!0);for(var u,c=i,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return B(o,s.precision=t,s.rounding=n,!0)};y.hyperbolicSine=y.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=dt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/Ot(5,i)),r=dt(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,B(r,e,t,!0)};y.hyperbolicTangent=y.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,H(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};y.inverseCosine=y.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Ke(t,r,o):new t(0):new t(NaN):e.isZero()?Ke(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Ke(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};y.inverseHyperbolicCosine=y.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,C=!1,t=t.times(t).minus(1).sqrt().plus(t),C=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};y.inverseHyperbolicSine=y.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,C=!1,t=t.times(t).plus(1).sqrt().plus(t),C=!0,n.precision=i,n.rounding=e,t.ln())};y.inverseHyperbolicTangent=y.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?B(new o(r),i,e,!0):(o.precision=t=n-r.e,r=H(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};y.inverseSine=y.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Ke(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};y.inverseTangent=y.atan=function(){var i,e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=nn)return s=Ke(l,m+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=nn)return s=Ke(l,m+4,d).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/I+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(C=!1,e=Math.ceil(a/I),n=1,u=c.times(c),s=new l(c),r=c;i!==-1;)if(r=r.times(u),o=s.minus(r.div(n+=2)),r=r.times(u),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),C=!0,B(s,l.precision=m,l.rounding=d,!0)};y.isFinite=function(){return!!this.d};y.isInteger=y.isInt=function(){return!!this.d&&pe(this.e/I)>this.d.length-2};y.isNaN=function(){return!this.s};y.isNegative=y.isNeg=function(){return this.s<0};y.isPositive=y.isPos=function(){return this.s>0};y.isZero=function(){return!!this.d&&this.d[0]===0};y.lessThan=y.lt=function(i){return this.cmp(i)<0};y.lessThanOrEqualTo=y.lte=function(i){return this.cmp(i)<1};y.logarithm=y.log=function(i){var e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding,f=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(C=!1,a=m+f,s=Ye(c,a),n=e?Et(l,a+10):Ye(i,a),u=H(s,n,a,1),wt(u.d,r=m,d))do if(a+=10,s=Ye(c,a),n=e?Et(l,a+10):Ye(i,a),u=H(s,n,a,1),!o){+le(u.d).slice(r+1,r+15)+1==1e14&&(u=B(u,m+1,0));break}while(wt(u.d,r+=10,d));return C=!0,B(u,m,d)};y.minus=y.sub=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,f=this,b=f.constructor;if(i=new b(i),!f.d||!i.d)return!f.s||!i.s?i=new b(NaN):f.d?i.s=-i.s:i=new b(i.d||f.s!==i.s?f:NaN),i;if(f.s!=i.s)return i.s=-i.s,f.plus(i);if(c=f.d,d=i.d,a=b.precision,u=b.rounding,!c[0]||!d[0]){if(d[0])i.s=-i.s;else if(c[0])i=new b(f);else return new b(u===3?-0:0);return C?B(i,a,u):i}if(t=pe(i.e/I),l=pe(f.e/I),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=d.length):(e=d,t=l,s=c.length),n=Math.max(Math.ceil(a/I),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){m=c[n]<d[n];break}o=0}for(m&&(e=c,c=d,d=e,i.s=-i.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(r=n;r&&c[--r]===0;)c[r]=Ce-1;--c[r],c[n]+=Ce}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=Ft(c,t),C?B(i,a,u):i):new b(u===3?-0:0)};y.modulo=y.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?B(new n(t),n.precision,n.rounding):(C=!1,n.modulo==9?(e=H(t,i.abs(),0,3,1),e.s*=i.s):e=H(t,i,0,n.modulo,1),e=e.times(i),C=!0,t.minus(e))};y.naturalExponential=y.exp=function(){return rn(this)};y.naturalLogarithm=y.ln=function(){return Ye(this)};y.negated=y.neg=function(){var i=new this.constructor(this);return i.s=-i.s,B(i)};y.plus=y.add=function(i){var e,t,n,r,o,s,a,u,c,l,m=this,d=m.constructor;if(i=new d(i),!m.d||!i.d)return!m.s||!i.s?i=new d(NaN):m.d||(i=new d(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(c=m.d,l=i.d,a=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(i=new d(m)),C?B(i,a,u):i;if(o=pe(m.e/I),n=pe(i.e/I),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/I),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=c.length,r=l.length,s-r<0&&(r=s,t=l,l=c,c=t),e=0;r;)e=(c[--r]=c[r]+l[r]+e)/Ce|0,c[r]%=Ce;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=Ft(c,n),C?B(i,a,u):i};y.precision=y.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(Ze+i);return t.d?(e=Yn(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};y.round=function(){var i=this,e=i.constructor;return B(new e(i),i.e+1,e.rounding)};y.sine=y.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+I,n.rounding=1,t=Qi(n,Jn(n,t)),n.precision=i,n.rounding=e,B(Ge>2?t.neg():t,i,e,!0)):new n(NaN)};y.squareRoot=y.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(C=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=le(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=pe((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(H(s,o,t+2,1)).times(.5),le(o.d).slice(0,t)===(e=le(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(B(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(B(n,u+1,1),i=!n.times(n).eq(s));break}return C=!0,B(n,u,l.rounding,i)};y.tangent=y.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=H(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,B(Ge==2||Ge==4?t.neg():t,i,e,!0)):new n(NaN)};y.times=y.mul=function(i){var e,t,n,r,o,s,a,u,c,l=this,m=l.constructor,d=l.d,f=(i=new m(i)).d;if(i.s*=l.s,!d||!d[0]||!f||!f[0])return new m(!i.s||d&&!d[0]&&!f||f&&!f[0]&&!d?NaN:!d||!f?i.s/0:i.s*0);for(t=pe(l.e/I)+pe(i.e/I),u=d.length,c=f.length,u<c&&(o=d,d=f,f=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)a=o[r]+f[n]*d[r-n-1]+e,o[r--]=a%Ce|0,e=a/Ce|0;o[r]=(o[r]+e)%Ce|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=Ft(o,t),C?B(i,m.precision,m.rounding):i};y.toBinary=function(i,e){return sn(this,2,i,e)};y.toDecimalPlaces=y.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(xe(i,0,Qe),e===void 0?e=n.rounding:xe(e,0,8),B(t,i+t.e+1,e))};y.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Fe(n,!0):(xe(i,0,Qe),e===void 0?e=r.rounding:xe(e,0,8),n=B(new r(n),i+1,e),t=Fe(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};y.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Fe(r):(xe(i,0,Qe),e===void 0?e=o.rounding:xe(e,0,8),n=B(new o(r),i+r.e+1,e),t=Fe(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};y.toFraction=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,f=this,b=f.d,p=f.constructor;if(!b)return new p(f);if(c=t=new p(1),n=u=new p(0),e=new p(n),o=e.e=Yn(b)-f.e-1,s=o%I,e.d[0]=re(10,s<0?I+s:s),i==null)i=o>0?e:c;else{if(a=new p(i),!a.isInt()||a.lt(c))throw Error(Ze+a);i=a.gt(e)?o>0?e:c:a}for(C=!1,a=new p(le(b)),l=p.precision,p.precision=o=b.length*I*2;m=H(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(m.times(r)),u=r,r=e,e=a.minus(m.times(r)),a=r;return r=H(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=f.s,d=H(c,n,o,1).minus(f).abs().cmp(H(u,t,o,1).minus(f).abs())<1?[c,n]:[u,t],p.precision=l,C=!0,d};y.toHexadecimal=y.toHex=function(i,e){return sn(this,16,i,e)};y.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:xe(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(C=!1,t=H(t,i,0,e,1).times(i),C=!0,B(t)):(i.s=t.s,t=i),t};y.toNumber=function(){return+this};y.toOctal=function(i,e){return sn(this,8,i,e)};y.toPower=y.pow=function(i){var e,t,n,r,o,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(re(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,i.eq(1))return B(a,n,o);if(e=pe(i.e/I),e>=i.d.length-1&&(t=c<0?-c:c)<=Hi)return r=Zn(u,a,t,n),i.s<0?new u(1).div(r):B(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=re(+a,c),e=t==0||!isFinite(t)?pe(c*(Math.log("0."+le(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(C=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=rn(i.times(Ye(a,n+t)),n),r.d&&(r=B(r,n+5,1),wt(r.d,n,o)&&(e=n+10,r=B(rn(i.times(Ye(a,e+t)),e),e+5,1),+le(r.d).slice(n+1,n+15)+1==1e14&&(r=B(r,n+1,0)))),r.s=s,C=!0,u.rounding=o,B(r,n,o))};y.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Fe(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(xe(i,1,Qe),e===void 0?e=r.rounding:xe(e,0,8),n=B(new r(n),i,e),t=Fe(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};y.toSignificantDigits=y.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(xe(i,1,Qe),e===void 0?e=n.rounding:xe(e,0,8)),B(new n(t),i,e)};y.toString=function(){var i=this,e=i.constructor,t=Fe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};y.truncated=y.trunc=function(){return B(new this.constructor(this),this.e+1,1)};y.valueOf=y.toJSON=function(){var i=this,e=i.constructor,t=Fe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function le(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=I-n.length,t&&(o+=je(t)),o+=n;s=i[e],n=s+"",t=I-n.length,t&&(o+=je(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function xe(i,e,t){if(i!==~~i||i<e||i>t)throw Error(Ze+i)}function wt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=I,r=0):(r=Math.ceil((e+1)/I),e%=I),o=re(10,I-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==re(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==re(10,e-3)-1,s}function Ct(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=en.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function Yi(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/Ot(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=dt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var H=function(){function i(n,r,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*r+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=r[a]){u=n[a]>r[a]?1:-1;break}return u}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,u){var c,l,m,d,f,b,p,g,h,A,w,x,k,K,L,D,z,q,G,Ae,ue=n.constructor,Te=n.s==r.s?1:-1,Z=n.d,U=r.d;if(!Z||!Z[0]||!U||!U[0])return new ue(!n.s||!r.s||(Z?U&&Z[0]==U[0]:!U)?NaN:Z&&Z[0]==0||!U?Te*0:Te/0);for(u?(f=1,l=n.e-r.e):(u=Ce,f=I,l=pe(n.e/f)-pe(r.e/f)),G=U.length,z=Z.length,h=new ue(Te),A=h.d=[],m=0;U[m]==(Z[m]||0);m++);if(U[m]>(Z[m]||0)&&l--,o==null?(K=o=ue.precision,s=ue.rounding):a?K=o+(n.e-r.e)+1:K=o,K<0)A.push(1),b=!0;else{if(K=K/f+2|0,m=0,G==1){for(d=0,U=U[0],K++;(m<z||d)&&K--;m++)L=d*u+(Z[m]||0),A[m]=L/U|0,d=L%U|0;b=d||m<z}else{for(d=u/(U[0]+1)|0,d>1&&(U=i(U,d,u),Z=i(Z,d,u),G=U.length,z=Z.length),D=G,w=Z.slice(0,G),x=w.length;x<G;)w[x++]=0;Ae=U.slice(),Ae.unshift(0),q=U[0],U[1]>=u/2&&++q;do d=0,c=e(U,w,G,x),c<0?(k=w[0],G!=x&&(k=k*u+(w[1]||0)),d=k/q|0,d>1?(d>=u&&(d=u-1),p=i(U,d,u),g=p.length,x=w.length,c=e(p,w,g,x),c==1&&(d--,t(p,G<g?Ae:U,g,u))):(d==0&&(c=d=1),p=U.slice()),g=p.length,g<x&&p.unshift(0),t(w,p,x,u),c==-1&&(x=w.length,c=e(U,w,G,x),c<1&&(d++,t(w,G<x?Ae:U,x,u))),x=w.length):c===0&&(d++,w=[0]),A[m++]=d,c&&w[0]?w[x++]=Z[D]||0:(w=[Z[D]],x=1);while((D++<z||w[0]!==void 0)&&K--);b=w[0]!==void 0}A[0]||A.shift()}if(f==1)h.e=l,Un=b;else{for(m=1,d=A[0];d>=10;d/=10)m++;h.e=m+l*f-1,B(h,a?o+h.e+1:o,s,b)}return h}}();function B(i,e,t,n){var r,o,s,a,u,c,l,m,d,f=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=I,s=e,l=m[d=0],u=l/re(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/I),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=u=0,r=1,o%=I,s=o-I+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=I,s=o-I+r,u=s<0?0:l/re(10,r-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%re(10,r-s-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/re(10,r-s):0:m[d-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=i.e+1,m[0]=re(10,(I-e%I)%I),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=re(10,I-o),m[d]=s>0?(l/re(10,r-s)%re(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==Ce&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=Ce)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return C&&(i.e>f.maxE?(i.d=null,i.e=NaN):i.e<f.minE&&(i.e=0,i.d=[0])),i}function Fe(i,e,t){if(!i.isFinite())return $n(i);var n,r=i.e,o=le(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+je(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+je(-r-1)+o,t&&(n=t-s)>0&&(o+=je(n))):r>=s?(o+=je(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+je(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=je(n))),o}function Ft(i,e){var t=i[0];for(e*=I;t>=10;t/=10)e++;return e}function Et(i,e,t){if(e>ji)throw C=!0,t&&(i.precision=t),Error(Xn);return B(new i(Lt),e,1,!0)}function Ke(i,e,t){if(e>nn)throw Error(Xn);return B(new i(Rt),e,t,!0)}function Yn(i){var e=i.length-1,t=e*I+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function je(i){for(var e="";i--;)e+="0";return e}function Zn(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/I+4);for(C=!1;;){if(t%2&&(o=o.times(e),Gn(o.d,s)&&(r=!0)),t=pe(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Gn(e.d,s)}return C=!0,o}function qn(i){return i.d[i.d.length-1]&1}function Qn(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function rn(i,e){var t,n,r,o,s,a,u,c=0,l=0,m=0,d=i.constructor,f=d.rounding,b=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(C=!1,u=b):u=e,a=new d(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(re(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=B(o.times(i),u,1),t=t.times(++l),a=s.plus(H(o,t,u,1)),le(a.d).slice(0,u)===le(s.d).slice(0,u)){for(r=m;r--;)s=B(s.times(s),u,1);if(e==null)if(c<3&&wt(s.d,u-n,f,c))d.precision=u+=10,t=o=a=new d(1),l=0,c++;else return B(s,d.precision=b,f,C=!0);else return d.precision=b,s}s=a}}function Ye(i,e){var t,n,r,o,s,a,u,c,l,m,d,f=1,b=10,p=i,g=p.d,h=p.constructor,A=h.rounding,w=h.precision;if(p.s<0||!g||!g[0]||!p.e&&g[0]==1&&g.length==1)return new h(g&&!g[0]?-1/0:p.s!=1?NaN:g?0:p);if(e==null?(C=!1,l=w):l=e,h.precision=l+=b,t=le(g),n=t.charAt(0),Math.abs(o=p.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)p=p.times(i),t=le(p.d),n=t.charAt(0),f++;o=p.e,n>1?(p=new h("0."+t),o++):p=new h(n+"."+t.slice(1))}else return c=Et(h,l+2,w).times(o+""),p=Ye(new h(n+"."+t.slice(1)),l-b).plus(c),h.precision=w,e==null?B(p,w,A,C=!0):p;for(m=p,u=s=p=H(p.minus(1),p.plus(1),l,1),d=B(p.times(p),l,1),r=3;;){if(s=B(s.times(d),l,1),c=u.plus(H(s,new h(r),l,1)),le(c.d).slice(0,l)===le(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Et(h,l+2,w).times(o+""))),u=H(u,new h(f),l,1),e==null)if(wt(u.d,l-b,A,a))h.precision=l+=b,c=s=p=H(m.minus(1),m.plus(1),l,1),d=B(p.times(p),l,1),r=a=1;else return B(u,h.precision=w,A,C=!0);else return h.precision=w,u;u=c,r+=2}}function $n(i){return String(i.s*i.s/0)}function on(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%I,t<0&&(n+=I),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=I;n<r;)i.d.push(+e.slice(n,n+=I));e=e.slice(n),n=I-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),C&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function Zi(i,e){var t,n,r,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),jn.test(e))return on(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(Xi.test(e))t=16,e=e.toLowerCase();else if(Ui.test(e))t=2;else if(zi.test(e))t=8;else throw Error(Ze+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=Zn(n,new n(t),o,o*2)),c=Ct(e,t,Ce),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=Ft(c,l),i.d=c,C=!1,s&&(i=H(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?re(2,u):kt.pow(2,u))),C=!0,i)}function Qi(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:dt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Ot(5,t)),e=dt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function dt(i,e,t,n,r){var o,s,a,u,c=1,l=i.precision,m=Math.ceil(l/I);for(C=!1,u=t.times(t),a=new i(n);;){if(s=H(a.times(u),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=H(s.times(u),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return C=!0,s.d.length=m+1,s}function Ot(i,e){for(var t=i;--e;)t*=i;return t}function Jn(i,e){var t,n=e.s<0,r=Ke(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Ge=n?4:1,e;if(t=e.divToInt(r),t.isZero())Ge=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Ge=qn(t)?n?2:3:n?4:1,e;Ge=qn(t)?n?1:4:n?3:2}return e.minus(r).abs()}function sn(i,e,t,n){var r,o,s,a,u,c,l,m,d,f=i.constructor,b=t!==void 0;if(b?(xe(t,1,Qe),n===void 0?n=f.rounding:xe(n,0,8)):(t=f.precision,n=f.rounding),!i.isFinite())l=$n(i);else{for(l=Fe(i),s=l.indexOf("."),b?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new f(1),d.e=l.length-s,d.d=Ct(Fe(d),10,r),d.e=d.d.length),m=Ct(l,10,r),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=b?"0p+0":"0";else{if(s<0?o--:(i=new f(i),i.d=m,i.e=o,i=H(i,d,t,n,0,r),m=i.d,o=i.e,c=Un),s=m[t],a=r/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,c)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=en.charAt(m[s]);if(b){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=Ct(l,r,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=en.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function Gn(i,e){if(i.length>e)return i.length=e,!0}function $i(i){return new this(i).abs()}function Ji(i){return new this(i).acos()}function er(i){return new this(i).acosh()}function tr(i,e){return new this(i).plus(e)}function nr(i){return new this(i).asin()}function ir(i){return new this(i).asinh()}function rr(i){return new this(i).atan()}function or(i){return new this(i).atanh()}function sr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Ke(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Ke(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Ke(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(H(i,e,o,1)),e=Ke(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(H(i,e,o,1)),t}function ar(i){return new this(i).cbrt()}function ur(i){return B(i=new this(i),i.e+1,2)}function cr(i,e,t){return new this(i).clamp(e,t)}function lr(i){if(!i||typeof i!="object")throw Error(Mt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,Qe,"rounding",0,8,"toExpNeg",-mt,0,"toExpPos",0,mt,"maxE",0,mt,"minE",-mt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=tn[t]),(n=i[t])!==void 0)if(pe(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(Ze+t+": "+n);if(t="crypto",r&&(this[t]=tn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(zn);else this[t]=!1;else throw Error(Ze+t+": "+n);return this}function mr(i){return new this(i).cos()}function dr(i){return new this(i).cosh()}function ei(i){var e,t,n;function r(o){var s,a,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,Vn(o)){c.s=o.s,C?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;C?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return on(c,o.toString())}else if(u!=="string")throw Error(Ze+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),jn.test(o)?on(c,o):Zi(c,o)}if(r.prototype=y,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=lr,r.clone=ei,r.isDecimal=Vn,r.abs=$i,r.acos=Ji,r.acosh=er,r.add=tr,r.asin=nr,r.asinh=ir,r.atan=rr,r.atanh=or,r.atan2=sr,r.cbrt=ar,r.ceil=ur,r.clamp=cr,r.cos=mr,r.cosh=dr,r.div=fr,r.exp=pr,r.floor=br,r.hypot=gr,r.ln=yr,r.log=hr,r.log10=kr,r.log2=wr,r.max=Ar,r.min=Tr,r.mod=xr,r.mul=Pr,r.pow=Br,r.random=Ir,r.round=Sr,r.sign=Nr,r.sin=Kr,r.sinh=Cr,r.sqrt=Lr,r.sub=Rr,r.sum=Er,r.tan=Mr,r.tanh=Fr,r.trunc=Or,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function fr(i,e){return new this(i).div(e)}function pr(i){return new this(i).exp()}function br(i){return B(i=new this(i),i.e+1,3)}function gr(){var i,e,t=new this(0);for(C=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return C=!0,new this(1/0);t=e}return C=!0,t.sqrt()}function Vn(i){return i instanceof kt||i&&i.toStringTag===Hn||!1}function yr(i){return new this(i).ln()}function hr(i,e){return new this(i).log(e)}function wr(i){return new this(i).log(2)}function kr(i){return new this(i).log(10)}function Ar(){return Qn(this,arguments,"lt")}function Tr(){return Qn(this,arguments,"gt")}function xr(i,e){return new this(i).mod(e)}function Pr(i,e){return new this(i).mul(e)}function Br(i,e){return new this(i).pow(e)}function Ir(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:xe(i,1,Qe),n=Math.ceil(i/I),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(zn);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=I,n&&i&&(r=re(10,I-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=I)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<I&&(t-=I-n)}return s.e=t,s.d=a,s}function Sr(i){return B(i=new this(i),i.e+1,this.rounding)}function Nr(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function Kr(i){return new this(i).sin()}function Cr(i){return new this(i).sinh()}function Lr(i){return new this(i).sqrt()}function Rr(i,e){return new this(i).sub(e)}function Er(){var i=0,e=arguments,t=new this(e[i]);for(C=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return C=!0,B(t,this.precision,this.rounding)}function Mr(i){return new this(i).tan()}function Fr(i){return new this(i).tanh()}function Or(i){return B(i=new this(i),i.e+1,1)}y[Symbol.for("nodejs.util.inspect.custom")]=y.toString;y[Symbol.toStringTag]="Decimal";var kt=y.constructor=ei(tn);Lt=new kt(Lt);Rt=new kt(Rt);var S=kt;import{PublicKey as ln}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Dr}from"@solana/spl-token";import{PublicKey as Q,SystemProgram as _r,SYSVAR_RENT_PUBKEY as vr}from"@solana/web3.js";function an({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var Yo=[an({pubkey:Dr,isWritable:!1}),an({pubkey:_r.programId,isWritable:!1}),an({pubkey:vr,isWritable:!1})];function un({publicKey:i,transformSol:e}){let t=ti(i.toString());if(t instanceof Q)return e&&t.equals(nt)?Dt:t;if(e&&t.toString()===nt.toBase58())return Dt;if(typeof t=="string"){if(t===Q.default.toBase58())return Q.default;try{return new Q(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ti(i){try{return new Q(i)}catch{return i}}var _t=new Q("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),At=new Q("SysvarRent111111111111111111111111111111111"),Zo=new Q("SysvarC1ock11111111111111111111111111111111"),ft=new Q("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Qo=new Q("Sysvar1nstructions1111111111111111111111111"),$o=new Q("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Jo=new Q("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),es=new Q("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ts=new Q("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),ns=new Q("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),is=new Q("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),rs=new Q("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),os=new Q("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),ss=new Q("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),as=new Q("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),us=new Q("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Dt=new Q("So11111111111111111111111111111111111111112"),nt=Q.default;function cn(i){return un({publicKey:i,transformSol:!0})}import{PublicKey as Wr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ni}from"@solana/spl-token";var vt={chainId:101,address:Wr.default.toBase58(),programId:ni.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},it={chainId:101,address:"So11111111111111111111111111111111111111112",programId:ni.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var mn=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===nt.toBase58()||e instanceof ln&&nt.equals(e)){this.decimals=it.decimals,this.symbol=it.symbol,this.name=it.name,this.mint=new ln(it.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?ln.default:un({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ve=mn;Ve.WSOL=new mn(se(te({},it),{mint:it.address}));import qt from"big.js";import Vr from"bn.js";import Ur from"decimal.js-light";import qr from"toformat";var Gr=qr,Tt=Gr;var Wt=ce("module/fraction"),dn=Tt(qt),xt=Tt(Ur),Xr={[0]:xt.ROUND_DOWN,[1]:xt.ROUND_HALF_UP,[2]:xt.ROUND_UP},zr={[0]:qt.roundDown,[1]:qt.roundHalfUp,[2]:qt.roundUp},V=class{constructor(e,t=new Vr(1)){this.numerator=me(e),this.denominator=me(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new V(this.denominator,this.numerator)}add(e){let t=e instanceof V?e:new V(me(e));return this.denominator.eq(t.denominator)?new V(this.numerator.add(t.numerator),this.denominator):new V(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof V?e:new V(me(e));return this.denominator.eq(t.denominator)?new V(this.numerator.sub(t.numerator),this.denominator):new V(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof V?e:new V(me(e));return new V(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof V?e:new V(me(e));return new V(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Wt.logWithError(`${e} is not an integer.`),e<=0&&Wt.logWithError(`${e} is not positive.`),xt.set({precision:e+1,rounding:Xr[n]});let r=new xt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Wt.logWithError(`${e} is not an integer.`),e<0&&Wt.logWithError(`${e} is negative.`),dn.DP=e,dn.RM=zr[n]||1,new dn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var jr=ce("Raydium_price"),Le=class extends V{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new V(fn(n.decimals),fn(r.decimals))}get raw(){return new V(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Le({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&jr.logWithError("mul token not equals");let n=super.mul(t);return new Le({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var pn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Gt=pn;Gt.SOL=new pn(vt);import Yr from"bn.js";var ii=new V(new Yr(100)),rt=class extends V{toSignificant(e=5,t,n){return this.mul(ii).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(ii).toFixed(e,t,n)}};var Zr=new Pe(0),ra=new Pe(1),oa=new Pe(2),sa=new Pe(3),aa=new Pe(5),bn=new Pe(10),ua=new Pe(100),ca=new Pe(1e3),la=new Pe(1e4),ri=9007199254740991;function me(i){let e=ce("Raydium_parseBigNumberish");if(i instanceof Pe)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Pe(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=ri||i<=-ri)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Pe(String(i))):typeof i=="bigint"?new Pe(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Pe(0))}function fn(i){return bn.pow(me(i))}var $r=ce("Raydium_amount"),oi=Tt(Qr);function Jr(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):$r.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var be=class extends V{constructor(t,n,r=!0,o){let s=new Vt(0),a=bn.pow(new Vt(t.decimals));if(r)s=me(n);else{let u=new Vt(0),c=new Vt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=Jr(n.toString(),t.decimals);u=me(l),c=me(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=ce(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new be(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new be(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return oi.DP=this.token.decimals,new oi(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Iu,sendAndConfirmTransaction as Su,Transaction as Ku,TransactionMessage as Lu,VersionedTransaction as Ru}from"@solana/web3.js";import Mu from"axios";var ge={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw"};import{PublicKey as eo,ComputeBudgetProgram as Ga,Transaction as Ua,TransactionMessage as za,Keypair as Ha,VersionedTransaction as Ya}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Qa}from"@solana/spl-token";var eu=ce("Raydium_txUtil");function Se(i,e){let[t,n]=eo.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}import{PublicKey as no,AddressLookupTableAccount as si}from"@solana/web3.js";import{PublicKey as to}from"@solana/web3.js";import{getTransferFeeConfig as au,unpackMint as uu}from"@solana/spl-token";var gn=ce("Raydium_accountInfo_util");async function ot(i,e,t){let{batchRequest:n,commitment:r="confirmed"}=te({batchRequest:!1},t),o=yn(e,100),s=new Array(o.length).fill([]);if(n){let a=o.map(l=>{let m=i._buildArgs([l.map(d=>d.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:m}}),u=yn(a,10);s=(await(await Promise.all(u.map(async l=>await i._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&gn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(m=>{if(m){let{data:d,executable:f,lamports:b,owner:p,rentEpoch:g}=m;return d.length!==2&&d[1]!=="base64"&&gn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:f,lamports:b,owner:new to(p),rentEpoch:g}}return null})))}else try{s=await Promise.all(o.map(a=>i.getMultipleAccountsInfo(a,r)))}catch(a){a instanceof Error&&gn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function hn(i,e,t){let n=await ot(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>se(te({},r),{accountInfo:n[o]}))}var io={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new si({key:new no("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:si.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};function yn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Be}from"@solana/web3.js";var Uu=new Be("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Xu=new Be("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),zu=new Be("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Hu=new Be("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),ju=new Be("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Yu=new Be("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Zu=new Be("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Qu=new Be("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),$u=new Be("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Ju=new Be("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),ec=new Be("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),tc=new Be("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),nc=new Be("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),ic=new Be("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi");import{PublicKey as ro}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as oo}from"@solana/spl-token";function Ue(i,e,t){return Se([i.toBuffer(),(t!=null?t:oo).toBuffer(),e.toBuffer()],new ro("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import ne from"bn.js";var Oe=1e4;function Ut(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=t.epoch<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new ne(r.maximumFee.toString()),s=t.epoch<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(r.transferFeeBasisPoints===Oe){let a=new ne(r.maximumFee.toString());return{amount:i.add(a),fee:a,expirationTime:s}}else{let a=pt(i.mul(new ne(Oe)),new ne(Oe-r.transferFeeBasisPoints)),u=new ne(r.maximumFee.toString()),c=a.sub(i).gt(u)?i.add(u):a,l=pt(c.mul(new ne(r.transferFeeBasisPoints)),new ne(Oe)),m=l.gt(o)?o:l;return{amount:c,fee:m,expirationTime:s}}else{let a=pt(i.mul(new ne(r.transferFeeBasisPoints)),new ne(Oe)),u=a.gt(o)?o:a;return{amount:i,fee:u,expirationTime:s}}}function ye(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=se(te({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new ne(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Oe){let u=new ne(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:a}}else{let u=pt(i.mul(new ne(Oe)),new ne(Oe-o.transferFeeBasisPoints)),c=new ne(o.maximumFee.toString()),l=u.sub(i).gt(c)?i.add(c):u,m=pt(l.mul(new ne(o.transferFeeBasisPoints)),new ne(Oe)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let u=pt(i.mul(new ne(o.transferFeeBasisPoints)),new ne(Oe)),c=u.gt(s)?s:u;return{amount:i,fee:c,expirationTime:a}}}function st(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function pt(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new ne(0))?t.add(new ne(1)):t}import{PublicKey as bo}from"@solana/web3.js";import li,{isBN as mi}from"bn.js";import{bits as Kc,BitStructure as Cc,blob as so,Blob as Lc,cstr as Rc,f32 as Ec,f32be as Mc,f64 as Fc,f64be as Oc,greedy as Dc,Layout as ao,ns64 as _c,ns64be as vc,nu64 as Wc,nu64be as qc,offset as Gc,s16 as Vc,s16be as Uc,s24 as Xc,s24be as zc,s32 as uo,s32be as Hc,s40 as jc,s40be as Yc,s48 as Zc,s48be as Qc,s8 as $c,seq as co,struct as Jc,Structure as lo,u16 as mo,u16be as el,u24 as tl,u24be as nl,u32 as il,u32be as rl,u40 as ol,u40be as sl,u48 as al,u48be as ul,u8 as fo,UInt as po,union as cl,Union as ll,unionLayoutDiscriminator as ml,utf8 as dl}from"@solana/buffer-layout";var wn=ao,ai=lo;var kn=po;var ui=fo,bt=mo;var de=uo;var ci=co;var Ne=so;var Pt=class extends wn{constructor(t,n,r){super(t,r);this.blob=Ne(t),this.signed=n}decode(t,n=0){let r=new li(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new li(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function J(i){return new kn(1,i)}function Xe(i){return new kn(4,i)}function N(i){return new Pt(8,!1,i)}function _(i){return new Pt(16,!1,i)}function di(i){return new Pt(16,!0,i)}var Xt=class extends wn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function Y(i){return new Xt(Ne(32),e=>new bo(e),e=>e.toBuffer(),i)}function De(i){return new Xt(ui(),go,yo,i)}function go(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function yo(i){return i?1:0}var An=class extends ai{decode(e,t){return super.decode(e,t)}};function j(i,e,t){return new An(i,e,t)}function $(i,e,t){let n,r=typeof e=="number"?e:mi(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=mi(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return ci(i,r,t)}import Io from"bn.js";function zt(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Tn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function xn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Bt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function fi(i,e){return Bt(i,e)?null:Tn(i,e)}function pi(i,e){return Bt(i,e)?null:xn(i,e)}var Kl=Buffer.from("amm_config","utf8"),ho=Buffer.from("pool","utf8"),wo=Buffer.from("pool_vault","utf8"),ko=Buffer.from("pool_reward_vault","utf8"),bi=Buffer.from("position","utf8"),Ao=Buffer.from("tick_array","utf8"),To=Buffer.from("operation","utf8"),xo=Buffer.from("pool_tick_array_bitmap_extension","utf8");function gi(i,e,t,n){return Se([ho,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function Pn(i,e,t){return Se([wo,e.toBuffer(),t.toBuffer()],i)}function yi(i,e,t){return Se([ko,e.toBuffer(),t.toBuffer()],i)}function X(i,e,t){return Se([Ao,e.toBuffer(),zt(t)],i)}function at(i,e,t,n){return Se([bi,e.toBuffer(),zt(t),zt(n)],i)}function _e(i,e){return Se([bi,e.toBuffer()],i)}function Ht(i){return Se([Buffer.from("metadata","utf8"),ft.toBuffer(),i.toBuffer()],ft)}function Bn(i){return Se([To],i)}function $e(i,e){return Se([xo,e.toBuffer()],i)}import ve from"bn.js";var ie=new ve(0),We=new ve(1),ze=new ve(-1),Ie=new ve(1).shln(64),jt=new ve(1).shln(128),In=Ie.sub(We),It=64,hi=jt.subn(1),he=-443636,we=-he,gt=new ve("4295048016"),yt=new ve("79226673521066979257578248091"),wi=16,ki="59543866431248",Ai="184467440737095516",Ti="15793534762490258745",Yt=new ve(10).pow(new ve(6));var Rl=new ve("18446744073700000000");var Po=15,v=class{static async getTickArrays(e,t,n,r,o,s,a){let u=[],c=P.getTickArrayStartIndexByTick(r,o),l=P.getInitializedTickArrayInRange(s,a,o,c,Math.floor(Po/2));for(let f=0;f<l.length;f++){let{publicKey:b}=X(t,n,l[f]);u.push(b)}let m=(await ot(e,u)).map(f=>f!==null?St.decode(f.data):null),d={};for(let f=0;f<u.length;f++){let b=m[f];b!==null&&(d[b.startTickIndex]=se(te({},b),{address:u[f]}))}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=P.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:f}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,d,f]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/v.tickCount(t)),a=n?P.searchLowBitFromStart(r,o,s-1,1,t):P.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=oe-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<oe;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=X(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=P.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u-1}else for(u=u+1;u<oe;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u+1}let{publicKey:m}=X(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(P.checkIsOutOfBoundary(e)){if(e>we)return!1;let n=P.getTickArrayStartIndexByTick(he,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return oe*e}};import O from"bn.js";import{PublicKey as xi}from"@solana/web3.js";import ee from"bn.js";var Sn=14,He=class{static maxTickInTickarrayBitmap(e){return e*oe*ut}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!v.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-v.tickCount(n):t+v.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*oe,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(r){let l=e.shln(1024-c-1),m=fi(1024,l);if(m!==null){let d=(c-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=pi(1024,l);if(m!==null){let d=(c+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-v.tickCount(n)}}}},Nt=class{static getBitmapOffset(e,t){if(!v.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=He.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=He.maxTickInTickarrayBitmap(e),n=-t;if(we<=t)throw Error(`extensionTickBoundary check error: ${we}, ${t}`);if(n<=he)throw Error(`extensionTickBoundary check error: ${n}, ${he}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:P.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=v.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=He.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let u=P.mergeTickArrayBitmap(e).shln(ut-1-a),c=Bt(512,u)?null:Tn(512,u);if(c!==null){let l=t-c*v.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=P.mergeTickArrayBitmap(e).shrn(a),c=Bt(512,u)?null:xn(512,u);if(c!==null){let l=t+c*v.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-v.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%He.maxTickInTickarrayBitmap(t),r=Math.floor(n/v.tickCount(t));return e<0&&n!=0&&(r=ut-r),r}};import qe from"bn.js";var Kt=class{static getfeeGrowthInside(e,t,n){let r=new qe(0),o=new qe(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new qe(0),a=new qe(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=M.wrappingSubU128(M.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),c=M.wrappingSubU128(M.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=M.mulDivFloor(M.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ie),u=t.tokenFeesOwedA.add(a),c=M.mulDivFloor(M.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ie),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=M.mulDivFloor(M.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ie),u=t.tokenFeesOwedA.add(a),c=M.mulDivFloor(M.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ie),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=M.wrappingSubU128(u,c.growthInsideLastX64),m=M.mulDivFloor(l,t.liquidity,Ie),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=M.wrappingSubU128(u,c.growthInsideLastX64),m=M.mulDivFloor(l,t.liquidity,Ie),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new qe(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new qe(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(M.wrappingSubU128(M.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new qe(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new qe(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(M.wrappingSubU128(M.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var g,h,A,w;let a=F.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),u=F.getSqrtPriceX64FromTick(t.tickLower),c=F.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=W.getAmountsFromLiquidity(a,u,c,n,o),[d,f]=[ye(m.amountA,(g=e.mintA.extensions)==null?void 0:g.feeConfig,s,!0),ye(m.amountB,(h=e.mintB.extensions)==null?void 0:h.feeConfig,s,!0)],[b,p]=[ye(new qe(new S(m.amountA.toString()).mul(l).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,s,!0),ye(new qe(new S(m.amountB.toString()).mul(l).toFixed(0)),(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:f,amountSlippageA:b,amountSlippageB:p,expirationTime:st(d.expirationTime,f.expirationTime)}}};var ke=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o){let s=n.equals(e.mintA.mint),a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:f,feeAmount:b}=ct.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,c,o);return a.push(...d),{expectedAmountOut:m.mul(ze),remainingAccounts:a,executionPrice:f,feeAmount:b}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.equals(e.mintB.mint),a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let p=this.preInitializedTickArrayStartIndex(e,s);if(p.isExist){let{publicKey:g}=X(e.programId,e.id,p.nextStartIndex);a.push(g)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:f,feeAmount:b}=ct.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(ze),c,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:f,feeAmount:b}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=ke.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Nt.checkTickArrayIsInit(v.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):P.checkTickArrayIsInitialized(P.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=X(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,v.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=X(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/v.tickCount(e.tickSpacing)),r=t?P.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):P.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=v.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=He.nextInitializedTickArrayStartIndex(P.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Nt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<he||t>we)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let f=se(te({},m),{perSecond:M.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new xi(d)});if(f.tokenMint.equals(xi.default))continue;if(n<=f.openTime.toNumber()||r.eq(ie)){s.push(f);continue}let b=new ee(Math.min(f.endTime.toNumber(),n)),p=b.sub(f.lastUpdateTime),g=M.mulDivFloor(p,f.emissionsPerSecondX64,r),h=f.rewardGrowthGlobalX64.add(g),A=M.mulDivFloor(p,f.emissionsPerSecondX64,Ie),w=f.rewardTotalEmissioned.add(A);s.push(se(te({},f),{rewardGrowthGlobalX64:h,rewardTotalEmissioned:w,lastUpdateTime:b}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=P.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=He.maxTickInTickarrayBitmap(e),n=-t;return t>we&&(t=v.getArrayStartIndex(we,e)+v.tickCount(e)),n<he&&(n=v.getArrayStartIndex(he,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!v.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/v.tickCount(t)*ut}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await hn(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=Bi.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=P.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=P.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:d}=X(u.programId,u.id,m);o.push({pubkey:d}),r[d.toString()]=u.id}}let s=await hn(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=St.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]=se(te({},l),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let f of s)c.push(_e(f,d).publicKey);let l=await ot(t,c,{batchRequest:r}),m={};for(let d of l){if(d===null)continue;let f=Pi.decode(d.data),b=f.poolId.toString(),p=e.find(D=>D.state.id.toBase58()===b);if(p===void 0)continue;let g=p.state,h=P._getTickPriceLegacy({poolInfo:g,tick:f.tickLower,baseIn:!0}),A=P._getTickPriceLegacy({poolInfo:g,tick:f.tickUpper,baseIn:!0}),{amountA:w,amountB:x}=W.getAmountsFromLiquidity(g.sqrtPriceX64,h.tickSqrtPriceX64,A.tickSqrtPriceX64,f.liquidity,!1),k=1/(1-Math.sqrt(Math.sqrt(h.price.div(A.price).toNumber())));p.positionAccount=[...(a=p.positionAccount)!=null?a:[],{poolId:f.poolId,nftMint:f.nftMint,priceLower:h.price,priceUpper:A.price,amountA:w,amountB:x,tickLower:f.tickLower,tickUpper:f.tickUpper,liquidity:f.liquidity,feeGrowthInsideLastX64A:f.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:f.feeGrowthInsideLastX64B,tokenFeesOwedA:f.tokenFeesOwedA,tokenFeesOwedB:f.tokenFeesOwedB,rewardInfos:f.rewardInfos.map(D=>se(te({},D),{pendingReward:new ee(0)})),leverage:k,tokenFeeAmountA:new ee(0),tokenFeeAmountB:new ee(0)}];let K=await P.getTickArrayAddressByTick(p.state.programId,f.poolId,f.tickLower,p.state.tickSpacing),L=await P.getTickArrayAddressByTick(p.state.programId,f.poolId,f.tickUpper,p.state.tickSpacing);m[`${p.state.programId.toString()}-${f.poolId.toString()}-${f.tickLower}`]=K,m[`${p.state.programId.toString()}-${f.poolId.toString()}-${f.tickUpper}`]=L}if(o){let d=Object.values(m),f=await ot(t,d,{batchRequest:r}),b={};for(let p=0;p<d.length;p++){let g=f[p];if(g===null)continue;let h=d[p].toString();b[h]=St.decode(g.data)}for(let{state:p,positionAccount:g}of e)if(!!g)for(let h of g){let A=`${p.programId.toString()}-${p.id.toString()}-${h.tickLower}`,w=`${p.programId.toString()}-${p.id.toString()}-${h.tickUpper}`,x=b[m[A].toString()],k=b[m[w].toString()],K=x.ticks[P.getTickOffsetInArray(h.tickLower,p.tickSpacing)],L=k.ticks[P.getTickOffsetInArray(h.tickUpper,p.tickSpacing)],{tokenFeeAmountA:D,tokenFeeAmountB:z}=await Kt.GetPositionFees(p,h,K,L),q=await Kt.GetPositionRewards(p,h,K,L);h.tokenFeeAmountA=D.gte(new ee(0))?D:new ee(0),h.tokenFeeAmountB=z.gte(new ee(0))?z:new ee(0);for(let G=0;G<q.length;G++)h.rewardInfos[G].pendingReward=q[G].gte(new ee(0))?q[G]:new ee(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,token2022Infos:r,epochInfo:o,amountIn:s,slippage:a,priceLimit:u=new S(0)}){var z,q,G,Ae;let c;u.equals(new S(0))?c=n.equals(e.mintA.mint)?gt.add(new ee(1)):yt.sub(new ee(1)):c=F.priceToSqrtPriceX64(u,e.mintA.decimals,e.mintB.decimals);let l=Ut(s,(z=r[n.toString()])==null?void 0:z.feeConfig,o,!1),{expectedAmountOut:m,remainingAccounts:d,executionPrice:f,feeAmount:b}=ke.getOutputAmountAndRemainAccounts(e,t,n,l.amount.sub((q=l.fee)!=null?q:ie),c),p=e.mintA.mint.equals(n)?e.mintB.mint:e.mintA.mint,g=Ut(m,(G=r[p.toString()])==null?void 0:G.feeConfig,o,!1),h=F.sqrtPriceX64ToPrice(f,e.mintA.decimals,e.mintB.decimals),A=n.equals(e.mintA.mint)?h:new S(1).div(h),w=m.mul(new ee(Math.floor((1-a)*1e10))).div(new ee(1e10)),x=Ut(w,(Ae=r[p.toString()])==null?void 0:Ae.feeConfig,o,!1),k=e.mintA.mint.equals(n)?e.currentPrice:new S(1).div(e.currentPrice),K=new S(A).sub(k).abs(),L=k,D=new rt(new S(K).mul(10**15).toFixed(0),new S(L).mul(10**15).toFixed(0));return{realAmountIn:l,amountOut:g,minAmountOut:x,expirationTime:st(l.expirationTime,g.expirationTime),currentPrice:e.currentPrice,executionPrice:A,priceImpact:D,fee:b,remainingAccounts:d}}static async computeAmountOutFormat({poolInfo:e,tickArrayCache:t,token2022Infos:n,amountIn:r,tokenOut:o,slippage:s,epochInfo:a}){let u=r.token.equals(Ve.WSOL)?Dt:r.token.mint,c=s.numerator.toNumber()/s.denominator.toNumber(),l=o.mint.equals(nt)?new Ve({mint:"sol",decimals:vt.decimals}):o,{realAmountIn:m,amountOut:d,minAmountOut:f,expirationTime:b,currentPrice:p,executionPrice:g,priceImpact:h,fee:A,remainingAccounts:w}=await ke.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:u,amountIn:r.raw,slippage:c,token2022Infos:n,epochInfo:a}),x=se(te({},m),{amount:new be(r.token,m.amount),fee:m.fee===void 0?void 0:new be(r.token,m.fee)}),k=se(te({},d),{amount:new be(l,d.amount),fee:d.fee===void 0?void 0:new be(l,d.fee)}),K=se(te({},f),{amount:new be(l,f.amount),fee:f.fee===void 0?void 0:new be(l,f.fee)}),L=new Le({baseToken:r.token,denominator:new ee(10).pow(new ee(20+r.token.decimals)),quoteToken:l,numerator:p.mul(new S(10**(20+l.decimals))).toFixed(0)}),D=new Le({baseToken:r.token,denominator:new ee(10).pow(new ee(20+r.token.decimals)),quoteToken:l,numerator:g.mul(new S(10**(20+l.decimals))).toFixed(0)}),z=new be(r.token,A);return{realAmountIn:x,amountOut:k,minAmountOut:K,expirationTime:b,currentPrice:L,executionPrice:D,priceImpact:h,fee:z,remainingAccounts:w}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var b,p,g;let o=e[t],s=P.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=P.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,d=o.priceMax-o.priceMin,f;return l<=0?f=0:m===l?f=d/l:d===l?f=l/m:f=l/d*(l/m),{feeApr:o.feeApr*f,rewardsApr:[(b=o.rewardApr[0])!=null?b:0*f,(p=o.rewardApr[1])!=null?p:0*f,(g=o.rewardApr[2])!=null?g:0*f],apr:o.apr*f}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[cn(e.mintA.address).toString()],d=r[cn(e.mintB.address).toString()],f=e.mintA.decimals,b=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let p=F.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),g=F.getSqrtPriceX64FromTick(s),h=F.getSqrtPriceX64FromTick(a),{amountSlippageA:A,amountSlippageB:w}=W.getAmountsFromLiquidityWithSlippage(p,g,h,t,!1,!1,0),{amountSlippageA:x,amountSlippageB:k}=W.getAmountsFromLiquidityWithSlippage(p,g,h,o,!1,!1,0),K=new S(A.toString()).div(new S(10).pow(f)).mul(m.value).add(new S(w.toString()).div(new S(10).pow(b)).mul(d.value)),L=new S(x.toString()).div(new S(10).pow(f)).mul(m.value).add(new S(k.toString()).div(new S(10).pow(b)).mul(d.value)),D=L.div(K.add(L)).div(L),q=new S(l.volumeFee).mul(365).div(c).mul(D).mul(100).toNumber(),G=3600*24*365,Ae=e.rewardDefaultInfos.map(ue=>{var U,Fn;let Te=ue.mint.decimals,Z=r[ue.mint.address];return u<((U=ue.startTime)!=null?U:0)||u>((Fn=ue.endTime)!=null?Fn:0)||!ue.perSecond||!Z||Te===void 0?0:new S(Z.value).mul(new S(ue.perSecond).mul(G)).div(new S(10).pow(Te)).mul(D).mul(100).toNumber()});return{feeApr:q,rewardsApr:Ae,apr:q+Ae.reduce((ue,Te)=>ue+Te,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var h,A;let l=F.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),m=F.getSqrtPriceX64FromTick(n),d=F.getSqrtPriceX64FromTick(r),f=a?1-s:1+s,b=ye(o,(h=e[t?"mintA":"mintB"].extensions)==null?void 0:h.feeConfig,u,!c),p=new ee(new S(b.amount.sub((A=b.fee)!=null?A:ie).toString()).mul(f).toFixed(0)),g;if(l.lte(m))g=t?W.getLiquidityFromTokenAmountA(m,d,p,!a):new ee(0);else if(l.lte(d)){let w=W.getLiquidityFromTokenAmountA(l,d,p,!a),x=W.getLiquidityFromTokenAmountB(m,l,p);g=t?w:x}else g=t?new ee(0):W.getLiquidityFromTokenAmountB(m,d,p);return ke.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:g,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var g,h,A,w;let u=F.getSqrtPriceX64FromTick(n),c=F.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=W.getAmountsFromLiquidity(F.priceToSqrtPriceX64(new S(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,f]=[ye(m.amountA,(g=t.mintA.extensions)==null?void 0:g.feeConfig,e,!0),ye(m.amountB,(h=t.mintB.extensions)==null?void 0:h.feeConfig,e,!0)],[b,p]=[ye(m.amountA.muln(l),(A=t.mintA.extensions)==null?void 0:A.feeConfig,e,!0),ye(m.amountB.muln(l),(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:f,amountSlippageA:b,amountSlippageB:p,expirationTime:st(d.expirationTime,f.expirationTime)}}};var M=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(ie)||(o=o.add(We)),o}static mulDivFloor(e,t,n){if(n.eq(ie))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ie))throw new Error("division by 0");return e.mul(t).add(n.sub(We)).div(n)}static x64ToDecimal(e,t){return new S(e.toString()).div(S.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new O(e.mul(S.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(jt).sub(t).mod(jt)}};function ae(i,e){return Nn(i.mul(e),64,256)}function Bo(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Nn(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var F=class{static sqrtPriceX64ToPrice(e,t,n){return M.x64ToDecimal(e).pow(2).mul(S.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return M.decimalToX64(e.mul(S.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(ie))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ie))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(ie))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ie))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(ie))return e;let o=t.shln(It);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?M.mulDivCeil(s,e,a):M.mulDivRoundingUp(s,We,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return M.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(It);if(r)return e.add(o.div(t));{let s=M.mulDivRoundingUp(o,We,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<he||e>we)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new O("18445821805675395072"):new O("18446744073709551616");return(t&2)!=0&&(n=ae(n,new O("18444899583751176192"))),(t&4)!=0&&(n=ae(n,new O("18443055278223355904"))),(t&8)!=0&&(n=ae(n,new O("18439367220385607680"))),(t&16)!=0&&(n=ae(n,new O("18431993317065453568"))),(t&32)!=0&&(n=ae(n,new O("18417254355718170624"))),(t&64)!=0&&(n=ae(n,new O("18387811781193609216"))),(t&128)!=0&&(n=ae(n,new O("18329067761203558400"))),(t&256)!=0&&(n=ae(n,new O("18212142134806163456"))),(t&512)!=0&&(n=ae(n,new O("17980523815641700352"))),(t&1024)!=0&&(n=ae(n,new O("17526086738831433728"))),(t&2048)!=0&&(n=ae(n,new O("16651378430235570176"))),(t&4096)!=0&&(n=ae(n,new O("15030750278694412288"))),(t&8192)!=0&&(n=ae(n,new O("12247334978884435968"))),(t&16384)!=0&&(n=ae(n,new O("8131365268886854656"))),(t&32768)!=0&&(n=ae(n,new O("3584323654725218816"))),(t&65536)!=0&&(n=ae(n,new O("696457651848324352"))),(t&131072)!=0&&(n=ae(n,new O("26294789957507116"))),(t&262144)!=0&&(n=ae(n,new O("37481735321082"))),e>0&&(n=hi.div(n)),n}static getTickFromPrice(e,t,n){return F.getTickFromSqrtPriceX64(F.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(yt)||e.lt(gt))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new O(t-64),r=Bo(n,32,128),o=new O("8000000000000000","hex"),s=0,a=new O(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new O(0))&&s<wi;){u=u.mul(u);let b=u.shrn(127);u=u.shrn(63+b.toNumber()),a=a.add(o.mul(b)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=r.add(c).mul(new O(ki)),d=Nn(m.sub(new O(Ai)),64,128).toNumber(),f=Nn(m.add(new O(Ti)),64,128).toNumber();return d==f?d:F.getSqrtPriceX64FromTick(f).lte(e)?f:d}},lt=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=F.getTickFromSqrtPriceX64(F.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=lt.getTickWithPriceAndTickspacing(e,t,n,r),s=F.getSqrtPriceX64FromTick(o);return F.sqrtPriceX64ToPrice(s,n,r)}},W=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ie))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(It),s=t.sub(e);return r?M.mulDivRoundingUp(M.mulDivCeil(o,s,t),We,e):M.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ie))throw new Error("sqrtPriceX64A must greater than 0");return r?M.mulDivCeil(n,t.sub(e),Ie):M.mulDivFloor(n,t.sub(e),Ie)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?M.mulDivRoundingUp(a,We,In):a.shrn(It)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),M.mulDivFloor(n,In,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return W.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=W.getLiquidityFromTokenAmountA(e,n,r,!1),a=W.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return W.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:W.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new O(0)};if(e.lt(n)){let s=W.getTokenAmountAFromLiquidity(e,n,r,o),a=W.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new O(0),amountB:W.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:u,amountB:c}=W.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new O(new S(u.toString()).mul(l).toFixed(0)),d=new O(new S(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var A,w,x,k;let c=F.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),l=F.getSqrtPriceX64FromTick(t),m=F.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,f=W.getAmountsFromLiquidity(c,l,m,r,s),[b,p]=[ye(f.amountA,(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,u),ye(f.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,a,u)],[g,h]=[ye(new O(new S(f.amountA.toString()).mul(d).toFixed(0)),(x=e.mintA.extensions)==null?void 0:x.feeConfig,a,u),ye(new O(new S(f.amountB.toString()).mul(d).toFixed(0)),(k=e.mintB.extensions)==null?void 0:k.feeConfig,a,u)];return{liquidity:r,amountA:b,amountB:p,amountSlippageA:g,amountSlippageB:h,expirationTime:st(b.expirationTime,p.expirationTime)}}},ct=class{static swapCompute(e,t,n,r,o,s,a,u,c,l,m,d,f,b){if(d.eq(ie))throw new Error("amountSpecified must not be 0");if(b||(b=s?gt.add(We):yt.sub(We)),s){if(b.lt(gt))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(b.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(b.gt(yt))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(b.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let p=d.gt(ie),g={amountSpecifiedRemaining:d,amountCalculated:ie,sqrtPriceX64:m,tick:c>f?Math.min(f+v.tickCount(l)-1,c):f,accounts:[],liquidity:u,feeAmount:new O(0)},h=f,A=n[f],w=0,x=!s&&A.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(ie)&&!g.sqrtPriceX64.eq(b);){if(w>10)throw Error("liquidity limit");let k={};k.sqrtPriceStartX64=g.sqrtPriceX64;let K=P.nextInitTick(A,g.tick,l,s,x),L=K||null,D=null;if(!(L!=null&&L.liquidityGross.gtn(0))){let q=ke.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},h,s);if(!q.isExist)throw Error("swapCompute LiquidityInsufficient");h=q.nextStartIndex;let{publicKey:G}=X(e,t,h);D=G,A=n[h],L=P.firstInitializedTick(A,s)}k.tickNext=L.tick,k.initialized=L.liquidityGross.gtn(0),f!==h&&D&&(g.accounts.push(D),f=h),k.tickNext<he?k.tickNext=he:k.tickNext>we&&(k.tickNext=we),k.sqrtPriceNextX64=F.getSqrtPriceX64FromTick(k.tickNext);let z;if(s&&k.sqrtPriceNextX64.lt(b)||!s&&k.sqrtPriceNextX64.gt(b)?z=b:z=k.sqrtPriceNextX64,[g.sqrtPriceX64,k.amountIn,k.amountOut,k.feeAmount]=ct.swapStepCompute(g.sqrtPriceX64,z,g.liquidity,g.amountSpecifiedRemaining,a),g.feeAmount=g.feeAmount.add(k.feeAmount),p?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(k.amountIn.add(k.feeAmount)),g.amountCalculated=g.amountCalculated.sub(k.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(k.amountOut),g.amountCalculated=g.amountCalculated.add(k.amountIn.add(k.feeAmount))),g.sqrtPriceX64.eq(k.sqrtPriceNextX64)){if(k.initialized){let q=L.liquidityNet;s&&(q=q.mul(ze)),g.liquidity=W.addDelta(g.liquidity,q)}x=k.tickNext!=g.tick&&!s&&A.startTickIndex===k.tickNext,g.tick=s?k.tickNext-1:k.tickNext}else if(g.sqrtPriceX64!=k.sqrtPriceStartX64){let q=F.getTickFromSqrtPriceX64(g.sqrtPriceX64);x=q!=g.tick&&!s&&A.startTickIndex===q,g.tick=q}++w}try{let{nextStartIndex:k,isExist:K}=v.nextInitializedTickArray(g.tick,l,s,r,o);K&&f!==k&&(g.accounts.push(X(e,t,k).publicKey),f=k)}catch{}return{amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new O(0),amountIn:new O(0),amountOut:new O(0),feeAmount:new O(0)},a=e.gte(t),u=r.gte(ie);if(u){let l=M.mulDivFloor(r,Yt.sub(new O(o.toString())),Yt);s.amountIn=a?W.getTokenAmountAFromLiquidity(t,e,n,!0):W.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=F.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?W.getTokenAmountBFromLiquidity(t,e,n,!1):W.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(ze).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=F.getNextSqrtPriceX64FromOutput(e,n,r.mul(ze),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=W.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=W.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:W.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:W.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul(ze))&&(s.amountOut=r.mul(ze)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=M.mulDivCeil(s.amountIn,new O(o),Yt.sub(new O(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var oe=60,ut=512,P=class{static getTickArrayAddressByTick(e,t,n,r){let o=P.getTickArrayStartIndexByTick(n,r),{publicKey:s}=X(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=P.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=oe)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=v.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*v.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*oe,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*oe,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*oe:e+t*oe}static mergeTickArrayBitmap(e){let t=new Io(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*oe));return[...P.searchLowBitFromStart(e,t,s-1,o,n),...P.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return P.searchHightBitFromStart(e,t,0,ut,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=P.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of a){let{publicKey:c}=X(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>P.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===r)break}let u=v.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>P.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===r)break}let u=v.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<he||e>we}static nextInitTick(e,t,n,r,o){if(v.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<oe;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=oe-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<oe;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=F.getSqrtPriceX64FromTick(t),o=F.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new S(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new S(1).div(t),o=lt.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=F.getSqrtPriceX64FromTick(o),a=F.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new S(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=F.getSqrtPriceX64FromTick(t),o=F.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new S(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new S(1).div(t),o=lt.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=F.getSqrtPriceX64FromTick(o),a=F.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new S(1).div(a)}}};var Wm=j([Ne(8),J("bump"),bt("index"),Y(""),Xe("protocolFeeRate"),Xe("tradeFeeRate"),bt("tickSpacing"),$(N(),8,"")]),So=j([Xe("blockTimestamp"),_("sqrtPriceX64"),_("cumulativeTimePriceX64"),$(_(),1,"")]),Kn=j([Ne(8),De("initialized"),Y("poolId"),$(So,1e3,"observations"),$(_(),5,"")]),No=j([J("rewardState"),N("openTime"),N("endTime"),N("lastUpdateTime"),_("emissionsPerSecondX64"),N("rewardTotalEmissioned"),N("rewardClaimed"),Y("tokenMint"),Y("tokenVault"),Y("creator"),_("rewardGrowthGlobalX64")]),qm=j([Ne(8),J("bump"),Y("ammConfig"),Y("creator"),Y("mintA"),Y("mintB"),Y("vaultA"),Y("vaultB"),Y("observationId"),J("mintDecimalsA"),J("mintDecimalsB"),bt("tickSpacing"),_("liquidity"),_("sqrtPriceX64"),de("tickCurrent"),bt("observationIndex"),bt("observationUpdateDuration"),_("feeGrowthGlobalX64A"),_("feeGrowthGlobalX64B"),N("protocolFeesTokenA"),N("protocolFeesTokenB"),_("swapInAmountTokenA"),_("swapOutAmountTokenB"),_("swapInAmountTokenB"),_("swapOutAmountTokenA"),J("status"),$(J(),7,""),$(No,3,"rewardInfos"),$(N(),16,"tickArrayBitmap"),N("totalFeesTokenA"),N("totalFeesClaimedTokenA"),N("totalFeesTokenB"),N("totalFeesClaimedTokenB"),N("fundFeesTokenA"),N("fundFeesTokenB"),N("startTime"),$(N(),15*4-3,"padding")]),Ko=j([_("growthInsideLastX64"),N("rewardAmountOwed")]),Pi=j([Ne(8),J("bump"),Y("nftMint"),Y("poolId"),de("tickLower"),de("tickUpper"),_("liquidity"),_("feeGrowthInsideLastX64A"),_("feeGrowthInsideLastX64B"),N("tokenFeesOwedA"),N("tokenFeesOwedB"),$(Ko,3,"rewardInfos"),$(N(),8,"")]),Gm=j([Ne(8),J("bump"),Y("poolId"),de("tickLowerIndex"),de("tickUpperIndex"),_("liquidity"),_("feeGrowthInsideLastX64A"),_("feeGrowthInsideLastX64B"),N("tokenFeesOwedA"),N("tokenFeesOwedB"),$(_(),3,"rewardGrowthInside"),$(N(),8,"")]),Co=j([de("tick"),di("liquidityNet"),_("liquidityGross"),_("feeGrowthOutsideX64A"),_("feeGrowthOutsideX64B"),$(_(),3,"rewardGrowthsOutsideX64"),$(Xe(),13,"")]),St=j([Ne(8),Y("poolId"),de("startTickIndex"),$(Co,oe,"ticks"),J("initializedTickCount"),$(J(),115,"")]),Vm=j([Ne(329),$(Y(),100,"whitelistMints")]),Bi=j([Ne(8),Y("poolId"),$($(N(),8),Sn,"positiveTickArrayBitmap"),$($(N(),8),Sn,"negativeTickArrayBitmap")]);import{PublicKey as Oo,Keypair as Do}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as _o}from"@solana/spl-token";import ld from"bn.js";var Lo=j([Y("mint"),Y("owner"),N("amount"),Xe("delegateOption"),Y("delegate"),J("state"),Xe("isNativeOption"),N("isNative"),N("delegatedAmount"),Xe("closeAuthorityOption"),Y("closeAuthority")]);function Ro(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}function Cn(i,...e){if(!Ro(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}function Ln(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function Ii(i,e){Cn(i);let t=e.outputLen;if(i.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var Qt=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),Re=(i,e)=>i<<32-e|i>>>e;var Ym=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Eo(i){if(typeof i!="string")throw new Error(`utf8ToBytes expected string, got ${typeof i}`);return new Uint8Array(new TextEncoder().encode(i))}function Rn(i){return typeof i=="string"&&(i=Eo(i)),Cn(i),i}var Zt=class{clone(){return this._cloneInto()}},Zm={}.toString;function Si(i){let e=n=>i().update(Rn(n)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function Mo(i,e,t,n){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,n);let r=BigInt(32),o=BigInt(4294967295),s=Number(t>>r&o),a=Number(t&o),u=n?4:0,c=n?0:4;i.setUint32(e+u,s,n),i.setUint32(e+c,a,n)}var Ni=(i,e,t)=>i&e^~i&t,Ki=(i,e,t)=>i&e^i&t^e&t,$t=class extends Zt{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Qt(this.buffer)}update(e){Ln(this);let{view:t,buffer:n,blockLen:r}=this;e=Rn(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(r-this.pos,o-s);if(a===r){let u=Qt(e);for(;r<=o-s;s+=r)this.process(u,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ln(this),Ii(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let m=s;m<r;m++)t[m]=0;Mo(n,r-8,BigInt(this.length*8),o),this.process(n,0);let a=Qt(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let c=u/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<c;m++)a.setUint32(4*m,l[m],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:o,destroyed:s,pos:a}=this;return e.length=r,e.pos=a,e.finished=o,e.destroyed=s,r%t&&e.buffer.set(n),e}};var Fo=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Je=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),et=new Uint32Array(64),En=class extends $t{constructor(){super(64,32,8,!1),this.A=Je[0]|0,this.B=Je[1]|0,this.C=Je[2]|0,this.D=Je[3]|0,this.E=Je[4]|0,this.F=Je[5]|0,this.G=Je[6]|0,this.H=Je[7]|0}get(){let{A:e,B:t,C:n,D:r,E:o,F:s,G:a,H:u}=this;return[e,t,n,r,o,s,a,u]}set(e,t,n,r,o,s,a,u){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,t){for(let m=0;m<16;m++,t+=4)et[m]=e.getUint32(t,!1);for(let m=16;m<64;m++){let d=et[m-15],f=et[m-2],b=Re(d,7)^Re(d,18)^d>>>3,p=Re(f,17)^Re(f,19)^f>>>10;et[m]=p+et[m-7]+b+et[m-16]|0}let{A:n,B:r,C:o,D:s,E:a,F:u,G:c,H:l}=this;for(let m=0;m<64;m++){let d=Re(a,6)^Re(a,11)^Re(a,25),f=l+d+Ni(a,u,c)+Fo[m]+et[m]|0,p=(Re(n,2)^Re(n,13)^Re(n,22))+Ki(n,r,o)|0;l=c,c=u,u=a,a=s+f|0,s=o,o=r,r=n,n=f+p|0}n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,o,s,a,u,c,l)}roundClean(){et.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Ci=Si(()=>new En);var pd=ce("Raydium_Util");function Li({fromPublicKey:i,programId:e=_o}){let t=Do.generate().publicKey.toBase58().slice(0,32);return{publicKey:vo(i,t,e),seed:t}}function vo(i,e,t){let n=Buffer.concat([i.toBuffer(),Buffer.from(e),t.toBuffer()]),r=Ci(n);return new Oo(r)}var Mi=ce("Raydium_Clmm"),Me={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Fi=class{static createPoolInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,b){let p=j([_("sqrtPriceX64"),N("startTime")]),g=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:ht.programId,isSigner:!1,isWritable:!1},{pubkey:At,isSigner:!1,isWritable:!1}],h=Buffer.alloc(p.span);p.encode({sqrtPriceX64:f,startTime:b},h);let A=Buffer.from([...Me.createPool,...h]);return new Ee({keys:g,programId:e,data:A})}static async createPoolInstructions(e){let{connection:t,programId:n,owner:r,mintA:o,mintB:s,ammConfigId:a,initialPriceX64:u,startTime:c,forerunCreate:l}=e,m=Li({fromPublicKey:r,programId:n}),[d,f]=[new T(o.address),new T(s.address)],b=[ht.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:m.seed,newAccountPubkey:m.publicKey,lamports:l?0:await t.getMinimumBalanceForRentExemption(Kn.span),space:Kn.span,programId:n})],{publicKey:p}=gi(n,a,d,f),{publicKey:g}=Pn(n,p,d),{publicKey:h}=Pn(n,p,f);return b.push(this.createPoolInstruction(n,p,r,a,m.publicKey,d,g,new T(o.programId||fe),f,h,new T(s.programId||fe),$e(n,p).publicKey,u,c)),{signers:[],instructions:b,instructionTypes:[ge.CreateAccount,ge.ClmmCreatePool],address:{poolId:p,observationId:m.publicKey,mintAVault:g,mintBVault:h},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,b,p,g,h,A,w,x,k,K,L,D,z,q){let G=j([de("tickLowerIndex"),de("tickUpperIndex"),de("tickArrayLowerStartIndex"),de("tickArrayUpperStartIndex"),_("liquidity"),N("amountMaxA"),N("amountMaxB"),De("withMetadata"),J("optionBaseFlag"),De("baseFlag")]),Ae=[...q?[{pubkey:q,isSigner:!1,isWritable:!0}]:[]],ue=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:At,isSigner:!1,isWritable:!1},{pubkey:ht.programId,isSigner:!1,isWritable:!1},{pubkey:fe,isSigner:!1,isWritable:!1},{pubkey:Ri,isSigner:!1,isWritable:!1},{pubkey:ft,isSigner:!1,isWritable:!1},{pubkey:tt,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:h,isSigner:!1,isWritable:!1},...Ae],Te=Buffer.alloc(G.span);G.encode({tickLowerIndex:A,tickUpperIndex:w,tickArrayLowerStartIndex:x,tickArrayUpperStartIndex:k,liquidity:K,amountMaxA:L,amountMaxB:D,withMetadata:z==="create",baseFlag:!1,optionBaseFlag:0},Te);let Z=Buffer.from([...Me.openPosition,...Te]);return new Ee({keys:ue,programId:e,data:Z})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,f]=[new T(e.programId),new T(e.id)],b;if(l)b=new T((await l(1))[0]);else{let D=Mn.generate();m.push(D),b=D.publicKey}let p=P.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=P.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:h}=X(d,f,p),{publicKey:A}=X(d,f,g),{publicKey:w}=Ue(n.wallet,b,fe),{publicKey:x}=Ht(b),{publicKey:k}=_e(d,b),{publicKey:K}=at(d,f,r,o),L=this.openPositionFromLiquidityInstruction(d,n.feePayer,f,n.wallet,b,w,x,K,h,A,k,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),r,o,p,g,s,a,u,c);return{signers:m,instructions:[L],instructionTypes:[ge.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:b,tickArrayLower:h,tickArrayUpper:A,positionNftAccount:w,metadataAccount:x,personalPosition:k,protocolPosition:K}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,f]=[new T(e.programId),new T(e.id)],b;if(l)b=new T((await l(1))[0]);else{let D=Mn.generate();m.push(D),b=D.publicKey}let p=P.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=P.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:h}=X(d,f,p),{publicKey:A}=X(d,f,g),{publicKey:w}=Ue(n.wallet,b,fe),{publicKey:x}=Ht(b),{publicKey:k}=_e(d,b),{publicKey:K}=at(d,f,r,o),L=this.openPositionFromBaseInstruction(d,n.feePayer,f,n.wallet,b,w,x,K,h,A,k,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),r,o,p,g,c,s,a,u,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,g])?$e(d,f).publicKey:void 0);return{address:{nftMint:b,tickArrayLower:h,tickArrayUpper:A,positionNftAccount:w,metadataAccount:x,personalPosition:k,protocolPosition:K},instructions:[L],signers:m,instructionTypes:[ge.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,b,p,g,h,A,w,x,k,K,L,D,z,q){let G=j([de("tickLowerIndex"),de("tickUpperIndex"),de("tickArrayLowerStartIndex"),de("tickArrayUpperStartIndex"),_("liquidity"),N("amountMaxA"),N("amountMaxB"),De("withMetadata"),J("optionBaseFlag"),De("baseFlag")]),Ae=[...q?[{pubkey:q,isSigner:!1,isWritable:!0}]:[]],ue=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:At,isSigner:!1,isWritable:!1},{pubkey:ht.programId,isSigner:!1,isWritable:!1},{pubkey:fe,isSigner:!1,isWritable:!1},{pubkey:Ri,isSigner:!1,isWritable:!1},{pubkey:ft,isSigner:!1,isWritable:!1},{pubkey:tt,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:h,isSigner:!1,isWritable:!1},...Ae],Te=Buffer.alloc(G.span);G.encode({tickLowerIndex:A,tickUpperIndex:w,tickArrayLowerStartIndex:x,tickArrayUpperStartIndex:k,liquidity:new Ei(0),amountMaxA:L==="MintA"?D:z,amountMaxB:L==="MintA"?z:D,withMetadata:K==="create",baseFlag:L==="MintA",optionBaseFlag:1},Te);let Z=Buffer.from([...Me.openPosition,...Te]);return new Ee({keys:ue,programId:e,data:Z})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,d=[];if(l)m=new T((await l(1))[0]);else{let D=Mn.generate();d.push(D),m=D.publicKey}let[f,b]=[new T(e.programId),new T(e.id)],p=P.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=P.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:h}=X(f,b,p),{publicKey:A}=X(f,b,g),{publicKey:w}=Ue(n.wallet,m,fe),{publicKey:x}=Ht(m),{publicKey:k}=_e(f,m),{publicKey:K}=at(f,b,r,o),L=this.openPositionFromLiquidityInstruction(f,n.wallet,b,n.wallet,m,w,x,K,h,A,k,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(t.mintA.address),new T(t.mintB.address),r,o,p,g,s,a,u,c,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,g])?$e(f,b).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:h,tickArrayUpper:A,positionNftAccount:w,metadataAccount:x,personalPosition:k,protocolPosition:K},instructions:[L],signers:d,instructionTypes:[ge.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=j([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:ht.programId,isSigner:!1,isWritable:!1},{pubkey:fe,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...Me.closePosition,...u]);return new Ee({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new T(e.programId),{publicKey:s}=Ue(n.wallet,r.nftMint,fe),{publicKey:a}=_e(o,r.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[ge.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,b,p,g,h,A){let w=j([_("liquidity"),N("amountMaxA"),N("amountMaxB"),J("optionBaseFlag"),De("baseFlag")]),x=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:fe,isSigner:!1,isWritable:!1},{pubkey:tt,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...x],K=Buffer.alloc(w.span);w.encode({liquidity:p,amountMaxA:g,amountMaxB:h,optionBaseFlag:0,baseFlag:!1},K);let L=Buffer.from([...Me.increaseLiquidity,...K]);return new Ee({keys:k,programId:e,data:L})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new T(e.programId),new T(e.id)],l=P.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=P.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=X(u,c,l),{publicKey:f}=X(u,c,m),{publicKey:b}=Ue(r.wallet,n.nftMint,fe),{publicKey:p}=_e(u,n.nftMint),{publicKey:g}=at(u,c,n.tickLower,n.tickUpper),h=this.increasePositionFromLiquidityInstruction(u,r.wallet,b,p,c,g,d,f,r.tokenAccountA,r.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),o,s,a,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?$e(u,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:b,personalPosition:p,protocolPosition:g},signers:[],instructions:[h],instructionTypes:[ge.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new T(e.programId),new T(e.id)],l=P.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=P.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=X(u,c,l),{publicKey:f}=X(u,c,m),{publicKey:b}=Ue(r.wallet,n.nftMint,fe),{publicKey:p}=_e(u,n.nftMint),{publicKey:g}=at(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:b,personalPosition:p,protocolPosition:g},instructions:[this.increasePositionFromBaseInstruction(u,r.wallet,b,p,c,g,d,f,r.tokenAccountA,r.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),o,s,a,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?$e(u,c).publicKey:void 0)],signers:[],instructionTypes:[ge.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,b,p,g,h,A){let w=j([_("liquidity"),N("amountMaxA"),N("amountMaxB"),J("optionBaseFlag"),De("baseFlag")]),x=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:fe,isSigner:!1,isWritable:!1},{pubkey:tt,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...x],K=Buffer.alloc(w.span);w.encode({liquidity:new Ei(0),amountMaxA:p==="MintA"?g:h,amountMaxB:p==="MintA"?h:g,baseFlag:p==="MintA",optionBaseFlag:1},K);let L=Buffer.from([...Me.increaseLiquidity,...K]);return new Ee({keys:k,programId:e,data:L})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,b,p,g,h,A,w){let x=j([_("liquidity"),N("amountMinA"),N("amountMinB")]),k=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...p.map(z=>[{pubkey:z.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:z.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:z.rewardMint,isSigner:!1,isWritable:!1}]).flat()],K=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:fe,isSigner:!1,isWritable:!1},{pubkey:tt,isSigner:!1,isWritable:!1},{pubkey:_t,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...k],L=Buffer.alloc(x.span);x.encode({liquidity:g,amountMinA:h,amountMinB:A},L);let D=Buffer.from([...Me.decreaseLiquidity,...L]);return new Ee({keys:K,programId:e,data:D})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new T(e.programId),new T(e.id)],m=P.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=P.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:f}=X(c,l,m),{publicKey:b}=X(c,l,d),{publicKey:p}=Ue(r.wallet,n.nftMint,u),{publicKey:g}=_e(c,n.nftMint),{publicKey:h}=at(c,l,n.tickLower,n.tickUpper),A=[];for(let x=0;x<e.rewardDefaultInfos.length;x++)A.push({poolRewardVault:new T(t.rewardInfos[x].vault),ownerRewardVault:r.rewardAccounts[x],rewardMint:new T(e.rewardDefaultInfos[x].mint.address)});let w=[];return w.push(this.decreaseLiquidityInstruction(c,r.wallet,p,g,l,h,f,b,r.tokenAccountA,r.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),A,o,s,a,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?$e(c,l).publicKey:void 0)),{address:{tickArrayLower:f,tickArrayUpper:b,positionNftAccount:p,personalPosition:g,protocolPosition:h},signers:[],instructions:w,instructionTypes:[ge.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,b,p,g,h){let A=j([N("amount"),N("otherAmountThreshold"),_("sqrtPriceLimitX64"),De("isBaseInput")]),w=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[],...m.map(L=>({pubkey:L,isSigner:!1,isWritable:!0}))],x=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:fe,isSigner:!1,isWritable:!1},{pubkey:tt,isSigner:!1,isWritable:!1},{pubkey:_t,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...w],k=Buffer.alloc(A.span);A.encode({amount:f,otherAmountThreshold:b,sqrtPriceLimitX64:p,isBaseInput:g},k);let K=Buffer.from([...Me.swap,...k]);return new Ee({keys:x,programId:e,data:K})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,inputMint:r,amountIn:o,amountOutMin:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new T(e.programId),new T(e.id)],[m,d]=[new T(t.vault.A),new T(t.vault.B)],[f,b]=[new T(e.mintA.address),new T(e.mintB.address)],p=e.mintA.address===r.toString(),g=[this.swapInstruction(c,n.wallet,l,new T(e.config.id),p?n.tokenAccountA:n.tokenAccountB,p?n.tokenAccountB:n.tokenAccountA,p?m:d,p?d:m,p?f:b,p?b:f,u,m,o,s,a,!0,$e(c,l).publicKey)];return{signers:[],instructions:g,instructionTypes:[ge.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let f=j([N("openTime"),N("endTime"),_("emissionsPerSecondX64")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:ht.programId,isSigner:!1,isWritable:!1},{pubkey:At,isSigner:!1,isWritable:!1}],p=Buffer.alloc(f.span);f.encode({openTime:me(l),endTime:me(m),emissionsPerSecondX64:d},p);let g=Buffer.from([...Me.initReward,...p]);return new Ee({keys:b,programId:e,data:g})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new T(e.programId),new T(e.id)],a=yi(o,s,r.mint).publicKey,u=Bn(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new T(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[ge.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let f=j([J("rewardIndex"),_("emissionsPerSecondX64"),N("openTime"),N("endTime")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:fe,isSigner:!1,isWritable:!1},{pubkey:tt,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],p=Buffer.alloc(f.span);f.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:me(l),endTime:me(m)},p);let g=Buffer.from([...Me.setRewardEmissions,...p]);return new Ee({keys:b,programId:e,data:g})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new T(e.programId),new T(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,u=new T(t.rewardInfos[d].vault),c=new T(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&Mi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=Bn(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new T(e.config.id),n.tokenAccount,u,c,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[ge.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let u=j([J("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:fe,isSigner:!1,isWritable:!1},{pubkey:tt,isSigner:!1,isWritable:!1},{pubkey:_t,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...Me.collectReward,...l]);return new Ee({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new T(e.programId),new T(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,u=new T(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&Mi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,r,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[ge.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapBaseOutInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,outputMint:r,amountOut:o,amountInMax:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new T(e.programId),new T(e.id)],[m,d]=[new T(t.vault.A),new T(t.vault.B)],[f,b]=[new T(e.mintA.address),new T(e.mintB.address)],p=e.mintA.address===r.toString(),g=[this.swapInstruction(c,n.wallet,l,new T(e.config.id),p?n.tokenAccountB:n.tokenAccountA,p?n.tokenAccountA:n.tokenAccountB,p?d:m,p?m:d,p?f:b,p?b:f,u,m,o,s,a,!1)];return{signers:[],instructions:g,instructionTypes:[ge.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}};export{Fi as ClmmInstrument};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=instrument.mjs.map