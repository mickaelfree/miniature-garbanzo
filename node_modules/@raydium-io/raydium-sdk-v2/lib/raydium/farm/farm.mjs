var Fn=Object.defineProperty,Nn=Object.defineProperties;var vn=Object.getOwnPropertyDescriptors;var nt=Object.getOwnPropertySymbols;var kr=Object.prototype.hasOwnProperty,Ar=Object.prototype.propertyIsEnumerable;var Tr=(e,t,r)=>t in e?Fn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,O=(e,t)=>{for(var r in t||(t={}))kr.call(t,r)&&Tr(e,r,t[r]);if(nt)for(var r of nt(t))Ar.call(t,r)&&Tr(e,r,t[r]);return e},ee=(e,t)=>Nn(e,vn(t));var ot=(e,t)=>{var r={};for(var n in e)kr.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&nt)for(var n of nt(e))t.indexOf(n)<0&&Ar.call(e,n)&&(r[n]=e[n]);return r};import{createAssociatedTokenAccountInstruction as Zi}from"@solana/spl-token";import{PublicKey as W,SystemProgram as Xi}from"@solana/web3.js";import{get as Ir,set as En}from"lodash";import Lr from"dayjs";import Dn from"dayjs/plugin/utc";Lr.extend(Dn);var Rt=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Lr().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let r=t.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(r)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},Sr={},_n={};function z(e){let t=Ir(Sr,e);if(!t){let r=Ir(_n,e);t=new Rt({name:e,logLevel:r}),En(Sr,e,t)}return t}import{PublicKey as Jo}from"@solana/web3.js";import $o from"bn.js";import zo from"big.js";import gt from"bn.js";import ae from"bn.js";var ve=9e15,Ie=1e9,Kt="0123456789abcdef",st="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",at="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Ct={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-ve,maxE:ve,crypto:!1},Cr,ye,L=!0,ct="[DecimalError] ",Ae=ct+"Invalid argument: ",Vr=ct+"Precision limit exceeded",Fr=ct+"crypto unavailable",Nr="[object Decimal]",oe=Math.floor,$=Math.pow,Mn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Wn=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,On=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,vr=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,de=1e7,A=7,Un=9007199254740991,qn=st.length-1,Vt=at.length-1,y={toStringTag:Nr};y.absoluteValue=y.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),T(e)};y.ceil=function(){return T(new this.constructor(this),this.e+1,2)};y.clampedTo=y.clamp=function(e,t){var r,n=this,o=n.constructor;if(e=new o(e),t=new o(t),!e.s||!t.s)return new o(NaN);if(e.gt(t))throw Error(Ae+t);return r=n.cmp(e),r<0?e:n.cmp(t)>0?t:new o(n)};y.comparedTo=y.cmp=function(e){var t,r,n,o,i=this,s=i.d,a=(e=new i.constructor(e)).d,c=i.s,u=e.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(i.e!==e.e)return i.e>e.e^c<0?1:-1;for(n=s.length,o=a.length,t=0,r=n<o?n:o;t<r;++t)if(s[t]!==a[t])return s[t]>a[t]^c<0?1:-1;return n===o?0:n>o^c<0?1:-1};y.cosine=y.cos=function(){var e,t,r=this,n=r.constructor;return r.d?r.d[0]?(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+A,n.rounding=1,r=Gn(n,Wr(n,r)),n.precision=e,n.rounding=t,T(ye==2||ye==3?r.neg():r,e,t,!0)):new n(1):new n(NaN)};y.cubeRoot=y.cbrt=function(){var e,t,r,n,o,i,s,a,c,u,d=this,l=d.constructor;if(!d.isFinite()||d.isZero())return new l(d);for(L=!1,i=d.s*$(d.s*d,1/3),!i||Math.abs(i)==1/0?(r=te(d.d),e=d.e,(i=(e-r.length+1)%3)&&(r+=i==1||i==-2?"0":"00"),i=$(r,1/3),e=oe((e+1)/3)-(e%3==(e<0?-1:2)),i==1/0?r="5e"+e:(r=i.toExponential(),r=r.slice(0,r.indexOf("e")+1)+e),n=new l(r),n.s=d.s):n=new l(i.toString()),s=(e=l.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(d),n=_(u.plus(d).times(a),u.plus(c),s+2,1),te(a.d).slice(0,s)===(r=te(n.d)).slice(0,s))if(r=r.slice(s-3,s+1),r=="9999"||!o&&r=="4999"){if(!o&&(T(a,e+1,0),a.times(a).times(a).eq(d))){n=a;break}s+=4,o=1}else{(!+r||!+r.slice(1)&&r.charAt(0)=="5")&&(T(n,e+1,1),t=!n.times(n).times(n).eq(d));break}return L=!0,T(n,e,l.rounding,t)};y.decimalPlaces=y.dp=function(){var e,t=this.d,r=NaN;if(t){if(e=t.length-1,r=(e-oe(this.e/A))*A,e=t[e],e)for(;e%10==0;e/=10)r--;r<0&&(r=0)}return r};y.dividedBy=y.div=function(e){return _(this,new this.constructor(e))};y.dividedToIntegerBy=y.divToInt=function(e){var t=this,r=t.constructor;return T(_(t,new r(e),0,1,1),r.precision,r.rounding)};y.equals=y.eq=function(e){return this.cmp(e)===0};y.floor=function(){return T(new this.constructor(this),this.e+1,3)};y.greaterThan=y.gt=function(e){return this.cmp(e)>0};y.greaterThanOrEqualTo=y.gte=function(e){var t=this.cmp(e);return t==1||t===0};y.hyperbolicCosine=y.cosh=function(){var e,t,r,n,o,i=this,s=i.constructor,a=new s(1);if(!i.isFinite())return new s(i.s?1/0:NaN);if(i.isZero())return a;r=s.precision,n=s.rounding,s.precision=r+Math.max(i.e,i.sd())+4,s.rounding=1,o=i.d.length,o<32?(e=Math.ceil(o/3),t=(1/dt(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),i=Ee(s,1,i.times(t),new s(1),!0);for(var c,u=e,d=new s(8);u--;)c=i.times(i),i=a.minus(c.times(d.minus(c.times(d))));return T(i,s.precision=r,s.rounding=n,!0)};y.hyperbolicSine=y.sinh=function(){var e,t,r,n,o=this,i=o.constructor;if(!o.isFinite()||o.isZero())return new i(o);if(t=i.precision,r=i.rounding,i.precision=t+Math.max(o.e,o.sd())+4,i.rounding=1,n=o.d.length,n<3)o=Ee(i,2,o,o,!0);else{e=1.4*Math.sqrt(n),e=e>16?16:e|0,o=o.times(1/dt(5,e)),o=Ee(i,2,o,o,!0);for(var s,a=new i(5),c=new i(16),u=new i(20);e--;)s=o.times(o),o=o.times(a.plus(s.times(c.times(s).plus(u))))}return i.precision=t,i.rounding=r,T(o,t,r,!0)};y.hyperbolicTangent=y.tanh=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+7,n.rounding=1,_(r.sinh(),r.cosh(),n.precision=e,n.rounding=t)):new n(r.s)};y.inverseCosine=y.acos=function(){var e,t=this,r=t.constructor,n=t.abs().cmp(1),o=r.precision,i=r.rounding;return n!==-1?n===0?t.isNeg()?le(r,o,i):new r(0):new r(NaN):t.isZero()?le(r,o+4,i).times(.5):(r.precision=o+6,r.rounding=1,t=t.asin(),e=le(r,o+4,i).times(.5),r.precision=o,r.rounding=i,e.minus(t))};y.inverseHyperbolicCosine=y.acosh=function(){var e,t,r=this,n=r.constructor;return r.lte(1)?new n(r.eq(1)?0:NaN):r.isFinite()?(e=n.precision,t=n.rounding,n.precision=e+Math.max(Math.abs(r.e),r.sd())+4,n.rounding=1,L=!1,r=r.times(r).minus(1).sqrt().plus(r),L=!0,n.precision=e,n.rounding=t,r.ln()):new n(r)};y.inverseHyperbolicSine=y.asinh=function(){var e,t,r=this,n=r.constructor;return!r.isFinite()||r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+2*Math.max(Math.abs(r.e),r.sd())+6,n.rounding=1,L=!1,r=r.times(r).plus(1).sqrt().plus(r),L=!0,n.precision=e,n.rounding=t,r.ln())};y.inverseHyperbolicTangent=y.atanh=function(){var e,t,r,n,o=this,i=o.constructor;return o.isFinite()?o.e>=0?new i(o.abs().eq(1)?o.s/0:o.isZero()?o:NaN):(e=i.precision,t=i.rounding,n=o.sd(),Math.max(n,e)<2*-o.e-1?T(new i(o),e,t,!0):(i.precision=r=n-o.e,o=_(o.plus(1),new i(1).minus(o),r+e,1),i.precision=e+4,i.rounding=1,o=o.ln(),i.precision=e,i.rounding=t,o.times(.5))):new i(NaN)};y.inverseSine=y.asin=function(){var e,t,r,n,o=this,i=o.constructor;return o.isZero()?new i(o):(t=o.abs().cmp(1),r=i.precision,n=i.rounding,t!==-1?t===0?(e=le(i,r+4,n).times(.5),e.s=o.s,e):new i(NaN):(i.precision=r+6,i.rounding=1,o=o.div(new i(1).minus(o.times(o)).sqrt().plus(1)).atan(),i.precision=r,i.rounding=n,o.times(2)))};y.inverseTangent=y.atan=function(){var e,t,r,n,o,i,s,a,c,u=this,d=u.constructor,l=d.precision,f=d.rounding;if(u.isFinite()){if(u.isZero())return new d(u);if(u.abs().eq(1)&&l+4<=Vt)return s=le(d,l+4,f).times(.25),s.s=u.s,s}else{if(!u.s)return new d(NaN);if(l+4<=Vt)return s=le(d,l+4,f).times(.5),s.s=u.s,s}for(d.precision=a=l+10,d.rounding=1,r=Math.min(28,a/A+2|0),e=r;e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(L=!1,t=Math.ceil(a/A),n=1,c=u.times(u),s=new d(u),o=u;e!==-1;)if(o=o.times(c),i=s.minus(o.div(n+=2)),o=o.times(c),s=i.plus(o.div(n+=2)),s.d[t]!==void 0)for(e=t;s.d[e]===i.d[e]&&e--;);return r&&(s=s.times(2<<r-1)),L=!0,T(s,d.precision=l,d.rounding=f,!0)};y.isFinite=function(){return!!this.d};y.isInteger=y.isInt=function(){return!!this.d&&oe(this.e/A)>this.d.length-2};y.isNaN=function(){return!this.s};y.isNegative=y.isNeg=function(){return this.s<0};y.isPositive=y.isPos=function(){return this.s>0};y.isZero=function(){return!!this.d&&this.d[0]===0};y.lessThan=y.lt=function(e){return this.cmp(e)<0};y.lessThanOrEqualTo=y.lte=function(e){return this.cmp(e)<1};y.logarithm=y.log=function(e){var t,r,n,o,i,s,a,c,u=this,d=u.constructor,l=d.precision,f=d.rounding,p=5;if(e==null)e=new d(10),t=!0;else{if(e=new d(e),r=e.d,e.s<0||!r||!r[0]||e.eq(1))return new d(NaN);t=e.eq(10)}if(r=u.d,u.s<0||!r||!r[0]||u.eq(1))return new d(r&&!r[0]?-1/0:u.s!=1?NaN:r?0:1/0);if(t)if(r.length>1)i=!0;else{for(o=r[0];o%10===0;)o/=10;i=o!==1}if(L=!1,a=l+p,s=ke(u,a),n=t?ut(d,a+10):ke(e,a),c=_(s,n,a,1),Oe(c.d,o=l,f))do if(a+=10,s=ke(u,a),n=t?ut(d,a+10):ke(e,a),c=_(s,n,a,1),!i){+te(c.d).slice(o+1,o+15)+1==1e14&&(c=T(c,l+1,0));break}while(Oe(c.d,o+=10,f));return L=!0,T(c,l,f)};y.minus=y.sub=function(e){var t,r,n,o,i,s,a,c,u,d,l,f,p=this,g=p.constructor;if(e=new g(e),!p.d||!e.d)return!p.s||!e.s?e=new g(NaN):p.d?e.s=-e.s:e=new g(e.d||p.s!==e.s?p:NaN),e;if(p.s!=e.s)return e.s=-e.s,p.plus(e);if(u=p.d,f=e.d,a=g.precision,c=g.rounding,!u[0]||!f[0]){if(f[0])e.s=-e.s;else if(u[0])e=new g(p);else return new g(c===3?-0:0);return L?T(e,a,c):e}if(r=oe(e.e/A),d=oe(p.e/A),u=u.slice(),i=d-r,i){for(l=i<0,l?(t=u,i=-i,s=f.length):(t=f,r=d,s=u.length),n=Math.max(Math.ceil(a/A),s)+2,i>n&&(i=n,t.length=1),t.reverse(),n=i;n--;)t.push(0);t.reverse()}else{for(n=u.length,s=f.length,l=n<s,l&&(s=n),n=0;n<s;n++)if(u[n]!=f[n]){l=u[n]<f[n];break}i=0}for(l&&(t=u,u=f,f=t,e.s=-e.s),s=u.length,n=f.length-s;n>0;--n)u[s++]=0;for(n=f.length;n>i;){if(u[--n]<f[n]){for(o=n;o&&u[--o]===0;)u[o]=de-1;--u[o],u[n]+=de}u[n]-=f[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--r;return u[0]?(e.d=u,e.e=lt(u,r),L?T(e,a,c):e):new g(c===3?-0:0)};y.modulo=y.mod=function(e){var t,r=this,n=r.constructor;return e=new n(e),!r.d||!e.s||e.d&&!e.d[0]?new n(NaN):!e.d||r.d&&!r.d[0]?T(new n(r),n.precision,n.rounding):(L=!1,n.modulo==9?(t=_(r,e.abs(),0,3,1),t.s*=e.s):t=_(r,e,0,n.modulo,1),t=t.times(e),L=!0,r.minus(t))};y.naturalExponential=y.exp=function(){return Ft(this)};y.naturalLogarithm=y.ln=function(){return ke(this)};y.negated=y.neg=function(){var e=new this.constructor(this);return e.s=-e.s,T(e)};y.plus=y.add=function(e){var t,r,n,o,i,s,a,c,u,d,l=this,f=l.constructor;if(e=new f(e),!l.d||!e.d)return!l.s||!e.s?e=new f(NaN):l.d||(e=new f(e.d||l.s===e.s?l:NaN)),e;if(l.s!=e.s)return e.s=-e.s,l.minus(e);if(u=l.d,d=e.d,a=f.precision,c=f.rounding,!u[0]||!d[0])return d[0]||(e=new f(l)),L?T(e,a,c):e;if(i=oe(l.e/A),n=oe(e.e/A),u=u.slice(),o=i-n,o){for(o<0?(r=u,o=-o,s=d.length):(r=d,n=i,s=u.length),i=Math.ceil(a/A),s=i>s?i+1:s+1,o>s&&(o=s,r.length=1),r.reverse();o--;)r.push(0);r.reverse()}for(s=u.length,o=d.length,s-o<0&&(o=s,r=d,d=u,u=r),t=0;o;)t=(u[--o]=u[o]+d[o]+t)/de|0,u[o]%=de;for(t&&(u.unshift(t),++n),s=u.length;u[--s]==0;)u.pop();return e.d=u,e.e=lt(u,n),L?T(e,a,c):e};y.precision=y.sd=function(e){var t,r=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Ae+e);return r.d?(t=Er(r.d),e&&r.e+1>t&&(t=r.e+1)):t=NaN,t};y.round=function(){var e=this,t=e.constructor;return T(new t(e),e.e+1,t.rounding)};y.sine=y.sin=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+A,n.rounding=1,r=Hn(n,Wr(n,r)),n.precision=e,n.rounding=t,T(ye>2?r.neg():r,e,t,!0)):new n(NaN)};y.squareRoot=y.sqrt=function(){var e,t,r,n,o,i,s=this,a=s.d,c=s.e,u=s.s,d=s.constructor;if(u!==1||!a||!a[0])return new d(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(L=!1,u=Math.sqrt(+s),u==0||u==1/0?(t=te(a),(t.length+c)%2==0&&(t+="0"),u=Math.sqrt(t),c=oe((c+1)/2)-(c<0||c%2),u==1/0?t="5e"+c:(t=u.toExponential(),t=t.slice(0,t.indexOf("e")+1)+c),n=new d(t)):n=new d(u.toString()),r=(c=d.precision)+3;;)if(i=n,n=i.plus(_(s,i,r+2,1)).times(.5),te(i.d).slice(0,r)===(t=te(n.d)).slice(0,r))if(t=t.slice(r-3,r+1),t=="9999"||!o&&t=="4999"){if(!o&&(T(i,c+1,0),i.times(i).eq(s))){n=i;break}r+=4,o=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(T(n,c+1,1),e=!n.times(n).eq(s));break}return L=!0,T(n,c,d.rounding,e)};y.tangent=y.tan=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+10,n.rounding=1,r=r.sin(),r.s=1,r=_(r,new n(1).minus(r.times(r)).sqrt(),e+10,0),n.precision=e,n.rounding=t,T(ye==2||ye==4?r.neg():r,e,t,!0)):new n(NaN)};y.times=y.mul=function(e){var t,r,n,o,i,s,a,c,u,d=this,l=d.constructor,f=d.d,p=(e=new l(e)).d;if(e.s*=d.s,!f||!f[0]||!p||!p[0])return new l(!e.s||f&&!f[0]&&!p||p&&!p[0]&&!f?NaN:!f||!p?e.s/0:e.s*0);for(r=oe(d.e/A)+oe(e.e/A),c=f.length,u=p.length,c<u&&(i=f,f=p,p=i,s=c,c=u,u=s),i=[],s=c+u,n=s;n--;)i.push(0);for(n=u;--n>=0;){for(t=0,o=c+n;o>n;)a=i[o]+p[n]*f[o-n-1]+t,i[o--]=a%de|0,t=a/de|0;i[o]=(i[o]+t)%de|0}for(;!i[--s];)i.pop();return t?++r:i.shift(),e.d=i,e.e=lt(i,r),L?T(e,l.precision,l.rounding):e};y.toBinary=function(e,t){return vt(this,2,e,t)};y.toDecimalPlaces=y.toDP=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(se(e,0,Ie),t===void 0?t=n.rounding:se(t,0,8),T(r,e+r.e+1,t))};y.toExponential=function(e,t){var r,n=this,o=n.constructor;return e===void 0?r=me(n,!0):(se(e,0,Ie),t===void 0?t=o.rounding:se(t,0,8),n=T(new o(n),e+1,t),r=me(n,!0,e+1)),n.isNeg()&&!n.isZero()?"-"+r:r};y.toFixed=function(e,t){var r,n,o=this,i=o.constructor;return e===void 0?r=me(o):(se(e,0,Ie),t===void 0?t=i.rounding:se(t,0,8),n=T(new i(o),e+o.e+1,t),r=me(n,!1,e+n.e+1)),o.isNeg()&&!o.isZero()?"-"+r:r};y.toFraction=function(e){var t,r,n,o,i,s,a,c,u,d,l,f,p=this,g=p.d,m=p.constructor;if(!g)return new m(p);if(u=r=new m(1),n=c=new m(0),t=new m(n),i=t.e=Er(g)-p.e-1,s=i%A,t.d[0]=$(10,s<0?A+s:s),e==null)e=i>0?t:u;else{if(a=new m(e),!a.isInt()||a.lt(u))throw Error(Ae+a);e=a.gt(t)?i>0?t:u:a}for(L=!1,a=new m(te(g)),d=m.precision,m.precision=i=g.length*A*2;l=_(a,t,0,1,1),o=r.plus(l.times(n)),o.cmp(e)!=1;)r=n,n=o,o=u,u=c.plus(l.times(o)),c=o,o=t,t=a.minus(l.times(o)),a=o;return o=_(e.minus(r),n,0,1,1),c=c.plus(o.times(u)),r=r.plus(o.times(n)),c.s=u.s=p.s,f=_(u,n,i,1).minus(p).abs().cmp(_(c,r,i,1).minus(p).abs())<1?[u,n]:[c,r],m.precision=d,L=!0,f};y.toHexadecimal=y.toHex=function(e,t){return vt(this,16,e,t)};y.toNearest=function(e,t){var r=this,n=r.constructor;if(r=new n(r),e==null){if(!r.d)return r;e=new n(1),t=n.rounding}else{if(e=new n(e),t===void 0?t=n.rounding:se(t,0,8),!r.d)return e.s?r:e;if(!e.d)return e.s&&(e.s=r.s),e}return e.d[0]?(L=!1,r=_(r,e,0,t,1).times(e),L=!0,T(r)):(e.s=r.s,r=e),r};y.toNumber=function(){return+this};y.toOctal=function(e,t){return vt(this,8,e,t)};y.toPower=y.pow=function(e){var t,r,n,o,i,s,a=this,c=a.constructor,u=+(e=new c(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new c($(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,i=c.rounding,e.eq(1))return T(a,n,i);if(t=oe(e.e/A),t>=e.d.length-1&&(r=u<0?-u:u)<=Un)return o=Dr(c,a,r,n),e.s<0?new c(1).div(o):T(o,n,i);if(s=a.s,s<0){if(t<e.d.length-1)return new c(NaN);if((e.d[t]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return r=$(+a,u),t=r==0||!isFinite(r)?oe(u*(Math.log("0."+te(a.d))/Math.LN10+a.e+1)):new c(r+"").e,t>c.maxE+1||t<c.minE-1?new c(t>0?s/0:0):(L=!1,c.rounding=a.s=1,r=Math.min(12,(t+"").length),o=Ft(e.times(ke(a,n+r)),n),o.d&&(o=T(o,n+5,1),Oe(o.d,n,i)&&(t=n+10,o=T(Ft(e.times(ke(a,t+r)),t),t+5,1),+te(o.d).slice(n+1,n+15)+1==1e14&&(o=T(o,n+1,0)))),o.s=s,L=!0,c.rounding=i,T(o,n,i))};y.toPrecision=function(e,t){var r,n=this,o=n.constructor;return e===void 0?r=me(n,n.e<=o.toExpNeg||n.e>=o.toExpPos):(se(e,1,Ie),t===void 0?t=o.rounding:se(t,0,8),n=T(new o(n),e,t),r=me(n,e<=n.e||n.e<=o.toExpNeg,e)),n.isNeg()&&!n.isZero()?"-"+r:r};y.toSignificantDigits=y.toSD=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(se(e,1,Ie),t===void 0?t=n.rounding:se(t,0,8)),T(new n(r),e,t)};y.toString=function(){var e=this,t=e.constructor,r=me(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+r:r};y.truncated=y.trunc=function(){return T(new this.constructor(this),this.e+1,1)};y.valueOf=y.toJSON=function(){var e=this,t=e.constructor,r=me(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+r:r};function te(e){var t,r,n,o=e.length-1,i="",s=e[0];if(o>0){for(i+=s,t=1;t<o;t++)n=e[t]+"",r=A-n.length,r&&(i+=Te(r)),i+=n;s=e[t],n=s+"",r=A-n.length,r&&(i+=Te(r))}else if(s===0)return"0";for(;s%10===0;)s/=10;return i+s}function se(e,t,r){if(e!==~~e||e<t||e>r)throw Error(Ae+e)}function Oe(e,t,r,n){var o,i,s,a;for(i=e[0];i>=10;i/=10)--t;return--t<0?(t+=A,o=0):(o=Math.ceil((t+1)/A),t%=A),i=$(10,A-t),a=e[o]%i|0,n==null?t<3?(t==0?a=a/100|0:t==1&&(a=a/10|0),s=r<4&&a==99999||r>3&&a==49999||a==5e4||a==0):s=(r<4&&a+1==i||r>3&&a+1==i/2)&&(e[o+1]/i/100|0)==$(10,t-2)-1||(a==i/2||a==0)&&(e[o+1]/i/100|0)==0:t<4?(t==0?a=a/1e3|0:t==1?a=a/100|0:t==2&&(a=a/10|0),s=(n||r<4)&&a==9999||!n&&r>3&&a==4999):s=((n||r<4)&&a+1==i||!n&&r>3&&a+1==i/2)&&(e[o+1]/i/1e3|0)==$(10,t-3)-1,s}function it(e,t,r){for(var n,o=[0],i,s=0,a=e.length;s<a;){for(i=o.length;i--;)o[i]*=t;for(o[0]+=Kt.indexOf(e.charAt(s++)),n=0;n<o.length;n++)o[n]>r-1&&(o[n+1]===void 0&&(o[n+1]=0),o[n+1]+=o[n]/r|0,o[n]%=r)}return o.reverse()}function Gn(e,t){var r,n,o;if(t.isZero())return t;n=t.d.length,n<32?(r=Math.ceil(n/3),o=(1/dt(4,r)).toString()):(r=16,o="2.3283064365386962890625e-10"),e.precision+=r,t=Ee(e,1,t.times(o),new e(1));for(var i=r;i--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=r,t}var _=function(){function e(n,o,i){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*o+a,n[c]=s%i|0,a=s/i|0;return a&&n.unshift(a),n}function t(n,o,i,s){var a,c;if(i!=s)c=i>s?1:-1;else for(a=c=0;a<i;a++)if(n[a]!=o[a]){c=n[a]>o[a]?1:-1;break}return c}function r(n,o,i,s){for(var a=0;i--;)n[i]-=a,a=n[i]<o[i]?1:0,n[i]=a*s+n[i]-o[i];for(;!n[0]&&n.length>1;)n.shift()}return function(n,o,i,s,a,c){var u,d,l,f,p,g,m,x,b,I,w,k,S,B,q,re,F,G,j,J,N=n.constructor,ne=n.s==o.s?1:-1,Y=n.d,E=o.d;if(!Y||!Y[0]||!E||!E[0])return new N(!n.s||!o.s||(Y?E&&Y[0]==E[0]:!E)?NaN:Y&&Y[0]==0||!E?ne*0:ne/0);for(c?(p=1,d=n.e-o.e):(c=de,p=A,d=oe(n.e/p)-oe(o.e/p)),j=E.length,F=Y.length,b=new N(ne),I=b.d=[],l=0;E[l]==(Y[l]||0);l++);if(E[l]>(Y[l]||0)&&d--,i==null?(B=i=N.precision,s=N.rounding):a?B=i+(n.e-o.e)+1:B=i,B<0)I.push(1),g=!0;else{if(B=B/p+2|0,l=0,j==1){for(f=0,E=E[0],B++;(l<F||f)&&B--;l++)q=f*c+(Y[l]||0),I[l]=q/E|0,f=q%E|0;g=f||l<F}else{for(f=c/(E[0]+1)|0,f>1&&(E=e(E,f,c),Y=e(Y,f,c),j=E.length,F=Y.length),re=j,w=Y.slice(0,j),k=w.length;k<j;)w[k++]=0;J=E.slice(),J.unshift(0),G=E[0],E[1]>=c/2&&++G;do f=0,u=t(E,w,j,k),u<0?(S=w[0],j!=k&&(S=S*c+(w[1]||0)),f=S/G|0,f>1?(f>=c&&(f=c-1),m=e(E,f,c),x=m.length,k=w.length,u=t(m,w,x,k),u==1&&(f--,r(m,j<x?J:E,x,c))):(f==0&&(u=f=1),m=E.slice()),x=m.length,x<k&&m.unshift(0),r(w,m,k,c),u==-1&&(k=w.length,u=t(E,w,j,k),u<1&&(f++,r(w,j<k?J:E,k,c))),k=w.length):u===0&&(f++,w=[0]),I[l++]=f,u&&w[0]?w[k++]=Y[re]||0:(w=[Y[re]],k=1);while((re++<F||w[0]!==void 0)&&B--);g=w[0]!==void 0}I[0]||I.shift()}if(p==1)b.e=d,Cr=g;else{for(l=1,f=I[0];f>=10;f/=10)l++;b.e=l+d*p-1,T(b,a?i+b.e+1:i,s,g)}return b}}();function T(e,t,r,n){var o,i,s,a,c,u,d,l,f,p=e.constructor;e:if(t!=null){if(l=e.d,!l)return e;for(o=1,a=l[0];a>=10;a/=10)o++;if(i=t-o,i<0)i+=A,s=t,d=l[f=0],c=d/$(10,o-s-1)%10|0;else if(f=Math.ceil((i+1)/A),a=l.length,f>=a)if(n){for(;a++<=f;)l.push(0);d=c=0,o=1,i%=A,s=i-A+1}else break e;else{for(d=a=l[f],o=1;a>=10;a/=10)o++;i%=A,s=i-A+o,c=s<0?0:d/$(10,o-s-1)%10|0}if(n=n||t<0||l[f+1]!==void 0||(s<0?d:d%$(10,o-s-1)),u=r<4?(c||n)&&(r==0||r==(e.s<0?3:2)):c>5||c==5&&(r==4||n||r==6&&(i>0?s>0?d/$(10,o-s):0:l[f-1])%10&1||r==(e.s<0?8:7)),t<1||!l[0])return l.length=0,u?(t-=e.e+1,l[0]=$(10,(A-t%A)%A),e.e=-t||0):l[0]=e.e=0,e;if(i==0?(l.length=f,a=1,f--):(l.length=f+1,a=$(10,A-i),l[f]=s>0?(d/$(10,o-s)%$(10,s)|0)*a:0),u)for(;;)if(f==0){for(i=1,s=l[0];s>=10;s/=10)i++;for(s=l[0]+=a,a=1;s>=10;s/=10)a++;i!=a&&(e.e++,l[0]==de&&(l[0]=1));break}else{if(l[f]+=a,l[f]!=de)break;l[f--]=0,a=1}for(i=l.length;l[--i]===0;)l.pop()}return L&&(e.e>p.maxE?(e.d=null,e.e=NaN):e.e<p.minE&&(e.e=0,e.d=[0])),e}function me(e,t,r){if(!e.isFinite())return Mr(e);var n,o=e.e,i=te(e.d),s=i.length;return t?(r&&(n=r-s)>0?i=i.charAt(0)+"."+i.slice(1)+Te(n):s>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(e.e<0?"e":"e+")+e.e):o<0?(i="0."+Te(-o-1)+i,r&&(n=r-s)>0&&(i+=Te(n))):o>=s?(i+=Te(o+1-s),r&&(n=r-o-1)>0&&(i=i+"."+Te(n))):((n=o+1)<s&&(i=i.slice(0,n)+"."+i.slice(n)),r&&(n=r-s)>0&&(o+1===s&&(i+="."),i+=Te(n))),i}function lt(e,t){var r=e[0];for(t*=A;r>=10;r/=10)t++;return t}function ut(e,t,r){if(t>qn)throw L=!0,r&&(e.precision=r),Error(Vr);return T(new e(st),t,1,!0)}function le(e,t,r){if(t>Vt)throw Error(Vr);return T(new e(at),t,r,!0)}function Er(e){var t=e.length-1,r=t*A+1;if(t=e[t],t){for(;t%10==0;t/=10)r--;for(t=e[0];t>=10;t/=10)r++}return r}function Te(e){for(var t="";e--;)t+="0";return t}function Dr(e,t,r,n){var o,i=new e(1),s=Math.ceil(n/A+4);for(L=!1;;){if(r%2&&(i=i.times(t),Rr(i.d,s)&&(o=!0)),r=oe(r/2),r===0){r=i.d.length-1,o&&i.d[r]===0&&++i.d[r];break}t=t.times(t),Rr(t.d,s)}return L=!0,i}function Br(e){return e.d[e.d.length-1]&1}function _r(e,t,r){for(var n,o=new e(t[0]),i=0;++i<t.length;)if(n=new e(t[i]),n.s)o[r](n)&&(o=n);else{o=n;break}return o}function Ft(e,t){var r,n,o,i,s,a,c,u=0,d=0,l=0,f=e.constructor,p=f.rounding,g=f.precision;if(!e.d||!e.d[0]||e.e>17)return new f(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:0/0);for(t==null?(L=!1,c=g):c=t,a=new f(.03125);e.e>-2;)e=e.times(a),l+=5;for(n=Math.log($(2,l))/Math.LN10*2+5|0,c+=n,r=i=s=new f(1),f.precision=c;;){if(i=T(i.times(e),c,1),r=r.times(++d),a=s.plus(_(i,r,c,1)),te(a.d).slice(0,c)===te(s.d).slice(0,c)){for(o=l;o--;)s=T(s.times(s),c,1);if(t==null)if(u<3&&Oe(s.d,c-n,p,u))f.precision=c+=10,r=i=a=new f(1),d=0,u++;else return T(s,f.precision=g,p,L=!0);else return f.precision=g,s}s=a}}function ke(e,t){var r,n,o,i,s,a,c,u,d,l,f,p=1,g=10,m=e,x=m.d,b=m.constructor,I=b.rounding,w=b.precision;if(m.s<0||!x||!x[0]||!m.e&&x[0]==1&&x.length==1)return new b(x&&!x[0]?-1/0:m.s!=1?NaN:x?0:m);if(t==null?(L=!1,d=w):d=t,b.precision=d+=g,r=te(x),n=r.charAt(0),Math.abs(i=m.e)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)m=m.times(e),r=te(m.d),n=r.charAt(0),p++;i=m.e,n>1?(m=new b("0."+r),i++):m=new b(n+"."+r.slice(1))}else return u=ut(b,d+2,w).times(i+""),m=ke(new b(n+"."+r.slice(1)),d-g).plus(u),b.precision=w,t==null?T(m,w,I,L=!0):m;for(l=m,c=s=m=_(m.minus(1),m.plus(1),d,1),f=T(m.times(m),d,1),o=3;;){if(s=T(s.times(f),d,1),u=c.plus(_(s,new b(o),d,1)),te(u.d).slice(0,d)===te(c.d).slice(0,d))if(c=c.times(2),i!==0&&(c=c.plus(ut(b,d+2,w).times(i+""))),c=_(c,new b(p),d,1),t==null)if(Oe(c.d,d-g,I,a))b.precision=d+=g,u=s=m=_(l.minus(1),l.plus(1),d,1),f=T(m.times(m),d,1),o=a=1;else return T(c,b.precision=w,I,L=!0);else return b.precision=w,c;c=u,o+=2}}function Mr(e){return String(e.s*e.s/0)}function Nt(e,t){var r,n,o;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;n++);for(o=t.length;t.charCodeAt(o-1)===48;--o);if(t=t.slice(n,o),t){if(o-=n,e.e=r=r-n-1,e.d=[],n=(r+1)%A,r<0&&(n+=A),n<o){for(n&&e.d.push(+t.slice(0,n)),o-=A;n<o;)e.d.push(+t.slice(n,n+=A));t=t.slice(n),n=A-t.length}else n-=o;for(;n--;)t+="0";e.d.push(+t),L&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function jn(e,t){var r,n,o,i,s,a,c,u,d;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),vr.test(t))return Nt(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(Wn.test(t))r=16,t=t.toLowerCase();else if(Mn.test(t))r=2;else if(On.test(t))r=8;else throw Error(Ae+t);for(i=t.search(/p/i),i>0?(c=+t.slice(i+1),t=t.substring(2,i)):t=t.slice(2),i=t.indexOf("."),s=i>=0,n=e.constructor,s&&(t=t.replace(".",""),a=t.length,i=a-i,o=Dr(n,new n(r),i,i*2)),u=it(t,r,de),d=u.length-1,i=d;u[i]===0;--i)u.pop();return i<0?new n(e.s*0):(e.e=lt(u,d),e.d=u,L=!1,s&&(e=_(e,o,a*4)),c&&(e=e.times(Math.abs(c)<54?$(2,c):Ue.pow(2,c))),L=!0,e)}function Hn(e,t){var r,n=t.d.length;if(n<3)return t.isZero()?t:Ee(e,2,t,t);r=1.4*Math.sqrt(n),r=r>16?16:r|0,t=t.times(1/dt(5,r)),t=Ee(e,2,t,t);for(var o,i=new e(5),s=new e(16),a=new e(20);r--;)o=t.times(t),t=t.times(i.plus(o.times(s.times(o).minus(a))));return t}function Ee(e,t,r,n,o){var i,s,a,c,u=1,d=e.precision,l=Math.ceil(d/A);for(L=!1,c=r.times(r),a=new e(n);;){if(s=_(a.times(c),new e(t++*t++),d,1),a=o?n.plus(s):n.minus(s),n=_(s.times(c),new e(t++*t++),d,1),s=a.plus(n),s.d[l]!==void 0){for(i=l;s.d[i]===a.d[i]&&i--;);if(i==-1)break}i=a,a=n,n=s,s=i,u++}return L=!0,s.d.length=l+1,s}function dt(e,t){for(var r=e;--t;)r*=e;return r}function Wr(e,t){var r,n=t.s<0,o=le(e,e.precision,1),i=o.times(.5);if(t=t.abs(),t.lte(i))return ye=n?4:1,t;if(r=t.divToInt(o),r.isZero())ye=n?3:2;else{if(t=t.minus(r.times(o)),t.lte(i))return ye=Br(r)?n?2:3:n?4:1,t;ye=Br(r)?n?1:4:n?3:2}return t.minus(o).abs()}function vt(e,t,r,n){var o,i,s,a,c,u,d,l,f,p=e.constructor,g=r!==void 0;if(g?(se(r,1,Ie),n===void 0?n=p.rounding:se(n,0,8)):(r=p.precision,n=p.rounding),!e.isFinite())d=Mr(e);else{for(d=me(e),s=d.indexOf("."),g?(o=2,t==16?r=r*4-3:t==8&&(r=r*3-2)):o=t,s>=0&&(d=d.replace(".",""),f=new p(1),f.e=d.length-s,f.d=it(me(f),10,o),f.e=f.d.length),l=it(d,10,o),i=c=l.length;l[--c]==0;)l.pop();if(!l[0])d=g?"0p+0":"0";else{if(s<0?i--:(e=new p(e),e.d=l,e.e=i,e=_(e,f,r,n,0,o),l=e.d,i=e.e,u=Cr),s=l[r],a=o/2,u=u||l[r+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(e.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&l[r-1]&1||n===(e.s<0?8:7)),l.length=r,u)for(;++l[--r]>o-1;)l[r]=0,r||(++i,l.unshift(1));for(c=l.length;!l[c-1];--c);for(s=0,d="";s<c;s++)d+=Kt.charAt(l[s]);if(g){if(c>1)if(t==16||t==8){for(s=t==16?4:3,--c;c%s;c++)d+="0";for(l=it(d,o,t),c=l.length;!l[c-1];--c);for(s=1,d="1.";s<c;s++)d+=Kt.charAt(l[s])}else d=d.charAt(0)+"."+d.slice(1);d=d+(i<0?"p":"p+")+i}else if(i<0){for(;++i;)d="0"+d;d="0."+d}else if(++i>c)for(i-=c;i--;)d+="0";else i<c&&(d=d.slice(0,i)+"."+d.slice(i))}d=(t==16?"0x":t==2?"0b":t==8?"0o":"")+d}return e.s<0?"-"+d:d}function Rr(e,t){if(e.length>t)return e.length=t,!0}function Yn(e){return new this(e).abs()}function zn(e){return new this(e).acos()}function Zn(e){return new this(e).acosh()}function Xn(e,t){return new this(e).plus(t)}function Jn(e){return new this(e).asin()}function $n(e){return new this(e).asinh()}function Qn(e){return new this(e).atan()}function eo(e){return new this(e).atanh()}function to(e,t){e=new this(e),t=new this(t);var r,n=this.precision,o=this.rounding,i=n+4;return!e.s||!t.s?r=new this(NaN):!e.d&&!t.d?(r=le(this,i,1).times(t.s>0?.25:.75),r.s=e.s):!t.d||e.isZero()?(r=t.s<0?le(this,n,o):new this(0),r.s=e.s):!e.d||t.isZero()?(r=le(this,i,1).times(.5),r.s=e.s):t.s<0?(this.precision=i,this.rounding=1,r=this.atan(_(e,t,i,1)),t=le(this,i,1),this.precision=n,this.rounding=o,r=e.s<0?r.minus(t):r.plus(t)):r=this.atan(_(e,t,i,1)),r}function ro(e){return new this(e).cbrt()}function no(e){return T(e=new this(e),e.e+1,2)}function oo(e,t,r){return new this(e).clamp(t,r)}function io(e){if(!e||typeof e!="object")throw Error(ct+"Object expected");var t,r,n,o=e.defaults===!0,i=["precision",1,Ie,"rounding",0,8,"toExpNeg",-ve,0,"toExpPos",0,ve,"maxE",0,ve,"minE",-ve,0,"modulo",0,9];for(t=0;t<i.length;t+=3)if(r=i[t],o&&(this[r]=Ct[r]),(n=e[r])!==void 0)if(oe(n)===n&&n>=i[t+1]&&n<=i[t+2])this[r]=n;else throw Error(Ae+r+": "+n);if(r="crypto",o&&(this[r]=Ct[r]),(n=e[r])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[r]=!0;else throw Error(Fr);else this[r]=!1;else throw Error(Ae+r+": "+n);return this}function so(e){return new this(e).cos()}function ao(e){return new this(e).cosh()}function Or(e){var t,r,n;function o(i){var s,a,c,u=this;if(!(u instanceof o))return new o(i);if(u.constructor=o,Kr(i)){u.s=i.s,L?!i.d||i.e>o.maxE?(u.e=NaN,u.d=null):i.e<o.minE?(u.e=0,u.d=[0]):(u.e=i.e,u.d=i.d.slice()):(u.e=i.e,u.d=i.d?i.d.slice():i.d);return}if(c=typeof i,c==="number"){if(i===0){u.s=1/i<0?-1:1,u.e=0,u.d=[0];return}if(i<0?(i=-i,u.s=-1):u.s=1,i===~~i&&i<1e7){for(s=0,a=i;a>=10;a/=10)s++;L?s>o.maxE?(u.e=NaN,u.d=null):s<o.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[i]):(u.e=s,u.d=[i]);return}else if(i*0!==0){i||(u.s=NaN),u.e=NaN,u.d=null;return}return Nt(u,i.toString())}else if(c!=="string")throw Error(Ae+i);return(a=i.charCodeAt(0))===45?(i=i.slice(1),u.s=-1):(a===43&&(i=i.slice(1)),u.s=1),vr.test(i)?Nt(u,i):jn(u,i)}if(o.prototype=y,o.ROUND_UP=0,o.ROUND_DOWN=1,o.ROUND_CEIL=2,o.ROUND_FLOOR=3,o.ROUND_HALF_UP=4,o.ROUND_HALF_DOWN=5,o.ROUND_HALF_EVEN=6,o.ROUND_HALF_CEIL=7,o.ROUND_HALF_FLOOR=8,o.EUCLID=9,o.config=o.set=io,o.clone=Or,o.isDecimal=Kr,o.abs=Yn,o.acos=zn,o.acosh=Zn,o.add=Xn,o.asin=Jn,o.asinh=$n,o.atan=Qn,o.atanh=eo,o.atan2=to,o.cbrt=ro,o.ceil=no,o.clamp=oo,o.cos=so,o.cosh=ao,o.div=uo,o.exp=co,o.floor=lo,o.hypot=fo,o.ln=po,o.log=mo,o.log10=yo,o.log2=go,o.max=ho,o.min=bo,o.mod=wo,o.mul=xo,o.pow=Po,o.random=To,o.round=ko,o.sign=Ao,o.sin=Io,o.sinh=So,o.sqrt=Lo,o.sub=Bo,o.sum=Ro,o.tan=Ko,o.tanh=Co,o.trunc=Vo,e===void 0&&(e={}),e&&e.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return o.config(e),o}function uo(e,t){return new this(e).div(t)}function co(e){return new this(e).exp()}function lo(e){return T(e=new this(e),e.e+1,3)}function fo(){var e,t,r=new this(0);for(L=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)r.d&&(r=r.plus(t.times(t)));else{if(t.s)return L=!0,new this(1/0);r=t}return L=!0,r.sqrt()}function Kr(e){return e instanceof Ue||e&&e.toStringTag===Nr||!1}function po(e){return new this(e).ln()}function mo(e,t){return new this(e).log(t)}function go(e){return new this(e).log(2)}function yo(e){return new this(e).log(10)}function ho(){return _r(this,arguments,"lt")}function bo(){return _r(this,arguments,"gt")}function wo(e,t){return new this(e).mod(t)}function xo(e,t){return new this(e).mul(t)}function Po(e,t){return new this(e).pow(t)}function To(e){var t,r,n,o,i=0,s=new this(1),a=[];if(e===void 0?e=this.precision:se(e,1,Ie),n=Math.ceil(e/A),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(n));i<n;)o=t[i],o>=429e7?t[i]=crypto.getRandomValues(new Uint32Array(1))[0]:a[i++]=o%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(n*=4);i<n;)o=t[i]+(t[i+1]<<8)+(t[i+2]<<16)+((t[i+3]&127)<<24),o>=214e7?crypto.randomBytes(4).copy(t,i):(a.push(o%1e7),i+=4);i=n/4}else throw Error(Fr);else for(;i<n;)a[i++]=Math.random()*1e7|0;for(n=a[--i],e%=A,n&&e&&(o=$(10,A-e),a[i]=(n/o|0)*o);a[i]===0;i--)a.pop();if(i<0)r=0,a=[0];else{for(r=-1;a[0]===0;r-=A)a.shift();for(n=1,o=a[0];o>=10;o/=10)n++;n<A&&(r-=A-n)}return s.e=r,s.d=a,s}function ko(e){return T(e=new this(e),e.e+1,this.rounding)}function Ao(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function Io(e){return new this(e).sin()}function So(e){return new this(e).sinh()}function Lo(e){return new this(e).sqrt()}function Bo(e,t){return new this(e).sub(t)}function Ro(){var e=0,t=arguments,r=new this(t[e]);for(L=!1;r.s&&++e<t.length;)r=r.plus(t[e]);return L=!0,T(r,this.precision,this.rounding)}function Ko(e){return new this(e).tan()}function Co(e){return new this(e).tanh()}function Vo(e){return T(e=new this(e),e.e+1,1)}y[Symbol.for("nodejs.util.inspect.custom")]=y.toString;y[Symbol.toStringTag]="Decimal";var Ue=y.constructor=Or(Ct);st=new Ue(st);at=new Ue(at);var Et=Ue;import{PublicKey as Mt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Fo}from"@solana/spl-token";import{PublicKey as Z,SystemProgram as No,SYSVAR_RENT_PUBKEY as vo}from"@solana/web3.js";function h({pubkey:e,isSigner:t=!1,isWritable:r=!0}){return{pubkey:e,isWritable:r,isSigner:t}}var Dt=[h({pubkey:Fo,isWritable:!1}),h({pubkey:No.programId,isWritable:!1}),h({pubkey:vo,isWritable:!1})];function Ur({publicKey:e,transformSol:t}){let r=_t(e.toString());if(r instanceof Z)return t&&r.equals(Q)?Se:r;if(t&&r.toString()===Q.toBase58())return Se;if(typeof r=="string"){if(r===Z.default.toBase58())return Z.default;try{return new Z(r)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function _t(e){try{return new Z(e)}catch{return e}}var ss=new Z("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Eo=new Z("SysvarRent111111111111111111111111111111111"),as=new Z("SysvarC1ock11111111111111111111111111111111"),us=new Z("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Do=new Z("Sysvar1nstructions1111111111111111111111111"),cs=new Z("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ls=new Z("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ds=new Z("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),fs=new Z("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),ps=new Z("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),ms=new Z("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),gs=new Z("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),ys=new Z("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),hs=new Z("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),bs=new Z("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ws=new Z("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Se=new Z("So11111111111111111111111111111111111111112"),Q=Z.default;import{PublicKey as _o}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as qr}from"@solana/spl-token";var Gr={chainId:101,address:_o.default.toBase58(),programId:qr.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ie={chainId:101,address:"So11111111111111111111111111111111111111112",programId:qr.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Wt=class{constructor({mint:t,decimals:r,symbol:n,name:o,skipMint:i=!1,isToken2022:s=!1}){if(t===Q.toBase58()||t instanceof Mt&&Q.equals(t)){this.decimals=ie.decimals,this.symbol=ie.symbol,this.name=ie.name,this.mint=new Mt(ie.address),this.isToken2022=!1;return}this.decimals=r,this.symbol=n||t.toString().substring(0,6),this.name=o||t.toString().substring(0,6),this.mint=i?Mt.default:Ur({publicKey:t}),this.isToken2022=s}equals(t){return this===t?!0:this.mint.equals(t.mint)}},Ce=Wt;Ce.WSOL=new Wt(ee(O({},ie),{mint:ie.address}));import pt from"big.js";import Oo from"bn.js";import Uo from"decimal.js-light";import Mo from"toformat";var Wo=Mo,qe=Wo;var ft=z("module/fraction"),Ot=qe(pt),Ge=qe(Uo),qo={[0]:Ge.ROUND_DOWN,[1]:Ge.ROUND_HALF_UP,[2]:Ge.ROUND_UP},Go={[0]:pt.roundDown,[1]:pt.roundHalfUp,[2]:pt.roundUp},D=class{constructor(t,r=new Oo(1)){this.numerator=C(t),this.denominator=C(r)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new D(this.denominator,this.numerator)}add(t){let r=t instanceof D?t:new D(C(t));return this.denominator.eq(r.denominator)?new D(this.numerator.add(r.numerator),this.denominator):new D(this.numerator.mul(r.denominator).add(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}sub(t){let r=t instanceof D?t:new D(C(t));return this.denominator.eq(r.denominator)?new D(this.numerator.sub(r.numerator),this.denominator):new D(this.numerator.mul(r.denominator).sub(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}mul(t){let r=t instanceof D?t:new D(C(t));return new D(this.numerator.mul(r.numerator),this.denominator.mul(r.denominator))}div(t){let r=t instanceof D?t:new D(C(t));return new D(this.numerator.mul(r.denominator),this.denominator.mul(r.numerator))}toSignificant(t,r={groupSeparator:""},n=1){Number.isInteger(t)||ft.logWithError(`${t} is not an integer.`),t<=0&&ft.logWithError(`${t} is not positive.`),Ge.set({precision:t+1,rounding:qo[n]});let o=new Ge(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return o.toFormat(o.decimalPlaces(),r)}toFixed(t,r={groupSeparator:""},n=1){return Number.isInteger(t)||ft.logWithError(`${t} is not an integer.`),t<0&&ft.logWithError(`${t} is negative.`),Ot.DP=t,Ot.RM=Go[n]||1,new Ot(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,r)}isZero(){return this.numerator.isZero()}};var Ho=z("Raydium_price"),he=class extends D{constructor(r){let{baseToken:n,quoteToken:o,numerator:i,denominator:s}=r;super(i,s);this.baseToken=n,this.quoteToken=o,this.scalar=new D(Ut(n.decimals),Ut(o.decimals))}get raw(){return new D(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new he({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(r){this.quoteToken!==r.baseToken&&Ho.logWithError("mul token not equals");let n=super.mul(r);return new he({baseToken:this.baseToken,quoteToken:r.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(r=this.quoteToken.decimals,n,o){return this.adjusted.toSignificant(r,n,o)}toFixed(r=this.quoteToken.decimals,n,o){return this.adjusted.toFixed(r,n,o)}};var qt=class{constructor({decimals:t,symbol:r="UNKNOWN",name:n="UNKNOWN"}){this.decimals=t,this.symbol=r,this.name=n}equals(t){return this===t}},mt=qt;mt.SOL=new qt(Gr);import Yo from"bn.js";var jr=new D(new Yo(100)),De=class extends D{toSignificant(t=5,r,n){return this.mul(jr).toSignificant(t,r,n)}toFixed(t=2,r,n){return this.mul(jr).toFixed(t,r,n)}};var Gt=new ae(0),ga=new ae(1),ya=new ae(2),ha=new ae(3),ba=new ae(5),jt=new ae(10),wa=new ae(100),xa=new ae(1e3),Pa=new ae(1e4),Hr=9007199254740991;function C(e){let t=z("Raydium_parseBigNumberish");if(e instanceof ae)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new ae(e);t.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&t.logWithError(`BigNumberish number underflow: ${e}`),(e>=Hr||e<=-Hr)&&t.logWithError(`BigNumberish number overflow: ${e}`),new ae(String(e))):typeof e=="bigint"?new ae(e.toString()):(t.error(`invalid BigNumberish value: ${e}`),new ae(0))}function Ut(e){return jt.pow(C(e))}var Zo=z("Raydium_amount"),zr=qe(zo);function Xo(e,t){let r="0",n="0";if(e.includes(".")){let o=e.split(".");o.length===2?([r,n]=o,n=n.padEnd(t,"0")):Zo.logWithError(`invalid number string, num: ${e}`)}else r=e;return[r,n.slice(0,t)||n]}var be=class extends D{constructor(r,n,o=!0,i){let s=new gt(0),a=jt.pow(new gt(r.decimals));if(o)s=C(n);else{let c=new gt(0),u=new gt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[d,l]=Xo(n.toString(),r.decimals);c=C(d),u=C(l)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=z(i||"TokenAmount"),this.token=r}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(r){return this.token.equals(r.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(r.raw)}lt(r){return this.token.equals(r.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(r.raw)}add(r){return this.token.equals(r.token)||this.logger.logWithError("add token not equals"),new be(this.token,this.raw.add(r.raw))}subtract(r){return this.token.equals(r.token)||this.logger.logWithError("sub token not equals"),new be(this.token,this.raw.sub(r.raw))}toSignificant(r=this.token.decimals,n,o=0){return super.toSignificant(r,n,o)}toFixed(r=this.token.decimals,n,o=0){return r>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(r,n,o)}toExact(r={groupSeparator:""}){return zr.DP=this.token.decimals,new zr(this.numerator.toString()).div(this.denominator.toString()).toFormat(r)}};function Yr(e){return typeof e=="object"&&e!==null&&![Ce,be,Jo,D,$o,he,De].some(t=>typeof t=="object"&&e instanceof t)}function we(e){return typeof e=="string"?_t(e):Array.isArray(e)?e.map(t=>we(t)):Yr(e)?Object.fromEntries(Object.entries(e).map(([t,r])=>[t,we(r)])):e}import{PublicKey as Ye,sendAndConfirmTransaction as Zt,Transaction as ze,TransactionMessage as Ze,VersionedTransaction as Xe}from"@solana/web3.js";import si from"axios";var M={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw"};import{PublicKey as Qo,ComputeBudgetProgram as Zr,Transaction as Jr,TransactionMessage as ei,Keypair as $r,VersionedTransaction as Qr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ti}from"@solana/spl-token";var Xr=z("Raydium_txUtil"),en=1644;function yt(e){let t=[],r=[];return e.microLamports&&(t.push(Zr.setComputeUnitPrice({microLamports:e.microLamports})),r.push(M.SetComputeUnitPrice)),e.units&&(t.push(Zr.setComputeUnitLimit({units:e.units})),r.push(M.SetComputeUnitLimit)),{instructions:t,instructionTypes:r}}async function _e(e){var t,r;try{return((r=await((t=e.getLatestBlockhash)==null?void 0:t.call(e)))==null?void 0:r.blockhash)||(await e.getRecentBlockhash()).blockhash}catch{return(await e.getRecentBlockhash()).blockhash}}function ri(e,t){e.length<1&&Xr.logWithError(`no instructions provided: ${e.toString()}`),t.length<1&&Xr.logWithError(`no signers provided:, ${t.toString()}`);let r=new Jr;r.recentBlockhash="11111111111111111111111111111111",r.feePayer=t[0],r.add(...e);try{return Buffer.from(r.serialize({verifySignatures:!1})).toString("base64").length<en}catch{return!1}}function Ve(e,t){let[r,n]=Qo.findProgramAddressSync(e,t);return{publicKey:r,nonce:n}}function je({instructions:e,payer:t,signers:r}){return ri(e,[t,...r])}function He({instructions:e,payer:t,lookupTableAddressAccount:r,recentBlockhash:n=$r.generate().publicKey.toString()}){let i=new ei({payerKey:t,recentBlockhash:n,instructions:e}).compileToV0Message(Object.values(r!=null?r:{}));try{return Buffer.from(new Qr(i).serialize()).toString("base64").length<en}catch{return!1}}var ni=e=>Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e.buffer,e.byteOffset,e.byteLength):Buffer.from(e);function Fe(e){let t=[];return e.forEach(r=>{r instanceof Jr&&(r.recentBlockhash||(r.recentBlockhash=ti.toBase58()),r.feePayer||(r.feePayer=$r.generate().publicKey));let n=r.serialize({requireAllSignatures:!1,verifySignatures:!1});r instanceof Qr&&(n=ni(n));let o=n.toString("base64");t.push(o)}),console.log("simulate tx string:",t),t}import{PublicKey as rn,AddressLookupTableAccount as ht}from"@solana/web3.js";import{PublicKey as oi}from"@solana/web3.js";import{getTransferFeeConfig as uu,unpackMint as cu}from"@solana/spl-token";var Ht=z("Raydium_accountInfo_util");async function tn(e,t,r){let{batchRequest:n,commitment:o="confirmed"}=O({batchRequest:!1},r),i=Yt(t,100),s=new Array(i.length).fill([]);if(n){let a=i.map(d=>{let l=e._buildArgs([d.map(f=>f.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:l}}),c=Yt(a,10);s=(await(await Promise.all(c.map(async d=>await e._rpcBatchRequest(d)))).flat()).map(d=>(d.error&&Ht.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${d.error.message}`),d.result.value.map(l=>{if(l){let{data:f,executable:p,lamports:g,owner:m,rentEpoch:x}=l;return f.length!==2&&f[1]!=="base64"&&Ht.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(f[0],"base64"),executable:p,lamports:g,owner:new oi(m),rentEpoch:x}}return null})))}else try{s=await Promise.all(i.map(a=>e.getMultipleAccountsInfo(a,o)))}catch(a){a instanceof Error&&Ht.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function zt({connection:e,address:t}){let r=await tn(e,[...new Set(t.map(o=>o.toString()))].map(o=>new rn(o))),n={};for(let o=0;o<t.length;o++){let i=r[o],s=t[o];if(!i)continue;let a=new ht({key:s,state:ht.deserialize(i.data)});n[s.toString()]=a,bt[s.toString()]=a}return n}var bt={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new ht({key:new rn("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:ht.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var wt=class{constructor(t){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let t=(await si.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:r}=(n=t==null?void 0:t[15])!=null?n:{};if(!!r)return{units:6e5,microLamports:Math.min(Math.ceil(r*1e6/6e5),25e3)}}addCustomComputeBudget(t){if(t){let{instructions:r,instructionTypes:n}=yt(t);return this.instructions.unshift(...r),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:t,defaultIns:r}){try{let n=t||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;r&&this.instructions.unshift(...r)}catch{r&&this.instructions.unshift(...r)}}addInstruction({instructions:t=[],endInstructions:r=[],signers:n=[],instructionTypes:o=[],endInstructionTypes:i=[],lookupTableAddress:s=[]}){return this.instructions.push(...t),this.endInstructions.push(...r),this.signers.push(...n),this.instructionTypes.push(...o),this.endInstructionTypes.push(...i),this.lookupTableAddress.push(...s.filter(a=>a!==Ye.default.toString())),this}async versionBuild({txVersion:t,extInfo:r}){return t===0?await this.buildV0(O({},r||{})):this.build(r)}build(t){let r=new ze;return this.allInstructions.length&&r.add(...this.allInstructions),r.feePayer=this.feePayer,{builder:this,transaction:r,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async()=>{var o;let n=await _e(this.connection);if(r.recentBlockhash=n,this.signers.length&&r.sign(...this.signers),Fe([r]),(o=this.owner)!=null&&o.isKeyPair)return{txId:await Zt(this.connection,r,this.signers),signedTx:r};if(this.signAllTransactions){let i=await this.signAllTransactions([r]);return{txId:await this.connection.sendRawTransaction(i[0].serialize(),{skipPreflight:!0}),signedTx:i[0]}}throw new Error("please connect wallet first")},extInfo:t||{}}}buildMultiTx(t){let{extraPreBuildData:r=[],extInfo:n}=t,{transaction:o}=this.build(n),i=r.filter(u=>u.transaction.instructions.length>0),s=[o,...i.map(u=>u.transaction)],a=[this.signers,...i.map(u=>u.signers)],c=[...this.instructionTypes,...i.map(u=>u.instructionTypes).flat()];return{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async u=>{var p;let{sequentially:d,onTxUpdate:l}=u||{},f=await _e(this.connection);if((p=this.owner)!=null&&p.isKeyPair)return{txIds:await await Promise.all(s.map(async(g,m)=>(g.recentBlockhash=f,await Zt(this.connection,g,a[m])))),signedTxs:s};if(this.signAllTransactions){let g=s.map((x,b)=>(x.recentBlockhash=f,a[b].length&&x.sign(...a[b]),x));Fe(g);let m=await this.signAllTransactions(g);if(d){let x=0,b=[],I=async()=>{if(!m[x])return;let w=await this.connection.sendRawTransaction(m[x].serialize(),{skipPreflight:!0});b.push({txId:w,status:"sent",signedTx:m[x]}),l==null||l([...b]),x++,this.connection.onSignature(w,k=>{let S=b.findIndex(B=>B.txId===w);S>-1&&(b[S].status=k.err?"error":"success"),l==null||l([...b]),I()},"processed"),this.connection.getSignatureStatus(w)};return await I(),{txIds:b.map(w=>w.txId),signedTxs:m}}else{let x=[];for(let b=0;b<m.length;b+=1){let I=await this.connection.sendRawTransaction(m[b].serialize(),{skipPreflight:!0});x.push(I)}return{txIds:x,signedTxs:m}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:t,txVersion:r,extInfo:n}){return r===0?await this.buildV0MultiTx({extraPreBuildData:t,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:t,extInfo:n})}async buildV0(t){let f=t||{},{lookupTableCache:r={},lookupTableAddress:n=[],forerunCreate:o}=f,i=ot(f,["lookupTableCache","lookupTableAddress","forerunCreate"]),s=O(O({},bt),r),a=Array.from(new Set([...n,...this.lookupTableAddress])),c=[];for(let p of a)s[p]===void 0&&c.push(new Ye(p));let u=await zt({connection:this.connection,address:c});for(let[p,g]of Object.entries(u))s[p]=g;let d=new Ze({payerKey:this.feePayer,recentBlockhash:o?Ye.default.toBase58():await _e(this.connection),instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s)),l=new Xe(d);return l.sign(this.signers),{builder:this,transaction:l,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async()=>{var p;if(Fe([l]),(p=this.owner)!=null&&p.isKeyPair)return l.sign([this.owner.signer]),{txId:await this.connection.sendTransaction(l,{skipPreflight:!0}),signedTx:l};if(this.signAllTransactions){let g=await this.signAllTransactions([l]);return{txId:await this.connection.sendTransaction(g[0],{skipPreflight:!0}),signedTx:g[0]}}throw new Error("please connect wallet first")},extInfo:i||{}}}async buildV0MultiTx(t){let{extraPreBuildData:r=[],buildProps:n}=t,{transaction:o}=await this.buildV0(n),i=r.filter(u=>u.builder.instructions.length>0),s=[o,...i.map(u=>u.transaction)],a=[this.signers,...i.map(u=>u.signers)],c=[...this.instructionTypes,...i.map(u=>u.instructionTypes).flat()];return s.forEach(async(u,d)=>{u.sign(a[d])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async u=>{var f;Fe(s);let{sequentially:d,onTxUpdate:l}=u||{};if((f=this.owner)!=null&&f.isKeyPair)return s.forEach(p=>p.sign([this.owner.signer])),{txIds:await Promise.all(s.map(async p=>await this.connection.sendTransaction(p))),signedTxs:s};if(this.signAllTransactions){let p=await this.signAllTransactions(s);if(d){let g=0,m=[],x=async()=>{if(!p[g])return;let b=await this.connection.sendTransaction(p[g],{skipPreflight:!0});m.push({txId:b,status:"sent",signedTx:p[g]}),l==null||l([...m]),g++,this.connection.onSignature(b,I=>{let w=m.findIndex(k=>k.txId===b);w>-1&&(m[w].status=I.err?"error":"success"),l==null||l([...m]),x()},"processed"),this.connection.getSignatureStatus(b)};return x(),{txIds:[],signedTxs:p}}else{let g=[];for(let m=0;m<p.length;m+=1){let x=await this.connection.sendTransaction(p[m],{skipPreflight:!0});g.push(x)}return{txIds:g,signedTxs:p}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async sizeCheckBuild(t){let u=t||{},{autoComputeBudget:r=!1}=u,n=ot(u,["autoComputeBudget"]),o={instructions:[],instructionTypes:[]};if(r){let d=r?await this.getComputeBudgetConfig():void 0;o=r&&d?yt(d):{instructions:[],instructionTypes:[]}}let i=this.signers.reduce((d,l)=>ee(O({},d),{[l.publicKey.toBase58()]:l}),{}),s=[],a=[],c=[];if(this.allInstructions.forEach(d=>{let l=[...c,d],f=r?[...o.instructions,...l]:l,g=[...new Set(l.map(m=>m.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat()).values()].map(m=>new Ye(m));if(c.length<12&&je({instructions:f,payer:this.feePayer,signers:g})||je({instructions:l,payer:this.feePayer,signers:g}))c.push(d);else{if(c.length===0)throw Error("item ins too big");je({instructions:r?[...o.instructions,...c]:[...c],payer:this.feePayer,signers:g})?s.push(new ze().add(...o.instructions,...c)):s.push(new ze().add(...c)),a.push(Array.from(new Set(c.map(m=>m.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat())).map(m=>i[m]).filter(m=>m!==void 0)),c=[d]}}),c.length>0){let l=[...new Set(c.map(f=>f.keys.filter(p=>p.isSigner).map(p=>p.pubkey.toString())).flat()).values()].map(f=>i[f]).filter(f=>f!==void 0);je({instructions:r?[...o.instructions,...c]:[...c],payer:this.feePayer,signers:l.map(f=>f.publicKey)})?s.push(new ze().add(...o.instructions,...c)):s.push(new ze().add(...c)),a.push(l)}return s.forEach(d=>d.feePayer=this.feePayer),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async d=>{var g;let{sequentially:l,onTxUpdate:f}=d||{},p=await _e(this.connection);if(s.forEach(async(m,x)=>{m.recentBlockhash=p,a[x].length&&m.sign(...a[x])}),Fe(s),(g=this.owner)!=null&&g.isKeyPair)return{txIds:await Promise.all(s.map(async(m,x)=>await Zt(this.connection,m,a[x]))),signedTxs:s};if(this.signAllTransactions){let m=await this.signAllTransactions(s);if(l){let x=0,b=[],I=async()=>{if(!m[x])return;let w=await this.connection.sendRawTransaction(m[x].serialize(),{skipPreflight:!0});b.push({txId:w,status:"sent",signedTx:m[x]}),f==null||f([...b]),x++,this.connection.onSignature(w,k=>{let S=b.findIndex(B=>B.txId===w);S>-1&&(b[S].status=k.err?"error":"success"),f==null||f([...b]),I()},"processed"),this.connection.getSignatureStatus(w)};return await I(),{txIds:b.map(w=>w.txId),signedTxs:m}}else{let x=[];for(let b=0;b<m.length;b+=1){let I=await this.connection.sendRawTransaction(m[b].serialize(),{skipPreflight:!0});x.push(I)}return{txIds:x,signedTxs:m}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async sizeCheckBuildV0(t){let x=t||{},{autoComputeBudget:r=!1,lookupTableCache:n={},lookupTableAddress:o=[]}=x,i=ot(x,["autoComputeBudget","lookupTableCache","lookupTableAddress"]),s=O(O({},bt),n),a=Array.from(new Set([...this.lookupTableAddress,...o])),c=[];for(let b of a)s[b]===void 0&&c.push(new Ye(b));let u=await zt({connection:this.connection,address:c});for(let[b,I]of Object.entries(u))s[b]=I;let d={instructions:[],instructionTypes:[]};if(r){let b=r?await this.getComputeBudgetConfig():void 0;d=r&&b?yt(b):{instructions:[],instructionTypes:[]}}let l=await _e(this.connection),f=this.signers.reduce((b,I)=>ee(O({},b),{[I.publicKey.toBase58()]:I}),{}),p=[],g=[],m=[];if(this.allInstructions.forEach(b=>{let I=[...m,b],w=r?[...d.instructions,...I]:I;if(m.length<12&&He({instructions:w,payer:this.feePayer,lookupTableAddressAccount:s})||He({instructions:I,payer:this.feePayer,lookupTableAddressAccount:s}))m.push(b);else{if(m.length===0)throw Error("item ins too big");let k={};for(let S of[...new Set(a)])s[S]!==void 0&&(k[S]=s[S]);if(r&&He({instructions:[...d.instructions,...m],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:l})){let S=new Ze({payerKey:this.feePayer,recentBlockhash:l,instructions:[...d.instructions,...m]}).compileToV0Message(Object.values(s));p.push(new Xe(S))}else{let S=new Ze({payerKey:this.feePayer,recentBlockhash:l,instructions:[...m]}).compileToV0Message(Object.values(s));p.push(new Xe(S))}g.push(Array.from(new Set(m.map(S=>S.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat())).map(S=>f[S]).filter(S=>S!==void 0)),m=[b]}}),m.length>0){let I=[...new Set(m.map(w=>w.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat()).values()].map(w=>f[w]).filter(w=>w!==void 0);if(r&&He({instructions:[...d.instructions,...m],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:l})){let w=new Ze({payerKey:this.feePayer,recentBlockhash:l,instructions:[...d.instructions,...m]}).compileToV0Message(Object.values(s));p.push(new Xe(w))}else{let w=new Ze({payerKey:this.feePayer,recentBlockhash:l,instructions:[...m]}).compileToV0Message(Object.values(s));p.push(new Xe(w))}g.push(I)}return{builder:this,transactions:p,buildProps:t,signers:g,instructionTypes:this.instructionTypes,execute:async b=>{var k;let{sequentially:I,onTxUpdate:w}=b||{};if(p.map(async(S,B)=>{g[B].length&&S.sign(g[B])}),Fe(p),(k=this.owner)!=null&&k.isKeyPair)return{txIds:await Promise.all(p.map(async S=>await this.connection.sendTransaction(S,{skipPreflight:!0}))),signedTxs:p};if(this.signAllTransactions){let S=await this.signAllTransactions(p);if(I){let B=0,q=[],re=async()=>{if(!S[B])return;let F=await this.connection.sendTransaction(S[B],{skipPreflight:!0});q.push({txId:F,status:"sent",signedTx:S[B]}),w==null||w([...q]),B++,this.connection.onSignature(F,G=>{let j=q.findIndex(J=>J.txId===F);j>-1&&(q[j].status=G.err?"error":"success"),w==null||w([...q]),re()},"processed"),this.connection.getSignatureStatus(F)};return re(),{txIds:[],signedTxs:S}}else{let B=[];for(let q=0;q<S.length;q+=1){let re=await this.connection.sendTransaction(S[q],{skipPreflight:!0});B.push(re)}return{txIds:B,signedTxs:S}}}throw new Error("please connect wallet first")},extInfo:i||{}}}};function Yt(e,t=1,r=[]){let n=[...e];if(t<=0)return r;for(;n.length;)r.push(n.splice(0,t));return r}import{PublicKey as ue}from"@solana/web3.js";var nn=new ue("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),on=new ue("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Je=new ue("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Cu=new ue("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Vu=new ue("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Fu=new ue("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Nu=new ue("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),vu=new ue("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Eu=new ue("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Du=new ue("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),_u=new ue("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Mu=new ue("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Wu=new ue("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Ou=new ue("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi");import{PublicKey as ai}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ui}from"@solana/spl-token";function Me(e,t,r){return Ve([e.toBuffer(),(r!=null?r:ui).toBuffer(),t.toBuffer()],new ai("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import zu from"bn.js";import{PublicKey as Ti,Keypair as ki}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ai}from"@solana/spl-token";import Cl from"bn.js";import{PublicKey as gi}from"@solana/web3.js";import cn,{isBN as ln}from"bn.js";import{bits as mc,BitStructure as gc,blob as ci,Blob as yc,cstr as hc,f32 as bc,f32be as wc,f64 as xc,f64be as Pc,greedy as Tc,Layout as li,ns64 as kc,ns64be as Ac,nu64 as Ic,nu64be as Sc,offset as Lc,s16 as Bc,s16be as Rc,s24 as Kc,s24be as Cc,s32 as Vc,s32be as Fc,s40 as Nc,s40be as vc,s48 as Ec,s48be as Dc,s8 as _c,seq as di,struct as Mc,Structure as fi,u16 as Wc,u16be as Oc,u24 as Uc,u24be as qc,u32 as Gc,u32be as jc,u40 as Hc,u40be as Yc,u48 as zc,u48be as Zc,u8 as pi,UInt as mi,union as Xc,Union as Jc,unionLayoutDiscriminator as $c,utf8 as Qc}from"@solana/buffer-layout";var Xt=li,sn=fi;var Jt=mi;var an=pi;var un=di;var Ne=ci;var We=class extends Xt{constructor(r,n,o){super(r,o);this.blob=Ne(r),this.signed=n}decode(r,n=0){let o=new cn(this.blob.decode(r,n),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(r,n,o=0){return typeof r=="number"&&(r=new cn(r)),this.signed&&(r=r.toTwos(this.span*8)),this.blob.encode(r.toArrayLike(Buffer,"le",this.span),n,o)}};function X(e){return new Jt(1,e)}function $e(e){return new Jt(4,e)}function P(e){return new We(8,!1,e)}function xe(e){return new We(16,!1,e)}function dn(e){return new We(1,!0,e)}function Pt(e){return new We(8,!0,e)}var xt=class extends Xt{constructor(r,n,o,i){super(r.span,i);this.layout=r,this.decoder=n,this.encoder=o}decode(r,n){return this.decoder(this.layout.decode(r,n))}encode(r,n,o){return this.layout.encode(this.encoder(r),n,o)}getSpan(r,n){return this.layout.getSpan(r,n)}};function V(e){return new xt(Ne(32),t=>new gi(t),t=>t.toBuffer(),e)}function Tt(e){return new xt(an(),yi,hi,e)}function yi(e){if(e===0)return!1;if(e===1)return!0;throw new Error("Invalid bool: "+e)}function hi(e){return e?1:0}var $t=class extends sn{decode(t,r){return super.decode(t,r)}};function U(e,t,r){return new $t(e,t,r)}function H(e,t,r){let n,o=typeof t=="number"?t:ln(t)?t.toNumber():new Proxy(t,{get(i,s){if(!n){let a=Reflect.get(i,"count");n=ln(a)?a.toNumber():a,Reflect.set(i,"count",n)}return Reflect.get(i,s)},set(i,s,a){return s==="count"&&(n=a),Reflect.set(i,s,a)}});return un(e,o,r)}var Qe=U([V("mint"),V("owner"),P("amount"),$e("delegateOption"),V("delegate"),X("state"),$e("isNativeOption"),P("isNative"),P("delegatedAmount"),$e("closeAuthorityOption"),V("closeAuthority")]);function bi(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function Qt(e,...t){if(!bi(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function er(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function fn(e,t){Qt(e);let r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}var At=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),fe=(e,t)=>e<<32-t|e>>>t;var yl=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function wi(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function tr(e){return typeof e=="string"&&(e=wi(e)),Qt(e),e}var kt=class{clone(){return this._cloneInto()}},hl={}.toString;function pn(e){let t=n=>e().update(tr(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function xi(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);let o=BigInt(32),i=BigInt(4294967295),s=Number(r>>o&i),a=Number(r&i),c=n?4:0,u=n?0:4;e.setUint32(t+c,s,n),e.setUint32(t+u,a,n)}var mn=(e,t,r)=>e&t^~e&r,gn=(e,t,r)=>e&t^e&r^t&r,It=class extends kt{constructor(t,r,n,o){super(),this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=At(this.buffer)}update(t){er(this);let{view:r,buffer:n,blockLen:o}=this;t=tr(t);let i=t.length;for(let s=0;s<i;){let a=Math.min(o-this.pos,i-s);if(a===o){let c=At(t);for(;o<=i-s;s+=o)this.process(c,s);continue}n.set(t.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){er(this),fn(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:i}=this,{pos:s}=this;r[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(n,0),s=0);for(let l=s;l<o;l++)r[l]=0;xi(n,o-8,BigInt(this.length*8),i),this.process(n,0);let a=At(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,d=this.get();if(u>d.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,d[l],i)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:i,destroyed:s,pos:a}=this;return t.length=o,t.pos=a,t.finished=i,t.destroyed=s,o%r&&t.buffer.set(n),t}};var Pi=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Le=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Be=new Uint32Array(64),rr=class extends It{constructor(){super(64,32,8,!1),this.A=Le[0]|0,this.B=Le[1]|0,this.C=Le[2]|0,this.D=Le[3]|0,this.E=Le[4]|0,this.F=Le[5]|0,this.G=Le[6]|0,this.H=Le[7]|0}get(){let{A:t,B:r,C:n,D:o,E:i,F:s,G:a,H:c}=this;return[t,r,n,o,i,s,a,c]}set(t,r,n,o,i,s,a,c){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=a|0,this.H=c|0}process(t,r){for(let l=0;l<16;l++,r+=4)Be[l]=t.getUint32(r,!1);for(let l=16;l<64;l++){let f=Be[l-15],p=Be[l-2],g=fe(f,7)^fe(f,18)^f>>>3,m=fe(p,17)^fe(p,19)^p>>>10;Be[l]=m+Be[l-7]+g+Be[l-16]|0}let{A:n,B:o,C:i,D:s,E:a,F:c,G:u,H:d}=this;for(let l=0;l<64;l++){let f=fe(a,6)^fe(a,11)^fe(a,25),p=d+f+mn(a,c,u)+Pi[l]+Be[l]|0,m=(fe(n,2)^fe(n,13)^fe(n,22))+gn(n,o,i)|0;d=u,u=c,c=a,a=s+p|0,s=i,i=o,o=n,n=p+m|0}n=n+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,d=d+this.H|0,this.set(n,o,i,s,a,c,u,d)}roundClean(){Be.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var yn=pn(()=>new rr);var vl=z("Raydium_Util");function St({fromPublicKey:e,programId:t=Ai}){let r=ki.generate().publicKey.toBase58().slice(0,32);return{publicKey:Ii(e,r,t),seed:r}}function Ii(e,t,r){let n=Buffer.concat([e.toBuffer(),Buffer.from(t),r.toBuffer()]),o=yn(n);return new Ti(o)}import{createInitializeAccountInstruction as Si,createCloseAccountInstruction as Li,createTransferInstruction as _l,TOKEN_PROGRAM_ID as et}from"@solana/spl-token";import{PublicKey as Bi,SystemProgram as Ri}from"@solana/web3.js";import Ki from"bn.js";function Ci(e){let{mint:t,tokenAccount:r,owner:n,programId:o=et}=e;return Si(r,t,n,o)}function Vi(e){let{tokenAccount:t,payer:r,multiSigners:n=[],owner:o,programId:i=et}=e;return Li(t,r,o,n,i)}async function nr(e){let{connection:t,amount:r,commitment:n,payer:o,owner:i,skipCloseAccount:s}=e,a=await t.getMinimumBalanceForRentExemption(Qe.span,n),c=C(r).add(new Ki(a)),u=St({fromPublicKey:o,programId:et});return{addresses:{newAccount:u.publicKey},signers:[],instructions:[Ri.createAccountWithSeed({fromPubkey:o,basePubkey:o,seed:u.seed,newAccountPubkey:u.publicKey,lamports:c.toNumber(),space:Qe.span,programId:et}),Ci({mint:new Bi(ie.address),tokenAccount:u.publicKey,owner:i,programId:et})],instructionTypes:[M.CreateAccount,M.InitAccount],endInstructionTypes:s?[]:[M.CloseAccount],endInstructions:s?[]:[Vi({tokenAccount:u.publicKey,payer:o,owner:i})]}}var or=(...e)=>e.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),tt=class{constructor({scope:t,moduleName:r}){this.disabled=!1;this.scope=t,this.logger=z(r)}createTxBuilder(t){return this.scope.checkOwner(),new wt({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(or(t))}logInfo(...t){this.logger.info(or(t))}logAndCreateError(...t){let r=or(t);throw new Error(r)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as wn}from"@solana/web3.js";var ir=U([X("instruction")]),sr=U([X("instruction")]),Fi=U([P("rewardState"),P("rewardOpenTime"),P("rewardEndTime"),P("rewardLastUpdateTime"),P("totalReward"),P("totalRewardEmissioned"),P("rewardClaimed"),P("rewardPerSecond"),xe("accRewardPerShare"),V("rewardVault"),V("rewardMint"),V("rewardSender"),P("rewardType"),H(P(),15,"padding")]),Ni=U([P("state"),P("nonce"),V("lpVault"),V("rewardVault"),V(),V(),P(),P(),P("totalReward"),xe("perShareReward"),P("lastSlot"),P("perSlotReward")]),vi=U([P("state"),P("nonce"),V("lpVault"),V("rewardVaultA"),P("totalRewardA"),xe("perShareRewardA"),P("perSlotRewardA"),X("option"),V("rewardVaultB"),Ne(7),P("totalRewardB"),xe("perShareRewardB"),P("perSlotRewardB"),P("lastSlot"),V()]),Ei=U([P(),P("state"),P("nonce"),P("validRewardTokenNum"),xe("rewardMultiplier"),P("rewardPeriodMax"),P("rewardPeriodMin"),P("rewardPeriodExtend"),V("lpMint"),V("lpVault"),H(Fi,5,"rewardInfos"),V("creator"),V(),H(P(),32,"padding")]),Di=new Proxy(Ni,{get(e,t,r){return t==="decode"?(...n)=>{let o=e.decode(...n);return ee(O({},o),{version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]})}:Reflect.get(e,t,r)}}),_i=new Proxy(vi,{get(e,t,r){return t==="decode"?(...n)=>{let o=e.decode(...n);return ee(O({},o),{version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]})}:Reflect.get(e,t,r)}}),Lt=new Proxy(Ei,{get(e,t,r){return t==="decode"?(...n)=>{let o=e.decode(...n);return ee(O({},o),{version:6,rewardInfos:o.rewardInfos.map(i=>{var s;return ee(O({},i),{rewardType:((s=Object.entries(Re).find(a=>String(a[1])===i.rewardType.toString()))!=null?s:["Standard SPL"])[0]})})})}:Reflect.get(e,t,r)}}),Mi=U([P("isSet"),P("rewardPerSecond"),P("rewardOpenTime"),P("rewardEndTime"),P("rewardType")]),ar=U([X("instruction"),P("nonce"),H(Mi,5,"rewardTimeInfo")]),ur=U([X("instruction"),P("rewardReopenTime"),P("rewardEndTime"),P("rewardPerSecond")]),cr=U([X("instruction"),P("isSet"),P("rewardPerSecond"),P("rewardOpenTime"),P("rewardEndTime"),P("rewardType")]),ad=U([P("state"),V("id"),V("owner"),P("deposited"),H(P(),1,"rewardDebts")]),lr=U([P("state"),V("id"),V("owner"),P("deposited"),H(xe(),1,"rewardDebts"),P(""),P("voteLockedBalance"),H(P(),15)]),ud=U([P("state"),V("id"),V("owner"),P("deposited"),H(P(),2,"rewardDebts")]),hn=U([P("state"),V("id"),V("owner"),P("deposited"),H(xe(),2,"rewardDebts"),H(P(),17)]),bn=U([P(),P("state"),V("id"),V("owner"),P("deposited"),H(xe(),5,"rewardDebts"),H(P(),16)]),ce=U([X("instruction"),P("amount")]),Wi=U([V("mint"),V("grantAuthority"),P("baselineVoteWeightScaledFactor"),P("maxExtraLockupVoteWeightScaledFactor"),P("lockupSaturationSecs"),dn("digitShift"),H(X(),7,"reserved1"),H(P(),7,"reserved2")]),Oi=U([Ne(8),V("governanceProgramId"),V("realm"),V("realmGoverningTokenMint"),V("realmAuthority"),H(X(),32,"reserved1"),H(Wi,4,"votingMints"),Pt("timeOffset"),X("bump"),H(X(),7,"reserved2"),H(P(),11,"reserved3")]),Ui=U([Pt("startTime"),Pt("endTime"),X("kind"),H(X(),15,"reserved")]),qi=U([H(Ui,1,"lockup"),P("amountDeposited_native"),P("amountInitiallyLockedNative"),Tt("isUsed"),Tt("allowClawback"),X("votingMintConfigIdx"),H(X(),29,"reserved")]),Gi=U([Ne(8),V("voterAuthority"),V("registrar"),H(qi,32,"deposits"),X("voterBump"),X("voterWweightRecordBump"),H(X(),94,"reserved")]);var yd=z("Raydium_farm_config"),xn=new wn("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Pn=new wn("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var Tn={3:lr,5:hn,6:bn},dr=e=>[3,5,6].indexOf(e)!==-1,fr=e=>{var s;let{version:t,rewardInfos:r,rewardTokenAccountsPublicKeys:n}=e,o=`rewardInfo:${JSON.stringify(r)}, rewardAccount:${JSON.stringify(n)}`,i={3:()=>{if(r.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${o}`},5:()=>{if(r.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${o}`},6:()=>{if(!n.length||r.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${o}`}};return(s=i[t])==null?void 0:s.call(i)},Re={"Standard SPL":0,"Option tokens":1},Pe={[nn.toString()]:3,[on.toString()]:5,[Je.toString()]:6};import{PublicKey as v,SystemProgram as In,SYSVAR_RENT_PUBKEY as Yi,SYSVAR_CLOCK_PUBKEY as Bt,TransactionInstruction as pe}from"@solana/web3.js";import{createAssociatedTokenAccountInstruction as zd,TOKEN_PROGRAM_ID as Ke,ASSOCIATED_TOKEN_PROGRAM_ID as Zd}from"@solana/spl-token";import Sn from"bn.js";import ji from"bn.js";var Hi=z("Raydium.farm.util");function rt({programId:e,poolId:t,mint:r,type:n}){let{publicKey:o}=Ve([t.toBuffer(),r.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],e);return o}function ge({programId:e,poolId:t,owner:r,version:n}){let{publicKey:o}=Ve([t.toBuffer(),r.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],e);return o}var kn=({programId:e,poolId:t})=>Ve([t.toBuffer()],e);function An(e){return{isSet:new ji(1),rewardPerSecond:C(e.perSecond),rewardOpenTime:C(e.openTime),rewardEndTime:C(e.endTime),rewardType:C(Re[e.rewardType])}}function pr(e){return C(e.endTime).sub(C(e.openTime)).mul(C(e.perSecond))}function mr(e){let t=Tn[e];return t||Hi.logWithError("invalid version",e),t}var zi=z("Raydium_farm_instruction"),cf={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function Ln(e){let{version:t,id:r,ledger:n,programId:o,owner:i}=e,s={3:9,5:10}[t];s||zi.logWithError(`invalid farm pool version: ${t}`);let a=Buffer.alloc(ir.span);ir.encode({instruction:s},a);let c=[h({pubkey:r}),h({pubkey:n}),h({pubkey:i,isWritable:!1}),h({pubkey:In.programId,isWritable:!1}),h({pubkey:Yi,isWritable:!1})];return{instruction:new pe({programId:o,keys:c,data:a}),instructionType:M.FarmV3CreateLedger}}function Bn(e){var n;let t=Buffer.alloc(ar.span);ar.encode({instruction:0,nonce:new Sn(e.nonce),rewardTimeInfo:e.rewardInfoConfig},t);let r=[...Dt,h({pubkey:e.farmId}),h({pubkey:e.farmAuthority,isWritable:!1}),h({pubkey:e.lpVault}),h({pubkey:e.lpMint,isWritable:!1}),h({pubkey:e.lockVault}),h({pubkey:e.lockMint,isWritable:!1}),h({pubkey:(n=e.lockUserAccount)!=null?n:Q}),h({pubkey:e.owner,isWritable:!1,isSigner:!0})];for(let o of e.rewardInfo)r.push(h({pubkey:o.rewardMint,isWritable:!1}),h({pubkey:o.rewardVault}),h({pubkey:o.userRewardToken}));return{instruction:new pe({programId:e.programId,keys:r,data:t}),instructionType:M.FarmV6Create}}function Rn(e){let t=Buffer.alloc(sr.span);sr.encode({instruction:5},t);let r=[h({pubkey:Ke,isWritable:!1}),h({pubkey:e.id}),h({pubkey:e.authority,isWritable:!1}),h({pubkey:e.lpVault,isWritable:!1}),h({pubkey:e.rewardVault}),h({pubkey:e.userRewardToken}),h({pubkey:e.owner,isWritable:!1,isSigner:!0})];return{instruction:new pe({programId:e.programId,keys:r,data:t}),instructionType:M.FarmV6CreatorWithdraw}}function gr({payer:e,rewardVault:t,userRewardTokenPub:r,farmKeys:n,rewardInfo:o}){let i=Buffer.alloc(ur.span);ur.encode({instruction:3,rewardReopenTime:C(o.openTime),rewardEndTime:C(o.endTime),rewardPerSecond:C(o.perSecond)},i);let s=[h({pubkey:Ke,isWritable:!1}),h({pubkey:n.id}),h({pubkey:n.lpVault,isWritable:!1}),h({pubkey:t}),h({pubkey:r}),h({pubkey:e,isWritable:!1,isSigner:!0})];return new pe({programId:n.programId,keys:s,data:i})}function yr({payer:e,userRewardTokenPub:t,farmKeys:r,rewardVault:n,rewardInfo:o}){let i=Buffer.alloc(cr.span);cr.encode({instruction:4,isSet:new Sn(1),rewardPerSecond:C(o.perSecond),rewardOpenTime:C(o.openTime),rewardEndTime:C(o.endTime),rewardType:C(Re[o.rewardType])},i);let s=[...Dt,h({pubkey:r.id}),h({pubkey:r.authority,isWritable:!1}),h({pubkey:o.mint,isWritable:!1}),h({pubkey:n}),h({pubkey:t}),h({pubkey:e,isWritable:!1,isSigner:!0})];return new pe({programId:r.programId,keys:s,data:i})}function hr(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s}=e,[a,c]=[new v(t.programId),new v(t.id)],u=ge({programId:a,poolId:c,owner:i,version:6}),d=Buffer.alloc(ce.span);ce.encode({instruction:2,amount:C(s)},d);let l=[h({pubkey:Ke,isWritable:!1}),h({pubkey:c}),h({pubkey:new v(r.authority),isWritable:!1}),h({pubkey:new v(r.lpVault)}),h({pubkey:u}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n})];for(let f=0;f<r.rewardInfos.length;f++)l.push(h({pubkey:new v(r.rewardInfos[f].vault)})),l.push(h({pubkey:o[f]}));return new pe({programId:a,keys:l,data:d})}function br(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=e,[c,u]=[new v(t.programId),new v(t.id)],d=ge({programId:c,poolId:u,owner:i,version:5}),l=Buffer.alloc(ce.span);ce.encode({instruction:12,amount:C(s)},l);let f=[h({pubkey:u}),h({pubkey:new v(r.authority),isWritable:!1}),h({pubkey:d}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n}),h({pubkey:new v(r.lpVault)}),h({pubkey:o[0]}),h({pubkey:new v(r.rewardInfos[0].vault)}),h({pubkey:Bt,isWritable:!1}),h({pubkey:Ke,isWritable:!1})];for(let p=1;p<r.rewardInfos.length;p++)f.push(h({pubkey:o[p]})),f.push(h({pubkey:new v(r.rewardInfos[p].vault)}));if(a)for(let p of a)f.push(h({pubkey:p}));return new pe({programId:c,keys:f,data:l})}function wr(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=e,[c,u]=[new v(t.programId),new v(t.id)],d=ge({programId:c,poolId:u,owner:i,version:3}),l=Buffer.alloc(ce.span);ce.encode({instruction:11,amount:C(s)},l);let f=[h({pubkey:u}),h({pubkey:new v(r.authority),isWritable:!1}),h({pubkey:d}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n}),h({pubkey:new v(r.lpVault)}),h({pubkey:o[0]}),h({pubkey:new v(r.rewardInfos[0].vault)}),h({pubkey:Bt,isWritable:!1}),h({pubkey:Ke,isWritable:!1})];if(a)for(let p of a)f.push(h({pubkey:p}));return new pe({programId:c,keys:f,data:l})}function Kn(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=e,[c,u]=[new v(t.programId),new v(t.id)],d=ge({programId:c,poolId:u,owner:i,version:3}),l=Buffer.alloc(ce.span);ce.encode({instruction:10,amount:C(s)},l);let f=[h({pubkey:u}),h({pubkey:new v(r.authority),isWritable:!1}),h({pubkey:d}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n}),h({pubkey:new v(r.lpVault)}),h({pubkey:o[0]}),h({pubkey:new v(r.rewardInfos[0].vault)}),h({pubkey:Bt,isWritable:!1}),h({pubkey:Ke,isWritable:!1})];if(a)for(let p of a)f.push(h({pubkey:p}));return new pe({programId:c,keys:f,data:l})}function Cn(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=e,[c,u]=[new v(t.programId),new v(t.id)],d=ge({programId:c,poolId:u,owner:i,version:5}),l=Buffer.alloc(ce.span);ce.encode({instruction:11,amount:C(s)},l);let f=[h({pubkey:u}),h({pubkey:new v(r.authority),isWritable:!1}),h({pubkey:d}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n}),h({pubkey:new v(r.lpVault)}),h({pubkey:o[0]}),h({pubkey:new v(r.rewardInfos[0].vault)}),h({pubkey:Bt,isWritable:!1}),h({pubkey:Ke,isWritable:!1})];for(let p=1;p<r.rewardInfos.length;p++)f.push(h({pubkey:o[p]})),f.push(h({pubkey:new v(r.rewardInfos[p].vault)}));if(a)for(let p of a)f.push(h({pubkey:p}));return new pe({programId:c,keys:f,data:l})}function Vn(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s}=e,[a,c]=[new v(t.programId),new v(t.id)],u=ge({programId:a,poolId:c,owner:i,version:6}),d=Buffer.alloc(ce.span);ce.encode({instruction:1,amount:C(s)},d);let l=[h({pubkey:Ke,isWritable:!1}),h({pubkey:In.programId,isWritable:!1}),h({pubkey:c}),h({pubkey:new v(r.authority),isWritable:!1}),h({pubkey:new v(r.lpVault)}),h({pubkey:u}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n})];for(let f=0;f<r.rewardInfos.length;f++)l.push(h({pubkey:new v(r.rewardInfos[f].vault)})),l.push(h({pubkey:o[f]}));return new pe({programId:a,keys:l,data:d})}var xr=class extends tt{async _getUserRewardInfo({payer:t,rewardInfo:r}){if(r.mint.equals(Q)){let n=await nr({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:t,amount:pr(r)});return{rewardPubKey:n.addresses.newAccount,newInstruction:n}}return{rewardPubKey:await this.scope.account.getCreatedTokenAccount({mint:r.mint,associatedOnly:!1})}}async create({poolInfo:t,rewardInfos:r,payer:n,programId:o=Je,txVersion:i}){this.checkDisabled(),this.scope.checkOwner();let a={lpMint:new W(t.lpMint.address),lockInfo:{lockMint:xn,lockVault:Pn},version:6,rewardInfos:r,programId:o},c=this.createTxBuilder(),u=n!=null?n:this.scope.ownerPubKey,d=St({fromPublicKey:u,programId:a.programId}),l=await this.scope.connection.getMinimumBalanceForRentExemption(Lt.span);c.addInstruction({instructions:[Xi.createAccountWithSeed({fromPubkey:u,basePubkey:u,seed:d.seed,newAccountPubkey:d.publicKey,lamports:l,space:Lt.span,programId:a.programId})]});let{publicKey:f,nonce:p}=kn({programId:new W(a.programId),poolId:d.publicKey}),g=rt({programId:a.programId,poolId:d.publicKey,mint:a.lpMint,type:"lpVault"}),m=[],x=[];for(let k of a.rewardInfos){k.openTime>=k.endTime&&this.logAndCreateError("start time error","rewardInfo.rewardOpenTime",k.openTime.toString()),isNaN(Re[k.rewardType])&&this.logAndCreateError("rewardType error",k.rewardType),Number(k.perSecond)<=0&&this.logAndCreateError("rewardPerSecond error",k.perSecond),m.push(An(k));let{rewardPubKey:S,newInstruction:B}=await this._getUserRewardInfo({rewardInfo:k,payer:u});B&&c.addInstruction(B),S||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let q=k.mint.equals(Q)?new W(ie.address):k.mint;x.push({rewardMint:q,rewardVault:rt({programId:a.programId,poolId:d.publicKey,mint:q,type:"rewardVault"}),userRewardToken:S})}let b=await this.scope.account.getCreatedTokenAccount({mint:a.lockInfo.lockMint});b||this.logAndCreateError("cannot found lock vault","tokenAccounts",this.scope.account.tokenAccounts);let{instruction:I,instructionType:w}=Bn({farmId:d.publicKey,owner:this.scope.ownerPubKey,farmAuthority:f,lpVault:g,lpMint:a.lpMint,lockVault:a.lockInfo.lockVault,lockMint:a.lockInfo.lockMint,lockUserAccount:b,programId:a.programId,rewardInfo:x,rewardInfoConfig:m,nonce:p});return c.addInstruction({instructions:[I],instructionTypes:[w]}).versionBuild({txVersion:i,extInfo:{farmId:d.publicKey,farmAuthority:f,lpVault:g,lockUserAccount:b,nonce:p}})}async restartReward({farmInfo:t,payer:r,newRewardInfo:n,txVersion:o}){var x;let i=Pe[t.programId];i!==6&&this.logAndCreateError("invalid farm version ",i);let s=we((await this.scope.api.fetchFarmKeysById({ids:t.id}))[0]),a={id:s.id,rewardInfos:t.rewardInfos,lpVault:s.lpVault,programId:s.programId};n.openTime>=n.endTime&&this.logAndCreateError("start time error","newRewardInfo",n);let c=r||this.scope.ownerPubKey,u=n.mint.equals(Q)?new W(ie.address):n.mint,d=a.rewardInfos.findIndex(b=>new W(b.mint.address).equals(u)),l=s.rewardInfos[d];l||this.logAndCreateError("configuration does not exist","rewardMint",u);let f=(x=l.vault)!=null?x:Q,p=this.createTxBuilder(),{rewardPubKey:g,newInstruction:m}=await this._getUserRewardInfo({rewardInfo:n,payer:c});return m&&p.addInstruction(m),g||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts),p.addInstruction({instructions:[gr({payer:this.scope.ownerPubKey,rewardVault:f,userRewardTokenPub:g,farmKeys:a,rewardInfo:n})],instructionTypes:[M.FarmV6Restart]}).versionBuild({txVersion:o})}async restartRewards({farmInfo:t,payer:r,newRewardInfos:n,txVersion:o}){var d;let i=Pe[t.programId];i!==6&&this.logAndCreateError("invalid farm version ",i);let s=we((await this.scope.api.fetchFarmKeysById({ids:t.id}))[0]),a={id:s.id,rewardInfos:t.rewardInfos,lpVault:s.lpVault,programId:s.programId};n.forEach(l=>{l.openTime>=l.endTime&&this.logAndCreateError("start time error","newRewardInfo",l)});let c=r||this.scope.ownerPubKey,u=this.createTxBuilder();for(let l of n){let f=l.mint.equals(Q)?new W(ie.address):l.mint,p=a.rewardInfos.findIndex(w=>new W(w.mint.address).equals(f)),g=s.rewardInfos[p];g||this.logAndCreateError("configuration does not exist","rewardMint",f);let m=(d=g.vault)!=null?d:Q,{rewardPubKey:x,newInstruction:b}=await this._getUserRewardInfo({rewardInfo:l,payer:c});b&&u.addInstruction(b),x||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let I=gr({payer:this.scope.ownerPubKey,rewardVault:m,userRewardTokenPub:x,farmKeys:a,rewardInfo:l});u.addInstruction({instructions:[I],instructionTypes:[M.FarmV6Restart]})}return u.versionBuild({txVersion:o})}async addNewRewardToken(t){let{txVersion:r,farmInfo:n,newRewardInfo:o,payer:i}=t,s=Pe[n.programId];s!==6&&this.logAndCreateError("invalid farm version ",s);let a=we((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),c=i!=null?i:this.scope.ownerPubKey,u=this.createTxBuilder(),d=o.mint.equals(Q)?new W(ie.address):o.mint,l=rt({programId:new W(n.programId),poolId:new W(n.id),mint:d,type:"rewardVault"}),{rewardPubKey:f,newInstruction:p}=await this._getUserRewardInfo({rewardInfo:o,payer:c});return p&&u.addInstruction(p),f||this.logAndCreateError("annot found target token accounts",this.scope.account.tokenAccounts),o.mint=d,u.addInstruction({instructions:[yr({payer:this.scope.ownerPubKey,userRewardTokenPub:f,farmKeys:a,rewardVault:l,rewardInfo:o})],instructionTypes:[M.FarmV6CreatorAddReward]}).versionBuild({txVersion:r})}async addNewRewardsToken(t){let{txVersion:r,farmInfo:n,newRewardInfos:o,payer:i}=t,s=Pe[n.programId];s!==6&&this.logAndCreateError("invalid farm version ",s);let a=we((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),c=i!=null?i:this.scope.ownerPubKey,u=this.createTxBuilder();for(let d of o){let l=d.mint.equals(Q)?new W(ie.address):d.mint,f=rt({programId:new W(n.programId),poolId:new W(n.id),mint:l,type:"rewardVault"}),{rewardPubKey:p,newInstruction:g}=await this._getUserRewardInfo({rewardInfo:d,payer:c});g&&u.addInstruction(g),p||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let m=yr({payer:this.scope.ownerPubKey,userRewardTokenPub:p,farmKeys:a,rewardVault:f,rewardInfo:ee(O({},d),{mint:l})});u.addInstruction({instructions:[m],instructionTypes:[M.FarmV6CreatorAddReward]})}return u.versionBuild({txVersion:r})}async deposit(t){let{txVersion:r,farmInfo:n,amount:o,feePayer:i,useSOLBalance:s,associatedOnly:a=!0,checkCreateATAOwner:c=!1,userAuxiliaryLedgers:u,computeBudgetConfig:d}=t;this.scope.availability.addFarm===!1&&this.logAndCreateError("farm deposit feature disabled in your region");let{rewardInfos:l,programId:f}=n,p=Pe[f];dr(p)||this.logAndCreateError("invalid farm program:",n.programId);let[g,m]=[new W(n.programId),new W(n.id)],x=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],b=ge({programId:g,poolId:m,owner:this.scope.ownerPubKey,version:p}),I=this.createTxBuilder();I.addCustomComputeBudget(d);let w={};for(let N of this.scope.account.tokenAccounts)if(a){let ne=Me(this.scope.ownerPubKey,N.mint,N.programId).publicKey;N.publicKey&&ne.equals(N.publicKey)&&(w[N.mint.toString()]=N.publicKey)}else w[N.mint.toString()]=N.publicKey;let k=x.lpMint,S=w[k.address];S||this.logAndCreateError("you don't have any lp","lp zero",w);let B=[];for(let N of l){let ne=s&&N.mint.address===Se.toString(),Y=w[N.mint.address];if(!Y){let{account:E,instructionParams:Pr}=await this.scope.account.getOrCreateTokenAccount({mint:new W(N.mint.address),notUseTokenAccount:ne,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!ne,associatedOnly:ne?!1:a,checkCreateATAOwner:c});Y=E,Pr&&I.addInstruction(Pr)}w[N.mint.address]=Y,B.push(Y)}let q,re=await this.scope.connection.getAccountInfo(b);if(re&&(q=mr(p).decode(re.data)),n.programId!==Je.toString()&&!q){let{instruction:N,instructionType:ne}=Ln({id:m,programId:g,version:p,ledger:b,owner:this.scope.ownerPubKey});I.addInstruction({instructions:[N],instructionTypes:[ne]})}let F=fr({version:p,rewardInfos:l,rewardTokenAccountsPublicKeys:B});F&&this.logAndCreateError(F);let G={amount:C(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:x,lpAccount:S,rewardAccounts:B,userAuxiliaryLedgers:u==null?void 0:u.map(N=>new W(N))},j=p===6?Vn(G):p===5?Cn(G):Kn(G),J={3:M.FarmV3Deposit,5:M.FarmV5Deposit,6:M.FarmV6Deposit};return I.addInstruction({instructions:[j],instructionTypes:[J[p]]}).versionBuild({txVersion:r})}async withdraw(t){let{txVersion:r,farmInfo:n,amount:o,deposited:i,useSOLBalance:s,feePayer:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,userAuxiliaryLedgers:d,computeBudgetConfig:l}=t,{rewardInfos:f}=n;this.scope.availability.removeFarm===!1&&this.logAndCreateError("farm withdraw feature disabled in your region");let p=Pe[n.programId];dr(p)||this.logAndCreateError("invalid farm program:",n.programId);let g=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],m=this.createTxBuilder();m.addCustomComputeBudget(l);let x={};for(let F of this.scope.account.tokenAccounts)if(c){let G=Me(this.scope.ownerPubKey,F.mint).publicKey;F.publicKey&&G.equals(F.publicKey)&&(x[F.mint.toString()]=F.publicKey)}else x[F.mint.toString()]=F.publicKey;if(i)i.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id});else{let F=ge({programId:new W(n.programId),poolId:new W(n.id),owner:this.scope.ownerPubKey,version:p}),G=await this.scope.connection.getAccountInfo(F);G||this.logAndCreateError("no lp data",{farmId:n.id,version:p,ledgerData:G}),mr(p).decode(G.data).deposited.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id})}let b=g.lpMint.address,I=s&&b===Se.toString(),w=x[b.toString()];if(!w){let{account:F,instructionParams:G}=await this.scope.account.getOrCreateTokenAccount({mint:new W(b),notUseTokenAccount:I,createInfo:{payer:a||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:I?!1:c,checkCreateATAOwner:u});w=F,G&&m.addInstruction(G)}x[b.toString()]=w;let k=[];for(let F of f){let G=s&&F.mint.address===Se.toString(),j=x[F.mint.address];if(!j){let{account:J,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({mint:new W(F.mint.address),notUseTokenAccount:G,createInfo:{payer:a||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!G,associatedOnly:G?!1:c,checkCreateATAOwner:u});j=J,N&&m.addInstruction(N)}x[F.mint.address]=j,k.push(j)}let S=fr({version:p,rewardInfos:f,rewardTokenAccountsPublicKeys:k});S&&this.logAndCreateError(S);let B={amount:C(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:g,lpAccount:w,rewardAccounts:k,userAuxiliaryLedgers:d==null?void 0:d.map(F=>new W(F))},q=p===6?hr(B):p===5?br(B):wr(B),re={3:M.FarmV3Withdraw,5:M.FarmV5Withdraw,6:M.FarmV6Withdraw};return m.addInstruction({instructions:[q],instructionTypes:[re[p]]}).versionBuild({txVersion:r})}async withdrawFarmReward({farmInfo:t,withdrawMint:r,txVersion:n}){var p;this.scope.checkOwner();let o=we((await this.scope.api.fetchFarmKeysById({ids:t.id}))[0]),i=Pe[t.programId];i!==6&&this.logAndCreateError("invalid farm version",i);let s=t.rewardInfos.findIndex(g=>g.mint.address===Q.toString()?new W(ie.address):r),a=o.rewardInfos[s];a||this.logAndCreateError("withdraw mint error","rewardInfos",t);let c=(p=a==null?void 0:a.vault)!=null?p:Q,u=this.createTxBuilder(),d;if(r.equals(Q)){let g=await nr({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:pr(ee(O({},a),{perSecond:new Et(a.perSecond).mul(10**a.mint.decimals).toString()}))});d=g.addresses.newAccount,u.addInstruction(g)}else{let g=await this.scope.account.getCreatedTokenAccount({mint:r});g===null?(d=await this.scope.account.getAssociatedTokenAccount(r),u.addInstruction({instructions:[Zi(this.scope.ownerPubKey,d,this.scope.ownerPubKey,r)],instructionTypes:[M.CreateATA]})):d=g}let{instruction:l,instructionType:f}=Rn({programId:o.programId,id:o.id,authority:o.authority,lpVault:o.lpVault,rewardVault:c,userRewardToken:d,owner:this.scope.ownerPubKey});return u.addInstruction({instructions:[l],instructionTypes:[f]}).versionBuild({txVersion:n})}async harvestAllRewards(t){let{farmInfoList:r,useSOLBalance:n,feePayer:o,associatedOnly:i=!0,checkCreateATAOwner:s=!1,userAuxiliaryLedgers:a,txVersion:c,computeBudgetConfig:u}=t,d=this.createTxBuilder();d.addCustomComputeBudget(u);let l={};for(let g of this.scope.account.tokenAccounts)if(i){let m=Me(this.scope.ownerPubKey,g.mint).publicKey;g.publicKey&&m.equals(g.publicKey)&&(l[g.mint.toString()]=g.publicKey)}else l[g.mint.toString()]=g.publicKey;let p=(await this.scope.api.fetchFarmKeysById({ids:Object.values(r).map(g=>g.id).join(",")})).reduce((g,m)=>ee(O({},g),{[m.id]:m}),{});for(let g of Object.values(r)){let{programId:m,lpMint:x,rewardInfos:b,id:I}=g,w=Pe[m],k=x.address,S=n&&k===Se.toString(),B=l[k];if(!B){let{account:J,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({mint:new W(k),notUseTokenAccount:S,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:S?!1:i,checkCreateATAOwner:s});B=J,N&&d.addInstruction(N)}l[k.toString()]=B;let q=[];for(let J of b){let N=n&&J.mint.address===Se.toString(),ne=l[J.mint.address];if(!ne){let{account:Y,instructionParams:E}=await this.scope.account.getOrCreateTokenAccount({mint:new W(J.mint.address),notUseTokenAccount:N,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!N,associatedOnly:N?!1:i,checkCreateATAOwner:s});ne=Y,E&&d.addInstruction(E)}l[J.mint.address]=ne,q.push(ne)}let re=p[I],F={amount:Gt,owner:this.scope.ownerPubKey,farmInfo:g,farmKeys:re,lpAccount:B,rewardAccounts:q,userAuxiliaryLedgers:a==null?void 0:a.map(J=>new W(J))},G=w===6?hr(F):w===5?br(F):wr(F),j={3:M.FarmV3Withdraw,5:M.FarmV5Withdraw,6:M.FarmV6Withdraw};d.addInstruction({instructions:[G],instructionTypes:[j[w]]})}return c===1?d.sizeCheckBuild():d.sizeCheckBuildV0()}};export{xr as default};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=farm.mjs.map