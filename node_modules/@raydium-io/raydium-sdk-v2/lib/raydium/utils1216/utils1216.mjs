var cn=Object.defineProperty,ln=Object.defineProperties;var fn=Object.getOwnPropertyDescriptors;var Ce=Object.getOwnPropertySymbols;var Pt=Object.prototype.hasOwnProperty,xt=Object.prototype.propertyIsEnumerable;var Tt=(e,t,n)=>t in e?cn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,V=(e,t)=>{for(var n in t||(t={}))Pt.call(t,n)&&Tt(e,n,t[n]);if(Ce)for(var n of Ce(t))xt.call(t,n)&&Tt(e,n,t[n]);return e},ee=(e,t)=>ln(e,fn(t));var De=(e,t)=>{var n={};for(var r in e)Pt.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&Ce)for(var r of Ce(e))t.indexOf(r)<0&&xt.call(e,r)&&(n[r]=e[r]);return n};import{TOKEN_PROGRAM_ID as Mr}from"@solana/spl-token";import{PublicKey as Fr,Transaction as wt,TransactionInstruction as vr}from"@solana/web3.js";import un from"bn.js";import{get as At,set as mn}from"lodash";import Bt from"dayjs";import dn from"dayjs/plugin/utc";Bt.extend(dn);var Je=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Bt().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let n=t.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(n)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},St={},pn={};function U(e){let t=At(St,e);if(!t){let n=At(pn,e);t=new Je({name:e,logLevel:n}),mn(St,e,t)}return t}import{PublicKey as Ae,sendAndConfirmTransaction as dt,Transaction as Se,TransactionMessage as Be,VersionedTransaction as ke}from"@solana/web3.js";import Lr from"axios";var Xe={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw"};import{PublicKey as gn,ComputeBudgetProgram as kt,Transaction as Lt,TransactionMessage as hn,Keypair as It,VersionedTransaction as Ct}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as bn}from"@solana/spl-token";var Nt=U("Raydium_txUtil"),Dt=1644;function Ee(e){let t=[],n=[];return e.microLamports&&(t.push(kt.setComputeUnitPrice({microLamports:e.microLamports})),n.push(Xe.SetComputeUnitPrice)),e.units&&(t.push(kt.setComputeUnitLimit({units:e.units})),n.push(Xe.SetComputeUnitLimit)),{instructions:t,instructionTypes:n}}async function le(e){var t,n;try{return((n=await((t=e.getLatestBlockhash)==null?void 0:t.call(e)))==null?void 0:n.blockhash)||(await e.getRecentBlockhash()).blockhash}catch{return(await e.getRecentBlockhash()).blockhash}}function Qe(e,t){e.length<1&&Nt.logWithError(`no instructions provided: ${e.toString()}`),t.length<1&&Nt.logWithError(`no signers provided:, ${t.toString()}`);let n=new Lt;n.recentBlockhash="11111111111111111111111111111111",n.feePayer=t[0],n.add(...e);try{return Buffer.from(n.serialize({verifySignatures:!1})).toString("base64").length<Dt}catch{return!1}}function Re(e,t){let[n,r]=gn.findProgramAddressSync(e,t);return{publicKey:n,nonce:r}}function be({instructions:e,payer:t,signers:n}){return Qe(e,[t,...n])}function ye({instructions:e,payer:t,lookupTableAddressAccount:n,recentBlockhash:r=It.generate().publicKey.toString()}){let o=new hn({payerKey:t,recentBlockhash:r,instructions:e}).compileToV0Message(Object.values(n!=null?n:{}));try{return Buffer.from(new Ct(o).serialize()).toString("base64").length<Dt}catch{return!1}}var yn=e=>Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e.buffer,e.byteOffset,e.byteLength):Buffer.from(e);function se(e){let t=[];return e.forEach(n=>{n instanceof Lt&&(n.recentBlockhash||(n.recentBlockhash=bn.toBase58()),n.feePayer||(n.feePayer=It.generate().publicKey));let r=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof Ct&&(r=yn(r));let i=r.toString("base64");t.push(i)}),console.log("simulate tx string:",t),t}import{PublicKey as tn,AddressLookupTableAccount as je}from"@solana/web3.js";import{PublicKey as Nr}from"@solana/web3.js";import{getTransferFeeConfig as ea,unpackMint as ta}from"@solana/spl-token";import{PublicKey as Qo}from"@solana/web3.js";import es from"bn.js";import kr from"big.js";import Eo from"bn.js";import G from"bn.js";var fe=9e15,ie=1e9,$e="0123456789abcdef",Me="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Fe="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",et={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-fe,maxE:fe,crypto:!1},Mt,Q,x=!0,_e="[DecimalError] ",re=_e+"Invalid argument: ",Ft=_e+"Precision limit exceeded",vt=_e+"crypto unavailable",_t="[object Decimal]",v=Math.floor,R=Math.pow,wn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Tn=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Pn=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Kt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Z=1e7,P=7,xn=9007199254740991,An=Me.length-1,tt=Fe.length-1,p={toStringTag:_t};p.absoluteValue=p.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),T(e)};p.ceil=function(){return T(new this.constructor(this),this.e+1,2)};p.clampedTo=p.clamp=function(e,t){var n,r=this,i=r.constructor;if(e=new i(e),t=new i(t),!e.s||!t.s)return new i(NaN);if(e.gt(t))throw Error(re+t);return n=r.cmp(e),n<0?e:r.cmp(t)>0?t:new i(r)};p.comparedTo=p.cmp=function(e){var t,n,r,i,o=this,s=o.d,a=(e=new o.constructor(e)).d,c=o.s,u=e.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==e.e)return o.e>e.e^c<0?1:-1;for(r=s.length,i=a.length,t=0,n=r<i?r:i;t<n;++t)if(s[t]!==a[t])return s[t]>a[t]^c<0?1:-1;return r===i?0:r>i^c<0?1:-1};p.cosine=p.cos=function(){var e,t,n=this,r=n.constructor;return n.d?n.d[0]?(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+P,r.rounding=1,n=Sn(r,Gt(r,n)),r.precision=e,r.rounding=t,T(Q==2||Q==3?n.neg():n,e,t,!0)):new r(1):new r(NaN)};p.cubeRoot=p.cbrt=function(){var e,t,n,r,i,o,s,a,c,u,l=this,f=l.constructor;if(!l.isFinite()||l.isZero())return new f(l);for(x=!1,o=l.s*R(l.s*l,1/3),!o||Math.abs(o)==1/0?(n=M(l.d),e=l.e,(o=(e-n.length+1)%3)&&(n+=o==1||o==-2?"0":"00"),o=R(n,1/3),e=v((e+1)/3)-(e%3==(e<0?-1:2)),o==1/0?n="5e"+e:(n=o.toExponential(),n=n.slice(0,n.indexOf("e")+1)+e),r=new f(n),r.s=l.s):r=new f(o.toString()),s=(e=f.precision)+3;;)if(a=r,c=a.times(a).times(a),u=c.plus(l),r=I(u.plus(l).times(a),u.plus(c),s+2,1),M(a.d).slice(0,s)===(n=M(r.d)).slice(0,s))if(n=n.slice(s-3,s+1),n=="9999"||!i&&n=="4999"){if(!i&&(T(a,e+1,0),a.times(a).times(a).eq(l))){r=a;break}s+=4,i=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(T(r,e+1,1),t=!r.times(r).times(r).eq(l));break}return x=!0,T(r,e,f.rounding,t)};p.decimalPlaces=p.dp=function(){var e,t=this.d,n=NaN;if(t){if(e=t.length-1,n=(e-v(this.e/P))*P,e=t[e],e)for(;e%10==0;e/=10)n--;n<0&&(n=0)}return n};p.dividedBy=p.div=function(e){return I(this,new this.constructor(e))};p.dividedToIntegerBy=p.divToInt=function(e){var t=this,n=t.constructor;return T(I(t,new n(e),0,1,1),n.precision,n.rounding)};p.equals=p.eq=function(e){return this.cmp(e)===0};p.floor=function(){return T(new this.constructor(this),this.e+1,3)};p.greaterThan=p.gt=function(e){return this.cmp(e)>0};p.greaterThanOrEqualTo=p.gte=function(e){var t=this.cmp(e);return t==1||t===0};p.hyperbolicCosine=p.cosh=function(){var e,t,n,r,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;n=s.precision,r=s.rounding,s.precision=n+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(e=Math.ceil(i/3),t=(1/Ve(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),o=me(s,1,o.times(t),new s(1),!0);for(var c,u=e,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return T(o,s.precision=n,s.rounding=r,!0)};p.hyperbolicSine=p.sinh=function(){var e,t,n,r,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(t=o.precision,n=o.rounding,o.precision=t+Math.max(i.e,i.sd())+4,o.rounding=1,r=i.d.length,r<3)i=me(o,2,i,i,!0);else{e=1.4*Math.sqrt(r),e=e>16?16:e|0,i=i.times(1/Ve(5,e)),i=me(o,2,i,i,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);e--;)s=i.times(i),i=i.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=t,o.rounding=n,T(i,t,n,!0)};p.hyperbolicTangent=p.tanh=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,I(n.sinh(),n.cosh(),r.precision=e,r.rounding=t)):new r(n.s)};p.inverseCosine=p.acos=function(){var e,t=this,n=t.constructor,r=t.abs().cmp(1),i=n.precision,o=n.rounding;return r!==-1?r===0?t.isNeg()?Y(n,i,o):new n(0):new n(NaN):t.isZero()?Y(n,i+4,o).times(.5):(n.precision=i+6,n.rounding=1,t=t.asin(),e=Y(n,i+4,o).times(.5),n.precision=i,n.rounding=o,e.minus(t))};p.inverseHyperbolicCosine=p.acosh=function(){var e,t,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(e=r.precision,t=r.rounding,r.precision=e+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,x=!1,n=n.times(n).minus(1).sqrt().plus(n),x=!0,r.precision=e,r.rounding=t,n.ln()):new r(n)};p.inverseHyperbolicSine=p.asinh=function(){var e,t,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,x=!1,n=n.times(n).plus(1).sqrt().plus(n),x=!0,r.precision=e,r.rounding=t,n.ln())};p.inverseHyperbolicTangent=p.atanh=function(){var e,t,n,r,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(e=o.precision,t=o.rounding,r=i.sd(),Math.max(r,e)<2*-i.e-1?T(new o(i),e,t,!0):(o.precision=n=r-i.e,i=I(i.plus(1),new o(1).minus(i),n+e,1),o.precision=e+4,o.rounding=1,i=i.ln(),o.precision=e,o.rounding=t,i.times(.5))):new o(NaN)};p.inverseSine=p.asin=function(){var e,t,n,r,i=this,o=i.constructor;return i.isZero()?new o(i):(t=i.abs().cmp(1),n=o.precision,r=o.rounding,t!==-1?t===0?(e=Y(o,n+4,r).times(.5),e.s=i.s,e):new o(NaN):(o.precision=n+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=n,o.rounding=r,i.times(2)))};p.inverseTangent=p.atan=function(){var e,t,n,r,i,o,s,a,c,u=this,l=u.constructor,f=l.precision,m=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&f+4<=tt)return s=Y(l,f+4,m).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(f+4<=tt)return s=Y(l,f+4,m).times(.5),s.s=u.s,s}for(l.precision=a=f+10,l.rounding=1,n=Math.min(28,a/P+2|0),e=n;e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(x=!1,t=Math.ceil(a/P),r=1,c=u.times(u),s=new l(u),i=u;e!==-1;)if(i=i.times(c),o=s.minus(i.div(r+=2)),i=i.times(c),s=o.plus(i.div(r+=2)),s.d[t]!==void 0)for(e=t;s.d[e]===o.d[e]&&e--;);return n&&(s=s.times(2<<n-1)),x=!0,T(s,l.precision=f,l.rounding=m,!0)};p.isFinite=function(){return!!this.d};p.isInteger=p.isInt=function(){return!!this.d&&v(this.e/P)>this.d.length-2};p.isNaN=function(){return!this.s};p.isNegative=p.isNeg=function(){return this.s<0};p.isPositive=p.isPos=function(){return this.s>0};p.isZero=function(){return!!this.d&&this.d[0]===0};p.lessThan=p.lt=function(e){return this.cmp(e)<0};p.lessThanOrEqualTo=p.lte=function(e){return this.cmp(e)<1};p.logarithm=p.log=function(e){var t,n,r,i,o,s,a,c,u=this,l=u.constructor,f=l.precision,m=l.rounding,g=5;if(e==null)e=new l(10),t=!0;else{if(e=new l(e),n=e.d,e.s<0||!n||!n[0]||e.eq(1))return new l(NaN);t=e.eq(10)}if(n=u.d,u.s<0||!n||!n[0]||u.eq(1))return new l(n&&!n[0]?-1/0:u.s!=1?NaN:n?0:1/0);if(t)if(n.length>1)o=!0;else{for(i=n[0];i%10===0;)i/=10;o=i!==1}if(x=!1,a=f+g,s=ne(u,a),r=t?ve(l,a+10):ne(e,a),c=I(s,r,a,1),we(c.d,i=f,m))do if(a+=10,s=ne(u,a),r=t?ve(l,a+10):ne(e,a),c=I(s,r,a,1),!o){+M(c.d).slice(i+1,i+15)+1==1e14&&(c=T(c,f+1,0));break}while(we(c.d,i+=10,m));return x=!0,T(c,f,m)};p.minus=p.sub=function(e){var t,n,r,i,o,s,a,c,u,l,f,m,g=this,b=g.constructor;if(e=new b(e),!g.d||!e.d)return!g.s||!e.s?e=new b(NaN):g.d?e.s=-e.s:e=new b(e.d||g.s!==e.s?g:NaN),e;if(g.s!=e.s)return e.s=-e.s,g.plus(e);if(u=g.d,m=e.d,a=b.precision,c=b.rounding,!u[0]||!m[0]){if(m[0])e.s=-e.s;else if(u[0])e=new b(g);else return new b(c===3?-0:0);return x?T(e,a,c):e}if(n=v(e.e/P),l=v(g.e/P),u=u.slice(),o=l-n,o){for(f=o<0,f?(t=u,o=-o,s=m.length):(t=m,n=l,s=u.length),r=Math.max(Math.ceil(a/P),s)+2,o>r&&(o=r,t.length=1),t.reverse(),r=o;r--;)t.push(0);t.reverse()}else{for(r=u.length,s=m.length,f=r<s,f&&(s=r),r=0;r<s;r++)if(u[r]!=m[r]){f=u[r]<m[r];break}o=0}for(f&&(t=u,u=m,m=t,e.s=-e.s),s=u.length,r=m.length-s;r>0;--r)u[s++]=0;for(r=m.length;r>o;){if(u[--r]<m[r]){for(i=r;i&&u[--i]===0;)u[i]=Z-1;--u[i],u[r]+=Z}u[r]-=m[r]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--n;return u[0]?(e.d=u,e.e=Ke(u,n),x?T(e,a,c):e):new b(c===3?-0:0)};p.modulo=p.mod=function(e){var t,n=this,r=n.constructor;return e=new r(e),!n.d||!e.s||e.d&&!e.d[0]?new r(NaN):!e.d||n.d&&!n.d[0]?T(new r(n),r.precision,r.rounding):(x=!1,r.modulo==9?(t=I(n,e.abs(),0,3,1),t.s*=e.s):t=I(n,e,0,r.modulo,1),t=t.times(e),x=!0,n.minus(t))};p.naturalExponential=p.exp=function(){return nt(this)};p.naturalLogarithm=p.ln=function(){return ne(this)};p.negated=p.neg=function(){var e=new this.constructor(this);return e.s=-e.s,T(e)};p.plus=p.add=function(e){var t,n,r,i,o,s,a,c,u,l,f=this,m=f.constructor;if(e=new m(e),!f.d||!e.d)return!f.s||!e.s?e=new m(NaN):f.d||(e=new m(e.d||f.s===e.s?f:NaN)),e;if(f.s!=e.s)return e.s=-e.s,f.minus(e);if(u=f.d,l=e.d,a=m.precision,c=m.rounding,!u[0]||!l[0])return l[0]||(e=new m(f)),x?T(e,a,c):e;if(o=v(f.e/P),r=v(e.e/P),u=u.slice(),i=o-r,i){for(i<0?(n=u,i=-i,s=l.length):(n=l,r=o,s=u.length),o=Math.ceil(a/P),s=o>s?o+1:s+1,i>s&&(i=s,n.length=1),n.reverse();i--;)n.push(0);n.reverse()}for(s=u.length,i=l.length,s-i<0&&(i=s,n=l,l=u,u=n),t=0;i;)t=(u[--i]=u[i]+l[i]+t)/Z|0,u[i]%=Z;for(t&&(u.unshift(t),++r),s=u.length;u[--s]==0;)u.pop();return e.d=u,e.e=Ke(u,r),x?T(e,a,c):e};p.precision=p.sd=function(e){var t,n=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(re+e);return n.d?(t=Vt(n.d),e&&n.e+1>t&&(t=n.e+1)):t=NaN,t};p.round=function(){var e=this,t=e.constructor;return T(new t(e),e.e+1,t.rounding)};p.sine=p.sin=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+P,r.rounding=1,n=kn(r,Gt(r,n)),r.precision=e,r.rounding=t,T(Q>2?n.neg():n,e,t,!0)):new r(NaN)};p.squareRoot=p.sqrt=function(){var e,t,n,r,i,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(x=!1,u=Math.sqrt(+s),u==0||u==1/0?(t=M(a),(t.length+c)%2==0&&(t+="0"),u=Math.sqrt(t),c=v((c+1)/2)-(c<0||c%2),u==1/0?t="5e"+c:(t=u.toExponential(),t=t.slice(0,t.indexOf("e")+1)+c),r=new l(t)):r=new l(u.toString()),n=(c=l.precision)+3;;)if(o=r,r=o.plus(I(s,o,n+2,1)).times(.5),M(o.d).slice(0,n)===(t=M(r.d)).slice(0,n))if(t=t.slice(n-3,n+1),t=="9999"||!i&&t=="4999"){if(!i&&(T(o,c+1,0),o.times(o).eq(s))){r=o;break}n+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(T(r,c+1,1),e=!r.times(r).eq(s));break}return x=!0,T(r,c,l.rounding,e)};p.tangent=p.tan=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+10,r.rounding=1,n=n.sin(),n.s=1,n=I(n,new r(1).minus(n.times(n)).sqrt(),e+10,0),r.precision=e,r.rounding=t,T(Q==2||Q==4?n.neg():n,e,t,!0)):new r(NaN)};p.times=p.mul=function(e){var t,n,r,i,o,s,a,c,u,l=this,f=l.constructor,m=l.d,g=(e=new f(e)).d;if(e.s*=l.s,!m||!m[0]||!g||!g[0])return new f(!e.s||m&&!m[0]&&!g||g&&!g[0]&&!m?NaN:!m||!g?e.s/0:e.s*0);for(n=v(l.e/P)+v(e.e/P),c=m.length,u=g.length,c<u&&(o=m,m=g,g=o,s=c,c=u,u=s),o=[],s=c+u,r=s;r--;)o.push(0);for(r=u;--r>=0;){for(t=0,i=c+r;i>r;)a=o[i]+g[r]*m[i-r-1]+t,o[i--]=a%Z|0,t=a/Z|0;o[i]=(o[i]+t)%Z|0}for(;!o[--s];)o.pop();return t?++n:o.shift(),e.d=o,e.e=Ke(o,n),x?T(e,f.precision,f.rounding):e};p.toBinary=function(e,t){return it(this,2,e,t)};p.toDecimalPlaces=p.toDP=function(e,t){var n=this,r=n.constructor;return n=new r(n),e===void 0?n:(q(e,0,ie),t===void 0?t=r.rounding:q(t,0,8),T(n,e+n.e+1,t))};p.toExponential=function(e,t){var n,r=this,i=r.constructor;return e===void 0?n=J(r,!0):(q(e,0,ie),t===void 0?t=i.rounding:q(t,0,8),r=T(new i(r),e+1,t),n=J(r,!0,e+1)),r.isNeg()&&!r.isZero()?"-"+n:n};p.toFixed=function(e,t){var n,r,i=this,o=i.constructor;return e===void 0?n=J(i):(q(e,0,ie),t===void 0?t=o.rounding:q(t,0,8),r=T(new o(i),e+i.e+1,t),n=J(r,!1,e+r.e+1)),i.isNeg()&&!i.isZero()?"-"+n:n};p.toFraction=function(e){var t,n,r,i,o,s,a,c,u,l,f,m,g=this,b=g.d,d=g.constructor;if(!b)return new d(g);if(u=n=new d(1),r=c=new d(0),t=new d(r),o=t.e=Vt(b)-g.e-1,s=o%P,t.d[0]=R(10,s<0?P+s:s),e==null)e=o>0?t:u;else{if(a=new d(e),!a.isInt()||a.lt(u))throw Error(re+a);e=a.gt(t)?o>0?t:u:a}for(x=!1,a=new d(M(b)),l=d.precision,d.precision=o=b.length*P*2;f=I(a,t,0,1,1),i=n.plus(f.times(r)),i.cmp(e)!=1;)n=r,r=i,i=u,u=c.plus(f.times(i)),c=i,i=t,t=a.minus(f.times(i)),a=i;return i=I(e.minus(n),r,0,1,1),c=c.plus(i.times(u)),n=n.plus(i.times(r)),c.s=u.s=g.s,m=I(u,r,o,1).minus(g).abs().cmp(I(c,n,o,1).minus(g).abs())<1?[u,r]:[c,n],d.precision=l,x=!0,m};p.toHexadecimal=p.toHex=function(e,t){return it(this,16,e,t)};p.toNearest=function(e,t){var n=this,r=n.constructor;if(n=new r(n),e==null){if(!n.d)return n;e=new r(1),t=r.rounding}else{if(e=new r(e),t===void 0?t=r.rounding:q(t,0,8),!n.d)return e.s?n:e;if(!e.d)return e.s&&(e.s=n.s),e}return e.d[0]?(x=!1,n=I(n,e,0,t,1).times(e),x=!0,T(n)):(e.s=n.s,n=e),n};p.toNumber=function(){return+this};p.toOctal=function(e,t){return it(this,8,e,t)};p.toPower=p.pow=function(e){var t,n,r,i,o,s,a=this,c=a.constructor,u=+(e=new c(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new c(R(+a,u));if(a=new c(a),a.eq(1))return a;if(r=c.precision,o=c.rounding,e.eq(1))return T(a,r,o);if(t=v(e.e/P),t>=e.d.length-1&&(n=u<0?-u:u)<=xn)return i=Wt(c,a,n,r),e.s<0?new c(1).div(i):T(i,r,o);if(s=a.s,s<0){if(t<e.d.length-1)return new c(NaN);if((e.d[t]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return n=R(+a,u),t=n==0||!isFinite(n)?v(u*(Math.log("0."+M(a.d))/Math.LN10+a.e+1)):new c(n+"").e,t>c.maxE+1||t<c.minE-1?new c(t>0?s/0:0):(x=!1,c.rounding=a.s=1,n=Math.min(12,(t+"").length),i=nt(e.times(ne(a,r+n)),r),i.d&&(i=T(i,r+5,1),we(i.d,r,o)&&(t=r+10,i=T(nt(e.times(ne(a,t+n)),t),t+5,1),+M(i.d).slice(r+1,r+15)+1==1e14&&(i=T(i,r+1,0)))),i.s=s,x=!0,c.rounding=o,T(i,r,o))};p.toPrecision=function(e,t){var n,r=this,i=r.constructor;return e===void 0?n=J(r,r.e<=i.toExpNeg||r.e>=i.toExpPos):(q(e,1,ie),t===void 0?t=i.rounding:q(t,0,8),r=T(new i(r),e,t),n=J(r,e<=r.e||r.e<=i.toExpNeg,e)),r.isNeg()&&!r.isZero()?"-"+n:n};p.toSignificantDigits=p.toSD=function(e,t){var n=this,r=n.constructor;return e===void 0?(e=r.precision,t=r.rounding):(q(e,1,ie),t===void 0?t=r.rounding:q(t,0,8)),T(new r(n),e,t)};p.toString=function(){var e=this,t=e.constructor,n=J(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+n:n};p.truncated=p.trunc=function(){return T(new this.constructor(this),this.e+1,1)};p.valueOf=p.toJSON=function(){var e=this,t=e.constructor,n=J(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+n:n};function M(e){var t,n,r,i=e.length-1,o="",s=e[0];if(i>0){for(o+=s,t=1;t<i;t++)r=e[t]+"",n=P-r.length,n&&(o+=te(n)),o+=r;s=e[t],r=s+"",n=P-r.length,n&&(o+=te(n))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function q(e,t,n){if(e!==~~e||e<t||e>n)throw Error(re+e)}function we(e,t,n,r){var i,o,s,a;for(o=e[0];o>=10;o/=10)--t;return--t<0?(t+=P,i=0):(i=Math.ceil((t+1)/P),t%=P),o=R(10,P-t),a=e[i]%o|0,r==null?t<3?(t==0?a=a/100|0:t==1&&(a=a/10|0),s=n<4&&a==99999||n>3&&a==49999||a==5e4||a==0):s=(n<4&&a+1==o||n>3&&a+1==o/2)&&(e[i+1]/o/100|0)==R(10,t-2)-1||(a==o/2||a==0)&&(e[i+1]/o/100|0)==0:t<4?(t==0?a=a/1e3|0:t==1?a=a/100|0:t==2&&(a=a/10|0),s=(r||n<4)&&a==9999||!r&&n>3&&a==4999):s=((r||n<4)&&a+1==o||!r&&n>3&&a+1==o/2)&&(e[i+1]/o/1e3|0)==R(10,t-3)-1,s}function Oe(e,t,n){for(var r,i=[0],o,s=0,a=e.length;s<a;){for(o=i.length;o--;)i[o]*=t;for(i[0]+=$e.indexOf(e.charAt(s++)),r=0;r<i.length;r++)i[r]>n-1&&(i[r+1]===void 0&&(i[r+1]=0),i[r+1]+=i[r]/n|0,i[r]%=n)}return i.reverse()}function Sn(e,t){var n,r,i;if(t.isZero())return t;r=t.d.length,r<32?(n=Math.ceil(r/3),i=(1/Ve(4,n)).toString()):(n=16,i="2.3283064365386962890625e-10"),e.precision+=n,t=me(e,1,t.times(i),new e(1));for(var o=n;o--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=n,t}var I=function(){function e(r,i,o){var s,a=0,c=r.length;for(r=r.slice();c--;)s=r[c]*i+a,r[c]=s%o|0,a=s/o|0;return a&&r.unshift(a),r}function t(r,i,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(r[a]!=i[a]){c=r[a]>i[a]?1:-1;break}return c}function n(r,i,o,s){for(var a=0;o--;)r[o]-=a,a=r[o]<i[o]?1:0,r[o]=a*s+r[o]-i[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,i,o,s,a,c){var u,l,f,m,g,b,d,w,h,A,y,B,S,k,K,O,j,he,W,ce,Ie=r.constructor,Ze=r.s==i.s?1:-1,F=r.d,C=i.d;if(!F||!F[0]||!C||!C[0])return new Ie(!r.s||!i.s||(F?C&&F[0]==C[0]:!C)?NaN:F&&F[0]==0||!C?Ze*0:Ze/0);for(c?(g=1,l=r.e-i.e):(c=Z,g=P,l=v(r.e/g)-v(i.e/g)),W=C.length,j=F.length,h=new Ie(Ze),A=h.d=[],f=0;C[f]==(F[f]||0);f++);if(C[f]>(F[f]||0)&&l--,o==null?(k=o=Ie.precision,s=Ie.rounding):a?k=o+(r.e-i.e)+1:k=o,k<0)A.push(1),b=!0;else{if(k=k/g+2|0,f=0,W==1){for(m=0,C=C[0],k++;(f<j||m)&&k--;f++)K=m*c+(F[f]||0),A[f]=K/C|0,m=K%C|0;b=m||f<j}else{for(m=c/(C[0]+1)|0,m>1&&(C=e(C,m,c),F=e(F,m,c),W=C.length,j=F.length),O=W,y=F.slice(0,W),B=y.length;B<W;)y[B++]=0;ce=C.slice(),ce.unshift(0),he=C[0],C[1]>=c/2&&++he;do m=0,u=t(C,y,W,B),u<0?(S=y[0],W!=B&&(S=S*c+(y[1]||0)),m=S/he|0,m>1?(m>=c&&(m=c-1),d=e(C,m,c),w=d.length,B=y.length,u=t(d,y,w,B),u==1&&(m--,n(d,W<w?ce:C,w,c))):(m==0&&(u=m=1),d=C.slice()),w=d.length,w<B&&d.unshift(0),n(y,d,B,c),u==-1&&(B=y.length,u=t(C,y,W,B),u<1&&(m++,n(y,W<B?ce:C,B,c))),B=y.length):u===0&&(m++,y=[0]),A[f++]=m,u&&y[0]?y[B++]=F[O]||0:(y=[F[O]],B=1);while((O++<j||y[0]!==void 0)&&k--);b=y[0]!==void 0}A[0]||A.shift()}if(g==1)h.e=l,Mt=b;else{for(f=1,m=A[0];m>=10;m/=10)f++;h.e=f+l*g-1,T(h,a?o+h.e+1:o,s,b)}return h}}();function T(e,t,n,r){var i,o,s,a,c,u,l,f,m,g=e.constructor;e:if(t!=null){if(f=e.d,!f)return e;for(i=1,a=f[0];a>=10;a/=10)i++;if(o=t-i,o<0)o+=P,s=t,l=f[m=0],c=l/R(10,i-s-1)%10|0;else if(m=Math.ceil((o+1)/P),a=f.length,m>=a)if(r){for(;a++<=m;)f.push(0);l=c=0,i=1,o%=P,s=o-P+1}else break e;else{for(l=a=f[m],i=1;a>=10;a/=10)i++;o%=P,s=o-P+i,c=s<0?0:l/R(10,i-s-1)%10|0}if(r=r||t<0||f[m+1]!==void 0||(s<0?l:l%R(10,i-s-1)),u=n<4?(c||r)&&(n==0||n==(e.s<0?3:2)):c>5||c==5&&(n==4||r||n==6&&(o>0?s>0?l/R(10,i-s):0:f[m-1])%10&1||n==(e.s<0?8:7)),t<1||!f[0])return f.length=0,u?(t-=e.e+1,f[0]=R(10,(P-t%P)%P),e.e=-t||0):f[0]=e.e=0,e;if(o==0?(f.length=m,a=1,m--):(f.length=m+1,a=R(10,P-o),f[m]=s>0?(l/R(10,i-s)%R(10,s)|0)*a:0),u)for(;;)if(m==0){for(o=1,s=f[0];s>=10;s/=10)o++;for(s=f[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(e.e++,f[0]==Z&&(f[0]=1));break}else{if(f[m]+=a,f[m]!=Z)break;f[m--]=0,a=1}for(o=f.length;f[--o]===0;)f.pop()}return x&&(e.e>g.maxE?(e.d=null,e.e=NaN):e.e<g.minE&&(e.e=0,e.d=[0])),e}function J(e,t,n){if(!e.isFinite())return qt(e);var r,i=e.e,o=M(e.d),s=o.length;return t?(n&&(r=n-s)>0?o=o.charAt(0)+"."+o.slice(1)+te(r):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(e.e<0?"e":"e+")+e.e):i<0?(o="0."+te(-i-1)+o,n&&(r=n-s)>0&&(o+=te(r))):i>=s?(o+=te(i+1-s),n&&(r=n-i-1)>0&&(o=o+"."+te(r))):((r=i+1)<s&&(o=o.slice(0,r)+"."+o.slice(r)),n&&(r=n-s)>0&&(i+1===s&&(o+="."),o+=te(r))),o}function Ke(e,t){var n=e[0];for(t*=P;n>=10;n/=10)t++;return t}function ve(e,t,n){if(t>An)throw x=!0,n&&(e.precision=n),Error(Ft);return T(new e(Me),t,1,!0)}function Y(e,t,n){if(t>tt)throw Error(Ft);return T(new e(Fe),t,n,!0)}function Vt(e){var t=e.length-1,n=t*P+1;if(t=e[t],t){for(;t%10==0;t/=10)n--;for(t=e[0];t>=10;t/=10)n++}return n}function te(e){for(var t="";e--;)t+="0";return t}function Wt(e,t,n,r){var i,o=new e(1),s=Math.ceil(r/P+4);for(x=!1;;){if(n%2&&(o=o.times(t),Rt(o.d,s)&&(i=!0)),n=v(n/2),n===0){n=o.d.length-1,i&&o.d[n]===0&&++o.d[n];break}t=t.times(t),Rt(t.d,s)}return x=!0,o}function Et(e){return e.d[e.d.length-1]&1}function Ut(e,t,n){for(var r,i=new e(t[0]),o=0;++o<t.length;)if(r=new e(t[o]),r.s)i[n](r)&&(i=r);else{i=r;break}return i}function nt(e,t){var n,r,i,o,s,a,c,u=0,l=0,f=0,m=e.constructor,g=m.rounding,b=m.precision;if(!e.d||!e.d[0]||e.e>17)return new m(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:0/0);for(t==null?(x=!1,c=b):c=t,a=new m(.03125);e.e>-2;)e=e.times(a),f+=5;for(r=Math.log(R(2,f))/Math.LN10*2+5|0,c+=r,n=o=s=new m(1),m.precision=c;;){if(o=T(o.times(e),c,1),n=n.times(++l),a=s.plus(I(o,n,c,1)),M(a.d).slice(0,c)===M(s.d).slice(0,c)){for(i=f;i--;)s=T(s.times(s),c,1);if(t==null)if(u<3&&we(s.d,c-r,g,u))m.precision=c+=10,n=o=a=new m(1),l=0,u++;else return T(s,m.precision=b,g,x=!0);else return m.precision=b,s}s=a}}function ne(e,t){var n,r,i,o,s,a,c,u,l,f,m,g=1,b=10,d=e,w=d.d,h=d.constructor,A=h.rounding,y=h.precision;if(d.s<0||!w||!w[0]||!d.e&&w[0]==1&&w.length==1)return new h(w&&!w[0]?-1/0:d.s!=1?NaN:w?0:d);if(t==null?(x=!1,l=y):l=t,h.precision=l+=b,n=M(w),r=n.charAt(0),Math.abs(o=d.e)<15e14){for(;r<7&&r!=1||r==1&&n.charAt(1)>3;)d=d.times(e),n=M(d.d),r=n.charAt(0),g++;o=d.e,r>1?(d=new h("0."+n),o++):d=new h(r+"."+n.slice(1))}else return u=ve(h,l+2,y).times(o+""),d=ne(new h(r+"."+n.slice(1)),l-b).plus(u),h.precision=y,t==null?T(d,y,A,x=!0):d;for(f=d,c=s=d=I(d.minus(1),d.plus(1),l,1),m=T(d.times(d),l,1),i=3;;){if(s=T(s.times(m),l,1),u=c.plus(I(s,new h(i),l,1)),M(u.d).slice(0,l)===M(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(ve(h,l+2,y).times(o+""))),c=I(c,new h(g),l,1),t==null)if(we(c.d,l-b,A,a))h.precision=l+=b,u=s=d=I(f.minus(1),f.plus(1),l,1),m=T(d.times(d),l,1),i=a=1;else return T(c,h.precision=y,A,x=!0);else return h.precision=y,c;c=u,i+=2}}function qt(e){return String(e.s*e.s/0)}function rt(e,t){var n,r,i;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(n<0&&(n=r),n+=+t.slice(r+1),t=t.substring(0,r)):n<0&&(n=t.length),r=0;t.charCodeAt(r)===48;r++);for(i=t.length;t.charCodeAt(i-1)===48;--i);if(t=t.slice(r,i),t){if(i-=r,e.e=n=n-r-1,e.d=[],r=(n+1)%P,n<0&&(r+=P),r<i){for(r&&e.d.push(+t.slice(0,r)),i-=P;r<i;)e.d.push(+t.slice(r,r+=P));t=t.slice(r),r=P-t.length}else r-=i;for(;r--;)t+="0";e.d.push(+t),x&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function Bn(e,t){var n,r,i,o,s,a,c,u,l;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),Kt.test(t))return rt(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(Tn.test(t))n=16,t=t.toLowerCase();else if(wn.test(t))n=2;else if(Pn.test(t))n=8;else throw Error(re+t);for(o=t.search(/p/i),o>0?(c=+t.slice(o+1),t=t.substring(2,o)):t=t.slice(2),o=t.indexOf("."),s=o>=0,r=e.constructor,s&&(t=t.replace(".",""),a=t.length,o=a-o,i=Wt(r,new r(n),o,o*2)),u=Oe(t,n,Z),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new r(e.s*0):(e.e=Ke(u,l),e.d=u,x=!1,s&&(e=I(e,i,a*4)),c&&(e=e.times(Math.abs(c)<54?R(2,c):We.pow(2,c))),x=!0,e)}function kn(e,t){var n,r=t.d.length;if(r<3)return t.isZero()?t:me(e,2,t,t);n=1.4*Math.sqrt(r),n=n>16?16:n|0,t=t.times(1/Ve(5,n)),t=me(e,2,t,t);for(var i,o=new e(5),s=new e(16),a=new e(20);n--;)i=t.times(t),t=t.times(o.plus(i.times(s.times(i).minus(a))));return t}function me(e,t,n,r,i){var o,s,a,c,u=1,l=e.precision,f=Math.ceil(l/P);for(x=!1,c=n.times(n),a=new e(r);;){if(s=I(a.times(c),new e(t++*t++),l,1),a=i?r.plus(s):r.minus(s),r=I(s.times(c),new e(t++*t++),l,1),s=a.plus(r),s.d[f]!==void 0){for(o=f;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=r,r=s,s=o,u++}return x=!0,s.d.length=f+1,s}function Ve(e,t){for(var n=e;--t;)n*=e;return n}function Gt(e,t){var n,r=t.s<0,i=Y(e,e.precision,1),o=i.times(.5);if(t=t.abs(),t.lte(o))return Q=r?4:1,t;if(n=t.divToInt(i),n.isZero())Q=r?3:2;else{if(t=t.minus(n.times(i)),t.lte(o))return Q=Et(n)?r?2:3:r?4:1,t;Q=Et(n)?r?1:4:r?3:2}return t.minus(i).abs()}function it(e,t,n,r){var i,o,s,a,c,u,l,f,m,g=e.constructor,b=n!==void 0;if(b?(q(n,1,ie),r===void 0?r=g.rounding:q(r,0,8)):(n=g.precision,r=g.rounding),!e.isFinite())l=qt(e);else{for(l=J(e),s=l.indexOf("."),b?(i=2,t==16?n=n*4-3:t==8&&(n=n*3-2)):i=t,s>=0&&(l=l.replace(".",""),m=new g(1),m.e=l.length-s,m.d=Oe(J(m),10,i),m.e=m.d.length),f=Oe(l,10,i),o=c=f.length;f[--c]==0;)f.pop();if(!f[0])l=b?"0p+0":"0";else{if(s<0?o--:(e=new g(e),e.d=f,e.e=o,e=I(e,m,n,r,0,i),f=e.d,o=e.e,u=Mt),s=f[n],a=i/2,u=u||f[n+1]!==void 0,u=r<4?(s!==void 0||u)&&(r===0||r===(e.s<0?3:2)):s>a||s===a&&(r===4||u||r===6&&f[n-1]&1||r===(e.s<0?8:7)),f.length=n,u)for(;++f[--n]>i-1;)f[n]=0,n||(++o,f.unshift(1));for(c=f.length;!f[c-1];--c);for(s=0,l="";s<c;s++)l+=$e.charAt(f[s]);if(b){if(c>1)if(t==16||t==8){for(s=t==16?4:3,--c;c%s;c++)l+="0";for(f=Oe(l,i,t),c=f.length;!f[c-1];--c);for(s=1,l="1.";s<c;s++)l+=$e.charAt(f[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(t==16?"0x":t==2?"0b":t==8?"0o":"")+l}return e.s<0?"-"+l:l}function Rt(e,t){if(e.length>t)return e.length=t,!0}function Nn(e){return new this(e).abs()}function Ln(e){return new this(e).acos()}function In(e){return new this(e).acosh()}function Cn(e,t){return new this(e).plus(t)}function Dn(e){return new this(e).asin()}function En(e){return new this(e).asinh()}function Rn(e){return new this(e).atan()}function On(e){return new this(e).atanh()}function Mn(e,t){e=new this(e),t=new this(t);var n,r=this.precision,i=this.rounding,o=r+4;return!e.s||!t.s?n=new this(NaN):!e.d&&!t.d?(n=Y(this,o,1).times(t.s>0?.25:.75),n.s=e.s):!t.d||e.isZero()?(n=t.s<0?Y(this,r,i):new this(0),n.s=e.s):!e.d||t.isZero()?(n=Y(this,o,1).times(.5),n.s=e.s):t.s<0?(this.precision=o,this.rounding=1,n=this.atan(I(e,t,o,1)),t=Y(this,o,1),this.precision=r,this.rounding=i,n=e.s<0?n.minus(t):n.plus(t)):n=this.atan(I(e,t,o,1)),n}function Fn(e){return new this(e).cbrt()}function vn(e){return T(e=new this(e),e.e+1,2)}function _n(e,t,n){return new this(e).clamp(t,n)}function Kn(e){if(!e||typeof e!="object")throw Error(_e+"Object expected");var t,n,r,i=e.defaults===!0,o=["precision",1,ie,"rounding",0,8,"toExpNeg",-fe,0,"toExpPos",0,fe,"maxE",0,fe,"minE",-fe,0,"modulo",0,9];for(t=0;t<o.length;t+=3)if(n=o[t],i&&(this[n]=et[n]),(r=e[n])!==void 0)if(v(r)===r&&r>=o[t+1]&&r<=o[t+2])this[n]=r;else throw Error(re+n+": "+r);if(n="crypto",i&&(this[n]=et[n]),(r=e[n])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error(vt);else this[n]=!1;else throw Error(re+n+": "+r);return this}function Vn(e){return new this(e).cos()}function Wn(e){return new this(e).cosh()}function Ht(e){var t,n,r;function i(o){var s,a,c,u=this;if(!(u instanceof i))return new i(o);if(u.constructor=i,Ot(o)){u.s=o.s,x?!o.d||o.e>i.maxE?(u.e=NaN,u.d=null):o.e<i.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;x?s>i.maxE?(u.e=NaN,u.d=null):s<i.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return rt(u,o.toString())}else if(c!=="string")throw Error(re+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),Kt.test(o)?rt(u,o):Bn(u,o)}if(i.prototype=p,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=Kn,i.clone=Ht,i.isDecimal=Ot,i.abs=Nn,i.acos=Ln,i.acosh=In,i.add=Cn,i.asin=Dn,i.asinh=En,i.atan=Rn,i.atanh=On,i.atan2=Mn,i.cbrt=Fn,i.ceil=vn,i.clamp=_n,i.cos=Vn,i.cosh=Wn,i.div=Un,i.exp=qn,i.floor=Gn,i.hypot=Hn,i.ln=jn,i.log=zn,i.log10=Zn,i.log2=Yn,i.max=Jn,i.min=Xn,i.mod=Qn,i.mul=$n,i.pow=er,i.random=tr,i.round=nr,i.sign=rr,i.sin=ir,i.sinh=or,i.sqrt=sr,i.sub=ar,i.sum=ur,i.tan=cr,i.tanh=lr,i.trunc=fr,e===void 0&&(e={}),e&&e.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<r.length;)e.hasOwnProperty(n=r[t++])||(e[n]=this[n]);return i.config(e),i}function Un(e,t){return new this(e).div(t)}function qn(e){return new this(e).exp()}function Gn(e){return T(e=new this(e),e.e+1,3)}function Hn(){var e,t,n=new this(0);for(x=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)n.d&&(n=n.plus(t.times(t)));else{if(t.s)return x=!0,new this(1/0);n=t}return x=!0,n.sqrt()}function Ot(e){return e instanceof We||e&&e.toStringTag===_t||!1}function jn(e){return new this(e).ln()}function zn(e,t){return new this(e).log(t)}function Yn(e){return new this(e).log(2)}function Zn(e){return new this(e).log(10)}function Jn(){return Ut(this,arguments,"lt")}function Xn(){return Ut(this,arguments,"gt")}function Qn(e,t){return new this(e).mod(t)}function $n(e,t){return new this(e).mul(t)}function er(e,t){return new this(e).pow(t)}function tr(e){var t,n,r,i,o=0,s=new this(1),a=[];if(e===void 0?e=this.precision:q(e,1,ie),r=Math.ceil(e/P),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(r));o<r;)i=t[o],i>=429e7?t[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(r*=4);o<r;)i=t[o]+(t[o+1]<<8)+(t[o+2]<<16)+((t[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(t,o):(a.push(i%1e7),o+=4);o=r/4}else throw Error(vt);else for(;o<r;)a[o++]=Math.random()*1e7|0;for(r=a[--o],e%=P,r&&e&&(i=R(10,P-e),a[o]=(r/i|0)*i);a[o]===0;o--)a.pop();if(o<0)n=0,a=[0];else{for(n=-1;a[0]===0;n-=P)a.shift();for(r=1,i=a[0];i>=10;i/=10)r++;r<P&&(n-=P-r)}return s.e=n,s.d=a,s}function nr(e){return T(e=new this(e),e.e+1,this.rounding)}function rr(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function ir(e){return new this(e).sin()}function or(e){return new this(e).sinh()}function sr(e){return new this(e).sqrt()}function ar(e,t){return new this(e).sub(t)}function ur(){var e=0,t=arguments,n=new this(t[e]);for(x=!1;n.s&&++e<t.length;)n=n.plus(t[e]);return x=!0,T(n,this.precision,this.rounding)}function cr(e){return new this(e).tan()}function lr(e){return new this(e).tanh()}function fr(e){return T(e=new this(e),e.e+1,1)}p[Symbol.for("nodejs.util.inspect.custom")]=p.toString;p[Symbol.toStringTag]="Decimal";var We=p.constructor=Ht(et);Me=new We(Me);Fe=new We(Fe);import{PublicKey as st}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as mr}from"@solana/spl-token";import{PublicKey as E,SystemProgram as dr,SYSVAR_RENT_PUBKEY as pr}from"@solana/web3.js";function ot({pubkey:e,isSigner:t=!1,isWritable:n=!0}){return{pubkey:e,isWritable:n,isSigner:t}}var ri=[ot({pubkey:mr,isWritable:!1}),ot({pubkey:dr.programId,isWritable:!1}),ot({pubkey:pr,isWritable:!1})];function zt({publicKey:e,transformSol:t}){let n=Yt(e.toString());if(n instanceof E)return t&&n.equals(Te)?jt:n;if(t&&n.toString()===Te.toBase58())return jt;if(typeof n=="string"){if(n===E.default.toBase58())return E.default;try{return new E(n)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Yt(e){try{return new E(e)}catch{return e}}var ii=new E("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),oi=new E("SysvarRent111111111111111111111111111111111"),si=new E("SysvarC1ock11111111111111111111111111111111"),ai=new E("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ui=new E("Sysvar1nstructions1111111111111111111111111"),ci=new E("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),li=new E("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),fi=new E("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),mi=new E("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),di=new E("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),pi=new E("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),gi=new E("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),hi=new E("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),bi=new E("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),yi=new E("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),wi=new E("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),jt=new E("So11111111111111111111111111111111111111112"),Te=E.default;import{PublicKey as gr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Zt}from"@solana/spl-token";var Jt={chainId:101,address:gr.default.toBase58(),programId:Zt.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ae={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Zt.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var at=class{constructor({mint:t,decimals:n,symbol:r,name:i,skipMint:o=!1,isToken2022:s=!1}){if(t===Te.toBase58()||t instanceof st&&Te.equals(t)){this.decimals=ae.decimals,this.symbol=ae.symbol,this.name=ae.name,this.mint=new st(ae.address),this.isToken2022=!1;return}this.decimals=n,this.symbol=r||t.toString().substring(0,6),this.name=i||t.toString().substring(0,6),this.mint=o?st.default:zt({publicKey:t}),this.isToken2022=s}equals(t){return this===t?!0:this.mint.equals(t.mint)}},z=at;z.WSOL=new at(ee(V({},ae),{mint:ae.address}));import qe from"big.js";import yr from"bn.js";import wr from"decimal.js-light";import hr from"toformat";var br=hr,Pe=br;var Ue=U("module/fraction"),ut=Pe(qe),xe=Pe(wr),Tr={[0]:xe.ROUND_DOWN,[1]:xe.ROUND_HALF_UP,[2]:xe.ROUND_UP},Pr={[0]:qe.roundDown,[1]:qe.roundHalfUp,[2]:qe.roundUp},D=class{constructor(t,n=new yr(1)){this.numerator=oe(t),this.denominator=oe(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new D(this.denominator,this.numerator)}add(t){let n=t instanceof D?t:new D(oe(t));return this.denominator.eq(n.denominator)?new D(this.numerator.add(n.numerator),this.denominator):new D(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(t){let n=t instanceof D?t:new D(oe(t));return this.denominator.eq(n.denominator)?new D(this.numerator.sub(n.numerator),this.denominator):new D(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(t){let n=t instanceof D?t:new D(oe(t));return new D(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(t){let n=t instanceof D?t:new D(oe(t));return new D(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(t,n={groupSeparator:""},r=1){Number.isInteger(t)||Ue.logWithError(`${t} is not an integer.`),t<=0&&Ue.logWithError(`${t} is not positive.`),xe.set({precision:t+1,rounding:Tr[r]});let i=new xe(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return i.toFormat(i.decimalPlaces(),n)}toFixed(t,n={groupSeparator:""},r=1){return Number.isInteger(t)||Ue.logWithError(`${t} is not an integer.`),t<0&&Ue.logWithError(`${t} is negative.`),ut.DP=t,ut.RM=Pr[r]||1,new ut(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,n)}isZero(){return this.numerator.isZero()}};var Hi=U("Raydium_price");var ct=class{constructor({decimals:t,symbol:n="UNKNOWN",name:r="UNKNOWN"}){this.decimals=t,this.symbol=n,this.name=r}equals(t){return this===t}},Ge=ct;Ge.SOL=new ct(Jt);import Ar from"bn.js";var $i=new D(new Ar(100));var Sr=new G(0),To=new G(1),Po=new G(2),xo=new G(3),Ao=new G(5),Br=new G(10),So=new G(100),Bo=new G(1e3),ko=new G(1e4),en=9007199254740991;function oe(e){let t=U("Raydium_parseBigNumberish");if(e instanceof G)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new G(e);t.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&t.logWithError(`BigNumberish number underflow: ${e}`),(e>=en||e<=-en)&&t.logWithError(`BigNumberish number overflow: ${e}`),new G(String(e))):typeof e=="bigint"?new G(e.toString()):(t.error(`invalid BigNumberish value: ${e}`),new G(0))}var Vo=U("Raydium_amount"),Wo=Pe(kr);function lt(e,t=1,n=[]){let r=[...e];if(t<=0)return n;for(;r.length;)n.push(r.splice(0,t));return n}import{PublicKey as H}from"@solana/web3.js";var us=new H("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),cs=new H("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),ls=new H("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),fs=new H("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),ms=new H("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),ds=new H("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ps=new H("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),gs=new H("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),hs=new H("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),bs=new H("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),ys=new H("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),ws=new H("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Ts=new H("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Ps=new H("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi");import{PublicKey as Ss}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ns}from"@solana/spl-token";import Cs from"bn.js";var ft=U("Raydium_accountInfo_util");async function He(e,t,n){let{batchRequest:r,commitment:i="confirmed"}=V({batchRequest:!1},n),o=lt(t,100),s=new Array(o.length).fill([]);if(r){let a=o.map(l=>{let f=e._buildArgs([l.map(m=>m.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:f}}),c=lt(a,10);s=(await(await Promise.all(c.map(async l=>await e._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&ft.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(f=>{if(f){let{data:m,executable:g,lamports:b,owner:d,rentEpoch:w}=f;return m.length!==2&&m[1]!=="base64"&&ft.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(m[0],"base64"),executable:g,lamports:b,owner:new Nr(d),rentEpoch:w}}return null})))}else try{s=await Promise.all(o.map(a=>e.getMultipleAccountsInfo(a,i)))}catch(a){a instanceof Error&&ft.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function mt({connection:e,address:t}){let n=await He(e,[...new Set(t.map(i=>i.toString()))].map(i=>new tn(i))),r={};for(let i=0;i<t.length;i++){let o=n[i],s=t[i];if(!o)continue;let a=new je({key:s,state:je.deserialize(o.data)});r[s.toString()]=a,ze[s.toString()]=a}return r}var ze={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new je({key:new tn("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:je.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var Ye=class{constructor(t){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let t=(await Lr.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:n}=(r=t==null?void 0:t[15])!=null?r:{};if(!!n)return{units:6e5,microLamports:Math.min(Math.ceil(n*1e6/6e5),25e3)}}addCustomComputeBudget(t){if(t){let{instructions:n,instructionTypes:r}=Ee(t);return this.instructions.unshift(...n),this.instructionTypes.unshift(...r),!0}return!1}async calComputeBudget({config:t,defaultIns:n}){try{let r=t||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;n&&this.instructions.unshift(...n)}catch{n&&this.instructions.unshift(...n)}}addInstruction({instructions:t=[],endInstructions:n=[],signers:r=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...t),this.endInstructions.push(...n),this.signers.push(...r),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Ae.default.toString())),this}async versionBuild({txVersion:t,extInfo:n}){return t===0?await this.buildV0(V({},n||{})):this.build(n)}build(t){let n=new Se;return this.allInstructions.length&&n.add(...this.allInstructions),n.feePayer=this.feePayer,{builder:this,transaction:n,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async()=>{var i;let r=await le(this.connection);if(n.recentBlockhash=r,this.signers.length&&n.sign(...this.signers),se([n]),(i=this.owner)!=null&&i.isKeyPair)return{txId:await dt(this.connection,n,this.signers),signedTx:n};if(this.signAllTransactions){let o=await this.signAllTransactions([n]);return{txId:await this.connection.sendRawTransaction(o[0].serialize(),{skipPreflight:!0}),signedTx:o[0]}}throw new Error("please connect wallet first")},extInfo:t||{}}}buildMultiTx(t){let{extraPreBuildData:n=[],extInfo:r}=t,{transaction:i}=this.build(r),o=n.filter(u=>u.transaction.instructions.length>0),s=[i,...o.map(u=>u.transaction)],a=[this.signers,...o.map(u=>u.signers)],c=[...this.instructionTypes,...o.map(u=>u.instructionTypes).flat()];return{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async u=>{var g;let{sequentially:l,onTxUpdate:f}=u||{},m=await le(this.connection);if((g=this.owner)!=null&&g.isKeyPair)return{txIds:await await Promise.all(s.map(async(b,d)=>(b.recentBlockhash=m,await dt(this.connection,b,a[d])))),signedTxs:s};if(this.signAllTransactions){let b=s.map((w,h)=>(w.recentBlockhash=m,a[h].length&&w.sign(...a[h]),w));se(b);let d=await this.signAllTransactions(b);if(l){let w=0,h=[],A=async()=>{if(!d[w])return;let y=await this.connection.sendRawTransaction(d[w].serialize(),{skipPreflight:!0});h.push({txId:y,status:"sent"}),f==null||f([...h]),w++,this.connection.onSignature(y,B=>{let S=h.findIndex(k=>k.txId===y);S>-1&&(h[S].status=B.err?"error":"success"),f==null||f([...h]),A()},"processed"),this.connection.getSignatureStatus(y)};return await A(),{txIds:h.map(y=>y.txId),signedTxs:d}}else{let w=[];for(let h=0;h<d.length;h+=1){let A=await this.connection.sendRawTransaction(d[h].serialize(),{skipPreflight:!0});w.push(A)}return{txIds:w,signedTxs:d}}}throw new Error("please connect wallet first")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:t,txVersion:n,extInfo:r}){return n===0?await this.buildV0MultiTx({extraPreBuildData:t,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:t,extInfo:r})}async buildV0(t){let m=t||{},{lookupTableCache:n={},lookupTableAddress:r=[],forerunCreate:i}=m,o=De(m,["lookupTableCache","lookupTableAddress","forerunCreate"]),s=V(V({},ze),n),a=Array.from(new Set([...r,...this.lookupTableAddress])),c=[];for(let g of a)s[g]===void 0&&c.push(new Ae(g));let u=await mt({connection:this.connection,address:c});for(let[g,b]of Object.entries(u))s[g]=b;let l=new Be({payerKey:this.feePayer,recentBlockhash:i?Ae.default.toBase58():await le(this.connection),instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s)),f=new ke(l);return f.sign(this.signers),{builder:this,transaction:f,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async()=>{var g;if(se([f]),(g=this.owner)!=null&&g.isKeyPair)return f.sign([this.owner.signer]),{txId:await this.connection.sendTransaction(f,{skipPreflight:!0}),signedTx:f};if(this.signAllTransactions){let b=await this.signAllTransactions([f]);return{txId:await this.connection.sendTransaction(b[0],{skipPreflight:!0}),signedTx:b[0]}}throw new Error("please connect wallet first")},extInfo:o||{}}}async buildV0MultiTx(t){let{extraPreBuildData:n=[],buildProps:r}=t,{transaction:i}=await this.buildV0(r),o=n.filter(u=>u.builder.instructions.length>0),s=[i,...o.map(u=>u.transaction)],a=[this.signers,...o.map(u=>u.signers)],c=[...this.instructionTypes,...o.map(u=>u.instructionTypes).flat()];return s.forEach(async(u,l)=>{u.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:r,execute:async u=>{var m;se(s);let{sequentially:l,onTxUpdate:f}=u||{};if((m=this.owner)!=null&&m.isKeyPair)return s.forEach(g=>g.sign([this.owner.signer])),{txIds:await Promise.all(s.map(async g=>await this.connection.sendTransaction(g))),signedTxs:s};if(this.signAllTransactions){let g=await this.signAllTransactions(s);if(l){let b=0,d=[],w=async()=>{if(!g[b])return;let h=await this.connection.sendTransaction(g[b],{skipPreflight:!0});d.push({txId:h,status:"sent"}),f==null||f([...d]),b++,this.connection.onSignature(h,A=>{let y=d.findIndex(B=>B.txId===h);y>-1&&(d[y].status=A.err?"error":"success"),f==null||f([...d]),w()},"processed"),this.connection.getSignatureStatus(h)};return w(),{txIds:[],signedTxs:g}}else{let b=[];for(let d=0;d<g.length;d+=1){let w=await this.connection.sendTransaction(g[d],{skipPreflight:!0});b.push(w)}return{txIds:b,signedTxs:g}}}throw new Error("please connect wallet first")},extInfo:r||{}}}async sizeCheckBuild(t){let u=t||{},{autoComputeBudget:n=!1}=u,r=De(u,["autoComputeBudget"]),i={instructions:[],instructionTypes:[]};if(n){let l=n?await this.getComputeBudgetConfig():void 0;i=n&&l?Ee(l):{instructions:[],instructionTypes:[]}}let o=this.signers.reduce((l,f)=>ee(V({},l),{[f.publicKey.toBase58()]:f}),{}),s=[],a=[],c=[];if(this.allInstructions.forEach(l=>{let f=[...c,l],m=n?[...i.instructions,...f]:f,b=[...new Set(f.map(d=>d.keys.filter(w=>w.isSigner).map(w=>w.pubkey.toString())).flat()).values()].map(d=>new Ae(d));if(c.length<12&&be({instructions:m,payer:this.feePayer,signers:b})||be({instructions:f,payer:this.feePayer,signers:b}))c.push(l);else{if(c.length===0)throw Error("item ins too big");be({instructions:n?[...i.instructions,...c]:[...c],payer:this.feePayer,signers:b})?s.push(new Se().add(...i.instructions,...c)):s.push(new Se().add(...c)),a.push(Array.from(new Set(c.map(d=>d.keys.filter(w=>w.isSigner).map(w=>w.pubkey.toString())).flat())).map(d=>o[d]).filter(d=>d!==void 0)),c=[l]}}),c.length>0){let f=[...new Set(c.map(m=>m.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(m=>o[m]).filter(m=>m!==void 0);be({instructions:n?[...i.instructions,...c]:[...c],payer:this.feePayer,signers:f.map(m=>m.publicKey)})?s.push(new Se().add(...i.instructions,...c)):s.push(new Se().add(...c)),a.push(f)}return s.forEach(l=>l.feePayer=this.feePayer),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async l=>{var b;let{sequentially:f,onTxUpdate:m}=l||{},g=await le(this.connection);if(s.forEach(async(d,w)=>{d.recentBlockhash=g,a[w].length&&d.sign(...a[w])}),se(s),(b=this.owner)!=null&&b.isKeyPair)return{txIds:await Promise.all(s.map(async(d,w)=>await dt(this.connection,d,a[w]))),signedTxs:s};if(this.signAllTransactions){let d=await this.signAllTransactions(s);if(f){let w=0,h=[],A=async()=>{if(!d[w])return;let y=await this.connection.sendRawTransaction(d[w].serialize(),{skipPreflight:!0});h.push({txId:y,status:"sent"}),m==null||m([...h]),w++,this.connection.onSignature(y,B=>{let S=h.findIndex(k=>k.txId===y);S>-1&&(h[S].status=B.err?"error":"success"),m==null||m([...h]),A()},"processed"),this.connection.getSignatureStatus(y)};return await A(),{txIds:h.map(y=>y.txId),signedTxs:d}}else{let w=[];for(let h=0;h<d.length;h+=1){let A=await this.connection.sendRawTransaction(d[h].serialize(),{skipPreflight:!0});w.push(A)}return{txIds:w,signedTxs:d}}}throw new Error("please connect wallet first")},extInfo:r||{}}}async sizeCheckBuildV0(t){let w=t||{},{autoComputeBudget:n=!1,lookupTableCache:r={},lookupTableAddress:i=[]}=w,o=De(w,["autoComputeBudget","lookupTableCache","lookupTableAddress"]),s=V(V({},ze),r),a=Array.from(new Set([...this.lookupTableAddress,...i])),c=[];for(let h of a)s[h]===void 0&&c.push(new Ae(h));let u=await mt({connection:this.connection,address:c});for(let[h,A]of Object.entries(u))s[h]=A;let l={instructions:[],instructionTypes:[]};if(n){let h=n?await this.getComputeBudgetConfig():void 0;l=n&&h?Ee(h):{instructions:[],instructionTypes:[]}}let f=await le(this.connection),m=this.signers.reduce((h,A)=>ee(V({},h),{[A.publicKey.toBase58()]:A}),{}),g=[],b=[],d=[];if(this.allInstructions.forEach(h=>{let A=[...d,h],y=n?[...l.instructions,...A]:A;if(d.length<12&&ye({instructions:y,payer:this.feePayer,lookupTableAddressAccount:s})||ye({instructions:A,payer:this.feePayer,lookupTableAddressAccount:s}))d.push(h);else{if(d.length===0)throw Error("item ins too big");let B={};for(let S of[...new Set(a)])s[S]!==void 0&&(B[S]=s[S]);if(n&&ye({instructions:[...l.instructions,...d],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:f})){let S=new Be({payerKey:this.feePayer,recentBlockhash:f,instructions:[...l.instructions,...d]}).compileToV0Message(Object.values(s));g.push(new ke(S))}else{let S=new Be({payerKey:this.feePayer,recentBlockhash:f,instructions:[...d]}).compileToV0Message(Object.values(s));g.push(new ke(S))}b.push(Array.from(new Set(d.map(S=>S.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat())).map(S=>m[S]).filter(S=>S!==void 0)),d=[h]}}),d.length>0){let A=[...new Set(d.map(y=>y.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat()).values()].map(y=>m[y]).filter(y=>y!==void 0);if(n&&ye({instructions:[...l.instructions,...d],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:f})){let y=new Be({payerKey:this.feePayer,recentBlockhash:f,instructions:[...l.instructions,...d]}).compileToV0Message(Object.values(s));g.push(new ke(y))}else{let y=new Be({payerKey:this.feePayer,recentBlockhash:f,instructions:[...d]}).compileToV0Message(Object.values(s));g.push(new ke(y))}b.push(A)}return{builder:this,transactions:g,buildProps:t,signers:b,instructionTypes:this.instructionTypes,execute:async h=>{var B;let{sequentially:A,onTxUpdate:y}=h||{};if(g.map(async(S,k)=>{b[k].length&&S.sign(b[k])}),se(g),(B=this.owner)!=null&&B.isKeyPair)return{txIds:await Promise.all(g.map(async S=>await this.connection.sendTransaction(S,{skipPreflight:!0}))),signedTxs:g};if(this.signAllTransactions){let S=await this.signAllTransactions(g);if(A){let k=0,K=[],O=async()=>{if(!S[k])return;let j=await this.connection.sendTransaction(S[k],{skipPreflight:!0});K.push({txId:j,status:"sent"}),y==null||y([...K]),k++,this.connection.onSignature(j,he=>{let W=K.findIndex(ce=>ce.txId===j);W>-1&&(K[W].status=he.err?"error":"success"),y==null||y([...K]),O()},"processed"),this.connection.getSignatureStatus(j)};return O(),{txIds:[],signedTxs:S}}else{let k=[];for(let K=0;K<S.length;K+=1){let O=await this.connection.sendTransaction(S[K],{skipPreflight:!0});k.push(O)}return{txIds:k,signedTxs:S}}}throw new Error("please connect wallet first")},extInfo:o||{}}}};var pt=(...e)=>e.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),Ne=class{constructor({scope:t,moduleName:n}){this.disabled=!1;this.scope=t,this.logger=U(n)}createTxBuilder(t){return this.scope.checkOwner(),new Ye({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(pt(t))}logInfo(...t){this.logger.info(pt(t))}logAndCreateError(...t){let n=pt(t);throw new Error(n)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as Or}from"@solana/web3.js";import sn,{isBN as an}from"bn.js";import{bits as Ba,BitStructure as ka,blob as Ir,Blob as Na,cstr as La,f32 as Ia,f32be as Ca,f64 as Da,f64be as Ea,greedy as Ra,Layout as Cr,ns64 as Oa,ns64be as Ma,nu64 as Fa,nu64be as va,offset as _a,s16 as Ka,s16be as Va,s24 as Wa,s24be as Ua,s32 as qa,s32be as Ga,s40 as Ha,s40be as ja,s48 as za,s48be as Ya,s8 as Za,seq as Dr,struct as Ja,Structure as Er,u16 as Xa,u16be as Qa,u24 as $a,u24be as eu,u32 as tu,u32be as nu,u40 as ru,u40be as iu,u48 as ou,u48be as su,u8 as au,UInt as Rr,union as uu,Union as cu,unionLayoutDiscriminator as lu,utf8 as fu}from"@solana/buffer-layout";var gt=Cr,nn=Er;var rn=Rr;var on=Dr;var de=Ir;var ht=class extends gt{constructor(n,r,i){super(n,i);this.blob=de(n),this.signed=r}decode(n,r=0){let i=new sn(this.blob.decode(n,r),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(n,r,i=0){return typeof n=="number"&&(n=new sn(n)),this.signed&&(n=n.toTwos(this.span*8)),this.blob.encode(n.toArrayLike(Buffer,"le",this.span),r,i)}};function pe(e){return new rn(1,e)}function X(e){return new ht(8,!1,e)}var bt=class extends gt{constructor(n,r,i,o){super(n.span,o);this.layout=n,this.decoder=r,this.encoder=i}decode(n,r){return this.decoder(this.layout.decode(n,r))}encode(n,r,i){return this.layout.encode(this.encoder(n),r,i)}getSpan(n,r){return this.layout.getSpan(n,r)}};function ue(e){return new bt(de(32),t=>new Or(t),t=>t.toBuffer(),e)}var yt=class extends nn{decode(t,n){return super.decode(t,n)}};function ge(e,t,n){return new yt(e,t,n)}function Le(e,t,n){let r,i=typeof t=="number"?t:an(t)?t.toNumber():new Proxy(t,{get(o,s){if(!r){let a=Reflect.get(o,"count");r=an(a)?a.toNumber():a,Reflect.set(o,"count",r)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(r=a),Reflect.set(o,s,a)}});return on(e,i,n)}var _=class extends Ne{static getPdaPoolId(t,n){return Re([_.SEED_CONFIG.pool.id,n.toBuffer()],t)}static getPdaOwnerId(t,n,r,i){return Re([_.SEED_CONFIG.owner.id,n.toBuffer(),r.toBuffer(),Buffer.from(new un(i).toArray())],t)}static async getAllInfo({connection:t,programId:n,poolIds:r,wallet:i,chainTime:o}){if(r.length===0)return[];let s=r.map(l=>_.getPdaPoolId(n,l).publicKey),a=[];for(let l=0;l<_.VERSION_PROJECT.length;l++)a.push(...s.map(f=>_.getPdaOwnerId(n,f,i,l).publicKey));let c=await He(t,[...s,...a]),u=[];for(let l=0;l<c.length;l++){let f=Math.floor(l/r.length),m=l%r.length,g=s[m],b=a[l],d=c[m],w=c[r.length+l];if(!(d&&w)||d.data.length!==_.POOL_LAYOUT.span||w.data.length!==_.OWNER_LAYOUT.span)continue;let h=_.POOL_LAYOUT.decode(d.data),A=_.OWNER_LAYOUT.decode(w.data),y=h.openTime.toNumber(),B=h.endTime.toNumber(),S=A.tokenInfo.map(O=>O.debtAmount.gt(new un(0))).filter(O=>!O).length!==3,k=o>y&&o<B&&h.status===1,K=S&&k;u.push({programId:n,poolId:g,ammId:h.ammId,ownerAccountId:b,snapshotLpAmount:A.lpAmount,project:_.VERSION_PROJECT[f],openTime:y,endTime:B,canClaim:K,canClaimErrorType:S?k?void 0:"outOfOperationalTime":"alreadyClaimIt",tokenInfo:h.tokenInfo.map((O,j)=>({mintAddress:O.mintAddress,mintVault:O.mintVault,mintDecimals:O.mintDecimals,perLpLoss:O.perLpLoss,debtAmount:A.tokenInfo[j].debtAmount.add(A.tokenInfo[j].claimedAmount)}))})}return u}async makeClaimTransaction({poolInfo:t,ownerInfo:n}){n.wallet||this.scope.checkOwner();let r=this.createTxBuilder(),i=n.wallet||this.scope.ownerPubKey,o=[];for(let c of t.tokenInfo){let{account:u,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({mint:c.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:c.mintAddress.equals(z.WSOL.mint),createInfo:{payer:i,amount:0},skipCloseAccount:!c.mintAddress.equals(z.WSOL.mint),associatedOnly:c.mintAddress.equals(z.WSOL.mint)?!1:n.associatedOnly});l&&r.addInstruction(l),o.push(u)}r.addInstruction({instructions:[_.makeClaimInstruction({programId:t.programId,poolInfo:t,ownerInfo:{wallet:i,ownerPda:t.ownerAccountId,claimAddress:o}})]});let{transaction:s,signers:a}=r.build();return[{transaction:s,signer:a}]}async makeClaimAllTransaction({poolInfos:t,ownerInfo:n}){let r=this.createTxBuilder(),i=n.wallet||this.scope.ownerPubKey,o={};for(let u of t){let l=[];for(let f of u.tokenInfo){let{account:m,instructionParams:g}=await this.scope.account.getOrCreateTokenAccount({mint:f.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:f.mintAddress.equals(z.WSOL.mint),createInfo:{payer:i,amount:0},skipCloseAccount:!f.mintAddress.equals(z.WSOL.mint),associatedOnly:f.mintAddress.equals(z.WSOL.mint)?!1:n.associatedOnly});g&&r.addInstruction(g),m&&(o[f.mintAddress.toString()]=m,l.push(m))}r.addInstruction({instructions:[_.makeClaimInstruction({programId:u.programId,poolInfo:u,ownerInfo:{wallet:i,ownerPda:u.ownerAccountId,claimAddress:l}})]})}let{transaction:s,signers:a}=r.build(),c=r.allInstructions;return Qe(c,[i,...a.map(u=>u.publicKey)])?[{transaction:s,signer:a}]:[{transaction:new wt().add(...c.slice(0,r.AllTxData.instructions.length-1)),signer:a},{transaction:new wt().add(...c.slice(r.AllTxData.instructions.length-1)),signer:[]},{transaction:new wt().add(...r.AllTxData.endInstructions),signer:[]}]}static makeClaimInstruction({programId:t,poolInfo:n,ownerInfo:r}){let i=ge([]),o=[{pubkey:r.wallet,isSigner:!0,isWritable:!0},{pubkey:n.poolId,isSigner:!1,isWritable:!0},{pubkey:r.ownerPda,isSigner:!1,isWritable:!0},...r.claimAddress.map(c=>({pubkey:c,isSigner:!1,isWritable:!0})),...n.tokenInfo.map(({mintVault:c})=>({pubkey:c,isSigner:!1,isWritable:!0})),{pubkey:Mr,isSigner:!1,isWritable:!1}],s=Buffer.alloc(i.span);i.encode({},s);let a=Buffer.from([10,66,208,184,161,6,191,98,...s]);return new vr({keys:o,programId:t,data:a})}},$=_;$.CLAIMED_NUM=3,$.POOL_LAYOUT=ge([de(8),pe("bump"),pe("status"),X("openTime"),X("endTime"),ue("ammId"),Le(ge([pe("mintDecimals"),ue("mintAddress"),ue("mintVault"),X("perLpLoss"),X("totalClaimedAmount")]),_.CLAIMED_NUM,"tokenInfo"),Le(X(),10,"padding")]),$.OWNER_LAYOUT=ge([de(8),pe("bump"),pe("version"),ue("poolId"),ue("owner"),X("lpAmount"),Le(ge([ue("mintAddress"),X("debtAmount"),X("claimedAmount")]),_.CLAIMED_NUM,"tokenInfo"),Le(X(),4,"padding")]),$.DEFAULT_POOL_ID=["58oQChx4yWmvKdwLLZzBi4ChoCc2fqCUWBkwMihLYQo2","6UmmUiYoBjSrhakAobJw8BvkmJtDVxaeBtbt7rxWo1mg","AVs9TA4nWDzfPJE9gGVNJMVhcQy3V9PGazuz33BfG2RA","DVa7Qmb5ct9RCpaU7UTpSaf3GVMYz17vNVU67XpdCRut","7XawhbbxtsRcQA8KTkHT9f9nc6d69UwqCDh6U5EEbEmX","6a1CsrpeZubDjEJE9s1CMVheB6HWM5d7m1cj2jkhyXhj","EoNrn8iUhwgJySD1pHu8Qxm5gSQqLK3za4m8xzD2RuEb","AceAyRTWt4PyB2pHqf2qhDgNZDtKVNaxgL8Ru3V4aN1P","6tmFJbMk5yVHFcFy7X2K8RwHjKLr6KVFLYXpgpBNeAxB"].map(t=>new Fr(t)),$.SEED_CONFIG={pool:{id:Buffer.from("pool_seed","utf8")},owner:{id:Buffer.from("user_claim_seed","utf8")}},$.VERSION_PROJECT=[void 0,"Francium","Tulip","Larix"];export{$ as default};
//# sourceMappingURL=utils1216.mjs.map