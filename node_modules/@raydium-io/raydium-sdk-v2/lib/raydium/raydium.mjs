var oa=Object.defineProperty,sa=Object.defineProperties;var aa=Object.getOwnPropertyDescriptors;var er=Object.getOwnPropertySymbols;var ro=Object.prototype.hasOwnProperty,io=Object.prototype.propertyIsEnumerable;var no=(i,e,t)=>e in i?oa(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,N=(i,e)=>{for(var t in e||(e={}))ro.call(e,t)&&no(i,t,e[t]);if(er)for(var t of er(e))io.call(e,t)&&no(i,t,e[t]);return i},q=(i,e)=>sa(i,aa(e));var _e=(i,e)=>{var t={};for(var n in i)ro.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&er)for(var n of er(i))e.indexOf(n)<0&&io.call(i,n)&&(t[n]=i[n]);return t};import{merge as kl}from"lodash";import Fu from"axios";import{get as oo,set as ua}from"lodash";import ao from"dayjs";import ca from"dayjs/plugin/utc";ao.extend(ca);var Gr=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return ao().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},so={},la={};function oe(i){let e=oo(so,i);if(!e){let t=oo(la,i);e=new Gr({name:i,logLevel:t}),ua(so,i,e)}return e}import{PublicKey as Pu}from"@solana/web3.js";import Tu from"bn.js";import ku from"big.js";import fr from"bn.js";import Se from"bn.js";var $t=9e15,Rt=1e9,Xr="0123456789abcdef",nr="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",rr="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",zr={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-$t,maxE:$t,crypto:!1},mo,Tt,H=!0,or="[DecimalError] ",Lt=or+"Invalid argument: ",po=or+"Precision limit exceeded",fo=or+"crypto unavailable",yo="[object Decimal]",Me=Math.floor,xe=Math.pow,ma=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,da=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,pa=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,bo=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,nt=1e7,Y=7,fa=9007199254740991,ya=nr.length-1,Yr=rr.length-1,B={toStringTag:yo};B.absoluteValue=B.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),U(i)};B.ceil=function(){return U(new this.constructor(this),this.e+1,2)};B.clampedTo=B.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(Lt+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};B.comparedTo=B.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};B.cosine=B.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+Y,n.rounding=1,t=ba(n,Ao(n,t)),n.precision=i,n.rounding=e,U(Tt==2||Tt==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};B.cubeRoot=B.cbrt=function(){var i,e,t,n,r,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(H=!1,o=l.s*xe(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=Ce(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=xe(t,1/3),i=Me((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=de(c.plus(l).times(a),c.plus(u),s+2,1),Ce(a.d).slice(0,s)===(t=Ce(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(U(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(U(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return H=!0,U(n,i,m.rounding,e)};B.decimalPlaces=B.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-Me(this.e/Y))*Y,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};B.dividedBy=B.div=function(i){return de(this,new this.constructor(i))};B.dividedToIntegerBy=B.divToInt=function(i){var e=this,t=e.constructor;return U(de(e,new t(i),0,1,1),t.precision,t.rounding)};B.equals=B.eq=function(i){return this.cmp(i)===0};B.floor=function(){return U(new this.constructor(this),this.e+1,3)};B.greaterThan=B.gt=function(i){return this.cmp(i)>0};B.greaterThanOrEqualTo=B.gte=function(i){var e=this.cmp(i);return e==1||e===0};B.hyperbolicCosine=B.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/ar(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=en(s,1,o.times(e),new s(1),!0);for(var u,c=i,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return U(o,s.precision=t,s.rounding=n,!0)};B.hyperbolicSine=B.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=en(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/ar(5,i)),r=en(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,U(r,e,t,!0)};B.hyperbolicTangent=B.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,de(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};B.inverseCosine=B.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?tt(t,r,o):new t(0):new t(NaN):e.isZero()?tt(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=tt(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};B.inverseHyperbolicCosine=B.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,H=!1,t=t.times(t).minus(1).sqrt().plus(t),H=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};B.inverseHyperbolicSine=B.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,H=!1,t=t.times(t).plus(1).sqrt().plus(t),H=!0,n.precision=i,n.rounding=e,t.ln())};B.inverseHyperbolicTangent=B.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?U(new o(r),i,e,!0):(o.precision=t=n-r.e,r=de(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};B.inverseSine=B.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=tt(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};B.inverseTangent=B.atan=function(){var i,e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=Yr)return s=tt(l,m+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=Yr)return s=tt(l,m+4,d).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/Y+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(H=!1,e=Math.ceil(a/Y),n=1,u=c.times(c),s=new l(c),r=c;i!==-1;)if(r=r.times(u),o=s.minus(r.div(n+=2)),r=r.times(u),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),H=!0,U(s,l.precision=m,l.rounding=d,!0)};B.isFinite=function(){return!!this.d};B.isInteger=B.isInt=function(){return!!this.d&&Me(this.e/Y)>this.d.length-2};B.isNaN=function(){return!this.s};B.isNegative=B.isNeg=function(){return this.s<0};B.isPositive=B.isPos=function(){return this.s>0};B.isZero=function(){return!!this.d&&this.d[0]===0};B.lessThan=B.lt=function(i){return this.cmp(i)<0};B.lessThanOrEqualTo=B.lte=function(i){return this.cmp(i)<1};B.logarithm=B.log=function(i){var e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding,p=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(H=!1,a=m+p,s=Ct(c,a),n=e?ir(l,a+10):Ct(i,a),u=de(s,n,a,1),hn(u.d,r=m,d))do if(a+=10,s=Ct(c,a),n=e?ir(l,a+10):Ct(i,a),u=de(s,n,a,1),!o){+Ce(u.d).slice(r+1,r+15)+1==1e14&&(u=U(u,m+1,0));break}while(hn(u.d,r+=10,d));return H=!0,U(u,m,d)};B.minus=B.sub=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,p=this,y=p.constructor;if(i=new y(i),!p.d||!i.d)return!p.s||!i.s?i=new y(NaN):p.d?i.s=-i.s:i=new y(i.d||p.s!==i.s?p:NaN),i;if(p.s!=i.s)return i.s=-i.s,p.plus(i);if(c=p.d,d=i.d,a=y.precision,u=y.rounding,!c[0]||!d[0]){if(d[0])i.s=-i.s;else if(c[0])i=new y(p);else return new y(u===3?-0:0);return H?U(i,a,u):i}if(t=Me(i.e/Y),l=Me(p.e/Y),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=d.length):(e=d,t=l,s=c.length),n=Math.max(Math.ceil(a/Y),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){m=c[n]<d[n];break}o=0}for(m&&(e=c,c=d,d=e,i.s=-i.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(r=n;r&&c[--r]===0;)c[r]=nt-1;--c[r],c[n]+=nt}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=sr(c,t),H?U(i,a,u):i):new y(u===3?-0:0)};B.modulo=B.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?U(new n(t),n.precision,n.rounding):(H=!1,n.modulo==9?(e=de(t,i.abs(),0,3,1),e.s*=i.s):e=de(t,i,0,n.modulo,1),e=e.times(i),H=!0,t.minus(e))};B.naturalExponential=B.exp=function(){return Qr(this)};B.naturalLogarithm=B.ln=function(){return Ct(this)};B.negated=B.neg=function(){var i=new this.constructor(this);return i.s=-i.s,U(i)};B.plus=B.add=function(i){var e,t,n,r,o,s,a,u,c,l,m=this,d=m.constructor;if(i=new d(i),!m.d||!i.d)return!m.s||!i.s?i=new d(NaN):m.d||(i=new d(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(c=m.d,l=i.d,a=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(i=new d(m)),H?U(i,a,u):i;if(o=Me(m.e/Y),n=Me(i.e/Y),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/Y),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=c.length,r=l.length,s-r<0&&(r=s,t=l,l=c,c=t),e=0;r;)e=(c[--r]=c[r]+l[r]+e)/nt|0,c[r]%=nt;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=sr(c,n),H?U(i,a,u):i};B.precision=B.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(Lt+i);return t.d?(e=go(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};B.round=function(){var i=this,e=i.constructor;return U(new e(i),i.e+1,e.rounding)};B.sine=B.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+Y,n.rounding=1,t=wa(n,Ao(n,t)),n.precision=i,n.rounding=e,U(Tt>2?t.neg():t,i,e,!0)):new n(NaN)};B.squareRoot=B.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(H=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=Ce(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=Me((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(de(s,o,t+2,1)).times(.5),Ce(o.d).slice(0,t)===(e=Ce(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(U(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(U(n,u+1,1),i=!n.times(n).eq(s));break}return H=!0,U(n,u,l.rounding,i)};B.tangent=B.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=de(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,U(Tt==2||Tt==4?t.neg():t,i,e,!0)):new n(NaN)};B.times=B.mul=function(i){var e,t,n,r,o,s,a,u,c,l=this,m=l.constructor,d=l.d,p=(i=new m(i)).d;if(i.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!i.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?i.s/0:i.s*0);for(t=Me(l.e/Y)+Me(i.e/Y),u=d.length,c=p.length,u<c&&(o=d,d=p,p=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)a=o[r]+p[n]*d[r-n-1]+e,o[r--]=a%nt|0,e=a/nt|0;o[r]=(o[r]+e)%nt|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=sr(o,t),H?U(i,m.precision,m.rounding):i};B.toBinary=function(i,e){return Hr(this,2,i,e)};B.toDecimalPlaces=B.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Ue(i,0,Rt),e===void 0?e=n.rounding:Ue(e,0,8),U(t,i+t.e+1,e))};B.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=lt(n,!0):(Ue(i,0,Rt),e===void 0?e=r.rounding:Ue(e,0,8),n=U(new r(n),i+1,e),t=lt(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};B.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=lt(r):(Ue(i,0,Rt),e===void 0?e=o.rounding:Ue(e,0,8),n=U(new o(r),i+r.e+1,e),t=lt(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};B.toFraction=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,p=this,y=p.d,f=p.constructor;if(!y)return new f(p);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=go(y)-p.e-1,s=o%Y,e.d[0]=xe(10,s<0?Y+s:s),i==null)i=o>0?e:c;else{if(a=new f(i),!a.isInt()||a.lt(c))throw Error(Lt+a);i=a.gt(e)?o>0?e:c:a}for(H=!1,a=new f(Ce(y)),l=f.precision,f.precision=o=y.length*Y*2;m=de(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(m.times(r)),u=r,r=e,e=a.minus(m.times(r)),a=r;return r=de(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=p.s,d=de(c,n,o,1).minus(p).abs().cmp(de(u,t,o,1).minus(p).abs())<1?[c,n]:[u,t],f.precision=l,H=!0,d};B.toHexadecimal=B.toHex=function(i,e){return Hr(this,16,i,e)};B.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Ue(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(H=!1,t=de(t,i,0,e,1).times(i),H=!0,U(t)):(i.s=t.s,t=i),t};B.toNumber=function(){return+this};B.toOctal=function(i,e){return Hr(this,8,i,e)};B.toPower=B.pow=function(i){var e,t,n,r,o,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(xe(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,i.eq(1))return U(a,n,o);if(e=Me(i.e/Y),e>=i.d.length-1&&(t=c<0?-c:c)<=fa)return r=wo(u,a,t,n),i.s<0?new u(1).div(r):U(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=xe(+a,c),e=t==0||!isFinite(t)?Me(c*(Math.log("0."+Ce(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(H=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=Qr(i.times(Ct(a,n+t)),n),r.d&&(r=U(r,n+5,1),hn(r.d,n,o)&&(e=n+10,r=U(Qr(i.times(Ct(a,e+t)),e),e+5,1),+Ce(r.d).slice(n+1,n+15)+1==1e14&&(r=U(r,n+1,0)))),r.s=s,H=!0,u.rounding=o,U(r,n,o))};B.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=lt(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Ue(i,1,Rt),e===void 0?e=r.rounding:Ue(e,0,8),n=U(new r(n),i,e),t=lt(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};B.toSignificantDigits=B.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Ue(i,1,Rt),e===void 0?e=n.rounding:Ue(e,0,8)),U(new n(t),i,e)};B.toString=function(){var i=this,e=i.constructor,t=lt(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};B.truncated=B.trunc=function(){return U(new this.constructor(this),this.e+1,1)};B.valueOf=B.toJSON=function(){var i=this,e=i.constructor,t=lt(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function Ce(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=Y-n.length,t&&(o+=Kt(t)),o+=n;s=i[e],n=s+"",t=Y-n.length,t&&(o+=Kt(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Ue(i,e,t){if(i!==~~i||i<e||i>t)throw Error(Lt+i)}function hn(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=Y,r=0):(r=Math.ceil((e+1)/Y),e%=Y),o=xe(10,Y-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==xe(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==xe(10,e-3)-1,s}function tr(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=Xr.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function ba(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/ar(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=en(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var de=function(){function i(n,r,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*r+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=r[a]){u=n[a]>r[a]?1:-1;break}return u}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,u){var c,l,m,d,p,y,f,b,w,A,k,P,T,I,x,L,O,R,E,ee,W=n.constructor,$=n.s==r.s?1:-1,Q=n.d,te=r.d;if(!Q||!Q[0]||!te||!te[0])return new W(!n.s||!r.s||(Q?te&&Q[0]==te[0]:!te)?NaN:Q&&Q[0]==0||!te?$*0:$/0);for(u?(p=1,l=n.e-r.e):(u=nt,p=Y,l=Me(n.e/p)-Me(r.e/p)),E=te.length,O=Q.length,w=new W($),A=w.d=[],m=0;te[m]==(Q[m]||0);m++);if(te[m]>(Q[m]||0)&&l--,o==null?(I=o=W.precision,s=W.rounding):a?I=o+(n.e-r.e)+1:I=o,I<0)A.push(1),y=!0;else{if(I=I/p+2|0,m=0,E==1){for(d=0,te=te[0],I++;(m<O||d)&&I--;m++)x=d*u+(Q[m]||0),A[m]=x/te|0,d=x%te|0;y=d||m<O}else{for(d=u/(te[0]+1)|0,d>1&&(te=i(te,d,u),Q=i(Q,d,u),E=te.length,O=Q.length),L=E,k=Q.slice(0,E),P=k.length;P<E;)k[P++]=0;ee=te.slice(),ee.unshift(0),R=te[0],te[1]>=u/2&&++R;do d=0,c=e(te,k,E,P),c<0?(T=k[0],E!=P&&(T=T*u+(k[1]||0)),d=T/R|0,d>1?(d>=u&&(d=u-1),f=i(te,d,u),b=f.length,P=k.length,c=e(f,k,b,P),c==1&&(d--,t(f,E<b?ee:te,b,u))):(d==0&&(c=d=1),f=te.slice()),b=f.length,b<P&&f.unshift(0),t(k,f,P,u),c==-1&&(P=k.length,c=e(te,k,E,P),c<1&&(d++,t(k,E<P?ee:te,P,u))),P=k.length):c===0&&(d++,k=[0]),A[m++]=d,c&&k[0]?k[P++]=Q[L]||0:(k=[Q[L]],P=1);while((L++<O||k[0]!==void 0)&&I--);y=k[0]!==void 0}A[0]||A.shift()}if(p==1)w.e=l,mo=y;else{for(m=1,d=A[0];d>=10;d/=10)m++;w.e=m+l*p-1,U(w,a?o+w.e+1:o,s,y)}return w}}();function U(i,e,t,n){var r,o,s,a,u,c,l,m,d,p=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=Y,s=e,l=m[d=0],u=l/xe(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/Y),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=u=0,r=1,o%=Y,s=o-Y+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=Y,s=o-Y+r,u=s<0?0:l/xe(10,r-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%xe(10,r-s-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/xe(10,r-s):0:m[d-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=i.e+1,m[0]=xe(10,(Y-e%Y)%Y),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=xe(10,Y-o),m[d]=s>0?(l/xe(10,r-s)%xe(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==nt&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=nt)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return H&&(i.e>p.maxE?(i.d=null,i.e=NaN):i.e<p.minE&&(i.e=0,i.d=[0])),i}function lt(i,e,t){if(!i.isFinite())return ho(i);var n,r=i.e,o=Ce(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+Kt(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+Kt(-r-1)+o,t&&(n=t-s)>0&&(o+=Kt(n))):r>=s?(o+=Kt(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+Kt(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=Kt(n))),o}function sr(i,e){var t=i[0];for(e*=Y;t>=10;t/=10)e++;return e}function ir(i,e,t){if(e>ya)throw H=!0,t&&(i.precision=t),Error(po);return U(new i(nr),e,1,!0)}function tt(i,e,t){if(e>Yr)throw Error(po);return U(new i(rr),e,t,!0)}function go(i){var e=i.length-1,t=e*Y+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function Kt(i){for(var e="";i--;)e+="0";return e}function wo(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/Y+4);for(H=!1;;){if(t%2&&(o=o.times(e),co(o.d,s)&&(r=!0)),t=Me(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),co(e.d,s)}return H=!0,o}function uo(i){return i.d[i.d.length-1]&1}function ko(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function Qr(i,e){var t,n,r,o,s,a,u,c=0,l=0,m=0,d=i.constructor,p=d.rounding,y=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(H=!1,u=y):u=e,a=new d(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(xe(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=U(o.times(i),u,1),t=t.times(++l),a=s.plus(de(o,t,u,1)),Ce(a.d).slice(0,u)===Ce(s.d).slice(0,u)){for(r=m;r--;)s=U(s.times(s),u,1);if(e==null)if(c<3&&hn(s.d,u-n,p,c))d.precision=u+=10,t=o=a=new d(1),l=0,c++;else return U(s,d.precision=y,p,H=!0);else return d.precision=y,s}s=a}}function Ct(i,e){var t,n,r,o,s,a,u,c,l,m,d,p=1,y=10,f=i,b=f.d,w=f.constructor,A=w.rounding,k=w.precision;if(f.s<0||!b||!b[0]||!f.e&&b[0]==1&&b.length==1)return new w(b&&!b[0]?-1/0:f.s!=1?NaN:b?0:f);if(e==null?(H=!1,l=k):l=e,w.precision=l+=y,t=Ce(b),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=Ce(f.d),n=t.charAt(0),p++;o=f.e,n>1?(f=new w("0."+t),o++):f=new w(n+"."+t.slice(1))}else return c=ir(w,l+2,k).times(o+""),f=Ct(new w(n+"."+t.slice(1)),l-y).plus(c),w.precision=k,e==null?U(f,k,A,H=!0):f;for(m=f,u=s=f=de(f.minus(1),f.plus(1),l,1),d=U(f.times(f),l,1),r=3;;){if(s=U(s.times(d),l,1),c=u.plus(de(s,new w(r),l,1)),Ce(c.d).slice(0,l)===Ce(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(ir(w,l+2,k).times(o+""))),u=de(u,new w(p),l,1),e==null)if(hn(u.d,l-y,A,a))w.precision=l+=y,c=s=f=de(m.minus(1),m.plus(1),l,1),d=U(f.times(f),l,1),r=a=1;else return U(u,w.precision=k,A,H=!0);else return w.precision=k,u;u=c,r+=2}}function ho(i){return String(i.s*i.s/0)}function jr(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%Y,t<0&&(n+=Y),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=Y;n<r;)i.d.push(+e.slice(n,n+=Y));e=e.slice(n),n=Y-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),H&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function ga(i,e){var t,n,r,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),bo.test(e))return jr(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(da.test(e))t=16,e=e.toLowerCase();else if(ma.test(e))t=2;else if(pa.test(e))t=8;else throw Error(Lt+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=wo(n,new n(t),o,o*2)),c=tr(e,t,nt),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=sr(c,l),i.d=c,H=!1,s&&(i=de(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?xe(2,u):An.pow(2,u))),H=!0,i)}function wa(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:en(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/ar(5,t)),e=en(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function en(i,e,t,n,r){var o,s,a,u,c=1,l=i.precision,m=Math.ceil(l/Y);for(H=!1,u=t.times(t),a=new i(n);;){if(s=de(a.times(u),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=de(s.times(u),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return H=!0,s.d.length=m+1,s}function ar(i,e){for(var t=i;--e;)t*=i;return t}function Ao(i,e){var t,n=e.s<0,r=tt(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Tt=n?4:1,e;if(t=e.divToInt(r),t.isZero())Tt=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Tt=uo(t)?n?2:3:n?4:1,e;Tt=uo(t)?n?1:4:n?3:2}return e.minus(r).abs()}function Hr(i,e,t,n){var r,o,s,a,u,c,l,m,d,p=i.constructor,y=t!==void 0;if(y?(Ue(t,1,Rt),n===void 0?n=p.rounding:Ue(n,0,8)):(t=p.precision,n=p.rounding),!i.isFinite())l=ho(i);else{for(l=lt(i),s=l.indexOf("."),y?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=tr(lt(d),10,r),d.e=d.d.length),m=tr(l,10,r),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=y?"0p+0":"0";else{if(s<0?o--:(i=new p(i),i.d=m,i.e=o,i=de(i,d,t,n,0,r),m=i.d,o=i.e,c=mo),s=m[t],a=r/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,c)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=Xr.charAt(m[s]);if(y){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=tr(l,r,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=Xr.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function co(i,e){if(i.length>e)return i.length=e,!0}function ka(i){return new this(i).abs()}function ha(i){return new this(i).acos()}function Aa(i){return new this(i).acosh()}function Pa(i,e){return new this(i).plus(e)}function Ta(i){return new this(i).asin()}function Ia(i){return new this(i).asinh()}function xa(i){return new this(i).atan()}function Ba(i){return new this(i).atanh()}function Sa(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=tt(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?tt(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=tt(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(de(i,e,o,1)),e=tt(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(de(i,e,o,1)),t}function Ka(i){return new this(i).cbrt()}function Ca(i){return U(i=new this(i),i.e+1,2)}function La(i,e,t){return new this(i).clamp(e,t)}function Ra(i){if(!i||typeof i!="object")throw Error(or+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,Rt,"rounding",0,8,"toExpNeg",-$t,0,"toExpPos",0,$t,"maxE",0,$t,"minE",-$t,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=zr[t]),(n=i[t])!==void 0)if(Me(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(Lt+t+": "+n);if(t="crypto",r&&(this[t]=zr[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(fo);else this[t]=!1;else throw Error(Lt+t+": "+n);return this}function Oa(i){return new this(i).cos()}function Na(i){return new this(i).cosh()}function Po(i){var e,t,n;function r(o){var s,a,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,lo(o)){c.s=o.s,H?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;H?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return jr(c,o.toString())}else if(u!=="string")throw Error(Lt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),bo.test(o)?jr(c,o):ga(c,o)}if(r.prototype=B,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Ra,r.clone=Po,r.isDecimal=lo,r.abs=ka,r.acos=ha,r.acosh=Aa,r.add=Pa,r.asin=Ta,r.asinh=Ia,r.atan=xa,r.atanh=Ba,r.atan2=Sa,r.cbrt=Ka,r.ceil=Ca,r.clamp=La,r.cos=Oa,r.cosh=Na,r.div=_a,r.exp=Ma,r.floor=Va,r.hypot=Ea,r.ln=Fa,r.log=va,r.log10=Da,r.log2=Wa,r.max=qa,r.min=Ua,r.mod=Ga,r.mul=Xa,r.pow=za,r.random=Ya,r.round=Qa,r.sign=ja,r.sin=Ha,r.sinh=Za,r.sqrt=Ja,r.sub=$a,r.sum=eu,r.tan=tu,r.tanh=nu,r.trunc=ru,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function _a(i,e){return new this(i).div(e)}function Ma(i){return new this(i).exp()}function Va(i){return U(i=new this(i),i.e+1,3)}function Ea(){var i,e,t=new this(0);for(H=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return H=!0,new this(1/0);t=e}return H=!0,t.sqrt()}function lo(i){return i instanceof An||i&&i.toStringTag===yo||!1}function Fa(i){return new this(i).ln()}function va(i,e){return new this(i).log(e)}function Wa(i){return new this(i).log(2)}function Da(i){return new this(i).log(10)}function qa(){return ko(this,arguments,"lt")}function Ua(){return ko(this,arguments,"gt")}function Ga(i,e){return new this(i).mod(e)}function Xa(i,e){return new this(i).mul(e)}function za(i,e){return new this(i).pow(e)}function Ya(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Ue(i,1,Rt),n=Math.ceil(i/Y),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(fo);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=Y,n&&i&&(r=xe(10,Y-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=Y)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<Y&&(t-=Y-n)}return s.e=t,s.d=a,s}function Qa(i){return U(i=new this(i),i.e+1,this.rounding)}function ja(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function Ha(i){return new this(i).sin()}function Za(i){return new this(i).sinh()}function Ja(i){return new this(i).sqrt()}function $a(i,e){return new this(i).sub(e)}function eu(){var i=0,e=arguments,t=new this(e[i]);for(H=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return H=!0,U(t,this.precision,this.rounding)}function tu(i){return new this(i).tan()}function nu(i){return new this(i).tanh()}function ru(i){return U(i=new this(i),i.e+1,1)}B[Symbol.for("nodejs.util.inspect.custom")]=B.toString;B[Symbol.toStringTag]="Decimal";var An=B.constructor=Po(zr);nr=new An(nr);rr=new An(rr);var F=An;import{PublicKey as $r}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as iu}from"@solana/spl-token";import{PublicKey as be,SystemProgram as ou,SYSVAR_RENT_PUBKEY as su}from"@solana/web3.js";function h({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var Zr=[h({pubkey:iu,isWritable:!1}),h({pubkey:ou.programId,isWritable:!1}),h({pubkey:su,isWritable:!1})];function tn({publicKey:i,transformSol:e}){let t=Jr(i.toString());if(t instanceof be)return e&&t.equals(le)?Z:t;if(e&&t.toString()===le.toBase58())return Z;if(typeof t=="string"){if(t===be.default.toBase58())return be.default;try{return new be(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Jr(i){try{return new be(i)}catch{return i}}var nn=new be("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),It=new be("SysvarRent111111111111111111111111111111111"),To=new be("SysvarC1ock11111111111111111111111111111111"),rn=new be("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),au=new be("Sysvar1nstructions1111111111111111111111111"),Cl=new be("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ll=new be("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Rl=new be("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ol=new be("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Nl=new be("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),_l=new be("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ml=new be("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Vl=new be("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),El=new be("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Fl=new be("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),vl=new be("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Z=new be("So11111111111111111111111111111111111111112"),le=be.default;function Ot(i){return tn({publicKey:i,transformSol:!0})}import{PublicKey as uu}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Io}from"@solana/spl-token";var Ye={chainId:101,address:uu.default.toBase58(),programId:Io.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Le={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Io.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var ei=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===le.toBase58()||e instanceof $r&&le.equals(e)){this.decimals=Le.decimals,this.symbol=Le.symbol,this.name=Le.name,this.mint=new $r(Le.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?$r.default:tn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},ce=ei;ce.WSOL=new ei(q(N({},Le),{mint:Le.address}));import cr from"big.js";import mu from"bn.js";import du from"decimal.js-light";import cu from"toformat";var lu=cu,Pn=lu;var ur=oe("module/fraction"),ti=Pn(cr),Tn=Pn(du),pu={[0]:Tn.ROUND_DOWN,[1]:Tn.ROUND_HALF_UP,[2]:Tn.ROUND_UP},fu={[0]:cr.roundDown,[1]:cr.roundHalfUp,[2]:cr.roundUp},re=class{constructor(e,t=new mu(1)){this.numerator=z(e),this.denominator=z(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new re(this.denominator,this.numerator)}add(e){let t=e instanceof re?e:new re(z(e));return this.denominator.eq(t.denominator)?new re(this.numerator.add(t.numerator),this.denominator):new re(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof re?e:new re(z(e));return this.denominator.eq(t.denominator)?new re(this.numerator.sub(t.numerator),this.denominator):new re(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof re?e:new re(z(e));return new re(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof re?e:new re(z(e));return new re(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||ur.logWithError(`${e} is not an integer.`),e<=0&&ur.logWithError(`${e} is not positive.`),Tn.set({precision:e+1,rounding:pu[n]});let r=new Tn(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||ur.logWithError(`${e} is not an integer.`),e<0&&ur.logWithError(`${e} is negative.`),ti.DP=e,ti.RM=fu[n]||1,new ti(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var bu=oe("Raydium_price"),Qe=class extends re{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new re(ni(n.decimals),ni(r.decimals))}get raw(){return new re(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Qe({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&bu.logWithError("mul token not equals");let n=super.mul(t);return new Qe({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var ri=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},lr=ri;lr.SOL=new ri(Ye);import gu from"bn.js";var xo=new re(new gu(100)),je=class extends re{toSignificant(e=5,t,n){return this.mul(xo).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(xo).toFixed(e,t,n)}};var Ge=new Se(0),mr=new Se(1),_m=new Se(2),Mm=new Se(3),Vm=new Se(5),dr=new Se(10),Em=new Se(100),Fm=new Se(1e3),vm=new Se(1e4),Bo=9007199254740991;function z(i){let e=oe("Raydium_parseBigNumberish");if(i instanceof Se)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Se(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=Bo||i<=-Bo)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Se(String(i))):typeof i=="bigint"?new Se(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Se(0))}function ni(i){return dr.pow(z(i))}function on(i){var a;if(i===void 0)return{denominator:"1",numerator:"0"};if(i instanceof Se)return{numerator:i.toString(),denominator:"1"};if(i instanceof re)return{denominator:i.denominator.toString(),numerator:i.numerator.toString()};let e=String(i),[,t="",n="",r=""]=(a=e.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?a:[],o="1"+"0".repeat(r.length),s=t+(n==="0"?"":n)+r||"0";return{denominator:o,numerator:s,sign:t,int:n,dec:r}}function pr(i,e){let t=i.divmod(e);return t.mod.isZero()?t.div:t.div.isNeg()?t.div.isubn(1):t.div.iaddn(1)}function wu(i){var n;let[,e="",t=""]=(n=i.toFixed(2).match(/(-?)(\d*)\.?(\d*)/))!=null?n:[];return`${e}${t}`}function ii(i,e=0){return i instanceof Se?i:new Se(wu(So(i).mul(dr.pow(new Se(String(e))))))}function So(i){if(i instanceof je)return new re(i.numerator,i.denominator);if(i instanceof Qe)return i.adjusted;if(i instanceof fe)try{return So(i.toExact())}catch{return new re(Ge)}if(i instanceof re)return i;let e=String(i),t=on(e);return new re(t.numerator,t.denominator)}var hu=oe("Raydium_amount"),Co=Pn(ku);function Au(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):hu.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var fe=class extends re{constructor(t,n,r=!0,o){let s=new fr(0),a=dr.pow(new fr(t.decimals));if(r)s=z(n);else{let u=new fr(0),c=new fr(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=Au(n.toString(),t.decimals);u=z(l),c=z(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=oe(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new fe(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new fe(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return Co.DP=this.token.decimals,new Co(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};function Ko(i){return typeof i=="object"&&i!==null&&![ce,fe,Pu,re,Tu,Qe,je].some(e=>typeof e=="object"&&i instanceof e)}function Pe(i){return typeof i=="string"?Jr(i):Array.isArray(i)?i.map(e=>Pe(e)):Ko(i)?Object.fromEntries(Object.entries(i).map(([e,t])=>[e,Pe(t)])):i}import{PublicKey as Bn,sendAndConfirmTransaction as ui,Transaction as Sn,TransactionMessage as Kn,VersionedTransaction as Cn}from"@solana/web3.js";import Cu from"axios";var _={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw"};import{PublicKey as Iu,ComputeBudgetProgram as Lo,Transaction as Oo,TransactionMessage as xu,Keypair as No,VersionedTransaction as _o}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Bu}from"@solana/spl-token";var Ro=oe("Raydium_txUtil"),Mo=1644;function sn(i){let e=[],t=[];return i.microLamports&&(e.push(Lo.setComputeUnitPrice({microLamports:i.microLamports})),t.push(_.SetComputeUnitPrice)),i.units&&(e.push(Lo.setComputeUnitLimit({units:i.units})),t.push(_.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function an(i){var e,t;try{return((t=await((e=i.getLatestBlockhash)==null?void 0:e.call(i)))==null?void 0:t.blockhash)||(await i.getRecentBlockhash()).blockhash}catch{return(await i.getRecentBlockhash()).blockhash}}function Nt(i,e){i.length<1&&Ro.logWithError(`no instructions provided: ${i.toString()}`),e.length<1&&Ro.logWithError(`no signers provided:, ${e.toString()}`);let t=new Oo;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...i);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Mo}catch{return!1}}function ye(i,e){let[t,n]=Iu.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function In({instructions:i,payer:e,signers:t}){return Nt(i,[e,...t])}function xn({instructions:i,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=No.generate().publicKey.toString()}){let o=new xu({payerKey:e,recentBlockhash:n,instructions:i}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new _o(o).serialize()).toString("base64").length<Mo}catch{return!1}}var Su=i=>Buffer.isBuffer(i)?i:i instanceof Uint8Array?Buffer.from(i.buffer,i.byteOffset,i.byteLength):Buffer.from(i);function Gt(i){let e=[];return i.forEach(t=>{t instanceof Oo&&(t.recentBlockhash||(t.recentBlockhash=Bu.toBase58()),t.feePayer||(t.feePayer=No.generate().publicKey));let n=t.serialize({requireAllSignatures:!1,verifySignatures:!1});t instanceof _o&&(n=Su(n));let r=n.toString("base64");e.push(r)}),console.log("simulate tx string:",e),e}import{PublicKey as Vo,AddressLookupTableAccount as br}from"@solana/web3.js";import{PublicKey as Ku}from"@solana/web3.js";import{getTransferFeeConfig as Bd,unpackMint as Sd}from"@solana/spl-token";var oi=oe("Raydium_accountInfo_util");async function mt(i,e,t){let{batchRequest:n,commitment:r="confirmed"}=N({batchRequest:!1},t),o=si(e,100),s=new Array(o.length).fill([]);if(n){let a=o.map(l=>{let m=i._buildArgs([l.map(d=>d.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:m}}),u=si(a,10);s=(await(await Promise.all(u.map(async l=>await i._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&oi.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(m=>{if(m){let{data:d,executable:p,lamports:y,owner:f,rentEpoch:b}=m;return d.length!==2&&d[1]!=="base64"&&oi.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:p,lamports:y,owner:new Ku(f),rentEpoch:b}}return null})))}else try{s=await Promise.all(o.map(a=>i.getMultipleAccountsInfo(a,r)))}catch(a){a instanceof Error&&oi.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function yr(i,e,t){let n=await mt(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>q(N({},r),{accountInfo:n[o]}))}async function ai({connection:i,address:e}){let t=await mt(i,[...new Set(e.map(r=>r.toString()))].map(r=>new Vo(r))),n={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new br({key:s,state:br.deserialize(o.data)});n[s.toString()]=a,gr[s.toString()]=a}return n}var gr={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new br({key:new Vo("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:br.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var wr=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Cu.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=sn(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Bn.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(N({},t||{})):this.build(t)}build(e){let t=new Sn;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async()=>{var r;let n=await an(this.connection);if(t.recentBlockhash=n,this.signers.length&&t.sign(...this.signers),Gt([t]),(r=this.owner)!=null&&r.isKeyPair)return{txId:await ui(this.connection,t,this.signers),signedTx:t};if(this.signAllTransactions){let o=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(o[0].serialize(),{skipPreflight:!0}),signedTx:o[0]}}throw new Error("please connect wallet first")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:r}=this.build(n),o=t.filter(c=>c.transaction.instructions.length>0),s=[r,...o.map(c=>c.transaction)],a=[this.signers,...o.map(c=>c.signers)],u=[...this.instructionTypes,...o.map(c=>c.instructionTypes).flat()];return{builder:this,transactions:s,signers:a,instructionTypes:u,execute:async c=>{var p;let{sequentially:l,onTxUpdate:m}=c||{},d=await an(this.connection);if((p=this.owner)!=null&&p.isKeyPair)return{txIds:await await Promise.all(s.map(async(y,f)=>(y.recentBlockhash=d,await ui(this.connection,y,a[f])))),signedTxs:s};if(this.signAllTransactions){let y=s.map((b,w)=>(b.recentBlockhash=d,a[w].length&&b.sign(...a[w]),b));Gt(y);let f=await this.signAllTransactions(y);if(l){let b=0,w=[],A=async()=>{if(!f[b])return;let k=await this.connection.sendRawTransaction(f[b].serialize(),{skipPreflight:!0});w.push({txId:k,status:"sent",signedTx:f[b]}),m==null||m([...w]),b++,this.connection.onSignature(k,P=>{let T=w.findIndex(I=>I.txId===k);T>-1&&(w[T].status=P.err?"error":"success"),m==null||m([...w]),A()},"processed"),this.connection.getSignatureStatus(k)};return await A(),{txIds:w.map(k=>k.txId),signedTxs:f}}else{let b=[];for(let w=0;w<f.length;w+=1){let A=await this.connection.sendRawTransaction(f[w].serialize(),{skipPreflight:!0});b.push(A)}return{txIds:b,signedTxs:f}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){let d=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:r}=d,o=_e(d,["lookupTableCache","lookupTableAddress","forerunCreate"]),s=N(N({},gr),t),a=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let p of a)s[p]===void 0&&u.push(new Bn(p));let c=await ai({connection:this.connection,address:u});for(let[p,y]of Object.entries(c))s[p]=y;let l=new Kn({payerKey:this.feePayer,recentBlockhash:r?Bn.default.toBase58():await an(this.connection),instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s)),m=new Cn(l);return m.sign(this.signers),{builder:this,transaction:m,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async()=>{var p;if(Gt([m]),(p=this.owner)!=null&&p.isKeyPair)return m.sign([this.owner.signer]),{txId:await this.connection.sendTransaction(m,{skipPreflight:!0}),signedTx:m};if(this.signAllTransactions){let y=await this.signAllTransactions([m]);return{txId:await this.connection.sendTransaction(y[0],{skipPreflight:!0}),signedTx:y[0]}}throw new Error("please connect wallet first")},extInfo:o||{}}}async buildV0MultiTx(e){let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:r}=await this.buildV0(n),o=t.filter(c=>c.builder.instructions.length>0),s=[r,...o.map(c=>c.transaction)],a=[this.signers,...o.map(c=>c.signers)],u=[...this.instructionTypes,...o.map(c=>c.instructionTypes).flat()];return s.forEach(async(c,l)=>{c.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:u,buildProps:n,execute:async c=>{var d;Gt(s);let{sequentially:l,onTxUpdate:m}=c||{};if((d=this.owner)!=null&&d.isKeyPair)return s.forEach(p=>p.sign([this.owner.signer])),{txIds:await Promise.all(s.map(async p=>await this.connection.sendTransaction(p))),signedTxs:s};if(this.signAllTransactions){let p=await this.signAllTransactions(s);if(l){let y=0,f=[],b=async()=>{if(!p[y])return;let w=await this.connection.sendTransaction(p[y],{skipPreflight:!0});f.push({txId:w,status:"sent",signedTx:p[y]}),m==null||m([...f]),y++,this.connection.onSignature(w,A=>{let k=f.findIndex(P=>P.txId===w);k>-1&&(f[k].status=A.err?"error":"success"),m==null||m([...f]),b()},"processed"),this.connection.getSignatureStatus(w)};return b(),{txIds:[],signedTxs:p}}else{let y=[];for(let f=0;f<p.length;f+=1){let b=await this.connection.sendTransaction(p[f],{skipPreflight:!0});y.push(b)}return{txIds:y,signedTxs:p}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async sizeCheckBuild(e){let c=e||{},{autoComputeBudget:t=!1}=c,n=_e(c,["autoComputeBudget"]),r={instructions:[],instructionTypes:[]};if(t){let l=t?await this.getComputeBudgetConfig():void 0;r=t&&l?sn(l):{instructions:[],instructionTypes:[]}}let o=this.signers.reduce((l,m)=>q(N({},l),{[m.publicKey.toBase58()]:m}),{}),s=[],a=[],u=[];if(this.allInstructions.forEach(l=>{let m=[...u,l],d=t?[...r.instructions,...m]:m,y=[...new Set(m.map(f=>f.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat()).values()].map(f=>new Bn(f));if(u.length<12&&In({instructions:d,payer:this.feePayer,signers:y})||In({instructions:m,payer:this.feePayer,signers:y}))u.push(l);else{if(u.length===0)throw Error("item ins too big");In({instructions:t?[...r.instructions,...u]:[...u],payer:this.feePayer,signers:y})?s.push(new Sn().add(...r.instructions,...u)):s.push(new Sn().add(...u)),a.push(Array.from(new Set(u.map(f=>f.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat())).map(f=>o[f]).filter(f=>f!==void 0)),u=[l]}}),u.length>0){let m=[...new Set(u.map(d=>d.keys.filter(p=>p.isSigner).map(p=>p.pubkey.toString())).flat()).values()].map(d=>o[d]).filter(d=>d!==void 0);In({instructions:t?[...r.instructions,...u]:[...u],payer:this.feePayer,signers:m.map(d=>d.publicKey)})?s.push(new Sn().add(...r.instructions,...u)):s.push(new Sn().add(...u)),a.push(m)}return s.forEach(l=>l.feePayer=this.feePayer),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async l=>{var y;let{sequentially:m,onTxUpdate:d}=l||{},p=await an(this.connection);if(s.forEach(async(f,b)=>{f.recentBlockhash=p,a[b].length&&f.sign(...a[b])}),Gt(s),(y=this.owner)!=null&&y.isKeyPair)return{txIds:await Promise.all(s.map(async(f,b)=>await ui(this.connection,f,a[b]))),signedTxs:s};if(this.signAllTransactions){let f=await this.signAllTransactions(s);if(m){let b=0,w=[],A=async()=>{if(!f[b])return;let k=await this.connection.sendRawTransaction(f[b].serialize(),{skipPreflight:!0});w.push({txId:k,status:"sent",signedTx:f[b]}),d==null||d([...w]),b++,this.connection.onSignature(k,P=>{let T=w.findIndex(I=>I.txId===k);T>-1&&(w[T].status=P.err?"error":"success"),d==null||d([...w]),A()},"processed"),this.connection.getSignatureStatus(k)};return await A(),{txIds:w.map(k=>k.txId),signedTxs:f}}else{let b=[];for(let w=0;w<f.length;w+=1){let A=await this.connection.sendRawTransaction(f[w].serialize(),{skipPreflight:!0});b.push(A)}return{txIds:b,signedTxs:f}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async sizeCheckBuildV0(e){let b=e||{},{autoComputeBudget:t=!1,lookupTableCache:n={},lookupTableAddress:r=[]}=b,o=_e(b,["autoComputeBudget","lookupTableCache","lookupTableAddress"]),s=N(N({},gr),n),a=Array.from(new Set([...this.lookupTableAddress,...r])),u=[];for(let w of a)s[w]===void 0&&u.push(new Bn(w));let c=await ai({connection:this.connection,address:u});for(let[w,A]of Object.entries(c))s[w]=A;let l={instructions:[],instructionTypes:[]};if(t){let w=t?await this.getComputeBudgetConfig():void 0;l=t&&w?sn(w):{instructions:[],instructionTypes:[]}}let m=await an(this.connection),d=this.signers.reduce((w,A)=>q(N({},w),{[A.publicKey.toBase58()]:A}),{}),p=[],y=[],f=[];if(this.allInstructions.forEach(w=>{let A=[...f,w],k=t?[...l.instructions,...A]:A;if(f.length<12&&xn({instructions:k,payer:this.feePayer,lookupTableAddressAccount:s})||xn({instructions:A,payer:this.feePayer,lookupTableAddressAccount:s}))f.push(w);else{if(f.length===0)throw Error("item ins too big");let P={};for(let T of[...new Set(a)])s[T]!==void 0&&(P[T]=s[T]);if(t&&xn({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let T=new Kn({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new Cn(T))}else{let T=new Kn({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new Cn(T))}y.push(Array.from(new Set(f.map(T=>T.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat())).map(T=>d[T]).filter(T=>T!==void 0)),f=[w]}}),f.length>0){let A=[...new Set(f.map(k=>k.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(k=>d[k]).filter(k=>k!==void 0);if(t&&xn({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let k=new Kn({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new Cn(k))}else{let k=new Kn({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new Cn(k))}y.push(A)}return{builder:this,transactions:p,buildProps:e,signers:y,instructionTypes:this.instructionTypes,execute:async w=>{var P;let{sequentially:A,onTxUpdate:k}=w||{};if(p.map(async(T,I)=>{y[I].length&&T.sign(y[I])}),Gt(p),(P=this.owner)!=null&&P.isKeyPair)return{txIds:await Promise.all(p.map(async T=>await this.connection.sendTransaction(T,{skipPreflight:!0}))),signedTxs:p};if(this.signAllTransactions){let T=await this.signAllTransactions(p);if(A){let I=0,x=[],L=async()=>{if(!T[I])return;let O=await this.connection.sendTransaction(T[I],{skipPreflight:!0});x.push({txId:O,status:"sent",signedTx:T[I]}),k==null||k([...x]),I++,this.connection.onSignature(O,R=>{let E=x.findIndex(ee=>ee.txId===O);E>-1&&(x[E].status=R.err?"error":"success"),k==null||k([...x]),L()},"processed"),this.connection.getSignatureStatus(O)};return L(),{txIds:[],signedTxs:T}}else{let I=[];for(let x=0;x<T.length;x+=1){let L=await this.connection.sendTransaction(T[x],{skipPreflight:!0});I.push(L)}return{txIds:I,signedTxs:T}}}throw new Error("please connect wallet first")},extInfo:o||{}}}};var rt=class{constructor(e){this._owner=e}get publicKey(){return rt.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return rt.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return rt.isKeyPair(this._owner)}get isPublicKey(){return rt.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!rt.isKeyPair(e)}};function si(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Xe}from"@solana/web3.js";var Eo=new Xe("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Fo=new Xe("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ln=new Xe("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),jd=new Xe("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Hd=new Xe("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Zd=new Xe("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Jd=new Xe("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),$d=new Xe("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ep=new Xe("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),tp=new Xe("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Lu=new Xe("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Ru=new Xe("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Ou=new Xe("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Nu=new Xe("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Rn={IDO_PROGRAM_ID_V1:Lu,IDO_PROGRAM_ID_V2:Ru,IDO_PROGRAM_ID_V3:Ou,IDO_PROGRAM_ID_V4:Nu};import{PublicKey as _u}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Mu}from"@solana/spl-token";function ge(i,e,t){return ye([i.toBuffer(),(t!=null?t:Mu).toBuffer(),e.toBuffer()],new _u("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import Te from"bn.js";var dt=1e4;function cn(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=t.epoch<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new Te(r.maximumFee.toString()),s=t.epoch<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(r.transferFeeBasisPoints===dt){let a=new Te(r.maximumFee.toString());return{amount:i.add(a),fee:a,expirationTime:s}}else{let a=un(i.mul(new Te(dt)),new Te(dt-r.transferFeeBasisPoints)),u=new Te(r.maximumFee.toString()),c=a.sub(i).gt(u)?i.add(u):a,l=un(c.mul(new Te(r.transferFeeBasisPoints)),new Te(dt)),m=l.gt(o)?o:l;return{amount:c,fee:m,expirationTime:s}}else{let a=un(i.mul(new Te(r.transferFeeBasisPoints)),new Te(dt)),u=a.gt(o)?o:a;return{amount:i,fee:u,expirationTime:s}}}function Ve(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=q(N({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new Te(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===dt){let u=new Te(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:a}}else{let u=un(i.mul(new Te(dt)),new Te(dt-o.transferFeeBasisPoints)),c=new Te(o.maximumFee.toString()),l=u.sub(i).gt(c)?i.add(c):u,m=un(l.mul(new Te(o.transferFeeBasisPoints)),new Te(dt)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let u=un(i.mul(new Te(o.transferFeeBasisPoints)),new Te(dt)),c=u.gt(s)?s:u;return{amount:i,fee:c,expirationTime:a}}}function Xt(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function un(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new Te(0))?t.add(new Te(1)):t}var _t={BASE_HOST:"https://uapi.raydium.io",OWNER_BASE_HOST:"https://owner.raydium.io",COINGECKO:"https://api.coingecko.com/api/v3/simple/price",FARM_ARP:"/main/farm/info",FARM_ARP_LINE:"/main/farm-apr-tv",AMM_V3_CONFIG:"/v3/pools/clmm-config",VERSION:"/v3/main/version",PRICE:"/v2/main/price",CHECK_AVAILABILITY:"/v3/main/AvailabilityCheckAPI",RPCS:"/v3/main/rpcs",INFO:"/v3/main/info",STAKE_POOLS:"/v3/main/stake-pools",CHAIN_TIME:"/v3/main/chain-time",TOKEN_LIST:"/v3/mint/list",TOKEN_INFO:"/v3/mint/item/{mint}",JUP_TOKEN_LIST:"https://token.jup.ag/{type}",POOL_LIST:"/v3/pools/info/{type}/{sort}/{order}/{page_size}/{page}",POOL_SEARCH_BY_ID:"/v3/pools/info/ids/{ids}",POOL_SEARCH:"/v3/pools/info/search/{search_text}/{type}/{sort}/{order}/{page_size}/{page}",POOL_SEARCH_MINT:"/v3/pools/info/mint/{mint1}/{type}/{sort}/{order}/{page_size}/{page}",POOL_SEARCH_MINT_2:"/v3/pools/info/mint/{mint1}/{mint2}/{type}/{sort}/{order}/{page_size}/{page}",POOL_SEARCH_LP:"/v3/pools/info/lps/{lp_mints}",POOL_KEY_BY_ID:"/v3/pools/key/id/{id}",POOLS_KEY:"/v3/pools/key/{type}/{page_size}/{page}",POOLS_KEY_BY_MINT:"/v3/pools/key/mint/{mint1}/{type}/{page_size}/{page}",POOLS_KEY_BY_MINT_2:"/v3/pools/key/mint/{mint1}/{mint2}/{type}/{page_size}/{page}",POOL_LIQUIDITY_LINE:"/v3/pools/line/liquidity/{id}",POOL_POSITION_LINE:"/v3/pools/line/position/{id}",FARM_INFO:"/v3/farms/info/ids/{ids}",FARM_LP_INFO:"/v3/farms/info/lp/{pool_lp}/{page_size}/{page}",FARM_LIST:"/v3/farms/info/list/all/{page_size}/{page}",FARM_KEYS:"/v3/farms/key/ids/{ids}",OWNER_CREATED_FARM:"/v1/create-pool/{owner}",OWNER_IDO:"/v1/ido/{owner}",OWNER_STAKE_FARMS:"/v1/position/stake/{owner}",IDO_KEYS:"/v3/ido/key/ids/{ids}",SWAP_HOST:"https://transaction.raydium.io",SWAP_COMPUTE:"/v1/compute/",SWAP_TX:"/v1/transaction/",MINT_PRICE:"/v3/mint/price",MIGRATE_CONFIG:"/v3/main/migrate-lp"},it=N({},_t);var vo="ray_tab_hash",li="ray_req_hash",Vu=()=>{if(typeof window===void 0)return"";let i=sessionStorage.getItem(vo);return i||(i=`ray-${Date.now()}`,sessionStorage.setItem(vo,i)),i},kr=async n=>{var r=n,{logCount:i=1e3,removeLastLog:e}=r,t=_e(r,["logCount","removeLastLog"]);if(typeof window===void 0)return new Promise(s=>s());let o=JSON.parse(localStorage.getItem(li)||"[]").slice(0,i-1);e&&o.pop(),new Blob([JSON.stringify(t.data)]).size>1024&&(t.data=JSON.stringify(t.data).substring(0,200)+"..."),o.unshift(q(N({},t),{time:Date.now(),session:Vu()}));try{localStorage.setItem(li,JSON.stringify(o))}catch{if(e){let s=!1,a=JSON.stringify(t.data).substring(0,100);for(o[0].data=a+(a.length>100?"...":"");!s;){o.pop();let u=JSON.stringify(t.data).substring(0,100);o[0].data=u+(u.length>100?"...":"");try{localStorage.setItem(li,JSON.stringify(o)),s=!0}catch{s=!1}}return new Promise(u=>u())}return kr(q(N({},t),{logCount:i,removeLastLog:!0}))}};var hr=oe("Raydium_Api"),mi=new Map;var Ar=class{constructor({cluster:e,timeout:t,logRequests:n,logCount:r,urlConfigs:o}){this.cluster=e,this.urlConfigs=o||{},this.logCount=r||1e3,this.api=Fu.create({baseURL:this.urlConfigs.BASE_HOST||_t.BASE_HOST,timeout:t}),this.api.interceptors.request.use(s=>{let{method:a,baseURL:u,url:c}=s;return hr.debug(`${a==null?void 0:a.toUpperCase()} ${u}${c}`),s},s=>(hr.error("Request failed"),Promise.reject(s))),this.api.interceptors.response.use(s=>{let{config:a,data:u,status:c}=s,{method:l,baseURL:m,url:d}=a;return n&&kr({status:c,url:`${m}${d}`,params:a.params,data:u,logCount:this.logCount}),hr.debug(`${l==null?void 0:l.toUpperCase()} ${m}${d}  ${c}`),u},s=>{let{config:a,response:u={}}=s,{status:c}=u,{method:l,baseURL:m,url:d}=a;return n&&kr({status:c,url:`${m}${d}`,params:a.params,data:s.message,logCount:this.logCount}),hr.error(`${l.toUpperCase()} ${m}${d} ${c||s.message}`),Promise.reject(s)})}async getClmmConfigs(){return(await this.api.get(this.urlConfigs.AMM_V3_CONFIG||_t.AMM_V3_CONFIG)).data}async getClmmPoolLines(e){return(await this.api.get(`${this.urlConfigs.POOL_LIQUIDITY_LINE||_t.POOL_LIQUIDITY_LINE}?pool_id=${e}`)).data}async getRaydiumTokenPrice(){return this.api.get(this.urlConfigs.PRICE||_t.PRICE)}async getBlockSlotCountForSecond(e){if(!e)return 2;let n=(await this.api.post(e,{id:"getRecentPerformanceSamples",jsonrpc:"2.0",method:"getRecentPerformanceSamples",params:[4]})).result.map(r=>r.numSlots);return n.reduce((r,o)=>r+o,0)/n.length/60}async getChainTimeOffset(){return this.api.get(this.urlConfigs.CHAIN_TIME||_t.CHAIN_TIME)}async getRpcs(){return this.api.get(this.urlConfigs.RPCS||_t.RPCS)}async getTokenList(){return(await this.api.get(this.urlConfigs.TOKEN_LIST||it.TOKEN_LIST,{})).data}async getJupTokenList(e){return this.api.get("/",{baseURL:(this.urlConfigs.JUP_TOKEN_LIST||it.JUP_TOKEN_LIST).replace("{type}",e||"all")})}async getTokenInfo(e){return(await this.api.get((this.urlConfigs.TOKEN_INFO||it.TOKEN_INFO).replace("{mint}",e.toString()))).data}async getPoolList(e={}){let{type:t="all",sort:n="liquidity",order:r="desc",page:o=0}=e;return(await this.api.get((this.urlConfigs.POOL_LIST||it.POOL_LIST).replace("{type}",t).replace("{sort}",n).replace("{order}",r).replace("{page}",String(o)))).data}async searchPoolById(e){let{ids:t}=e;return(await this.api.get((this.urlConfigs.POOL_SEARCH_BY_ID||it.POOL_SEARCH_BY_ID).replace("{ids}",t))).data}async searchPoolByMint(e){let{mint:t,type:n="all",sort:r="liquidity",order:o="desc",page:s=0}=e;return(await this.api.get((this.urlConfigs.POOL_SEARCH_MINT||it.POOL_SEARCH_MINT).replace("{mint1}",t).replace("{type}",n).replace("{sort}",r).replace("{order}",o).replace("{page}",String(s)))).data}async searchPoolByMints(e){let{mint1:t,mint2:n,type:r="all",sort:o="liquidity",order:s="desc",page:a=0}=e,[u,c]=t>n?[t,n]:[n,t];return(await this.api.get((this.urlConfigs.POOL_SEARCH_MINT_2||it.POOL_SEARCH_MINT_2).replace("{mint1}",c).replace("{mint2}",u).replace("{type}",r).replace("{sort}",o).replace("{order}",s).replace("{page}",String(a)))).data}async fetchPoolKeysById(e){let{id:t}=e;if(mi.has(t))return mi.get(t);let n=await this.api.get((this.urlConfigs.POOL_KEY_BY_ID||it.POOL_KEY_BY_ID).replace("{id}",t));return mi.set(t,n.data),n.data}async fetchFarmKeysById(e){let{ids:t}=e;return(await this.api.get((this.urlConfigs.FARM_KEYS||it.FARM_KEYS).replace("{ids}",t))).data}async fetchAvailabilityStatus(){return(await this.api.get(this.urlConfigs.CHECK_AVAILABILITY||it.CHECK_AVAILABILITY)).data}};var Pr="please provide owner in load() initialization or you can set by calling raydium.setOwner(owner)",Wo="please provide connection in load() initialization or set it by raydium.setConnection(connection)";import{createAssociatedTokenAccountInstruction as Pi,TOKEN_PROGRAM_ID as Ft,AccountLayout as dn}from"@solana/spl-token";import{PublicKey as Lr,SystemProgram as pc}from"@solana/web3.js";var di=(...i)=>i.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),he=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=oe(t)}createTxBuilder(e){return this.scope.checkOwner(),new wr({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(di(e))}logInfo(...e){this.logger.info(di(e))}logAndCreateError(...e){let t=di(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{createInitializeAccountInstruction as ac,createCloseAccountInstruction as uc,createTransferInstruction as cc,TOKEN_PROGRAM_ID as mn}from"@solana/spl-token";import{PublicKey as lc,SystemProgram as mc}from"@solana/web3.js";import dc from"bn.js";import{PublicKey as es,Keypair as rc}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ic}from"@solana/spl-token";import oc from"bn.js";import{PublicKey as Hu}from"@solana/web3.js";import Xo,{isBN as zo}from"bn.js";import{bits as vu,BitStructure as rf,blob as Wu,Blob as of,cstr as sf,f32 as af,f32be as uf,f64 as cf,f64be as lf,greedy as mf,Layout as Du,ns64 as df,ns64be as pf,nu64 as qu,nu64be as ff,offset as yf,s16 as bf,s16be as gf,s24 as wf,s24be as kf,s32 as Uu,s32be as hf,s40 as Af,s40be as Pf,s48 as Tf,s48be as If,s8 as xf,seq as Gu,struct as Bf,Structure as Xu,u16 as zu,u16be as Sf,u24 as Kf,u24be as Cf,u32 as Yu,u32be as Lf,u40 as Rf,u40be as Of,u48 as Nf,u48be as _f,u8 as Qu,UInt as ju,union as Mf,Union as Vf,unionLayoutDiscriminator as Ef,utf8 as Ff}from"@solana/buffer-layout";var Tr=Du,Do=Xu;var pi=ju;var qo=Qu,Mt=zu;var fi=Yu;var Uo=qu;var Re=Uu;var Go=Gu;var we=Wu;var yi=vu;var zt=class extends Tr{constructor(t,n,r){super(t,r);this.blob=we(t),this.signed=n}decode(t,n=0){let r=new Xo(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Xo(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}},Ir=class extends Tr{constructor(t){super(8,t);this._lower=yi(fi(),!1),this._upper=yi(fi(),!1)}addBoolean(t){this._lower.fields.length<32?this._lower.addBoolean(t):this._upper.addBoolean(t)}decode(t,n=0){let r=this._lower.decode(t,n),o=this._upper.decode(t,n+this._lower.span);return N(N({},r),o)}encode(t,n,r=0){return this._lower.encode(t,n,r)+this._upper.encode(t,n,r+this._lower.span)}};function v(i){return new pi(1,i)}function De(i){return new pi(4,i)}function g(i){return new zt(8,!1,i)}function X(i){return new zt(16,!1,i)}function Yo(i){return new zt(1,!0,i)}function Br(i){return new zt(8,!0,i)}function Qo(i){return new zt(16,!0,i)}var xr=class extends Tr{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function S(i){return new xr(we(32),e=>new Hu(e),e=>e.toBuffer(),i)}function ze(i){return new xr(qo(),Zu,Ju,i)}function Zu(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function Ju(i){return i?1:0}var bi=class extends Do{decode(e,t){return super.decode(e,t)}};function M(i,e,t){return new bi(i,e,t)}function G(i,e,t){let n,r=typeof e=="number"?e:zo(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=zo(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Go(i,r,t)}var ln=M([S("mint"),S("owner"),g("amount"),De("delegateOption"),S("delegate"),v("state"),De("isNativeOption"),g("isNative"),g("delegatedAmount"),De("closeAuthorityOption"),S("closeAuthority")]);function $u(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}function gi(i,...e){if(!$u(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}function wi(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function jo(i,e){gi(i);let t=e.outputLen;if(i.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var Kr=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),ot=(i,e)=>i<<32-e|i>>>e;var $f=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ec(i){if(typeof i!="string")throw new Error(`utf8ToBytes expected string, got ${typeof i}`);return new Uint8Array(new TextEncoder().encode(i))}function ki(i){return typeof i=="string"&&(i=ec(i)),gi(i),i}var Sr=class{clone(){return this._cloneInto()}},ey={}.toString;function Ho(i){let e=n=>i().update(ki(n)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function tc(i,e,t,n){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,n);let r=BigInt(32),o=BigInt(4294967295),s=Number(t>>r&o),a=Number(t&o),u=n?4:0,c=n?0:4;i.setUint32(e+u,s,n),i.setUint32(e+c,a,n)}var Zo=(i,e,t)=>i&e^~i&t,Jo=(i,e,t)=>i&e^i&t^e&t,Cr=class extends Sr{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Kr(this.buffer)}update(e){wi(this);let{view:t,buffer:n,blockLen:r}=this;e=ki(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(r-this.pos,o-s);if(a===r){let u=Kr(e);for(;r<=o-s;s+=r)this.process(u,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){wi(this),jo(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let m=s;m<r;m++)t[m]=0;tc(n,r-8,BigInt(this.length*8),o),this.process(n,0);let a=Kr(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let c=u/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<c;m++)a.setUint32(4*m,l[m],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:o,destroyed:s,pos:a}=this;return e.length=r,e.pos=a,e.finished=o,e.destroyed=s,r%t&&e.buffer.set(n),e}};var nc=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Vt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Et=new Uint32Array(64),hi=class extends Cr{constructor(){super(64,32,8,!1),this.A=Vt[0]|0,this.B=Vt[1]|0,this.C=Vt[2]|0,this.D=Vt[3]|0,this.E=Vt[4]|0,this.F=Vt[5]|0,this.G=Vt[6]|0,this.H=Vt[7]|0}get(){let{A:e,B:t,C:n,D:r,E:o,F:s,G:a,H:u}=this;return[e,t,n,r,o,s,a,u]}set(e,t,n,r,o,s,a,u){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,t){for(let m=0;m<16;m++,t+=4)Et[m]=e.getUint32(t,!1);for(let m=16;m<64;m++){let d=Et[m-15],p=Et[m-2],y=ot(d,7)^ot(d,18)^d>>>3,f=ot(p,17)^ot(p,19)^p>>>10;Et[m]=f+Et[m-7]+y+Et[m-16]|0}let{A:n,B:r,C:o,D:s,E:a,F:u,G:c,H:l}=this;for(let m=0;m<64;m++){let d=ot(a,6)^ot(a,11)^ot(a,25),p=l+d+Zo(a,u,c)+nc[m]+Et[m]|0,f=(ot(n,2)^ot(n,13)^ot(n,22))+Jo(n,r,o)|0;l=c,c=u,u=a,a=s+p|0,s=o,o=r,r=n,n=p+f|0}n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,o,s,a,u,c,l)}roundClean(){Et.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var $o=Ho(()=>new hi);var gy=oe("Raydium_Util");function ts({owner:i,solAccountResp:e,tokenAccountResp:t}){let n=[],r=[];for(let{pubkey:o,account:s}of t.value){let a=ln.decode(s.data),{mint:u,amount:c}=a;n.push({publicKey:o,mint:u,amount:c,isAssociated:ge(i,u,s.owner).publicKey.equals(o),isNative:!1,programId:s.owner}),r.push({pubkey:o,accountInfo:a,programId:s.owner})}return e&&n.push({mint:es.default,amount:new oc(e.lamports),isNative:!0,programId:e.owner}),{tokenAccounts:n,tokenAccountRawInfos:r}}function Ee({fromPublicKey:i,programId:e=ic}){let t=rc.generate().publicKey.toBase58().slice(0,32);return{publicKey:sc(i,t,e),seed:t}}function sc(i,e,t){let n=Buffer.concat([i.toBuffer(),Buffer.from(e),t.toBuffer()]),r=$o(n);return new es(r)}function Ai(i){let{mint:e,tokenAccount:t,owner:n,programId:r=mn}=i;return ac(t,e,n,r)}function xt(i){let{tokenAccount:e,payer:t,multiSigners:n=[],owner:r,programId:o=mn}=i;return uc(e,t,r,n,o)}async function pt(i){let{connection:e,amount:t,commitment:n,payer:r,owner:o,skipCloseAccount:s}=i,a=await e.getMinimumBalanceForRentExemption(ln.span,n),u=z(t).add(new dc(a)),c=Ee({fromPublicKey:r,programId:mn});return{addresses:{newAccount:c.publicKey},signers:[],instructions:[mc.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:c.seed,newAccountPubkey:c.publicKey,lamports:u.toNumber(),space:ln.span,programId:mn}),Ai({mint:new lc(Le.address),tokenAccount:c.publicKey,owner:o,programId:mn})],instructionTypes:[_.CreateAccount,_.InitAccount],endInstructionTypes:s?[]:[_.CloseAccount],endInstructions:s?[]:[xt({tokenAccount:c.publicKey,payer:r,owner:o})]}}function On({source:i,destination:e,owner:t,amount:n,multiSigners:r=[],tokenProgram:o=mn}){return cc(i,e,t,BigInt(String(n)),r,o)}var Nn=class extends he{constructor(t){super(t);this._tokenAccounts=[];this._tokenAccountRawInfos=[];this._accountListener=[];this._clientOwnedToken=!1;let{tokenAccounts:n,tokenAccountRawInfos:r}=t;this._tokenAccounts=n||[],this._tokenAccountRawInfos=r||[],this._clientOwnedToken=!!(n||r)}get tokenAccounts(){return this._tokenAccounts}get tokenAccountRawInfos(){return this._tokenAccountRawInfos}updateTokenAccount({tokenAccounts:t,tokenAccountRawInfos:n}){return t&&(this._tokenAccounts=t),n&&(this._tokenAccountRawInfos=n),this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=void 0,this._clientOwnedToken=!0,this}addAccountChangeListener(t){return this._accountListener.push(t),this}removeAccountChangeListener(t){return this._accountListener=this._accountListener.filter(n=>n!==t),this}getAssociatedTokenAccount(t,n){return ge(this.scope.ownerPubKey,t,n).publicKey}async fetchWalletTokenAccounts(t){if(this._clientOwnedToken||!(t!=null&&t.forceUpdate)&&this._tokenAccounts.length)return{tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos};this.scope.checkOwner();let r=N(N({},{}),t),[o,s]=await Promise.all([this.scope.connection.getAccountInfo(this.scope.ownerPubKey,r.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:Ft},r.commitment)]),{tokenAccounts:a,tokenAccountRawInfos:u}=ts({owner:this.scope.ownerPubKey,solAccountResp:o,tokenAccountResp:s});return this._tokenAccounts=a,this._tokenAccountRawInfos=u,this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=this.scope.connection.onAccountChange(this.scope.ownerPubKey,()=>this.fetchWalletTokenAccounts({forceUpdate:!0}),"confirmed"),{tokenAccounts:a,tokenAccountRawInfos:u}}async getCreatedTokenAccount({mint:t,programId:n=Ft,associatedOnly:r=!0}){await this.fetchWalletTokenAccounts();let o=this._tokenAccounts.filter(({mint:a})=>a==null?void 0:a.equals(t)).sort((a,u)=>a.amount.lt(u.amount)?1:-1),s=this.getAssociatedTokenAccount(t,n);for(let a of o){let{publicKey:u}=a;if(u)return r&&s.equals(u),u}}async getOrCreateTokenAccount(t){var y,f,b;await this.fetchWalletTokenAccounts();let{mint:n,createInfo:r,associatedOnly:o,owner:s,notUseTokenAccount:a=!1,skipCloseAccount:u=!1,checkCreateATAOwner:c=!1}=t,l=new Lr(t.tokenProgram||Ft),m=this.getAssociatedTokenAccount(n,new Lr(l)),d=(a?[]:this.tokenAccountRawInfos).filter(w=>w.accountInfo.mint.equals(n)&&(!o||w.pubkey.equals(m))).sort((w,A)=>w.accountInfo.amount.lt(A.accountInfo.amount)?1:-1);if(r===void 0||d.length>0)return d.length>0?{account:d[0].pubkey}:{};let p={instructions:[],endInstructions:[],signers:[],instructionTypes:[],endInstructionTypes:[]};if(o){let w=Pi(s,m,s,n,l);if(c){let A=await this.scope.connection.getAccountInfo(m);if(A===null)(y=p.instructions)==null||y.push(w),p.instructionTypes.push(_.CreateATA);else if(!(A.owner.equals(l)&&dn.decode(A.data).mint.equals(n)&&dn.decode(A.data).owner.equals(s)))throw Error(`create ata check error -> mint: ${n.toString()}, ata: ${m.toString()}`)}else p.instructions.push(w),p.instructionTypes.push(_.CreateATA);if(n.equals(Z)&&r.amount){let A=await pt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:r.payer||this.scope.ownerPubKey,amount:(f=r.amount)!=null?f:0,skipCloseAccount:u});p.instructions.push(...A.instructions||[]),p.endInstructions.push(...A.endInstructions||[]),p.instructionTypes.push(...A.instructionTypes||[]),p.endInstructionTypes.push(...A.endInstructionTypes||[]),r.amount&&(p.instructions.push(On({source:A.addresses.newAccount,destination:m,owner:this.scope.ownerPubKey,amount:r.amount,tokenProgram:Ft})),p.instructionTypes.push(_.TransferAmount))}return u||(p.endInstructions.push(xt({owner:s,payer:r.payer||s,tokenAccount:m,programId:l})),p.endInstructionTypes.push(_.CloseAccount)),{account:m,instructionParams:p}}else if(n.equals(Z)){let w=await pt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:r.payer||this.scope.ownerPubKey,amount:(b=r.amount)!=null?b:0,skipCloseAccount:u});return p.instructions.push(...w.instructions||[]),p.endInstructions.push(...w.endInstructions||[]),p.signers.push(...w.signers||[]),p.instructionTypes.push(...w.instructionTypes||[]),p.endInstructionTypes.push(...w.endInstructionTypes||[]),{account:w.addresses.newAccount,instructionParams:p}}else{let w=Ee({fromPublicKey:s,programId:l}),A=await this.scope.connection.getMinimumBalanceForRentExemption(dn.span),k=pc.createAccountWithSeed({fromPubkey:s,basePubkey:s,seed:w.seed,newAccountPubkey:w.publicKey,lamports:A,space:dn.span,programId:l});return p.instructions.push(k,Ai({mint:n,tokenAccount:w.publicKey,owner:this.scope.ownerPubKey,programId:l})),p.instructionTypes.push(_.CreateAccount),p.instructionTypes.push(_.InitAccount),u||(p.endInstructions.push(xt({owner:s,payer:r.payer||s,tokenAccount:w.publicKey,programId:l})),p.endInstructionTypes.push(_.CloseAccount)),{account:w.publicKey,instructionParams:p}}}async checkOrCreateAta({mint:t,programId:n=Ft,autoUnwrapWSOLToSOL:r}){var u;await this.fetchWalletTokenAccounts();let o=(u=this.scope.account.tokenAccounts.find(({mint:c})=>(c==null?void 0:c.toBase58())===t.toBase58()))==null?void 0:u.publicKey,s=this.scope.ownerPubKey,a={};if(!o){let c=this.getAssociatedTokenAccount(t,n),l=await Pi(s,c,s,t,n);a.instructions=[l],a.instructionTypes=[_.CreateATA],o=c}return r&&Z.toBase58()===t.toBase58()&&(a.endInstructions=[xt({owner:s,payer:s,tokenAccount:o,programId:n})],a.endInstructionTypes=[_.CloseAccount]),{pubKey:o,newInstructions:a}}async handleTokenAccount(t){let{side:n,amount:r,mint:o,programId:s=Ft,tokenAccount:a,payer:u=this.scope.ownerPubKey,bypassAssociatedCheck:c,skipCloseAccount:l,checkCreateATAOwner:m}=t,d=this.getAssociatedTokenAccount(o,s);if(new Lr(Z).equals(o)){let p=await pt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:u,amount:r,skipCloseAccount:l});return N({tokenAccount:p.addresses.newAccount},p)}else if(!a||n==="out"&&!d.equals(a)&&!c){let p=[],y=Pi(this.scope.ownerPubKey,d,this.scope.ownerPubKey,o,s);if(m){let f=await this.scope.connection.getAccountInfo(d);if(f===null)p.push(y);else if(!(f.owner.equals(Ft)&&dn.decode(f.data).mint.equals(o)&&dn.decode(f.data).owner.equals(this.scope.ownerPubKey)))throw Error(`create ata check error -> mint: ${o.toString()}, ata: ${d.toString()}`)}else p.push(y);return{tokenAccount:d,instructions:p,instructionTypes:[_.CreateATA]}}return{tokenAccount:a}}async processTokenAccount(t){let{mint:n,programId:r=Ft,amount:o,useSOLBalance:s,handleTokenAccount:a}=t,u,c=this.createTxBuilder();if(n.equals(new Lr(Z))&&s){let l=await this.handleTokenAccount({side:"in",amount:o||0,mint:n,bypassAssociatedCheck:!0,programId:r}),{tokenAccount:d}=l,p=_e(l,["tokenAccount"]);u=d,c.addInstruction(p)}else if(u=await this.getCreatedTokenAccount({mint:n,associatedOnly:!1,programId:r}),!u&&a){let m=await this.scope.account.handleTokenAccount({side:"in",amount:0,mint:n,bypassAssociatedCheck:!0,programId:r}),{tokenAccount:d}=m,p=_e(m,["tokenAccount"]);u=d,c.addInstruction(p)}return N({tokenAccount:u},c.AllTxData)}};import{createAssociatedTokenAccountInstruction as Lc}from"@solana/spl-token";import{PublicKey as pe,SystemProgram as Rc}from"@solana/web3.js";import{PublicKey as is}from"@solana/web3.js";var Ti=M([v("instruction")]),Ii=M([v("instruction")]),fc=M([g("rewardState"),g("rewardOpenTime"),g("rewardEndTime"),g("rewardLastUpdateTime"),g("totalReward"),g("totalRewardEmissioned"),g("rewardClaimed"),g("rewardPerSecond"),X("accRewardPerShare"),S("rewardVault"),S("rewardMint"),S("rewardSender"),g("rewardType"),G(g(),15,"padding")]),yc=M([g("state"),g("nonce"),S("lpVault"),S("rewardVault"),S(),S(),g(),g(),g("totalReward"),X("perShareReward"),g("lastSlot"),g("perSlotReward")]),bc=M([g("state"),g("nonce"),S("lpVault"),S("rewardVaultA"),g("totalRewardA"),X("perShareRewardA"),g("perSlotRewardA"),v("option"),S("rewardVaultB"),we(7),g("totalRewardB"),X("perShareRewardB"),g("perSlotRewardB"),g("lastSlot"),S()]),gc=M([g(),g("state"),g("nonce"),g("validRewardTokenNum"),X("rewardMultiplier"),g("rewardPeriodMax"),g("rewardPeriodMin"),g("rewardPeriodExtend"),S("lpMint"),S("lpVault"),G(fc,5,"rewardInfos"),S("creator"),S(),G(g(),32,"padding")]),wc=new Proxy(yc,{get(i,e,t){return e==="decode"?(...n)=>{let r=i.decode(...n);return q(N({},r),{version:3,rewardInfos:[{rewardVault:r.rewardVault,totalReward:r.totalReward,perSlotReward:r.perSlotReward,perShareReward:r.perShareReward}]})}:Reflect.get(i,e,t)}}),kc=new Proxy(bc,{get(i,e,t){return e==="decode"?(...n)=>{let r=i.decode(...n);return q(N({},r),{version:5,rewardInfos:[{rewardVault:r.rewardVaultA,totalReward:r.totalRewardA,perSlotReward:r.perSlotRewardA,perShareReward:r.perShareRewardA},{rewardVault:r.rewardVaultB,totalReward:r.totalRewardB,perSlotReward:r.perSlotRewardB,perShareReward:r.perShareRewardB}]})}:Reflect.get(i,e,t)}}),Rr=new Proxy(gc,{get(i,e,t){return e==="decode"?(...n)=>{let r=i.decode(...n);return q(N({},r),{version:6,rewardInfos:r.rewardInfos.map(o=>{var s;return q(N({},o),{rewardType:((s=Object.entries(vt).find(a=>String(a[1])===o.rewardType.toString()))!=null?s:["Standard SPL"])[0]})})})}:Reflect.get(i,e,t)}}),hc=M([g("isSet"),g("rewardPerSecond"),g("rewardOpenTime"),g("rewardEndTime"),g("rewardType")]),xi=M([v("instruction"),g("nonce"),G(hc,5,"rewardTimeInfo")]),Bi=M([v("instruction"),g("rewardReopenTime"),g("rewardEndTime"),g("rewardPerSecond")]),Si=M([v("instruction"),g("isSet"),g("rewardPerSecond"),g("rewardOpenTime"),g("rewardEndTime"),g("rewardType")]),jy=M([g("state"),S("id"),S("owner"),g("deposited"),G(g(),1,"rewardDebts")]),Ki=M([g("state"),S("id"),S("owner"),g("deposited"),G(X(),1,"rewardDebts"),g(""),g("voteLockedBalance"),G(g(),15)]),Hy=M([g("state"),S("id"),S("owner"),g("deposited"),G(g(),2,"rewardDebts")]),ns=M([g("state"),S("id"),S("owner"),g("deposited"),G(X(),2,"rewardDebts"),G(g(),17)]),rs=M([g(),g("state"),S("id"),S("owner"),g("deposited"),G(X(),5,"rewardDebts"),G(g(),16)]),He=M([v("instruction"),g("amount")]),Ac=M([S("mint"),S("grantAuthority"),g("baselineVoteWeightScaledFactor"),g("maxExtraLockupVoteWeightScaledFactor"),g("lockupSaturationSecs"),Yo("digitShift"),G(v(),7,"reserved1"),G(g(),7,"reserved2")]),Pc=M([we(8),S("governanceProgramId"),S("realm"),S("realmGoverningTokenMint"),S("realmAuthority"),G(v(),32,"reserved1"),G(Ac,4,"votingMints"),Br("timeOffset"),v("bump"),G(v(),7,"reserved2"),G(g(),11,"reserved3")]),Tc=M([Br("startTime"),Br("endTime"),v("kind"),G(v(),15,"reserved")]),Ic=M([G(Tc,1,"lockup"),g("amountDeposited_native"),g("amountInitiallyLockedNative"),ze("isUsed"),ze("allowClawback"),v("votingMintConfigIdx"),G(v(),29,"reserved")]),xc=M([we(8),S("voterAuthority"),S("registrar"),G(Ic,32,"deposits"),v("voterBump"),v("voterWweightRecordBump"),G(v(),94,"reserved")]);var ib=oe("Raydium_farm_config"),os=new is("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ss=new is("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var as={3:Ki,5:ns,6:rs},Ci=i=>[3,5,6].indexOf(i)!==-1,Li=i=>{var s;let{version:e,rewardInfos:t,rewardTokenAccountsPublicKeys:n}=i,r=`rewardInfo:${JSON.stringify(t)}, rewardAccount:${JSON.stringify(n)}`,o={3:()=>{if(t.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${r}`},5:()=>{if(t.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${r}`},6:()=>{if(!n.length||t.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${r}`}};return(s=o[e])==null?void 0:s.call(o)},vt={"Standard SPL":0,"Option tokens":1},st={[Eo.toString()]:3,[Fo.toString()]:5,[Ln.toString()]:6};import{PublicKey as ue,SystemProgram as ls,SYSVAR_RENT_PUBKEY as Kc,SYSVAR_CLOCK_PUBKEY as Or,TransactionInstruction as at}from"@solana/web3.js";import{createAssociatedTokenAccountInstruction as Mb,TOKEN_PROGRAM_ID as Wt,ASSOCIATED_TOKEN_PROGRAM_ID as Vb}from"@solana/spl-token";import ms from"bn.js";import Bc from"bn.js";var Sc=oe("Raydium.farm.util");function _n({programId:i,poolId:e,mint:t,type:n}){let{publicKey:r}=ye([e.toBuffer(),t.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],i);return r}function ft({programId:i,poolId:e,owner:t,version:n}){let{publicKey:r}=ye([e.toBuffer(),t.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],i);return r}var us=({programId:i,poolId:e})=>ye([e.toBuffer()],i);function cs(i){return{isSet:new Bc(1),rewardPerSecond:z(i.perSecond),rewardOpenTime:z(i.openTime),rewardEndTime:z(i.endTime),rewardType:z(vt[i.rewardType])}}function Ri(i){return z(i.endTime).sub(z(i.openTime)).mul(z(i.perSecond))}function Oi(i){let e=as[i];return e||Sc.logWithError("invalid version",i),e}var Cc=oe("Raydium_farm_instruction"),jb={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function ds(i){let{version:e,id:t,ledger:n,programId:r,owner:o}=i,s={3:9,5:10}[e];s||Cc.logWithError(`invalid farm pool version: ${e}`);let a=Buffer.alloc(Ti.span);Ti.encode({instruction:s},a);let u=[h({pubkey:t}),h({pubkey:n}),h({pubkey:o,isWritable:!1}),h({pubkey:ls.programId,isWritable:!1}),h({pubkey:Kc,isWritable:!1})];return{instruction:new at({programId:r,keys:u,data:a}),instructionType:_.FarmV3CreateLedger}}function ps(i){var n;let e=Buffer.alloc(xi.span);xi.encode({instruction:0,nonce:new ms(i.nonce),rewardTimeInfo:i.rewardInfoConfig},e);let t=[...Zr,h({pubkey:i.farmId}),h({pubkey:i.farmAuthority,isWritable:!1}),h({pubkey:i.lpVault}),h({pubkey:i.lpMint,isWritable:!1}),h({pubkey:i.lockVault}),h({pubkey:i.lockMint,isWritable:!1}),h({pubkey:(n=i.lockUserAccount)!=null?n:le}),h({pubkey:i.owner,isWritable:!1,isSigner:!0})];for(let r of i.rewardInfo)t.push(h({pubkey:r.rewardMint,isWritable:!1}),h({pubkey:r.rewardVault}),h({pubkey:r.userRewardToken}));return{instruction:new at({programId:i.programId,keys:t,data:e}),instructionType:_.FarmV6Create}}function fs(i){let e=Buffer.alloc(Ii.span);Ii.encode({instruction:5},e);let t=[h({pubkey:Wt,isWritable:!1}),h({pubkey:i.id}),h({pubkey:i.authority,isWritable:!1}),h({pubkey:i.lpVault,isWritable:!1}),h({pubkey:i.rewardVault}),h({pubkey:i.userRewardToken}),h({pubkey:i.owner,isWritable:!1,isSigner:!0})];return{instruction:new at({programId:i.programId,keys:t,data:e}),instructionType:_.FarmV6CreatorWithdraw}}function Ni({payer:i,rewardVault:e,userRewardTokenPub:t,farmKeys:n,rewardInfo:r}){let o=Buffer.alloc(Bi.span);Bi.encode({instruction:3,rewardReopenTime:z(r.openTime),rewardEndTime:z(r.endTime),rewardPerSecond:z(r.perSecond)},o);let s=[h({pubkey:Wt,isWritable:!1}),h({pubkey:n.id}),h({pubkey:n.lpVault,isWritable:!1}),h({pubkey:e}),h({pubkey:t}),h({pubkey:i,isWritable:!1,isSigner:!0})];return new at({programId:n.programId,keys:s,data:o})}function _i({payer:i,userRewardTokenPub:e,farmKeys:t,rewardVault:n,rewardInfo:r}){let o=Buffer.alloc(Si.span);Si.encode({instruction:4,isSet:new ms(1),rewardPerSecond:z(r.perSecond),rewardOpenTime:z(r.openTime),rewardEndTime:z(r.endTime),rewardType:z(vt[r.rewardType])},o);let s=[...Zr,h({pubkey:t.id}),h({pubkey:t.authority,isWritable:!1}),h({pubkey:r.mint,isWritable:!1}),h({pubkey:n}),h({pubkey:e}),h({pubkey:i,isWritable:!1,isSigner:!0})];return new at({programId:t.programId,keys:s,data:o})}function Mn(i){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:r,owner:o,amount:s}=i,[a,u]=[new ue(e.programId),new ue(e.id)],c=ft({programId:a,poolId:u,owner:o,version:6}),l=Buffer.alloc(He.span);He.encode({instruction:2,amount:z(s)},l);let m=[h({pubkey:Wt,isWritable:!1}),h({pubkey:u}),h({pubkey:new ue(t.authority),isWritable:!1}),h({pubkey:new ue(t.lpVault)}),h({pubkey:c}),h({pubkey:o,isWritable:!1,isSigner:!0}),h({pubkey:n})];for(let d=0;d<t.rewardInfos.length;d++)m.push(h({pubkey:new ue(t.rewardInfos[d].vault)})),m.push(h({pubkey:r[d]}));return new at({programId:a,keys:m,data:l})}function Vn(i){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:r,owner:o,amount:s,userAuxiliaryLedgers:a}=i,[u,c]=[new ue(e.programId),new ue(e.id)],l=ft({programId:u,poolId:c,owner:o,version:5}),m=Buffer.alloc(He.span);He.encode({instruction:12,amount:z(s)},m);let d=[h({pubkey:c}),h({pubkey:new ue(t.authority),isWritable:!1}),h({pubkey:l}),h({pubkey:o,isWritable:!1,isSigner:!0}),h({pubkey:n}),h({pubkey:new ue(t.lpVault)}),h({pubkey:r[0]}),h({pubkey:new ue(t.rewardInfos[0].vault)}),h({pubkey:Or,isWritable:!1}),h({pubkey:Wt,isWritable:!1})];for(let p=1;p<t.rewardInfos.length;p++)d.push(h({pubkey:r[p]})),d.push(h({pubkey:new ue(t.rewardInfos[p].vault)}));if(a)for(let p of a)d.push(h({pubkey:p}));return new at({programId:u,keys:d,data:m})}function En(i){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:r,owner:o,amount:s,userAuxiliaryLedgers:a}=i,[u,c]=[new ue(e.programId),new ue(e.id)],l=ft({programId:u,poolId:c,owner:o,version:3}),m=Buffer.alloc(He.span);He.encode({instruction:11,amount:z(s)},m);let d=[h({pubkey:c}),h({pubkey:new ue(t.authority),isWritable:!1}),h({pubkey:l}),h({pubkey:o,isWritable:!1,isSigner:!0}),h({pubkey:n}),h({pubkey:new ue(t.lpVault)}),h({pubkey:r[0]}),h({pubkey:new ue(t.rewardInfos[0].vault)}),h({pubkey:Or,isWritable:!1}),h({pubkey:Wt,isWritable:!1})];if(a)for(let p of a)d.push(h({pubkey:p}));return new at({programId:u,keys:d,data:m})}function ys(i){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:r,owner:o,amount:s,userAuxiliaryLedgers:a}=i,[u,c]=[new ue(e.programId),new ue(e.id)],l=ft({programId:u,poolId:c,owner:o,version:3}),m=Buffer.alloc(He.span);He.encode({instruction:10,amount:z(s)},m);let d=[h({pubkey:c}),h({pubkey:new ue(t.authority),isWritable:!1}),h({pubkey:l}),h({pubkey:o,isWritable:!1,isSigner:!0}),h({pubkey:n}),h({pubkey:new ue(t.lpVault)}),h({pubkey:r[0]}),h({pubkey:new ue(t.rewardInfos[0].vault)}),h({pubkey:Or,isWritable:!1}),h({pubkey:Wt,isWritable:!1})];if(a)for(let p of a)d.push(h({pubkey:p}));return new at({programId:u,keys:d,data:m})}function bs(i){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:r,owner:o,amount:s,userAuxiliaryLedgers:a}=i,[u,c]=[new ue(e.programId),new ue(e.id)],l=ft({programId:u,poolId:c,owner:o,version:5}),m=Buffer.alloc(He.span);He.encode({instruction:11,amount:z(s)},m);let d=[h({pubkey:c}),h({pubkey:new ue(t.authority),isWritable:!1}),h({pubkey:l}),h({pubkey:o,isWritable:!1,isSigner:!0}),h({pubkey:n}),h({pubkey:new ue(t.lpVault)}),h({pubkey:r[0]}),h({pubkey:new ue(t.rewardInfos[0].vault)}),h({pubkey:Or,isWritable:!1}),h({pubkey:Wt,isWritable:!1})];for(let p=1;p<t.rewardInfos.length;p++)d.push(h({pubkey:r[p]})),d.push(h({pubkey:new ue(t.rewardInfos[p].vault)}));if(a)for(let p of a)d.push(h({pubkey:p}));return new at({programId:u,keys:d,data:m})}function gs(i){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:r,owner:o,amount:s}=i,[a,u]=[new ue(e.programId),new ue(e.id)],c=ft({programId:a,poolId:u,owner:o,version:6}),l=Buffer.alloc(He.span);He.encode({instruction:1,amount:z(s)},l);let m=[h({pubkey:Wt,isWritable:!1}),h({pubkey:ls.programId,isWritable:!1}),h({pubkey:u}),h({pubkey:new ue(t.authority),isWritable:!1}),h({pubkey:new ue(t.lpVault)}),h({pubkey:c}),h({pubkey:o,isWritable:!1,isSigner:!0}),h({pubkey:n})];for(let d=0;d<t.rewardInfos.length;d++)m.push(h({pubkey:new ue(t.rewardInfos[d].vault)})),m.push(h({pubkey:r[d]}));return new at({programId:a,keys:m,data:l})}var Fn=class extends he{async _getUserRewardInfo({payer:e,rewardInfo:t}){if(t.mint.equals(le)){let n=await pt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:e,amount:Ri(t)});return{rewardPubKey:n.addresses.newAccount,newInstruction:n}}return{rewardPubKey:await this.scope.account.getCreatedTokenAccount({mint:t.mint,associatedOnly:!1})}}async create({poolInfo:e,rewardInfos:t,payer:n,programId:r=Ln,txVersion:o}){this.checkDisabled(),this.scope.checkOwner();let a={lpMint:new pe(e.lpMint.address),lockInfo:{lockMint:os,lockVault:ss},version:6,rewardInfos:t,programId:r},u=this.createTxBuilder(),c=n!=null?n:this.scope.ownerPubKey,l=Ee({fromPublicKey:c,programId:a.programId}),m=await this.scope.connection.getMinimumBalanceForRentExemption(Rr.span);u.addInstruction({instructions:[Rc.createAccountWithSeed({fromPubkey:c,basePubkey:c,seed:l.seed,newAccountPubkey:l.publicKey,lamports:m,space:Rr.span,programId:a.programId})]});let{publicKey:d,nonce:p}=us({programId:new pe(a.programId),poolId:l.publicKey}),y=_n({programId:a.programId,poolId:l.publicKey,mint:a.lpMint,type:"lpVault"}),f=[],b=[];for(let P of a.rewardInfos){P.openTime>=P.endTime&&this.logAndCreateError("start time error","rewardInfo.rewardOpenTime",P.openTime.toString()),isNaN(vt[P.rewardType])&&this.logAndCreateError("rewardType error",P.rewardType),Number(P.perSecond)<=0&&this.logAndCreateError("rewardPerSecond error",P.perSecond),f.push(cs(P));let{rewardPubKey:T,newInstruction:I}=await this._getUserRewardInfo({rewardInfo:P,payer:c});I&&u.addInstruction(I),T||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let x=P.mint.equals(le)?new pe(Le.address):P.mint;b.push({rewardMint:x,rewardVault:_n({programId:a.programId,poolId:l.publicKey,mint:x,type:"rewardVault"}),userRewardToken:T})}let w=await this.scope.account.getCreatedTokenAccount({mint:a.lockInfo.lockMint});w||this.logAndCreateError("cannot found lock vault","tokenAccounts",this.scope.account.tokenAccounts);let{instruction:A,instructionType:k}=ps({farmId:l.publicKey,owner:this.scope.ownerPubKey,farmAuthority:d,lpVault:y,lpMint:a.lpMint,lockVault:a.lockInfo.lockVault,lockMint:a.lockInfo.lockMint,lockUserAccount:w,programId:a.programId,rewardInfo:b,rewardInfoConfig:f,nonce:p});return u.addInstruction({instructions:[A],instructionTypes:[k]}).versionBuild({txVersion:o,extInfo:{farmId:l.publicKey,farmAuthority:d,lpVault:y,lockUserAccount:w,nonce:p}})}async restartReward({farmInfo:e,payer:t,newRewardInfo:n,txVersion:r}){var b;let o=st[e.programId];o!==6&&this.logAndCreateError("invalid farm version ",o);let s=Pe((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),a={id:s.id,rewardInfos:e.rewardInfos,lpVault:s.lpVault,programId:s.programId};n.openTime>=n.endTime&&this.logAndCreateError("start time error","newRewardInfo",n);let u=t||this.scope.ownerPubKey,c=n.mint.equals(le)?new pe(Le.address):n.mint,l=a.rewardInfos.findIndex(w=>new pe(w.mint.address).equals(c)),m=s.rewardInfos[l];m||this.logAndCreateError("configuration does not exist","rewardMint",c);let d=(b=m.vault)!=null?b:le,p=this.createTxBuilder(),{rewardPubKey:y,newInstruction:f}=await this._getUserRewardInfo({rewardInfo:n,payer:u});return f&&p.addInstruction(f),y||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts),p.addInstruction({instructions:[Ni({payer:this.scope.ownerPubKey,rewardVault:d,userRewardTokenPub:y,farmKeys:a,rewardInfo:n})],instructionTypes:[_.FarmV6Restart]}).versionBuild({txVersion:r})}async restartRewards({farmInfo:e,payer:t,newRewardInfos:n,txVersion:r}){var l;let o=st[e.programId];o!==6&&this.logAndCreateError("invalid farm version ",o);let s=Pe((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),a={id:s.id,rewardInfos:e.rewardInfos,lpVault:s.lpVault,programId:s.programId};n.forEach(m=>{m.openTime>=m.endTime&&this.logAndCreateError("start time error","newRewardInfo",m)});let u=t||this.scope.ownerPubKey,c=this.createTxBuilder();for(let m of n){let d=m.mint.equals(le)?new pe(Le.address):m.mint,p=a.rewardInfos.findIndex(k=>new pe(k.mint.address).equals(d)),y=s.rewardInfos[p];y||this.logAndCreateError("configuration does not exist","rewardMint",d);let f=(l=y.vault)!=null?l:le,{rewardPubKey:b,newInstruction:w}=await this._getUserRewardInfo({rewardInfo:m,payer:u});w&&c.addInstruction(w),b||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let A=Ni({payer:this.scope.ownerPubKey,rewardVault:f,userRewardTokenPub:b,farmKeys:a,rewardInfo:m});c.addInstruction({instructions:[A],instructionTypes:[_.FarmV6Restart]})}return c.versionBuild({txVersion:r})}async addNewRewardToken(e){let{txVersion:t,farmInfo:n,newRewardInfo:r,payer:o}=e,s=st[n.programId];s!==6&&this.logAndCreateError("invalid farm version ",s);let a=Pe((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),u=o!=null?o:this.scope.ownerPubKey,c=this.createTxBuilder(),l=r.mint.equals(le)?new pe(Le.address):r.mint,m=_n({programId:new pe(n.programId),poolId:new pe(n.id),mint:l,type:"rewardVault"}),{rewardPubKey:d,newInstruction:p}=await this._getUserRewardInfo({rewardInfo:r,payer:u});return p&&c.addInstruction(p),d||this.logAndCreateError("annot found target token accounts",this.scope.account.tokenAccounts),r.mint=l,c.addInstruction({instructions:[_i({payer:this.scope.ownerPubKey,userRewardTokenPub:d,farmKeys:a,rewardVault:m,rewardInfo:r})],instructionTypes:[_.FarmV6CreatorAddReward]}).versionBuild({txVersion:t})}async addNewRewardsToken(e){let{txVersion:t,farmInfo:n,newRewardInfos:r,payer:o}=e,s=st[n.programId];s!==6&&this.logAndCreateError("invalid farm version ",s);let a=Pe((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),u=o!=null?o:this.scope.ownerPubKey,c=this.createTxBuilder();for(let l of r){let m=l.mint.equals(le)?new pe(Le.address):l.mint,d=_n({programId:new pe(n.programId),poolId:new pe(n.id),mint:m,type:"rewardVault"}),{rewardPubKey:p,newInstruction:y}=await this._getUserRewardInfo({rewardInfo:l,payer:u});y&&c.addInstruction(y),p||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let f=_i({payer:this.scope.ownerPubKey,userRewardTokenPub:p,farmKeys:a,rewardVault:d,rewardInfo:q(N({},l),{mint:m})});c.addInstruction({instructions:[f],instructionTypes:[_.FarmV6CreatorAddReward]})}return c.versionBuild({txVersion:t})}async deposit(e){let{txVersion:t,farmInfo:n,amount:r,feePayer:o,useSOLBalance:s,associatedOnly:a=!0,checkCreateATAOwner:u=!1,userAuxiliaryLedgers:c,computeBudgetConfig:l}=e;this.scope.availability.addFarm===!1&&this.logAndCreateError("farm deposit feature disabled in your region");let{rewardInfos:m,programId:d}=n,p=st[d];Ci(p)||this.logAndCreateError("invalid farm program:",n.programId);let[y,f]=[new pe(n.programId),new pe(n.id)],b=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],w=ft({programId:y,poolId:f,owner:this.scope.ownerPubKey,version:p}),A=this.createTxBuilder();A.addCustomComputeBudget(l);let k={};for(let W of this.scope.account.tokenAccounts)if(a){let $=ge(this.scope.ownerPubKey,W.mint,W.programId).publicKey;W.publicKey&&$.equals(W.publicKey)&&(k[W.mint.toString()]=W.publicKey)}else k[W.mint.toString()]=W.publicKey;let P=b.lpMint,T=k[P.address];T||this.logAndCreateError("you don't have any lp","lp zero",k);let I=[];for(let W of m){let $=s&&W.mint.address===Z.toString(),Q=k[W.mint.address];if(!Q){let{account:te,instructionParams:et}=await this.scope.account.getOrCreateTokenAccount({mint:new pe(W.mint.address),notUseTokenAccount:$,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!$,associatedOnly:$?!1:a,checkCreateATAOwner:u});Q=te,et&&A.addInstruction(et)}k[W.mint.address]=Q,I.push(Q)}let x,L=await this.scope.connection.getAccountInfo(w);if(L&&(x=Oi(p).decode(L.data)),n.programId!==Ln.toString()&&!x){let{instruction:W,instructionType:$}=ds({id:f,programId:y,version:p,ledger:w,owner:this.scope.ownerPubKey});A.addInstruction({instructions:[W],instructionTypes:[$]})}let O=Li({version:p,rewardInfos:m,rewardTokenAccountsPublicKeys:I});O&&this.logAndCreateError(O);let R={amount:z(r),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:b,lpAccount:T,rewardAccounts:I,userAuxiliaryLedgers:c==null?void 0:c.map(W=>new pe(W))},E=p===6?gs(R):p===5?bs(R):ys(R),ee={3:_.FarmV3Deposit,5:_.FarmV5Deposit,6:_.FarmV6Deposit};return A.addInstruction({instructions:[E],instructionTypes:[ee[p]]}).versionBuild({txVersion:t})}async withdraw(e){let{txVersion:t,farmInfo:n,amount:r,deposited:o,useSOLBalance:s,feePayer:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,userAuxiliaryLedgers:l,computeBudgetConfig:m}=e,{rewardInfos:d}=n;this.scope.availability.removeFarm===!1&&this.logAndCreateError("farm withdraw feature disabled in your region");let p=st[n.programId];Ci(p)||this.logAndCreateError("invalid farm program:",n.programId);let y=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],f=this.createTxBuilder();f.addCustomComputeBudget(m);let b={};for(let O of this.scope.account.tokenAccounts)if(u){let R=ge(this.scope.ownerPubKey,O.mint).publicKey;O.publicKey&&R.equals(O.publicKey)&&(b[O.mint.toString()]=O.publicKey)}else b[O.mint.toString()]=O.publicKey;if(o)o.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id});else{let O=ft({programId:new pe(n.programId),poolId:new pe(n.id),owner:this.scope.ownerPubKey,version:p}),R=await this.scope.connection.getAccountInfo(O);R||this.logAndCreateError("no lp data",{farmId:n.id,version:p,ledgerData:R}),Oi(p).decode(R.data).deposited.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id})}let w=y.lpMint.address,A=s&&w===Z.toString(),k=b[w.toString()];if(!k){let{account:O,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({mint:new pe(w),notUseTokenAccount:A,createInfo:{payer:a||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:A?!1:u,checkCreateATAOwner:c});k=O,R&&f.addInstruction(R)}b[w.toString()]=k;let P=[];for(let O of d){let R=s&&O.mint.address===Z.toString(),E=b[O.mint.address];if(!E){let{account:ee,instructionParams:W}=await this.scope.account.getOrCreateTokenAccount({mint:new pe(O.mint.address),notUseTokenAccount:R,createInfo:{payer:a||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!R,associatedOnly:R?!1:u,checkCreateATAOwner:c});E=ee,W&&f.addInstruction(W)}b[O.mint.address]=E,P.push(E)}let T=Li({version:p,rewardInfos:d,rewardTokenAccountsPublicKeys:P});T&&this.logAndCreateError(T);let I={amount:z(r),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:y,lpAccount:k,rewardAccounts:P,userAuxiliaryLedgers:l==null?void 0:l.map(O=>new pe(O))},x=p===6?Mn(I):p===5?Vn(I):En(I),L={3:_.FarmV3Withdraw,5:_.FarmV5Withdraw,6:_.FarmV6Withdraw};return f.addInstruction({instructions:[x],instructionTypes:[L[p]]}).versionBuild({txVersion:t})}async withdrawFarmReward({farmInfo:e,withdrawMint:t,txVersion:n}){var p;this.scope.checkOwner();let r=Pe((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),o=st[e.programId];o!==6&&this.logAndCreateError("invalid farm version",o);let s=e.rewardInfos.findIndex(y=>y.mint.address===le.toString()?new pe(Le.address):t),a=r.rewardInfos[s];a||this.logAndCreateError("withdraw mint error","rewardInfos",e);let u=(p=a==null?void 0:a.vault)!=null?p:le,c=this.createTxBuilder(),l;if(t.equals(le)){let y=await pt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:Ri(q(N({},a),{perSecond:new F(a.perSecond).mul(10**a.mint.decimals).toString()}))});l=y.addresses.newAccount,c.addInstruction(y)}else{let y=await this.scope.account.getCreatedTokenAccount({mint:t});y===null?(l=await this.scope.account.getAssociatedTokenAccount(t),c.addInstruction({instructions:[Lc(this.scope.ownerPubKey,l,this.scope.ownerPubKey,t)],instructionTypes:[_.CreateATA]})):l=y}let{instruction:m,instructionType:d}=fs({programId:r.programId,id:r.id,authority:r.authority,lpVault:r.lpVault,rewardVault:u,userRewardToken:l,owner:this.scope.ownerPubKey});return c.addInstruction({instructions:[m],instructionTypes:[d]}).versionBuild({txVersion:n})}async harvestAllRewards(e){let{farmInfoList:t,useSOLBalance:n,feePayer:r,associatedOnly:o=!0,checkCreateATAOwner:s=!1,userAuxiliaryLedgers:a,txVersion:u,computeBudgetConfig:c}=e,l=this.createTxBuilder();l.addCustomComputeBudget(c);let m={};for(let y of this.scope.account.tokenAccounts)if(o){let f=ge(this.scope.ownerPubKey,y.mint).publicKey;y.publicKey&&f.equals(y.publicKey)&&(m[y.mint.toString()]=y.publicKey)}else m[y.mint.toString()]=y.publicKey;let p=(await this.scope.api.fetchFarmKeysById({ids:Object.values(t).map(y=>y.id).join(",")})).reduce((y,f)=>q(N({},y),{[f.id]:f}),{});for(let y of Object.values(t)){let{programId:f,lpMint:b,rewardInfos:w,id:A}=y,k=st[f],P=b.address,T=n&&P===Z.toString(),I=m[P];if(!I){let{account:ee,instructionParams:W}=await this.scope.account.getOrCreateTokenAccount({mint:new pe(P),notUseTokenAccount:T,createInfo:{payer:r||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:T?!1:o,checkCreateATAOwner:s});I=ee,W&&l.addInstruction(W)}m[P.toString()]=I;let x=[];for(let ee of w){let W=n&&ee.mint.address===Z.toString(),$=m[ee.mint.address];if(!$){let{account:Q,instructionParams:te}=await this.scope.account.getOrCreateTokenAccount({mint:new pe(ee.mint.address),notUseTokenAccount:W,createInfo:{payer:r||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!W,associatedOnly:W?!1:o,checkCreateATAOwner:s});$=Q,te&&l.addInstruction(te)}m[ee.mint.address]=$,x.push($)}let L=p[A],O={amount:Ge,owner:this.scope.ownerPubKey,farmInfo:y,farmKeys:L,lpAccount:I,rewardAccounts:x,userAuxiliaryLedgers:a==null?void 0:a.map(ee=>new pe(ee))},R=k===6?Mn(O):k===5?Vn(O):En(O),E={3:_.FarmV3Withdraw,5:_.FarmV5Withdraw,6:_.FarmV6Withdraw};l.addInstruction({instructions:[R],instructionTypes:[E[k]]})}return u===1?l.sizeCheckBuild():l.sizeCheckBuildV0()}};import{PublicKey as qt}from"@solana/web3.js";import{NATIVE_MINT as zs,TOKEN_PROGRAM_ID as Fr}from"@solana/spl-token";var wg=M([De("mintAuthorityOption"),S("mintAuthority"),g("supply"),v("decimals"),v("isInitialized"),De("freezeAuthorityOption"),S("freezeAuthority")]);import{PublicKey as Pg}from"@solana/web3.js";import{MintLayout as Ig,TOKEN_PROGRAM_ID as Bg}from"@solana/spl-token";var ws=i=>new ce({mint:i.address,decimals:i.decimals,symbol:i.symbol,name:i.name});import{TOKEN_PROGRAM_ID as Nr,ASSOCIATED_TOKEN_PROGRAM_ID as Vc}from"@solana/spl-token";import{PublicKey as yt,TransactionInstruction as pn,SystemProgram as As,SYSVAR_RENT_PUBKEY as Qg}from"@solana/web3.js";var Mi=M([v("instruction"),g("amountIn"),g("minAmountOut")]),Vi=M([v("instruction"),g("maxAmountIn"),g("amountOut")]),Eg=M([v("instruction"),v("nonce")]),Oc=M([v("instruction"),v("nonce"),g("startTime")]),Fg=M([g("status"),g("nonce"),g("maxOrder"),g("depth"),g("baseDecimal"),g("quoteDecimal"),g("state"),g("resetFlag"),g("minSize"),g("volMaxCutRatio"),g("amountWaveRatio"),g("baseLotSize"),g("quoteLotSize"),g("minPriceMultiplier"),g("maxPriceMultiplier"),g("systemDecimalValue"),g("minSeparateNumerator"),g("minSeparateDenominator"),g("tradeFeeNumerator"),g("tradeFeeDenominator"),g("pnlNumerator"),g("pnlDenominator"),g("swapFeeNumerator"),g("swapFeeDenominator"),g("baseNeedTakePnl"),g("quoteNeedTakePnl"),g("quoteTotalPnl"),g("baseTotalPnl"),g("poolOpenTime"),g("punishPcAmount"),g("punishCoinAmount"),g("orderbookToInitTime"),X("swapBaseInAmount"),X("swapQuoteOutAmount"),g("swapBase2QuoteFee"),X("swapQuoteInAmount"),X("swapBaseOutAmount"),g("swapQuote2BaseFee"),S("baseVault"),S("quoteVault"),S("baseMint"),S("quoteMint"),S("lpMint"),S("openOrders"),S("marketId"),S("marketProgramId"),S("targetOrders"),S("withdrawQueue"),S("lpVault"),S("owner"),g("lpReserve"),G(g(),3,"padding")]),vg=M([g("accountType"),g("status"),g("nonce"),g("maxOrder"),g("depth"),g("baseDecimal"),g("quoteDecimal"),g("state"),g("resetFlag"),g("minSize"),g("volMaxCutRatio"),g("amountWaveRatio"),g("baseLotSize"),g("quoteLotSize"),g("minPriceMultiplier"),g("maxPriceMultiplier"),g("systemDecimalsValue"),g("abortTradeFactor"),g("priceTickMultiplier"),g("priceTick"),g("minSeparateNumerator"),g("minSeparateDenominator"),g("tradeFeeNumerator"),g("tradeFeeDenominator"),g("pnlNumerator"),g("pnlDenominator"),g("swapFeeNumerator"),g("swapFeeDenominator"),g("baseNeedTakePnl"),g("quoteNeedTakePnl"),g("quoteTotalPnl"),g("baseTotalPnl"),g("poolOpenTime"),g("punishPcAmount"),g("punishCoinAmount"),g("orderbookToInitTime"),X("swapBaseInAmount"),X("swapQuoteOutAmount"),X("swapQuoteInAmount"),X("swapBaseOutAmount"),g("swapQuote2BaseFee"),g("swapBase2QuoteFee"),S("baseVault"),S("quoteVault"),S("baseMint"),S("quoteMint"),S("lpMint"),S("modelDataAccount"),S("openOrders"),S("marketId"),S("marketProgramId"),S("targetOrders"),S("owner"),G(g(),64,"padding")]),Ei=M([v("instruction"),g("baseAmountIn"),g("quoteAmountIn"),g("fixedSide")]),Fi=M([v("instruction"),g("amountIn")]);var ks=M([g("fee")]);import{PublicKey as Nc}from"@solana/web3.js";var vn=new Nc("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),_c=5e4,Mc=M([g("x"),g("y"),g("price")]),Gg=M([g("accountType"),g("status"),g("multiplier"),g("validDataCount"),G(Mc,_c,"DataElement")]);var hs=oe("Raydium_liquidity_instruction");function Ps(i){let{poolInfo:e,poolKeys:t,userKeys:n,baseAmountIn:r,quoteAmountIn:o,fixedSide:s}=i,a=Buffer.alloc(Ei.span);Ei.encode({instruction:3,baseAmountIn:z(r),quoteAmountIn:z(o),fixedSide:s==="base"?Ge:mr},a);let u=[h({pubkey:Nr,isWritable:!1}),h({pubkey:new yt(e.id)}),h({pubkey:new yt(t.authority),isWritable:!1}),h({pubkey:new yt(t.openOrders),isWritable:!1}),h({pubkey:new yt(t.targetOrders)}),h({pubkey:new yt(e.lpMint.address)}),h({pubkey:new yt(t.vault.A)}),h({pubkey:new yt(t.vault.B)})];return e.pooltype.includes("StablePool")&&u.push(h({pubkey:vn})),u.push(h({pubkey:new yt(e.marketId),isWritable:!1}),h({pubkey:n.baseTokenAccount}),h({pubkey:n.quoteTokenAccount}),h({pubkey:n.lpTokenAccount}),h({pubkey:n.owner,isWritable:!1,isSigner:!0}),h({pubkey:new yt(t.marketEventQueue),isWritable:!1})),new pn({programId:new yt(e.programId),keys:u,data:a})}function vi(i){let{poolInfo:e,poolKeys:t,userKeys:n,amountIn:r}=i,o=Pe(t),s=4;if(e.pooltype.includes("StablePool")&&(s=5),s===4||s===5){let a=Buffer.alloc(Fi.span);Fi.encode({instruction:4,amountIn:z(r)},a);let u=[h({pubkey:Nr,isWritable:!1}),h({pubkey:o.id}),h({pubkey:o.authority,isWritable:!1}),h({pubkey:o.openOrders}),h({pubkey:o.targetOrders}),h({pubkey:o.mintLp.address}),h({pubkey:o.vault.A}),h({pubkey:o.vault.B})];return s===5?u.push(h({pubkey:vn})):(u.push(h({pubkey:o.withdrawQueue})),u.push(h({pubkey:o.vault.Lp}))),u.push(h({pubkey:o.marketProgramId,isWritable:!1}),h({pubkey:o.marketId}),h({pubkey:o.marketBaseVault}),h({pubkey:o.marketQuoteVault}),h({pubkey:o.marketAuthority,isWritable:!1}),h({pubkey:n.lpTokenAccount}),h({pubkey:n.baseTokenAccount}),h({pubkey:n.quoteTokenAccount}),h({pubkey:n.owner,isWritable:!1,isSigner:!0}),h({pubkey:o.marketEventQueue}),h({pubkey:o.marketBids}),h({pubkey:o.marketAsks})),new pn({programId:o.programId,keys:u,data:a})}return new pn({programId:o.programId,keys:[]})}function Ts({programId:i,ammId:e,ammAuthority:t,ammOpenOrders:n,lpMint:r,coinMint:o,pcMint:s,coinVault:a,pcVault:u,withdrawQueue:c,ammTargetOrders:l,poolTempLp:m,marketProgramId:d,marketId:p,userWallet:y,userCoinVault:f,userPcVault:b,userLpVault:w,nonce:A,openTime:k,coinAmount:P,pcAmount:T,ammConfigId:I,feeDestinationId:x}){let L=M([v("instruction"),v("nonce"),g("openTime"),g("pcAmount"),g("coinAmount")]),O=[{pubkey:Nr,isSigner:!1,isWritable:!1},{pubkey:Vc,isSigner:!1,isWritable:!1},{pubkey:As.programId,isSigner:!1,isWritable:!1},{pubkey:It,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:I,isSigner:!1,isWritable:!1},{pubkey:x,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!0,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:w,isSigner:!1,isWritable:!0}],R=Buffer.alloc(L.span);return L.encode({instruction:1,nonce:A,openTime:k,coinAmount:P,pcAmount:T},R),{instruction:new pn({keys:O,programId:i,data:R}),instructionType:_.AmmV4CreatePool}}function Ec({poolKeys:i,userKeys:e,amountIn:t,minAmountOut:n},r){let o=Pe(i),s=Buffer.alloc(Mi.span);Mi.encode({instruction:9,amountIn:z(t),minAmountOut:z(n)},s);let a=[h({pubkey:Nr,isWritable:!1}),h({pubkey:o.id}),h({pubkey:o.authority,isWritable:!1}),h({pubkey:o.openOrders})];return r===4&&a.push(h({pubkey:o.targetOrders})),a.push(h({pubkey:o.vault.A}),h({pubkey:o.vault.B})),r===5&&a.push(h({pubkey:vn})),a.push(h({pubkey:o.marketProgramId,isWritable:!1}),h({pubkey:o.marketId}),h({pubkey:o.marketBids}),h({pubkey:o.marketAsks}),h({pubkey:o.marketEventQueue}),h({pubkey:o.marketBaseVault}),h({pubkey:o.marketQuoteVault}),h({pubkey:o.marketAuthority,isWritable:!1}),h({pubkey:e.tokenAccountIn}),h({pubkey:e.tokenAccountOut}),h({pubkey:e.owner,isWritable:!1})),new pn({programId:o.programId,keys:a,data:s})}function Fc({poolKeys:i,userKeys:e,maxAmountIn:t,amountOut:n},r){let o=Pe(i),s=Buffer.alloc(Vi.span);Vi.encode({instruction:11,maxAmountIn:z(t),amountOut:z(n)},s);let a=[h({pubkey:As.programId,isWritable:!1}),h({pubkey:o.id}),h({pubkey:o.authority,isWritable:!1}),h({pubkey:o.openOrders}),h({pubkey:o.targetOrders}),h({pubkey:o.vault.A}),h({pubkey:o.vault.B})];return r===5&&a.push(h({pubkey:vn})),a.push(h({pubkey:o.marketProgramId,isWritable:!1}),h({pubkey:o.marketId}),h({pubkey:o.marketBids}),h({pubkey:o.marketAsks}),h({pubkey:o.marketEventQueue}),h({pubkey:o.marketBaseVault}),h({pubkey:o.marketQuoteVault}),h({pubkey:o.marketAuthority,isWritable:!1}),h({pubkey:e.tokenAccountIn}),h({pubkey:e.tokenAccountOut}),h({pubkey:e.owner,isWritable:!1,isSigner:!0})),new pn({programId:o.programId,keys:a,data:s})}function Is(i){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:s}=i;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return Ec(q(N({},a),{amountIn:r,minAmountOut:o}),t);if(s==="out")return Fc(q(N({},a),{maxAmountIn:r,amountOut:o}),t);hs.logWithError("invalid params","params",i)}throw hs.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}import{TOKEN_PROGRAM_ID as Ne,TOKEN_2022_PROGRAM_ID as Dt,ASSOCIATED_TOKEN_PROGRAM_ID as Ws}from"@solana/spl-token";import{PublicKey as V,TransactionInstruction as ut,SystemProgram as fn,Keypair as Yi}from"@solana/web3.js";import Ds from"bn.js";import Yc from"bn.js";function _r(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Wi(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Di(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Wn(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function xs(i,e){return Wn(i,e)?null:Wi(i,e)}function Bs(i,e){return Wn(i,e)?null:Di(i,e)}var uw=Buffer.from("amm_config","utf8"),vc=Buffer.from("pool","utf8"),Wc=Buffer.from("pool_vault","utf8"),Dc=Buffer.from("pool_reward_vault","utf8"),Ss=Buffer.from("position","utf8"),qc=Buffer.from("tick_array","utf8"),Uc=Buffer.from("operation","utf8"),Gc=Buffer.from("pool_tick_array_bitmap_extension","utf8");function Ks(i,e,t,n){return ye([vc,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function qi(i,e,t){return ye([Wc,e.toBuffer(),t.toBuffer()],i)}function Cs(i,e,t){return ye([Dc,e.toBuffer(),t.toBuffer()],i)}function me(i,e,t){return ye([qc,e.toBuffer(),_r(t)],i)}function Yt(i,e,t,n){return ye([Ss,e.toBuffer(),_r(t),_r(n)],i)}function bt(i,e){return ye([Ss,e.toBuffer()],i)}function Mr(i){return ye([Buffer.from("metadata","utf8"),rn.toBuffer(),i.toBuffer()],rn)}function Dn(i){return ye([Uc],i)}function gt(i,e){return ye([Gc,e.toBuffer()],i)}import wt from"bn.js";var Ie=new wt(0),Fe=new wt(1),Bt=new wt(-1),Ze=new wt(1).shln(64),Vr=new wt(1).shln(128),Ui=Ze.sub(Fe),qn=64,Ls=Vr.subn(1),ve=-443636,qe=-ve,kt=new wt("4295048016"),ht=new wt("79226673521066979257578248091"),Rs=16,Os="59543866431248",Ns="184467440737095516",_s="15793534762490258745",Er=new wt(10).pow(new wt(6));var Ms={tvl:0,volumeQuote:0,mintAmountA:0,mintAmountB:0,rewardDefaultInfos:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,day:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},week:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},month:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},pooltype:[]},mw=new wt("18446744073700000000");var Xc=15,ie=class{static async getTickArrays(e,t,n,r,o,s,a){let u=[],c=D.getTickArrayStartIndexByTick(r,o),l=D.getInitializedTickArrayInRange(s,a,o,c,Math.floor(Xc/2));for(let p=0;p<l.length;p++){let{publicKey:y}=me(t,n,l[p]);u.push(y)}let m=(await mt(e,u)).map(p=>p!==null?Un.decode(p.data):null),d={};for(let p=0;p<u.length;p++){let y=m[p];y!==null&&(d[y.startTickIndex]=q(N({},y),{address:u[p]}))}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=D.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/ie.tickCount(t)),a=n?D.searchLowBitFromStart(r,o,s-1,1,t):D.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=Be-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<Be;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=me(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=D.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u-1}else for(u=u+1;u<Be;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u+1}let{publicKey:m}=me(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(D.checkIsOutOfBoundary(e)){if(e>qe)return!1;let n=D.getTickArrayStartIndexByTick(ve,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return Be*e}};import ne from"bn.js";import{PublicKey as Vs}from"@solana/web3.js";import Ae from"bn.js";var Gi=14,St=class{static maxTickInTickarrayBitmap(e){return e*Be*Qt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!ie.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-ie.tickCount(n):t+ie.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*Be,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(r){let l=e.shln(1024-c-1),m=xs(1024,l);if(m!==null){let d=(c-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=Bs(1024,l);if(m!==null){let d=(c+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-ie.tickCount(n)}}}},Gn=class{static getBitmapOffset(e,t){if(!ie.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=St.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=St.maxTickInTickarrayBitmap(e),n=-t;if(qe<=t)throw Error(`extensionTickBoundary check error: ${qe}, ${t}`);if(n<=ve)throw Error(`extensionTickBoundary check error: ${n}, ${ve}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:D.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=ie.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=St.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let u=D.mergeTickArrayBitmap(e).shln(Qt-1-a),c=Wn(512,u)?null:Wi(512,u);if(c!==null){let l=t-c*ie.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=D.mergeTickArrayBitmap(e).shrn(a),c=Wn(512,u)?null:Di(512,u);if(c!==null){let l=t+c*ie.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-ie.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%St.maxTickInTickarrayBitmap(t),r=Math.floor(n/ie.tickCount(t));return e<0&&n!=0&&(r=Qt-r),r}};import At from"bn.js";var Xn=class{static getfeeGrowthInside(e,t,n){let r=new At(0),o=new At(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new At(0),a=new At(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=j.wrappingSubU128(j.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),c=j.wrappingSubU128(j.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=j.mulDivFloor(j.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ze),u=t.tokenFeesOwedA.add(a),c=j.mulDivFloor(j.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ze),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=j.mulDivFloor(j.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ze),u=t.tokenFeesOwedA.add(a),c=j.mulDivFloor(j.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ze),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=j.wrappingSubU128(u,c.growthInsideLastX64),m=j.mulDivFloor(l,t.liquidity,Ze),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=j.wrappingSubU128(u,c.growthInsideLastX64),m=j.mulDivFloor(l,t.liquidity,Ze),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new At(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new At(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(j.wrappingSubU128(j.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new At(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new At(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(j.wrappingSubU128(j.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var b,w,A,k;let a=J.priceToSqrtPriceX64(new F(e.price),e.mintA.decimals,e.mintB.decimals),u=J.getSqrtPriceX64FromTick(t.tickLower),c=J.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=se.getAmountsFromLiquidity(a,u,c,n,o),[d,p]=[Ve(m.amountA,(b=e.mintA.extensions)==null?void 0:b.feeConfig,s,!0),Ve(m.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)],[y,f]=[Ve(new At(new F(m.amountA.toString()).mul(l).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,s,!0),Ve(new At(new F(m.amountB.toString()).mul(l).toFixed(0)),(k=e.mintB.extensions)==null?void 0:k.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:y,amountSlippageB:f,expirationTime:Xt(d.expirationTime,p.expirationTime)}}};var Oe=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o){let s=n.equals(e.mintA.mint),a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:y}=jt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,c,o);return a.push(...d),{expectedAmountOut:m.mul(Bt),remainingAccounts:a,executionPrice:p,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.equals(e.mintB.mint),a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:b}=me(e.programId,e.id,f.nextStartIndex);a.push(b)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:y}=jt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(Bt),c,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:p,feeAmount:y}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=Oe.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Gn.checkTickArrayIsInit(ie.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):D.checkTickArrayIsInitialized(D.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=me(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,ie.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=me(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/ie.tickCount(e.tickSpacing)),r=t?D.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):D.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=ie.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=St.nextInitializedTickArrayStartIndex(D.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Gn.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<ve||t>qe)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let p=q(N({},m),{perSecond:j.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Vs(d)});if(p.tokenMint.equals(Vs.default))continue;if(n<=p.openTime.toNumber()||r.eq(Ie)){s.push(p);continue}let y=new Ae(Math.min(p.endTime.toNumber(),n)),f=y.sub(p.lastUpdateTime),b=j.mulDivFloor(f,p.emissionsPerSecondX64,r),w=p.rewardGrowthGlobalX64.add(b),A=j.mulDivFloor(f,p.emissionsPerSecondX64,Ze),k=p.rewardTotalEmissioned.add(A);s.push(q(N({},p),{rewardGrowthGlobalX64:w,rewardTotalEmissioned:k,lastUpdateTime:y}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=D.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=St.maxTickInTickarrayBitmap(e),n=-t;return t>qe&&(t=ie.getArrayStartIndex(qe,e)+ie.tickCount(e)),n<ve&&(n=ie.getArrayStartIndex(ve,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!ie.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/ie.tickCount(t)*Qt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await yr(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=Fs.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=D.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=D.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:d}=me(u.programId,u.id,m);o.push({pubkey:d}),r[d.toString()]=u.id}}let s=await yr(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=Un.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]=q(N({},l),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let p of s)c.push(bt(p,d).publicKey);let l=await mt(t,c,{batchRequest:r}),m={};for(let d of l){if(d===null)continue;let p=Es.decode(d.data),y=p.poolId.toString(),f=e.find(L=>L.state.id.toBase58()===y);if(f===void 0)continue;let b=f.state,w=D._getTickPriceLegacy({poolInfo:b,tick:p.tickLower,baseIn:!0}),A=D._getTickPriceLegacy({poolInfo:b,tick:p.tickUpper,baseIn:!0}),{amountA:k,amountB:P}=se.getAmountsFromLiquidity(b.sqrtPriceX64,w.tickSqrtPriceX64,A.tickSqrtPriceX64,p.liquidity,!1),T=1/(1-Math.sqrt(Math.sqrt(w.price.div(A.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:w.price,priceUpper:A.price,amountA:k,amountB:P,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(L=>q(N({},L),{pendingReward:new Ae(0)})),leverage:T,tokenFeeAmountA:new Ae(0),tokenFeeAmountB:new Ae(0)}];let I=await D.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),x=await D.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=I,m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=x}if(o){let d=Object.values(m),p=await mt(t,d,{batchRequest:r}),y={};for(let f=0;f<d.length;f++){let b=p[f];if(b===null)continue;let w=d[f].toString();y[w]=Un.decode(b.data)}for(let{state:f,positionAccount:b}of e)if(!!b)for(let w of b){let A=`${f.programId.toString()}-${f.id.toString()}-${w.tickLower}`,k=`${f.programId.toString()}-${f.id.toString()}-${w.tickUpper}`,P=y[m[A].toString()],T=y[m[k].toString()],I=P.ticks[D.getTickOffsetInArray(w.tickLower,f.tickSpacing)],x=T.ticks[D.getTickOffsetInArray(w.tickUpper,f.tickSpacing)],{tokenFeeAmountA:L,tokenFeeAmountB:O}=await Xn.GetPositionFees(f,w,I,x),R=await Xn.GetPositionRewards(f,w,I,x);w.tokenFeeAmountA=L.gte(new Ae(0))?L:new Ae(0),w.tokenFeeAmountB=O.gte(new Ae(0))?O:new Ae(0);for(let E=0;E<R.length;E++)w.rewardInfos[E].pendingReward=R[E].gte(new Ae(0))?R[E]:new Ae(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,token2022Infos:r,epochInfo:o,amountIn:s,slippage:a,priceLimit:u=new F(0)}){var O,R,E,ee;let c;u.equals(new F(0))?c=n.equals(e.mintA.mint)?kt.add(new Ae(1)):ht.sub(new Ae(1)):c=J.priceToSqrtPriceX64(u,e.mintA.decimals,e.mintB.decimals);let l=cn(s,(O=r[n.toString()])==null?void 0:O.feeConfig,o,!1),{expectedAmountOut:m,remainingAccounts:d,executionPrice:p,feeAmount:y}=Oe.getOutputAmountAndRemainAccounts(e,t,n,l.amount.sub((R=l.fee)!=null?R:Ie),c),f=e.mintA.mint.equals(n)?e.mintB.mint:e.mintA.mint,b=cn(m,(E=r[f.toString()])==null?void 0:E.feeConfig,o,!1),w=J.sqrtPriceX64ToPrice(p,e.mintA.decimals,e.mintB.decimals),A=n.equals(e.mintA.mint)?w:new F(1).div(w),k=m.mul(new Ae(Math.floor((1-a)*1e10))).div(new Ae(1e10)),P=cn(k,(ee=r[f.toString()])==null?void 0:ee.feeConfig,o,!1),T=e.mintA.mint.equals(n)?e.currentPrice:new F(1).div(e.currentPrice),I=new F(A).sub(T).abs(),x=T,L=new je(new F(I).mul(10**15).toFixed(0),new F(x).mul(10**15).toFixed(0));return{realAmountIn:l,amountOut:b,minAmountOut:P,expirationTime:Xt(l.expirationTime,b.expirationTime),currentPrice:e.currentPrice,executionPrice:A,priceImpact:L,fee:y,remainingAccounts:d}}static async computeAmountOutFormat({poolInfo:e,tickArrayCache:t,token2022Infos:n,amountIn:r,tokenOut:o,slippage:s,epochInfo:a}){let u=r.token.equals(ce.WSOL)?Z:r.token.mint,c=s.numerator.toNumber()/s.denominator.toNumber(),l=o.mint.equals(le)?new ce({mint:"sol",decimals:Ye.decimals}):o,{realAmountIn:m,amountOut:d,minAmountOut:p,expirationTime:y,currentPrice:f,executionPrice:b,priceImpact:w,fee:A,remainingAccounts:k}=await Oe.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:u,amountIn:r.raw,slippage:c,token2022Infos:n,epochInfo:a}),P=q(N({},m),{amount:new fe(r.token,m.amount),fee:m.fee===void 0?void 0:new fe(r.token,m.fee)}),T=q(N({},d),{amount:new fe(l,d.amount),fee:d.fee===void 0?void 0:new fe(l,d.fee)}),I=q(N({},p),{amount:new fe(l,p.amount),fee:p.fee===void 0?void 0:new fe(l,p.fee)}),x=new Qe({baseToken:r.token,denominator:new Ae(10).pow(new Ae(20+r.token.decimals)),quoteToken:l,numerator:f.mul(new F(10**(20+l.decimals))).toFixed(0)}),L=new Qe({baseToken:r.token,denominator:new Ae(10).pow(new Ae(20+r.token.decimals)),quoteToken:l,numerator:b.mul(new F(10**(20+l.decimals))).toFixed(0)}),O=new fe(r.token,A);return{realAmountIn:P,amountOut:T,minAmountOut:I,expirationTime:y,currentPrice:x,executionPrice:L,priceImpact:w,fee:O,remainingAccounts:k}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var y,f,b;let o=e[t],s=D.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=D.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,d=o.priceMax-o.priceMin,p;return l<=0?p=0:m===l?p=d/l:d===l?p=l/m:p=l/d*(l/m),{feeApr:o.feeApr*p,rewardsApr:[(y=o.rewardApr[0])!=null?y:0*p,(f=o.rewardApr[1])!=null?f:0*p,(b=o.rewardApr[2])!=null?b:0*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[Ot(e.mintA.address).toString()],d=r[Ot(e.mintB.address).toString()],p=e.mintA.decimals,y=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=J.priceToSqrtPriceX64(new F(e.price),e.mintA.decimals,e.mintB.decimals),b=J.getSqrtPriceX64FromTick(s),w=J.getSqrtPriceX64FromTick(a),{amountSlippageA:A,amountSlippageB:k}=se.getAmountsFromLiquidityWithSlippage(f,b,w,t,!1,!1,0),{amountSlippageA:P,amountSlippageB:T}=se.getAmountsFromLiquidityWithSlippage(f,b,w,o,!1,!1,0),I=new F(A.toString()).div(new F(10).pow(p)).mul(m.value).add(new F(k.toString()).div(new F(10).pow(y)).mul(d.value)),x=new F(P.toString()).div(new F(10).pow(p)).mul(m.value).add(new F(T.toString()).div(new F(10).pow(y)).mul(d.value)),L=x.div(I.add(x)).div(x),R=new F(l.volumeFee).mul(365).div(c).mul(L).mul(100).toNumber(),E=3600*24*365,ee=e.rewardDefaultInfos.map(W=>{var te,et;let $=W.mint.decimals,Q=r[W.mint.address];return u<((te=W.startTime)!=null?te:0)||u>((et=W.endTime)!=null?et:0)||!W.perSecond||!Q||$===void 0?0:new F(Q.value).mul(new F(W.perSecond).mul(E)).div(new F(10).pow($)).mul(L).mul(100).toNumber()});return{feeApr:R,rewardsApr:ee,apr:R+ee.reduce((W,$)=>W+$,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var w,A;let l=J.priceToSqrtPriceX64(new F(e.price),e.mintA.decimals,e.mintB.decimals),m=J.getSqrtPriceX64FromTick(n),d=J.getSqrtPriceX64FromTick(r),p=a?1-s:1+s,y=Ve(o,(w=e[t?"mintA":"mintB"].extensions)==null?void 0:w.feeConfig,u,!c),f=new Ae(new F(y.amount.sub((A=y.fee)!=null?A:Ie).toString()).mul(p).toFixed(0)),b;if(l.lte(m))b=t?se.getLiquidityFromTokenAmountA(m,d,f,!a):new Ae(0);else if(l.lte(d)){let k=se.getLiquidityFromTokenAmountA(l,d,f,!a),P=se.getLiquidityFromTokenAmountB(m,l,f);b=t?k:P}else b=t?new Ae(0):se.getLiquidityFromTokenAmountB(m,d,f);return Oe.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:b,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var b,w,A,k;let u=J.getSqrtPriceX64FromTick(n),c=J.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=se.getAmountsFromLiquidity(J.priceToSqrtPriceX64(new F(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,p]=[Ve(m.amountA,(b=t.mintA.extensions)==null?void 0:b.feeConfig,e,!0),Ve(m.amountB,(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)],[y,f]=[Ve(m.amountA.muln(l),(A=t.mintA.extensions)==null?void 0:A.feeConfig,e,!0),Ve(m.amountB.muln(l),(k=t.mintB.extensions)==null?void 0:k.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:p,amountSlippageA:y,amountSlippageB:f,expirationTime:Xt(d.expirationTime,p.expirationTime)}}};var j=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(Ie)||(o=o.add(Fe)),o}static mulDivFloor(e,t,n){if(n.eq(Ie))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(Ie))throw new Error("division by 0");return e.mul(t).add(n.sub(Fe)).div(n)}static x64ToDecimal(e,t){return new F(e.toString()).div(F.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new ne(e.mul(F.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Vr).sub(t).mod(Vr)}};function Ke(i,e){return Xi(i.mul(e),64,256)}function zc(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Xi(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var J=class{static sqrtPriceX64ToPrice(e,t,n){return j.x64ToDecimal(e).pow(2).mul(F.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return j.decimalToX64(e.mul(F.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(Ie))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(Ie))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(Ie))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(Ie))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(Ie))return e;let o=t.shln(qn);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?j.mulDivCeil(s,e,a):j.mulDivRoundingUp(s,Fe,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return j.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(qn);if(r)return e.add(o.div(t));{let s=j.mulDivRoundingUp(o,Fe,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<ve||e>qe)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new ne("18445821805675395072"):new ne("18446744073709551616");return(t&2)!=0&&(n=Ke(n,new ne("18444899583751176192"))),(t&4)!=0&&(n=Ke(n,new ne("18443055278223355904"))),(t&8)!=0&&(n=Ke(n,new ne("18439367220385607680"))),(t&16)!=0&&(n=Ke(n,new ne("18431993317065453568"))),(t&32)!=0&&(n=Ke(n,new ne("18417254355718170624"))),(t&64)!=0&&(n=Ke(n,new ne("18387811781193609216"))),(t&128)!=0&&(n=Ke(n,new ne("18329067761203558400"))),(t&256)!=0&&(n=Ke(n,new ne("18212142134806163456"))),(t&512)!=0&&(n=Ke(n,new ne("17980523815641700352"))),(t&1024)!=0&&(n=Ke(n,new ne("17526086738831433728"))),(t&2048)!=0&&(n=Ke(n,new ne("16651378430235570176"))),(t&4096)!=0&&(n=Ke(n,new ne("15030750278694412288"))),(t&8192)!=0&&(n=Ke(n,new ne("12247334978884435968"))),(t&16384)!=0&&(n=Ke(n,new ne("8131365268886854656"))),(t&32768)!=0&&(n=Ke(n,new ne("3584323654725218816"))),(t&65536)!=0&&(n=Ke(n,new ne("696457651848324352"))),(t&131072)!=0&&(n=Ke(n,new ne("26294789957507116"))),(t&262144)!=0&&(n=Ke(n,new ne("37481735321082"))),e>0&&(n=Ls.div(n)),n}static getTickFromPrice(e,t,n){return J.getTickFromSqrtPriceX64(J.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(ht)||e.lt(kt))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new ne(t-64),r=zc(n,32,128),o=new ne("8000000000000000","hex"),s=0,a=new ne(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new ne(0))&&s<Rs;){u=u.mul(u);let y=u.shrn(127);u=u.shrn(63+y.toNumber()),a=a.add(o.mul(y)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=r.add(c).mul(new ne(Os)),d=Xi(m.sub(new ne(Ns)),64,128).toNumber(),p=Xi(m.add(new ne(_s)),64,128).toNumber();return d==p?d:J.getSqrtPriceX64FromTick(p).lte(e)?p:d}},Ht=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=J.getTickFromSqrtPriceX64(J.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=Ht.getTickWithPriceAndTickspacing(e,t,n,r),s=J.getSqrtPriceX64FromTick(o);return J.sqrtPriceX64ToPrice(s,n,r)}},se=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(Ie))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(qn),s=t.sub(e);return r?j.mulDivRoundingUp(j.mulDivCeil(o,s,t),Fe,e):j.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(Ie))throw new Error("sqrtPriceX64A must greater than 0");return r?j.mulDivCeil(n,t.sub(e),Ze):j.mulDivFloor(n,t.sub(e),Ze)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?j.mulDivRoundingUp(a,Fe,Ui):a.shrn(qn)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),j.mulDivFloor(n,Ui,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return se.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=se.getLiquidityFromTokenAmountA(e,n,r,!1),a=se.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return se.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:se.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new ne(0)};if(e.lt(n)){let s=se.getTokenAmountAFromLiquidity(e,n,r,o),a=se.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new ne(0),amountB:se.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:u,amountB:c}=se.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new ne(new F(u.toString()).mul(l).toFixed(0)),d=new ne(new F(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var A,k,P,T;let c=J.priceToSqrtPriceX64(new F(e.price),e.mintA.decimals,e.mintB.decimals),l=J.getSqrtPriceX64FromTick(t),m=J.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,p=se.getAmountsFromLiquidity(c,l,m,r,s),[y,f]=[Ve(p.amountA,(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,u),Ve(p.amountB,(k=e.mintB.extensions)==null?void 0:k.feeConfig,a,u)],[b,w]=[Ve(new ne(new F(p.amountA.toString()).mul(d).toFixed(0)),(P=e.mintA.extensions)==null?void 0:P.feeConfig,a,u),Ve(new ne(new F(p.amountB.toString()).mul(d).toFixed(0)),(T=e.mintB.extensions)==null?void 0:T.feeConfig,a,u)];return{liquidity:r,amountA:y,amountB:f,amountSlippageA:b,amountSlippageB:w,expirationTime:Xt(y.expirationTime,f.expirationTime)}}},jt=class{static swapCompute(e,t,n,r,o,s,a,u,c,l,m,d,p,y){if(d.eq(Ie))throw new Error("amountSpecified must not be 0");if(y||(y=s?kt.add(Fe):ht.sub(Fe)),s){if(y.lt(kt))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(y.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(y.gt(ht))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(y.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let f=d.gt(Ie),b={amountSpecifiedRemaining:d,amountCalculated:Ie,sqrtPriceX64:m,tick:c>p?Math.min(p+ie.tickCount(l)-1,c):p,accounts:[],liquidity:u,feeAmount:new ne(0)},w=p,A=n[p],k=0,P=!s&&A.startTickIndex===b.tick;for(;!b.amountSpecifiedRemaining.eq(Ie)&&!b.sqrtPriceX64.eq(y);){if(k>10)throw Error("liquidity limit");let T={};T.sqrtPriceStartX64=b.sqrtPriceX64;let I=D.nextInitTick(A,b.tick,l,s,P),x=I||null,L=null;if(!(x!=null&&x.liquidityGross.gtn(0))){let R=Oe.nextInitializedTickArrayStartIndex({tickCurrent:b.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},w,s);if(!R.isExist)throw Error("swapCompute LiquidityInsufficient");w=R.nextStartIndex;let{publicKey:E}=me(e,t,w);L=E,A=n[w],x=D.firstInitializedTick(A,s)}T.tickNext=x.tick,T.initialized=x.liquidityGross.gtn(0),p!==w&&L&&(b.accounts.push(L),p=w),T.tickNext<ve?T.tickNext=ve:T.tickNext>qe&&(T.tickNext=qe),T.sqrtPriceNextX64=J.getSqrtPriceX64FromTick(T.tickNext);let O;if(s&&T.sqrtPriceNextX64.lt(y)||!s&&T.sqrtPriceNextX64.gt(y)?O=y:O=T.sqrtPriceNextX64,[b.sqrtPriceX64,T.amountIn,T.amountOut,T.feeAmount]=jt.swapStepCompute(b.sqrtPriceX64,O,b.liquidity,b.amountSpecifiedRemaining,a),b.feeAmount=b.feeAmount.add(T.feeAmount),f?(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.sub(T.amountIn.add(T.feeAmount)),b.amountCalculated=b.amountCalculated.sub(T.amountOut)):(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.add(T.amountOut),b.amountCalculated=b.amountCalculated.add(T.amountIn.add(T.feeAmount))),b.sqrtPriceX64.eq(T.sqrtPriceNextX64)){if(T.initialized){let R=x.liquidityNet;s&&(R=R.mul(Bt)),b.liquidity=se.addDelta(b.liquidity,R)}P=T.tickNext!=b.tick&&!s&&A.startTickIndex===T.tickNext,b.tick=s?T.tickNext-1:T.tickNext}else if(b.sqrtPriceX64!=T.sqrtPriceStartX64){let R=J.getTickFromSqrtPriceX64(b.sqrtPriceX64);P=R!=b.tick&&!s&&A.startTickIndex===R,b.tick=R}++k}try{let{nextStartIndex:T,isExist:I}=ie.nextInitializedTickArray(b.tick,l,s,r,o);I&&p!==T&&(b.accounts.push(me(e,t,T).publicKey),p=T)}catch{}return{amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new ne(0),amountIn:new ne(0),amountOut:new ne(0),feeAmount:new ne(0)},a=e.gte(t),u=r.gte(Ie);if(u){let l=j.mulDivFloor(r,Er.sub(new ne(o.toString())),Er);s.amountIn=a?se.getTokenAmountAFromLiquidity(t,e,n,!0):se.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=J.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?se.getTokenAmountBFromLiquidity(t,e,n,!1):se.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(Bt).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=J.getNextSqrtPriceX64FromOutput(e,n,r.mul(Bt),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=se.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=se.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:se.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:se.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul(Bt))&&(s.amountOut=r.mul(Bt)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=j.mulDivCeil(s.amountIn,new ne(o),Er.sub(new ne(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var Be=60,Qt=512,D=class{static getTickArrayAddressByTick(e,t,n,r){let o=D.getTickArrayStartIndexByTick(n,r),{publicKey:s}=me(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=D.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=Be)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=ie.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*ie.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*Be,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*Be,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*Be:e+t*Be}static mergeTickArrayBitmap(e){let t=new Yc(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*Be));return[...D.searchLowBitFromStart(e,t,s-1,o,n),...D.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return D.searchHightBitFromStart(e,t,0,Qt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=D.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of a){let{publicKey:c}=me(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>D.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===r)break}let u=ie.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>D.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===r)break}let u=ie.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<ve||e>qe}static nextInitTick(e,t,n,r,o){if(ie.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<Be;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=Be-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<Be;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=J.getSqrtPriceX64FromTick(t),o=J.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new F(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new F(1).div(t),o=Ht.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=J.getSqrtPriceX64FromTick(o),a=J.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new F(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=J.getSqrtPriceX64FromTick(t),o=J.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new F(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new F(1).div(t),o=Ht.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=J.getSqrtPriceX64FromTick(o),a=J.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new F(1).div(a)}}};var kk=M([we(8),v("bump"),Mt("index"),S(""),De("protocolFeeRate"),De("tradeFeeRate"),Mt("tickSpacing"),G(g(),8,"")]),Qc=M([De("blockTimestamp"),X("sqrtPriceX64"),X("cumulativeTimePriceX64"),G(X(),1,"")]),zi=M([we(8),ze("initialized"),S("poolId"),G(Qc,1e3,"observations"),G(X(),5,"")]),jc=M([v("rewardState"),g("openTime"),g("endTime"),g("lastUpdateTime"),X("emissionsPerSecondX64"),g("rewardTotalEmissioned"),g("rewardClaimed"),S("tokenMint"),S("tokenVault"),S("creator"),X("rewardGrowthGlobalX64")]),hk=M([we(8),v("bump"),S("ammConfig"),S("creator"),S("mintA"),S("mintB"),S("vaultA"),S("vaultB"),S("observationId"),v("mintDecimalsA"),v("mintDecimalsB"),Mt("tickSpacing"),X("liquidity"),X("sqrtPriceX64"),Re("tickCurrent"),Mt("observationIndex"),Mt("observationUpdateDuration"),X("feeGrowthGlobalX64A"),X("feeGrowthGlobalX64B"),g("protocolFeesTokenA"),g("protocolFeesTokenB"),X("swapInAmountTokenA"),X("swapOutAmountTokenB"),X("swapInAmountTokenB"),X("swapOutAmountTokenA"),v("status"),G(v(),7,""),G(jc,3,"rewardInfos"),G(g(),16,"tickArrayBitmap"),g("totalFeesTokenA"),g("totalFeesClaimedTokenA"),g("totalFeesTokenB"),g("totalFeesClaimedTokenB"),g("fundFeesTokenA"),g("fundFeesTokenB"),g("startTime"),G(g(),15*4-3,"padding")]),Hc=M([X("growthInsideLastX64"),g("rewardAmountOwed")]),Es=M([we(8),v("bump"),S("nftMint"),S("poolId"),Re("tickLower"),Re("tickUpper"),X("liquidity"),X("feeGrowthInsideLastX64A"),X("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),G(Hc,3,"rewardInfos"),G(g(),8,"")]),Ak=M([we(8),v("bump"),S("poolId"),Re("tickLowerIndex"),Re("tickUpperIndex"),X("liquidity"),X("feeGrowthInsideLastX64A"),X("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),G(X(),3,"rewardGrowthInside"),G(g(),8,"")]),Zc=M([Re("tick"),Qo("liquidityNet"),X("liquidityGross"),X("feeGrowthOutsideX64A"),X("feeGrowthOutsideX64B"),G(X(),3,"rewardGrowthsOutsideX64"),G(De(),13,"")]),Un=M([we(8),S("poolId"),Re("startTickIndex"),G(Zc,Be,"ticks"),v("initializedTickCount"),G(v(),115,"")]),vs=M([we(329),G(S(),100,"whitelistMints")]),Fs=M([we(8),S("poolId"),G(G(g(),8),Gi,"positiveTickArrayBitmap"),G(G(g(),8),Gi,"negativeTickArrayBitmap")]);var qs=oe("Raydium_Clmm"),ct={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},ke=class{static createPoolInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y){let f=M([X("sqrtPriceX64"),g("startTime")]),b=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:fn.programId,isSigner:!1,isWritable:!1},{pubkey:It,isSigner:!1,isWritable:!1}],w=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,startTime:y},w);let A=Buffer.from([...ct.createPool,...w]);return new ut({keys:b,programId:e,data:A})}static async createPoolInstructions(e){let{connection:t,programId:n,owner:r,mintA:o,mintB:s,ammConfigId:a,initialPriceX64:u,startTime:c,forerunCreate:l}=e,m=Ee({fromPublicKey:r,programId:n}),[d,p]=[new V(o.address),new V(s.address)],y=[fn.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:m.seed,newAccountPubkey:m.publicKey,lamports:l?0:await t.getMinimumBalanceForRentExemption(zi.span),space:zi.span,programId:n})],{publicKey:f}=Ks(n,a,d,p),{publicKey:b}=qi(n,f,d),{publicKey:w}=qi(n,f,p);return y.push(this.createPoolInstruction(n,f,r,a,m.publicKey,d,b,new V(o.programId||Ne),p,w,new V(s.programId||Ne),gt(n,f).publicKey,u,c)),{signers:[],instructions:y,instructionTypes:[_.CreateAccount,_.ClmmCreatePool],address:{poolId:f,observationId:m.publicKey,mintAVault:b,mintBVault:w},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y,f,b,w,A,k,P,T,I,x,L,O,R){let E=M([Re("tickLowerIndex"),Re("tickUpperIndex"),Re("tickArrayLowerStartIndex"),Re("tickArrayUpperStartIndex"),X("liquidity"),g("amountMaxA"),g("amountMaxB"),ze("withMetadata"),v("optionBaseFlag"),ze("baseFlag")]),ee=[...R?[{pubkey:R,isSigner:!1,isWritable:!0}]:[]],W=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:It,isSigner:!1,isWritable:!1},{pubkey:fn.programId,isSigner:!1,isWritable:!1},{pubkey:Ne,isSigner:!1,isWritable:!1},{pubkey:Ws,isSigner:!1,isWritable:!1},{pubkey:rn,isSigner:!1,isWritable:!1},{pubkey:Dt,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...ee],$=Buffer.alloc(E.span);E.encode({tickLowerIndex:A,tickUpperIndex:k,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:T,liquidity:I,amountMaxA:x,amountMaxB:L,withMetadata:O==="create",baseFlag:!1,optionBaseFlag:0},$);let Q=Buffer.from([...ct.openPosition,...$]);return new ut({keys:W,programId:e,data:Q})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new V(e.programId),new V(e.id)],y;if(l)y=new V((await l(1))[0]);else{let L=Yi.generate();m.push(L),y=L.publicKey}let f=D.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=D.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=me(d,p,f),{publicKey:A}=me(d,p,b),{publicKey:k}=ge(n.wallet,y,Ne),{publicKey:P}=Mr(y),{publicKey:T}=bt(d,y),{publicKey:I}=Yt(d,p,r,o),x=this.openPositionFromLiquidityInstruction(d,n.feePayer,p,n.wallet,y,k,P,I,w,A,T,n.tokenAccountA,n.tokenAccountB,new V(t.vault.A),new V(t.vault.B),new V(e.mintA.address),new V(e.mintB.address),r,o,f,b,s,a,u,c);return{signers:m,instructions:[x],instructionTypes:[_.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:y,tickArrayLower:w,tickArrayUpper:A,positionNftAccount:k,metadataAccount:P,personalPosition:T,protocolPosition:I}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new V(e.programId),new V(e.id)],y;if(l)y=new V((await l(1))[0]);else{let L=Yi.generate();m.push(L),y=L.publicKey}let f=D.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=D.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=me(d,p,f),{publicKey:A}=me(d,p,b),{publicKey:k}=ge(n.wallet,y,Ne),{publicKey:P}=Mr(y),{publicKey:T}=bt(d,y),{publicKey:I}=Yt(d,p,r,o),x=this.openPositionFromBaseInstruction(d,n.feePayer,p,n.wallet,y,k,P,I,w,A,T,n.tokenAccountA,n.tokenAccountB,new V(t.vault.A),new V(t.vault.B),new V(e.mintA.address),new V(e.mintB.address),r,o,f,b,c,s,a,u,Oe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,b])?gt(d,p).publicKey:void 0);return{address:{nftMint:y,tickArrayLower:w,tickArrayUpper:A,positionNftAccount:k,metadataAccount:P,personalPosition:T,protocolPosition:I},instructions:[x],signers:m,instructionTypes:[_.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y,f,b,w,A,k,P,T,I,x,L,O,R){let E=M([Re("tickLowerIndex"),Re("tickUpperIndex"),Re("tickArrayLowerStartIndex"),Re("tickArrayUpperStartIndex"),X("liquidity"),g("amountMaxA"),g("amountMaxB"),ze("withMetadata"),v("optionBaseFlag"),ze("baseFlag")]),ee=[...R?[{pubkey:R,isSigner:!1,isWritable:!0}]:[]],W=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:It,isSigner:!1,isWritable:!1},{pubkey:fn.programId,isSigner:!1,isWritable:!1},{pubkey:Ne,isSigner:!1,isWritable:!1},{pubkey:Ws,isSigner:!1,isWritable:!1},{pubkey:rn,isSigner:!1,isWritable:!1},{pubkey:Dt,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...ee],$=Buffer.alloc(E.span);E.encode({tickLowerIndex:A,tickUpperIndex:k,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:T,liquidity:new Ds(0),amountMaxA:x==="MintA"?L:O,amountMaxB:x==="MintA"?O:L,withMetadata:I==="create",baseFlag:x==="MintA",optionBaseFlag:1},$);let Q=Buffer.from([...ct.openPosition,...$]);return new ut({keys:W,programId:e,data:Q})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,d=[];if(l)m=new V((await l(1))[0]);else{let L=Yi.generate();d.push(L),m=L.publicKey}let[p,y]=[new V(e.programId),new V(e.id)],f=D.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=D.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=me(p,y,f),{publicKey:A}=me(p,y,b),{publicKey:k}=ge(n.wallet,m,Ne),{publicKey:P}=Mr(m),{publicKey:T}=bt(p,m),{publicKey:I}=Yt(p,y,r,o),x=this.openPositionFromLiquidityInstruction(p,n.wallet,y,n.wallet,m,k,P,I,w,A,T,n.tokenAccountA,n.tokenAccountB,new V(t.vault.A),new V(t.vault.B),new V(t.mintA.address),new V(t.mintB.address),r,o,f,b,s,a,u,c,Oe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,b])?gt(p,y).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:w,tickArrayUpper:A,positionNftAccount:k,metadataAccount:P,personalPosition:T,protocolPosition:I},instructions:[x],signers:d,instructionTypes:[_.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=M([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:fn.programId,isSigner:!1,isWritable:!1},{pubkey:Ne,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...ct.closePosition,...u]);return new ut({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new V(e.programId),{publicKey:s}=ge(n.wallet,r.nftMint,Ne),{publicKey:a}=bt(o,r.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[_.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y,f,b,w,A){let k=M([X("liquidity"),g("amountMaxA"),g("amountMaxB"),v("optionBaseFlag"),ze("baseFlag")]),P=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:Ne,isSigner:!1,isWritable:!1},{pubkey:Dt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...P],I=Buffer.alloc(k.span);k.encode({liquidity:f,amountMaxA:b,amountMaxB:w,optionBaseFlag:0,baseFlag:!1},I);let x=Buffer.from([...ct.increaseLiquidity,...I]);return new ut({keys:T,programId:e,data:x})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new V(e.programId),new V(e.id)],l=D.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=D.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=me(u,c,l),{publicKey:p}=me(u,c,m),{publicKey:y}=ge(r.wallet,n.nftMint,Ne),{publicKey:f}=bt(u,n.nftMint),{publicKey:b}=Yt(u,c,n.tickLower,n.tickUpper),w=this.increasePositionFromLiquidityInstruction(u,r.wallet,y,f,c,b,d,p,r.tokenAccountA,r.tokenAccountB,new V(t.vault.A),new V(t.vault.B),new V(e.mintA.address),new V(e.mintB.address),o,s,a,Oe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?gt(u,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:y,personalPosition:f,protocolPosition:b},signers:[],instructions:[w],instructionTypes:[_.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new V(e.programId),new V(e.id)],l=D.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=D.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=me(u,c,l),{publicKey:p}=me(u,c,m),{publicKey:y}=ge(r.wallet,n.nftMint,Ne),{publicKey:f}=bt(u,n.nftMint),{publicKey:b}=Yt(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:y,personalPosition:f,protocolPosition:b},instructions:[this.increasePositionFromBaseInstruction(u,r.wallet,y,f,c,b,d,p,r.tokenAccountA,r.tokenAccountB,new V(t.vault.A),new V(t.vault.B),new V(e.mintA.address),new V(e.mintB.address),o,s,a,Oe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?gt(u,c).publicKey:void 0)],signers:[],instructionTypes:[_.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y,f,b,w,A){let k=M([X("liquidity"),g("amountMaxA"),g("amountMaxB"),v("optionBaseFlag"),ze("baseFlag")]),P=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:Ne,isSigner:!1,isWritable:!1},{pubkey:Dt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...P],I=Buffer.alloc(k.span);k.encode({liquidity:new Ds(0),amountMaxA:f==="MintA"?b:w,amountMaxB:f==="MintA"?w:b,baseFlag:f==="MintA",optionBaseFlag:1},I);let x=Buffer.from([...ct.increaseLiquidity,...I]);return new ut({keys:T,programId:e,data:x})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y,f,b,w,A,k){let P=M([X("liquidity"),g("amountMinA"),g("amountMinB")]),T=[...k?[{pubkey:k,isSigner:!1,isWritable:!0}]:[],...f.map(O=>[{pubkey:O.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:O.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:O.rewardMint,isSigner:!1,isWritable:!1}]).flat()],I=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:Ne,isSigner:!1,isWritable:!1},{pubkey:Dt,isSigner:!1,isWritable:!1},{pubkey:nn,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...T],x=Buffer.alloc(P.span);P.encode({liquidity:b,amountMinA:w,amountMinB:A},x);let L=Buffer.from([...ct.decreaseLiquidity,...x]);return new ut({keys:I,programId:e,data:L})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new V(e.programId),new V(e.id)],m=D.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=D.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=me(c,l,m),{publicKey:y}=me(c,l,d),{publicKey:f}=ge(r.wallet,n.nftMint,u),{publicKey:b}=bt(c,n.nftMint),{publicKey:w}=Yt(c,l,n.tickLower,n.tickUpper),A=[];for(let P=0;P<e.rewardDefaultInfos.length;P++)A.push({poolRewardVault:new V(t.rewardInfos[P].vault),ownerRewardVault:r.rewardAccounts[P],rewardMint:new V(e.rewardDefaultInfos[P].mint.address)});let k=[];return k.push(this.decreaseLiquidityInstruction(c,r.wallet,f,b,l,w,p,y,r.tokenAccountA,r.tokenAccountB,new V(t.vault.A),new V(t.vault.B),new V(e.mintA.address),new V(e.mintB.address),A,o,s,a,Oe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?gt(c,l).publicKey:void 0)),{address:{tickArrayLower:p,tickArrayUpper:y,positionNftAccount:f,personalPosition:b,protocolPosition:w},signers:[],instructions:k,instructionTypes:[_.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y,f,b,w){let A=M([g("amount"),g("otherAmountThreshold"),X("sqrtPriceLimitX64"),ze("isBaseInput")]),k=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...m.map(x=>({pubkey:x,isSigner:!1,isWritable:!0}))],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:Ne,isSigner:!1,isWritable:!1},{pubkey:Dt,isSigner:!1,isWritable:!1},{pubkey:nn,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...k],T=Buffer.alloc(A.span);A.encode({amount:p,otherAmountThreshold:y,sqrtPriceLimitX64:f,isBaseInput:b},T);let I=Buffer.from([...ct.swap,...T]);return new ut({keys:P,programId:e,data:I})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,inputMint:r,amountIn:o,amountOutMin:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new V(e.programId),new V(e.id)],[m,d]=[new V(t.vault.A),new V(t.vault.B)],[p,y]=[new V(e.mintA.address),new V(e.mintB.address)],f=e.mintA.address===r.toString(),b=[this.swapInstruction(c,n.wallet,l,new V(e.config.id),f?n.tokenAccountA:n.tokenAccountB,f?n.tokenAccountB:n.tokenAccountA,f?m:d,f?d:m,f?p:y,f?y:p,u,m,o,s,a,!0,gt(c,l).publicKey)];return{signers:[],instructions:b,instructionTypes:[_.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let p=M([g("openTime"),g("endTime"),X("emissionsPerSecondX64")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:fn.programId,isSigner:!1,isWritable:!1},{pubkey:It,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:z(l),endTime:z(m),emissionsPerSecondX64:d},f);let b=Buffer.from([...ct.initReward,...f]);return new ut({keys:y,programId:e,data:b})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new V(e.programId),new V(e.id)],a=Cs(o,s,r.mint).publicKey,u=Dn(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new V(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[_.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let p=M([v("rewardIndex"),X("emissionsPerSecondX64"),g("openTime"),g("endTime")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:Ne,isSigner:!1,isWritable:!1},{pubkey:Dt,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:z(l),endTime:z(m)},f);let b=Buffer.from([...ct.setRewardEmissions,...f]);return new ut({keys:y,programId:e,data:b})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new V(e.programId),new V(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,u=new V(t.rewardInfos[d].vault),c=new V(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&qs.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=Dn(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new V(e.config.id),n.tokenAccount,u,c,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[_.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let u=M([v("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:Ne,isSigner:!1,isWritable:!1},{pubkey:Dt,isSigner:!1,isWritable:!1},{pubkey:nn,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...ct.collectReward,...l]);return new ut({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new V(e.programId),new V(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,u=new V(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&qs.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,r,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[_.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapBaseOutInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,outputMint:r,amountOut:o,amountInMax:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new V(e.programId),new V(e.id)],[m,d]=[new V(t.vault.A),new V(t.vault.B)],[p,y]=[new V(e.mintA.address),new V(e.mintB.address)],f=e.mintA.address===r.toString(),b=[this.swapInstruction(c,n.wallet,l,new V(e.config.id),f?n.tokenAccountB:n.tokenAccountA,f?n.tokenAccountA:n.tokenAccountB,f?d:m,f?m:d,f?p:y,f?y:p,u,m,o,s,a,!1)];return{signers:[],instructions:b,instructionTypes:[_.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}};import{PublicKey as el}from"@solana/web3.js";import{PublicKey as Jc}from"@solana/web3.js";import Us from"bn.js";var vk=new Us(25),Wk=new Us(1e4);var $c=oe("Raydium_liquidity_serum");function Gs({programId:i,marketId:e}){let t=[e.toBuffer()],n=0,r;for(;n<100;){try{let o=t.concat(Buffer.from([n]),Buffer.alloc(7));r=Jc.createProgramAddressSync(o,i)}catch(o){if(o instanceof TypeError)throw o;n++;continue}return{publicKey:r,nonce:n}}throw $c.logWithError("unable to find a viable program address nonce","params",{programId:i,marketId:e}),new Error("unable to find a viable program address nonce")}import oh from"bn.js";function Qi({programId:i}){let{publicKey:e}=ye([Buffer.from("amm_config_account_seed","utf-8")],i);return e}function Zt({name:i,programId:e,marketId:t}){let{publicKey:n}=ye([e.toBuffer(),t.toBuffer(),Buffer.from(i,"utf-8")],e);return n}function tl({programId:i,marketId:e}){let{publicKey:t}=ye([i.toBuffer(),e.toBuffer(),Buffer.from("open_order_associated_seed","utf-8")],i);return t}function nl({programId:i}){return ye([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],i)}function Xs({version:i,marketVersion:e,marketId:t,baseMint:n,quoteMint:r,baseDecimals:o,quoteDecimals:s,programId:a,marketProgramId:u}){let c=Zt({name:"amm_associated_seed",programId:a,marketId:t}),l=Zt({name:"lp_mint_associated_seed",programId:a,marketId:t}),{publicKey:m,nonce:d}=nl({programId:a}),p=Zt({name:"coin_vault_associated_seed",programId:a,marketId:t}),y=Zt({name:"pc_vault_associated_seed",programId:a,marketId:t}),f=Zt({name:"temp_lp_token_associated_seed",programId:a,marketId:t}),b=tl({programId:a,marketId:t}),w=Zt({name:"target_associated_seed",programId:a,marketId:t}),A=Zt({name:"withdraw_associated_seed",programId:a,marketId:t}),{publicKey:k}=Gs({programId:u,marketId:t});return{id:c,baseMint:n,quoteMint:r,lpMint:l,baseDecimals:o,quoteDecimals:s,lpDecimals:o,version:i,programId:a,authority:m,nonce:d,baseVault:p,quoteVault:y,lpVault:f,openOrders:b,targetOrders:w,withdrawQueue:A,marketVersion:e,marketProgramId:u,marketId:t,marketAuthority:k,lookupTableAccount:el.default,configId:Qi({programId:a})}}import Pt from"bn.js";var zn=class extends he{constructor(e){super(e)}async load(){this.checkDisabled()}computePairAmount({poolInfo:e,amount:t,slippage:n,baseIn:r}){let o=new Pt(new F(t).mul(10**e[r?"mintA":"mintB"].decimals).toFixed(0)),s=ws(e[r?"mintB":"mintA"]),[a,u]=[new Pt(new F(e.mintAmountA).mul(10**e.mintA.decimals).toString()),new Pt(new F(e.mintAmountB).mul(10**e.mintB.decimals).toString())];this.logDebug("baseReserve:",a.toString(),"quoteReserve:",u.toString()),this.logDebug("tokenIn:",r?e.mintA.symbol:e.mintB.symbol,"amountIn:",o.toString(),"anotherToken:",r?e.mintB.symbol:e.mintA.symbol,"slippage:",`${n.toSignificant()}%`);let c=r?"base":"quote";this.logDebug("input side:",c);let l=Ge;o.isZero()||(l=c==="base"?pr(o.mul(u),a):pr(o.mul(a),u));let m=pr(o.mul(new Pt(e.lpAmount).mul(new Pt(10).pow(new Pt(e.lpMint.decimals)))),new Pt(c==="base"?e.mintAmountA:e.mintAmountB).mul(new Pt(10).pow(new Pt(e[c==="base"?"mintA":"mintB"].decimals)))),p=new je(mr).add(n).mul(l).quotient,y=new fe(s,l),f=new fe(s,p);return this.logDebug("anotherAmount:",y.toFixed(),"maxAnotherAmount:",f.toFixed()),{anotherAmount:y,maxAnotherAmount:f,liquidity:m}}async addLiquidity(e){let{poolInfo:t,amountInA:n,amountInB:r,fixedSide:o,config:s,txVersion:a}=e;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region");let u=this.scope.mintToTokenAmount({mint:Ot(t.mintA.address),amount:n.toString()}),c=this.scope.mintToTokenAmount({mint:Ot(t.mintB.address),amount:r.toString()});this.logDebug("amountInA:",u,"amountInB:",c),(u.isZero()||c.isZero())&&this.logAndCreateError("amounts must greater than zero","amountInA & amountInB",{amountInA:u.toFixed(),amountInB:c.toFixed()});let{account:l}=this.scope,{bypassAssociatedCheck:m,checkCreateATAOwner:d}=N({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},s),[p,y]=[u.token,c.token],f=await l.getCreatedTokenAccount({mint:p.mint,associatedOnly:!1}),b=await l.getCreatedTokenAccount({mint:y.mint,associatedOnly:!1});!f&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",l.tokenAccounts);let w=await l.getCreatedTokenAccount({mint:new qt(t.lpMint.address)}),A=[p,y],k=[f,b],P=[u.raw,c.raw],T=u.token.mint.toBase58()===t.mintA.address?"base":"quote",I="base";["quote","base"].includes(T)||this.logAndCreateError("invalid fixedSide","fixedSide",o),T==="quote"?(A.reverse(),k.reverse(),P.reverse(),I=o==="a"?"quote":"base"):T==="base"&&(I=o==="a"?"base":"quote");let[x,L]=A,[O,R]=k,[E,ee]=P,W=await this.scope.api.fetchPoolKeysById({id:t.id}),$=this.createTxBuilder(),$n=await l.handleTokenAccount({side:"in",amount:E,mint:x.mint,tokenAccount:O,bypassAssociatedCheck:m,checkCreateATAOwner:d}),{tokenAccount:Q}=$n,te=_e($n,["tokenAccount"]);$.addInstruction(te);let wn=await l.handleTokenAccount({side:"in",amount:ee,mint:L.mint,tokenAccount:R,bypassAssociatedCheck:m,checkCreateATAOwner:d}),{tokenAccount:et}=wn,qr=_e(wn,["tokenAccount"]);$.addInstruction(qr);let kn=await l.handleTokenAccount({side:"out",amount:0,mint:new qt(t.lpMint.address),tokenAccount:w,bypassAssociatedCheck:m,checkCreateATAOwner:d}),{tokenAccount:Ur}=kn,Ut=_e(kn,["tokenAccount"]);return $.addInstruction(Ut),$.addInstruction({instructions:[Ps({poolInfo:t,poolKeys:W,userKeys:{baseTokenAccount:Q,quoteTokenAccount:et,lpTokenAccount:Ur,owner:this.scope.ownerPubKey},baseAmountIn:E,quoteAmountIn:ee,fixedSide:I})],instructionTypes:[t.pooltype.includes("StablePool")?_.AmmV5AddLiquidity:_.AmmV4AddLiquidity],lookupTableAddress:W.lookupTableAccount?[W.lookupTableAccount]:[]}),a===0&&await $.buildV0(),$.build()}async removeLiquidity(e){this.scope.availability.removeStandardPosition===!1&&this.logAndCreateError("remove liquidity feature disabled in your region");let{poolInfo:t,amountIn:n,config:r,txVersion:o}=e,s=await this.scope.api.fetchPoolKeysById({id:t.id}),[a,u,c]=[new qt(t.mintA.address),new qt(t.mintB.address),new qt(t.lpMint.address)];this.logDebug("amountIn:",n),n.isZero()&&this.logAndCreateError("amount must greater than zero","amountIn",n.toString());let{account:l}=this.scope,m=await l.getCreatedTokenAccount({mint:c,associatedOnly:!1});m||this.logAndCreateError("cannot found lpTokenAccount","tokenAccounts",l.tokenAccounts);let d=await l.getCreatedTokenAccount({mint:a}),p=await l.getCreatedTokenAccount({mint:u}),y=this.createTxBuilder(),{bypassAssociatedCheck:f,checkCreateATAOwner:b}=N({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},r),T=await l.handleTokenAccount({side:"out",amount:0,mint:a,tokenAccount:d,bypassAssociatedCheck:f,checkCreateATAOwner:b}),{tokenAccount:w}=T,A=_e(T,["tokenAccount"]);y.addInstruction(A);let I=await l.handleTokenAccount({side:"out",amount:0,mint:u,tokenAccount:p,bypassAssociatedCheck:f,checkCreateATAOwner:b}),{tokenAccount:k}=I,P=_e(I,["tokenAccount"]);return y.addInstruction(P),y.addInstruction({instructions:[vi({poolInfo:t,poolKeys:s,userKeys:{lpTokenAccount:m,baseTokenAccount:w,quoteTokenAccount:k,owner:this.scope.ownerPubKey},amountIn:n})],lookupTableAddress:s.lookupTableAccount?[s.lookupTableAccount]:[],instructionTypes:[t.pooltype.includes("StablePool")?_.AmmV5RemoveLiquidity:_.AmmV4RemoveLiquidity]}),o===0?await y.buildV0():y.build()}async removeAllLpAndCreateClmmPosition({poolInfo:e,clmmPoolInfo:t,removeLpAmount:n,createPositionInfo:r,farmInfo:o,userFarmLpAmount:s,base:a,computeBudgetConfig:u,payer:c,tokenProgram:l=Fr,checkCreateATAOwner:m=!0,getEphemeralSigners:d,txVersion:p}){if((this.scope.availability.removeStandardPosition===!1||this.scope.availability.createConcentratedPosition===!1)&&this.logAndCreateError("remove liquidity or create position feature disabled in your region"),!(e.mintA.address===t.mintA.address||e.mintA.address===t.mintB.address)||!(e.mintB.address===t.mintA.address||e.mintB.address===t.mintB.address))throw Error("mint check error");let y=this.createTxBuilder();y.addCustomComputeBudget(u);let f={};for(let $ of this.scope.account.tokenAccountRawInfos)(f[$.accountInfo.mint.toString()]===void 0||ge(this.scope.ownerPubKey,$.accountInfo.mint,Fr).publicKey.equals($.pubkey))&&(f[$.accountInfo.mint.toString()]=$.pubkey);let b=f[e.lpMint.address];if(b===void 0)throw Error("find lp account error in trade accounts");let w=n.add(s!=null?s:new Pt(0)),A=e.mintA.address===ce.WSOL.mint.toString(),k=e.mintB.address===ce.WSOL.mint.toString(),{account:P,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:Fr,mint:new qt(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:A?{payer:this.scope.ownerPubKey}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:!0,checkCreateATAOwner:m});if(y.addInstruction(T||{}),P===void 0)throw new Error("base token account not found");let{account:I,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:Fr,mint:new qt(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:k?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!k,notUseTokenAccount:k,associatedOnly:!0,checkCreateATAOwner:m});if(y.addInstruction(x||{}),I===void 0)throw new Error("quote token account not found");if(f[e.mintA.address]=P,f[e.mintB.address]=I,o!==void 0&&!(s!=null&&s.isZero())){let $=[];for(let Ut of o.rewardInfos){let $n=Ut.mint.address===ce.WSOL.mint.toString();if(f[Ut.mint.address])$.push(f[Ut.mint.address]);else{let{account:wn,instructionParams:kn}=await this.scope.account.getOrCreateTokenAccount({mint:new qt(Ut.mint.address),tokenProgram:l,owner:this.scope.ownerPubKey,skipCloseAccount:!$n,createInfo:{payer:c||this.scope.ownerPubKey},associatedOnly:!0,checkCreateATAOwner:m});wn||this.logAndCreateError("farm reward account not found:",Ut.mint.address),kn&&y.addInstruction(kn),$.push(wn)}}let Q=(await this.scope.api.fetchFarmKeysById({ids:o.id}))[0],te={amount:s,owner:this.scope.ownerPubKey,farmInfo:o,farmKeys:Q,lpAccount:b,rewardAccounts:$},et=st[o.programId],qr=et===6?Mn(te):et===5?Vn(te):En(te),Ur={3:_.FarmV3Withdraw,5:_.FarmV5Withdraw,6:_.FarmV6Withdraw};y.addInstruction({instructions:[qr],instructionTypes:[Ur[et]]})}let L=await this.scope.api.fetchPoolKeysById({id:e.id}),O=vi({poolInfo:e,poolKeys:L,userKeys:{lpTokenAccount:b,baseTokenAccount:P,quoteTokenAccount:I,owner:this.scope.ownerPubKey},amountIn:w});y.addInstruction({instructions:[O],instructionTypes:[e.pooltype.includes("StablePool")?_.AmmV5RemoveLiquidity:_.AmmV4RemoveLiquidity],lookupTableAddress:L.lookupTableAccount?[L.lookupTableAccount]:[]});let[R,E]=e.mintA.address===t.mintA.address?[P,I]:[I,P],ee=await this.scope.api.fetchPoolKeysById({id:t.id}),W=await ke.openPositionFromBaseInstructions(q(N({poolInfo:t,poolKeys:ee,ownerInfo:{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:R,tokenAccountB:E},withMetadata:"create"},r),{base:a,getEphemeralSigners:d}));return y.addInstruction({instructions:[...W.instructions],signers:W.signers,instructionTypes:[...W.instructionTypes],lookupTableAddress:ee.lookupTableAccount?[ee.lookupTableAccount]:[]}),p===0?y.sizeCheckBuildV0():y.sizeCheckBuild()}async createPoolV4({programId:e,marketInfo:t,baseMintInfo:n,quoteMintInfo:r,baseAmount:o,quoteAmount:s,startTime:a,ownerInfo:u,associatedOnly:c=!1,checkCreateATAOwner:l=!1,tokenProgram:m,txVersion:d,feeDestinationId:p,computeBudgetConfig:y}){var E;let f=u.feePayer||((E=this.scope.owner)==null?void 0:E.publicKey),b=u.useSOLBalance&&n.mint.equals(zs),w=u.useSOLBalance&&r.mint.equals(zs),A=this.createTxBuilder(),{account:k,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({mint:n.mint,owner:this.scope.ownerPubKey,createInfo:b?{payer:f,amount:o}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:c,checkCreateATAOwner:l});A.addInstruction(P||{});let{account:T,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({mint:r.mint,owner:this.scope.ownerPubKey,createInfo:w?{payer:f,amount:s}:void 0,notUseTokenAccount:w,skipCloseAccount:!w,associatedOnly:w?!1:c,checkCreateATAOwner:l});if(A.addInstruction(I||{}),k===void 0||T===void 0)throw Error("you don't has some token account");let x=Xs({version:4,marketVersion:3,marketId:t.marketId,baseMint:n.mint,quoteMint:r.mint,baseDecimals:n.decimals,quoteDecimals:r.decimals,programId:e,marketProgramId:t.programId}),L={programId:e,ammId:x.id,ammAuthority:x.authority,ammOpenOrders:x.openOrders,lpMint:x.lpMint,coinMint:x.baseMint,pcMint:x.quoteMint,coinVault:x.baseVault,pcVault:x.quoteVault,withdrawQueue:x.withdrawQueue,ammTargetOrders:x.targetOrders,poolTempLp:x.lpVault,marketProgramId:x.marketProgramId,marketId:x.marketId,ammConfigId:x.configId,feeDestinationId:p},{instruction:O,instructionType:R}=Ts(q(N({},L),{userWallet:this.scope.ownerPubKey,userCoinVault:k,userPcVault:T,userLpVault:ge(this.scope.ownerPubKey,x.lpMint,m).publicKey,nonce:x.nonce,openTime:a,coinAmount:o,pcAmount:s}));return A.addInstruction({instructions:[O],instructionTypes:[R]}),A.addCustomComputeBudget(y),A.versionBuild({txVersion:d,extInfo:{address:L}})}async getCreatePoolFee({programId:e}){let t=Qi({programId:e}),n=await this.scope.connection.getAccountInfo(t,{dataSlice:{offset:536,length:8}});if(n===null)throw Error("get config account error");return ks.decode(n.data).fee}};import{PublicKey as ae}from"@solana/web3.js";import Je from"bn.js";var Yn=class extends he{constructor(e){super(e)}async load(e){await this.scope.token.load(e)}async createPool(e){var A;let{programId:t,owner:n=((A=this.scope.owner)==null?void 0:A.publicKey)||ae.default,mint1:r,mint2:o,ammConfig:s,initialPrice:a,startTime:u,computeBudgetConfig:c,forerunCreate:l,txVersion:m}=e,d=this.createTxBuilder(),[p,y,f]=new Je(new ae(r.address).toBuffer()).gt(new Je(new ae(o.address).toBuffer()))?[o,r,new F(1).div(a)]:[r,o,a],b=J.priceToSqrtPriceX64(f,p.decimals,y.decimals),w=await ke.createPoolInstructions({connection:this.scope.connection,programId:t,owner:n,mintA:p,mintB:y,ammConfigId:s.id,initialPriceX64:b,startTime:u,forerunCreate:l});return d.addInstruction(w),d.addCustomComputeBudget(c),d.versionBuild({txVersion:m,extInfo:{address:q(N({},w.address),{programId:t.toString(),id:w.address.poolId.toString(),mintA:p,mintB:y,openTime:u.toNumber(),vault:{A:w.address.mintAVault.toString(),B:w.address.mintBVault.toString()},rewardInfos:[],config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}}),mockPoolInfo:N({type:"Concentrated",rewardDefaultPoolInfos:"Clmm",id:w.address.poolId.toString(),mintA:p,mintB:y,feeRate:s.tradeFeeRate,openTime:u.toNumber(),programId:t.toString(),price:f.toNumber(),config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}},Ms),forerunCreate:l}})}async openPositionFromBase({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,associatedOnly:c=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",getEphemeralSigners:d,computeBudgetConfig:p,txVersion:y}){this.scope.availability.addConcentratedPosition===!1&&this.logAndCreateError("add position feature disabled in your region"),this.scope.checkOwner();let f=this.createTxBuilder(),b=null,w=null,A=n.useSOLBalance&&e.mintA.address===Z.toString(),k=n.useSOLBalance&&e.mintB.address===Z.toString(),[P,T]=s==="MintA"?[a,u]:[u,a],{account:I,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new ae(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:A||P.isZero()?{payer:this.scope.ownerPubKey,amount:P}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:c,checkCreateATAOwner:l});I&&(b=I),f.addInstruction(x||{});let{account:L,instructionParams:O}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new ae(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:k||T.isZero()?{payer:this.scope.ownerPubKey,amount:T}:void 0,skipCloseAccount:!k,notUseTokenAccount:k,associatedOnly:k?!1:c,checkCreateATAOwner:l});L&&(w=L),f.addInstruction(O||{}),(!b||!w)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let R=t||await this.scope.api.fetchPoolKeysById({id:e.id}),E=await ke.openPositionFromBaseInstructions({poolInfo:e,poolKeys:R,ownerInfo:q(N({},n),{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:b,tokenAccountB:w}),tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:m,getEphemeralSigners:d});return f.addInstruction(E),f.addCustomComputeBudget(p),f.versionBuild({txVersion:y,extInfo:E.address})}async openPositionFromLiquidity({poolInfo:e,poolKeys:t,ownerInfo:n,amountMaxA:r,amountMaxB:o,tickLower:s,tickUpper:a,liquidity:u,associatedOnly:c=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",txVersion:d,getEphemeralSigners:p}){this.scope.availability.createConcentratedPosition===!1&&this.logAndCreateError("open position feature disabled in your region");let y=this.createTxBuilder(),f=null,b=null,w=n.useSOLBalance&&e.mintA.address===Z.toBase58(),A=n.useSOLBalance&&e.mintB.address===Z.toBase58(),{account:k,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new ae(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:w?{payer:this.scope.ownerPubKey,amount:r}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:c,checkCreateATAOwner:l});k&&(f=k),y.addInstruction(P||{});let{account:T,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new ae(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:A?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:c,checkCreateATAOwner:l});T&&(b=T),y.addInstruction(I||{}),(f===void 0||b===void 0)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let x=t||await this.scope.api.fetchPoolKeysById({id:e.id}),L=await ke.openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:x,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:b},tickLower:s,tickUpper:a,liquidity:u,amountMaxA:r,amountMaxB:o,withMetadata:m,getEphemeralSigners:p});return y.addInstruction(L),y.versionBuild({txVersion:d,extInfo:{address:L.address}})}async increasePositionFromLiquidity(e){let{poolInfo:t,ownerPosition:n,amountMaxA:r,amountMaxB:o,liquidity:s,ownerInfo:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:l,txVersion:m}=e,d=this.createTxBuilder(),p,y,f=a.useSOLBalance&&t.mintA.address===Z.toString(),b=a.useSOLBalance&&t.mintB.address===Z.toString(),{account:w,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new ae(t.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:f?{payer:this.scope.ownerPubKey,amount:r}:void 0,skipCloseAccount:!f,associatedOnly:f?!1:u,checkCreateATAOwner:c});w&&(p=w),d.addInstruction(A||{});let{account:k,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({mint:new ae(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:b?{payer:this.scope.ownerPubKey,amount:o}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:u,checkCreateATAOwner:c});k&&(y=k),d.addInstruction(P||{}),!p&&!y&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let T=await this.scope.api.fetchPoolKeysById({id:t.id}),I=ke.increasePositionFromLiquidityInstructions({poolInfo:t,poolKeys:T,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:y},liquidity:s,amountMaxA:r,amountMaxB:o});return d.addInstruction(I),d.addCustomComputeBudget(l),d.versionBuild({txVersion:m,extInfo:{address:I.address}})}async increasePositionFromBase(e){let{poolInfo:t,ownerPosition:n,base:r,baseAmount:o,otherAmountMax:s,ownerInfo:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:l,txVersion:m}=e,d=this.createTxBuilder(),p,y,f=a.useSOLBalance&&t.mintA.address===Z.toString(),b=a.useSOLBalance&&t.mintB.address===Z.toString(),{account:w,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new ae(t.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:f?{payer:this.scope.ownerPubKey,amount:r==="MintA"?o:s}:void 0,skipCloseAccount:!f,associatedOnly:f?!1:u,checkCreateATAOwner:c});w&&(p=w),d.addInstruction(A||{});let{account:k,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({mint:new ae(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:b?{payer:this.scope.ownerPubKey,amount:r==="MintA"?s:o}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:u,checkCreateATAOwner:c});k&&(y=k),d.addInstruction(P||{}),!p&&!y&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let T=await this.scope.api.fetchPoolKeysById({id:t.id}),I=ke.increasePositionFromBaseInstructions({poolInfo:t,poolKeys:T,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:y},base:r,baseAmount:o,otherAmountMax:s});return d.addInstruction(I),d.addCustomComputeBudget(l),d.versionBuild({txVersion:m,extInfo:{address:I.address}})}async decreaseLiquidity(e){let{poolInfo:t,ownerPosition:n,ownerInfo:r,amountMinA:o,amountMinB:s,liquidity:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:l,txVersion:m}=e;this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let d=this.createTxBuilder(),p=r.useSOLBalance&&t.mintA.address===Z.toString(),y=r.useSOLBalance&&t.mintB.address===Z.toString(),f,b,{account:w,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new ae(t.mintA.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!p,associatedOnly:p?!1:u,checkCreateATAOwner:c});f=w,A&&d.addInstruction(A);let{account:k,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new ae(t.mintB.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!y,associatedOnly:y?!1:u,checkCreateATAOwner:c});b=k,P&&d.addInstruction(P);let T=[];for(let O of t.rewardDefaultInfos){let R=r.useSOLBalance&&O.mint.address===Z.toString(),E;if(O.mint.address===t.mintA.address)E=f;else if(O.mint.address===t.mintB.address)E=b;else{let{account:ee,instructionParams:W}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new ae(O.mint.programId),mint:new ae(O.mint.address),notUseTokenAccount:R,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!R,associatedOnly:R?!1:u,checkCreateATAOwner:c});E=ee,W&&d.addInstruction(W)}T.push(E)}!f&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccountRawInfos);let I=await this.scope.api.fetchPoolKeysById({id:t.id}),x=await ke.decreaseLiquidityInstructions({poolInfo:t,poolKeys:I,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:b,rewardAccounts:T},liquidity:a,amountMinA:o,amountMinB:s});d.addInstruction({instructions:x.instructions,instructionTypes:[_.ClmmDecreasePosition]});let L=N({},x.address);if(r.closePosition){let O=await ke.closePositionInstructions({poolInfo:t,poolKeys:I,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:n});d.addInstruction({endInstructions:O.instructions,endInstructionTypes:O.instructionTypes}),L=N(N({},L),O.address)}return d.addCustomComputeBudget(l),d.versionBuild({txVersion:m,extInfo:{address:L}})}async closePosition({poolInfo:e,ownerPosition:t,txVersion:n}){this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let r=this.createTxBuilder(),o=await this.scope.api.fetchPoolKeysById({id:e.id}),s=ke.closePositionInstructions({poolInfo:e,poolKeys:o,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:t});return r.addInstruction(s).versionBuild({txVersion:n,extInfo:{address:s.address}})}async initReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let u=this.createTxBuilder(),c=t.useSOLBalance&&n.mint.address.toString()===Z.toString(),l=n.perSecond.mul(n.endTime-n.openTime),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new ae(n.mint.address),mint:new ae(n.mint.address),notUseTokenAccount:!!c,skipCloseAccount:!c,owner:this.scope.ownerPubKey,createInfo:c?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Je(new F(l.toFixed(0)).gte(l)?l.toFixed(0):l.add(1).toFixed(0))}:void 0,associatedOnly:c?!1:r,checkCreateATAOwner:o});d&&u.addInstruction(d),m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let p=await this.scope.api.fetchPoolKeysById({id:e.id}),y=ke.initRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardInfo:{programId:new ae(n.mint.programId),mint:new ae(n.mint.address),openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:j.decimalToX64(n.perSecond)}});return u.addInstruction(y),u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:y.address}})}async initRewards({poolInfo:e,ownerInfo:t,rewardInfos:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){for(let l of n)l.endTime<=l.openTime&&this.logAndCreateError("reward time error","rewardInfo",l);let u=this.createTxBuilder(),c={};for(let l of n){let m=t.useSOLBalance&&l.mint.address===Z.toString(),d=l.perSecond.mul(l.endTime-l.openTime),{account:p,instructionParams:y}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new ae(l.mint.programId),mint:new ae(l.mint.address),notUseTokenAccount:!!m,skipCloseAccount:!m,owner:this.scope.ownerPubKey,createInfo:m?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Je(new F(d.toFixed(0)).gte(d)?d.toFixed(0):d.add(1).toFixed(0))}:void 0,associatedOnly:m?!1:r,checkCreateATAOwner:o});y&&u.addInstruction(y),p||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let f=await this.scope.api.fetchPoolKeysById({id:e.id}),b=ke.initRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:p},rewardInfo:{programId:new ae(l.mint.programId),mint:new ae(l.mint.address),openTime:l.openTime,endTime:l.endTime,emissionsPerSecondX64:j.decimalToX64(l.perSecond)}});c=N(N({},c),b.address),u.addInstruction(b)}return u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:c}})}async setReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let u=this.createTxBuilder(),c=t.useSOLBalance&&n.mint.equals(Z),{account:l,instructionParams:m}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.programId,mint:n.mint,notUseTokenAccount:c,owner:this.scope.ownerPubKey,createInfo:c?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Je(new F(n.perSecond.sub(n.endTime-n.openTime).toFixed(0)).gte(n.perSecond.sub(n.endTime-n.openTime))?n.perSecond.sub(n.endTime-n.openTime).toFixed(0):n.perSecond.sub(n.endTime-n.openTime).add(1).toFixed(0))}:void 0,associatedOnly:c?!1:r,checkCreateATAOwner:o});m&&u.addInstruction(m),l||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let d=await this.scope.api.fetchPoolKeysById({id:e.id}),p=ke.setRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:l},rewardInfo:{mint:n.mint,openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:j.decimalToX64(n.perSecond)}});return u.addInstruction(p),u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:p.address}})}async setRewards({poolInfo:e,ownerInfo:t,rewardInfos:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){let u=this.createTxBuilder(),c={};for(let l of n){l.endTime<=l.openTime&&this.logAndCreateError("reward time error","rewardInfo",l);let m=t.useSOLBalance&&l.mint.address===Z.toString(),{account:d,instructionParams:p}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new ae(l.mint.programId),mint:new ae(l.mint.address),notUseTokenAccount:m,owner:this.scope.ownerPubKey,createInfo:m?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Je(new F(l.perSecond.sub(l.endTime-l.openTime).toFixed(0)).gte(l.perSecond.sub(l.endTime-l.openTime))?l.perSecond.sub(l.endTime-l.openTime).toFixed(0):l.perSecond.sub(l.endTime-l.openTime).add(1).toFixed(0))}:void 0,associatedOnly:m?!1:r,checkCreateATAOwner:o});p&&u.addInstruction(p),d||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let y=await this.scope.api.fetchPoolKeysById({id:e.id}),f=ke.setRewardInstructions({poolInfo:e,poolKeys:y,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:d},rewardInfo:{mint:new ae(l.mint.address),openTime:l.openTime,endTime:l.endTime,emissionsPerSecondX64:j.decimalToX64(l.perSecond)}});u.addInstruction(f),c=N(N({},c),f.address)}return u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:c}})}async collectReward({poolInfo:e,ownerInfo:t,rewardMint:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1}){let s=e.rewardDefaultInfos.find(p=>p.mint.address===n.toString());s||this.logAndCreateError("reward mint error","not found reward mint",n);let a=this.createTxBuilder(),u=t.useSOLBalance&&n.equals(Z),{account:c,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new ae(s.mint.programId),mint:n,notUseTokenAccount:u,owner:this.scope.ownerPubKey,skipCloseAccount:!u,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:u?!1:r,checkCreateATAOwner:o});l&&a.addInstruction(l),c||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let m=await this.scope.api.fetchPoolKeysById({id:e.id}),d=ke.collectRewardInstructions({poolInfo:e,poolKeys:m,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:c},rewardMint:n});return a.addInstruction(d),a.build({address:d.address})}async collectRewards({poolInfo:e,ownerInfo:t,rewardMints:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1}){let s=this.createTxBuilder(),a={};for(let u of n){let c=e.rewardDefaultInfos.find(f=>f.mint.address===u.toString());if(!c){this.logAndCreateError("reward mint error","not found reward mint",u);continue}let l=t.useSOLBalance&&u.equals(Z),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new ae(c.mint.programId),mint:u,notUseTokenAccount:l,owner:this.scope.ownerPubKey,skipCloseAccount:!l,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:l?!1:r,checkCreateATAOwner:o});m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos),d&&s.addInstruction(d);let p=await this.scope.api.fetchPoolKeysById({id:e.id}),y=ke.collectRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardMint:u});s.addInstruction(y),a=N(N({},a),y.address)}return s.build({address:a})}async harvestAllRewards({allPoolInfo:e,allPositions:t,ownerInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,programId:s,txVersion:a,computeBudgetConfig:u}){let c={};for(let m of this.scope.account.tokenAccountRawInfos)r?ge(this.scope.ownerPubKey,m.accountInfo.mint,s).publicKey.equals(m.pubkey)&&(c[m.accountInfo.mint.toString()]=m.pubkey):c[m.accountInfo.mint.toString()]=m.pubkey;let l=this.createTxBuilder();l.addCustomComputeBudget(u);for(let m of Object.values(e)){if(t[m.id]===void 0||!t[m.id].find(k=>!k.liquidity.isZero()||k.rewardInfos.find(P=>!P.rewardAmountOwed.isZero())))continue;let d=m,p=n.useSOLBalance&&d.mintA.address===Z.toString(),y=n.useSOLBalance&&d.mintB.address===Z.toString(),f=c[d.mintA.address];if(!f){let{account:k,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:d.mintA.programId,mint:new ae(d.mintA.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,skipCloseAccount:!0,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:p?!1:r,checkCreateATAOwner:o});f=k,P&&l.addInstruction(P)}let b=c[d.mintB.address];if(!b){let{account:k,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:d.mintB.programId,mint:new ae(d.mintB.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,skipCloseAccount:!0,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:y?!1:r,checkCreateATAOwner:o});b=k,P&&l.addInstruction(P)}c[d.mintA.address]=f,c[d.mintB.address]=b;let w=[];for(let k of d.rewardDefaultInfos){let P=n.useSOLBalance&&k.mint.address===Z.toString(),T=c[k.mint.address];if(!T){let{account:I,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new ae(k.mint.programId),mint:new ae(k.mint.address),notUseTokenAccount:P,owner:this.scope.ownerPubKey,skipCloseAccount:!P,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:P?!1:r});T=I,x&&l.addInstruction(x)}c[k.mint.address]=T,w.push(T)}let A=await this.scope.api.fetchPoolKeysById({id:d.id});for(let k of t[m.id]){let P=ke.decreaseLiquidityInstructions({poolInfo:d,poolKeys:A,ownerPosition:k,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:b,rewardAccounts:w},liquidity:new Je(0),amountMinA:new Je(0),amountMinB:new Je(0)});l.addInstruction(P)}}return a===0?l.sizeCheckBuildV0():l.sizeCheckBuild()}async getWhiteListMint({programId:e}){let t=await this.scope.connection.getAccountInfo(Dn(e).publicKey);return t?vs.decode(t.data).whitelistMints.filter(r=>!r.equals(ae.default)):[]}async computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,token2022Infos:r,amountOut:o,slippage:s,priceLimit:a=new F(0)}){var I;let u=await this.scope.fetchEpochInfo(),c;a.equals(new F(0))?c=n.toString()===e.mintB.address?kt.add(Fe):ht.sub(Fe):c=J.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let l=cn(o,(I=r[n.toString()])==null?void 0:I.feeConfig,u,!0),{expectedAmountIn:m,remainingAccounts:d,executionPrice:p,feeAmount:y}=Oe.getInputAmountAndRemainAccounts(e,t,n,l.amount.sub(l.fee||new Je(0)),c),f=J.sqrtPriceX64ToPrice(p,e.mintA.decimals,e.mintB.decimals),b=n.toString()===e.mintA.address?f:new F(1).div(f),w=m.mul(new Je(Math.floor((1+s)*1e10))).div(new Je(1e10)),A=e.mintA.address===n.toString()?e.price:new F(1).div(e.price),k=new F(b).sub(A).abs(),P=A,T=new je(new F(k).mul(10**15).toFixed(0),new F(P).mul(10**15).toFixed(0));return{amountIn:m,maxAmountIn:w,currentPrice:new F(e.price),executionPrice:b,priceImpact:T,fee:y,remainingAccounts:d}}};import{PublicKey as sl}from"@solana/web3.js";import{createTransferInstruction as al}from"@solana/spl-token";import{TOKEN_PROGRAM_ID as rl,TOKEN_2022_PROGRAM_ID as ji}from"@solana/spl-token";import{PublicKey as vr,TransactionInstruction as il,SystemProgram as wA}from"@solana/web3.js";import Hi from"bn.js";function Ys(i,e,t,n,r,o){if(i.pooltype.includes("StablePool")){let s=Pe(e);return[{pubkey:s.programId,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.authority,isSigner:!1,isWritable:!1},{pubkey:s.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:new vr("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:s.openOrders,isSigner:!1,isWritable:!0},{pubkey:s.vault.A,isSigner:!1,isWritable:!0},{pubkey:s.vault.B,isSigner:!1,isWritable:!0},{pubkey:s.marketId,isSigner:!1,isWritable:!0},{pubkey:s.marketBids,isSigner:!1,isWritable:!0},{pubkey:s.marketAsks,isSigner:!1,isWritable:!0},{pubkey:s.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0}]}else if(i.type==="Concentrated"){let s=i,a=Pe(e),u=s.mintA.address===t;return[{pubkey:new vr(String(i.programId)),isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a.config.id,isSigner:!1,isWritable:!1},{pubkey:a.id,isSigner:!1,isWritable:!0},{pubkey:u?a.vault.A:a.vault.B,isSigner:!1,isWritable:!0},{pubkey:u?a.vault.B:a.vault.A,isSigner:!1,isWritable:!0},{pubkey:a.id,isSigner:!1,isWritable:!0},...a.mintA.programId.equals(ji)||a.mintB.programId.equals(ji)?[{pubkey:ji,isSigner:!1,isWritable:!1},{pubkey:nn,isSigner:!1,isWritable:!1},{pubkey:u?a.mintA.address:a.mintB.address,isSigner:!1,isWritable:!1},{pubkey:u?a.mintB.address:a.mintA.address,isSigner:!1,isWritable:!1}]:[],...(o!=null?o:[]).map(c=>({pubkey:c,isSigner:!1,isWritable:!0})),{pubkey:gt(new vr(String(i.programId)),new vr(i.id)).publicKey,isSigner:!1,isWritable:!0}]}else{let s=Pe(e);return[{pubkey:s.programId,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.authority,isSigner:!1,isWritable:!1},{pubkey:s.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:s.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:s.openOrders,isSigner:!1,isWritable:!0},{pubkey:s.vault.A,isSigner:!1,isWritable:!0},{pubkey:s.vault.B,isSigner:!1,isWritable:!0},{pubkey:s.marketId,isSigner:!1,isWritable:!0},{pubkey:s.marketBids,isSigner:!1,isWritable:!0},{pubkey:s.marketAsks,isSigner:!1,isWritable:!0},{pubkey:s.marketEventQueue,isSigner:!1,isWritable:!0},...s.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:s.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:s.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0}]]}}function ol(i,e,t,n,r,o,s,a,u,c,l,m,d,p){let y=M([v("instruction"),g("amountIn"),g("amountOut")]),f=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:rl,isSigner:!1,isWritable:!1}];f.push(...Ys(a,c,o,t,n,p[0])),f.push(...Ys(u,l,s,n,r,p[1]));let b=Buffer.alloc(y.span);return y.encode({instruction:8,amountIn:m,amountOut:d},b),new il({keys:f,programId:i,data:b})}async function Qs({routeProgram:i,ownerInfo:e,inputMint:t,swapInfo:n}){var r,o,s,a,u,c;if(n.routeType==="amm")if(n.poolInfo[0].type==="Concentrated"){let l=Pe(n.poolKey[0]),m=t.equals(l.mintA.address)?kt.add(Fe):ht.sub(Fe);return await ke.makeSwapBaseInInstructions({poolInfo:l,poolKeys:l,ownerInfo:{wallet:e.wallet,tokenAccountA:l.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:l.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((o=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?o:new Hi(0)),sqrtPriceLimitX64:m,remainingAccounts:n.remainingAccounts[0]})}else{let l=n.poolKey[0];return{signers:[],instructions:[Is({poolKeys:l,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((a=(s=n.minAmountOut.fee)==null?void 0:s.raw)!=null?a:new Hi(0)),fixedSide:"in"})],lookupTableAddress:l.lookupTableAccount?[l.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?_.AmmV5SwapBaseIn:_.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let l=n.poolInfo[0],m=n.poolInfo[1],d=n.poolKey[0],p=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[ol(i,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.minMiddleAmountFee.token.mint.toString(),l,m,d,p,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((c=(u=n.minAmountOut.fee)==null?void 0:u.raw)!=null?c:new Hi(0)),n.remainingAccounts)],instructionTypes:[_.RouteSwap],lookupTableAddress:[d.lookupTableAccount,p.lookupTableAccount].filter(y=>y!==void 0),address:{}}}else throw Error("route type error")}var Qn=class extends he{constructor(e){super(e)}static getAddLiquidityDefaultPool({addLiquidityPools:e,poolInfosCache:t}){if(e.length===0)return;if(e.length===1||(e.sort((r,o)=>o.version-r.version),e[0].version!==e[1].version))return e[0];let n=e.filter(r=>r.version===e[0].version);return n.sort((r,o)=>this.comparePoolSize(r,o,t)),n[0]}static comparePoolSize(e,t,n){let r=n[e.id],o=n[t.id];return r===void 0?1:o===void 0?-1:e.baseMint===t.baseMint?r.baseReserve.sub(o.baseReserve).gte(Ge)?-1:1:r.baseReserve.sub(o.quoteReserve).gte(Ge)?-1:1}async getWSolAccounts(){this.scope.checkOwner(),await this.scope.account.fetchWalletTokenAccounts();let e=this.scope.account.tokenAccounts.filter(t=>t.mint.equals(Z));return e.sort((t,n)=>t.isAssociated?1:n.isAssociated||t.amount.lt(n.amount)?-1:1),e}async unWrapWSol(e){let{amount:t,tokenProgram:n}=e,r=await this.getWSolAccounts(),o=this.createTxBuilder();o.addCustomComputeBudget(e.computeBudgetConfig);let s=await pt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:0});o.addInstruction(s);let a=z(t);for(let u=0;u<r.length;u++)a.gte(r[u].amount)?(o.addInstruction({instructions:[xt({tokenAccount:r[u].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:n})]}),a.sub(r[u].amount)):(o.addInstruction({instructions:[xt({tokenAccount:r[u].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:n})]}),On({destination:s.addresses.newAccount,source:r[u].publicKey,amount:a,owner:this.scope.ownerPubKey,tokenProgram:n}));return o.build()}async wrapWSol(e,t){let n=await this.getWSolAccounts(),r=this.createTxBuilder(),o=await pt({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:e,skipCloseAccount:!0});return r.addInstruction(o),n.length&&r.addInstruction({instructions:[On({destination:n[0].publicKey,source:o.addresses.newAccount,amount:e,owner:this.scope.ownerPubKey,tokenProgram:t})],endInstructions:[xt({tokenAccount:o.addresses.newAccount,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:t})]}),r.build()}async swap({swapInfo:e,associatedOnly:t,checkCreateATAOwner:n,checkTransaction:r,routeProgram:o=new sl("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS")}){let s=q(N({},e),{amountIn:this.scope.solToWsolTransferAmountFee(e.amountIn),amountOut:this.scope.solToWsolTransferAmountFee(e.amountOut),minAmountOut:this.scope.solToWsolTransferAmountFee(e.minAmountOut),middleMint:e.minMiddleAmountFee?Ot(e.middleToken.mint):void 0}),a=s.amountIn,u=s.amountOut,c=a.amount.token.mint.equals(ce.WSOL.mint)||a.amount.token.mint.equals(le),l=u.amount.token.mint.equals(ce.WSOL.mint)||u.amount.token.mint.equals(le),m=a.amount.token.mint,d=s.middleMint,p=u.amount.token.mint,y=this.createTxBuilder(),{account:f,instructionParams:b}=await this.scope.account.getOrCreateTokenAccount({mint:m,notUseTokenAccount:c,createInfo:c?{payer:this.scope.ownerPubKey,amount:a.amount.raw}:void 0,owner:this.scope.ownerPubKey,skipCloseAccount:!c,associatedOnly:c?!1:t,checkCreateATAOwner:n});if(b&&y.addInstruction(b),f===void 0)throw Error("input account check error");let{account:w,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({mint:p,skipCloseAccount:!l,createInfo:{payer:this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,associatedOnly:t,checkCreateATAOwner:n});A&&y.addInstruction(A);let k;if(s.routeType==="route"){let Q=await this.scope.account.getOrCreateTokenAccount({mint:d,createInfo:{payer:this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,associatedOnly:!1,checkCreateATAOwner:n});k=Q.account,Q.instructionParams&&y.addInstruction(Q.instructionParams)}let P=await Qs({routeProgram:o,inputMint:m,swapInfo:s,ownerInfo:{wallet:this.scope.ownerPubKey,sourceToken:f,routeToken:k,destinationToken:w}}),T=s.feeConfig!==void 0?[al(f,s.feeConfig.feeAccount,this.scope.ownerPubKey,s.feeConfig.feeAmount.toNumber())]:[],I=s.feeConfig!==void 0?[_.TransferAmount]:[],x=[],L=[],O=await y.getComputeBudgetConfig();if(O){let{instructions:Q,instructionTypes:te}=sn(O);x.push(...Q),L.push(...te)}let R=[],E=[...x,...T,...y.AllTxData.instructions,...P.instructions,...y.AllTxData.endInstructions],ee=[...L,...I,...y.AllTxData.instructionTypes,...P.instructionTypes,...y.AllTxData.endInstructionTypes],W=[...y.AllTxData.signers,...P.signers];if(r)if(Nt(E,[this.scope.ownerPubKey,...W.map(Q=>Q.publicKey)]))R.push(this.createTxBuilder().addInstruction({instructions:E,signers:W,instructionTypes:ee}));else{if(y.AllTxData.instructions.length>0&&R.push(this.createTxBuilder().addInstruction({instructions:y.AllTxData.instructions,signers:y.AllTxData.signers,instructionTypes:y.AllTxData.instructionTypes})),Nt([...x,...T,...P.instructions],[this.scope.ownerPubKey]))R.push(this.createTxBuilder().addInstruction({instructions:[...x,...T,...P.instructions],signers:P.signers,instructionTypes:[...L,...I,...P.instructionTypes]}));else if(Nt([...x,...P.instructions],[this.scope.ownerPubKey]))R.push(this.createTxBuilder().addInstruction({instructions:[...x,...P.instructions],signers:P.signers,instructionTypes:P.instructionTypes}));else if(Nt(P.instructions,[this.scope.ownerPubKey]))R.push(this.createTxBuilder().addInstruction({instructions:[...P.instructions],signers:P.signers,instructionTypes:P.instructionTypes}));else for(let Q=0;Q<P.instructions.length;Q++)R.push(this.createTxBuilder().addInstruction({instructions:[...x,P.instructions[Q]],signers:P.signers,instructionTypes:[...L,P.instructionTypes[Q]]}));y.AllTxData.endInstructions.length>0&&R.push(this.createTxBuilder().addInstruction({instructions:y.AllTxData.endInstructions,instructionTypes:y.AllTxData.endInstructionTypes}))}else s.routeType==="amm"?R.push(this.createTxBuilder().addInstruction({instructions:E,signers:W,instructionTypes:ee})):(y.AllTxData.instructions.length>0&&R.push(this.createTxBuilder().addInstruction({instructions:y.AllTxData.instructions,signers:y.AllTxData.signers,instructionTypes:y.AllTxData.instructionTypes})),R.push(this.createTxBuilder().addInstruction({instructions:P.instructions,signers:P.signers,instructionTypes:P.instructionTypes})),y.AllTxData.endInstructions.length>0&&R.push(this.createTxBuilder().addInstruction({instructions:y.AllTxData.endInstructions,instructionTypes:y.AllTxData.endInstructionTypes})));return R.shift().buildMultiTx({extraPreBuildData:R.map(Q=>Q.build())})}};import{TOKEN_PROGRAM_ID as ul}from"@solana/spl-token";import{PublicKey as cl,Transaction as Zi,TransactionInstruction as ll}from"@solana/web3.js";import js from"bn.js";var We=class extends he{static getPdaPoolId(e,t){return ye([We.SEED_CONFIG.pool.id,t.toBuffer()],e)}static getPdaOwnerId(e,t,n,r){return ye([We.SEED_CONFIG.owner.id,t.toBuffer(),n.toBuffer(),Buffer.from(new js(r).toArray())],e)}static async getAllInfo({connection:e,programId:t,poolIds:n,wallet:r,chainTime:o}){if(n.length===0)return[];let s=n.map(l=>We.getPdaPoolId(t,l).publicKey),a=[];for(let l=0;l<We.VERSION_PROJECT.length;l++)a.push(...s.map(m=>We.getPdaOwnerId(t,m,r,l).publicKey));let u=await mt(e,[...s,...a]),c=[];for(let l=0;l<u.length;l++){let m=Math.floor(l/n.length),d=l%n.length,p=s[d],y=a[l],f=u[d],b=u[n.length+l];if(!(f&&b)||f.data.length!==We.POOL_LAYOUT.span||b.data.length!==We.OWNER_LAYOUT.span)continue;let w=We.POOL_LAYOUT.decode(f.data),A=We.OWNER_LAYOUT.decode(b.data),k=w.openTime.toNumber(),P=w.endTime.toNumber(),T=A.tokenInfo.map(L=>L.debtAmount.gt(new js(0))).filter(L=>!L).length!==3,I=o>k&&o<P&&w.status===1,x=T&&I;c.push({programId:t,poolId:p,ammId:w.ammId,ownerAccountId:y,snapshotLpAmount:A.lpAmount,project:We.VERSION_PROJECT[m],openTime:k,endTime:P,canClaim:x,canClaimErrorType:T?I?void 0:"outOfOperationalTime":"alreadyClaimIt",tokenInfo:w.tokenInfo.map((L,O)=>({mintAddress:L.mintAddress,mintVault:L.mintVault,mintDecimals:L.mintDecimals,perLpLoss:L.perLpLoss,debtAmount:A.tokenInfo[O].debtAmount.add(A.tokenInfo[O].claimedAmount)}))})}return c}async makeClaimTransaction({poolInfo:e,ownerInfo:t}){t.wallet||this.scope.checkOwner();let n=this.createTxBuilder(),r=t.wallet||this.scope.ownerPubKey,o=[];for(let u of e.tokenInfo){let{account:c,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({mint:u.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:u.mintAddress.equals(ce.WSOL.mint),createInfo:{payer:r,amount:0},skipCloseAccount:!u.mintAddress.equals(ce.WSOL.mint),associatedOnly:u.mintAddress.equals(ce.WSOL.mint)?!1:t.associatedOnly});l&&n.addInstruction(l),o.push(c)}n.addInstruction({instructions:[We.makeClaimInstruction({programId:e.programId,poolInfo:e,ownerInfo:{wallet:r,ownerPda:e.ownerAccountId,claimAddress:o}})]});let{transaction:s,signers:a}=n.build();return[{transaction:s,signer:a}]}async makeClaimAllTransaction({poolInfos:e,ownerInfo:t}){let n=this.createTxBuilder(),r=t.wallet||this.scope.ownerPubKey,o={};for(let c of e){let l=[];for(let m of c.tokenInfo){let{account:d,instructionParams:p}=await this.scope.account.getOrCreateTokenAccount({mint:m.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:m.mintAddress.equals(ce.WSOL.mint),createInfo:{payer:r,amount:0},skipCloseAccount:!m.mintAddress.equals(ce.WSOL.mint),associatedOnly:m.mintAddress.equals(ce.WSOL.mint)?!1:t.associatedOnly});p&&n.addInstruction(p),d&&(o[m.mintAddress.toString()]=d,l.push(d))}n.addInstruction({instructions:[We.makeClaimInstruction({programId:c.programId,poolInfo:c,ownerInfo:{wallet:r,ownerPda:c.ownerAccountId,claimAddress:l}})]})}let{transaction:s,signers:a}=n.build(),u=n.allInstructions;return Nt(u,[r,...a.map(c=>c.publicKey)])?[{transaction:s,signer:a}]:[{transaction:new Zi().add(...u.slice(0,n.AllTxData.instructions.length-1)),signer:a},{transaction:new Zi().add(...u.slice(n.AllTxData.instructions.length-1)),signer:[]},{transaction:new Zi().add(...n.AllTxData.endInstructions),signer:[]}]}static makeClaimInstruction({programId:e,poolInfo:t,ownerInfo:n}){let r=M([]),o=[{pubkey:n.wallet,isSigner:!0,isWritable:!0},{pubkey:t.poolId,isSigner:!1,isWritable:!0},{pubkey:n.ownerPda,isSigner:!1,isWritable:!0},...n.claimAddress.map(u=>({pubkey:u,isSigner:!1,isWritable:!0})),...t.tokenInfo.map(({mintVault:u})=>({pubkey:u,isSigner:!1,isWritable:!0})),{pubkey:ul,isSigner:!1,isWritable:!1}],s=Buffer.alloc(r.span);r.encode({},s);let a=Buffer.from([10,66,208,184,161,6,191,98,...s]);return new ll({keys:o,programId:e,data:a})}},$e=We;$e.CLAIMED_NUM=3,$e.POOL_LAYOUT=M([we(8),v("bump"),v("status"),g("openTime"),g("endTime"),S("ammId"),G(M([v("mintDecimals"),S("mintAddress"),S("mintVault"),g("perLpLoss"),g("totalClaimedAmount")]),We.CLAIMED_NUM,"tokenInfo"),G(g(),10,"padding")]),$e.OWNER_LAYOUT=M([we(8),v("bump"),v("version"),S("poolId"),S("owner"),g("lpAmount"),G(M([S("mintAddress"),g("debtAmount"),g("claimedAmount")]),We.CLAIMED_NUM,"tokenInfo"),G(g(),4,"padding")]),$e.DEFAULT_POOL_ID=["58oQChx4yWmvKdwLLZzBi4ChoCc2fqCUWBkwMihLYQo2","6UmmUiYoBjSrhakAobJw8BvkmJtDVxaeBtbt7rxWo1mg","AVs9TA4nWDzfPJE9gGVNJMVhcQy3V9PGazuz33BfG2RA","DVa7Qmb5ct9RCpaU7UTpSaf3GVMYz17vNVU67XpdCRut","7XawhbbxtsRcQA8KTkHT9f9nc6d69UwqCDh6U5EEbEmX","6a1CsrpeZubDjEJE9s1CMVheB6HWM5d7m1cj2jkhyXhj","EoNrn8iUhwgJySD1pHu8Qxm5gSQqLK3za4m8xzD2RuEb","AceAyRTWt4PyB2pHqf2qhDgNZDtKVNaxgL8Ru3V4aN1P","6tmFJbMk5yVHFcFy7X2K8RwHjKLr6KVFLYXpgpBNeAxB"].map(e=>new cl(e)),$e.SEED_CONFIG={pool:{id:Buffer.from("pool_seed","utf8")},owner:{id:Buffer.from("user_claim_seed","utf8")}},$e.VERSION_PROJECT=[void 0,"Francium","Tulip","Larix"];import{PublicKey as $i}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ea}from"@solana/spl-token";import jn from"bn.js";import{TransactionInstruction as dl,SYSVAR_RENT_PUBKEY as pl}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Hs}from"@solana/spl-token";import{createInitializeAccountInstruction as Zs}from"@solana/spl-token";import{SystemProgram as Jt,Transaction as Js}from"@solana/web3.js";function ml(i="accountFlags"){let e=new Ir(i);return e.addBoolean("initialized"),e.addBoolean("market"),e.addBoolean("openOrders"),e.addBoolean("requestQueue"),e.addBoolean("eventQueue"),e.addBoolean("bids"),e.addBoolean("asks"),e}var Ji=M([we(5),ml("accountFlags"),S("ownAddress"),g("vaultSignerNonce"),S("baseMint"),S("quoteMint"),S("baseVault"),g("baseDepositsTotal"),g("baseFeesAccrued"),S("quoteVault"),g("quoteDepositsTotal"),g("quoteFeesAccrued"),g("quoteDustThreshold"),S("requestQueue"),S("eventQueue"),S("bids"),S("asks"),g("baseLotSize"),g("quoteLotSize"),g("feeRateBps"),g("referrerRebatesAccrued"),we(7)]);function fl({programId:i,marketInfo:e}){let t=M([v("version"),De("instruction"),g("baseLotSize"),g("quoteLotSize"),Mt("feeRateBps"),g("vaultSignerNonce"),g("quoteDustThreshold")]),n=[{pubkey:e.id,isSigner:!1,isWritable:!0},{pubkey:e.requestQueue,isSigner:!1,isWritable:!0},{pubkey:e.eventQueue,isSigner:!1,isWritable:!0},{pubkey:e.bids,isSigner:!1,isWritable:!0},{pubkey:e.asks,isSigner:!1,isWritable:!0},{pubkey:e.baseVault,isSigner:!1,isWritable:!0},{pubkey:e.quoteVault,isSigner:!1,isWritable:!0},{pubkey:e.baseMint,isSigner:!1,isWritable:!1},{pubkey:e.quoteMint,isSigner:!1,isWritable:!1},{pubkey:e.authority?e.quoteMint:pl,isSigner:!1,isWritable:!1}].concat(e.authority?{pubkey:e.authority,isSigner:!1,isWritable:!1}:[]).concat(e.authority&&e.pruneAuthority?{pubkey:e.pruneAuthority,isSigner:!1,isWritable:!1}:[]),r=Buffer.alloc(t.span);return t.encode({version:0,instruction:0,baseLotSize:e.baseLotSize,quoteLotSize:e.quoteLotSize,feeRateBps:e.feeRateBps,vaultSignerNonce:e.vaultSignerNonce,quoteDustThreshold:e.quoteDustThreshold},r),new dl({keys:n,programId:i,data:r})}async function $s({connection:i,wallet:e,marketInfo:t}){let n=new Js,r=await i.getMinimumBalanceForRentExemption(165);n.add(Jt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.baseVault.seed,newAccountPubkey:t.baseVault.publicKey,lamports:r,space:165,programId:Hs}),Jt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.quoteVault.seed,newAccountPubkey:t.quoteVault.publicKey,lamports:r,space:165,programId:Hs}),Zs(t.baseVault.publicKey,t.baseMint,t.vaultOwner),Zs(t.quoteVault.publicKey,t.quoteMint,t.vaultOwner));let o=new Js;return o.add(Jt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.id.seed,newAccountPubkey:t.id.publicKey,lamports:await i.getMinimumBalanceForRentExemption(Ji.span),space:Ji.span,programId:t.programId}),Jt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.requestQueue.seed,newAccountPubkey:t.requestQueue.publicKey,lamports:await i.getMinimumBalanceForRentExemption(5120+12),space:5120+12,programId:t.programId}),Jt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.eventQueue.seed,newAccountPubkey:t.eventQueue.publicKey,lamports:await i.getMinimumBalanceForRentExemption(262144+12),space:262144+12,programId:t.programId}),Jt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.bids.seed,newAccountPubkey:t.bids.publicKey,lamports:await i.getMinimumBalanceForRentExemption(65536+12),space:65536+12,programId:t.programId}),Jt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.asks.seed,newAccountPubkey:t.asks.publicKey,lamports:await i.getMinimumBalanceForRentExemption(65536+12),space:65536+12,programId:t.programId}),fl({programId:t.programId,marketInfo:{id:t.id.publicKey,requestQueue:t.requestQueue.publicKey,eventQueue:t.eventQueue.publicKey,bids:t.bids.publicKey,asks:t.asks.publicKey,baseVault:t.baseVault.publicKey,quoteVault:t.quoteVault.publicKey,baseMint:t.baseMint,quoteMint:t.quoteMint,baseLotSize:t.baseLotSize,quoteLotSize:t.quoteLotSize,feeRateBps:t.feeRateBps,vaultSignerNonce:t.vaultSignerNonce,quoteDustThreshold:t.quoteDustThreshold}})),[{transaction:n,signer:[],instructionTypes:[_.CreateAccount,_.CreateAccount,_.InitAccount,_.InitAccount]},{transaction:o,signer:[],instructionTypes:[_.CreateAccount,_.CreateAccount,_.CreateAccount,_.CreateAccount,_.CreateAccount,_.InitMarket]}]}var yn=class extends he{async create({baseInfo:e,quoteInfo:t,lotSize:n,tickSize:r,dexProgramId:o,txVersion:s,computeBudgetConfig:a}){let u=this.scope.ownerPubKey,c=Ee({fromPublicKey:u,programId:o}),l=Ee({fromPublicKey:u,programId:o}),m=Ee({fromPublicKey:u,programId:o}),d=Ee({fromPublicKey:u,programId:o}),p=Ee({fromPublicKey:u,programId:o}),y=Ee({fromPublicKey:u,programId:ea}),f=Ee({fromPublicKey:u,programId:ea}),b=0,w=new jn(100);function A(){let R=new jn(0);for(;;)try{return{vaultOwner:$i.createProgramAddressSync([c.publicKey.toBuffer(),R.toArrayLike(Buffer,"le",8)],o),vaultSignerNonce:R}}catch{if(R.iaddn(1),R.gt(new jn(25555)))throw Error("find vault owner error")}}let{vaultOwner:k,vaultSignerNonce:P}=A(),T=new jn(Math.round(10**e.decimals*n)),I=new jn(Math.round(n*10**t.decimals*r));if(T.eq(Ge))throw Error("lot size is too small");if(I.eq(Ge))throw Error("tick size or lot size is too small");let x=await $s({connection:this.scope.connection,wallet:this.scope.ownerPubKey,marketInfo:{programId:o,id:c,baseMint:e.mint,quoteMint:t.mint,baseVault:y,quoteVault:f,vaultOwner:k,requestQueue:l,eventQueue:m,bids:d,asks:p,feeRateBps:b,quoteDustThreshold:w,vaultSignerNonce:P,baseLotSize:T,quoteLotSize:I}}),L=this.createTxBuilder();L.addCustomComputeBudget(a),L.addInstruction({instructions:x[0].transaction.instructions,signers:x[0].signer});let O=[];for await(let R of x.slice(1,x.length)){let E=this.createTxBuilder();E.addCustomComputeBudget(a),E.addInstruction({instructions:R.transaction.instructions,signers:R.signer,instructionTypes:R.instructionTypes});let ee=await E.versionBuild({txVersion:s});O.push(ee)}return L.versionMultiBuild({extraPreBuildData:O,extInfo:{address:{marketId:c.publicKey,requestQueue:l.publicKey,eventQueue:m.publicKey,bids:d.publicKey,asks:p.publicKey,baseVault:y.publicKey,quoteVault:f.publicKey,baseMint:new $i(e.mint),quoteMin:new $i(t.mint)}},txVersion:s})}};import{PublicKey as Zn}from"@solana/web3.js";import{PublicKey as KP,TransactionInstruction as ta,SYSVAR_CLOCK_PUBKEY as bl}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as na}from"@solana/spl-token";var yl=M([v("instruction"),Uo("amount")]),Hn=M([v("instruction")]);function Wr({programId:i},e){let t=[{pubkey:na,isSigner:!1,isWritable:!1},{pubkey:To,isSigner:!1,isWritable:!1},...Object.entries(e).map(([r,o])=>({pubkey:o,isSigner:r==="userOwner",isWritable:!["authority","userOwner"].includes(r)}))],n=Buffer.alloc(Hn.span);return Hn.encode({instruction:2},n),new ta({keys:t,programId:i,data:n})}function eo(i){let{poolConfig:e,userKeys:t,side:n}=i,r=n==="base"?t.baseTokenAccount:t.quoteTokenAccount,o=n==="base"?e.baseVault:e.quoteVault,s=Buffer.alloc(Hn.span);Hn.encode({instruction:2},s);let a=[{pubkey:na,isWritable:!1,isSigner:!1},{pubkey:bl,isWritable:!1,isSigner:!1},{pubkey:e.id,isWritable:!0,isSigner:!1},{pubkey:e.authority,isWritable:!1,isSigner:!1},{pubkey:o,isWritable:!0,isSigner:!1},{pubkey:r,isWritable:!0,isSigner:!1},{pubkey:t.ledgerAccount,isWritable:!0,isSigner:!1},{pubkey:t.owner,isWritable:!1,isSigner:!0}];return new ta({programId:e.programId,keys:a,data:s})}import ra from"bn.js";var gl={[Rn.IDO_PROGRAM_ID_V1.toString()]:1,[Rn.IDO_PROGRAM_ID_V2.toString()]:2,[Rn.IDO_PROGRAM_ID_V3.toString()]:3,[Rn.IDO_PROGRAM_ID_V4.toString()]:4},bn=class extends he{async claim({ownerInfo:e,idoKeys:t,associatedOnly:n=!0,checkCreateATAOwner:r=!1,txVersion:o}){let s=this.createTxBuilder(),a=gl[t.programId];a||this.logAndCreateError("invalid version",a);let u=Pe(t),[c,l]=[!new ra(e.coin).isZero(),!new ra(e.pc).isZero()],m=u.projectInfo.mint.address.equals(Z),{account:d,instructionParams:p}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:u.projectInfo.mint.programId,mint:u.projectInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!m,notUseTokenAccount:m,associatedOnly:m?!1:n,checkCreateATAOwner:r});!d&&c&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),c&&p&&s.addInstruction(p);let y=u.buyInfo.mint.address.equals(Z),{account:f,instructionParams:b}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:u.buyInfo.mint.programId,mint:u.buyInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!y,notUseTokenAccount:y,associatedOnly:y?!1:n,checkCreateATAOwner:r});if(!d&&l&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),l&&b&&s.addInstruction(b),(!d||!f)&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address,t.buyInfo.mint.address),a===3)return s.addInstruction({instructions:[...c?[Wr({programId:u.programId},{idoId:u.id,authority:u.authority,poolTokenAccount:u.projectInfo.vault,userTokenAccount:d,userIdoInfo:new Zn(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[],...l?[Wr({programId:new Zn(t.programId)},{idoId:u.id,authority:u.authority,poolTokenAccount:u.buyInfo.vault,userTokenAccount:f,userIdoInfo:new Zn(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[]]}).versionBuild({txVersion:o});if(a<3)return!c&&!l&&this.logAndCreateError("no claimable rewards"),s.addInstruction({instructions:[Wr({programId:u.programId},{idoId:u.id,authority:u.authority,poolQuoteTokenAccount:u.buyInfo.vault,poolBaseTokenAccount:u.projectInfo.vault,userQuoteTokenAccount:f,userBaseTokenAccount:d,userIdoInfo:new Zn(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]}).versionBuild({txVersion:o});let w={poolConfig:{id:u.id,programId:u.programId,authority:u.authority,baseVault:u.projectInfo.vault,quoteVault:u.buyInfo.vault,baseToken:t.projectInfo.mint,quoteToken:t.buyInfo.mint},userKeys:{baseTokenAccount:d,quoteTokenAccount:f,ledgerAccount:new Zn(e.userIdoInfo),owner:this.scope.ownerPubKey}};return s.addInstruction({instructions:[...c?[eo(q(N({},w),{side:"base"}))]:[],...l?[eo(q(N({},w),{side:"quote"}))]:[]]}).versionBuild({txVersion:o})}};import{MintLayout as wl,TOKEN_2022_PROGRAM_ID as gn,TOKEN_PROGRAM_ID as to}from"@solana/spl-token";import ia from"bn.js";var Jn=class extends he{constructor(t){super(t);this._tokenList=[];this._tokenMap=new Map;this._blackTokenMap=new Map;this._tokenPrice=new Map;this._tokenPriceOrg=new Map;this._tokenPriceFetched={prevCount:0,fetched:0};this._mintGroup={official:new Set,jup:new Set,extra:new Set};this._extraTokenList=[]}async load(t){this.checkDisabled();let{forceUpdate:n=!1,type:r="strict"}=t||{},{mintList:o,blacklist:s}=await this.scope.fetchV3TokenList(n),a=await this.scope.fetchJupTokenList(r,n);this._tokenList=[],this._tokenMap=new Map,this._blackTokenMap=new Map,this._mintGroup={official:new Set,jup:new Set,extra:new Set},this._tokenMap.set(Ye.address,Ye),this._mintGroup.official.add(Ye.address),s.forEach(u=>{this._blackTokenMap.set(u.address,q(N({},u),{priority:-1}))}),o.forEach(u=>{var c;this._blackTokenMap.has(u.address)||(this._tokenMap.set(u.address,q(N({},u),{type:"raydium",priority:2,programId:(c=u.programId)!=null?c:u.tags.includes("token-2022")?gn.toBase58():to.toBase58()})),this._mintGroup.official.add(u.address))}),a.forEach(u=>{var c;this._blackTokenMap.has(u.address)||this._tokenMap.has(u.address)||(this._tokenMap.set(u.address,q(N({},u),{type:"jupiter",priority:1,programId:(c=u.programId)!=null?c:u.tags.includes("token-2022")?gn.toBase58():to.toBase58()})),this._mintGroup.jup.add(u.address))}),this._extraTokenList.forEach(u=>{this._blackTokenMap.has(u.address)||this._tokenMap.has(u.address)||(this._tokenMap.set(u.address,q(N({},u),{type:"extra",priority:1,programId:u.programId||u.tags.includes("token-2022")?gn.toBase58():to.toBase58()})),this._mintGroup.extra.add(u.address))}),this._tokenList=Array.from(this._tokenMap).map(u=>u[1])}get tokenList(){return this._tokenList}get tokenMap(){return this._tokenMap}get blackTokenMap(){return this._blackTokenMap}get mintGroup(){return this._mintGroup}async getChainTokenInfo(t){let n=tn({publicKey:t}),r=n.toBase58(),o=n.toString().substring(0,6);if(n.equals(le))return{token:new ce({decimals:Ye.decimals,name:Ye.name,symbol:Ye.symbol,skipMint:!0,mint:""}),tokenInfo:Ye};let a=await this.scope.api.getTokenInfo(n);if(a){this._mintGroup.extra.add(r);let m=q(N({},a),{priority:2});return this._tokenMap.set(r,m),{token:new ce({mint:n,decimals:a.decimals,symbol:a.symbol||o,name:a.name||o,isToken2022:a.programId===gn.toBase58()}),tokenInfo:m}}let u=await this.scope.connection.getAccountInfo(n);u||this.logAndCreateError("On chain token not found, mint:",n.toBase58());let c=wl.decode(u.data),l={chainId:101,address:r,programId:u.owner.toBase58(),logoURI:"",symbol:o,name:o,decimals:c.decimals,tags:[],extensions:{},priority:0};return this._tokenMap.has(r)||(this._mintGroup.extra.add(r),this._tokenMap.set(r,l)),{token:new ce({mint:n,decimals:c.decimals,symbol:o,name:o,isToken2022:u.owner.equals(gn)}),tokenInfo:l}}mintToToken(t){let n=tn({publicKey:t}),r=this._tokenMap.get(n.toBase58());r||this.logAndCreateError("token not found, mint:",n.toBase58(),", use getChainTokenInfo to get info instead");let{decimals:o,name:s,symbol:a}=r,u=n.equals(le);return new ce({decimals:o,name:s,symbol:a,skipMint:u,mint:u?"":t,isToken2022:r.programId===gn.toBase58()})}mintToTokenAmount({mint:t,amount:n,decimalDone:r,token:o}){let s=o||this.mintToToken(t);if(r){let a=on(n),u=ii(new re(a.numerator,a.denominator));return new fe(s,u)}return new fe(s,this.decimalAmount({mint:t,amount:n,decimalDone:r}))}decimalAmount({mint:t,amount:n,token:r}){let o=on(n),s=r||this.mintToToken(t);return ii(new re(o.numerator,o.denominator).mul(new ia(10**s.decimals)))}uiAmount({mint:t,amount:n,token:r}){let o=on(n),s=r||this.mintToToken(t);return s?new re(o.numerator,o.denominator).div(new ia(10**s.decimals)).toSignificant(s.decimals):""}};var Dr=class{constructor(e){this.rawBalances=new Map;let{connection:t,cluster:n,owner:r,api:o,defaultChainTime:s,defaultChainTimeOffset:a,apiCacheTime:u}=e;this._connection=t,this.cluster=n,this._owner=r?new rt(r):void 0,this._signAllTransactions=e.signAllTransactions,this.api=o,this._apiCacheTime=u||5*60*1e3,this.logger=oe("Raydium"),this.farm=new Fn({scope:this,moduleName:"Raydium_Farm"}),this.account=new Nn({scope:this,moduleName:"Raydium_Account",tokenAccounts:e.tokenAccounts,tokenAccountRawInfos:e.tokenAccountRawInfos}),this.liquidity=new zn({scope:this,moduleName:"Raydium_LiquidityV2"}),this.token=new Jn({scope:this,moduleName:"Raydium_tokenV2"}),this.tradeV2=new Qn({scope:this,moduleName:"Raydium_tradeV2"}),this.clmm=new Yn({scope:this,moduleName:"Raydium_clmm"}),this.utils1216=new $e({scope:this,moduleName:"Raydium_utils1216"}),this.marketV2=new yn({scope:this,moduleName:"Raydium_marketV2"}),this.ido=new bn({scope:this,moduleName:"Raydium_ido"}),this.availability={};let c=new Date().getTime();this.apiData={},a&&(this._chainTime={fetched:c,value:{chainTime:s||Date.now()-a,offset:a}})}static async load(e){let t=kl({cluster:"mainnet",owner:null,apiRequestInterval:3e5,apiRequestTimeout:1e4},e),{cluster:n,apiRequestTimeout:r,logCount:o,logRequests:s,urlConfigs:a}=t,u=new Ar({cluster:n,timeout:r,urlConfigs:a,logCount:o,logRequests:s}),c=new Dr(q(N({},t),{api:u}));return await c.fetchAvailabilityStatus(e.disableFeatureCheck),await c.token.load({type:e.jupTokenType,fetchTokenPrice:e.preloadTokenPrice}),c}get owner(){return this._owner}get ownerPubKey(){if(!this._owner)throw new Error(Pr);return this._owner.publicKey}setOwner(e){return this._owner=e?new rt(e):void 0,this}get connection(){if(!this._connection)throw new Error(Wo);return this._connection}setConnection(e){return this._connection=e,this}get signAllTransactions(){return this._signAllTransactions}setSignAllTransactions(e){return this._signAllTransactions=e,this}checkOwner(){if(!this.owner)throw this.logger.error(Pr),new Error(Pr)}isCacheInvalidate(e){return new Date().getTime()-e>this._apiCacheTime}async fetchChainTime(){try{let e=await this.api.getChainTimeOffset();this._chainTime={fetched:Date.now(),value:{chainTime:Date.now()-e.offset*1e3,offset:e.offset*1e3}}}catch{this._chainTime=void 0}}async fetchV3TokenList(e){if(this.apiData.tokenList&&!this.isCacheInvalidate(this.apiData.tokenList.fetched)&&!e)return this.apiData.tokenList.data;let t=await this.api.getTokenList(),n={fetched:Date.now(),data:t};return this.apiData.tokenList=n,n.data}async fetchJupTokenList(e,t){var o;let n=(o=this.apiData.jupTokenList)==null?void 0:o[e];if(n&&!this.isCacheInvalidate(n.fetched)&&!t)return n.data;let r=await this.api.getJupTokenList(e);return this.apiData.jupTokenList=q(N({},this.apiData.jupTokenList),{[e]:{fetched:Date.now(),data:r}}),this.apiData.jupTokenList[e].data}get chainTimeData(){var e;return(e=this._chainTime)==null?void 0:e.value}async chainTimeOffset(){var e;return this._chainTime&&Date.now()-this._chainTime.fetched<=1e3*60*5?this._chainTime.value.offset:(await this.fetchChainTime(),((e=this._chainTime)==null?void 0:e.value.offset)||0)}async currentBlockChainTime(){var e;return this._chainTime&&Date.now()-this._chainTime.fetched<=1e3*60*5?this._chainTime.value.chainTime:(await this.fetchChainTime(),((e=this._chainTime)==null?void 0:e.value.chainTime)||Date.now())}async fetchEpochInfo(){return this._epochInfo&&Date.now()-this._epochInfo.fetched<=1e3*30?this._epochInfo.value:(this._epochInfo={fetched:Date.now(),value:await this.connection.getEpochInfo()},this._epochInfo.value)}async getChainTokenInfo(e){return this.token.getChainTokenInfo(e)}async fetchAvailabilityStatus(e){if(e)return{};try{let t=await this.api.fetchAvailabilityStatus(),n=t.all===!1;return this.availability={all:t.all,swap:n?!1:t.swap,createConcentratedPosition:n?!1:t.createConcentratedPosition,addConcentratedPosition:n?!1:t.addConcentratedPosition,addStandardPosition:n?!1:t.addStandardPosition,removeConcentratedPosition:n?!1:t.removeConcentratedPosition,removeStandardPosition:n?!1:t.removeStandardPosition,addFarm:n?!1:t.addFarm,removeFarm:n?!1:t.removeFarm},t}catch{return{}}}mintToToken(e){return this.token.mintToToken(e)}mintToTokenAmount(e){return this.token.mintToTokenAmount(e)}solToWsolTokenAmount(e){return e.token.mint.equals(le)?this.token.mintToTokenAmount({mint:Z,amount:e.toExact()}):e}solToWsolTransferAmountFee(e){return e.amount.token.mint.equals(le)?{amount:this.token.mintToTokenAmount({mint:Z,amount:e.amount.toExact()}),fee:e.fee?this.token.mintToTokenAmount({mint:Z,amount:e.fee.toExact()}):e.fee,expirationTime:e.expirationTime}:e}decimalAmount(e){return this.token.decimalAmount(e)}uiAmount(e){return this.token.uiAmount(e)}};export{Dr as Raydium};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=raydium.mjs.map