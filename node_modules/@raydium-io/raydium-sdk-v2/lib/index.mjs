var gu=Object.defineProperty,wu=Object.defineProperties;var ku=Object.getOwnPropertyDescriptors;var xr=Object.getOwnPropertySymbols;var $o=Object.prototype.hasOwnProperty,es=Object.prototype.propertyIsEnumerable;var Jo=(r,e,t)=>e in r?gu(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,M=(r,e)=>{for(var t in e||(e={}))$o.call(e,t)&&Jo(r,t,e[t]);if(xr)for(var t of xr(e))es.call(e,t)&&Jo(r,t,e[t]);return r},D=(r,e)=>wu(r,ku(e));var _e=(r,e)=>{var t={};for(var n in r)$o.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&xr)for(var n of xr(r))e.indexOf(n)<0&&es.call(r,n)&&(t[n]=r[n]);return t};import sl from"axios";import{get as yi,set as ts}from"lodash";import ns from"dayjs";import Au from"dayjs/plugin/utc";ns.extend(Au);var hu=(i=>(i[i.Error=0]="Error",i[i.Warning=1]="Warning",i[i.Info=2]="Info",i[i.Debug=3]="Debug",i))(hu||{}),bi=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return ns().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},gi={},rs={};function se(r){let e=yi(gi,r);if(!e){let t=yi(rs,r);e=new bi({name:r,logLevel:t}),ts(gi,r,e)}return e}function zd(r,e){ts(rs,r,e);let t=yi(gi,r);t&&(t.level=e)}import{PublicKey as Mc}from"@solana/web3.js";import _c from"bn.js";import Oc from"big.js";import Ut from"bn.js";import ke from"bn.js";var yn=9e15,Dt=1e9,wi="0123456789abcdef",Sr="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Kr="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",ki={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-yn,maxE:yn,crypto:!1},as,Ct,$=!0,Rr="[DecimalError] ",Wt=Rr+"Invalid argument: ",us=Rr+"Precision limit exceeded",cs=Rr+"crypto unavailable",ls="[object Decimal]",We=Math.floor,Ce=Math.pow,Pu=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Tu=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Iu=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,ms=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,lt=1e7,Y=7,xu=9007199254740991,Bu=Sr.length-1,Ai=Kr.length-1,C={toStringTag:ls};C.absoluteValue=C.abs=function(){var r=new this.constructor(this);return r.s<0&&(r.s=1),X(r)};C.ceil=function(){return X(new this.constructor(this),this.e+1,2)};C.clampedTo=C.clamp=function(r,e){var t,n=this,i=n.constructor;if(r=new i(r),e=new i(e),!r.s||!e.s)return new i(NaN);if(r.gt(e))throw Error(Wt+e);return t=n.cmp(r),t<0?r:n.cmp(e)>0?e:new i(n)};C.comparedTo=C.cmp=function(r){var e,t,n,i,o=this,s=o.d,a=(r=new o.constructor(r)).d,u=o.s,c=r.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==r.e)return o.e>r.e^u<0?1:-1;for(n=s.length,i=a.length,e=0,t=n<i?n:i;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===i?0:n>i^u<0?1:-1};C.cosine=C.cos=function(){var r,e,t=this,n=t.constructor;return t.d?t.d[0]?(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+Y,n.rounding=1,t=Su(n,bs(n,t)),n.precision=r,n.rounding=e,X(Ct==2||Ct==3?t.neg():t,r,e,!0)):new n(1):new n(NaN)};C.cubeRoot=C.cbrt=function(){var r,e,t,n,i,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for($=!1,o=l.s*Ce(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=Ve(l.d),r=l.e,(o=(r-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=Ce(t,1/3),r=We((r+1)/3)-(r%3==(r<0?-1:2)),o==1/0?t="5e"+r:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+r),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(r=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=ge(c.plus(l).times(a),c.plus(u),s+2,1),Ve(a.d).slice(0,s)===(t=Ve(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!i&&t=="4999"){if(!i&&(X(a,r+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(X(n,r+1,1),e=!n.times(n).times(n).eq(l));break}return $=!0,X(n,r,m.rounding,e)};C.decimalPlaces=C.dp=function(){var r,e=this.d,t=NaN;if(e){if(r=e.length-1,t=(r-We(this.e/Y))*Y,r=e[r],r)for(;r%10==0;r/=10)t--;t<0&&(t=0)}return t};C.dividedBy=C.div=function(r){return ge(this,new this.constructor(r))};C.dividedToIntegerBy=C.divToInt=function(r){var e=this,t=e.constructor;return X(ge(e,new t(r),0,1,1),t.precision,t.rounding)};C.equals=C.eq=function(r){return this.cmp(r)===0};C.floor=function(){return X(new this.constructor(this),this.e+1,3)};C.greaterThan=C.gt=function(r){return this.cmp(r)>0};C.greaterThanOrEqualTo=C.gte=function(r){var e=this.cmp(r);return e==1||e===0};C.hyperbolicCosine=C.cosh=function(){var r,e,t,n,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(r=Math.ceil(i/3),e=(1/Or(4,r)).toString()):(r=16,e="2.3283064365386962890625e-10"),o=bn(s,1,o.times(e),new s(1),!0);for(var u,c=r,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return X(o,s.precision=t,s.rounding=n,!0)};C.hyperbolicSine=C.sinh=function(){var r,e,t,n,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(i.e,i.sd())+4,o.rounding=1,n=i.d.length,n<3)i=bn(o,2,i,i,!0);else{r=1.4*Math.sqrt(n),r=r>16?16:r|0,i=i.times(1/Or(5,r)),i=bn(o,2,i,i,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);r--;)s=i.times(i),i=i.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,X(i,e,t,!0)};C.hyperbolicTangent=C.tanh=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+7,n.rounding=1,ge(t.sinh(),t.cosh(),n.precision=r,n.rounding=e)):new n(t.s)};C.inverseCosine=C.acos=function(){var r,e=this,t=e.constructor,n=e.abs().cmp(1),i=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?ct(t,i,o):new t(0):new t(NaN):e.isZero()?ct(t,i+4,o).times(.5):(t.precision=i+6,t.rounding=1,e=e.asin(),r=ct(t,i+4,o).times(.5),t.precision=i,t.rounding=o,r.minus(e))};C.inverseHyperbolicCosine=C.acosh=function(){var r,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(r=n.precision,e=n.rounding,n.precision=r+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,$=!1,t=t.times(t).minus(1).sqrt().plus(t),$=!0,n.precision=r,n.rounding=e,t.ln()):new n(t)};C.inverseHyperbolicSine=C.asinh=function(){var r,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,$=!1,t=t.times(t).plus(1).sqrt().plus(t),$=!0,n.precision=r,n.rounding=e,t.ln())};C.inverseHyperbolicTangent=C.atanh=function(){var r,e,t,n,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(r=o.precision,e=o.rounding,n=i.sd(),Math.max(n,r)<2*-i.e-1?X(new o(i),r,e,!0):(o.precision=t=n-i.e,i=ge(i.plus(1),new o(1).minus(i),t+r,1),o.precision=r+4,o.rounding=1,i=i.ln(),o.precision=r,o.rounding=e,i.times(.5))):new o(NaN)};C.inverseSine=C.asin=function(){var r,e,t,n,i=this,o=i.constructor;return i.isZero()?new o(i):(e=i.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(r=ct(o,t+4,n).times(.5),r.s=i.s,r):new o(NaN):(o.precision=t+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,i.times(2)))};C.inverseTangent=C.atan=function(){var r,e,t,n,i,o,s,a,u,c=this,l=c.constructor,m=l.precision,p=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=Ai)return s=ct(l,m+4,p).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=Ai)return s=ct(l,m+4,p).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/Y+2|0),r=t;r;--r)c=c.div(c.times(c).plus(1).sqrt().plus(1));for($=!1,e=Math.ceil(a/Y),n=1,u=c.times(c),s=new l(c),i=c;r!==-1;)if(i=i.times(u),o=s.minus(i.div(n+=2)),i=i.times(u),s=o.plus(i.div(n+=2)),s.d[e]!==void 0)for(r=e;s.d[r]===o.d[r]&&r--;);return t&&(s=s.times(2<<t-1)),$=!0,X(s,l.precision=m,l.rounding=p,!0)};C.isFinite=function(){return!!this.d};C.isInteger=C.isInt=function(){return!!this.d&&We(this.e/Y)>this.d.length-2};C.isNaN=function(){return!this.s};C.isNegative=C.isNeg=function(){return this.s<0};C.isPositive=C.isPos=function(){return this.s>0};C.isZero=function(){return!!this.d&&this.d[0]===0};C.lessThan=C.lt=function(r){return this.cmp(r)<0};C.lessThanOrEqualTo=C.lte=function(r){return this.cmp(r)<1};C.logarithm=C.log=function(r){var e,t,n,i,o,s,a,u,c=this,l=c.constructor,m=l.precision,p=l.rounding,d=5;if(r==null)r=new l(10),e=!0;else{if(r=new l(r),t=r.d,r.s<0||!t||!t[0]||r.eq(1))return new l(NaN);e=r.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(i=t[0];i%10===0;)i/=10;o=i!==1}if($=!1,a=m+d,s=vt(c,a),n=e?Cr(l,a+10):vt(r,a),u=ge(s,n,a,1),Vn(u.d,i=m,p))do if(a+=10,s=vt(c,a),n=e?Cr(l,a+10):vt(r,a),u=ge(s,n,a,1),!o){+Ve(u.d).slice(i+1,i+15)+1==1e14&&(u=X(u,m+1,0));break}while(Vn(u.d,i+=10,p));return $=!0,X(u,m,p)};C.minus=C.sub=function(r){var e,t,n,i,o,s,a,u,c,l,m,p,d=this,y=d.constructor;if(r=new y(r),!d.d||!r.d)return!d.s||!r.s?r=new y(NaN):d.d?r.s=-r.s:r=new y(r.d||d.s!==r.s?d:NaN),r;if(d.s!=r.s)return r.s=-r.s,d.plus(r);if(c=d.d,p=r.d,a=y.precision,u=y.rounding,!c[0]||!p[0]){if(p[0])r.s=-r.s;else if(c[0])r=new y(d);else return new y(u===3?-0:0);return $?X(r,a,u):r}if(t=We(r.e/Y),l=We(d.e/Y),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=p.length):(e=p,t=l,s=c.length),n=Math.max(Math.ceil(a/Y),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=p.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=p[n]){m=c[n]<p[n];break}o=0}for(m&&(e=c,c=p,p=e,r.s=-r.s),s=c.length,n=p.length-s;n>0;--n)c[s++]=0;for(n=p.length;n>o;){if(c[--n]<p[n]){for(i=n;i&&c[--i]===0;)c[i]=lt-1;--c[i],c[n]+=lt}c[n]-=p[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(r.d=c,r.e=Lr(c,t),$?X(r,a,u):r):new y(u===3?-0:0)};C.modulo=C.mod=function(r){var e,t=this,n=t.constructor;return r=new n(r),!t.d||!r.s||r.d&&!r.d[0]?new n(NaN):!r.d||t.d&&!t.d[0]?X(new n(t),n.precision,n.rounding):($=!1,n.modulo==9?(e=ge(t,r.abs(),0,3,1),e.s*=r.s):e=ge(t,r,0,n.modulo,1),e=e.times(r),$=!0,t.minus(e))};C.naturalExponential=C.exp=function(){return hi(this)};C.naturalLogarithm=C.ln=function(){return vt(this)};C.negated=C.neg=function(){var r=new this.constructor(this);return r.s=-r.s,X(r)};C.plus=C.add=function(r){var e,t,n,i,o,s,a,u,c,l,m=this,p=m.constructor;if(r=new p(r),!m.d||!r.d)return!m.s||!r.s?r=new p(NaN):m.d||(r=new p(r.d||m.s===r.s?m:NaN)),r;if(m.s!=r.s)return r.s=-r.s,m.minus(r);if(c=m.d,l=r.d,a=p.precision,u=p.rounding,!c[0]||!l[0])return l[0]||(r=new p(m)),$?X(r,a,u):r;if(o=We(m.e/Y),n=We(r.e/Y),c=c.slice(),i=o-n,i){for(i<0?(t=c,i=-i,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/Y),s=o>s?o+1:s+1,i>s&&(i=s,t.length=1),t.reverse();i--;)t.push(0);t.reverse()}for(s=c.length,i=l.length,s-i<0&&(i=s,t=l,l=c,c=t),e=0;i;)e=(c[--i]=c[i]+l[i]+e)/lt|0,c[i]%=lt;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return r.d=c,r.e=Lr(c,n),$?X(r,a,u):r};C.precision=C.sd=function(r){var e,t=this;if(r!==void 0&&r!==!!r&&r!==1&&r!==0)throw Error(Wt+r);return t.d?(e=ds(t.d),r&&t.e+1>e&&(e=t.e+1)):e=NaN,e};C.round=function(){var r=this,e=r.constructor;return X(new e(r),r.e+1,e.rounding)};C.sine=C.sin=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+Y,n.rounding=1,t=Cu(n,bs(n,t)),n.precision=r,n.rounding=e,X(Ct>2?t.neg():t,r,e,!0)):new n(NaN)};C.squareRoot=C.sqrt=function(){var r,e,t,n,i,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for($=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=Ve(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=We((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(ge(s,o,t+2,1)).times(.5),Ve(o.d).slice(0,t)===(e=Ve(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!i&&e=="4999"){if(!i&&(X(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,i=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(X(n,u+1,1),r=!n.times(n).eq(s));break}return $=!0,X(n,u,l.rounding,r)};C.tangent=C.tan=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+10,n.rounding=1,t=t.sin(),t.s=1,t=ge(t,new n(1).minus(t.times(t)).sqrt(),r+10,0),n.precision=r,n.rounding=e,X(Ct==2||Ct==4?t.neg():t,r,e,!0)):new n(NaN)};C.times=C.mul=function(r){var e,t,n,i,o,s,a,u,c,l=this,m=l.constructor,p=l.d,d=(r=new m(r)).d;if(r.s*=l.s,!p||!p[0]||!d||!d[0])return new m(!r.s||p&&!p[0]&&!d||d&&!d[0]&&!p?NaN:!p||!d?r.s/0:r.s*0);for(t=We(l.e/Y)+We(r.e/Y),u=p.length,c=d.length,u<c&&(o=p,p=d,d=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,i=u+n;i>n;)a=o[i]+d[n]*p[i-n-1]+e,o[i--]=a%lt|0,e=a/lt|0;o[i]=(o[i]+e)%lt|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),r.d=o,r.e=Lr(o,t),$?X(r,m.precision,m.rounding):r};C.toBinary=function(r,e){return Ti(this,2,r,e)};C.toDecimalPlaces=C.toDP=function(r,e){var t=this,n=t.constructor;return t=new n(t),r===void 0?t:(Je(r,0,Dt),e===void 0?e=n.rounding:Je(e,0,8),X(t,r+t.e+1,e))};C.toExponential=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=wt(n,!0):(Je(r,0,Dt),e===void 0?e=i.rounding:Je(e,0,8),n=X(new i(n),r+1,e),t=wt(n,!0,r+1)),n.isNeg()&&!n.isZero()?"-"+t:t};C.toFixed=function(r,e){var t,n,i=this,o=i.constructor;return r===void 0?t=wt(i):(Je(r,0,Dt),e===void 0?e=o.rounding:Je(e,0,8),n=X(new o(i),r+i.e+1,e),t=wt(n,!1,r+n.e+1)),i.isNeg()&&!i.isZero()?"-"+t:t};C.toFraction=function(r){var e,t,n,i,o,s,a,u,c,l,m,p,d=this,y=d.d,f=d.constructor;if(!y)return new f(d);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=ds(y)-d.e-1,s=o%Y,e.d[0]=Ce(10,s<0?Y+s:s),r==null)r=o>0?e:c;else{if(a=new f(r),!a.isInt()||a.lt(c))throw Error(Wt+a);r=a.gt(e)?o>0?e:c:a}for($=!1,a=new f(Ve(y)),l=f.precision,f.precision=o=y.length*Y*2;m=ge(a,e,0,1,1),i=t.plus(m.times(n)),i.cmp(r)!=1;)t=n,n=i,i=c,c=u.plus(m.times(i)),u=i,i=e,e=a.minus(m.times(i)),a=i;return i=ge(r.minus(t),n,0,1,1),u=u.plus(i.times(c)),t=t.plus(i.times(n)),u.s=c.s=d.s,p=ge(c,n,o,1).minus(d).abs().cmp(ge(u,t,o,1).minus(d).abs())<1?[c,n]:[u,t],f.precision=l,$=!0,p};C.toHexadecimal=C.toHex=function(r,e){return Ti(this,16,r,e)};C.toNearest=function(r,e){var t=this,n=t.constructor;if(t=new n(t),r==null){if(!t.d)return t;r=new n(1),e=n.rounding}else{if(r=new n(r),e===void 0?e=n.rounding:Je(e,0,8),!t.d)return r.s?t:r;if(!r.d)return r.s&&(r.s=t.s),r}return r.d[0]?($=!1,t=ge(t,r,0,e,1).times(r),$=!0,X(t)):(r.s=t.s,t=r),t};C.toNumber=function(){return+this};C.toOctal=function(r,e){return Ti(this,8,r,e)};C.toPower=C.pow=function(r){var e,t,n,i,o,s,a=this,u=a.constructor,c=+(r=new u(r));if(!a.d||!r.d||!a.d[0]||!r.d[0])return new u(Ce(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,r.eq(1))return X(a,n,o);if(e=We(r.e/Y),e>=r.d.length-1&&(t=c<0?-c:c)<=xu)return i=ps(u,a,t,n),r.s<0?new u(1).div(i):X(i,n,o);if(s=a.s,s<0){if(e<r.d.length-1)return new u(NaN);if((r.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=Ce(+a,c),e=t==0||!isFinite(t)?We(c*(Math.log("0."+Ve(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):($=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),i=hi(r.times(vt(a,n+t)),n),i.d&&(i=X(i,n+5,1),Vn(i.d,n,o)&&(e=n+10,i=X(hi(r.times(vt(a,e+t)),e),e+5,1),+Ve(i.d).slice(n+1,n+15)+1==1e14&&(i=X(i,n+1,0)))),i.s=s,$=!0,u.rounding=o,X(i,n,o))};C.toPrecision=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=wt(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(Je(r,1,Dt),e===void 0?e=i.rounding:Je(e,0,8),n=X(new i(n),r,e),t=wt(n,r<=n.e||n.e<=i.toExpNeg,r)),n.isNeg()&&!n.isZero()?"-"+t:t};C.toSignificantDigits=C.toSD=function(r,e){var t=this,n=t.constructor;return r===void 0?(r=n.precision,e=n.rounding):(Je(r,1,Dt),e===void 0?e=n.rounding:Je(e,0,8)),X(new n(t),r,e)};C.toString=function(){var r=this,e=r.constructor,t=wt(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()&&!r.isZero()?"-"+t:t};C.truncated=C.trunc=function(){return X(new this.constructor(this),this.e+1,1)};C.valueOf=C.toJSON=function(){var r=this,e=r.constructor,t=wt(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()?"-"+t:t};function Ve(r){var e,t,n,i=r.length-1,o="",s=r[0];if(i>0){for(o+=s,e=1;e<i;e++)n=r[e]+"",t=Y-n.length,t&&(o+=Ft(t)),o+=n;s=r[e],n=s+"",t=Y-n.length,t&&(o+=Ft(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Je(r,e,t){if(r!==~~r||r<e||r>t)throw Error(Wt+r)}function Vn(r,e,t,n){var i,o,s,a;for(o=r[0];o>=10;o/=10)--e;return--e<0?(e+=Y,i=0):(i=Math.ceil((e+1)/Y),e%=Y),o=Ce(10,Y-e),a=r[i]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(r[i+1]/o/100|0)==Ce(10,e-2)-1||(a==o/2||a==0)&&(r[i+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(r[i+1]/o/1e3|0)==Ce(10,e-3)-1,s}function Br(r,e,t){for(var n,i=[0],o,s=0,a=r.length;s<a;){for(o=i.length;o--;)i[o]*=e;for(i[0]+=wi.indexOf(r.charAt(s++)),n=0;n<i.length;n++)i[n]>t-1&&(i[n+1]===void 0&&(i[n+1]=0),i[n+1]+=i[n]/t|0,i[n]%=t)}return i.reverse()}function Su(r,e){var t,n,i;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),i=(1/Or(4,t)).toString()):(t=16,i="2.3283064365386962890625e-10"),r.precision+=t,e=bn(r,1,e.times(i),new r(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return r.precision-=t,e}var ge=function(){function r(n,i,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*i+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,i,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=i[a]){u=n[a]>i[a]?1:-1;break}return u}function t(n,i,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<i[o]?1:0,n[o]=a*s+n[o]-i[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,o,s,a,u){var c,l,m,p,d,y,f,b,w,h,A,P,T,I,x,O,N,L,E,J,W=n.constructor,te=n.s==i.s?1:-1,Q=n.d,ne=i.d;if(!Q||!Q[0]||!ne||!ne[0])return new W(!n.s||!i.s||(Q?ne&&Q[0]==ne[0]:!ne)?NaN:Q&&Q[0]==0||!ne?te*0:te/0);for(u?(d=1,l=n.e-i.e):(u=lt,d=Y,l=We(n.e/d)-We(i.e/d)),E=ne.length,N=Q.length,w=new W(te),h=w.d=[],m=0;ne[m]==(Q[m]||0);m++);if(ne[m]>(Q[m]||0)&&l--,o==null?(I=o=W.precision,s=W.rounding):a?I=o+(n.e-i.e)+1:I=o,I<0)h.push(1),y=!0;else{if(I=I/d+2|0,m=0,E==1){for(p=0,ne=ne[0],I++;(m<N||p)&&I--;m++)x=p*u+(Q[m]||0),h[m]=x/ne|0,p=x%ne|0;y=p||m<N}else{for(p=u/(ne[0]+1)|0,p>1&&(ne=r(ne,p,u),Q=r(Q,p,u),E=ne.length,N=Q.length),O=E,A=Q.slice(0,E),P=A.length;P<E;)A[P++]=0;J=ne.slice(),J.unshift(0),L=ne[0],ne[1]>=u/2&&++L;do p=0,c=e(ne,A,E,P),c<0?(T=A[0],E!=P&&(T=T*u+(A[1]||0)),p=T/L|0,p>1?(p>=u&&(p=u-1),f=r(ne,p,u),b=f.length,P=A.length,c=e(f,A,b,P),c==1&&(p--,t(f,E<b?J:ne,b,u))):(p==0&&(c=p=1),f=ne.slice()),b=f.length,b<P&&f.unshift(0),t(A,f,P,u),c==-1&&(P=A.length,c=e(ne,A,E,P),c<1&&(p++,t(A,E<P?J:ne,P,u))),P=A.length):c===0&&(p++,A=[0]),h[m++]=p,c&&A[0]?A[P++]=Q[O]||0:(A=[Q[O]],P=1);while((O++<N||A[0]!==void 0)&&I--);y=A[0]!==void 0}h[0]||h.shift()}if(d==1)w.e=l,as=y;else{for(m=1,p=h[0];p>=10;p/=10)m++;w.e=m+l*d-1,X(w,a?o+w.e+1:o,s,y)}return w}}();function X(r,e,t,n){var i,o,s,a,u,c,l,m,p,d=r.constructor;e:if(e!=null){if(m=r.d,!m)return r;for(i=1,a=m[0];a>=10;a/=10)i++;if(o=e-i,o<0)o+=Y,s=e,l=m[p=0],u=l/Ce(10,i-s-1)%10|0;else if(p=Math.ceil((o+1)/Y),a=m.length,p>=a)if(n){for(;a++<=p;)m.push(0);l=u=0,i=1,o%=Y,s=o-Y+1}else break e;else{for(l=a=m[p],i=1;a>=10;a/=10)i++;o%=Y,s=o-Y+i,u=s<0?0:l/Ce(10,i-s-1)%10|0}if(n=n||e<0||m[p+1]!==void 0||(s<0?l:l%Ce(10,i-s-1)),c=t<4?(u||n)&&(t==0||t==(r.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/Ce(10,i-s):0:m[p-1])%10&1||t==(r.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=r.e+1,m[0]=Ce(10,(Y-e%Y)%Y),r.e=-e||0):m[0]=r.e=0,r;if(o==0?(m.length=p,a=1,p--):(m.length=p+1,a=Ce(10,Y-o),m[p]=s>0?(l/Ce(10,i-s)%Ce(10,s)|0)*a:0),c)for(;;)if(p==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(r.e++,m[0]==lt&&(m[0]=1));break}else{if(m[p]+=a,m[p]!=lt)break;m[p--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return $&&(r.e>d.maxE?(r.d=null,r.e=NaN):r.e<d.minE&&(r.e=0,r.d=[0])),r}function wt(r,e,t){if(!r.isFinite())return ys(r);var n,i=r.e,o=Ve(r.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+Ft(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(r.e<0?"e":"e+")+r.e):i<0?(o="0."+Ft(-i-1)+o,t&&(n=t-s)>0&&(o+=Ft(n))):i>=s?(o+=Ft(i+1-s),t&&(n=t-i-1)>0&&(o=o+"."+Ft(n))):((n=i+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(i+1===s&&(o+="."),o+=Ft(n))),o}function Lr(r,e){var t=r[0];for(e*=Y;t>=10;t/=10)e++;return e}function Cr(r,e,t){if(e>Bu)throw $=!0,t&&(r.precision=t),Error(us);return X(new r(Sr),e,1,!0)}function ct(r,e,t){if(e>Ai)throw Error(us);return X(new r(Kr),e,t,!0)}function ds(r){var e=r.length-1,t=e*Y+1;if(e=r[e],e){for(;e%10==0;e/=10)t--;for(e=r[0];e>=10;e/=10)t++}return t}function Ft(r){for(var e="";r--;)e+="0";return e}function ps(r,e,t,n){var i,o=new r(1),s=Math.ceil(n/Y+4);for($=!1;;){if(t%2&&(o=o.times(e),os(o.d,s)&&(i=!0)),t=We(t/2),t===0){t=o.d.length-1,i&&o.d[t]===0&&++o.d[t];break}e=e.times(e),os(e.d,s)}return $=!0,o}function is(r){return r.d[r.d.length-1]&1}function fs(r,e,t){for(var n,i=new r(e[0]),o=0;++o<e.length;)if(n=new r(e[o]),n.s)i[t](n)&&(i=n);else{i=n;break}return i}function hi(r,e){var t,n,i,o,s,a,u,c=0,l=0,m=0,p=r.constructor,d=p.rounding,y=p.precision;if(!r.d||!r.d[0]||r.e>17)return new p(r.d?r.d[0]?r.s<0?0:1/0:1:r.s?r.s<0?0:r:0/0);for(e==null?($=!1,u=y):u=e,a=new p(.03125);r.e>-2;)r=r.times(a),m+=5;for(n=Math.log(Ce(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new p(1),p.precision=u;;){if(o=X(o.times(r),u,1),t=t.times(++l),a=s.plus(ge(o,t,u,1)),Ve(a.d).slice(0,u)===Ve(s.d).slice(0,u)){for(i=m;i--;)s=X(s.times(s),u,1);if(e==null)if(c<3&&Vn(s.d,u-n,d,c))p.precision=u+=10,t=o=a=new p(1),l=0,c++;else return X(s,p.precision=y,d,$=!0);else return p.precision=y,s}s=a}}function vt(r,e){var t,n,i,o,s,a,u,c,l,m,p,d=1,y=10,f=r,b=f.d,w=f.constructor,h=w.rounding,A=w.precision;if(f.s<0||!b||!b[0]||!f.e&&b[0]==1&&b.length==1)return new w(b&&!b[0]?-1/0:f.s!=1?NaN:b?0:f);if(e==null?($=!1,l=A):l=e,w.precision=l+=y,t=Ve(b),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(r),t=Ve(f.d),n=t.charAt(0),d++;o=f.e,n>1?(f=new w("0."+t),o++):f=new w(n+"."+t.slice(1))}else return c=Cr(w,l+2,A).times(o+""),f=vt(new w(n+"."+t.slice(1)),l-y).plus(c),w.precision=A,e==null?X(f,A,h,$=!0):f;for(m=f,u=s=f=ge(f.minus(1),f.plus(1),l,1),p=X(f.times(f),l,1),i=3;;){if(s=X(s.times(p),l,1),c=u.plus(ge(s,new w(i),l,1)),Ve(c.d).slice(0,l)===Ve(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Cr(w,l+2,A).times(o+""))),u=ge(u,new w(d),l,1),e==null)if(Vn(u.d,l-y,h,a))w.precision=l+=y,c=s=f=ge(m.minus(1),m.plus(1),l,1),p=X(f.times(f),l,1),i=a=1;else return X(u,w.precision=A,h,$=!0);else return w.precision=A,u;u=c,i+=2}}function ys(r){return String(r.s*r.s/0)}function Pi(r,e){var t,n,i;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(i=e.length;e.charCodeAt(i-1)===48;--i);if(e=e.slice(n,i),e){if(i-=n,r.e=t=t-n-1,r.d=[],n=(t+1)%Y,t<0&&(n+=Y),n<i){for(n&&r.d.push(+e.slice(0,n)),i-=Y;n<i;)r.d.push(+e.slice(n,n+=Y));e=e.slice(n),n=Y-e.length}else n-=i;for(;n--;)e+="0";r.d.push(+e),$&&(r.e>r.constructor.maxE?(r.d=null,r.e=NaN):r.e<r.constructor.minE&&(r.e=0,r.d=[0]))}else r.e=0,r.d=[0];return r}function Ku(r,e){var t,n,i,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),ms.test(e))return Pi(r,e)}else if(e==="Infinity"||e==="NaN")return+e||(r.s=NaN),r.e=NaN,r.d=null,r;if(Tu.test(e))t=16,e=e.toLowerCase();else if(Pu.test(e))t=2;else if(Iu.test(e))t=8;else throw Error(Wt+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=r.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,i=ps(n,new n(t),o,o*2)),c=Br(e,t,lt),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(r.s*0):(r.e=Lr(c,l),r.d=c,$=!1,s&&(r=ge(r,i,a*4)),u&&(r=r.times(Math.abs(u)<54?Ce(2,u):En.pow(2,u))),$=!0,r)}function Cu(r,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:bn(r,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Or(5,t)),e=bn(r,2,e,e);for(var i,o=new r(5),s=new r(16),a=new r(20);t--;)i=e.times(e),e=e.times(o.plus(i.times(s.times(i).minus(a))));return e}function bn(r,e,t,n,i){var o,s,a,u,c=1,l=r.precision,m=Math.ceil(l/Y);for($=!1,u=t.times(t),a=new r(n);;){if(s=ge(a.times(u),new r(e++*e++),l,1),a=i?n.plus(s):n.minus(s),n=ge(s.times(u),new r(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return $=!0,s.d.length=m+1,s}function Or(r,e){for(var t=r;--e;)t*=r;return t}function bs(r,e){var t,n=e.s<0,i=ct(r,r.precision,1),o=i.times(.5);if(e=e.abs(),e.lte(o))return Ct=n?4:1,e;if(t=e.divToInt(i),t.isZero())Ct=n?3:2;else{if(e=e.minus(t.times(i)),e.lte(o))return Ct=is(t)?n?2:3:n?4:1,e;Ct=is(t)?n?1:4:n?3:2}return e.minus(i).abs()}function Ti(r,e,t,n){var i,o,s,a,u,c,l,m,p,d=r.constructor,y=t!==void 0;if(y?(Je(t,1,Dt),n===void 0?n=d.rounding:Je(n,0,8)):(t=d.precision,n=d.rounding),!r.isFinite())l=ys(r);else{for(l=wt(r),s=l.indexOf("."),y?(i=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):i=e,s>=0&&(l=l.replace(".",""),p=new d(1),p.e=l.length-s,p.d=Br(wt(p),10,i),p.e=p.d.length),m=Br(l,10,i),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=y?"0p+0":"0";else{if(s<0?o--:(r=new d(r),r.d=m,r.e=o,r=ge(r,p,t,n,0,i),m=r.d,o=r.e,c=as),s=m[t],a=i/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(r.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(r.s<0?8:7)),m.length=t,c)for(;++m[--t]>i-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=wi.charAt(m[s]);if(y){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=Br(l,i,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=wi.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return r.s<0?"-"+l:l}function os(r,e){if(r.length>e)return r.length=e,!0}function Ru(r){return new this(r).abs()}function Lu(r){return new this(r).acos()}function Ou(r){return new this(r).acosh()}function Nu(r,e){return new this(r).plus(e)}function Mu(r){return new this(r).asin()}function _u(r){return new this(r).asinh()}function Vu(r){return new this(r).atan()}function Eu(r){return new this(r).atanh()}function Fu(r,e){r=new this(r),e=new this(e);var t,n=this.precision,i=this.rounding,o=n+4;return!r.s||!e.s?t=new this(NaN):!r.d&&!e.d?(t=ct(this,o,1).times(e.s>0?.25:.75),t.s=r.s):!e.d||r.isZero()?(t=e.s<0?ct(this,n,i):new this(0),t.s=r.s):!r.d||e.isZero()?(t=ct(this,o,1).times(.5),t.s=r.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(ge(r,e,o,1)),e=ct(this,o,1),this.precision=n,this.rounding=i,t=r.s<0?t.minus(e):t.plus(e)):t=this.atan(ge(r,e,o,1)),t}function vu(r){return new this(r).cbrt()}function Wu(r){return X(r=new this(r),r.e+1,2)}function Du(r,e,t){return new this(r).clamp(e,t)}function qu(r){if(!r||typeof r!="object")throw Error(Rr+"Object expected");var e,t,n,i=r.defaults===!0,o=["precision",1,Dt,"rounding",0,8,"toExpNeg",-yn,0,"toExpPos",0,yn,"maxE",0,yn,"minE",-yn,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],i&&(this[t]=ki[t]),(n=r[t])!==void 0)if(We(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(Wt+t+": "+n);if(t="crypto",i&&(this[t]=ki[t]),(n=r[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(cs);else this[t]=!1;else throw Error(Wt+t+": "+n);return this}function Uu(r){return new this(r).cos()}function Gu(r){return new this(r).cosh()}function gs(r){var e,t,n;function i(o){var s,a,u,c=this;if(!(c instanceof i))return new i(o);if(c.constructor=i,ss(o)){c.s=o.s,$?!o.d||o.e>i.maxE?(c.e=NaN,c.d=null):o.e<i.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;$?s>i.maxE?(c.e=NaN,c.d=null):s<i.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return Pi(c,o.toString())}else if(u!=="string")throw Error(Wt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),ms.test(o)?Pi(c,o):Ku(c,o)}if(i.prototype=C,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=qu,i.clone=gs,i.isDecimal=ss,i.abs=Ru,i.acos=Lu,i.acosh=Ou,i.add=Nu,i.asin=Mu,i.asinh=_u,i.atan=Vu,i.atanh=Eu,i.atan2=Fu,i.cbrt=vu,i.ceil=Wu,i.clamp=Du,i.cos=Uu,i.cosh=Gu,i.div=Xu,i.exp=zu,i.floor=Yu,i.hypot=Qu,i.ln=ju,i.log=Hu,i.log10=Ju,i.log2=Zu,i.max=$u,i.min=ec,i.mod=tc,i.mul=nc,i.pow=rc,i.random=ic,i.round=oc,i.sign=sc,i.sin=ac,i.sinh=uc,i.sqrt=cc,i.sub=lc,i.sum=mc,i.tan=dc,i.tanh=pc,i.trunc=fc,r===void 0&&(r={}),r&&r.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)r.hasOwnProperty(t=n[e++])||(r[t]=this[t]);return i.config(r),i}function Xu(r,e){return new this(r).div(e)}function zu(r){return new this(r).exp()}function Yu(r){return X(r=new this(r),r.e+1,3)}function Qu(){var r,e,t=new this(0);for($=!1,r=0;r<arguments.length;)if(e=new this(arguments[r++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return $=!0,new this(1/0);t=e}return $=!0,t.sqrt()}function ss(r){return r instanceof En||r&&r.toStringTag===ls||!1}function ju(r){return new this(r).ln()}function Hu(r,e){return new this(r).log(e)}function Zu(r){return new this(r).log(2)}function Ju(r){return new this(r).log(10)}function $u(){return fs(this,arguments,"lt")}function ec(){return fs(this,arguments,"gt")}function tc(r,e){return new this(r).mod(e)}function nc(r,e){return new this(r).mul(e)}function rc(r,e){return new this(r).pow(e)}function ic(r){var e,t,n,i,o=0,s=new this(1),a=[];if(r===void 0?r=this.precision:Je(r,1,Dt),n=Math.ceil(r/Y),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)i=e[o],i>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)i=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(i%1e7),o+=4);o=n/4}else throw Error(cs);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],r%=Y,n&&r&&(i=Ce(10,Y-r),a[o]=(n/i|0)*i);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=Y)a.shift();for(n=1,i=a[0];i>=10;i/=10)n++;n<Y&&(t-=Y-n)}return s.e=t,s.d=a,s}function oc(r){return X(r=new this(r),r.e+1,this.rounding)}function sc(r){return r=new this(r),r.d?r.d[0]?r.s:0*r.s:r.s||NaN}function ac(r){return new this(r).sin()}function uc(r){return new this(r).sinh()}function cc(r){return new this(r).sqrt()}function lc(r,e){return new this(r).sub(e)}function mc(){var r=0,e=arguments,t=new this(e[r]);for($=!1;t.s&&++r<e.length;)t=t.plus(e[r]);return $=!0,X(t,this.precision,this.rounding)}function dc(r){return new this(r).tan()}function pc(r){return new this(r).tanh()}function fc(r){return X(r=new this(r),r.e+1,1)}C[Symbol.for("nodejs.util.inspect.custom")]=C.toString;C[Symbol.toStringTag]="Decimal";var En=C.constructor=gs(ki);Sr=new En(Sr);Kr=new En(Kr);var F=En;import{PublicKey as Si}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as yc}from"@solana/spl-token";import{PublicKey as Pe,SystemProgram as bc,SYSVAR_RENT_PUBKEY as gc}from"@solana/web3.js";function k({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var Ii=[k({pubkey:yc,isWritable:!1}),k({pubkey:bc.programId,isWritable:!1}),k({pubkey:gc,isWritable:!1})];function gn({publicKey:r,transformSol:e}){let t=xi(r.toString());if(t instanceof Pe)return e&&t.equals(de)?ee:t;if(e&&t.toString()===de.toBase58())return ee;if(typeof t=="string"){if(t===Pe.default.toBase58())return Pe.default;try{return new Pe(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function xi(r){try{return new Pe(r)}catch{return r}}var wn=new Pe("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),it=new Pe("SysvarRent111111111111111111111111111111111"),Bi=new Pe("SysvarC1ock11111111111111111111111111111111"),kn=new Pe("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Nr=new Pe("Sysvar1nstructions1111111111111111111111111"),Jd=new Pe("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),$d=new Pe("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ep=new Pe("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),tp=new Pe("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),np=new Pe("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),rp=new Pe("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ip=new Pe("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),op=new Pe("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),sp=new Pe("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),ap=new Pe("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),up=new Pe("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ee=new Pe("So11111111111111111111111111111111111111112"),de=Pe.default;function qt(r){return gn({publicKey:r,transformSol:!0})}import{PublicKey as wc}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ws}from"@solana/spl-token";var Qe={chainId:101,address:wc.default.toBase58(),programId:ws.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Re={chainId:101,address:"So11111111111111111111111111111111111111112",programId:ws.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Ki=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===de.toBase58()||e instanceof Si&&de.equals(e)){this.decimals=Re.decimals,this.symbol=Re.symbol,this.name=Re.name,this.mint=new Si(Re.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?Si.default:gn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},oe=Ki;oe.WSOL=new Ki(D(M({},Re),{mint:Re.address}));import _r from"big.js";import hc from"bn.js";import Pc from"decimal.js-light";import kc from"toformat";var Ac=kc,Fn=Ac;var Mr=se("module/fraction"),Ci=Fn(_r),vn=Fn(Pc),Tc={[0]:vn.ROUND_DOWN,[1]:vn.ROUND_HALF_UP,[2]:vn.ROUND_UP},Ic={[0]:_r.roundDown,[1]:_r.roundHalfUp,[2]:_r.roundUp},j=class{constructor(e,t=new hc(1)){this.numerator=q(e),this.denominator=q(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new j(this.denominator,this.numerator)}add(e){let t=e instanceof j?e:new j(q(e));return this.denominator.eq(t.denominator)?new j(this.numerator.add(t.numerator),this.denominator):new j(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof j?e:new j(q(e));return this.denominator.eq(t.denominator)?new j(this.numerator.sub(t.numerator),this.denominator):new j(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof j?e:new j(q(e));return new j(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof j?e:new j(q(e));return new j(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Mr.logWithError(`${e} is not an integer.`),e<=0&&Mr.logWithError(`${e} is not positive.`),vn.set({precision:e+1,rounding:Tc[n]});let i=new vn(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Mr.logWithError(`${e} is not an integer.`),e<0&&Mr.logWithError(`${e} is negative.`),Ci.DP=e,Ci.RM=Ic[n]||1,new Ci(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var xc=se("Raydium_price"),De=class extends j{constructor(t){let{baseToken:n,quoteToken:i,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=i,this.scalar=new j(Li(n.decimals),Li(i.decimals))}get raw(){return new j(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new De({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&xc.logWithError("mul token not equals");let n=super.mul(t);return new De({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,i){return this.adjusted.toSignificant(t,n,i)}toFixed(t=this.quoteToken.decimals,n,i){return this.adjusted.toFixed(t,n,i)}};var Oi=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Wn=Oi;Wn.SOL=new Oi(Qe);function Ep(r,e){return r instanceof oe&&e instanceof oe?r.equals(e):r instanceof oe||e instanceof oe?!1:r===e}import Bc from"bn.js";var ks=new j(new Bc(100)),qe=class extends j{toSignificant(e=5,t,n){return this.mul(ks).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(ks).toFixed(e,t,n)}};function Ie(r){if(r instanceof qe)return new j(r.numerator,r.denominator);if(r instanceof De)return r.adjusted;if(r instanceof pe)try{return Ie(r.toExact())}catch{return new j(Se)}if(r instanceof j)return r;let e=String(r),t=mt(e);return new j(t.numerator,t.denominator)}function Xp(r){var n;if(r instanceof qe)return{fr:new j(r.numerator,r.denominator)};if(r instanceof De)return{fr:r.adjusted};if(r instanceof pe)return{fr:Ie(r.toExact()),decimals:r.token.decimals};if(r instanceof j)return{fr:r};let e=String(r),t=mt(e);return{fr:new j(t.numerator,t.denominator),decimals:(n=t.dec)==null?void 0:n.length}}function zp(r,e){if(r==null||e==null)return!1;let t=Ie(r),n=Ie(e);return t.sub(n).numerator,t.sub(n).numerator.lt(Se)}function Sc(r,e){if(r==null||e==null)return!1;let t=Ie(r),n=Ie(e);return t.sub(n).numerator.gt(Se)}function Yp(r,e){if(r==null||e==null)return!1;let t=Ie(r),n=Ie(e);return t.sub(n).numerator.lte(Se)}function Qp(r,e){if(r==null||e==null)return!1;let t=Ie(r),n=Ie(e);return t.sub(n).numerator.gte(Se)}function Kc(r,e){if(r==null||e==null)return!1;let t=Ie(r),n=Ie(e);return t.sub(n).numerator.eq(Se)}function jp(r,e){if(r==null||e==null)return;let t=Ie(r),n=Ie(e);try{return t.div(n)}catch{return t}}function Hp(r,e){if(r==null||e==null)return;let t=Ie(r),n=Ie(e);return t.sub(n)}function Zp(r){return r==null?!1:!Kc(r,0)}function Jp(r,e){return Sc(e,r)?e:r}function Ni(r,e){if(r==null||e==null)return;let t=Ie(r),n=Ie(e);return t.mul(n)}function $p(r,e){if(r==null||e==null)return;let t=Ie(r),n=Ie(e);return t.add(n)}var Ri=(n=>(n[n.ROUND_DOWN=0]="ROUND_DOWN",n[n.ROUND_HALF_UP=1]="ROUND_HALF_UP",n[n.ROUND_UP=2]="ROUND_UP",n))(Ri||{}),Se=new ke(0),Vr=new ke(1),pf=new ke(2),ff=new ke(3),yf=new ke(5),en=new ke(10),bf=new ke(100),gf=new ke(1e3),wf=new ke(1e4),As=9007199254740991;function q(r){let e=se("Raydium_parseBigNumberish");if(r instanceof ke)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new ke(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=As||r<=-As)&&e.logWithError(`BigNumberish number overflow: ${r}`),new ke(String(r))):typeof r=="bigint"?new ke(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new ke(0))}function Li(r){return en.pow(q(r))}function mt(r){var a;if(r===void 0)return{denominator:"1",numerator:"0"};if(r instanceof ke)return{numerator:r.toString(),denominator:"1"};if(r instanceof j)return{denominator:r.denominator.toString(),numerator:r.numerator.toString()};let e=String(r),[,t="",n="",i=""]=(a=e.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?a:[],o="1"+"0".repeat(i.length),s=t+(n==="0"?"":n)+i||"0";return{denominator:o,numerator:s,sign:t,int:n,dec:i}}function Er(r,e){let t=r.divmod(e);return t.mod.isZero()?t.div:t.div.isNeg()?t.div.isubn(1):t.div.iaddn(1)}function Cc(r){var n;let[,e="",t=""]=(n=r.toFixed(2).match(/(-?)(\d*)\.?(\d*)/))!=null?n:[];return`${e}${t}`}function Fr(r,e=0){return r instanceof ke?r:new ke(Cc(Ts(r).mul(en.pow(new ke(String(e))))))}function Ts(r){if(r instanceof qe)return new j(r.numerator,r.denominator);if(r instanceof De)return r.adjusted;if(r instanceof pe)try{return Ts(r.toExact())}catch{return new j(Se)}if(r instanceof j)return r;let e=String(r),t=mt(e);return new j(t.numerator,t.denominator)}function kf(r,e){let{numerator:t,denominator:n}=mt(r);return new qe(new ke(t),new ke(n).mul(e!=null&&e.alreadyDecimaled?new ke(100):new ke(1)))}function Af(r){let{token:e,numberPrice:t,decimalDone:n}=r,i=new oe({mint:"",decimals:6,symbol:"usd",name:"usd",skipMint:!0}),{numerator:o,denominator:s}=mt(t),a=n?new ke(o).mul(en.pow(new ke(e.decimals))):o,u=new ke(s).mul(en.pow(new ke(i.decimals)));return new De({baseToken:i,denominator:u.toString(),quoteToken:new oe(D(M({},e),{skipMint:!0,mint:""})),numerator:a.toString()})}function hs(r){let e=new Wn({decimals:6,symbol:"usd",name:"usd"}),t=Fr(Ni(r,10**e.decimals));return new tn(e,t)}function hf(r,e){return hs(!e||!r?0:Ni(r,e))}function Rc(r){if(r==null)return;let{numerator:e,denominator:t}=mt(r.toString());return new j(e,t)}function Lc(r){return r instanceof F}function Ps(r){return Lc(r)?Rc(r):Array.isArray(r)?r.map(e=>Ps(e)):Mi(r)?Object.fromEntries(Object.entries(r).map(([e,t])=>[e,Ps(t)])):r}var Nc=se("Raydium_amount"),vr=Fn(Oc);function Is(r,e){let t="0",n="0";if(r.includes(".")){let i=r.split(".");i.length===2?([t,n]=i,n=n.padEnd(e,"0")):Nc.logWithError(`invalid number string, num: ${r}`)}else t=r;return[t,n.slice(0,e)||n]}var pe=class extends j{constructor(t,n,i=!0,o){let s=new Ut(0),a=en.pow(new Ut(t.decimals));if(i)s=q(n);else{let u=new Ut(0),c=new Ut(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=Is(n.toString(),t.decimals);u=q(l),c=q(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=se(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new pe(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new pe(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,i=0){return super.toSignificant(t,n,i)}toFixed(t=this.token.decimals,n,i=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,i)}toExact(t={groupSeparator:""}){return vr.DP=this.token.decimals,new vr(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}},tn=class extends j{constructor(t,n,i=!0,o){let s=new Ut(0),a=en.pow(new Ut(t.decimals));if(i)s=q(n);else{let u=new Ut(0),c=new Ut(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=Is(n.toString(),t.decimals);u=q(l),c=q(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=se(o||"TokenAmount"),this.currency=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.currency.equals(t.currency)||this.logger.logWithError("gt currency not equals"),this.raw.gt(t.raw)}lt(t){return this.currency.equals(t.currency)||this.logger.logWithError("lt currency not equals"),this.raw.lt(t.raw)}add(t){return this.currency.equals(t.currency)||this.logger.logWithError("add currency not equals"),new tn(this.currency,this.raw.add(t.raw))}sub(t){return this.currency.equals(t.currency)||this.logger.logWithError("sub currency not equals"),new tn(this.currency,this.raw.sub(t.raw))}toSignificant(t=this.currency.decimals,n,i=0){return super.toSignificant(t,n,i)}toFixed(t=this.currency.decimals,n,i=0){return t>this.currency.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,i)}toExact(t={groupSeparator:""}){return vr.DP=this.currency.decimals,new vr(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};async function xs(r){new Promise(e=>setTimeout(e,r))}function Xf(){return new Date().getTime()}function Mi(r){return typeof r=="object"&&r!==null&&![oe,pe,Mc,j,_c,De,qe].some(e=>typeof e=="object"&&r instanceof e)}function fe(r){return typeof r=="string"?xi(r):Array.isArray(r)?r.map(e=>fe(e)):Mi(r)?Object.fromEntries(Object.entries(r).map(([e,t])=>[e,fe(t)])):r}import{PublicKey as Gn,sendAndConfirmTransaction as Fi,Transaction as Xn,TransactionMessage as zn,VersionedTransaction as Yn}from"@solana/web3.js";import Gc from"axios";var Dn=(t=>(t[t.V0=0]="V0",t[t.LEGACY=1]="LEGACY",t))(Dn||{}),_={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw"};import{PublicKey as Ss,ComputeBudgetProgram as Bs,Transaction as Dr,TransactionMessage as Vc,Keypair as Ks,VersionedTransaction as Cs}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ec}from"@solana/spl-token";var Rt=se("Raydium_txUtil"),Rs=1644;function An(r){let e=[],t=[];return r.microLamports&&(e.push(Bs.setComputeUnitPrice({microLamports:r.microLamports})),t.push(_.SetComputeUnitPrice)),r.units&&(e.push(Bs.setComputeUnitLimit({units:r.units})),t.push(_.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function hn(r){var e,t;try{return((t=await((e=r.getLatestBlockhash)==null?void 0:e.call(r)))==null?void 0:t.blockhash)||(await r.getRecentBlockhash()).blockhash}catch{return(await r.getRecentBlockhash()).blockhash}}function Lt(r,e){r.length<1&&Rt.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&Rt.logWithError(`no signers provided:, ${e.toString()}`);let t=new Dr;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Rs}catch{return!1}}async function Ls(r,e,t,n=!0){let i=new Ss("RaydiumSimuLateTransaction11111111111111111"),o=[],s=new Dr;s.feePayer=i;for(let c of e)Lt([...s.instructions,c],[i])||(o.push(s),s=new Dr,s.feePayer=i),s.add(c);s.instructions.length>0&&o.push(s);let a=[];try{if(a=await Fc(r,o,n),a.find(c=>c.err!==null))throw Error("rpc simulateTransaction error")}catch(c){c instanceof Error&&Rt.logWithError("failed to simulate for instructions","RPC_ERROR",{message:c.message})}let u=[];for(let c of a)if(Rt.debug("simulate result:",c),c.logs){let l=c.logs.filter(m=>m&&m.includes(t));Rt.debug("filteredLog:",u),l.length||Rt.logWithError("simulate log not match keyword","keyword",t),u.push(...l)}return u}function Os(r,e){let t=r.match(/{["\w:,]+}/g);return!t||t.length!==1?Rt.logWithError(`simulate log fail to match json, keyword: ${e}`):t[0]}function Ot(r,e){let n=new RegExp(`"${e}":(\\d+)`,"g").exec(r);return!n||n.length!==2?Rt.logWithError(`simulate log fail to match key", key: ${e}`):n[1]}function le(r,e){let[t,n]=Ss.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}async function Fc(r,e,t){let n=[];if(t){let i=await r.getLatestBlockhash(),o=[];for(let c of e){c.recentBlockhash=i.blockhash,c.lastValidBlockHeight=i.lastValidBlockHeight;let m=c._compile().serialize(),d=c._serialize(m).toString("base64");o.push(d)}let s=o.map(c=>{let l=r._buildArgs([c],void 0,"base64");return{methodName:"simulateTransaction",args:l}}),a=[],u=20;for(let c=0;c<Math.ceil(s.length/u);c++)a.push(s.slice(c*u,(c+1)*u));n=await(await Promise.all(a.map(async c=>(await r._rpcBatchRequest(c)).map(l=>l.result.value)))).flat()}else try{n=await Promise.all(e.map(async i=>await(await r.simulateTransaction(i)).value))}catch(i){i instanceof Error&&Rt.logWithError("failed to get info for multiple accounts","RPC_ERROR",{message:i.message})}return n}function qn({instructions:r,payer:e,signers:t}){return Lt(r,[e,...t])}function Un({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Ks.generate().publicKey.toString()}){let o=new Vc({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Cs(o).serialize()).toString("base64").length<Rs}catch{return!1}}var Wr={time:0,data:void 0};async function ny(r){if(!Wr.data||(Date.now()-Wr.time)/1e3>30){let e=await r.getEpochInfo();return Wr={time:Date.now(),data:e},e}else return Wr.data}var vc=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r);function nn(r){let e=[];return r.forEach(t=>{t instanceof Dr&&(t.recentBlockhash||(t.recentBlockhash=Ec.toBase58()),t.feePayer||(t.feePayer=Ks.generate().publicKey));let n=t.serialize({requireAllSignatures:!1,verifySignatures:!1});t instanceof Cs&&(n=vc(n));let i=n.toString("base64");e.push(i)}),console.log("simulate tx string:",e),e}import{PublicKey as Ns,AddressLookupTableAccount as qr}from"@solana/web3.js";import{PublicKey as Wc}from"@solana/web3.js";import{getTransferFeeConfig as Dc,unpackMint as qc}from"@solana/spl-token";var _i=se("Raydium_accountInfo_util");async function kt(r,e,t){let{batchRequest:n,commitment:i="confirmed"}=M({batchRequest:!1},t),o=Vi(e,100),s=new Array(o.length).fill([]);if(n){let a=o.map(l=>{let m=r._buildArgs([l.map(p=>p.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:m}}),u=Vi(a,10);s=(await(await Promise.all(u.map(async l=>await r._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&_i.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(m=>{if(m){let{data:p,executable:d,lamports:y,owner:f,rentEpoch:b}=m;return p.length!==2&&p[1]!=="base64"&&_i.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:d,lamports:y,owner:new Wc(f),rentEpoch:b}}return null})))}else try{s=await Promise.all(o.map(a=>r.getMultipleAccountsInfo(a,i)))}catch(a){a instanceof Error&&_i.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function Pn(r,e,t){let n=await kt(r,e.map(i=>i.pubkey),t);return e.map((i,o)=>D(M({},i),{accountInfo:n[o]}))}var Uc=(n=>(n[n.Uninitialized=0]="Uninitialized",n[n.Mint=1]="Mint",n[n.Account=2]="Account",n))(Uc||{}),my=1;async function dy({connection:r,mints:e}){var i,o;if(e.length===0)return{};let t=await Pn(r,e.map(s=>({pubkey:s}))),n={};for(let s of t){let a=qc(s.pubkey,s.accountInfo,(i=s.accountInfo)==null?void 0:i.owner);n[s.pubkey.toString()]=D(M({},a),{feeConfig:(o=Dc(a))!=null?o:void 0})}return n}async function Ei({connection:r,address:e}){let t=await kt(r,[...new Set(e.map(i=>i.toString()))].map(i=>new Ns(i))),n={};for(let i=0;i<e.length;i++){let o=t[i],s=e[i];if(!o)continue;let a=new qr({key:s,state:qr.deserialize(o.data)});n[s.toString()]=a,Ur[s.toString()]=a}return n}var Ur={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new qr({key:new Ns("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:qr.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var Gr=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Gc.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=An(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Gn.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(M({},t||{})):this.build(t)}build(e){let t=new Xn;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async()=>{var i;let n=await hn(this.connection);if(t.recentBlockhash=n,this.signers.length&&t.sign(...this.signers),nn([t]),(i=this.owner)!=null&&i.isKeyPair)return{txId:await Fi(this.connection,t,this.signers),signedTx:t};if(this.signAllTransactions){let o=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(o[0].serialize(),{skipPreflight:!0}),signedTx:o[0]}}throw new Error("please connect wallet first")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:i}=this.build(n),o=t.filter(c=>c.transaction.instructions.length>0),s=[i,...o.map(c=>c.transaction)],a=[this.signers,...o.map(c=>c.signers)],u=[...this.instructionTypes,...o.map(c=>c.instructionTypes).flat()];return{builder:this,transactions:s,signers:a,instructionTypes:u,execute:async c=>{var d;let{sequentially:l,onTxUpdate:m}=c||{},p=await hn(this.connection);if((d=this.owner)!=null&&d.isKeyPair)return{txIds:await await Promise.all(s.map(async(y,f)=>(y.recentBlockhash=p,await Fi(this.connection,y,a[f])))),signedTxs:s};if(this.signAllTransactions){let y=s.map((b,w)=>(b.recentBlockhash=p,a[w].length&&b.sign(...a[w]),b));nn(y);let f=await this.signAllTransactions(y);if(l){let b=0,w=[],h=async()=>{if(!f[b])return;let A=await this.connection.sendRawTransaction(f[b].serialize(),{skipPreflight:!0});w.push({txId:A,status:"sent",signedTx:f[b]}),m==null||m([...w]),b++,this.connection.onSignature(A,P=>{let T=w.findIndex(I=>I.txId===A);T>-1&&(w[T].status=P.err?"error":"success"),m==null||m([...w]),h()},"processed"),this.connection.getSignatureStatus(A)};return await h(),{txIds:w.map(A=>A.txId),signedTxs:f}}else{let b=[];for(let w=0;w<f.length;w+=1){let h=await this.connection.sendRawTransaction(f[w].serialize(),{skipPreflight:!0});b.push(h)}return{txIds:b,signedTxs:f}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){let p=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:i}=p,o=_e(p,["lookupTableCache","lookupTableAddress","forerunCreate"]),s=M(M({},Ur),t),a=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let d of a)s[d]===void 0&&u.push(new Gn(d));let c=await Ei({connection:this.connection,address:u});for(let[d,y]of Object.entries(c))s[d]=y;let l=new zn({payerKey:this.feePayer,recentBlockhash:i?Gn.default.toBase58():await hn(this.connection),instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s)),m=new Yn(l);return m.sign(this.signers),{builder:this,transaction:m,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async()=>{var d;if(nn([m]),(d=this.owner)!=null&&d.isKeyPair)return m.sign([this.owner.signer]),{txId:await this.connection.sendTransaction(m,{skipPreflight:!0}),signedTx:m};if(this.signAllTransactions){let y=await this.signAllTransactions([m]);return{txId:await this.connection.sendTransaction(y[0],{skipPreflight:!0}),signedTx:y[0]}}throw new Error("please connect wallet first")},extInfo:o||{}}}async buildV0MultiTx(e){let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:i}=await this.buildV0(n),o=t.filter(c=>c.builder.instructions.length>0),s=[i,...o.map(c=>c.transaction)],a=[this.signers,...o.map(c=>c.signers)],u=[...this.instructionTypes,...o.map(c=>c.instructionTypes).flat()];return s.forEach(async(c,l)=>{c.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:u,buildProps:n,execute:async c=>{var p;nn(s);let{sequentially:l,onTxUpdate:m}=c||{};if((p=this.owner)!=null&&p.isKeyPair)return s.forEach(d=>d.sign([this.owner.signer])),{txIds:await Promise.all(s.map(async d=>await this.connection.sendTransaction(d))),signedTxs:s};if(this.signAllTransactions){let d=await this.signAllTransactions(s);if(l){let y=0,f=[],b=async()=>{if(!d[y])return;let w=await this.connection.sendTransaction(d[y],{skipPreflight:!0});f.push({txId:w,status:"sent",signedTx:d[y]}),m==null||m([...f]),y++,this.connection.onSignature(w,h=>{let A=f.findIndex(P=>P.txId===w);A>-1&&(f[A].status=h.err?"error":"success"),m==null||m([...f]),b()},"processed"),this.connection.getSignatureStatus(w)};return b(),{txIds:[],signedTxs:d}}else{let y=[];for(let f=0;f<d.length;f+=1){let b=await this.connection.sendTransaction(d[f],{skipPreflight:!0});y.push(b)}return{txIds:y,signedTxs:d}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async sizeCheckBuild(e){let c=e||{},{autoComputeBudget:t=!1}=c,n=_e(c,["autoComputeBudget"]),i={instructions:[],instructionTypes:[]};if(t){let l=t?await this.getComputeBudgetConfig():void 0;i=t&&l?An(l):{instructions:[],instructionTypes:[]}}let o=this.signers.reduce((l,m)=>D(M({},l),{[m.publicKey.toBase58()]:m}),{}),s=[],a=[],u=[];if(this.allInstructions.forEach(l=>{let m=[...u,l],p=t?[...i.instructions,...m]:m,y=[...new Set(m.map(f=>f.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat()).values()].map(f=>new Gn(f));if(u.length<12&&qn({instructions:p,payer:this.feePayer,signers:y})||qn({instructions:m,payer:this.feePayer,signers:y}))u.push(l);else{if(u.length===0)throw Error("item ins too big");qn({instructions:t?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:y})?s.push(new Xn().add(...i.instructions,...u)):s.push(new Xn().add(...u)),a.push(Array.from(new Set(u.map(f=>f.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat())).map(f=>o[f]).filter(f=>f!==void 0)),u=[l]}}),u.length>0){let m=[...new Set(u.map(p=>p.keys.filter(d=>d.isSigner).map(d=>d.pubkey.toString())).flat()).values()].map(p=>o[p]).filter(p=>p!==void 0);qn({instructions:t?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:m.map(p=>p.publicKey)})?s.push(new Xn().add(...i.instructions,...u)):s.push(new Xn().add(...u)),a.push(m)}return s.forEach(l=>l.feePayer=this.feePayer),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async l=>{var y;let{sequentially:m,onTxUpdate:p}=l||{},d=await hn(this.connection);if(s.forEach(async(f,b)=>{f.recentBlockhash=d,a[b].length&&f.sign(...a[b])}),nn(s),(y=this.owner)!=null&&y.isKeyPair)return{txIds:await Promise.all(s.map(async(f,b)=>await Fi(this.connection,f,a[b]))),signedTxs:s};if(this.signAllTransactions){let f=await this.signAllTransactions(s);if(m){let b=0,w=[],h=async()=>{if(!f[b])return;let A=await this.connection.sendRawTransaction(f[b].serialize(),{skipPreflight:!0});w.push({txId:A,status:"sent",signedTx:f[b]}),p==null||p([...w]),b++,this.connection.onSignature(A,P=>{let T=w.findIndex(I=>I.txId===A);T>-1&&(w[T].status=P.err?"error":"success"),p==null||p([...w]),h()},"processed"),this.connection.getSignatureStatus(A)};return await h(),{txIds:w.map(A=>A.txId),signedTxs:f}}else{let b=[];for(let w=0;w<f.length;w+=1){let h=await this.connection.sendRawTransaction(f[w].serialize(),{skipPreflight:!0});b.push(h)}return{txIds:b,signedTxs:f}}}throw new Error("please connect wallet first")},extInfo:n||{}}}async sizeCheckBuildV0(e){let b=e||{},{autoComputeBudget:t=!1,lookupTableCache:n={},lookupTableAddress:i=[]}=b,o=_e(b,["autoComputeBudget","lookupTableCache","lookupTableAddress"]),s=M(M({},Ur),n),a=Array.from(new Set([...this.lookupTableAddress,...i])),u=[];for(let w of a)s[w]===void 0&&u.push(new Gn(w));let c=await Ei({connection:this.connection,address:u});for(let[w,h]of Object.entries(c))s[w]=h;let l={instructions:[],instructionTypes:[]};if(t){let w=t?await this.getComputeBudgetConfig():void 0;l=t&&w?An(w):{instructions:[],instructionTypes:[]}}let m=await hn(this.connection),p=this.signers.reduce((w,h)=>D(M({},w),{[h.publicKey.toBase58()]:h}),{}),d=[],y=[],f=[];if(this.allInstructions.forEach(w=>{let h=[...f,w],A=t?[...l.instructions,...h]:h;if(f.length<12&&Un({instructions:A,payer:this.feePayer,lookupTableAddressAccount:s})||Un({instructions:h,payer:this.feePayer,lookupTableAddressAccount:s}))f.push(w);else{if(f.length===0)throw Error("item ins too big");let P={};for(let T of[...new Set(a)])s[T]!==void 0&&(P[T]=s[T]);if(t&&Un({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let T=new zn({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));d.push(new Yn(T))}else{let T=new zn({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));d.push(new Yn(T))}y.push(Array.from(new Set(f.map(T=>T.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat())).map(T=>p[T]).filter(T=>T!==void 0)),f=[w]}}),f.length>0){let h=[...new Set(f.map(A=>A.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(A=>p[A]).filter(A=>A!==void 0);if(t&&Un({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let A=new zn({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));d.push(new Yn(A))}else{let A=new zn({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));d.push(new Yn(A))}y.push(h)}return{builder:this,transactions:d,buildProps:e,signers:y,instructionTypes:this.instructionTypes,execute:async w=>{var P;let{sequentially:h,onTxUpdate:A}=w||{};if(d.map(async(T,I)=>{y[I].length&&T.sign(y[I])}),nn(d),(P=this.owner)!=null&&P.isKeyPair)return{txIds:await Promise.all(d.map(async T=>await this.connection.sendTransaction(T,{skipPreflight:!0}))),signedTxs:d};if(this.signAllTransactions){let T=await this.signAllTransactions(d);if(h){let I=0,x=[],O=async()=>{if(!T[I])return;let N=await this.connection.sendTransaction(T[I],{skipPreflight:!0});x.push({txId:N,status:"sent",signedTx:T[I]}),A==null||A([...x]),I++,this.connection.onSignature(N,L=>{let E=x.findIndex(J=>J.txId===N);E>-1&&(x[E].status=L.err?"error":"success"),A==null||A([...x]),O()},"processed"),this.connection.getSignatureStatus(N)};return O(),{txIds:[],signedTxs:T}}else{let I=[];for(let x=0;x<T.length;x+=1){let O=await this.connection.sendTransaction(T[x],{skipPreflight:!0});I.push(O)}return{txIds:I,signedTxs:T}}}throw new Error("please connect wallet first")},extInfo:o||{}}}};var dt=class{constructor(e){this._owner=e}get publicKey(){return dt.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return dt.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return dt.isKeyPair(this._owner)}get isPublicKey(){return dt.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!dt.isKeyPair(e)}};function Vi(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}function Cy(r,...e){return r.filter(t=>e.every(n=>n.includes(t)))}function Ry(r,...e){return r.filter(t=>e.every(n=>!n.includes(t)))}function Ly(r){return[...new Set(r)]}var Ms=r=>typeof r=="number",_s=r=>r?new Date(r):new Date,Xc=r=>_s(r).getTime();function Vs(r,e,t){let n=Ms(e)?e*((t==null?void 0:t.unit)==="s"?1e3:1):e;return new Date(r).getTime()<=n}function Es(r,e,t){let n=Ms(e)?e*((t==null?void 0:t.unit)==="s"?1e3:1):e;return new Date(r).getTime()>n}function Ny(r,e){let n=Xc(r)+(e.days?e.days*24*60*60*1e3:0)+(e.hours?e.hours*60*60*1e3:0)+(e.minutes?e.minutes*60*1e3:0)+(e.seconds?e.seconds*1e3:0)+(e.milliseconds?e.milliseconds:0);return _s(n)}import{PublicKey as $e}from"@solana/web3.js";var vi=new $e("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Wi=new $e("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Tn=new $e("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),zc=new $e("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Yc=new $e("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Xr=new $e("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Qc=new $e("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),jc=new $e("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Hc=new $e("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Zc=new $e("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Jc=new $e("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),$c=new $e("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),el=new $e("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),tl=new $e("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Qn={IDO_PROGRAM_ID_V1:Jc,IDO_PROGRAM_ID_V2:$c,IDO_PROGRAM_ID_V3:el,IDO_PROGRAM_ID_V4:tl},Vy={AMM_V4:Qc,AMM_STABLE:jc,CLMM_PROGRAM_ID:Hc,FARM_PROGRAM_ID_V3:vi,FARM_PROGRAM_ID_V5:Wi,FARM_PROGRAM_ID_V6:Tn,OPEN_BOOK_PROGRAM:Yc,SERUM_PROGRAM_ID_V3:Xr,UTIL1216:zc,Router:Zc};import{PublicKey as nl}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as rl}from"@solana/spl-token";function Ae(r,e,t){return le([r.toBuffer(),(t!=null?t:rl).toBuffer(),e.toBuffer()],new nl("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import Ke from"bn.js";var At=1e4;function xn(r,e,t,n){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let i=t.epoch<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new Ke(i.maximumFee.toString()),s=t.epoch<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(i.transferFeeBasisPoints===At){let a=new Ke(i.maximumFee.toString());return{amount:r.add(a),fee:a,expirationTime:s}}else{let a=In(r.mul(new Ke(At)),new Ke(At-i.transferFeeBasisPoints)),u=new Ke(i.maximumFee.toString()),c=a.sub(r).gt(u)?r.add(u):a,l=In(c.mul(new Ke(i.transferFeeBasisPoints)),new Ke(At)),m=l.gt(o)?o:l;return{amount:c,fee:m,expirationTime:s}}else{let a=In(r.mul(new Ke(i.transferFeeBasisPoints)),new Ke(At)),u=a.gt(o)?o:a;return{amount:r,fee:u,expirationTime:s}}}function Oe(r,e,t,n){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let i=D(M({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,s=new Ke(o.maximumFee.toString()),a=t.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===At){let u=new Ke(o.maximumFee.toString());return{amount:r.add(u),fee:u,expirationTime:a}}else{let u=In(r.mul(new Ke(At)),new Ke(At-o.transferFeeBasisPoints)),c=new Ke(o.maximumFee.toString()),l=u.sub(r).gt(c)?r.add(c):u,m=In(l.mul(new Ke(o.transferFeeBasisPoints)),new Ke(At)),p=m.gt(s)?s:m;return{amount:l,fee:p,expirationTime:a}}else{let u=In(r.mul(new Ke(o.transferFeeBasisPoints)),new Ke(At)),c=u.gt(s)?s:u;return{amount:r,fee:c,expirationTime:a}}}function rn(r,e){return r===void 0?e:e===void 0?r:Math.min(r,e)}function In(r,e){let{div:t,mod:n}=r.divmod(e);return n.gt(new Ke(0))?t.add(new Ke(1)):t}var Di=(t=>(t.ALL="all",t.Strict="strict",t))(Di||{}),il=(n=>(n.All="all",n.Standard="standard",n.Concentrated="concentrated",n))(il||{});var Gt={BASE_HOST:"https://uapi.raydium.io",OWNER_BASE_HOST:"https://owner.raydium.io",COINGECKO:"https://api.coingecko.com/api/v3/simple/price",FARM_ARP:"/main/farm/info",FARM_ARP_LINE:"/main/farm-apr-tv",AMM_V3_CONFIG:"/v3/pools/clmm-config",VERSION:"/v3/main/version",PRICE:"/v2/main/price",CHECK_AVAILABILITY:"/v3/main/AvailabilityCheckAPI",RPCS:"/v3/main/rpcs",INFO:"/v3/main/info",STAKE_POOLS:"/v3/main/stake-pools",CHAIN_TIME:"/v3/main/chain-time",TOKEN_LIST:"/v3/mint/list",TOKEN_INFO:"/v3/mint/item/{mint}",JUP_TOKEN_LIST:"https://token.jup.ag/{type}",POOL_LIST:"/v3/pools/info/{type}/{sort}/{order}/{page_size}/{page}",POOL_SEARCH_BY_ID:"/v3/pools/info/ids/{ids}",POOL_SEARCH:"/v3/pools/info/search/{search_text}/{type}/{sort}/{order}/{page_size}/{page}",POOL_SEARCH_MINT:"/v3/pools/info/mint/{mint1}/{type}/{sort}/{order}/{page_size}/{page}",POOL_SEARCH_MINT_2:"/v3/pools/info/mint/{mint1}/{mint2}/{type}/{sort}/{order}/{page_size}/{page}",POOL_SEARCH_LP:"/v3/pools/info/lps/{lp_mints}",POOL_KEY_BY_ID:"/v3/pools/key/id/{id}",POOLS_KEY:"/v3/pools/key/{type}/{page_size}/{page}",POOLS_KEY_BY_MINT:"/v3/pools/key/mint/{mint1}/{type}/{page_size}/{page}",POOLS_KEY_BY_MINT_2:"/v3/pools/key/mint/{mint1}/{mint2}/{type}/{page_size}/{page}",POOL_LIQUIDITY_LINE:"/v3/pools/line/liquidity/{id}",POOL_POSITION_LINE:"/v3/pools/line/position/{id}",FARM_INFO:"/v3/farms/info/ids/{ids}",FARM_LP_INFO:"/v3/farms/info/lp/{pool_lp}/{page_size}/{page}",FARM_LIST:"/v3/farms/info/list/all/{page_size}/{page}",FARM_KEYS:"/v3/farms/key/ids/{ids}",OWNER_CREATED_FARM:"/v1/create-pool/{owner}",OWNER_IDO:"/v1/ido/{owner}",OWNER_STAKE_FARMS:"/v1/position/stake/{owner}",IDO_KEYS:"/v3/ido/key/ids/{ids}",SWAP_HOST:"https://transaction.raydium.io",SWAP_COMPUTE:"/v1/compute/",SWAP_TX:"/v1/transaction/",MINT_PRICE:"/v3/mint/price",MIGRATE_CONFIG:"/v3/main/migrate-lp"},pt=M({},Gt);var Fs="ray_tab_hash",qi="ray_req_hash",ol=()=>{if(typeof window===void 0)return"";let r=sessionStorage.getItem(Fs);return r||(r=`ray-${Date.now()}`,sessionStorage.setItem(Fs,r)),r},zr=async n=>{var i=n,{logCount:r=1e3,removeLastLog:e}=i,t=_e(i,["logCount","removeLastLog"]);if(typeof window===void 0)return new Promise(s=>s());let o=JSON.parse(localStorage.getItem(qi)||"[]").slice(0,r-1);e&&o.pop(),new Blob([JSON.stringify(t.data)]).size>1024&&(t.data=JSON.stringify(t.data).substring(0,200)+"..."),o.unshift(D(M({},t),{time:Date.now(),session:ol()}));try{localStorage.setItem(qi,JSON.stringify(o))}catch{if(e){let s=!1,a=JSON.stringify(t.data).substring(0,100);for(o[0].data=a+(a.length>100?"...":"");!s;){o.pop();let u=JSON.stringify(t.data).substring(0,100);o[0].data=u+(u.length>100?"...":"");try{localStorage.setItem(qi,JSON.stringify(o)),s=!0}catch{s=!1}}return new Promise(u=>u())}return zr(D(M({},t),{logCount:r,removeLastLog:!0}))}};var Bn=se("Raydium_Api"),Ui=new Map;async function xb(r,e,t=1e3){let n;for(;n==null;)try{Bn.debug(`Request ${r} through endlessRetry`),n=await e()}catch(i){Bn.error(`Request ${r} failed, retry after ${t} ms`,i),await xs(t)}return n}var Yr=class{constructor({cluster:e,timeout:t,logRequests:n,logCount:i,urlConfigs:o}){this.cluster=e,this.urlConfigs=o||{},this.logCount=i||1e3,this.api=sl.create({baseURL:this.urlConfigs.BASE_HOST||Gt.BASE_HOST,timeout:t}),this.api.interceptors.request.use(s=>{let{method:a,baseURL:u,url:c}=s;return Bn.debug(`${a==null?void 0:a.toUpperCase()} ${u}${c}`),s},s=>(Bn.error("Request failed"),Promise.reject(s))),this.api.interceptors.response.use(s=>{let{config:a,data:u,status:c}=s,{method:l,baseURL:m,url:p}=a;return n&&zr({status:c,url:`${m}${p}`,params:a.params,data:u,logCount:this.logCount}),Bn.debug(`${l==null?void 0:l.toUpperCase()} ${m}${p}  ${c}`),u},s=>{let{config:a,response:u={}}=s,{status:c}=u,{method:l,baseURL:m,url:p}=a;return n&&zr({status:c,url:`${m}${p}`,params:a.params,data:s.message,logCount:this.logCount}),Bn.error(`${l.toUpperCase()} ${m}${p} ${c||s.message}`),Promise.reject(s)})}async getClmmConfigs(){return(await this.api.get(this.urlConfigs.AMM_V3_CONFIG||Gt.AMM_V3_CONFIG)).data}async getClmmPoolLines(e){return(await this.api.get(`${this.urlConfigs.POOL_LIQUIDITY_LINE||Gt.POOL_LIQUIDITY_LINE}?pool_id=${e}`)).data}async getRaydiumTokenPrice(){return this.api.get(this.urlConfigs.PRICE||Gt.PRICE)}async getBlockSlotCountForSecond(e){if(!e)return 2;let n=(await this.api.post(e,{id:"getRecentPerformanceSamples",jsonrpc:"2.0",method:"getRecentPerformanceSamples",params:[4]})).result.map(i=>i.numSlots);return n.reduce((i,o)=>i+o,0)/n.length/60}async getChainTimeOffset(){return this.api.get(this.urlConfigs.CHAIN_TIME||Gt.CHAIN_TIME)}async getRpcs(){return this.api.get(this.urlConfigs.RPCS||Gt.RPCS)}async getTokenList(){return(await this.api.get(this.urlConfigs.TOKEN_LIST||pt.TOKEN_LIST,{})).data}async getJupTokenList(e){return this.api.get("/",{baseURL:(this.urlConfigs.JUP_TOKEN_LIST||pt.JUP_TOKEN_LIST).replace("{type}",e||"all")})}async getTokenInfo(e){return(await this.api.get((this.urlConfigs.TOKEN_INFO||pt.TOKEN_INFO).replace("{mint}",e.toString()))).data}async getPoolList(e={}){let{type:t="all",sort:n="liquidity",order:i="desc",page:o=0}=e;return(await this.api.get((this.urlConfigs.POOL_LIST||pt.POOL_LIST).replace("{type}",t).replace("{sort}",n).replace("{order}",i).replace("{page}",String(o)))).data}async searchPoolById(e){let{ids:t}=e;return(await this.api.get((this.urlConfigs.POOL_SEARCH_BY_ID||pt.POOL_SEARCH_BY_ID).replace("{ids}",t))).data}async searchPoolByMint(e){let{mint:t,type:n="all",sort:i="liquidity",order:o="desc",page:s=0}=e;return(await this.api.get((this.urlConfigs.POOL_SEARCH_MINT||pt.POOL_SEARCH_MINT).replace("{mint1}",t).replace("{type}",n).replace("{sort}",i).replace("{order}",o).replace("{page}",String(s)))).data}async searchPoolByMints(e){let{mint1:t,mint2:n,type:i="all",sort:o="liquidity",order:s="desc",page:a=0}=e,[u,c]=t>n?[t,n]:[n,t];return(await this.api.get((this.urlConfigs.POOL_SEARCH_MINT_2||pt.POOL_SEARCH_MINT_2).replace("{mint1}",c).replace("{mint2}",u).replace("{type}",i).replace("{sort}",o).replace("{order}",s).replace("{page}",String(a)))).data}async fetchPoolKeysById(e){let{id:t}=e;if(Ui.has(t))return Ui.get(t);let n=await this.api.get((this.urlConfigs.POOL_KEY_BY_ID||pt.POOL_KEY_BY_ID).replace("{id}",t));return Ui.set(t,n.data),n.data}async fetchFarmKeysById(e){let{ids:t}=e;return(await this.api.get((this.urlConfigs.FARM_KEYS||pt.FARM_KEYS).replace("{ids}",t))).data}async fetchAvailabilityStatus(){return(await this.api.get(this.urlConfigs.CHECK_AVAILABILITY||pt.CHECK_AVAILABILITY)).data}};import{merge as Wd}from"lodash";var Qr="please provide owner in load() initialization or you can set by calling raydium.setOwner(owner)",vs="please provide connection in load() initialization or set it by raydium.setConnection(connection)";import{createAssociatedTokenAccountInstruction as ro,TOKEN_PROGRAM_ID as jt,AccountLayout as Kn}from"@solana/spl-token";import{PublicKey as ti,SystemProgram as bm}from"@solana/web3.js";var Gi=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),xe=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=se(t)}createTxBuilder(e){return this.scope.checkOwner(),new Gr({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Gi(e))}logInfo(...e){this.logger.info(Gi(e))}logAndCreateError(...e){let t=Gi(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{createInitializeAccountInstruction as lm,createCloseAccountInstruction as mm,createTransferInstruction as dm,TOKEN_PROGRAM_ID as Sn}from"@solana/spl-token";import{PublicKey as pm,SystemProgram as fm}from"@solana/web3.js";import ym from"bn.js";import{PublicKey as ta,Keypair as sm}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as am}from"@solana/spl-token";import um from"bn.js";import{PublicKey as Jl}from"@solana/web3.js";import zs,{isBN as Ys}from"bn.js";import{bits as al,BitStructure as ul,blob as cl,Blob as ll,cstr as ml,f32 as dl,f32be as pl,f64 as fl,f64be as yl,greedy as bl,Layout as gl,ns64 as wl,ns64be as kl,nu64 as Al,nu64be as hl,offset as Pl,s16 as Tl,s16be as Il,s24 as xl,s24be as Bl,s32 as Sl,s32be as Kl,s40 as Cl,s40be as Rl,s48 as Ll,s48be as Ol,s8 as Nl,seq as Ml,struct as Fb,Structure as _l,u16 as Vl,u16be as El,u24 as Fl,u24be as vl,u32 as Wl,u32be as Dl,u40 as ql,u40be as Ul,u48 as Gl,u48be as Xl,u8 as zl,UInt as Yl,union as Ql,Union as jl,unionLayoutDiscriminator as Hl,utf8 as Zl}from"@solana/buffer-layout";var jn=gl,Ws=_l,Ds=jl,vb=ul,Xi=Yl,qs=ll,Wb=bl,jr=zl,Xt=Vl,Db=Fl,Hn=Wl,qb=ql,Ub=Gl,Us=Al,Gb=El,Xb=vl,zb=Dl,Yb=Ul,Qb=Xl,jb=hl,Hb=Nl,Zb=Tl,Jb=xl,Ee=Sl,$b=Cl,eg=Ll,tg=wl,ng=Il,rg=Bl,ig=Kl,og=Rl,sg=Ol,ag=kl,ug=dl,cg=pl,lg=fl,mg=yl;var Gs=Ml,Xs=Ql,dg=Hl,we=cl,pg=ml,fg=Zl,zi=al,Yi=Pl;var on=class extends jn{constructor(t,n,i){super(t,i);this.blob=we(t),this.signed=n}decode(t,n=0){let i=new zs(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new zs(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}},Hr=class extends jn{constructor(t){super(8,t);this._lower=zi(Hn(),!1),this._upper=zi(Hn(),!1)}addBoolean(t){this._lower.fields.length<32?this._lower.addBoolean(t):this._upper.addBoolean(t)}decode(t,n=0){let i=this._lower.decode(t,n),o=this._upper.decode(t,n+this._lower.span);return M(M({},i),o)}encode(t,n,i=0){return this._lower.encode(t,n,i)+this._upper.encode(t,n,i+this._lower.span)}};function V(r){return new Xi(1,r)}function Ue(r){return new Xi(4,r)}function g(r){return new on(8,!1,r)}function z(r){return new on(16,!1,r)}function Qs(r){return new on(1,!0,r)}function Zr(r){return new on(8,!0,r)}function js(r){return new on(16,!0,r)}var Nt=class extends jn{constructor(t,n,i,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function B(r){return new Nt(we(32),e=>new Jl(e),e=>e.toBuffer(),r)}var Qi=class extends jn{constructor(t,n){super(-1,n);this.layout=t,this.discriminator=jr()}encode(t,n,i=0){return t==null?this.discriminator.encode(0,n,i):(this.discriminator.encode(1,n,i),this.layout.encode(t,n,i+1)+1)}decode(t,n=0){let i=this.discriminator.decode(t,n);if(i===0)return null;if(i===1)return this.layout.decode(t,n+1);throw new Error("Invalid option "+this.property)}getSpan(t,n=0){let i=this.discriminator.decode(t,n);if(i===0)return 1;if(i===1)return this.layout.getSpan(t,n+1)+1;throw new Error("Invalid option "+this.property)}};function kg(r,e){return new Qi(r,e)}function je(r){return new Nt(jr(),$l,em,r)}function $l(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function em(r){return r?1:0}function Ag(r,e){let t=Hn("length"),n=R([t,U(r,Yi(t,-t.span),"values")]);return new Nt(n,({values:i})=>i,i=>({values:i}),e)}function hg(r,e,t){let n=R([g("tag"),e.replicate("data")]);function i({tag:o,data:s}){if(!o.eq(r))throw new Error("Invalid tag, expected: "+r.toString("hex")+", got: "+o.toString("hex"));return s}return new Nt(n,i,o=>({tag:r,data:o}),t)}function tm(r){let e=Hn("length"),t=R([e,we(Yi(e,-e.span),"data")]);return new Nt(t,({data:n})=>n,n=>({data:n}),r)}function Pg(r){return new Nt(tm(),e=>e.toString("utf-8"),e=>Buffer.from(e,"utf-8"),r)}function Tg(r,e){let t=Xs(jr(),e);return r.forEach((n,i)=>t.addVariant(i,n,n.property)),t}function Ig(r,e,t){let n=R([U(r,e,"values")]);return new Nt(n,({values:i})=>i,i=>({values:i}),t)}var ji=class extends Ws{decode(e,t){return super.decode(e,t)}};function R(r,e,t){return new ji(r,e,t)}var Hi=class extends Ds{encodeInstruction(e){let t=Math.max(...Object.values(this.registry).map(i=>i.span)),n=Buffer.alloc(t);return n.slice(0,this.encode(e,n))}decodeInstruction(e){return this.decode(e)}};function xg(r,e,t){return new Hi(r,e,t)}var Zi=class extends qs{decode(e,t){let n=super.decode(e,t);if(!n.every(i=>i===0))throw new Error("nonzero padding bytes");return n}};function Bg(r){return new Zi(r)}function U(r,e,t){let n,i=typeof e=="number"?e:Ys(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Ys(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Gs(r,i,t)}var zt=R([B("mint"),B("owner"),g("amount"),Ue("delegateOption"),B("delegate"),V("state"),Ue("isNativeOption"),g("isNative"),g("delegatedAmount"),Ue("closeAuthorityOption"),B("closeAuthority")]);function nm(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function Ji(r,...e){if(!nm(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function $i(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Hs(r,e){Ji(r);let t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var $r=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),ft=(r,e)=>r<<32-e|r>>>e;var Ng=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function rm(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function eo(r){return typeof r=="string"&&(r=rm(r)),Ji(r),r}var Jr=class{clone(){return this._cloneInto()}},Mg={}.toString;function Zs(r){let e=n=>r().update(eo(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function im(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let i=BigInt(32),o=BigInt(4294967295),s=Number(t>>i&o),a=Number(t&o),u=n?4:0,c=n?0:4;r.setUint32(e+u,s,n),r.setUint32(e+c,a,n)}var Js=(r,e,t)=>r&e^~r&t,$s=(r,e,t)=>r&e^r&t^e&t,ei=class extends Jr{constructor(e,t,n,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=$r(this.buffer)}update(e){$i(this);let{view:t,buffer:n,blockLen:i}=this;e=eo(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(i-this.pos,o-s);if(a===i){let u=$r(e);for(;i<=o-s;s+=i)this.process(u,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){$i(this),Hs(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:i,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(n,0),s=0);for(let m=s;m<i;m++)t[m]=0;im(n,i-8,BigInt(this.length*8),o),this.process(n,0);let a=$r(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let c=u/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<c;m++)a.setUint32(4*m,l[m],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:i,finished:o,destroyed:s,pos:a}=this;return e.length=i,e.pos=a,e.finished=o,e.destroyed=s,i%t&&e.buffer.set(n),e}};var om=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Yt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Qt=new Uint32Array(64),to=class extends ei{constructor(){super(64,32,8,!1),this.A=Yt[0]|0,this.B=Yt[1]|0,this.C=Yt[2]|0,this.D=Yt[3]|0,this.E=Yt[4]|0,this.F=Yt[5]|0,this.G=Yt[6]|0,this.H=Yt[7]|0}get(){let{A:e,B:t,C:n,D:i,E:o,F:s,G:a,H:u}=this;return[e,t,n,i,o,s,a,u]}set(e,t,n,i,o,s,a,u){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,t){for(let m=0;m<16;m++,t+=4)Qt[m]=e.getUint32(t,!1);for(let m=16;m<64;m++){let p=Qt[m-15],d=Qt[m-2],y=ft(p,7)^ft(p,18)^p>>>3,f=ft(d,17)^ft(d,19)^d>>>10;Qt[m]=f+Qt[m-7]+y+Qt[m-16]|0}let{A:n,B:i,C:o,D:s,E:a,F:u,G:c,H:l}=this;for(let m=0;m<64;m++){let p=ft(a,6)^ft(a,11)^ft(a,25),d=l+p+Js(a,u,c)+om[m]+Qt[m]|0,f=(ft(n,2)^ft(n,13)^ft(n,22))+$s(n,i,o)|0;l=c,c=u,u=a,a=s+d|0,s=o,o=i,i=n,n=d+f|0}n=n+this.A|0,i=i+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,i,o,s,a,u,c,l)}roundClean(){Qt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var ea=Zs(()=>new to);var Zg=se("Raydium_Util");function na({owner:r,solAccountResp:e,tokenAccountResp:t}){let n=[],i=[];for(let{pubkey:o,account:s}of t.value){let a=zt.decode(s.data),{mint:u,amount:c}=a;n.push({publicKey:o,mint:u,amount:c,isAssociated:Ae(r,u,s.owner).publicKey.equals(o),isNative:!1,programId:s.owner}),i.push({pubkey:o,accountInfo:a,programId:s.owner})}return e&&n.push({mint:ta.default,amount:new um(e.lamports),isNative:!0,programId:e.owner}),{tokenAccounts:n,tokenAccountRawInfos:i}}function Ge({fromPublicKey:r,programId:e=am}){let t=sm.generate().publicKey.toBase58().slice(0,32);return{publicKey:cm(r,t,e),seed:t}}function cm(r,e,t){let n=Buffer.concat([r.toBuffer(),Buffer.from(e),t.toBuffer()]),i=ea(n);return new ta(i)}function no(r){let{mint:e,tokenAccount:t,owner:n,programId:i=Sn}=r;return lm(t,e,n,i)}function Mt(r){let{tokenAccount:e,payer:t,multiSigners:n=[],owner:i,programId:o=Sn}=r;return mm(e,t,i,n,o)}async function ht(r){let{connection:e,amount:t,commitment:n,payer:i,owner:o,skipCloseAccount:s}=r,a=await e.getMinimumBalanceForRentExemption(zt.span,n),u=q(t).add(new ym(a)),c=Ge({fromPublicKey:i,programId:Sn});return{addresses:{newAccount:c.publicKey},signers:[],instructions:[fm.createAccountWithSeed({fromPubkey:i,basePubkey:i,seed:c.seed,newAccountPubkey:c.publicKey,lamports:u.toNumber(),space:zt.span,programId:Sn}),no({mint:new pm(Re.address),tokenAccount:c.publicKey,owner:o,programId:Sn})],instructionTypes:[_.CreateAccount,_.InitAccount],endInstructionTypes:s?[]:[_.CloseAccount],endInstructions:s?[]:[Mt({tokenAccount:c.publicKey,payer:i,owner:o})]}}function Zn({source:r,destination:e,owner:t,amount:n,multiSigners:i=[],tokenProgram:o=Sn}){return dm(r,e,t,BigInt(String(n)),i,o)}var Jn=class extends xe{constructor(t){super(t);this._tokenAccounts=[];this._tokenAccountRawInfos=[];this._accountListener=[];this._clientOwnedToken=!1;let{tokenAccounts:n,tokenAccountRawInfos:i}=t;this._tokenAccounts=n||[],this._tokenAccountRawInfos=i||[],this._clientOwnedToken=!!(n||i)}get tokenAccounts(){return this._tokenAccounts}get tokenAccountRawInfos(){return this._tokenAccountRawInfos}updateTokenAccount({tokenAccounts:t,tokenAccountRawInfos:n}){return t&&(this._tokenAccounts=t),n&&(this._tokenAccountRawInfos=n),this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=void 0,this._clientOwnedToken=!0,this}addAccountChangeListener(t){return this._accountListener.push(t),this}removeAccountChangeListener(t){return this._accountListener=this._accountListener.filter(n=>n!==t),this}getAssociatedTokenAccount(t,n){return Ae(this.scope.ownerPubKey,t,n).publicKey}async fetchWalletTokenAccounts(t){if(this._clientOwnedToken||!(t!=null&&t.forceUpdate)&&this._tokenAccounts.length)return{tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos};this.scope.checkOwner();let i=M(M({},{}),t),[o,s]=await Promise.all([this.scope.connection.getAccountInfo(this.scope.ownerPubKey,i.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:jt},i.commitment)]),{tokenAccounts:a,tokenAccountRawInfos:u}=na({owner:this.scope.ownerPubKey,solAccountResp:o,tokenAccountResp:s});return this._tokenAccounts=a,this._tokenAccountRawInfos=u,this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=this.scope.connection.onAccountChange(this.scope.ownerPubKey,()=>this.fetchWalletTokenAccounts({forceUpdate:!0}),"confirmed"),{tokenAccounts:a,tokenAccountRawInfos:u}}async getCreatedTokenAccount({mint:t,programId:n=jt,associatedOnly:i=!0}){await this.fetchWalletTokenAccounts();let o=this._tokenAccounts.filter(({mint:a})=>a==null?void 0:a.equals(t)).sort((a,u)=>a.amount.lt(u.amount)?1:-1),s=this.getAssociatedTokenAccount(t,n);for(let a of o){let{publicKey:u}=a;if(u)return i&&s.equals(u),u}}async getOrCreateTokenAccount(t){var y,f,b;await this.fetchWalletTokenAccounts();let{mint:n,createInfo:i,associatedOnly:o,owner:s,notUseTokenAccount:a=!1,skipCloseAccount:u=!1,checkCreateATAOwner:c=!1}=t,l=new ti(t.tokenProgram||jt),m=this.getAssociatedTokenAccount(n,new ti(l)),p=(a?[]:this.tokenAccountRawInfos).filter(w=>w.accountInfo.mint.equals(n)&&(!o||w.pubkey.equals(m))).sort((w,h)=>w.accountInfo.amount.lt(h.accountInfo.amount)?1:-1);if(i===void 0||p.length>0)return p.length>0?{account:p[0].pubkey}:{};let d={instructions:[],endInstructions:[],signers:[],instructionTypes:[],endInstructionTypes:[]};if(o){let w=ro(s,m,s,n,l);if(c){let h=await this.scope.connection.getAccountInfo(m);if(h===null)(y=d.instructions)==null||y.push(w),d.instructionTypes.push(_.CreateATA);else if(!(h.owner.equals(l)&&Kn.decode(h.data).mint.equals(n)&&Kn.decode(h.data).owner.equals(s)))throw Error(`create ata check error -> mint: ${n.toString()}, ata: ${m.toString()}`)}else d.instructions.push(w),d.instructionTypes.push(_.CreateATA);if(n.equals(ee)&&i.amount){let h=await ht({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:i.payer||this.scope.ownerPubKey,amount:(f=i.amount)!=null?f:0,skipCloseAccount:u});d.instructions.push(...h.instructions||[]),d.endInstructions.push(...h.endInstructions||[]),d.instructionTypes.push(...h.instructionTypes||[]),d.endInstructionTypes.push(...h.endInstructionTypes||[]),i.amount&&(d.instructions.push(Zn({source:h.addresses.newAccount,destination:m,owner:this.scope.ownerPubKey,amount:i.amount,tokenProgram:jt})),d.instructionTypes.push(_.TransferAmount))}return u||(d.endInstructions.push(Mt({owner:s,payer:i.payer||s,tokenAccount:m,programId:l})),d.endInstructionTypes.push(_.CloseAccount)),{account:m,instructionParams:d}}else if(n.equals(ee)){let w=await ht({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:i.payer||this.scope.ownerPubKey,amount:(b=i.amount)!=null?b:0,skipCloseAccount:u});return d.instructions.push(...w.instructions||[]),d.endInstructions.push(...w.endInstructions||[]),d.signers.push(...w.signers||[]),d.instructionTypes.push(...w.instructionTypes||[]),d.endInstructionTypes.push(...w.endInstructionTypes||[]),{account:w.addresses.newAccount,instructionParams:d}}else{let w=Ge({fromPublicKey:s,programId:l}),h=await this.scope.connection.getMinimumBalanceForRentExemption(Kn.span),A=bm.createAccountWithSeed({fromPubkey:s,basePubkey:s,seed:w.seed,newAccountPubkey:w.publicKey,lamports:h,space:Kn.span,programId:l});return d.instructions.push(A,no({mint:n,tokenAccount:w.publicKey,owner:this.scope.ownerPubKey,programId:l})),d.instructionTypes.push(_.CreateAccount),d.instructionTypes.push(_.InitAccount),u||(d.endInstructions.push(Mt({owner:s,payer:i.payer||s,tokenAccount:w.publicKey,programId:l})),d.endInstructionTypes.push(_.CloseAccount)),{account:w.publicKey,instructionParams:d}}}async checkOrCreateAta({mint:t,programId:n=jt,autoUnwrapWSOLToSOL:i}){var u;await this.fetchWalletTokenAccounts();let o=(u=this.scope.account.tokenAccounts.find(({mint:c})=>(c==null?void 0:c.toBase58())===t.toBase58()))==null?void 0:u.publicKey,s=this.scope.ownerPubKey,a={};if(!o){let c=this.getAssociatedTokenAccount(t,n),l=await ro(s,c,s,t,n);a.instructions=[l],a.instructionTypes=[_.CreateATA],o=c}return i&&ee.toBase58()===t.toBase58()&&(a.endInstructions=[Mt({owner:s,payer:s,tokenAccount:o,programId:n})],a.endInstructionTypes=[_.CloseAccount]),{pubKey:o,newInstructions:a}}async handleTokenAccount(t){let{side:n,amount:i,mint:o,programId:s=jt,tokenAccount:a,payer:u=this.scope.ownerPubKey,bypassAssociatedCheck:c,skipCloseAccount:l,checkCreateATAOwner:m}=t,p=this.getAssociatedTokenAccount(o,s);if(new ti(ee).equals(o)){let d=await ht({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:u,amount:i,skipCloseAccount:l});return M({tokenAccount:d.addresses.newAccount},d)}else if(!a||n==="out"&&!p.equals(a)&&!c){let d=[],y=ro(this.scope.ownerPubKey,p,this.scope.ownerPubKey,o,s);if(m){let f=await this.scope.connection.getAccountInfo(p);if(f===null)d.push(y);else if(!(f.owner.equals(jt)&&Kn.decode(f.data).mint.equals(o)&&Kn.decode(f.data).owner.equals(this.scope.ownerPubKey)))throw Error(`create ata check error -> mint: ${o.toString()}, ata: ${p.toString()}`)}else d.push(y);return{tokenAccount:p,instructions:d,instructionTypes:[_.CreateATA]}}return{tokenAccount:a}}async processTokenAccount(t){let{mint:n,programId:i=jt,amount:o,useSOLBalance:s,handleTokenAccount:a}=t,u,c=this.createTxBuilder();if(n.equals(new ti(ee))&&s){let l=await this.handleTokenAccount({side:"in",amount:o||0,mint:n,bypassAssociatedCheck:!0,programId:i}),{tokenAccount:p}=l,d=_e(l,["tokenAccount"]);u=p,c.addInstruction(d)}else if(u=await this.getCreatedTokenAccount({mint:n,associatedOnly:!1,programId:i}),!u&&a){let m=await this.scope.account.handleTokenAccount({side:"in",amount:0,mint:n,bypassAssociatedCheck:!0,programId:i}),{tokenAccount:p}=m,d=_e(m,["tokenAccount"]);u=p,c.addInstruction(d)}return M({tokenAccount:u},c.AllTxData)}};import{createAssociatedTokenAccountInstruction as Em}from"@solana/spl-token";import{PublicKey as he,SystemProgram as Fm}from"@solana/web3.js";import{PublicKey as ca}from"@solana/web3.js";var io=R([V("instruction")]),oo=R([V("instruction")]),gm=R([g("rewardState"),g("rewardOpenTime"),g("rewardEndTime"),g("rewardLastUpdateTime"),g("totalReward"),g("totalRewardEmissioned"),g("rewardClaimed"),g("rewardPerSecond"),z("accRewardPerShare"),B("rewardVault"),B("rewardMint"),B("rewardSender"),g("rewardType"),U(g(),15,"padding")]),wm=R([g("state"),g("nonce"),B("lpVault"),B("rewardVault"),B(),B(),g(),g(),g("totalReward"),z("perShareReward"),g("lastSlot"),g("perSlotReward")]),km=R([g("state"),g("nonce"),B("lpVault"),B("rewardVaultA"),g("totalRewardA"),z("perShareRewardA"),g("perSlotRewardA"),V("option"),B("rewardVaultB"),we(7),g("totalRewardB"),z("perShareRewardB"),g("perSlotRewardB"),g("lastSlot"),B()]),Am=R([g(),g("state"),g("nonce"),g("validRewardTokenNum"),z("rewardMultiplier"),g("rewardPeriodMax"),g("rewardPeriodMin"),g("rewardPeriodExtend"),B("lpMint"),B("lpVault"),U(gm,5,"rewardInfos"),B("creator"),B(),U(g(),32,"padding")]),ra=new Proxy(wm,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return D(M({},i),{version:3,rewardInfos:[{rewardVault:i.rewardVault,totalReward:i.totalReward,perSlotReward:i.perSlotReward,perShareReward:i.perShareReward}]})}:Reflect.get(r,e,t)}}),ia=new Proxy(km,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return D(M({},i),{version:5,rewardInfos:[{rewardVault:i.rewardVaultA,totalReward:i.totalRewardA,perSlotReward:i.perSlotRewardA,perShareReward:i.perShareRewardA},{rewardVault:i.rewardVaultB,totalReward:i.totalRewardB,perSlotReward:i.perSlotRewardB,perShareReward:i.perShareRewardB}]})}:Reflect.get(r,e,t)}}),$n=new Proxy(Am,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return D(M({},i),{version:6,rewardInfos:i.rewardInfos.map(o=>{var s;return D(M({},o),{rewardType:((s=Object.entries(Ht).find(a=>String(a[1])===o.rewardType.toString()))!=null?s:["Standard SPL"])[0]})})})}:Reflect.get(r,e,t)}}),hm=R([g("isSet"),g("rewardPerSecond"),g("rewardOpenTime"),g("rewardEndTime"),g("rewardType")]),so=R([V("instruction"),g("nonce"),U(hm,5,"rewardTimeInfo")]),ao=R([V("instruction"),g("rewardReopenTime"),g("rewardEndTime"),g("rewardPerSecond")]),uo=R([V("instruction"),g("isSet"),g("rewardPerSecond"),g("rewardOpenTime"),g("rewardEndTime"),g("rewardType")]),Cw=R([g("state"),B("id"),B("owner"),g("deposited"),U(g(),1,"rewardDebts")]),er=R([g("state"),B("id"),B("owner"),g("deposited"),U(z(),1,"rewardDebts"),g(""),g("voteLockedBalance"),U(g(),15)]),Rw=R([g("state"),B("id"),B("owner"),g("deposited"),U(g(),2,"rewardDebts")]),oa=R([g("state"),B("id"),B("owner"),g("deposited"),U(z(),2,"rewardDebts"),U(g(),17)]),sa=R([g(),g("state"),B("id"),B("owner"),g("deposited"),U(z(),5,"rewardDebts"),U(g(),16)]),He=R([V("instruction"),g("amount")]),Pm=R([B("mint"),B("grantAuthority"),g("baselineVoteWeightScaledFactor"),g("maxExtraLockupVoteWeightScaledFactor"),g("lockupSaturationSecs"),Qs("digitShift"),U(V(),7,"reserved1"),U(g(),7,"reserved2")]),aa=R([we(8),B("governanceProgramId"),B("realm"),B("realmGoverningTokenMint"),B("realmAuthority"),U(V(),32,"reserved1"),U(Pm,4,"votingMints"),Zr("timeOffset"),V("bump"),U(V(),7,"reserved2"),U(g(),11,"reserved3")]),Tm=R([Zr("startTime"),Zr("endTime"),V("kind"),U(V(),15,"reserved")]),Im=R([U(Tm,1,"lockup"),g("amountDeposited_native"),g("amountInitiallyLockedNative"),je("isUsed"),je("allowClawback"),V("votingMintConfigIdx"),U(V(),29,"reserved")]),ua=R([we(8),B("voterAuthority"),B("registrar"),U(Im,32,"deposits"),V("voterBump"),V("voterWweightRecordBump"),U(V(),94,"reserved")]);var Fw=se("Raydium_farm_config"),la=new ca("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ma=new ca("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1"),da={3:ra,5:ia,6:$n},pa={3:er,5:oa,6:sa},co=r=>[3,5,6].indexOf(r)!==-1,lo=r=>{var s;let{version:e,rewardInfos:t,rewardTokenAccountsPublicKeys:n}=r,i=`rewardInfo:${JSON.stringify(t)}, rewardAccount:${JSON.stringify(n)}`,o={3:()=>{if(t.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${i}`},5:()=>{if(t.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${i}`},6:()=>{if(!n.length||t.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${i}`}};return(s=o[e])==null?void 0:s.call(o)},Ht={"Standard SPL":0,"Option tokens":1},yt={[vi.toString()]:3,[Wi.toString()]:5,[Tn.toString()]:6};import{PublicKey as ie,SystemProgram as sn,SYSVAR_RENT_PUBKEY as Sm,SYSVAR_CLOCK_PUBKEY as rr,TransactionInstruction as Ne}from"@solana/web3.js";import{createAssociatedTokenAccountInstruction as Km,TOKEN_PROGRAM_ID as nt,ASSOCIATED_TOKEN_PROGRAM_ID as Cm}from"@solana/spl-token";import ri from"bn.js";function mo(r,e,t){return le([e.toBuffer(),Buffer.from("registrar","utf8"),t.toBuffer()],r)}function po(r,e){return le([e.toBuffer(),Buffer.from("voting_mint_seed","utf8")],r)}function fo(r,e){return le([e.toBuffer()],r)}function yo(r,e,t){return le([e.toBuffer(),Buffer.from("voter","utf8"),t.toBuffer()],r)}function bo(r,e,t){return le([e.toBuffer(),Buffer.from("voter-weight-record","utf8"),t.toBuffer()],r)}function go(r,e,t,n){return le([Buffer.from("governance","utf8"),e.toBuffer(),t.toBuffer(),n.toBuffer()],r)}import et from"bn.js";var tr=se("Raydium.farm.util");function nr({programId:r,poolId:e,mint:t,type:n}){let{publicKey:i}=le([e.toBuffer(),t.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],r);return i}function tt({programId:r,poolId:e,owner:t,version:n}){let{publicKey:i}=le([e.toBuffer(),t.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],r);return i}var fa=({programId:r,poolId:e})=>le([e.toBuffer()],r);function ya(r){return{isSet:new et(1),rewardPerSecond:q(r.perSecond),rewardOpenTime:q(r.openTime),rewardEndTime:q(r.endTime),rewardType:q(Ht[r.rewardType])}}function wo(r){return q(r.endTime).sub(q(r.openTime)).mul(q(r.perSecond))}function ni(r){let e=pa[r];return e||tr.logWithError("invalid version",r),e}function xm(r){let e=da[r];return e||tr.logWithError("invalid version",r),e}function Bm(r,e,t,n){if(r.version===3||r.version===5){if(r.lastSlot.gte(new et(t)))return r;let i=new et(t).sub(r.lastSlot);r.lastSlot=new et(t);for(let o of r.rewardInfos){if(e.amount.eq(new et(0)))continue;let s=o.perSlotReward.mul(i);o.perShareReward=o.perShareReward.add(s.mul(new et(10).pow(new et(r.version===3?9:15))).div(e.amount)),o.totalReward=o.totalReward.add(s)}}else if(r.version===6)for(let i of r.rewardInfos){if(i.rewardState.eq(new et(0)))continue;let o=et.min(new et(n),i.rewardEndTime);if(i.rewardOpenTime.gte(o))continue;let a=o.sub(i.rewardLastUpdateTime).mul(i.rewardPerSecond),u=i.totalReward.sub(i.totalRewardEmissioned);u.lt(a)?(a=u,i.rewardLastUpdateTime=i.rewardLastUpdateTime.add(u.div(i.rewardPerSecond))):i.rewardLastUpdateTime=o,!e.amount.eq(new et(0))&&(i.accRewardPerShare=i.accRewardPerShare.add(a.mul(r.rewardMultiplier).div(e.amount)),i.totalRewardEmissioned=i.totalRewardEmissioned.add(a))}return r}async function tk({connection:r,farmPools:e,owner:t,config:n,chainTime:i}){let o=!1,s=!1,a=new et(10),u=[];for(let p of e){let d=fe(p);d.version===6?s=!0:o=!0,u.push({pubkey:d.id,version:d.version,key:"state",poolId:d.id},{pubkey:d.lpVault,version:d.version,key:"lpVault",poolId:d.id}),t&&u.push({pubkey:tt({programId:d.programId,poolId:d.id,owner:t,version:p.version}),version:d.version,key:"ledger",poolId:d.id})}let c={},l=await Pn(r,u,n);for(let{pubkey:p,version:d,key:y,poolId:f,accountInfo:b}of l){let w=f.toBase58();if(c[w]=M({},c[w]),y==="state"){let h=xm(d);(!b||!b.data||b.data.length!==h.span)&&tr.logWithError(`invalid farm state account info, pools.id, ${p}`),c[w].state=h.decode(b.data)}else if(y==="lpVault")(!b||!b.data||b.data.length!==zt.span)&&tr.logWithError(`invalid farm lp vault account info, pools.lpVault, ${p}`),c[w].lpVault=zt.decode(b.data);else if(y==="ledger"){let h=ni(d);b&&b.data&&(b.data.length!==h.span&&tr.logWithError(`invalid farm ledger account info, ledger, ${p}`),c[w].ledger=h.decode(b.data))}}let m=s||o?await r.getSlot():0;for(let p of Object.keys(c))c[p]!==void 0&&(c[p].state=Bm(c[p].state,c[p].lpVault,m,i));for(let[p,{state:d,ledger:y}]of Object.entries(c))if(y){let f=d.version===6?d.rewardMultiplier:d.rewardInfos.length===1?a.pow(new et(9)):a.pow(new et(15)),b=d.rewardInfos.map((w,h)=>{let A=y.rewardDebts[h];return y.deposited.mul(d.version===6?w.accRewardPerShare:w.perShareReward).div(f).sub(A)});c[p].wrapped=D(M({},c[p].wrapped),{pendingRewards:b})}return c}function nk(r,e=Date.now()){if(r.version===6){let t=r.state.rewardInfos;if(t.every(({rewardOpenTime:n})=>Vs(e,n.toNumber(),{unit:"s"})))return"upcoming pool";if(t.every(({rewardEndTime:n})=>Es(e,n.toNumber(),{unit:"s"})))return"closed pool"}else{let t=r.state.rewardInfos.map(({perSlotReward:n})=>n);if(t.length===2){if(String(t[0])==="0"&&String(t[1])!=="0")return"normal fusion pool";if(String(t[0])!=="0"&&String(t[1])!=="0")return"dual fusion pool";if(String(t[0])==="0"&&String(t[1])==="0")return"closed pool"}else if(t.length===1&&String(t[0])==="0")return"closed pool"}}async function ko(r,e,t,n){let i=await r.getAccountInfo(e);if(i===null)throw Error("registrar info check error");let s=aa.decode(i.data).votingMints.findIndex(l=>l.mint.equals(n));if(s===-1)throw Error("find voter mint error");let a=await r.getAccountInfo(t);if(a===null)return{index:s,isInit:!1};let c=ua.decode(a.data).deposits.findIndex(l=>l.isUsed&&l.votingMintConfigIdx===s);return c===-1?{index:s,isInit:!1}:{index:c,isInit:!0}}var Rm=se("Raydium_farm_instruction"),ir={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function ba(r){let{version:e,id:t,ledger:n,programId:i,owner:o}=r,s={3:9,5:10}[e];s||Rm.logWithError(`invalid farm pool version: ${e}`);let a=Buffer.alloc(io.span);io.encode({instruction:s},a);let u=[k({pubkey:t}),k({pubkey:n}),k({pubkey:o,isWritable:!1}),k({pubkey:sn.programId,isWritable:!1}),k({pubkey:Sm,isWritable:!1})];return{instruction:new Ne({programId:i,keys:u,data:a}),instructionType:_.FarmV3CreateLedger}}function ga(r){var n;let e=Buffer.alloc(so.span);so.encode({instruction:0,nonce:new ri(r.nonce),rewardTimeInfo:r.rewardInfoConfig},e);let t=[...Ii,k({pubkey:r.farmId}),k({pubkey:r.farmAuthority,isWritable:!1}),k({pubkey:r.lpVault}),k({pubkey:r.lpMint,isWritable:!1}),k({pubkey:r.lockVault}),k({pubkey:r.lockMint,isWritable:!1}),k({pubkey:(n=r.lockUserAccount)!=null?n:de}),k({pubkey:r.owner,isWritable:!1,isSigner:!0})];for(let i of r.rewardInfo)t.push(k({pubkey:i.rewardMint,isWritable:!1}),k({pubkey:i.rewardVault}),k({pubkey:i.userRewardToken}));return{instruction:new Ne({programId:r.programId,keys:t,data:e}),instructionType:_.FarmV6Create}}function wa(r){let e=Buffer.alloc(oo.span);oo.encode({instruction:5},e);let t=[k({pubkey:nt,isWritable:!1}),k({pubkey:r.id}),k({pubkey:r.authority,isWritable:!1}),k({pubkey:r.lpVault,isWritable:!1}),k({pubkey:r.rewardVault}),k({pubkey:r.userRewardToken}),k({pubkey:r.owner,isWritable:!1,isSigner:!0})];return{instruction:new Ne({programId:r.programId,keys:t,data:e}),instructionType:_.FarmV6CreatorWithdraw}}function Lm(r,e,t,n,i,o,s,a,u,c,l,m,p){let d=R([V("depositEntryIndex"),g("amount")]),y=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:Nr,isSigner:!1,isWritable:!1}],f=Buffer.alloc(d.span);d.encode({depositEntryIndex:m,amount:p},f);let b=Buffer.from([...ir.voterStakeRegistryDeposit,...f]);return new Ne({keys:y,programId:r,data:b})}function Om(r,e,t,n){let i=R([]),o=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:sn.programId,isSigner:!1,isWritable:!1}],s=Buffer.alloc(i.span);i.encode({},s);let a=Buffer.from([...ir.voterStakeRegistryUpdateVoterWeightRecord,...s]);return new Ne({keys:o,programId:r,data:a})}function Nm(r,e,t,n,i,o,s,a,u,c,l,m,p,d,y){let f=R([V("depositEntryIndex"),g("amount")]),b=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:Nr,isSigner:!1,isWritable:!1}],w=Buffer.alloc(f.span);f.encode({depositEntryIndex:d,amount:y},w);let h=Buffer.from([...ir.voterStakeRegistryWithdraw,...w]);return new Ne({keys:b,programId:r,data:h})}function Mm(r,e,t,n,i,o){let s=R([V("ins")]),a=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!0},{pubkey:sn.programId,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);return s.encode({ins:23},u),new Ne({keys:a,programId:r,data:u})}function _m(r,e,t,n,i,o,s,a){let u=R([V("voterBump"),V("voterWeightRecordBump")]),c=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:sn.programId,isSigner:!1,isWritable:!1},{pubkey:it,isSigner:!1,isWritable:!1},{pubkey:Nr,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({voterBump:s,voterWeightRecordBump:a},l);let m=Buffer.from([...ir.voterStakeRegistryCreateVoter,...l]);return new Ne({keys:c,programId:r,data:m})}function Vm(r,e,t,n,i,o,s,a,u,c,l,m){let p=R([V("depositEntryIndex"),V("kind"),V("option"),g("startTs"),Ue("periods"),je("allowClawback")]),d=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:sn.programId,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:Cm,isSigner:!1,isWritable:!1},{pubkey:it,isSigner:!1,isWritable:!1}],y=Buffer.alloc(p.span);p.encode({depositEntryIndex:a,kind:u,option:c===void 0?0:1,startTs:c,periods:l,allowClawback:m},y);let f=Buffer.from([...ir.voterStakeRegistryCreateDepositEntry,...y]);return new Ne({keys:d,programId:r,data:f})}async function kk({connection:r,programId:e,governanceProgramId:t,voteWeightAddinProgramId:n,realm:i,communityTokenMint:o,owner:s,poolId:a,tokenProgram:u}){let c=mo(n,i,o).publicKey,l=tt({programId:e,poolId:a,owner:s,version:3}),m=await r.getAccountInfo(l);if(m===null)throw Error("user is not staker");let p=er.decode(m.data),d=p.deposited.sub(p.voteLockedBalance);if(console.log("amount",d.toString()),d.eq(new ri(0)))throw Error("user do not has new stake amount");let y=po(e,a).publicKey,f=fo(e,a).publicKey,{publicKey:b,nonce:w}=yo(n,c,s),h=Ae(b,y,u).publicKey,{publicKey:A,nonce:P}=bo(n,c,s),T=go(t,i,o,s).publicKey,I=[],x=Ae(s,y,u).publicKey;if(await r.getAccountInfo(x)===null&&I.push(Km(s,x,s,y)),await r.getAccountInfo(b)===null){let J=Mm(t,i,s,o,s,T);I.push(J,_m(n,c,b,A,s,s,w,P))}let{index:L,isInit:E}=await ko(r,c,b,y);return E||I.push(Vm(n,c,b,h,s,s,y,L,0,void 0,0,!1)),I.push(Lm(n,c,b,h,x,s,l,a,y,f,e,L,d),Om(n,c,b,A)),I}async function Ak({connection:r,programId:e,governanceProgramId:t,voteWeightAddinProgramId:n,realm:i,communityTokenMint:o,owner:s,poolId:a,tokenProgram:u}){let c=mo(n,i,o).publicKey,l=tt({programId:e,poolId:a,owner:s,version:3}),m=await r.getAccountInfo(l);if(m===null)throw Error("user is not staker");let p=er.decode(m.data);if(p.voteLockedBalance.eq(new ri(0)))throw Error("user has vote locked balance = 0");let d=po(e,a).publicKey,y=fo(e,a).publicKey,{publicKey:f}=yo(n,c,s),b=Ae(f,d,u).publicKey,{publicKey:w}=bo(n,c,s),h=go(t,i,o,s).publicKey,A=[],{index:P,isInit:T}=await ko(r,c,f,d);if(!T)throw Error("deposit entry index check error");return A.push(Nm(n,c,f,s,h,w,b,Ae(s,d,u).publicKey,l,a,d,y,e,P,p.voteLockedBalance)),A}function Ao({payer:r,rewardVault:e,userRewardTokenPub:t,farmKeys:n,rewardInfo:i}){let o=Buffer.alloc(ao.span);ao.encode({instruction:3,rewardReopenTime:q(i.openTime),rewardEndTime:q(i.endTime),rewardPerSecond:q(i.perSecond)},o);let s=[k({pubkey:nt,isWritable:!1}),k({pubkey:n.id}),k({pubkey:n.lpVault,isWritable:!1}),k({pubkey:e}),k({pubkey:t}),k({pubkey:r,isWritable:!1,isSigner:!0})];return new Ne({programId:n.programId,keys:s,data:o})}function ho({payer:r,userRewardTokenPub:e,farmKeys:t,rewardVault:n,rewardInfo:i}){let o=Buffer.alloc(uo.span);uo.encode({instruction:4,isSet:new ri(1),rewardPerSecond:q(i.perSecond),rewardOpenTime:q(i.openTime),rewardEndTime:q(i.endTime),rewardType:q(Ht[i.rewardType])},o);let s=[...Ii,k({pubkey:t.id}),k({pubkey:t.authority,isWritable:!1}),k({pubkey:i.mint,isWritable:!1}),k({pubkey:n}),k({pubkey:e}),k({pubkey:r,isWritable:!1,isSigner:!0})];return new Ne({programId:t.programId,keys:s,data:o})}function hk(r){let{farmInfo:e,farmKeys:t,version:n,lpAccount:i,rewardAccounts:o,owner:s,instruction:a,amount:u,deposit:c}=r,[l,m]=[new ie(e.programId),new ie(e.id)],p=tt({programId:l,poolId:m,owner:s,version:n}),d=Buffer.alloc(He.span);He.encode({instruction:a,amount:u},d);let y=n===6?[k({pubkey:nt,isWritable:!1}),...c?[k({pubkey:sn.programId,isWritable:!1})]:[],k({pubkey:m}),k({pubkey:new ie(t.authority),isWritable:!1}),k({pubkey:new ie(t.lpVault)}),k({pubkey:p}),k({pubkey:s,isWritable:!1,isSigner:!0}),k({pubkey:i})]:[k({pubkey:m}),k({pubkey:new ie(t.authority),isWritable:!1}),k({pubkey:p}),k({pubkey:s,isWritable:!1,isSigner:!0}),k({pubkey:i}),k({pubkey:new ie(t.lpVault)}),k({pubkey:o[0]}),k({pubkey:new ie(t.rewardInfos[0].vault)}),k({pubkey:rr,isWritable:!1}),k({pubkey:nt,isWritable:!1})];if(n===5)for(let f=1;f<t.rewardInfos.length;f++)y.push(k({pubkey:o[f]})),y.push(k({pubkey:new ie(t.rewardInfos[f].vault)}));if(n===6)for(let f=0;f<t.rewardInfos.length;f++)y.push(k({pubkey:new ie(t.rewardInfos[f].vault)})),y.push(k({pubkey:o[f]}));return new Ne({programId:l,keys:y,data:d})}function or(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s}=r,[a,u]=[new ie(e.programId),new ie(e.id)],c=tt({programId:a,poolId:u,owner:o,version:6}),l=Buffer.alloc(He.span);He.encode({instruction:2,amount:q(s)},l);let m=[k({pubkey:nt,isWritable:!1}),k({pubkey:u}),k({pubkey:new ie(t.authority),isWritable:!1}),k({pubkey:new ie(t.lpVault)}),k({pubkey:c}),k({pubkey:o,isWritable:!1,isSigner:!0}),k({pubkey:n})];for(let p=0;p<t.rewardInfos.length;p++)m.push(k({pubkey:new ie(t.rewardInfos[p].vault)})),m.push(k({pubkey:i[p]}));return new Ne({programId:a,keys:m,data:l})}function sr(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s,userAuxiliaryLedgers:a}=r,[u,c]=[new ie(e.programId),new ie(e.id)],l=tt({programId:u,poolId:c,owner:o,version:5}),m=Buffer.alloc(He.span);He.encode({instruction:12,amount:q(s)},m);let p=[k({pubkey:c}),k({pubkey:new ie(t.authority),isWritable:!1}),k({pubkey:l}),k({pubkey:o,isWritable:!1,isSigner:!0}),k({pubkey:n}),k({pubkey:new ie(t.lpVault)}),k({pubkey:i[0]}),k({pubkey:new ie(t.rewardInfos[0].vault)}),k({pubkey:rr,isWritable:!1}),k({pubkey:nt,isWritable:!1})];for(let d=1;d<t.rewardInfos.length;d++)p.push(k({pubkey:i[d]})),p.push(k({pubkey:new ie(t.rewardInfos[d].vault)}));if(a)for(let d of a)p.push(k({pubkey:d}));return new Ne({programId:u,keys:p,data:m})}function ar(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s,userAuxiliaryLedgers:a}=r,[u,c]=[new ie(e.programId),new ie(e.id)],l=tt({programId:u,poolId:c,owner:o,version:3}),m=Buffer.alloc(He.span);He.encode({instruction:11,amount:q(s)},m);let p=[k({pubkey:c}),k({pubkey:new ie(t.authority),isWritable:!1}),k({pubkey:l}),k({pubkey:o,isWritable:!1,isSigner:!0}),k({pubkey:n}),k({pubkey:new ie(t.lpVault)}),k({pubkey:i[0]}),k({pubkey:new ie(t.rewardInfos[0].vault)}),k({pubkey:rr,isWritable:!1}),k({pubkey:nt,isWritable:!1})];if(a)for(let d of a)p.push(k({pubkey:d}));return new Ne({programId:u,keys:p,data:m})}function ka(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s,userAuxiliaryLedgers:a}=r,[u,c]=[new ie(e.programId),new ie(e.id)],l=tt({programId:u,poolId:c,owner:o,version:3}),m=Buffer.alloc(He.span);He.encode({instruction:10,amount:q(s)},m);let p=[k({pubkey:c}),k({pubkey:new ie(t.authority),isWritable:!1}),k({pubkey:l}),k({pubkey:o,isWritable:!1,isSigner:!0}),k({pubkey:n}),k({pubkey:new ie(t.lpVault)}),k({pubkey:i[0]}),k({pubkey:new ie(t.rewardInfos[0].vault)}),k({pubkey:rr,isWritable:!1}),k({pubkey:nt,isWritable:!1})];if(a)for(let d of a)p.push(k({pubkey:d}));return new Ne({programId:u,keys:p,data:m})}function Aa(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s,userAuxiliaryLedgers:a}=r,[u,c]=[new ie(e.programId),new ie(e.id)],l=tt({programId:u,poolId:c,owner:o,version:5}),m=Buffer.alloc(He.span);He.encode({instruction:11,amount:q(s)},m);let p=[k({pubkey:c}),k({pubkey:new ie(t.authority),isWritable:!1}),k({pubkey:l}),k({pubkey:o,isWritable:!1,isSigner:!0}),k({pubkey:n}),k({pubkey:new ie(t.lpVault)}),k({pubkey:i[0]}),k({pubkey:new ie(t.rewardInfos[0].vault)}),k({pubkey:rr,isWritable:!1}),k({pubkey:nt,isWritable:!1})];for(let d=1;d<t.rewardInfos.length;d++)p.push(k({pubkey:i[d]})),p.push(k({pubkey:new ie(t.rewardInfos[d].vault)}));if(a)for(let d of a)p.push(k({pubkey:d}));return new Ne({programId:u,keys:p,data:m})}function ha(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s}=r,[a,u]=[new ie(e.programId),new ie(e.id)],c=tt({programId:a,poolId:u,owner:o,version:6}),l=Buffer.alloc(He.span);He.encode({instruction:1,amount:q(s)},l);let m=[k({pubkey:nt,isWritable:!1}),k({pubkey:sn.programId,isWritable:!1}),k({pubkey:u}),k({pubkey:new ie(t.authority),isWritable:!1}),k({pubkey:new ie(t.lpVault)}),k({pubkey:c}),k({pubkey:o,isWritable:!1,isSigner:!0}),k({pubkey:n})];for(let p=0;p<t.rewardInfos.length;p++)m.push(k({pubkey:new ie(t.rewardInfos[p].vault)})),m.push(k({pubkey:i[p]}));return new Ne({programId:a,keys:m,data:l})}var ur=class extends xe{async _getUserRewardInfo({payer:e,rewardInfo:t}){if(t.mint.equals(de)){let n=await ht({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:e,amount:wo(t)});return{rewardPubKey:n.addresses.newAccount,newInstruction:n}}return{rewardPubKey:await this.scope.account.getCreatedTokenAccount({mint:t.mint,associatedOnly:!1})}}async create({poolInfo:e,rewardInfos:t,payer:n,programId:i=Tn,txVersion:o}){this.checkDisabled(),this.scope.checkOwner();let a={lpMint:new he(e.lpMint.address),lockInfo:{lockMint:la,lockVault:ma},version:6,rewardInfos:t,programId:i},u=this.createTxBuilder(),c=n!=null?n:this.scope.ownerPubKey,l=Ge({fromPublicKey:c,programId:a.programId}),m=await this.scope.connection.getMinimumBalanceForRentExemption($n.span);u.addInstruction({instructions:[Fm.createAccountWithSeed({fromPubkey:c,basePubkey:c,seed:l.seed,newAccountPubkey:l.publicKey,lamports:m,space:$n.span,programId:a.programId})]});let{publicKey:p,nonce:d}=fa({programId:new he(a.programId),poolId:l.publicKey}),y=nr({programId:a.programId,poolId:l.publicKey,mint:a.lpMint,type:"lpVault"}),f=[],b=[];for(let P of a.rewardInfos){P.openTime>=P.endTime&&this.logAndCreateError("start time error","rewardInfo.rewardOpenTime",P.openTime.toString()),isNaN(Ht[P.rewardType])&&this.logAndCreateError("rewardType error",P.rewardType),Number(P.perSecond)<=0&&this.logAndCreateError("rewardPerSecond error",P.perSecond),f.push(ya(P));let{rewardPubKey:T,newInstruction:I}=await this._getUserRewardInfo({rewardInfo:P,payer:c});I&&u.addInstruction(I),T||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let x=P.mint.equals(de)?new he(Re.address):P.mint;b.push({rewardMint:x,rewardVault:nr({programId:a.programId,poolId:l.publicKey,mint:x,type:"rewardVault"}),userRewardToken:T})}let w=await this.scope.account.getCreatedTokenAccount({mint:a.lockInfo.lockMint});w||this.logAndCreateError("cannot found lock vault","tokenAccounts",this.scope.account.tokenAccounts);let{instruction:h,instructionType:A}=ga({farmId:l.publicKey,owner:this.scope.ownerPubKey,farmAuthority:p,lpVault:y,lpMint:a.lpMint,lockVault:a.lockInfo.lockVault,lockMint:a.lockInfo.lockMint,lockUserAccount:w,programId:a.programId,rewardInfo:b,rewardInfoConfig:f,nonce:d});return u.addInstruction({instructions:[h],instructionTypes:[A]}).versionBuild({txVersion:o,extInfo:{farmId:l.publicKey,farmAuthority:p,lpVault:y,lockUserAccount:w,nonce:d}})}async restartReward({farmInfo:e,payer:t,newRewardInfo:n,txVersion:i}){var b;let o=yt[e.programId];o!==6&&this.logAndCreateError("invalid farm version ",o);let s=fe((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),a={id:s.id,rewardInfos:e.rewardInfos,lpVault:s.lpVault,programId:s.programId};n.openTime>=n.endTime&&this.logAndCreateError("start time error","newRewardInfo",n);let u=t||this.scope.ownerPubKey,c=n.mint.equals(de)?new he(Re.address):n.mint,l=a.rewardInfos.findIndex(w=>new he(w.mint.address).equals(c)),m=s.rewardInfos[l];m||this.logAndCreateError("configuration does not exist","rewardMint",c);let p=(b=m.vault)!=null?b:de,d=this.createTxBuilder(),{rewardPubKey:y,newInstruction:f}=await this._getUserRewardInfo({rewardInfo:n,payer:u});return f&&d.addInstruction(f),y||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts),d.addInstruction({instructions:[Ao({payer:this.scope.ownerPubKey,rewardVault:p,userRewardTokenPub:y,farmKeys:a,rewardInfo:n})],instructionTypes:[_.FarmV6Restart]}).versionBuild({txVersion:i})}async restartRewards({farmInfo:e,payer:t,newRewardInfos:n,txVersion:i}){var l;let o=yt[e.programId];o!==6&&this.logAndCreateError("invalid farm version ",o);let s=fe((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),a={id:s.id,rewardInfos:e.rewardInfos,lpVault:s.lpVault,programId:s.programId};n.forEach(m=>{m.openTime>=m.endTime&&this.logAndCreateError("start time error","newRewardInfo",m)});let u=t||this.scope.ownerPubKey,c=this.createTxBuilder();for(let m of n){let p=m.mint.equals(de)?new he(Re.address):m.mint,d=a.rewardInfos.findIndex(A=>new he(A.mint.address).equals(p)),y=s.rewardInfos[d];y||this.logAndCreateError("configuration does not exist","rewardMint",p);let f=(l=y.vault)!=null?l:de,{rewardPubKey:b,newInstruction:w}=await this._getUserRewardInfo({rewardInfo:m,payer:u});w&&c.addInstruction(w),b||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let h=Ao({payer:this.scope.ownerPubKey,rewardVault:f,userRewardTokenPub:b,farmKeys:a,rewardInfo:m});c.addInstruction({instructions:[h],instructionTypes:[_.FarmV6Restart]})}return c.versionBuild({txVersion:i})}async addNewRewardToken(e){let{txVersion:t,farmInfo:n,newRewardInfo:i,payer:o}=e,s=yt[n.programId];s!==6&&this.logAndCreateError("invalid farm version ",s);let a=fe((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),u=o!=null?o:this.scope.ownerPubKey,c=this.createTxBuilder(),l=i.mint.equals(de)?new he(Re.address):i.mint,m=nr({programId:new he(n.programId),poolId:new he(n.id),mint:l,type:"rewardVault"}),{rewardPubKey:p,newInstruction:d}=await this._getUserRewardInfo({rewardInfo:i,payer:u});return d&&c.addInstruction(d),p||this.logAndCreateError("annot found target token accounts",this.scope.account.tokenAccounts),i.mint=l,c.addInstruction({instructions:[ho({payer:this.scope.ownerPubKey,userRewardTokenPub:p,farmKeys:a,rewardVault:m,rewardInfo:i})],instructionTypes:[_.FarmV6CreatorAddReward]}).versionBuild({txVersion:t})}async addNewRewardsToken(e){let{txVersion:t,farmInfo:n,newRewardInfos:i,payer:o}=e,s=yt[n.programId];s!==6&&this.logAndCreateError("invalid farm version ",s);let a=fe((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),u=o!=null?o:this.scope.ownerPubKey,c=this.createTxBuilder();for(let l of i){let m=l.mint.equals(de)?new he(Re.address):l.mint,p=nr({programId:new he(n.programId),poolId:new he(n.id),mint:m,type:"rewardVault"}),{rewardPubKey:d,newInstruction:y}=await this._getUserRewardInfo({rewardInfo:l,payer:u});y&&c.addInstruction(y),d||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let f=ho({payer:this.scope.ownerPubKey,userRewardTokenPub:d,farmKeys:a,rewardVault:p,rewardInfo:D(M({},l),{mint:m})});c.addInstruction({instructions:[f],instructionTypes:[_.FarmV6CreatorAddReward]})}return c.versionBuild({txVersion:t})}async deposit(e){let{txVersion:t,farmInfo:n,amount:i,feePayer:o,useSOLBalance:s,associatedOnly:a=!0,checkCreateATAOwner:u=!1,userAuxiliaryLedgers:c,computeBudgetConfig:l}=e;this.scope.availability.addFarm===!1&&this.logAndCreateError("farm deposit feature disabled in your region");let{rewardInfos:m,programId:p}=n,d=yt[p];co(d)||this.logAndCreateError("invalid farm program:",n.programId);let[y,f]=[new he(n.programId),new he(n.id)],b=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],w=tt({programId:y,poolId:f,owner:this.scope.ownerPubKey,version:d}),h=this.createTxBuilder();h.addCustomComputeBudget(l);let A={};for(let W of this.scope.account.tokenAccounts)if(a){let te=Ae(this.scope.ownerPubKey,W.mint,W.programId).publicKey;W.publicKey&&te.equals(W.publicKey)&&(A[W.mint.toString()]=W.publicKey)}else A[W.mint.toString()]=W.publicKey;let P=b.lpMint,T=A[P.address];T||this.logAndCreateError("you don't have any lp","lp zero",A);let I=[];for(let W of m){let te=s&&W.mint.address===ee.toString(),Q=A[W.mint.address];if(!Q){let{account:ne,instructionParams:ut}=await this.scope.account.getOrCreateTokenAccount({mint:new he(W.mint.address),notUseTokenAccount:te,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!te,associatedOnly:te?!1:a,checkCreateATAOwner:u});Q=ne,ut&&h.addInstruction(ut)}A[W.mint.address]=Q,I.push(Q)}let x,O=await this.scope.connection.getAccountInfo(w);if(O&&(x=ni(d).decode(O.data)),n.programId!==Tn.toString()&&!x){let{instruction:W,instructionType:te}=ba({id:f,programId:y,version:d,ledger:w,owner:this.scope.ownerPubKey});h.addInstruction({instructions:[W],instructionTypes:[te]})}let N=lo({version:d,rewardInfos:m,rewardTokenAccountsPublicKeys:I});N&&this.logAndCreateError(N);let L={amount:q(i),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:b,lpAccount:T,rewardAccounts:I,userAuxiliaryLedgers:c==null?void 0:c.map(W=>new he(W))},E=d===6?ha(L):d===5?Aa(L):ka(L),J={3:_.FarmV3Deposit,5:_.FarmV5Deposit,6:_.FarmV6Deposit};return h.addInstruction({instructions:[E],instructionTypes:[J[d]]}).versionBuild({txVersion:t})}async withdraw(e){let{txVersion:t,farmInfo:n,amount:i,deposited:o,useSOLBalance:s,feePayer:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,userAuxiliaryLedgers:l,computeBudgetConfig:m}=e,{rewardInfos:p}=n;this.scope.availability.removeFarm===!1&&this.logAndCreateError("farm withdraw feature disabled in your region");let d=yt[n.programId];co(d)||this.logAndCreateError("invalid farm program:",n.programId);let y=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],f=this.createTxBuilder();f.addCustomComputeBudget(m);let b={};for(let N of this.scope.account.tokenAccounts)if(u){let L=Ae(this.scope.ownerPubKey,N.mint).publicKey;N.publicKey&&L.equals(N.publicKey)&&(b[N.mint.toString()]=N.publicKey)}else b[N.mint.toString()]=N.publicKey;if(o)o.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id});else{let N=tt({programId:new he(n.programId),poolId:new he(n.id),owner:this.scope.ownerPubKey,version:d}),L=await this.scope.connection.getAccountInfo(N);L||this.logAndCreateError("no lp data",{farmId:n.id,version:d,ledgerData:L}),ni(d).decode(L.data).deposited.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id})}let w=y.lpMint.address,h=s&&w===ee.toString(),A=b[w.toString()];if(!A){let{account:N,instructionParams:L}=await this.scope.account.getOrCreateTokenAccount({mint:new he(w),notUseTokenAccount:h,createInfo:{payer:a||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:h?!1:u,checkCreateATAOwner:c});A=N,L&&f.addInstruction(L)}b[w.toString()]=A;let P=[];for(let N of p){let L=s&&N.mint.address===ee.toString(),E=b[N.mint.address];if(!E){let{account:J,instructionParams:W}=await this.scope.account.getOrCreateTokenAccount({mint:new he(N.mint.address),notUseTokenAccount:L,createInfo:{payer:a||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!L,associatedOnly:L?!1:u,checkCreateATAOwner:c});E=J,W&&f.addInstruction(W)}b[N.mint.address]=E,P.push(E)}let T=lo({version:d,rewardInfos:p,rewardTokenAccountsPublicKeys:P});T&&this.logAndCreateError(T);let I={amount:q(i),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:y,lpAccount:A,rewardAccounts:P,userAuxiliaryLedgers:l==null?void 0:l.map(N=>new he(N))},x=d===6?or(I):d===5?sr(I):ar(I),O={3:_.FarmV3Withdraw,5:_.FarmV5Withdraw,6:_.FarmV6Withdraw};return f.addInstruction({instructions:[x],instructionTypes:[O[d]]}).versionBuild({txVersion:t})}async withdrawFarmReward({farmInfo:e,withdrawMint:t,txVersion:n}){var d;this.scope.checkOwner();let i=fe((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),o=yt[e.programId];o!==6&&this.logAndCreateError("invalid farm version",o);let s=e.rewardInfos.findIndex(y=>y.mint.address===de.toString()?new he(Re.address):t),a=i.rewardInfos[s];a||this.logAndCreateError("withdraw mint error","rewardInfos",e);let u=(d=a==null?void 0:a.vault)!=null?d:de,c=this.createTxBuilder(),l;if(t.equals(de)){let y=await ht({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:wo(D(M({},a),{perSecond:new F(a.perSecond).mul(10**a.mint.decimals).toString()}))});l=y.addresses.newAccount,c.addInstruction(y)}else{let y=await this.scope.account.getCreatedTokenAccount({mint:t});y===null?(l=await this.scope.account.getAssociatedTokenAccount(t),c.addInstruction({instructions:[Em(this.scope.ownerPubKey,l,this.scope.ownerPubKey,t)],instructionTypes:[_.CreateATA]})):l=y}let{instruction:m,instructionType:p}=wa({programId:i.programId,id:i.id,authority:i.authority,lpVault:i.lpVault,rewardVault:u,userRewardToken:l,owner:this.scope.ownerPubKey});return c.addInstruction({instructions:[m],instructionTypes:[p]}).versionBuild({txVersion:n})}async harvestAllRewards(e){let{farmInfoList:t,useSOLBalance:n,feePayer:i,associatedOnly:o=!0,checkCreateATAOwner:s=!1,userAuxiliaryLedgers:a,txVersion:u,computeBudgetConfig:c}=e,l=this.createTxBuilder();l.addCustomComputeBudget(c);let m={};for(let y of this.scope.account.tokenAccounts)if(o){let f=Ae(this.scope.ownerPubKey,y.mint).publicKey;y.publicKey&&f.equals(y.publicKey)&&(m[y.mint.toString()]=y.publicKey)}else m[y.mint.toString()]=y.publicKey;let d=(await this.scope.api.fetchFarmKeysById({ids:Object.values(t).map(y=>y.id).join(",")})).reduce((y,f)=>D(M({},y),{[f.id]:f}),{});for(let y of Object.values(t)){let{programId:f,lpMint:b,rewardInfos:w,id:h}=y,A=yt[f],P=b.address,T=n&&P===ee.toString(),I=m[P];if(!I){let{account:J,instructionParams:W}=await this.scope.account.getOrCreateTokenAccount({mint:new he(P),notUseTokenAccount:T,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:T?!1:o,checkCreateATAOwner:s});I=J,W&&l.addInstruction(W)}m[P.toString()]=I;let x=[];for(let J of w){let W=n&&J.mint.address===ee.toString(),te=m[J.mint.address];if(!te){let{account:Q,instructionParams:ne}=await this.scope.account.getOrCreateTokenAccount({mint:new he(J.mint.address),notUseTokenAccount:W,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!W,associatedOnly:W?!1:o,checkCreateATAOwner:s});te=Q,ne&&l.addInstruction(ne)}m[J.mint.address]=te,x.push(te)}let O=d[h],N={amount:Se,owner:this.scope.ownerPubKey,farmInfo:y,farmKeys:O,lpAccount:I,rewardAccounts:x,userAuxiliaryLedgers:a==null?void 0:a.map(J=>new he(J))},L=A===6?or(N):A===5?sr(N):ar(N),E={3:_.FarmV3Withdraw,5:_.FarmV5Withdraw,6:_.FarmV6Withdraw};l.addInstruction({instructions:[L],instructionTypes:[E[A]]})}return u===1?l.sizeCheckBuild():l.sizeCheckBuildV0()}};import{PublicKey as Jt}from"@solana/web3.js";import{NATIVE_MINT as eu,TOKEN_PROGRAM_ID as ci}from"@solana/spl-token";var Gk=R([Ue("mintAuthorityOption"),B("mintAuthority"),g("supply"),V("decimals"),V("isInitialized"),Ue("freezeAuthorityOption"),B("freezeAuthority")]);import{PublicKey as vm}from"@solana/web3.js";import{MintLayout as Pa,TOKEN_PROGRAM_ID as Wm}from"@solana/spl-token";var Jk=async({connection:r,mint:e})=>{let t=await r.getAccountInfo(new vm(e));return!t||t.data.length!==Pa.span?void 0:Pa.decode(t.data)},$k=({mint:r,decimals:e,programId:t=Wm,logoURI:n="",priority:i=3})=>{let o=r.toBase58().substring(0,6);return{address:r.toBase58(),decimals:e,symbol:o,logoURI:n,extensions:{},chainId:101,programId:t.toString(),name:o,tags:[],priority:i}},Ta=r=>new oe({mint:r.address,decimals:r.decimals,symbol:r.symbol,name:r.name}),eA=i=>{var o=i,{amount:r,isRaw:e,name:t}=o,n=_e(o,["amount","isRaw","name"]);return new pe(new oe({mint:n.address,decimals:n.decimals,symbol:n.symbol,name:t}),r,e,t)};function tA(r){return r.address===Qe.address?Re:r}function nA(r){return r.address===Re.address?Qe:r}import{TOKEN_PROGRAM_ID as cr,ASSOCIATED_TOKEN_PROGRAM_ID as td}from"@solana/spl-token";import{PublicKey as ye,TransactionInstruction as _t,SystemProgram as Ko,SYSVAR_RENT_PUBKEY as nd}from"@solana/web3.js";var Po=R([V("instruction"),g("amountIn"),g("minAmountOut")]),To=R([V("instruction"),g("maxAmountIn"),g("amountOut")]),mA=R([V("instruction"),V("nonce")]),Io=R([V("instruction"),V("nonce"),g("startTime")]),Dm=R([g("status"),g("nonce"),g("maxOrder"),g("depth"),g("baseDecimal"),g("quoteDecimal"),g("state"),g("resetFlag"),g("minSize"),g("volMaxCutRatio"),g("amountWaveRatio"),g("baseLotSize"),g("quoteLotSize"),g("minPriceMultiplier"),g("maxPriceMultiplier"),g("systemDecimalValue"),g("minSeparateNumerator"),g("minSeparateDenominator"),g("tradeFeeNumerator"),g("tradeFeeDenominator"),g("pnlNumerator"),g("pnlDenominator"),g("swapFeeNumerator"),g("swapFeeDenominator"),g("baseNeedTakePnl"),g("quoteNeedTakePnl"),g("quoteTotalPnl"),g("baseTotalPnl"),g("poolOpenTime"),g("punishPcAmount"),g("punishCoinAmount"),g("orderbookToInitTime"),z("swapBaseInAmount"),z("swapQuoteOutAmount"),g("swapBase2QuoteFee"),z("swapQuoteInAmount"),z("swapBaseOutAmount"),g("swapQuote2BaseFee"),B("baseVault"),B("quoteVault"),B("baseMint"),B("quoteMint"),B("lpMint"),B("openOrders"),B("marketId"),B("marketProgramId"),B("targetOrders"),B("withdrawQueue"),B("lpVault"),B("owner"),g("lpReserve"),U(g(),3,"padding")]),qm=R([g("accountType"),g("status"),g("nonce"),g("maxOrder"),g("depth"),g("baseDecimal"),g("quoteDecimal"),g("state"),g("resetFlag"),g("minSize"),g("volMaxCutRatio"),g("amountWaveRatio"),g("baseLotSize"),g("quoteLotSize"),g("minPriceMultiplier"),g("maxPriceMultiplier"),g("systemDecimalsValue"),g("abortTradeFactor"),g("priceTickMultiplier"),g("priceTick"),g("minSeparateNumerator"),g("minSeparateDenominator"),g("tradeFeeNumerator"),g("tradeFeeDenominator"),g("pnlNumerator"),g("pnlDenominator"),g("swapFeeNumerator"),g("swapFeeDenominator"),g("baseNeedTakePnl"),g("quoteNeedTakePnl"),g("quoteTotalPnl"),g("baseTotalPnl"),g("poolOpenTime"),g("punishPcAmount"),g("punishCoinAmount"),g("orderbookToInitTime"),z("swapBaseInAmount"),z("swapQuoteOutAmount"),z("swapQuoteInAmount"),z("swapBaseOutAmount"),g("swapQuote2BaseFee"),g("swapBase2QuoteFee"),B("baseVault"),B("quoteVault"),B("baseMint"),B("quoteMint"),B("lpMint"),B("modelDataAccount"),B("openOrders"),B("marketId"),B("marketProgramId"),B("targetOrders"),B("owner"),U(g(),64,"padding")]),xo=R([V("instruction"),g("baseAmountIn"),g("quoteAmountIn"),g("fixedSide")]),Bo=R([V("instruction"),g("amountIn")]),dA={4:Dm,5:qm},Ia=R([g("fee")]);import{PublicKey as Um}from"@solana/web3.js";var Cn=new Um("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),un=5e4,Gm=R([g("x"),g("y"),g("price")]),Xm=R([g("accountType"),g("status"),g("multiplier"),g("validDataCount"),U(Gm,un,"DataElement")]);function zm(r,e){return[0,un-2]}function Ym(r){return[0,un-2]}function Qm(r){return[0,un-2]}function jm(r,e,t){let[n,i]=zm(e,t),o=n,s=i,a=0,u=e*r.multiplier/t;for(;o<=s;){if(a=Math.floor((s+o)/2),a===0||a>=un-2)return[a,a,!1];let c=r.DataElement[a].x*r.multiplier/r.DataElement[a].y,l=r.DataElement[a-1].x*r.multiplier/r.DataElement[a-1].y,m=r.DataElement[a+1].x*r.multiplier/r.DataElement[a+1].y;if(u===c)return[a,a,!0];if(u===l)return[a-1,a-1,!0];if(u===m)return[a+1,a+1,!0];if(u<l)s=a-1;else{if(u>l&&u<c)return[a-1,a,!0];if(u>c&&u<m)return[a,a+1,!0];o=a+1}}return[a,a,!1]}function So(r,e,t){let[n,i,o]=jm(r,e,t);if(!o)return 0;if(n===i){let s=r.DataElement[n].x;return e*r.multiplier/s}else{let s=r.DataElement[n].x,a=r.DataElement[n].y,u=r.DataElement[i].x,c=r.DataElement[i].y,l=t*(u*a-s*c),m=s*l,p=(u-s)*(e*a-s*t)*c,d=m+p;return e*r.multiplier*l/d}}function an(r,e,t){return e*r.multiplier/t}function xa(r,e,t){return e*t/r.multiplier}function Hm(r,e){let[t,n]=Ym(e),i=t,o=n,s=0,a=e;for(;i<o;){if(s=Math.floor((o+i)/2),s<=0||s>un-2)return[s,s,!1];let u=r.DataElement[s].x,c=r.DataElement[s-1].x,l=r.DataElement[s+1].x;if(a===u)return[s,s,!0];if(a===c)return[s-1,s-1,!0];if(a===l)return[s+1,s+1,!0];if(a<c)o=s-1;else{if(a>c&&a<u)return[s-1,s,!0];if(a>u&&a<l)return[s,s+1,!0];i=s+1}}return[s,s,!1]}function Zm(r,e){let[t,n]=Qm(e),i=t,o=n,s=0,a=e;for(;i<=o;){if(s=Math.floor((o+i)/2),s<=0||s>=un-2)return[s,s,!1];let u=r.DataElement[s].y,c=r.DataElement[s-1].y,l=r.DataElement[s+1].y;if(a===u)return[s,s,!0];if(a===c)return[s-1,s-1,!0];if(a===l)return[s+1,s+1,!0];if(a<l)i=s+1;else{if(a<c&&a>u)return[s-1,s,!0];if(a<u&&a>l)return[s,s+1,!0];o=s-1}}return[s,s,!1]}function Ba(r,e,t,n){let i=n?e+t:e-t,[o,s,a]=Hm(r,i);if(!a)return[0,0,!1,a];if(o===s)return[r.DataElement[s].price,r.DataElement[s].y,!1,a];{let u=r.DataElement[o].x,c=r.DataElement[s].x,l=r.DataElement[o].price,m=r.DataElement[s].price,p=r.DataElement[o].y,d=r.DataElement[s].y;if(e>=u&&e<=c)return n?[m,d,!0,a]:[l,p,!0,a];{let y,f;return n?(y=l+(m-l)*(e-u)/(c-u),f=p-(i-u)*r.multiplier/m):(y=l+(m-l)*(e-u)/(c-u),f=d+(c-i)*r.multiplier/l),[y,f,!1,a]}}}function Jm(r,e,t,n){let i=n?e-t:e+t,[o,s,a]=Zm(r,i);if(!a)return[0,0,!1,a];if(o===s)return[r.DataElement[s].price,r.DataElement[s].x,!1,a];{let u=r.DataElement[o].x,c=r.DataElement[s].x,l=r.DataElement[o].price,m=r.DataElement[s].price,p=r.DataElement[o].y,d=r.DataElement[s].y;if(e>=d&&e<=p)return n?[m,c,!0,a]:[l,u,!0,a];{let y,f;return n?(y=l+(m-l)*(p-e)/(p-d),f=u+m*(p-i)/r.multiplier):(y=l+(m-l)*(p-e)/(p-d),f=c-l*(i-d)/r.multiplier),[y,f,!1,a]}}}function $m(r,e){let t=Ba(r,e,0,!1);return t[3]?t[0]:0}function gA(r,e,t,n){let i=So(r,e,t),o=an(r,e,i),s=an(r,t,i),a=an(r,n,i),u=!0,[c,l,m,p]=Ba(r,o,a,u);if(!p)return 0;if(m)return n*r.multiplier/c;{let d=s-l;return xa(r,d,i)}}function wA(r,e,t,n){let i=So(r,e,t),o=an(r,e,i),s=an(r,t,i),a=an(r,n,i),u=!1,[c,l,m,p]=Jm(r,s,a,u);if(!p)return 0;if(m)return n*c/r.multiplier;{let d=o-l;return xa(r,d,i)}}function ed(r){let e=Xm.decode(r);return{accountType:e.accountType.toNumber(),status:e.status.toNumber(),multiplier:e.multiplier.toNumber(),validDataCount:e.validDataCount.toNumber(),DataElement:e.DataElement.map(t=>({x:t.x.toNumber(),y:t.y.toNumber(),price:t.price.toNumber()}))}}function kA(r,e,t,n){let i=$m(r,an(r,e,So(r,e,t)))/r.multiplier;return n?i:1/i}var ii=class{constructor({connection:e}){this._layoutData={accountType:0,status:0,multiplier:0,validDataCount:0,DataElement:[]};this.connection=e}get stableModelData(){return this._layoutData}async initStableModelLayout(){if(this._layoutData.validDataCount===0&&this.connection){let e=await this.connection.getAccountInfo(Cn);e&&(this._layoutData=ed(e==null?void 0:e.data))}}};var Sa=se("Raydium_liquidity_instruction");function Ka(r){let{poolInfo:e,poolKeys:t,userKeys:n,baseAmountIn:i,quoteAmountIn:o,fixedSide:s}=r,a=Buffer.alloc(xo.span);xo.encode({instruction:3,baseAmountIn:q(i),quoteAmountIn:q(o),fixedSide:s==="base"?Se:Vr},a);let u=[k({pubkey:cr,isWritable:!1}),k({pubkey:new ye(e.id)}),k({pubkey:new ye(t.authority),isWritable:!1}),k({pubkey:new ye(t.openOrders),isWritable:!1}),k({pubkey:new ye(t.targetOrders)}),k({pubkey:new ye(e.lpMint.address)}),k({pubkey:new ye(t.vault.A)}),k({pubkey:new ye(t.vault.B)})];return e.pooltype.includes("StablePool")&&u.push(k({pubkey:Cn})),u.push(k({pubkey:new ye(e.marketId),isWritable:!1}),k({pubkey:n.baseTokenAccount}),k({pubkey:n.quoteTokenAccount}),k({pubkey:n.lpTokenAccount}),k({pubkey:n.owner,isWritable:!1,isSigner:!0}),k({pubkey:new ye(t.marketEventQueue),isWritable:!1})),new _t({programId:new ye(e.programId),keys:u,data:a})}function Co(r){let{poolInfo:e,poolKeys:t,userKeys:n,amountIn:i}=r,o=fe(t),s=4;if(e.pooltype.includes("StablePool")&&(s=5),s===4||s===5){let a=Buffer.alloc(Bo.span);Bo.encode({instruction:4,amountIn:q(i)},a);let u=[k({pubkey:cr,isWritable:!1}),k({pubkey:o.id}),k({pubkey:o.authority,isWritable:!1}),k({pubkey:o.openOrders}),k({pubkey:o.targetOrders}),k({pubkey:o.mintLp.address}),k({pubkey:o.vault.A}),k({pubkey:o.vault.B})];return s===5?u.push(k({pubkey:Cn})):(u.push(k({pubkey:o.withdrawQueue})),u.push(k({pubkey:o.vault.Lp}))),u.push(k({pubkey:o.marketProgramId,isWritable:!1}),k({pubkey:o.marketId}),k({pubkey:o.marketBaseVault}),k({pubkey:o.marketQuoteVault}),k({pubkey:o.marketAuthority,isWritable:!1}),k({pubkey:n.lpTokenAccount}),k({pubkey:n.baseTokenAccount}),k({pubkey:n.quoteTokenAccount}),k({pubkey:n.owner,isWritable:!1,isSigner:!0}),k({pubkey:o.marketEventQueue}),k({pubkey:o.marketBids}),k({pubkey:o.marketAsks})),new _t({programId:o.programId,keys:u,data:a})}return new _t({programId:o.programId,keys:[]})}function Ca({programId:r,ammId:e,ammAuthority:t,ammOpenOrders:n,lpMint:i,coinMint:o,pcMint:s,coinVault:a,pcVault:u,withdrawQueue:c,ammTargetOrders:l,poolTempLp:m,marketProgramId:p,marketId:d,userWallet:y,userCoinVault:f,userPcVault:b,userLpVault:w,nonce:h,openTime:A,coinAmount:P,pcAmount:T,ammConfigId:I,feeDestinationId:x}){let O=R([V("instruction"),V("nonce"),g("openTime"),g("pcAmount"),g("coinAmount")]),N=[{pubkey:cr,isSigner:!1,isWritable:!1},{pubkey:td,isSigner:!1,isWritable:!1},{pubkey:Ko.programId,isSigner:!1,isWritable:!1},{pubkey:it,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:I,isSigner:!1,isWritable:!1},{pubkey:x,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!0,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:w,isSigner:!1,isWritable:!0}],L=Buffer.alloc(O.span);return O.encode({instruction:1,nonce:h,openTime:A,coinAmount:P,pcAmount:T},L),{instruction:new _t({keys:N,programId:r,data:L}),instructionType:_.AmmV4CreatePool}}function LA(r){let e=R([V("instruction"),V("simulateType")]),t=Buffer.alloc(e.span);e.encode({instruction:12,simulateType:0},t);let n=[k({pubkey:new ye(r.id),isWritable:!1}),k({pubkey:new ye(r.authority),isWritable:!1}),k({pubkey:new ye(r.openOrders),isWritable:!1}),k({pubkey:new ye(r.vault.A),isWritable:!1}),k({pubkey:new ye(r.vault.B),isWritable:!1}),k({pubkey:new ye(r.mintLp.address),isWritable:!1}),k({pubkey:new ye(r.marketId),isWritable:!1}),k({pubkey:new ye(r.marketEventQueue),isWritable:!1})];return new _t({programId:new ye(r.programId),keys:n,data:t})}function rd({poolKeys:r,userKeys:e,amountIn:t,minAmountOut:n},i){let o=fe(r),s=Buffer.alloc(Po.span);Po.encode({instruction:9,amountIn:q(t),minAmountOut:q(n)},s);let a=[k({pubkey:cr,isWritable:!1}),k({pubkey:o.id}),k({pubkey:o.authority,isWritable:!1}),k({pubkey:o.openOrders})];return i===4&&a.push(k({pubkey:o.targetOrders})),a.push(k({pubkey:o.vault.A}),k({pubkey:o.vault.B})),i===5&&a.push(k({pubkey:Cn})),a.push(k({pubkey:o.marketProgramId,isWritable:!1}),k({pubkey:o.marketId}),k({pubkey:o.marketBids}),k({pubkey:o.marketAsks}),k({pubkey:o.marketEventQueue}),k({pubkey:o.marketBaseVault}),k({pubkey:o.marketQuoteVault}),k({pubkey:o.marketAuthority,isWritable:!1}),k({pubkey:e.tokenAccountIn}),k({pubkey:e.tokenAccountOut}),k({pubkey:e.owner,isWritable:!1})),new _t({programId:o.programId,keys:a,data:s})}function id({poolKeys:r,userKeys:e,maxAmountIn:t,amountOut:n},i){let o=fe(r),s=Buffer.alloc(To.span);To.encode({instruction:11,maxAmountIn:q(t),amountOut:q(n)},s);let a=[k({pubkey:Ko.programId,isWritable:!1}),k({pubkey:o.id}),k({pubkey:o.authority,isWritable:!1}),k({pubkey:o.openOrders}),k({pubkey:o.targetOrders}),k({pubkey:o.vault.A}),k({pubkey:o.vault.B})];return i===5&&a.push(k({pubkey:Cn})),a.push(k({pubkey:o.marketProgramId,isWritable:!1}),k({pubkey:o.marketId}),k({pubkey:o.marketBids}),k({pubkey:o.marketAsks}),k({pubkey:o.marketEventQueue}),k({pubkey:o.marketBaseVault}),k({pubkey:o.marketQuoteVault}),k({pubkey:o.marketAuthority,isWritable:!1}),k({pubkey:e.tokenAccountIn}),k({pubkey:e.tokenAccountOut}),k({pubkey:e.owner,isWritable:!1,isSigner:!0})),new _t({programId:o.programId,keys:a,data:s})}function Ra(r){let{poolKeys:e,version:t,userKeys:n,amountIn:i,amountOut:o,fixedSide:s}=r;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return rd(D(M({},a),{amountIn:i,minAmountOut:o}),t);if(s==="out")return id(D(M({},a),{maxAmountIn:i,amountOut:o}),t);Sa.logWithError("invalid params","params",r)}throw Sa.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}function OA({poolKeys:r,userKeys:e,startTime:t}){let n=Buffer.alloc(Io.span);Io.encode({instruction:0,nonce:5,startTime:q(t)},n);let i=fe(r),o=[k({pubkey:cr,isWritable:!1}),k({pubkey:Ko.programId,isWritable:!1}),k({pubkey:nd,isWritable:!1}),k({pubkey:i.id}),k({pubkey:i.authority,isWritable:!1}),k({pubkey:i.openOrders}),k({pubkey:i.mintLp.address}),k({pubkey:i.mintA.address,isWritable:!1}),k({pubkey:i.mintB.address,isWritable:!1}),k({pubkey:i.vault.A,isWritable:!1}),k({pubkey:i.vault.B,isWritable:!1}),k({pubkey:i.withdrawQueue}),k({pubkey:i.targetOrders}),k({pubkey:e.lpTokenAccount}),k({pubkey:i.vault.Lp,isWritable:!1}),k({pubkey:i.marketProgramId,isWritable:!1}),k({pubkey:i.marketId,isWritable:!1}),k({pubkey:e.payer,isSigner:!0})];return new _t({programId:i.programId,keys:o,data:n})}function La({poolKeys:r}){let e=R([V("instruction"),V("simulateType")]),t=Buffer.alloc(e.span);e.encode({instruction:12,simulateType:0},t);let n=[k({pubkey:new ye(r.id),isWritable:!1}),k({pubkey:new ye(r.authority),isWritable:!1}),k({pubkey:new ye(r.openOrders),isWritable:!1}),k({pubkey:new ye(r.vault.A),isWritable:!1}),k({pubkey:new ye(r.vault.B),isWritable:!1}),k({pubkey:new ye(r.mintLp.address),isWritable:!1}),k({pubkey:new ye(r.marketId),isWritable:!1}),k({pubkey:new ye(r.marketEventQueue),isWritable:!1})];return{instruction:new _t({programId:new ye(r.programId),keys:n,data:t})}}import{TOKEN_PROGRAM_ID as ve,TOKEN_2022_PROGRAM_ID as Zt,ASSOCIATED_TOKEN_PROGRAM_ID as Qa}from"@solana/spl-token";import{PublicKey as v,TransactionInstruction as bt,SystemProgram as Rn,Keypair as Eo}from"@solana/web3.js";import ja from"bn.js";import yd from"bn.js";function Oa(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r,!1),new Uint8Array(e)}function MA(r){let e=new ArrayBuffer(2);return new DataView(e).setInt16(0,r,!1),new Uint8Array(e)}function _A(r){let e=new ArrayBuffer(4);return new DataView(e).setUint32(0,r,!1),new Uint8Array(e)}function oi(r){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,r,!1),new Uint8Array(e)}function Ro(r,e){let t=0;for(let n=r-1;n>=0&&!e.testn(n);n--)t++;return t}function Lo(r,e){let t=0;for(let n=0;n<r&&!e.testn(n);n++)t++;return t}function lr(r,e){for(let t=0;t<r;t++)if(e.testn(t))return!1;return!0}function Na(r,e){return lr(r,e)?null:Ro(r,e)}function Ma(r,e){return lr(r,e)?null:Lo(r,e)}var od=Buffer.from("amm_config","utf8"),sd=Buffer.from("pool","utf8"),ad=Buffer.from("pool_vault","utf8"),ud=Buffer.from("pool_reward_vault","utf8"),_a=Buffer.from("position","utf8"),cd=Buffer.from("tick_array","utf8"),ld=Buffer.from("operation","utf8"),md=Buffer.from("pool_tick_array_bitmap_extension","utf8");function vA(r,e){return le([od,Oa(e)],r)}function Va(r,e,t,n){return le([sd,e.toBuffer(),t.toBuffer(),n.toBuffer()],r)}function Oo(r,e,t){return le([ad,e.toBuffer(),t.toBuffer()],r)}function Ea(r,e,t){return le([ud,e.toBuffer(),t.toBuffer()],r)}function be(r,e,t){return le([cd,e.toBuffer(),oi(t)],r)}function cn(r,e,t,n){return le([_a,e.toBuffer(),oi(t),oi(n)],r)}function Pt(r,e){return le([_a,e.toBuffer()],r)}function si(r){return le([Buffer.from("metadata","utf8"),kn.toBuffer(),r.toBuffer()],kn)}function mr(r){return le([ld],r)}function Tt(r,e){return le([md,e.toBuffer()],r)}import It from"bn.js";var me=new It(0),Xe=new It(1),Vt=new It(-1),rt=new It(1).shln(64),ai=new It(1).shln(128),No=rt.sub(Xe),dr=64,Fa=ai.subn(1),ze=-443636,Ze=-ze,xt=new It("4295048016"),Bt=new It("79226673521066979257578248091"),va=16,Wa="59543866431248",Da="184467440737095516",qa="15793534762490258745",ui=new It(10).pow(new It(6)),dd=(n=>(n[n.rate_500=500]="rate_500",n[n.rate_3000=3e3]="rate_3000",n[n.rate_10000=1e4]="rate_10000",n))(dd||{}),qA={[500]:10,[3e3]:60,[1e4]:200},UA={version:6,liquidity:me,tickCurrent:0,observationIndex:0,observationUpdateDuration:0,feeGrowthGlobalX64A:me,feeGrowthGlobalX64B:me,protocolFeesTokenA:me,protocolFeesTokenB:me,swapInAmountTokenA:me,swapOutAmountTokenB:me,swapInAmountTokenB:me,swapOutAmountTokenA:me,tickArrayBitmap:[],rewardInfos:[],day:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},week:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},month:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},tvl:0},Ua={tvl:0,volumeQuote:0,mintAmountA:0,mintAmountB:0,rewardDefaultInfos:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,day:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},week:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},month:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},pooltype:[]},GA=new It("18446744073700000000");var pd=15,ue=class{static async getTickArrays(e,t,n,i,o,s,a){let u=[],c=G.getTickArrayStartIndexByTick(i,o),l=G.getInitializedTickArrayInRange(s,a,o,c,Math.floor(pd/2));for(let d=0;d<l.length;d++){let{publicKey:y}=be(t,n,l[d]);u.push(y)}let m=(await kt(e,u)).map(d=>d!==null?pr.decode(d.data):null),p={};for(let d=0;d<u.length;d++){let y=m[d];y!==null&&(p[y.startTickIndex]=D(M({},y),{address:u[d]}))}return p}static nextInitializedTick(e,t,n,i,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,i,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=G.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:p,tickArrayStartTickIndex:d}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,p,d]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,i,o){let s=Math.floor(e/ue.tickCount(t)),a=n?G.searchLowBitFromStart(i,o,s-1,1,t):G.searchHightBitFromStart(i,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,i){let o;if(i){let a=Le-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<Le;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=be(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,i,o,s){let a=G.getTickArrayStartIndexByTick(i,o),u=Math.floor((i-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let p=c.ticks[u];if(p.liquidityGross.gtn(0)){l=p;break}u=u-1}else for(u=u+1;u<Le;){let p=c.ticks[u];if(p.liquidityGross.gtn(0)){l=p;break}u=u+1}let{publicKey:m}=be(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(G.checkIsOutOfBoundary(e)){if(e>Ze)return!1;let n=G.getTickArrayStartIndexByTick(ze,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return Le*e}};import re from"bn.js";import{PublicKey as Ga}from"@solana/web3.js";import Be from"bn.js";var Mo=14,Et=class{static maxTickInTickarrayBitmap(e){return e*Le*ln}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(i+=1);let o=n*i;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,i){if(!ue.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=i?t-ue.tickCount(n):t+ue.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*Le,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(i){let l=e.shln(1024-c-1),m=Na(1024,l);if(m!==null){let p=(c-m-512)*a;return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=Ma(1024,l);if(m!==null){let p=(c+m-512)*a;return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:o-ue.tickCount(n)}}}},fr=class{static getBitmapOffset(e,t){if(!ue.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=Et.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&i--,i}static getBitmap(e,t,n){let i=this.getBitmapOffset(e,t);return e<0?{offset:i,tickarrayBitmap:n.negativeTickArrayBitmap[i]}:{offset:i,tickarrayBitmap:n.positiveTickArrayBitmap[i]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:i}=this.extensionTickBoundary(t);if(e>=i&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=Et.maxTickInTickarrayBitmap(e),n=-t;if(Ze<=t)throw Error(`extensionTickBoundary check error: ${Ze}, ${t}`);if(n<=ze)throw Error(`extensionTickBoundary check error: ${n}, ${ze}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:i}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:G.mergeTickArrayBitmap(i).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,i){let o=ue.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,i);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,i){let{minValue:o,maxValue:s}=Et.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(i){let u=G.mergeTickArrayBitmap(e).shln(ln-1-a),c=lr(512,u)?null:Ro(512,u);if(c!==null){let l=t-c*ue.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=G.mergeTickArrayBitmap(e).shrn(a),c=lr(512,u)?null:Lo(512,u);if(c!==null){let l=t+c*ue.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-ue.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%Et.maxTickInTickarrayBitmap(t),i=Math.floor(n/ue.tickCount(t));return e<0&&n!=0&&(i=ln-i),i}};import St from"bn.js";var yr=class{static getfeeGrowthInside(e,t,n){let i=new St(0),o=new St(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new St(0),a=new St(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=Z.wrappingSubU128(Z.wrappingSubU128(e.feeGrowthGlobalX64A,i),s),c=Z.wrappingSubU128(Z.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=Z.mulDivFloor(Z.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,rt),u=t.tokenFeesOwedA.add(a),c=Z.mulDivFloor(Z.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,rt),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=Z.mulDivFloor(Z.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,rt),u=t.tokenFeesOwedA.add(a),c=Z.mulDivFloor(Z.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,rt),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,i){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=Z.wrappingSubU128(u,c.growthInsideLastX64),m=Z.mulDivFloor(l,t.liquidity,rt),p=c.rewardAmountOwed.add(m);o.push(p)}return o}static GetPositionRewards(e,t,n,i){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=Z.wrappingSubU128(u,c.growthInsideLastX64),m=Z.mulDivFloor(l,t.liquidity,rt),p=c.rewardAmountOwed.add(m);o.push(p)}return o}static getRewardGrowthInside(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new St(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new St(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(Z.wrappingSubU128(Z.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new St(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new St(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(Z.wrappingSubU128(Z.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:o,epochInfo:s}){var b,w,h,A;let a=H.priceToSqrtPriceX64(new F(e.price),e.mintA.decimals,e.mintB.decimals),u=H.getSqrtPriceX64FromTick(t.tickLower),c=H.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+i:1-i,m=ae.getAmountsFromLiquidity(a,u,c,n,o),[p,d]=[Oe(m.amountA,(b=e.mintA.extensions)==null?void 0:b.feeConfig,s,!0),Oe(m.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)],[y,f]=[Oe(new St(new F(m.amountA.toString()).mul(l).toFixed(0)),(h=e.mintA.extensions)==null?void 0:h.feeConfig,s,!0),Oe(new St(new F(m.amountB.toString()).mul(l).toFixed(0)),(A=e.mintB.extensions)==null?void 0:A.feeConfig,s,!0)];return{liquidity:n,amountA:p,amountB:d,amountSlippageA:y,amountSlippageB:f,expirationTime:rn(p.expirationTime,d.expirationTime)}}};var Fe=class{static getOutputAmountAndRemainAccounts(e,t,n,i,o){let s=n.equals(e.mintA.mint),a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");a.push(l);let{amountCalculated:m,accounts:p,sqrtPriceX64:d,feeAmount:y}=mn.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i,c,o);return a.push(...p),{expectedAmountOut:m.mul(Vt),remainingAccounts:a,executionPrice:d,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,i,o){let s=n.equals(e.mintB.mint),a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:b}=be(e.programId,e.id,f.nextStartIndex);a.push(b)}}catch{}a.push(l);let{amountCalculated:m,accounts:p,sqrtPriceX64:d,feeAmount:y}=mn.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i.mul(Vt),c,o);return a.push(...p),{expectedAmountIn:m,remainingAccounts:a,executionPrice:d,feeAmount:y}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:i}=Fe.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?fr.checkTickArrayIsInit(ue.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):G.checkTickArrayIsInitialized(G.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=be(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,ue.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=be(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/ue.tickCount(e.tickSpacing)),i=t?G.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):G.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=ue.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:i,tickIndex:o}=Et.nextInitializedTickArrayStartIndex(G.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(i)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=fr.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<ze||t>Ze)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:i,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],p=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(p===void 0)throw Error("get new reward mint info error");let d=D(M({},m),{perSecond:Z.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Ga(p)});if(d.tokenMint.equals(Ga.default))continue;if(n<=d.openTime.toNumber()||i.eq(me)){s.push(d);continue}let y=new Be(Math.min(d.endTime.toNumber(),n)),f=y.sub(d.lastUpdateTime),b=Z.mulDivFloor(f,d.emissionsPerSecondX64,i),w=d.rewardGrowthGlobalX64.add(b),h=Z.mulDivFloor(f,d.emissionsPerSecondX64,rt),A=d.rewardTotalEmissioned.add(h);s.push(D(M({},d),{rewardGrowthGlobalX64:w,rewardTotalEmissioned:A,lastUpdateTime:y}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:i}=this.tickRange(e);for(let o of t){let s=G.getTickArrayStartIndexByTick(o,e);if(s>=n||s<i)return!0}return!1}static tickRange(e){let t=Et.maxTickInTickarrayBitmap(e),n=-t;return t>Ze&&(t=ue.getArrayStartIndex(Ze,e)+ue.tickCount(e)),n<ze&&(n=ue.getArrayStartIndex(ze,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!ue.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/ue.tickCount(t)*ln}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let i=await Pn(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of i)s.accountInfo!==null&&(o[s.pubkey.toString()]=za.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let i={},o=[];for(let u of t){let c=G.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=G.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:p}=be(u.programId,u.id,m);o.push({pubkey:p}),i[p.toString()]=u.id}}let s=await Pn(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=i[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=pr.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]=D(M({},l),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:i=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(p=>p.accountInfo.mint),c=[];for(let p of u)for(let d of s)c.push(Pt(d,p).publicKey);let l=await kt(t,c,{batchRequest:i}),m={};for(let p of l){if(p===null)continue;let d=Xa.decode(p.data),y=d.poolId.toString(),f=e.find(O=>O.state.id.toBase58()===y);if(f===void 0)continue;let b=f.state,w=G._getTickPriceLegacy({poolInfo:b,tick:d.tickLower,baseIn:!0}),h=G._getTickPriceLegacy({poolInfo:b,tick:d.tickUpper,baseIn:!0}),{amountA:A,amountB:P}=ae.getAmountsFromLiquidity(b.sqrtPriceX64,w.tickSqrtPriceX64,h.tickSqrtPriceX64,d.liquidity,!1),T=1/(1-Math.sqrt(Math.sqrt(w.price.div(h.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:d.poolId,nftMint:d.nftMint,priceLower:w.price,priceUpper:h.price,amountA:A,amountB:P,tickLower:d.tickLower,tickUpper:d.tickUpper,liquidity:d.liquidity,feeGrowthInsideLastX64A:d.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:d.feeGrowthInsideLastX64B,tokenFeesOwedA:d.tokenFeesOwedA,tokenFeesOwedB:d.tokenFeesOwedB,rewardInfos:d.rewardInfos.map(O=>D(M({},O),{pendingReward:new Be(0)})),leverage:T,tokenFeeAmountA:new Be(0),tokenFeeAmountB:new Be(0)}];let I=await G.getTickArrayAddressByTick(f.state.programId,d.poolId,d.tickLower,f.state.tickSpacing),x=await G.getTickArrayAddressByTick(f.state.programId,d.poolId,d.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${d.poolId.toString()}-${d.tickLower}`]=I,m[`${f.state.programId.toString()}-${d.poolId.toString()}-${d.tickUpper}`]=x}if(o){let p=Object.values(m),d=await kt(t,p,{batchRequest:i}),y={};for(let f=0;f<p.length;f++){let b=d[f];if(b===null)continue;let w=p[f].toString();y[w]=pr.decode(b.data)}for(let{state:f,positionAccount:b}of e)if(!!b)for(let w of b){let h=`${f.programId.toString()}-${f.id.toString()}-${w.tickLower}`,A=`${f.programId.toString()}-${f.id.toString()}-${w.tickUpper}`,P=y[m[h].toString()],T=y[m[A].toString()],I=P.ticks[G.getTickOffsetInArray(w.tickLower,f.tickSpacing)],x=T.ticks[G.getTickOffsetInArray(w.tickUpper,f.tickSpacing)],{tokenFeeAmountA:O,tokenFeeAmountB:N}=await yr.GetPositionFees(f,w,I,x),L=await yr.GetPositionRewards(f,w,I,x);w.tokenFeeAmountA=O.gte(new Be(0))?O:new Be(0),w.tokenFeeAmountB=N.gte(new Be(0))?N:new Be(0);for(let E=0;E<L.length;E++)w.rewardInfos[E].pendingReward=L[E].gte(new Be(0))?L[E]:new Be(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,token2022Infos:i,epochInfo:o,amountIn:s,slippage:a,priceLimit:u=new F(0)}){var N,L,E,J;let c;u.equals(new F(0))?c=n.equals(e.mintA.mint)?xt.add(new Be(1)):Bt.sub(new Be(1)):c=H.priceToSqrtPriceX64(u,e.mintA.decimals,e.mintB.decimals);let l=xn(s,(N=i[n.toString()])==null?void 0:N.feeConfig,o,!1),{expectedAmountOut:m,remainingAccounts:p,executionPrice:d,feeAmount:y}=Fe.getOutputAmountAndRemainAccounts(e,t,n,l.amount.sub((L=l.fee)!=null?L:me),c),f=e.mintA.mint.equals(n)?e.mintB.mint:e.mintA.mint,b=xn(m,(E=i[f.toString()])==null?void 0:E.feeConfig,o,!1),w=H.sqrtPriceX64ToPrice(d,e.mintA.decimals,e.mintB.decimals),h=n.equals(e.mintA.mint)?w:new F(1).div(w),A=m.mul(new Be(Math.floor((1-a)*1e10))).div(new Be(1e10)),P=xn(A,(J=i[f.toString()])==null?void 0:J.feeConfig,o,!1),T=e.mintA.mint.equals(n)?e.currentPrice:new F(1).div(e.currentPrice),I=new F(h).sub(T).abs(),x=T,O=new qe(new F(I).mul(10**15).toFixed(0),new F(x).mul(10**15).toFixed(0));return{realAmountIn:l,amountOut:b,minAmountOut:P,expirationTime:rn(l.expirationTime,b.expirationTime),currentPrice:e.currentPrice,executionPrice:h,priceImpact:O,fee:y,remainingAccounts:p}}static async computeAmountOutFormat({poolInfo:e,tickArrayCache:t,token2022Infos:n,amountIn:i,tokenOut:o,slippage:s,epochInfo:a}){let u=i.token.equals(oe.WSOL)?ee:i.token.mint,c=s.numerator.toNumber()/s.denominator.toNumber(),l=o.mint.equals(de)?new oe({mint:"sol",decimals:Qe.decimals}):o,{realAmountIn:m,amountOut:p,minAmountOut:d,expirationTime:y,currentPrice:f,executionPrice:b,priceImpact:w,fee:h,remainingAccounts:A}=await Fe.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:u,amountIn:i.raw,slippage:c,token2022Infos:n,epochInfo:a}),P=D(M({},m),{amount:new pe(i.token,m.amount),fee:m.fee===void 0?void 0:new pe(i.token,m.fee)}),T=D(M({},p),{amount:new pe(l,p.amount),fee:p.fee===void 0?void 0:new pe(l,p.fee)}),I=D(M({},d),{amount:new pe(l,d.amount),fee:d.fee===void 0?void 0:new pe(l,d.fee)}),x=new De({baseToken:i.token,denominator:new Be(10).pow(new Be(20+i.token.decimals)),quoteToken:l,numerator:f.mul(new F(10**(20+l.decimals))).toFixed(0)}),O=new De({baseToken:i.token,denominator:new Be(10).pow(new Be(20+i.token.decimals)),quoteToken:l,numerator:b.mul(new F(10**(20+l.decimals))).toFixed(0)}),N=new pe(i.token,h);return{realAmountIn:P,amountOut:T,minAmountOut:I,expirationTime:y,currentPrice:x,executionPrice:O,priceImpact:w,fee:N,remainingAccounts:A}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:i}){var y,f,b;let o=e[t],s=G.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=G.getTickPrice({poolInfo:e,tick:i,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,p=o.priceMax-o.priceMin,d;return l<=0?d=0:m===l?d=p/l:p===l?d=l/m:d=l/p*(l/m),{feeApr:o.feeApr*d,rewardsApr:[(y=o.rewardApr[0])!=null?y:0*d,(f=o.rewardApr[1])!=null?f:0*d,(b=o.rewardApr[2])!=null?b:0*d],apr:o.apr*d}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:i,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=i[qt(e.mintA.address).toString()],p=i[qt(e.mintB.address).toString()],d=e.mintA.decimals,y=e.mintB.decimals;if(!l||!m||!p)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=H.priceToSqrtPriceX64(new F(e.price),e.mintA.decimals,e.mintB.decimals),b=H.getSqrtPriceX64FromTick(s),w=H.getSqrtPriceX64FromTick(a),{amountSlippageA:h,amountSlippageB:A}=ae.getAmountsFromLiquidityWithSlippage(f,b,w,t,!1,!1,0),{amountSlippageA:P,amountSlippageB:T}=ae.getAmountsFromLiquidityWithSlippage(f,b,w,o,!1,!1,0),I=new F(h.toString()).div(new F(10).pow(d)).mul(m.value).add(new F(A.toString()).div(new F(10).pow(y)).mul(p.value)),x=new F(P.toString()).div(new F(10).pow(d)).mul(m.value).add(new F(T.toString()).div(new F(10).pow(y)).mul(p.value)),O=x.div(I.add(x)).div(x),L=new F(l.volumeFee).mul(365).div(c).mul(O).mul(100).toNumber(),E=3600*24*365,J=e.rewardDefaultInfos.map(W=>{var ne,ut;let te=W.mint.decimals,Q=i[W.mint.address];return u<((ne=W.startTime)!=null?ne:0)||u>((ut=W.endTime)!=null?ut:0)||!W.perSecond||!Q||te===void 0?0:new F(Q.value).mul(new F(W.perSecond).mul(E)).div(new F(10).pow(te)).mul(O).mul(100).toNumber()});return{feeApr:L,rewardsApr:J,apr:L+J.reduce((W,te)=>W+te,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:i,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var w,h;let l=H.priceToSqrtPriceX64(new F(e.price),e.mintA.decimals,e.mintB.decimals),m=H.getSqrtPriceX64FromTick(n),p=H.getSqrtPriceX64FromTick(i),d=a?1-s:1+s,y=Oe(o,(w=e[t?"mintA":"mintB"].extensions)==null?void 0:w.feeConfig,u,!c),f=new Be(new F(y.amount.sub((h=y.fee)!=null?h:me).toString()).mul(d).toFixed(0)),b;if(l.lte(m))b=t?ae.getLiquidityFromTokenAmountA(m,p,f,!a):new Be(0);else if(l.lte(p)){let A=ae.getLiquidityFromTokenAmountA(l,p,f,!a),P=ae.getLiquidityFromTokenAmountB(m,l,f);b=t?A:P}else b=t?new Be(0):ae.getLiquidityFromTokenAmountB(m,p,f);return Fe.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:i,liquidity:b,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:i,liquidity:o,slippage:s,add:a}){var b,w,h,A;let u=H.getSqrtPriceX64FromTick(n),c=H.getSqrtPriceX64FromTick(i),l=a?1+s:1-s,m=ae.getAmountsFromLiquidity(H.priceToSqrtPriceX64(new F(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[p,d]=[Oe(m.amountA,(b=t.mintA.extensions)==null?void 0:b.feeConfig,e,!0),Oe(m.amountB,(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)],[y,f]=[Oe(m.amountA.muln(l),(h=t.mintA.extensions)==null?void 0:h.feeConfig,e,!0),Oe(m.amountB.muln(l),(A=t.mintB.extensions)==null?void 0:A.feeConfig,e,!0)];return{liquidity:o,amountA:p,amountB:d,amountSlippageA:y,amountSlippageB:f,expirationTime:rn(p.expirationTime,d.expirationTime)}}};function Ch({poolInfo:r,tickLower:e,tickUpper:t,amountA:n,amountB:i,slippage:o,add:s,epochInfo:a,amountHasFee:u}){var A,P,T,I;let[c,l,m,p]=e<t?[e,t,n,i]:[t,e,i,n],d=H.priceToSqrtPriceX64(new F(r.price),r.mintA.decimals,r.mintB.decimals),y=H.getSqrtPriceX64FromTick(c),f=H.getSqrtPriceX64FromTick(l),[b,w]=[Oe(m,(A=r.mintA.extensions)==null?void 0:A.feeConfig,a,!u),Oe(p,(P=r.mintB.extensions)==null?void 0:P.feeConfig,a,!u)],h=ae.getLiquidityFromTokenAmounts(d,y,f,b.amount.sub((T=b.fee)!=null?T:me),w.amount.sub((I=w.fee)!=null?I:me));return ae.getAmountsOutFromLiquidity({poolInfo:r,tickLower:e,tickUpper:t,liquidity:h,slippage:o,add:s,epochInfo:a,amountAddFee:!u})}var Z=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),o=i.div(n);return i.mod(n).eq(me)||(o=o.add(Xe)),o}static mulDivFloor(e,t,n){if(n.eq(me))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(me))throw new Error("division by 0");return e.mul(t).add(n.sub(Xe)).div(n)}static x64ToDecimal(e,t){return new F(e.toString()).div(F.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new re(e.mul(F.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(ai).sub(t).mod(ai)}};function Me(r,e){return _o(r.mul(e),64,256)}function fd(r,e,t){let n=r.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function _o(r,e,t){let n=r.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var H=class{static sqrtPriceX64ToPrice(e,t,n){return Z.x64ToDecimal(e).pow(2).mul(F.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return Z.decimalToX64(e.mul(F.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(me))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(me))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(me))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(me))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(me))return e;let o=t.shln(dr);if(i){let s=o,a=o.add(n.mul(e));return a.gte(s)?Z.mulDivCeil(s,e,a):Z.mulDivRoundingUp(s,Xe,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return Z.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let o=n.shln(dr);if(i)return e.add(o.div(t));{let s=Z.mulDivRoundingUp(o,Xe,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<ze||e>Ze)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new re("18445821805675395072"):new re("18446744073709551616");return(t&2)!=0&&(n=Me(n,new re("18444899583751176192"))),(t&4)!=0&&(n=Me(n,new re("18443055278223355904"))),(t&8)!=0&&(n=Me(n,new re("18439367220385607680"))),(t&16)!=0&&(n=Me(n,new re("18431993317065453568"))),(t&32)!=0&&(n=Me(n,new re("18417254355718170624"))),(t&64)!=0&&(n=Me(n,new re("18387811781193609216"))),(t&128)!=0&&(n=Me(n,new re("18329067761203558400"))),(t&256)!=0&&(n=Me(n,new re("18212142134806163456"))),(t&512)!=0&&(n=Me(n,new re("17980523815641700352"))),(t&1024)!=0&&(n=Me(n,new re("17526086738831433728"))),(t&2048)!=0&&(n=Me(n,new re("16651378430235570176"))),(t&4096)!=0&&(n=Me(n,new re("15030750278694412288"))),(t&8192)!=0&&(n=Me(n,new re("12247334978884435968"))),(t&16384)!=0&&(n=Me(n,new re("8131365268886854656"))),(t&32768)!=0&&(n=Me(n,new re("3584323654725218816"))),(t&65536)!=0&&(n=Me(n,new re("696457651848324352"))),(t&131072)!=0&&(n=Me(n,new re("26294789957507116"))),(t&262144)!=0&&(n=Me(n,new re("37481735321082"))),e>0&&(n=Fa.div(n)),n}static getTickFromPrice(e,t,n){return H.getTickFromSqrtPriceX64(H.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Bt)||e.lt(xt))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new re(t-64),i=fd(n,32,128),o=new re("8000000000000000","hex"),s=0,a=new re(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new re(0))&&s<va;){u=u.mul(u);let y=u.shrn(127);u=u.shrn(63+y.toNumber()),a=a.add(o.mul(y)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=i.add(c).mul(new re(Wa)),p=_o(m.sub(new re(Da)),64,128).toNumber(),d=_o(m.add(new re(qa)),64,128).toNumber();return p==d?p:H.getSqrtPriceX64FromTick(d).lte(e)?d:p}},dn=class{static getTickWithPriceAndTickspacing(e,t,n,i){let s=H.getTickFromSqrtPriceX64(H.priceToSqrtPriceX64(e,n,i))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,i){let o=dn.getTickWithPriceAndTickspacing(e,t,n,i),s=H.getSqrtPriceX64FromTick(o);return H.sqrtPriceX64ToPrice(s,n,i)}},ae=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(me))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(dr),s=t.sub(e);return i?Z.mulDivRoundingUp(Z.mulDivCeil(o,s,t),Xe,e):Z.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(me))throw new Error("sqrtPriceX64A must greater than 0");return i?Z.mulDivCeil(n,t.sub(e),rt):Z.mulDivFloor(n,t.sub(e),rt)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return i?Z.mulDivRoundingUp(a,Xe,No):a.shrn(dr)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),Z.mulDivFloor(n,No,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return ae.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){let s=ae.getLiquidityFromTokenAmountA(e,n,i,!1),a=ae.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return ae.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:ae.getTokenAmountAFromLiquidity(t,n,i,o),amountB:new re(0)};if(e.lt(n)){let s=ae.getTokenAmountAFromLiquidity(e,n,i,o),a=ae.getTokenAmountBFromLiquidity(t,e,i,o);return{amountA:s,amountB:a}}else return{amountA:new re(0),amountB:ae.getTokenAmountBFromLiquidity(t,n,i,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,o,s,a){let{amountA:u,amountB:c}=ae.getAmountsFromLiquidity(e,t,n,i,s),l=o?1+a:1-a,m=new re(new F(u.toString()).mul(l).toFixed(0)),p=new re(new F(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:p}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var h,A,P,T;let c=H.priceToSqrtPriceX64(new F(e.price),e.mintA.decimals,e.mintB.decimals),l=H.getSqrtPriceX64FromTick(t),m=H.getSqrtPriceX64FromTick(n),p=s?1+o:1-o,d=ae.getAmountsFromLiquidity(c,l,m,i,s),[y,f]=[Oe(d.amountA,(h=e.mintA.extensions)==null?void 0:h.feeConfig,a,u),Oe(d.amountB,(A=e.mintB.extensions)==null?void 0:A.feeConfig,a,u)],[b,w]=[Oe(new re(new F(d.amountA.toString()).mul(p).toFixed(0)),(P=e.mintA.extensions)==null?void 0:P.feeConfig,a,u),Oe(new re(new F(d.amountB.toString()).mul(p).toFixed(0)),(T=e.mintB.extensions)==null?void 0:T.feeConfig,a,u)];return{liquidity:i,amountA:y,amountB:f,amountSlippageA:b,amountSlippageB:w,expirationTime:rn(y.expirationTime,f.expirationTime)}}},mn=class{static swapCompute(e,t,n,i,o,s,a,u,c,l,m,p,d,y){if(p.eq(me))throw new Error("amountSpecified must not be 0");if(y||(y=s?xt.add(Xe):Bt.sub(Xe)),s){if(y.lt(xt))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(y.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(y.gt(Bt))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(y.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let f=p.gt(me),b={amountSpecifiedRemaining:p,amountCalculated:me,sqrtPriceX64:m,tick:c>d?Math.min(d+ue.tickCount(l)-1,c):d,accounts:[],liquidity:u,feeAmount:new re(0)},w=d,h=n[d],A=0,P=!s&&h.startTickIndex===b.tick;for(;!b.amountSpecifiedRemaining.eq(me)&&!b.sqrtPriceX64.eq(y);){if(A>10)throw Error("liquidity limit");let T={};T.sqrtPriceStartX64=b.sqrtPriceX64;let I=G.nextInitTick(h,b.tick,l,s,P),x=I||null,O=null;if(!(x!=null&&x.liquidityGross.gtn(0))){let L=Fe.nextInitializedTickArrayStartIndex({tickCurrent:b.tick,tickSpacing:l,tickArrayBitmap:i,exBitmapInfo:o},w,s);if(!L.isExist)throw Error("swapCompute LiquidityInsufficient");w=L.nextStartIndex;let{publicKey:E}=be(e,t,w);O=E,h=n[w],x=G.firstInitializedTick(h,s)}T.tickNext=x.tick,T.initialized=x.liquidityGross.gtn(0),d!==w&&O&&(b.accounts.push(O),d=w),T.tickNext<ze?T.tickNext=ze:T.tickNext>Ze&&(T.tickNext=Ze),T.sqrtPriceNextX64=H.getSqrtPriceX64FromTick(T.tickNext);let N;if(s&&T.sqrtPriceNextX64.lt(y)||!s&&T.sqrtPriceNextX64.gt(y)?N=y:N=T.sqrtPriceNextX64,[b.sqrtPriceX64,T.amountIn,T.amountOut,T.feeAmount]=mn.swapStepCompute(b.sqrtPriceX64,N,b.liquidity,b.amountSpecifiedRemaining,a),b.feeAmount=b.feeAmount.add(T.feeAmount),f?(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.sub(T.amountIn.add(T.feeAmount)),b.amountCalculated=b.amountCalculated.sub(T.amountOut)):(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.add(T.amountOut),b.amountCalculated=b.amountCalculated.add(T.amountIn.add(T.feeAmount))),b.sqrtPriceX64.eq(T.sqrtPriceNextX64)){if(T.initialized){let L=x.liquidityNet;s&&(L=L.mul(Vt)),b.liquidity=ae.addDelta(b.liquidity,L)}P=T.tickNext!=b.tick&&!s&&h.startTickIndex===T.tickNext,b.tick=s?T.tickNext-1:T.tickNext}else if(b.sqrtPriceX64!=T.sqrtPriceStartX64){let L=H.getTickFromSqrtPriceX64(b.sqrtPriceX64);P=L!=b.tick&&!s&&h.startTickIndex===L,b.tick=L}++A}try{let{nextStartIndex:T,isExist:I}=ue.nextInitializedTickArray(b.tick,l,s,i,o);I&&d!==T&&(b.accounts.push(be(e,t,T).publicKey),d=T)}catch{}return{amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts}}static swapStepCompute(e,t,n,i,o){let s={sqrtPriceX64Next:new re(0),amountIn:new re(0),amountOut:new re(0),feeAmount:new re(0)},a=e.gte(t),u=i.gte(me);if(u){let l=Z.mulDivFloor(i,ui.sub(new re(o.toString())),ui);s.amountIn=a?ae.getTokenAmountAFromLiquidity(t,e,n,!0):ae.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=H.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?ae.getTokenAmountBFromLiquidity(t,e,n,!1):ae.getTokenAmountAFromLiquidity(e,t,n,!1),i.mul(Vt).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=H.getNextSqrtPriceX64FromOutput(e,n,i.mul(Vt),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=ae.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=ae.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:ae.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:ae.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(i.mul(Vt))&&(s.amountOut=i.mul(Vt)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=i.sub(s.amountIn):s.feeAmount=Z.mulDivCeil(s.amountIn,new re(o),ui.sub(new re(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var Le=60,ln=512,G=class{static getTickArrayAddressByTick(e,t,n,i){let o=G.getTickArrayStartIndexByTick(n,i),{publicKey:s}=be(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=G.getTickArrayStartIndexByTick(e,t),i=Math.floor((e-n)/t);if(i<0||i>=Le)throw new Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,t){let n=ue.tickCount(t),i=e/n;return e<0&&e%n!=0?i=Math.ceil(i)-1:i=Math.floor(i),i}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*ue.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*Le,i=Math.floor(e/n)+512;return Math.abs(i)}static checkTickArrayIsInitialized(e,t,n){let i=n*Le,o=Math.floor(t/i)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*i}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*Le:e+t*Le}static mergeTickArrayBitmap(e){let t=new yd(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,i,o){let s=Math.floor(i/(n*Le));return[...G.searchLowBitFromStart(e,t,s-1,o,n),...G.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return G.searchHightBitFromStart(e,t,0,ln,n)}static getAllInitializedTickArrayInfo(e,t,n,i,o){let s=[],a=G.getAllInitializedTickArrayStartIndex(n,i,o);for(let u of a){let{publicKey:c}=be(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>G.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===i)break}let u=ue.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>G.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===i)break}let u=ue.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<ze||e>Ze}static nextInitTick(e,t,n,i,o){if(ue.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(i)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<Le;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=Le-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<Le;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let i=H.getSqrtPriceX64FromTick(t),o=H.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new F(1).div(o),tickSqrtPriceX64:i}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let i=n?t:new F(1).div(t),o=dn.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=H.getSqrtPriceX64FromTick(o),a=H.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new F(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let i=H.getSqrtPriceX64FromTick(t),o=H.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new F(1).div(o),tickSqrtPriceX64:i}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let i=n?t:new F(1).div(t),o=dn.getTickWithPriceAndTickspacing(i,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=H.getSqrtPriceX64FromTick(o),a=H.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new F(1).div(a)}}};var $h=R([we(8),V("bump"),Xt("index"),B(""),Ue("protocolFeeRate"),Ue("tradeFeeRate"),Xt("tickSpacing"),U(g(),8,"")]),bd=R([Ue("blockTimestamp"),z("sqrtPriceX64"),z("cumulativeTimePriceX64"),U(z(),1,"")]),Vo=R([we(8),je("initialized"),B("poolId"),U(bd,1e3,"observations"),U(z(),5,"")]),gd=R([V("rewardState"),g("openTime"),g("endTime"),g("lastUpdateTime"),z("emissionsPerSecondX64"),g("rewardTotalEmissioned"),g("rewardClaimed"),B("tokenMint"),B("tokenVault"),B("creator"),z("rewardGrowthGlobalX64")]),eP=R([we(8),V("bump"),B("ammConfig"),B("creator"),B("mintA"),B("mintB"),B("vaultA"),B("vaultB"),B("observationId"),V("mintDecimalsA"),V("mintDecimalsB"),Xt("tickSpacing"),z("liquidity"),z("sqrtPriceX64"),Ee("tickCurrent"),Xt("observationIndex"),Xt("observationUpdateDuration"),z("feeGrowthGlobalX64A"),z("feeGrowthGlobalX64B"),g("protocolFeesTokenA"),g("protocolFeesTokenB"),z("swapInAmountTokenA"),z("swapOutAmountTokenB"),z("swapInAmountTokenB"),z("swapOutAmountTokenA"),V("status"),U(V(),7,""),U(gd,3,"rewardInfos"),U(g(),16,"tickArrayBitmap"),g("totalFeesTokenA"),g("totalFeesClaimedTokenA"),g("totalFeesTokenB"),g("totalFeesClaimedTokenB"),g("fundFeesTokenA"),g("fundFeesTokenB"),g("startTime"),U(g(),15*4-3,"padding")]),wd=R([z("growthInsideLastX64"),g("rewardAmountOwed")]),Xa=R([we(8),V("bump"),B("nftMint"),B("poolId"),Ee("tickLower"),Ee("tickUpper"),z("liquidity"),z("feeGrowthInsideLastX64A"),z("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),U(wd,3,"rewardInfos"),U(g(),8,"")]),tP=R([we(8),V("bump"),B("poolId"),Ee("tickLowerIndex"),Ee("tickUpperIndex"),z("liquidity"),z("feeGrowthInsideLastX64A"),z("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),U(z(),3,"rewardGrowthInside"),U(g(),8,"")]),kd=R([Ee("tick"),js("liquidityNet"),z("liquidityGross"),z("feeGrowthOutsideX64A"),z("feeGrowthOutsideX64B"),U(z(),3,"rewardGrowthsOutsideX64"),U(Ue(),13,"")]),pr=R([we(8),B("poolId"),Ee("startTickIndex"),U(kd,Le,"ticks"),V("initializedTickCount"),U(V(),115,"")]),Ya=R([we(329),U(B(),100,"whitelistMints")]),za=R([we(8),B("poolId"),U(U(g(),8),Mo,"positiveTickArrayBitmap"),U(U(g(),8),Mo,"negativeTickArrayBitmap")]);var Ha=se("Raydium_Clmm"),gt={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Te=class{static createPoolInstruction(e,t,n,i,o,s,a,u,c,l,m,p,d,y){let f=R([z("sqrtPriceX64"),g("startTime")]),b=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:Rn.programId,isSigner:!1,isWritable:!1},{pubkey:it,isSigner:!1,isWritable:!1}],w=Buffer.alloc(f.span);f.encode({sqrtPriceX64:d,startTime:y},w);let h=Buffer.from([...gt.createPool,...w]);return new bt({keys:b,programId:e,data:h})}static async createPoolInstructions(e){let{connection:t,programId:n,owner:i,mintA:o,mintB:s,ammConfigId:a,initialPriceX64:u,startTime:c,forerunCreate:l}=e,m=Ge({fromPublicKey:i,programId:n}),[p,d]=[new v(o.address),new v(s.address)],y=[Rn.createAccountWithSeed({fromPubkey:i,basePubkey:i,seed:m.seed,newAccountPubkey:m.publicKey,lamports:l?0:await t.getMinimumBalanceForRentExemption(Vo.span),space:Vo.span,programId:n})],{publicKey:f}=Va(n,a,p,d),{publicKey:b}=Oo(n,f,p),{publicKey:w}=Oo(n,f,d);return y.push(this.createPoolInstruction(n,f,i,a,m.publicKey,p,b,new v(o.programId||ve),d,w,new v(s.programId||ve),Tt(n,f).publicKey,u,c)),{signers:[],instructions:y,instructionTypes:[_.CreateAccount,_.ClmmCreatePool],address:{poolId:f,observationId:m.publicKey,mintAVault:b,mintBVault:w},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,p,d,y,f,b,w,h,A,P,T,I,x,O,N,L){let E=R([Ee("tickLowerIndex"),Ee("tickUpperIndex"),Ee("tickArrayLowerStartIndex"),Ee("tickArrayUpperStartIndex"),z("liquidity"),g("amountMaxA"),g("amountMaxB"),je("withMetadata"),V("optionBaseFlag"),je("baseFlag")]),J=[...L?[{pubkey:L,isSigner:!1,isWritable:!0}]:[]],W=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:it,isSigner:!1,isWritable:!1},{pubkey:Rn.programId,isSigner:!1,isWritable:!1},{pubkey:ve,isSigner:!1,isWritable:!1},{pubkey:Qa,isSigner:!1,isWritable:!1},{pubkey:kn,isSigner:!1,isWritable:!1},{pubkey:Zt,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...J],te=Buffer.alloc(E.span);E.encode({tickLowerIndex:h,tickUpperIndex:A,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:T,liquidity:I,amountMaxA:x,amountMaxB:O,withMetadata:N==="create",baseFlag:!1,optionBaseFlag:0},te);let Q=Buffer.from([...gt.openPosition,...te]);return new bt({keys:W,programId:e,data:Q})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[p,d]=[new v(e.programId),new v(e.id)],y;if(l)y=new v((await l(1))[0]);else{let O=Eo.generate();m.push(O),y=O.publicKey}let f=G.getTickArrayStartIndexByTick(i,e.config.tickSpacing),b=G.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=be(p,d,f),{publicKey:h}=be(p,d,b),{publicKey:A}=Ae(n.wallet,y,ve),{publicKey:P}=si(y),{publicKey:T}=Pt(p,y),{publicKey:I}=cn(p,d,i,o),x=this.openPositionFromLiquidityInstruction(p,n.feePayer,d,n.wallet,y,A,P,I,w,h,T,n.tokenAccountA,n.tokenAccountB,new v(t.vault.A),new v(t.vault.B),new v(e.mintA.address),new v(e.mintB.address),i,o,f,b,s,a,u,c);return{signers:m,instructions:[x],instructionTypes:[_.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:y,tickArrayLower:w,tickArrayUpper:h,positionNftAccount:A,metadataAccount:P,personalPosition:T,protocolPosition:I}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[p,d]=[new v(e.programId),new v(e.id)],y;if(l)y=new v((await l(1))[0]);else{let O=Eo.generate();m.push(O),y=O.publicKey}let f=G.getTickArrayStartIndexByTick(i,e.config.tickSpacing),b=G.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=be(p,d,f),{publicKey:h}=be(p,d,b),{publicKey:A}=Ae(n.wallet,y,ve),{publicKey:P}=si(y),{publicKey:T}=Pt(p,y),{publicKey:I}=cn(p,d,i,o),x=this.openPositionFromBaseInstruction(p,n.feePayer,d,n.wallet,y,A,P,I,w,h,T,n.tokenAccountA,n.tokenAccountB,new v(t.vault.A),new v(t.vault.B),new v(e.mintA.address),new v(e.mintB.address),i,o,f,b,c,s,a,u,Fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,b])?Tt(p,d).publicKey:void 0);return{address:{nftMint:y,tickArrayLower:w,tickArrayUpper:h,positionNftAccount:A,metadataAccount:P,personalPosition:T,protocolPosition:I},instructions:[x],signers:m,instructionTypes:[_.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,i,o,s,a,u,c,l,m,p,d,y,f,b,w,h,A,P,T,I,x,O,N,L){let E=R([Ee("tickLowerIndex"),Ee("tickUpperIndex"),Ee("tickArrayLowerStartIndex"),Ee("tickArrayUpperStartIndex"),z("liquidity"),g("amountMaxA"),g("amountMaxB"),je("withMetadata"),V("optionBaseFlag"),je("baseFlag")]),J=[...L?[{pubkey:L,isSigner:!1,isWritable:!0}]:[]],W=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:it,isSigner:!1,isWritable:!1},{pubkey:Rn.programId,isSigner:!1,isWritable:!1},{pubkey:ve,isSigner:!1,isWritable:!1},{pubkey:Qa,isSigner:!1,isWritable:!1},{pubkey:kn,isSigner:!1,isWritable:!1},{pubkey:Zt,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...J],te=Buffer.alloc(E.span);E.encode({tickLowerIndex:h,tickUpperIndex:A,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:T,liquidity:new ja(0),amountMaxA:x==="MintA"?O:N,amountMaxB:x==="MintA"?N:O,withMetadata:I==="create",baseFlag:x==="MintA",optionBaseFlag:1},te);let Q=Buffer.from([...gt.openPosition,...te]);return new bt({keys:W,programId:e,data:Q})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,p=[];if(l)m=new v((await l(1))[0]);else{let O=Eo.generate();p.push(O),m=O.publicKey}let[d,y]=[new v(e.programId),new v(e.id)],f=G.getTickArrayStartIndexByTick(i,e.config.tickSpacing),b=G.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=be(d,y,f),{publicKey:h}=be(d,y,b),{publicKey:A}=Ae(n.wallet,m,ve),{publicKey:P}=si(m),{publicKey:T}=Pt(d,m),{publicKey:I}=cn(d,y,i,o),x=this.openPositionFromLiquidityInstruction(d,n.wallet,y,n.wallet,m,A,P,I,w,h,T,n.tokenAccountA,n.tokenAccountB,new v(t.vault.A),new v(t.vault.B),new v(t.mintA.address),new v(t.mintB.address),i,o,f,b,s,a,u,c,Fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,b])?Tt(d,y).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:w,tickArrayUpper:h,positionNftAccount:A,metadataAccount:P,personalPosition:T,protocolPosition:I},instructions:[x],signers:p,instructionTypes:[_.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,i,o){let s=R([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:Rn.programId,isSigner:!1,isWritable:!1},{pubkey:ve,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...gt.closePosition,...u]);return new bt({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:i}){let o=new v(e.programId),{publicKey:s}=Ae(n.wallet,i.nftMint,ve),{publicKey:a}=Pt(o,i.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,i.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[_.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,p,d,y,f,b,w,h){let A=R([z("liquidity"),g("amountMaxA"),g("amountMaxB"),V("optionBaseFlag"),je("baseFlag")]),P=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:ve,isSigner:!1,isWritable:!1},{pubkey:Zt,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...P],I=Buffer.alloc(A.span);A.encode({liquidity:f,amountMaxA:b,amountMaxB:w,optionBaseFlag:0,baseFlag:!1},I);let x=Buffer.from([...gt.increaseLiquidity,...I]);return new bt({keys:T,programId:e,data:x})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new v(e.programId),new v(e.id)],l=G.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=G.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=be(u,c,l),{publicKey:d}=be(u,c,m),{publicKey:y}=Ae(i.wallet,n.nftMint,ve),{publicKey:f}=Pt(u,n.nftMint),{publicKey:b}=cn(u,c,n.tickLower,n.tickUpper),w=this.increasePositionFromLiquidityInstruction(u,i.wallet,y,f,c,b,p,d,i.tokenAccountA,i.tokenAccountB,new v(t.vault.A),new v(t.vault.B),new v(e.mintA.address),new v(e.mintB.address),o,s,a,Fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Tt(u,c).publicKey:void 0);return{address:{tickArrayLower:p,tickArrayUpper:d,positionNftAccount:y,personalPosition:f,protocolPosition:b},signers:[],instructions:[w],instructionTypes:[_.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new v(e.programId),new v(e.id)],l=G.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=G.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=be(u,c,l),{publicKey:d}=be(u,c,m),{publicKey:y}=Ae(i.wallet,n.nftMint,ve),{publicKey:f}=Pt(u,n.nftMint),{publicKey:b}=cn(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:p,tickArrayUpper:d,positionNftAccount:y,personalPosition:f,protocolPosition:b},instructions:[this.increasePositionFromBaseInstruction(u,i.wallet,y,f,c,b,p,d,i.tokenAccountA,i.tokenAccountB,new v(t.vault.A),new v(t.vault.B),new v(e.mintA.address),new v(e.mintB.address),o,s,a,Fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Tt(u,c).publicKey:void 0)],signers:[],instructionTypes:[_.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,i,o,s,a,u,c,l,m,p,d,y,f,b,w,h){let A=R([z("liquidity"),g("amountMaxA"),g("amountMaxB"),V("optionBaseFlag"),je("baseFlag")]),P=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:ve,isSigner:!1,isWritable:!1},{pubkey:Zt,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...P],I=Buffer.alloc(A.span);A.encode({liquidity:new ja(0),amountMaxA:f==="MintA"?b:w,amountMaxB:f==="MintA"?w:b,baseFlag:f==="MintA",optionBaseFlag:1},I);let x=Buffer.from([...gt.increaseLiquidity,...I]);return new bt({keys:T,programId:e,data:x})}static decreaseLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,p,d,y,f,b,w,h,A){let P=R([z("liquidity"),g("amountMinA"),g("amountMinB")]),T=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[],...f.map(N=>[{pubkey:N.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:N.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:N.rewardMint,isSigner:!1,isWritable:!1}]).flat()],I=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ve,isSigner:!1,isWritable:!1},{pubkey:Zt,isSigner:!1,isWritable:!1},{pubkey:wn,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...T],x=Buffer.alloc(P.span);P.encode({liquidity:b,amountMinA:w,amountMinB:h},x);let O=Buffer.from([...gt.decreaseLiquidity,...x]);return new bt({keys:I,programId:e,data:O})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new v(e.programId),new v(e.id)],m=G.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),p=G.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=be(c,l,m),{publicKey:y}=be(c,l,p),{publicKey:f}=Ae(i.wallet,n.nftMint,u),{publicKey:b}=Pt(c,n.nftMint),{publicKey:w}=cn(c,l,n.tickLower,n.tickUpper),h=[];for(let P=0;P<e.rewardDefaultInfos.length;P++)h.push({poolRewardVault:new v(t.rewardInfos[P].vault),ownerRewardVault:i.rewardAccounts[P],rewardMint:new v(e.rewardDefaultInfos[P].mint.address)});let A=[];return A.push(this.decreaseLiquidityInstruction(c,i.wallet,f,b,l,w,d,y,i.tokenAccountA,i.tokenAccountB,new v(t.vault.A),new v(t.vault.B),new v(e.mintA.address),new v(e.mintB.address),h,o,s,a,Fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,p])?Tt(c,l).publicKey:void 0)),{address:{tickArrayLower:d,tickArrayUpper:y,positionNftAccount:f,personalPosition:b,protocolPosition:w},signers:[],instructions:A,instructionTypes:[_.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,i,o,s,a,u,c,l,m,p,d,y,f,b,w){let h=R([g("amount"),g("otherAmountThreshold"),z("sqrtPriceLimitX64"),je("isBaseInput")]),A=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...m.map(x=>({pubkey:x,isSigner:!1,isWritable:!0}))],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:ve,isSigner:!1,isWritable:!1},{pubkey:Zt,isSigner:!1,isWritable:!1},{pubkey:wn,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...A],T=Buffer.alloc(h.span);h.encode({amount:d,otherAmountThreshold:y,sqrtPriceLimitX64:f,isBaseInput:b},T);let I=Buffer.from([...gt.swap,...T]);return new bt({keys:P,programId:e,data:I})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,inputMint:i,amountIn:o,amountOutMin:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new v(e.programId),new v(e.id)],[m,p]=[new v(t.vault.A),new v(t.vault.B)],[d,y]=[new v(e.mintA.address),new v(e.mintB.address)],f=e.mintA.address===i.toString(),b=[this.swapInstruction(c,n.wallet,l,new v(e.config.id),f?n.tokenAccountA:n.tokenAccountB,f?n.tokenAccountB:n.tokenAccountA,f?m:p,f?p:m,f?d:y,f?y:d,u,m,o,s,a,!0,Tt(c,l).publicKey)];return{signers:[],instructions:b,instructionTypes:[_.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,i,o,s,a,u,c,l,m,p){let d=R([g("openTime"),g("endTime"),z("emissionsPerSecondX64")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Rn.programId,isSigner:!1,isWritable:!1},{pubkey:it,isSigner:!1,isWritable:!1}],f=Buffer.alloc(d.span);d.encode({openTime:q(l),endTime:q(m),emissionsPerSecondX64:p},f);let b=Buffer.from([...gt.initReward,...f]);return new bt({keys:y,programId:e,data:b})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new v(e.programId),new v(e.id)],a=Ea(o,s,i.mint).publicKey,u=mr(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new v(e.config.id),n.tokenAccount,i.programId,i.mint,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[_.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,i,o,s,a,u,c,l,m,p){let d=R([V("rewardIndex"),z("emissionsPerSecondX64"),g("openTime"),g("endTime")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:ve,isSigner:!1,isWritable:!1},{pubkey:Zt,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(d.span);d.encode({rewardIndex:c,emissionsPerSecondX64:p,openTime:q(l),endTime:q(m)},f);let b=Buffer.from([...gt.setRewardEmissions,...f]);return new bt({keys:y,programId:e,data:b})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new v(e.programId),new v(e.id)],a,u,c;for(let p=0;p<e.rewardDefaultInfos.length;p++)e.rewardDefaultInfos[p].mint.address===i.mint.toString()&&(a=p,u=new v(t.rewardInfos[p].vault),c=new v(t.rewardInfos[p].mint.address));(a===void 0||u===void 0)&&Ha.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=mr(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new v(e.config.id),n.tokenAccount,u,c,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[_.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,i,o,s,a){let u=R([V("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:ve,isSigner:!1,isWritable:!1},{pubkey:Zt,isSigner:!1,isWritable:!1},{pubkey:wn,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...gt.collectReward,...l]);return new bt({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:i}){let[o,s]=[new v(e.programId),new v(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===i.toString()&&(a=l,u=new v(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&Ha.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,i,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[_.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapBaseOutInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,outputMint:i,amountOut:o,amountInMax:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new v(e.programId),new v(e.id)],[m,p]=[new v(t.vault.A),new v(t.vault.B)],[d,y]=[new v(e.mintA.address),new v(e.mintB.address)],f=e.mintA.address===i.toString(),b=[this.swapInstruction(c,n.wallet,l,new v(e.config.id),f?n.tokenAccountB:n.tokenAccountA,f?n.tokenAccountA:n.tokenAccountB,f?p:m,f?m:p,f?d:y,f?y:d,u,m,o,s,a,!1)];return{signers:[],instructions:b,instructionTypes:[_.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}};import{PublicKey as Td}from"@solana/web3.js";import{PublicKey as hd}from"@solana/web3.js";import Za from"bn.js";var kP=new Za(25),AP=new Za(1e4),Ad={4:3,5:3};var Pd=se("Raydium_liquidity_serum");function Ja({programId:r,marketId:e}){let t=[e.toBuffer()],n=0,i;for(;n<100;){try{let o=t.concat(Buffer.from([n]),Buffer.alloc(7));i=hd.createProgramAddressSync(o,r)}catch(o){if(o instanceof TypeError)throw o;n++;continue}return{publicKey:i,nonce:n}}throw Pd.logWithError("unable to find a viable program address nonce","params",{programId:r,marketId:e}),new Error("unable to find a viable program address nonce")}import br from"bn.js";function vo({programId:r}){let{publicKey:e}=le([Buffer.from("amm_config_account_seed","utf-8")],r);return e}function pn({name:r,programId:e,marketId:t}){let{publicKey:n}=le([e.toBuffer(),t.toBuffer(),Buffer.from(r,"utf-8")],e);return n}function Id({programId:r,marketId:e}){let{publicKey:t}=le([r.toBuffer(),e.toBuffer(),Buffer.from("open_order_associated_seed","utf-8")],r);return t}function xd({programId:r}){return le([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],r)}function $a({version:r,marketVersion:e,marketId:t,baseMint:n,quoteMint:i,baseDecimals:o,quoteDecimals:s,programId:a,marketProgramId:u}){let c=pn({name:"amm_associated_seed",programId:a,marketId:t}),l=pn({name:"lp_mint_associated_seed",programId:a,marketId:t}),{publicKey:m,nonce:p}=xd({programId:a}),d=pn({name:"coin_vault_associated_seed",programId:a,marketId:t}),y=pn({name:"pc_vault_associated_seed",programId:a,marketId:t}),f=pn({name:"temp_lp_token_associated_seed",programId:a,marketId:t}),b=Id({programId:a,marketId:t}),w=pn({name:"target_associated_seed",programId:a,marketId:t}),h=pn({name:"withdraw_associated_seed",programId:a,marketId:t}),{publicKey:A}=Ja({programId:u,marketId:t});return{id:c,baseMint:n,quoteMint:i,lpMint:l,baseDecimals:o,quoteDecimals:s,lpDecimals:o,version:r,programId:a,authority:m,nonce:p,baseVault:d,quoteVault:y,lpVault:f,openOrders:b,targetOrders:w,withdrawQueue:h,marketVersion:e,marketProgramId:u,marketId:t,marketAuthority:A,lookupTableAccount:Td.default,configId:vo({programId:a})}}var Fo;async function NP({connection:r,poolKeysList:e,config:t}){Fo||(Fo=new ii({connection:r}),await Fo.initStableModelLayout());let n=e.map(s=>La({poolKeys:s}));return(await Ls(r,n.map(s=>s.instruction),"GetPoolData")).map(s=>{let a=Os(s,"GetPoolData"),u=new br(Ot(a,"status")),c=Number(Ot(a,"coin_decimals")),l=Number(Ot(a,"pc_decimals")),m=Number(Ot(a,"lp_decimals")),p=new br(Ot(a,"pool_coin_amount")),d=new br(Ot(a,"pool_pc_amount")),y=new br(Ot(a,"pool_lp_supply")),f="0";try{f=Ot(a,"pool_open_time")}catch{}return{status:u,baseDecimals:c,quoteDecimals:l,lpDecimals:m,baseReserve:p,quoteReserve:d,lpSupply:y,startTime:new br(f)}})}import Kt from"bn.js";var gr=class extends xe{constructor(e){super(e)}async load(){this.checkDisabled()}computePairAmount({poolInfo:e,amount:t,slippage:n,baseIn:i}){let o=new Kt(new F(t).mul(10**e[i?"mintA":"mintB"].decimals).toFixed(0)),s=Ta(e[i?"mintB":"mintA"]),[a,u]=[new Kt(new F(e.mintAmountA).mul(10**e.mintA.decimals).toString()),new Kt(new F(e.mintAmountB).mul(10**e.mintB.decimals).toString())];this.logDebug("baseReserve:",a.toString(),"quoteReserve:",u.toString()),this.logDebug("tokenIn:",i?e.mintA.symbol:e.mintB.symbol,"amountIn:",o.toString(),"anotherToken:",i?e.mintB.symbol:e.mintA.symbol,"slippage:",`${n.toSignificant()}%`);let c=i?"base":"quote";this.logDebug("input side:",c);let l=Se;o.isZero()||(l=c==="base"?Er(o.mul(u),a):Er(o.mul(a),u));let m=Er(o.mul(new Kt(e.lpAmount).mul(new Kt(10).pow(new Kt(e.lpMint.decimals)))),new Kt(c==="base"?e.mintAmountA:e.mintAmountB).mul(new Kt(10).pow(new Kt(e[c==="base"?"mintA":"mintB"].decimals)))),d=new qe(Vr).add(n).mul(l).quotient,y=new pe(s,l),f=new pe(s,d);return this.logDebug("anotherAmount:",y.toFixed(),"maxAnotherAmount:",f.toFixed()),{anotherAmount:y,maxAnotherAmount:f,liquidity:m}}async addLiquidity(e){let{poolInfo:t,amountInA:n,amountInB:i,fixedSide:o,config:s,txVersion:a}=e;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region");let u=this.scope.mintToTokenAmount({mint:qt(t.mintA.address),amount:n.toString()}),c=this.scope.mintToTokenAmount({mint:qt(t.mintB.address),amount:i.toString()});this.logDebug("amountInA:",u,"amountInB:",c),(u.isZero()||c.isZero())&&this.logAndCreateError("amounts must greater than zero","amountInA & amountInB",{amountInA:u.toFixed(),amountInB:c.toFixed()});let{account:l}=this.scope,{bypassAssociatedCheck:m,checkCreateATAOwner:p}=M({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},s),[d,y]=[u.token,c.token],f=await l.getCreatedTokenAccount({mint:d.mint,associatedOnly:!1}),b=await l.getCreatedTokenAccount({mint:y.mint,associatedOnly:!1});!f&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",l.tokenAccounts);let w=await l.getCreatedTokenAccount({mint:new Jt(t.lpMint.address)}),h=[d,y],A=[f,b],P=[u.raw,c.raw],T=u.token.mint.toBase58()===t.mintA.address?"base":"quote",I="base";["quote","base"].includes(T)||this.logAndCreateError("invalid fixedSide","fixedSide",o),T==="quote"?(h.reverse(),A.reverse(),P.reverse(),I=o==="a"?"quote":"base"):T==="base"&&(I=o==="a"?"base":"quote");let[x,O]=h,[N,L]=A,[E,J]=P,W=await this.scope.api.fetchPoolKeysById({id:t.id}),te=this.createTxBuilder(),Ir=await l.handleTokenAccount({side:"in",amount:E,mint:x.mint,tokenAccount:N,bypassAssociatedCheck:m,checkCreateATAOwner:p}),{tokenAccount:Q}=Ir,ne=_e(Ir,["tokenAccount"]);te.addInstruction(ne);let Mn=await l.handleTokenAccount({side:"in",amount:J,mint:O.mint,tokenAccount:L,bypassAssociatedCheck:m,checkCreateATAOwner:p}),{tokenAccount:ut}=Mn,pi=_e(Mn,["tokenAccount"]);te.addInstruction(pi);let _n=await l.handleTokenAccount({side:"out",amount:0,mint:new Jt(t.lpMint.address),tokenAccount:w,bypassAssociatedCheck:m,checkCreateATAOwner:p}),{tokenAccount:fi}=_n,$t=_e(_n,["tokenAccount"]);return te.addInstruction($t),te.addInstruction({instructions:[Ka({poolInfo:t,poolKeys:W,userKeys:{baseTokenAccount:Q,quoteTokenAccount:ut,lpTokenAccount:fi,owner:this.scope.ownerPubKey},baseAmountIn:E,quoteAmountIn:J,fixedSide:I})],instructionTypes:[t.pooltype.includes("StablePool")?_.AmmV5AddLiquidity:_.AmmV4AddLiquidity],lookupTableAddress:W.lookupTableAccount?[W.lookupTableAccount]:[]}),a===0&&await te.buildV0(),te.build()}async removeLiquidity(e){this.scope.availability.removeStandardPosition===!1&&this.logAndCreateError("remove liquidity feature disabled in your region");let{poolInfo:t,amountIn:n,config:i,txVersion:o}=e,s=await this.scope.api.fetchPoolKeysById({id:t.id}),[a,u,c]=[new Jt(t.mintA.address),new Jt(t.mintB.address),new Jt(t.lpMint.address)];this.logDebug("amountIn:",n),n.isZero()&&this.logAndCreateError("amount must greater than zero","amountIn",n.toString());let{account:l}=this.scope,m=await l.getCreatedTokenAccount({mint:c,associatedOnly:!1});m||this.logAndCreateError("cannot found lpTokenAccount","tokenAccounts",l.tokenAccounts);let p=await l.getCreatedTokenAccount({mint:a}),d=await l.getCreatedTokenAccount({mint:u}),y=this.createTxBuilder(),{bypassAssociatedCheck:f,checkCreateATAOwner:b}=M({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},i),T=await l.handleTokenAccount({side:"out",amount:0,mint:a,tokenAccount:p,bypassAssociatedCheck:f,checkCreateATAOwner:b}),{tokenAccount:w}=T,h=_e(T,["tokenAccount"]);y.addInstruction(h);let I=await l.handleTokenAccount({side:"out",amount:0,mint:u,tokenAccount:d,bypassAssociatedCheck:f,checkCreateATAOwner:b}),{tokenAccount:A}=I,P=_e(I,["tokenAccount"]);return y.addInstruction(P),y.addInstruction({instructions:[Co({poolInfo:t,poolKeys:s,userKeys:{lpTokenAccount:m,baseTokenAccount:w,quoteTokenAccount:A,owner:this.scope.ownerPubKey},amountIn:n})],lookupTableAddress:s.lookupTableAccount?[s.lookupTableAccount]:[],instructionTypes:[t.pooltype.includes("StablePool")?_.AmmV5RemoveLiquidity:_.AmmV4RemoveLiquidity]}),o===0?await y.buildV0():y.build()}async removeAllLpAndCreateClmmPosition({poolInfo:e,clmmPoolInfo:t,removeLpAmount:n,createPositionInfo:i,farmInfo:o,userFarmLpAmount:s,base:a,computeBudgetConfig:u,payer:c,tokenProgram:l=ci,checkCreateATAOwner:m=!0,getEphemeralSigners:p,txVersion:d}){if((this.scope.availability.removeStandardPosition===!1||this.scope.availability.createConcentratedPosition===!1)&&this.logAndCreateError("remove liquidity or create position feature disabled in your region"),!(e.mintA.address===t.mintA.address||e.mintA.address===t.mintB.address)||!(e.mintB.address===t.mintA.address||e.mintB.address===t.mintB.address))throw Error("mint check error");let y=this.createTxBuilder();y.addCustomComputeBudget(u);let f={};for(let te of this.scope.account.tokenAccountRawInfos)(f[te.accountInfo.mint.toString()]===void 0||Ae(this.scope.ownerPubKey,te.accountInfo.mint,ci).publicKey.equals(te.pubkey))&&(f[te.accountInfo.mint.toString()]=te.pubkey);let b=f[e.lpMint.address];if(b===void 0)throw Error("find lp account error in trade accounts");let w=n.add(s!=null?s:new Kt(0)),h=e.mintA.address===oe.WSOL.mint.toString(),A=e.mintB.address===oe.WSOL.mint.toString(),{account:P,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:ci,mint:new Jt(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:h?{payer:this.scope.ownerPubKey}:void 0,skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:!0,checkCreateATAOwner:m});if(y.addInstruction(T||{}),P===void 0)throw new Error("base token account not found");let{account:I,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:ci,mint:new Jt(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:A?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:!0,checkCreateATAOwner:m});if(y.addInstruction(x||{}),I===void 0)throw new Error("quote token account not found");if(f[e.mintA.address]=P,f[e.mintB.address]=I,o!==void 0&&!(s!=null&&s.isZero())){let te=[];for(let $t of o.rewardInfos){let Ir=$t.mint.address===oe.WSOL.mint.toString();if(f[$t.mint.address])te.push(f[$t.mint.address]);else{let{account:Mn,instructionParams:_n}=await this.scope.account.getOrCreateTokenAccount({mint:new Jt($t.mint.address),tokenProgram:l,owner:this.scope.ownerPubKey,skipCloseAccount:!Ir,createInfo:{payer:c||this.scope.ownerPubKey},associatedOnly:!0,checkCreateATAOwner:m});Mn||this.logAndCreateError("farm reward account not found:",$t.mint.address),_n&&y.addInstruction(_n),te.push(Mn)}}let Q=(await this.scope.api.fetchFarmKeysById({ids:o.id}))[0],ne={amount:s,owner:this.scope.ownerPubKey,farmInfo:o,farmKeys:Q,lpAccount:b,rewardAccounts:te},ut=yt[o.programId],pi=ut===6?or(ne):ut===5?sr(ne):ar(ne),fi={3:_.FarmV3Withdraw,5:_.FarmV5Withdraw,6:_.FarmV6Withdraw};y.addInstruction({instructions:[pi],instructionTypes:[fi[ut]]})}let O=await this.scope.api.fetchPoolKeysById({id:e.id}),N=Co({poolInfo:e,poolKeys:O,userKeys:{lpTokenAccount:b,baseTokenAccount:P,quoteTokenAccount:I,owner:this.scope.ownerPubKey},amountIn:w});y.addInstruction({instructions:[N],instructionTypes:[e.pooltype.includes("StablePool")?_.AmmV5RemoveLiquidity:_.AmmV4RemoveLiquidity],lookupTableAddress:O.lookupTableAccount?[O.lookupTableAccount]:[]});let[L,E]=e.mintA.address===t.mintA.address?[P,I]:[I,P],J=await this.scope.api.fetchPoolKeysById({id:t.id}),W=await Te.openPositionFromBaseInstructions(D(M({poolInfo:t,poolKeys:J,ownerInfo:{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:L,tokenAccountB:E},withMetadata:"create"},i),{base:a,getEphemeralSigners:p}));return y.addInstruction({instructions:[...W.instructions],signers:W.signers,instructionTypes:[...W.instructionTypes],lookupTableAddress:J.lookupTableAccount?[J.lookupTableAccount]:[]}),d===0?y.sizeCheckBuildV0():y.sizeCheckBuild()}async createPoolV4({programId:e,marketInfo:t,baseMintInfo:n,quoteMintInfo:i,baseAmount:o,quoteAmount:s,startTime:a,ownerInfo:u,associatedOnly:c=!1,checkCreateATAOwner:l=!1,tokenProgram:m,txVersion:p,feeDestinationId:d,computeBudgetConfig:y}){var E;let f=u.feePayer||((E=this.scope.owner)==null?void 0:E.publicKey),b=u.useSOLBalance&&n.mint.equals(eu),w=u.useSOLBalance&&i.mint.equals(eu),h=this.createTxBuilder(),{account:A,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({mint:n.mint,owner:this.scope.ownerPubKey,createInfo:b?{payer:f,amount:o}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:c,checkCreateATAOwner:l});h.addInstruction(P||{});let{account:T,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({mint:i.mint,owner:this.scope.ownerPubKey,createInfo:w?{payer:f,amount:s}:void 0,notUseTokenAccount:w,skipCloseAccount:!w,associatedOnly:w?!1:c,checkCreateATAOwner:l});if(h.addInstruction(I||{}),A===void 0||T===void 0)throw Error("you don't has some token account");let x=$a({version:4,marketVersion:3,marketId:t.marketId,baseMint:n.mint,quoteMint:i.mint,baseDecimals:n.decimals,quoteDecimals:i.decimals,programId:e,marketProgramId:t.programId}),O={programId:e,ammId:x.id,ammAuthority:x.authority,ammOpenOrders:x.openOrders,lpMint:x.lpMint,coinMint:x.baseMint,pcMint:x.quoteMint,coinVault:x.baseVault,pcVault:x.quoteVault,withdrawQueue:x.withdrawQueue,ammTargetOrders:x.targetOrders,poolTempLp:x.lpVault,marketProgramId:x.marketProgramId,marketId:x.marketId,ammConfigId:x.configId,feeDestinationId:d},{instruction:N,instructionType:L}=Ca(D(M({},O),{userWallet:this.scope.ownerPubKey,userCoinVault:A,userPcVault:T,userLpVault:Ae(this.scope.ownerPubKey,x.lpMint,m).publicKey,nonce:x.nonce,openTime:a,coinAmount:o,pcAmount:s}));return h.addInstruction({instructions:[N],instructionTypes:[L]}),h.addCustomComputeBudget(y),h.versionBuild({txVersion:p,extInfo:{address:O}})}async getCreatePoolFee({programId:e}){let t=vo({programId:e}),n=await this.scope.connection.getAccountInfo(t,{dataSlice:{offset:536,length:8}});if(n===null)throw Error("get config account error");return Ia.decode(n.data).fee}};import{PublicKey as ce}from"@solana/web3.js";import ot from"bn.js";var wr=class extends xe{constructor(e){super(e)}async load(e){await this.scope.token.load(e)}async createPool(e){var h;let{programId:t,owner:n=((h=this.scope.owner)==null?void 0:h.publicKey)||ce.default,mint1:i,mint2:o,ammConfig:s,initialPrice:a,startTime:u,computeBudgetConfig:c,forerunCreate:l,txVersion:m}=e,p=this.createTxBuilder(),[d,y,f]=new ot(new ce(i.address).toBuffer()).gt(new ot(new ce(o.address).toBuffer()))?[o,i,new F(1).div(a)]:[i,o,a],b=H.priceToSqrtPriceX64(f,d.decimals,y.decimals),w=await Te.createPoolInstructions({connection:this.scope.connection,programId:t,owner:n,mintA:d,mintB:y,ammConfigId:s.id,initialPriceX64:b,startTime:u,forerunCreate:l});return p.addInstruction(w),p.addCustomComputeBudget(c),p.versionBuild({txVersion:m,extInfo:{address:D(M({},w.address),{programId:t.toString(),id:w.address.poolId.toString(),mintA:d,mintB:y,openTime:u.toNumber(),vault:{A:w.address.mintAVault.toString(),B:w.address.mintBVault.toString()},rewardInfos:[],config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}}),mockPoolInfo:M({type:"Concentrated",rewardDefaultPoolInfos:"Clmm",id:w.address.poolId.toString(),mintA:d,mintB:y,feeRate:s.tradeFeeRate,openTime:u.toNumber(),programId:t.toString(),price:f.toNumber(),config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}},Ua),forerunCreate:l}})}async openPositionFromBase({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,associatedOnly:c=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",getEphemeralSigners:p,computeBudgetConfig:d,txVersion:y}){this.scope.availability.addConcentratedPosition===!1&&this.logAndCreateError("add position feature disabled in your region"),this.scope.checkOwner();let f=this.createTxBuilder(),b=null,w=null,h=n.useSOLBalance&&e.mintA.address===ee.toString(),A=n.useSOLBalance&&e.mintB.address===ee.toString(),[P,T]=s==="MintA"?[a,u]:[u,a],{account:I,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new ce(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:h||P.isZero()?{payer:this.scope.ownerPubKey,amount:P}:void 0,skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:h?!1:c,checkCreateATAOwner:l});I&&(b=I),f.addInstruction(x||{});let{account:O,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new ce(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:A||T.isZero()?{payer:this.scope.ownerPubKey,amount:T}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:c,checkCreateATAOwner:l});O&&(w=O),f.addInstruction(N||{}),(!b||!w)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let L=t||await this.scope.api.fetchPoolKeysById({id:e.id}),E=await Te.openPositionFromBaseInstructions({poolInfo:e,poolKeys:L,ownerInfo:D(M({},n),{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:b,tokenAccountB:w}),tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:m,getEphemeralSigners:p});return f.addInstruction(E),f.addCustomComputeBudget(d),f.versionBuild({txVersion:y,extInfo:E.address})}async openPositionFromLiquidity({poolInfo:e,poolKeys:t,ownerInfo:n,amountMaxA:i,amountMaxB:o,tickLower:s,tickUpper:a,liquidity:u,associatedOnly:c=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",txVersion:p,getEphemeralSigners:d}){this.scope.availability.createConcentratedPosition===!1&&this.logAndCreateError("open position feature disabled in your region");let y=this.createTxBuilder(),f=null,b=null,w=n.useSOLBalance&&e.mintA.address===ee.toBase58(),h=n.useSOLBalance&&e.mintB.address===ee.toBase58(),{account:A,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new ce(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:w?{payer:this.scope.ownerPubKey,amount:i}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:c,checkCreateATAOwner:l});A&&(f=A),y.addInstruction(P||{});let{account:T,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new ce(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:h?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:h?!1:c,checkCreateATAOwner:l});T&&(b=T),y.addInstruction(I||{}),(f===void 0||b===void 0)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let x=t||await this.scope.api.fetchPoolKeysById({id:e.id}),O=await Te.openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:x,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:b},tickLower:s,tickUpper:a,liquidity:u,amountMaxA:i,amountMaxB:o,withMetadata:m,getEphemeralSigners:d});return y.addInstruction(O),y.versionBuild({txVersion:p,extInfo:{address:O.address}})}async increasePositionFromLiquidity(e){let{poolInfo:t,ownerPosition:n,amountMaxA:i,amountMaxB:o,liquidity:s,ownerInfo:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:l,txVersion:m}=e,p=this.createTxBuilder(),d,y,f=a.useSOLBalance&&t.mintA.address===ee.toString(),b=a.useSOLBalance&&t.mintB.address===ee.toString(),{account:w,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new ce(t.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:f?{payer:this.scope.ownerPubKey,amount:i}:void 0,skipCloseAccount:!f,associatedOnly:f?!1:u,checkCreateATAOwner:c});w&&(d=w),p.addInstruction(h||{});let{account:A,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({mint:new ce(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:b?{payer:this.scope.ownerPubKey,amount:o}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:u,checkCreateATAOwner:c});A&&(y=A),p.addInstruction(P||{}),!d&&!y&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let T=await this.scope.api.fetchPoolKeysById({id:t.id}),I=Te.increasePositionFromLiquidityInstructions({poolInfo:t,poolKeys:T,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:d,tokenAccountB:y},liquidity:s,amountMaxA:i,amountMaxB:o});return p.addInstruction(I),p.addCustomComputeBudget(l),p.versionBuild({txVersion:m,extInfo:{address:I.address}})}async increasePositionFromBase(e){let{poolInfo:t,ownerPosition:n,base:i,baseAmount:o,otherAmountMax:s,ownerInfo:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:l,txVersion:m}=e,p=this.createTxBuilder(),d,y,f=a.useSOLBalance&&t.mintA.address===ee.toString(),b=a.useSOLBalance&&t.mintB.address===ee.toString(),{account:w,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new ce(t.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:f?{payer:this.scope.ownerPubKey,amount:i==="MintA"?o:s}:void 0,skipCloseAccount:!f,associatedOnly:f?!1:u,checkCreateATAOwner:c});w&&(d=w),p.addInstruction(h||{});let{account:A,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({mint:new ce(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:b?{payer:this.scope.ownerPubKey,amount:i==="MintA"?s:o}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:u,checkCreateATAOwner:c});A&&(y=A),p.addInstruction(P||{}),!d&&!y&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let T=await this.scope.api.fetchPoolKeysById({id:t.id}),I=Te.increasePositionFromBaseInstructions({poolInfo:t,poolKeys:T,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:d,tokenAccountB:y},base:i,baseAmount:o,otherAmountMax:s});return p.addInstruction(I),p.addCustomComputeBudget(l),p.versionBuild({txVersion:m,extInfo:{address:I.address}})}async decreaseLiquidity(e){let{poolInfo:t,ownerPosition:n,ownerInfo:i,amountMinA:o,amountMinB:s,liquidity:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:l,txVersion:m}=e;this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let p=this.createTxBuilder(),d=i.useSOLBalance&&t.mintA.address===ee.toString(),y=i.useSOLBalance&&t.mintB.address===ee.toString(),f,b,{account:w,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new ce(t.mintA.address),notUseTokenAccount:d,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!d,associatedOnly:d?!1:u,checkCreateATAOwner:c});f=w,h&&p.addInstruction(h);let{account:A,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new ce(t.mintB.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!y,associatedOnly:y?!1:u,checkCreateATAOwner:c});b=A,P&&p.addInstruction(P);let T=[];for(let N of t.rewardDefaultInfos){let L=i.useSOLBalance&&N.mint.address===ee.toString(),E;if(N.mint.address===t.mintA.address)E=f;else if(N.mint.address===t.mintB.address)E=b;else{let{account:J,instructionParams:W}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new ce(N.mint.programId),mint:new ce(N.mint.address),notUseTokenAccount:L,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!L,associatedOnly:L?!1:u,checkCreateATAOwner:c});E=J,W&&p.addInstruction(W)}T.push(E)}!f&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccountRawInfos);let I=await this.scope.api.fetchPoolKeysById({id:t.id}),x=await Te.decreaseLiquidityInstructions({poolInfo:t,poolKeys:I,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:b,rewardAccounts:T},liquidity:a,amountMinA:o,amountMinB:s});p.addInstruction({instructions:x.instructions,instructionTypes:[_.ClmmDecreasePosition]});let O=M({},x.address);if(i.closePosition){let N=await Te.closePositionInstructions({poolInfo:t,poolKeys:I,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:n});p.addInstruction({endInstructions:N.instructions,endInstructionTypes:N.instructionTypes}),O=M(M({},O),N.address)}return p.addCustomComputeBudget(l),p.versionBuild({txVersion:m,extInfo:{address:O}})}async closePosition({poolInfo:e,ownerPosition:t,txVersion:n}){this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let i=this.createTxBuilder(),o=await this.scope.api.fetchPoolKeysById({id:e.id}),s=Te.closePositionInstructions({poolInfo:e,poolKeys:o,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:t});return i.addInstruction(s).versionBuild({txVersion:n,extInfo:{address:s.address}})}async initReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let u=this.createTxBuilder(),c=t.useSOLBalance&&n.mint.address.toString()===ee.toString(),l=n.perSecond.mul(n.endTime-n.openTime),{account:m,instructionParams:p}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new ce(n.mint.address),mint:new ce(n.mint.address),notUseTokenAccount:!!c,skipCloseAccount:!c,owner:this.scope.ownerPubKey,createInfo:c?{payer:t.feePayer||this.scope.ownerPubKey,amount:new ot(new F(l.toFixed(0)).gte(l)?l.toFixed(0):l.add(1).toFixed(0))}:void 0,associatedOnly:c?!1:i,checkCreateATAOwner:o});p&&u.addInstruction(p),m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let d=await this.scope.api.fetchPoolKeysById({id:e.id}),y=Te.initRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardInfo:{programId:new ce(n.mint.programId),mint:new ce(n.mint.address),openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:Z.decimalToX64(n.perSecond)}});return u.addInstruction(y),u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:y.address}})}async initRewards({poolInfo:e,ownerInfo:t,rewardInfos:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){for(let l of n)l.endTime<=l.openTime&&this.logAndCreateError("reward time error","rewardInfo",l);let u=this.createTxBuilder(),c={};for(let l of n){let m=t.useSOLBalance&&l.mint.address===ee.toString(),p=l.perSecond.mul(l.endTime-l.openTime),{account:d,instructionParams:y}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new ce(l.mint.programId),mint:new ce(l.mint.address),notUseTokenAccount:!!m,skipCloseAccount:!m,owner:this.scope.ownerPubKey,createInfo:m?{payer:t.feePayer||this.scope.ownerPubKey,amount:new ot(new F(p.toFixed(0)).gte(p)?p.toFixed(0):p.add(1).toFixed(0))}:void 0,associatedOnly:m?!1:i,checkCreateATAOwner:o});y&&u.addInstruction(y),d||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let f=await this.scope.api.fetchPoolKeysById({id:e.id}),b=Te.initRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:d},rewardInfo:{programId:new ce(l.mint.programId),mint:new ce(l.mint.address),openTime:l.openTime,endTime:l.endTime,emissionsPerSecondX64:Z.decimalToX64(l.perSecond)}});c=M(M({},c),b.address),u.addInstruction(b)}return u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:c}})}async setReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let u=this.createTxBuilder(),c=t.useSOLBalance&&n.mint.equals(ee),{account:l,instructionParams:m}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.programId,mint:n.mint,notUseTokenAccount:c,owner:this.scope.ownerPubKey,createInfo:c?{payer:t.feePayer||this.scope.ownerPubKey,amount:new ot(new F(n.perSecond.sub(n.endTime-n.openTime).toFixed(0)).gte(n.perSecond.sub(n.endTime-n.openTime))?n.perSecond.sub(n.endTime-n.openTime).toFixed(0):n.perSecond.sub(n.endTime-n.openTime).add(1).toFixed(0))}:void 0,associatedOnly:c?!1:i,checkCreateATAOwner:o});m&&u.addInstruction(m),l||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let p=await this.scope.api.fetchPoolKeysById({id:e.id}),d=Te.setRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:l},rewardInfo:{mint:n.mint,openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:Z.decimalToX64(n.perSecond)}});return u.addInstruction(d),u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:d.address}})}async setRewards({poolInfo:e,ownerInfo:t,rewardInfos:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){let u=this.createTxBuilder(),c={};for(let l of n){l.endTime<=l.openTime&&this.logAndCreateError("reward time error","rewardInfo",l);let m=t.useSOLBalance&&l.mint.address===ee.toString(),{account:p,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new ce(l.mint.programId),mint:new ce(l.mint.address),notUseTokenAccount:m,owner:this.scope.ownerPubKey,createInfo:m?{payer:t.feePayer||this.scope.ownerPubKey,amount:new ot(new F(l.perSecond.sub(l.endTime-l.openTime).toFixed(0)).gte(l.perSecond.sub(l.endTime-l.openTime))?l.perSecond.sub(l.endTime-l.openTime).toFixed(0):l.perSecond.sub(l.endTime-l.openTime).add(1).toFixed(0))}:void 0,associatedOnly:m?!1:i,checkCreateATAOwner:o});d&&u.addInstruction(d),p||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let y=await this.scope.api.fetchPoolKeysById({id:e.id}),f=Te.setRewardInstructions({poolInfo:e,poolKeys:y,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:p},rewardInfo:{mint:new ce(l.mint.address),openTime:l.openTime,endTime:l.endTime,emissionsPerSecondX64:Z.decimalToX64(l.perSecond)}});u.addInstruction(f),c=M(M({},c),f.address)}return u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:c}})}async collectReward({poolInfo:e,ownerInfo:t,rewardMint:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1}){let s=e.rewardDefaultInfos.find(d=>d.mint.address===n.toString());s||this.logAndCreateError("reward mint error","not found reward mint",n);let a=this.createTxBuilder(),u=t.useSOLBalance&&n.equals(ee),{account:c,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new ce(s.mint.programId),mint:n,notUseTokenAccount:u,owner:this.scope.ownerPubKey,skipCloseAccount:!u,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:u?!1:i,checkCreateATAOwner:o});l&&a.addInstruction(l),c||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let m=await this.scope.api.fetchPoolKeysById({id:e.id}),p=Te.collectRewardInstructions({poolInfo:e,poolKeys:m,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:c},rewardMint:n});return a.addInstruction(p),a.build({address:p.address})}async collectRewards({poolInfo:e,ownerInfo:t,rewardMints:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1}){let s=this.createTxBuilder(),a={};for(let u of n){let c=e.rewardDefaultInfos.find(f=>f.mint.address===u.toString());if(!c){this.logAndCreateError("reward mint error","not found reward mint",u);continue}let l=t.useSOLBalance&&u.equals(ee),{account:m,instructionParams:p}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new ce(c.mint.programId),mint:u,notUseTokenAccount:l,owner:this.scope.ownerPubKey,skipCloseAccount:!l,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:l?!1:i,checkCreateATAOwner:o});m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos),p&&s.addInstruction(p);let d=await this.scope.api.fetchPoolKeysById({id:e.id}),y=Te.collectRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardMint:u});s.addInstruction(y),a=M(M({},a),y.address)}return s.build({address:a})}async harvestAllRewards({allPoolInfo:e,allPositions:t,ownerInfo:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,programId:s,txVersion:a,computeBudgetConfig:u}){let c={};for(let m of this.scope.account.tokenAccountRawInfos)i?Ae(this.scope.ownerPubKey,m.accountInfo.mint,s).publicKey.equals(m.pubkey)&&(c[m.accountInfo.mint.toString()]=m.pubkey):c[m.accountInfo.mint.toString()]=m.pubkey;let l=this.createTxBuilder();l.addCustomComputeBudget(u);for(let m of Object.values(e)){if(t[m.id]===void 0||!t[m.id].find(A=>!A.liquidity.isZero()||A.rewardInfos.find(P=>!P.rewardAmountOwed.isZero())))continue;let p=m,d=n.useSOLBalance&&p.mintA.address===ee.toString(),y=n.useSOLBalance&&p.mintB.address===ee.toString(),f=c[p.mintA.address];if(!f){let{account:A,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:p.mintA.programId,mint:new ce(p.mintA.address),notUseTokenAccount:d,owner:this.scope.ownerPubKey,skipCloseAccount:!0,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:d?!1:i,checkCreateATAOwner:o});f=A,P&&l.addInstruction(P)}let b=c[p.mintB.address];if(!b){let{account:A,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:p.mintB.programId,mint:new ce(p.mintB.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,skipCloseAccount:!0,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:y?!1:i,checkCreateATAOwner:o});b=A,P&&l.addInstruction(P)}c[p.mintA.address]=f,c[p.mintB.address]=b;let w=[];for(let A of p.rewardDefaultInfos){let P=n.useSOLBalance&&A.mint.address===ee.toString(),T=c[A.mint.address];if(!T){let{account:I,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new ce(A.mint.programId),mint:new ce(A.mint.address),notUseTokenAccount:P,owner:this.scope.ownerPubKey,skipCloseAccount:!P,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:P?!1:i});T=I,x&&l.addInstruction(x)}c[A.mint.address]=T,w.push(T)}let h=await this.scope.api.fetchPoolKeysById({id:p.id});for(let A of t[m.id]){let P=Te.decreaseLiquidityInstructions({poolInfo:p,poolKeys:h,ownerPosition:A,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:b,rewardAccounts:w},liquidity:new ot(0),amountMinA:new ot(0),amountMinB:new ot(0)});l.addInstruction(P)}}return a===0?l.sizeCheckBuildV0():l.sizeCheckBuild()}async getWhiteListMint({programId:e}){let t=await this.scope.connection.getAccountInfo(mr(e).publicKey);return t?Ya.decode(t.data).whitelistMints.filter(i=>!i.equals(ce.default)):[]}async computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,token2022Infos:i,amountOut:o,slippage:s,priceLimit:a=new F(0)}){var I;let u=await this.scope.fetchEpochInfo(),c;a.equals(new F(0))?c=n.toString()===e.mintB.address?xt.add(Xe):Bt.sub(Xe):c=H.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let l=xn(o,(I=i[n.toString()])==null?void 0:I.feeConfig,u,!0),{expectedAmountIn:m,remainingAccounts:p,executionPrice:d,feeAmount:y}=Fe.getInputAmountAndRemainAccounts(e,t,n,l.amount.sub(l.fee||new ot(0)),c),f=H.sqrtPriceX64ToPrice(d,e.mintA.decimals,e.mintB.decimals),b=n.toString()===e.mintA.address?f:new F(1).div(f),w=m.mul(new ot(Math.floor((1+s)*1e10))).div(new ot(1e10)),h=e.mintA.address===n.toString()?e.price:new F(1).div(e.price),A=new F(b).sub(h).abs(),P=h,T=new qe(new F(A).mul(10**15).toFixed(0),new F(P).mul(10**15).toFixed(0));return{amountIn:m,maxAmountIn:w,currentPrice:new F(e.price),executionPrice:b,priceImpact:T,fee:y,remainingAccounts:p}}};import{PublicKey as Sd}from"@solana/web3.js";import{createTransferInstruction as Kd}from"@solana/spl-token";import{TOKEN_PROGRAM_ID as qo,TOKEN_2022_PROGRAM_ID as Wo}from"@solana/spl-token";import{PublicKey as st,TransactionInstruction as Uo,SystemProgram as nu}from"@solana/web3.js";import Do from"bn.js";function JT(r,e,t,n,i,o,s,a,u,c,l,m){let p=R([V("instruction"),g("amountIn"),g("amountOut")]),d=[{pubkey:nu.programId,isSigner:!1,isWritable:!1},{pubkey:qo,isSigner:!1,isWritable:!1},{pubkey:new st(t.programId),isSigner:!1,isWritable:!1},{pubkey:new st(t.id),isSigner:!1,isWritable:!0},{pubkey:new st(n.id),isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let f=fe(t);d.push({pubkey:f.config.id,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.A:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.B:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},...m.map(b=>({pubkey:b,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let f=fe(t);d.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:new st("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0})}else{let f=fe(t);d.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},...f.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:f.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:f.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0}])}let y=Buffer.alloc(p.span);return p.encode({instruction:4,amountIn:c,amountOut:l},y),new Uo({keys:d,programId:r,data:y})}function $T(r,e,t,n,i,o,s,a,u,c){let l=R([V("instruction")]),m=[{pubkey:nu.programId,isSigner:!1,isWritable:!1},{pubkey:qo,isSigner:!1,isWritable:!1},{pubkey:new st(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new st(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new st(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let d=fe(n);m.push({pubkey:d.config.id,isSigner:!1,isWritable:!1},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.mintA.address.equals(u)?d.vault.A:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.mintA.address.equals(u)?d.vault.B:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0},...c.map(y=>({pubkey:y,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let d=fe(n);m.push({pubkey:d.authority,isSigner:!1,isWritable:!1},{pubkey:d.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:new st("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:d.openOrders,isSigner:!1,isWritable:!0},{pubkey:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.marketId,isSigner:!1,isWritable:!0},{pubkey:d.marketBids,isSigner:!1,isWritable:!0},{pubkey:d.marketAsks,isSigner:!1,isWritable:!0},{pubkey:d.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0})}else{let d=fe(n);m.push({pubkey:d.authority,isSigner:!1,isWritable:!1},{pubkey:d.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:d.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:d.openOrders,isSigner:!1,isWritable:!0},{pubkey:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.marketId,isSigner:!1,isWritable:!0},{pubkey:d.marketBids,isSigner:!1,isWritable:!0},{pubkey:d.marketAsks,isSigner:!1,isWritable:!0},{pubkey:d.marketEventQueue,isSigner:!1,isWritable:!0},...d.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:d.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:d.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0}])}let p=Buffer.alloc(l.span);return l.encode({instruction:5},p),new Uo({keys:m,programId:r,data:p})}function tu(r,e,t,n,i,o){if(r.pooltype.includes("StablePool")){let s=fe(e);return[{pubkey:s.programId,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.authority,isSigner:!1,isWritable:!1},{pubkey:s.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:new st("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:s.openOrders,isSigner:!1,isWritable:!0},{pubkey:s.vault.A,isSigner:!1,isWritable:!0},{pubkey:s.vault.B,isSigner:!1,isWritable:!0},{pubkey:s.marketId,isSigner:!1,isWritable:!0},{pubkey:s.marketBids,isSigner:!1,isWritable:!0},{pubkey:s.marketAsks,isSigner:!1,isWritable:!0},{pubkey:s.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0}]}else if(r.type==="Concentrated"){let s=r,a=fe(e),u=s.mintA.address===t;return[{pubkey:new st(String(r.programId)),isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a.config.id,isSigner:!1,isWritable:!1},{pubkey:a.id,isSigner:!1,isWritable:!0},{pubkey:u?a.vault.A:a.vault.B,isSigner:!1,isWritable:!0},{pubkey:u?a.vault.B:a.vault.A,isSigner:!1,isWritable:!0},{pubkey:a.id,isSigner:!1,isWritable:!0},...a.mintA.programId.equals(Wo)||a.mintB.programId.equals(Wo)?[{pubkey:Wo,isSigner:!1,isWritable:!1},{pubkey:wn,isSigner:!1,isWritable:!1},{pubkey:u?a.mintA.address:a.mintB.address,isSigner:!1,isWritable:!1},{pubkey:u?a.mintB.address:a.mintA.address,isSigner:!1,isWritable:!1}]:[],...(o!=null?o:[]).map(c=>({pubkey:c,isSigner:!1,isWritable:!0})),{pubkey:Tt(new st(String(r.programId)),new st(r.id)).publicKey,isSigner:!1,isWritable:!0}]}else{let s=fe(e);return[{pubkey:s.programId,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.authority,isSigner:!1,isWritable:!1},{pubkey:s.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:s.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:s.openOrders,isSigner:!1,isWritable:!0},{pubkey:s.vault.A,isSigner:!1,isWritable:!0},{pubkey:s.vault.B,isSigner:!1,isWritable:!0},{pubkey:s.marketId,isSigner:!1,isWritable:!0},{pubkey:s.marketBids,isSigner:!1,isWritable:!0},{pubkey:s.marketAsks,isSigner:!1,isWritable:!0},{pubkey:s.marketEventQueue,isSigner:!1,isWritable:!0},...s.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:s.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:s.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0}]]}}function Bd(r,e,t,n,i,o,s,a,u,c,l,m,p,d){let y=R([V("instruction"),g("amountIn"),g("amountOut")]),f=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:qo,isSigner:!1,isWritable:!1}];f.push(...tu(a,c,o,t,n,d[0])),f.push(...tu(u,l,s,n,i,d[1]));let b=Buffer.alloc(y.span);return y.encode({instruction:8,amountIn:m,amountOut:p},b),new Uo({keys:f,programId:r,data:b})}async function ru({routeProgram:r,ownerInfo:e,inputMint:t,swapInfo:n}){var i,o,s,a,u,c;if(n.routeType==="amm")if(n.poolInfo[0].type==="Concentrated"){let l=fe(n.poolKey[0]),m=t.equals(l.mintA.address)?xt.add(Xe):Bt.sub(Xe);return await Te.makeSwapBaseInInstructions({poolInfo:l,poolKeys:l,ownerInfo:{wallet:e.wallet,tokenAccountA:l.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:l.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((o=(i=n.minAmountOut.fee)==null?void 0:i.raw)!=null?o:new Do(0)),sqrtPriceLimitX64:m,remainingAccounts:n.remainingAccounts[0]})}else{let l=n.poolKey[0];return{signers:[],instructions:[Ra({poolKeys:l,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((a=(s=n.minAmountOut.fee)==null?void 0:s.raw)!=null?a:new Do(0)),fixedSide:"in"})],lookupTableAddress:l.lookupTableAccount?[l.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?_.AmmV5SwapBaseIn:_.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let l=n.poolInfo[0],m=n.poolInfo[1],p=n.poolKey[0],d=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[Bd(r,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.minMiddleAmountFee.token.mint.toString(),l,m,p,d,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((c=(u=n.minAmountOut.fee)==null?void 0:u.raw)!=null?c:new Do(0)),n.remainingAccounts)],instructionTypes:[_.RouteSwap],lookupTableAddress:[p.lookupTableAccount,d.lookupTableAccount].filter(y=>y!==void 0),address:{}}}else throw Error("route type error")}var kr=class extends xe{constructor(e){super(e)}static getAddLiquidityDefaultPool({addLiquidityPools:e,poolInfosCache:t}){if(e.length===0)return;if(e.length===1||(e.sort((i,o)=>o.version-i.version),e[0].version!==e[1].version))return e[0];let n=e.filter(i=>i.version===e[0].version);return n.sort((i,o)=>this.comparePoolSize(i,o,t)),n[0]}static comparePoolSize(e,t,n){let i=n[e.id],o=n[t.id];return i===void 0?1:o===void 0?-1:e.baseMint===t.baseMint?i.baseReserve.sub(o.baseReserve).gte(Se)?-1:1:i.baseReserve.sub(o.quoteReserve).gte(Se)?-1:1}async getWSolAccounts(){this.scope.checkOwner(),await this.scope.account.fetchWalletTokenAccounts();let e=this.scope.account.tokenAccounts.filter(t=>t.mint.equals(ee));return e.sort((t,n)=>t.isAssociated?1:n.isAssociated||t.amount.lt(n.amount)?-1:1),e}async unWrapWSol(e){let{amount:t,tokenProgram:n}=e,i=await this.getWSolAccounts(),o=this.createTxBuilder();o.addCustomComputeBudget(e.computeBudgetConfig);let s=await ht({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:0});o.addInstruction(s);let a=q(t);for(let u=0;u<i.length;u++)a.gte(i[u].amount)?(o.addInstruction({instructions:[Mt({tokenAccount:i[u].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:n})]}),a.sub(i[u].amount)):(o.addInstruction({instructions:[Mt({tokenAccount:i[u].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:n})]}),Zn({destination:s.addresses.newAccount,source:i[u].publicKey,amount:a,owner:this.scope.ownerPubKey,tokenProgram:n}));return o.build()}async wrapWSol(e,t){let n=await this.getWSolAccounts(),i=this.createTxBuilder(),o=await ht({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:e,skipCloseAccount:!0});return i.addInstruction(o),n.length&&i.addInstruction({instructions:[Zn({destination:n[0].publicKey,source:o.addresses.newAccount,amount:e,owner:this.scope.ownerPubKey,tokenProgram:t})],endInstructions:[Mt({tokenAccount:o.addresses.newAccount,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:t})]}),i.build()}async swap({swapInfo:e,associatedOnly:t,checkCreateATAOwner:n,checkTransaction:i,routeProgram:o=new Sd("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS")}){let s=D(M({},e),{amountIn:this.scope.solToWsolTransferAmountFee(e.amountIn),amountOut:this.scope.solToWsolTransferAmountFee(e.amountOut),minAmountOut:this.scope.solToWsolTransferAmountFee(e.minAmountOut),middleMint:e.minMiddleAmountFee?qt(e.middleToken.mint):void 0}),a=s.amountIn,u=s.amountOut,c=a.amount.token.mint.equals(oe.WSOL.mint)||a.amount.token.mint.equals(de),l=u.amount.token.mint.equals(oe.WSOL.mint)||u.amount.token.mint.equals(de),m=a.amount.token.mint,p=s.middleMint,d=u.amount.token.mint,y=this.createTxBuilder(),{account:f,instructionParams:b}=await this.scope.account.getOrCreateTokenAccount({mint:m,notUseTokenAccount:c,createInfo:c?{payer:this.scope.ownerPubKey,amount:a.amount.raw}:void 0,owner:this.scope.ownerPubKey,skipCloseAccount:!c,associatedOnly:c?!1:t,checkCreateATAOwner:n});if(b&&y.addInstruction(b),f===void 0)throw Error("input account check error");let{account:w,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({mint:d,skipCloseAccount:!l,createInfo:{payer:this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,associatedOnly:t,checkCreateATAOwner:n});h&&y.addInstruction(h);let A;if(s.routeType==="route"){let Q=await this.scope.account.getOrCreateTokenAccount({mint:p,createInfo:{payer:this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,associatedOnly:!1,checkCreateATAOwner:n});A=Q.account,Q.instructionParams&&y.addInstruction(Q.instructionParams)}let P=await ru({routeProgram:o,inputMint:m,swapInfo:s,ownerInfo:{wallet:this.scope.ownerPubKey,sourceToken:f,routeToken:A,destinationToken:w}}),T=s.feeConfig!==void 0?[Kd(f,s.feeConfig.feeAccount,this.scope.ownerPubKey,s.feeConfig.feeAmount.toNumber())]:[],I=s.feeConfig!==void 0?[_.TransferAmount]:[],x=[],O=[],N=await y.getComputeBudgetConfig();if(N){let{instructions:Q,instructionTypes:ne}=An(N);x.push(...Q),O.push(...ne)}let L=[],E=[...x,...T,...y.AllTxData.instructions,...P.instructions,...y.AllTxData.endInstructions],J=[...O,...I,...y.AllTxData.instructionTypes,...P.instructionTypes,...y.AllTxData.endInstructionTypes],W=[...y.AllTxData.signers,...P.signers];if(i)if(Lt(E,[this.scope.ownerPubKey,...W.map(Q=>Q.publicKey)]))L.push(this.createTxBuilder().addInstruction({instructions:E,signers:W,instructionTypes:J}));else{if(y.AllTxData.instructions.length>0&&L.push(this.createTxBuilder().addInstruction({instructions:y.AllTxData.instructions,signers:y.AllTxData.signers,instructionTypes:y.AllTxData.instructionTypes})),Lt([...x,...T,...P.instructions],[this.scope.ownerPubKey]))L.push(this.createTxBuilder().addInstruction({instructions:[...x,...T,...P.instructions],signers:P.signers,instructionTypes:[...O,...I,...P.instructionTypes]}));else if(Lt([...x,...P.instructions],[this.scope.ownerPubKey]))L.push(this.createTxBuilder().addInstruction({instructions:[...x,...P.instructions],signers:P.signers,instructionTypes:P.instructionTypes}));else if(Lt(P.instructions,[this.scope.ownerPubKey]))L.push(this.createTxBuilder().addInstruction({instructions:[...P.instructions],signers:P.signers,instructionTypes:P.instructionTypes}));else for(let Q=0;Q<P.instructions.length;Q++)L.push(this.createTxBuilder().addInstruction({instructions:[...x,P.instructions[Q]],signers:P.signers,instructionTypes:[...O,P.instructionTypes[Q]]}));y.AllTxData.endInstructions.length>0&&L.push(this.createTxBuilder().addInstruction({instructions:y.AllTxData.endInstructions,instructionTypes:y.AllTxData.endInstructionTypes}))}else s.routeType==="amm"?L.push(this.createTxBuilder().addInstruction({instructions:E,signers:W,instructionTypes:J})):(y.AllTxData.instructions.length>0&&L.push(this.createTxBuilder().addInstruction({instructions:y.AllTxData.instructions,signers:y.AllTxData.signers,instructionTypes:y.AllTxData.instructionTypes})),L.push(this.createTxBuilder().addInstruction({instructions:P.instructions,signers:P.signers,instructionTypes:P.instructionTypes})),y.AllTxData.endInstructions.length>0&&L.push(this.createTxBuilder().addInstruction({instructions:y.AllTxData.endInstructions,instructionTypes:y.AllTxData.endInstructionTypes})));return L.shift().buildMultiTx({extraPreBuildData:L.map(Q=>Q.build())})}};import{TOKEN_PROGRAM_ID as Cd}from"@solana/spl-token";import{PublicKey as Rd,Transaction as Go,TransactionInstruction as Ld}from"@solana/web3.js";import iu from"bn.js";var Ye=class extends xe{static getPdaPoolId(e,t){return le([Ye.SEED_CONFIG.pool.id,t.toBuffer()],e)}static getPdaOwnerId(e,t,n,i){return le([Ye.SEED_CONFIG.owner.id,t.toBuffer(),n.toBuffer(),Buffer.from(new iu(i).toArray())],e)}static async getAllInfo({connection:e,programId:t,poolIds:n,wallet:i,chainTime:o}){if(n.length===0)return[];let s=n.map(l=>Ye.getPdaPoolId(t,l).publicKey),a=[];for(let l=0;l<Ye.VERSION_PROJECT.length;l++)a.push(...s.map(m=>Ye.getPdaOwnerId(t,m,i,l).publicKey));let u=await kt(e,[...s,...a]),c=[];for(let l=0;l<u.length;l++){let m=Math.floor(l/n.length),p=l%n.length,d=s[p],y=a[l],f=u[p],b=u[n.length+l];if(!(f&&b)||f.data.length!==Ye.POOL_LAYOUT.span||b.data.length!==Ye.OWNER_LAYOUT.span)continue;let w=Ye.POOL_LAYOUT.decode(f.data),h=Ye.OWNER_LAYOUT.decode(b.data),A=w.openTime.toNumber(),P=w.endTime.toNumber(),T=h.tokenInfo.map(O=>O.debtAmount.gt(new iu(0))).filter(O=>!O).length!==3,I=o>A&&o<P&&w.status===1,x=T&&I;c.push({programId:t,poolId:d,ammId:w.ammId,ownerAccountId:y,snapshotLpAmount:h.lpAmount,project:Ye.VERSION_PROJECT[m],openTime:A,endTime:P,canClaim:x,canClaimErrorType:T?I?void 0:"outOfOperationalTime":"alreadyClaimIt",tokenInfo:w.tokenInfo.map((O,N)=>({mintAddress:O.mintAddress,mintVault:O.mintVault,mintDecimals:O.mintDecimals,perLpLoss:O.perLpLoss,debtAmount:h.tokenInfo[N].debtAmount.add(h.tokenInfo[N].claimedAmount)}))})}return c}async makeClaimTransaction({poolInfo:e,ownerInfo:t}){t.wallet||this.scope.checkOwner();let n=this.createTxBuilder(),i=t.wallet||this.scope.ownerPubKey,o=[];for(let u of e.tokenInfo){let{account:c,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({mint:u.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:u.mintAddress.equals(oe.WSOL.mint),createInfo:{payer:i,amount:0},skipCloseAccount:!u.mintAddress.equals(oe.WSOL.mint),associatedOnly:u.mintAddress.equals(oe.WSOL.mint)?!1:t.associatedOnly});l&&n.addInstruction(l),o.push(c)}n.addInstruction({instructions:[Ye.makeClaimInstruction({programId:e.programId,poolInfo:e,ownerInfo:{wallet:i,ownerPda:e.ownerAccountId,claimAddress:o}})]});let{transaction:s,signers:a}=n.build();return[{transaction:s,signer:a}]}async makeClaimAllTransaction({poolInfos:e,ownerInfo:t}){let n=this.createTxBuilder(),i=t.wallet||this.scope.ownerPubKey,o={};for(let c of e){let l=[];for(let m of c.tokenInfo){let{account:p,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({mint:m.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:m.mintAddress.equals(oe.WSOL.mint),createInfo:{payer:i,amount:0},skipCloseAccount:!m.mintAddress.equals(oe.WSOL.mint),associatedOnly:m.mintAddress.equals(oe.WSOL.mint)?!1:t.associatedOnly});d&&n.addInstruction(d),p&&(o[m.mintAddress.toString()]=p,l.push(p))}n.addInstruction({instructions:[Ye.makeClaimInstruction({programId:c.programId,poolInfo:c,ownerInfo:{wallet:i,ownerPda:c.ownerAccountId,claimAddress:l}})]})}let{transaction:s,signers:a}=n.build(),u=n.allInstructions;return Lt(u,[i,...a.map(c=>c.publicKey)])?[{transaction:s,signer:a}]:[{transaction:new Go().add(...u.slice(0,n.AllTxData.instructions.length-1)),signer:a},{transaction:new Go().add(...u.slice(n.AllTxData.instructions.length-1)),signer:[]},{transaction:new Go().add(...n.AllTxData.endInstructions),signer:[]}]}static makeClaimInstruction({programId:e,poolInfo:t,ownerInfo:n}){let i=R([]),o=[{pubkey:n.wallet,isSigner:!0,isWritable:!0},{pubkey:t.poolId,isSigner:!1,isWritable:!0},{pubkey:n.ownerPda,isSigner:!1,isWritable:!0},...n.claimAddress.map(u=>({pubkey:u,isSigner:!1,isWritable:!0})),...t.tokenInfo.map(({mintVault:u})=>({pubkey:u,isSigner:!1,isWritable:!0})),{pubkey:Cd,isSigner:!1,isWritable:!1}],s=Buffer.alloc(i.span);i.encode({},s);let a=Buffer.from([10,66,208,184,161,6,191,98,...s]);return new Ld({keys:o,programId:e,data:a})}},at=Ye;at.CLAIMED_NUM=3,at.POOL_LAYOUT=R([we(8),V("bump"),V("status"),g("openTime"),g("endTime"),B("ammId"),U(R([V("mintDecimals"),B("mintAddress"),B("mintVault"),g("perLpLoss"),g("totalClaimedAmount")]),Ye.CLAIMED_NUM,"tokenInfo"),U(g(),10,"padding")]),at.OWNER_LAYOUT=R([we(8),V("bump"),V("version"),B("poolId"),B("owner"),g("lpAmount"),U(R([B("mintAddress"),g("debtAmount"),g("claimedAmount")]),Ye.CLAIMED_NUM,"tokenInfo"),U(g(),4,"padding")]),at.DEFAULT_POOL_ID=["58oQChx4yWmvKdwLLZzBi4ChoCc2fqCUWBkwMihLYQo2","6UmmUiYoBjSrhakAobJw8BvkmJtDVxaeBtbt7rxWo1mg","AVs9TA4nWDzfPJE9gGVNJMVhcQy3V9PGazuz33BfG2RA","DVa7Qmb5ct9RCpaU7UTpSaf3GVMYz17vNVU67XpdCRut","7XawhbbxtsRcQA8KTkHT9f9nc6d69UwqCDh6U5EEbEmX","6a1CsrpeZubDjEJE9s1CMVheB6HWM5d7m1cj2jkhyXhj","EoNrn8iUhwgJySD1pHu8Qxm5gSQqLK3za4m8xzD2RuEb","AceAyRTWt4PyB2pHqf2qhDgNZDtKVNaxgL8Ru3V4aN1P","6tmFJbMk5yVHFcFy7X2K8RwHjKLr6KVFLYXpgpBNeAxB"].map(e=>new Rd(e)),at.SEED_CONFIG={pool:{id:Buffer.from("pool_seed","utf8")},owner:{id:Buffer.from("user_claim_seed","utf8")}},at.VERSION_PROJECT=[void 0,"Francium","Tulip","Larix"];import{PublicKey as zo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as cu}from"@solana/spl-token";import Ar from"bn.js";import{TransactionInstruction as Nd,SYSVAR_RENT_PUBKEY as Md}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ou}from"@solana/spl-token";import{createInitializeAccountInstruction as su}from"@solana/spl-token";import{SystemProgram as fn,Transaction as au}from"@solana/web3.js";function Od(r="accountFlags"){let e=new Hr(r);return e.addBoolean("initialized"),e.addBoolean("market"),e.addBoolean("openOrders"),e.addBoolean("requestQueue"),e.addBoolean("eventQueue"),e.addBoolean("bids"),e.addBoolean("asks"),e}var Xo=R([we(5),Od("accountFlags"),B("ownAddress"),g("vaultSignerNonce"),B("baseMint"),B("quoteMint"),B("baseVault"),g("baseDepositsTotal"),g("baseFeesAccrued"),B("quoteVault"),g("quoteDepositsTotal"),g("quoteFeesAccrued"),g("quoteDustThreshold"),B("requestQueue"),B("eventQueue"),B("bids"),B("asks"),g("baseLotSize"),g("quoteLotSize"),g("feeRateBps"),g("referrerRebatesAccrued"),we(7)]);function _d({programId:r,marketInfo:e}){let t=R([V("version"),Ue("instruction"),g("baseLotSize"),g("quoteLotSize"),Xt("feeRateBps"),g("vaultSignerNonce"),g("quoteDustThreshold")]),n=[{pubkey:e.id,isSigner:!1,isWritable:!0},{pubkey:e.requestQueue,isSigner:!1,isWritable:!0},{pubkey:e.eventQueue,isSigner:!1,isWritable:!0},{pubkey:e.bids,isSigner:!1,isWritable:!0},{pubkey:e.asks,isSigner:!1,isWritable:!0},{pubkey:e.baseVault,isSigner:!1,isWritable:!0},{pubkey:e.quoteVault,isSigner:!1,isWritable:!0},{pubkey:e.baseMint,isSigner:!1,isWritable:!1},{pubkey:e.quoteMint,isSigner:!1,isWritable:!1},{pubkey:e.authority?e.quoteMint:Md,isSigner:!1,isWritable:!1}].concat(e.authority?{pubkey:e.authority,isSigner:!1,isWritable:!1}:[]).concat(e.authority&&e.pruneAuthority?{pubkey:e.pruneAuthority,isSigner:!1,isWritable:!1}:[]),i=Buffer.alloc(t.span);return t.encode({version:0,instruction:0,baseLotSize:e.baseLotSize,quoteLotSize:e.quoteLotSize,feeRateBps:e.feeRateBps,vaultSignerNonce:e.vaultSignerNonce,quoteDustThreshold:e.quoteDustThreshold},i),new Nd({keys:n,programId:r,data:i})}async function uu({connection:r,wallet:e,marketInfo:t}){let n=new au,i=await r.getMinimumBalanceForRentExemption(165);n.add(fn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.baseVault.seed,newAccountPubkey:t.baseVault.publicKey,lamports:i,space:165,programId:ou}),fn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.quoteVault.seed,newAccountPubkey:t.quoteVault.publicKey,lamports:i,space:165,programId:ou}),su(t.baseVault.publicKey,t.baseMint,t.vaultOwner),su(t.quoteVault.publicKey,t.quoteMint,t.vaultOwner));let o=new au;return o.add(fn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.id.seed,newAccountPubkey:t.id.publicKey,lamports:await r.getMinimumBalanceForRentExemption(Xo.span),space:Xo.span,programId:t.programId}),fn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.requestQueue.seed,newAccountPubkey:t.requestQueue.publicKey,lamports:await r.getMinimumBalanceForRentExemption(5120+12),space:5120+12,programId:t.programId}),fn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.eventQueue.seed,newAccountPubkey:t.eventQueue.publicKey,lamports:await r.getMinimumBalanceForRentExemption(262144+12),space:262144+12,programId:t.programId}),fn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.bids.seed,newAccountPubkey:t.bids.publicKey,lamports:await r.getMinimumBalanceForRentExemption(65536+12),space:65536+12,programId:t.programId}),fn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.asks.seed,newAccountPubkey:t.asks.publicKey,lamports:await r.getMinimumBalanceForRentExemption(65536+12),space:65536+12,programId:t.programId}),_d({programId:t.programId,marketInfo:{id:t.id.publicKey,requestQueue:t.requestQueue.publicKey,eventQueue:t.eventQueue.publicKey,bids:t.bids.publicKey,asks:t.asks.publicKey,baseVault:t.baseVault.publicKey,quoteVault:t.quoteVault.publicKey,baseMint:t.baseMint,quoteMint:t.quoteMint,baseLotSize:t.baseLotSize,quoteLotSize:t.quoteLotSize,feeRateBps:t.feeRateBps,vaultSignerNonce:t.vaultSignerNonce,quoteDustThreshold:t.quoteDustThreshold}})),[{transaction:n,signer:[],instructionTypes:[_.CreateAccount,_.CreateAccount,_.InitAccount,_.InitAccount]},{transaction:o,signer:[],instructionTypes:[_.CreateAccount,_.CreateAccount,_.CreateAccount,_.CreateAccount,_.CreateAccount,_.InitMarket]}]}var Ln=class extends xe{async create({baseInfo:e,quoteInfo:t,lotSize:n,tickSize:i,dexProgramId:o,txVersion:s,computeBudgetConfig:a}){let u=this.scope.ownerPubKey,c=Ge({fromPublicKey:u,programId:o}),l=Ge({fromPublicKey:u,programId:o}),m=Ge({fromPublicKey:u,programId:o}),p=Ge({fromPublicKey:u,programId:o}),d=Ge({fromPublicKey:u,programId:o}),y=Ge({fromPublicKey:u,programId:cu}),f=Ge({fromPublicKey:u,programId:cu}),b=0,w=new Ar(100);function h(){let L=new Ar(0);for(;;)try{return{vaultOwner:zo.createProgramAddressSync([c.publicKey.toBuffer(),L.toArrayLike(Buffer,"le",8)],o),vaultSignerNonce:L}}catch{if(L.iaddn(1),L.gt(new Ar(25555)))throw Error("find vault owner error")}}let{vaultOwner:A,vaultSignerNonce:P}=h(),T=new Ar(Math.round(10**e.decimals*n)),I=new Ar(Math.round(n*10**t.decimals*i));if(T.eq(Se))throw Error("lot size is too small");if(I.eq(Se))throw Error("tick size or lot size is too small");let x=await uu({connection:this.scope.connection,wallet:this.scope.ownerPubKey,marketInfo:{programId:o,id:c,baseMint:e.mint,quoteMint:t.mint,baseVault:y,quoteVault:f,vaultOwner:A,requestQueue:l,eventQueue:m,bids:p,asks:d,feeRateBps:b,quoteDustThreshold:w,vaultSignerNonce:P,baseLotSize:T,quoteLotSize:I}}),O=this.createTxBuilder();O.addCustomComputeBudget(a),O.addInstruction({instructions:x[0].transaction.instructions,signers:x[0].signer});let N=[];for await(let L of x.slice(1,x.length)){let E=this.createTxBuilder();E.addCustomComputeBudget(a),E.addInstruction({instructions:L.transaction.instructions,signers:L.signer,instructionTypes:L.instructionTypes});let J=await E.versionBuild({txVersion:s});N.push(J)}return O.versionMultiBuild({extraPreBuildData:N,extInfo:{address:{marketId:c.publicKey,requestQueue:l.publicKey,eventQueue:m.publicKey,bids:p.publicKey,asks:d.publicKey,baseVault:y.publicKey,quoteVault:f.publicKey,baseMint:new zo(e.mint),quoteMin:new zo(t.mint)}},txVersion:s})}};import{PublicKey as Pr}from"@solana/web3.js";import{PublicKey as Vd,TransactionInstruction as Qo,SYSVAR_CLOCK_PUBKEY as Ed}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as jo}from"@solana/spl-token";var Yo=R([V("instruction"),Us("amount")]),hr=R([V("instruction")]);function sx({programId:r,amount:e,instructionKeys:t}){let n=[{pubkey:new Vd("11111111111111111111111111111111"),isSigner:!1,isWritable:!1},{pubkey:jo,isSigner:!1,isWritable:!1},{pubkey:it,isSigner:!1,isWritable:!1},{pubkey:Bi,isSigner:!1,isWritable:!1},...Object.entries(t).map(([o,s])=>({pubkey:s,isSigner:o==="userOwner",isWritable:!["authority","userOwner","userIdoCheck","userStakeInfo"].includes(o)}))],i=Buffer.alloc(Yo.span);return Yo.encode({instruction:1,amount:Number(e)},i),new Qo({keys:n,programId:r,data:i})}function li({programId:r},e){let t=[{pubkey:jo,isSigner:!1,isWritable:!1},{pubkey:Bi,isSigner:!1,isWritable:!1},...Object.entries(e).map(([i,o])=>({pubkey:o,isSigner:i==="userOwner",isWritable:!["authority","userOwner"].includes(i)}))],n=Buffer.alloc(hr.span);return hr.encode({instruction:2},n),new Qo({keys:t,programId:r,data:n})}function Ho(r){let{poolConfig:e,userKeys:t,side:n}=r,i=n==="base"?t.baseTokenAccount:t.quoteTokenAccount,o=n==="base"?e.baseVault:e.quoteVault,s=Buffer.alloc(hr.span);hr.encode({instruction:2},s);let a=[{pubkey:jo,isWritable:!1,isSigner:!1},{pubkey:Ed,isWritable:!1,isSigner:!1},{pubkey:e.id,isWritable:!0,isSigner:!1},{pubkey:e.authority,isWritable:!1,isSigner:!1},{pubkey:o,isWritable:!0,isSigner:!1},{pubkey:i,isWritable:!0,isSigner:!1},{pubkey:t.ledgerAccount,isWritable:!0,isSigner:!1},{pubkey:t.owner,isWritable:!1,isSigner:!0}];return new Qo({programId:e.programId,keys:a,data:s})}import lu from"bn.js";var Fd={[Qn.IDO_PROGRAM_ID_V1.toString()]:1,[Qn.IDO_PROGRAM_ID_V2.toString()]:2,[Qn.IDO_PROGRAM_ID_V3.toString()]:3,[Qn.IDO_PROGRAM_ID_V4.toString()]:4},On=class extends xe{async claim({ownerInfo:e,idoKeys:t,associatedOnly:n=!0,checkCreateATAOwner:i=!1,txVersion:o}){let s=this.createTxBuilder(),a=Fd[t.programId];a||this.logAndCreateError("invalid version",a);let u=fe(t),[c,l]=[!new lu(e.coin).isZero(),!new lu(e.pc).isZero()],m=u.projectInfo.mint.address.equals(ee),{account:p,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:u.projectInfo.mint.programId,mint:u.projectInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!m,notUseTokenAccount:m,associatedOnly:m?!1:n,checkCreateATAOwner:i});!p&&c&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),c&&d&&s.addInstruction(d);let y=u.buyInfo.mint.address.equals(ee),{account:f,instructionParams:b}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:u.buyInfo.mint.programId,mint:u.buyInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!y,notUseTokenAccount:y,associatedOnly:y?!1:n,checkCreateATAOwner:i});if(!p&&l&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),l&&b&&s.addInstruction(b),(!p||!f)&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address,t.buyInfo.mint.address),a===3)return s.addInstruction({instructions:[...c?[li({programId:u.programId},{idoId:u.id,authority:u.authority,poolTokenAccount:u.projectInfo.vault,userTokenAccount:p,userIdoInfo:new Pr(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[],...l?[li({programId:new Pr(t.programId)},{idoId:u.id,authority:u.authority,poolTokenAccount:u.buyInfo.vault,userTokenAccount:f,userIdoInfo:new Pr(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[]]}).versionBuild({txVersion:o});if(a<3)return!c&&!l&&this.logAndCreateError("no claimable rewards"),s.addInstruction({instructions:[li({programId:u.programId},{idoId:u.id,authority:u.authority,poolQuoteTokenAccount:u.buyInfo.vault,poolBaseTokenAccount:u.projectInfo.vault,userQuoteTokenAccount:f,userBaseTokenAccount:p,userIdoInfo:new Pr(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]}).versionBuild({txVersion:o});let w={poolConfig:{id:u.id,programId:u.programId,authority:u.authority,baseVault:u.projectInfo.vault,quoteVault:u.buyInfo.vault,baseToken:t.projectInfo.mint,quoteToken:t.buyInfo.mint},userKeys:{baseTokenAccount:p,quoteTokenAccount:f,ledgerAccount:new Pr(e.userIdoInfo),owner:this.scope.ownerPubKey}};return s.addInstruction({instructions:[...c?[Ho(D(M({},w),{side:"base"}))]:[],...l?[Ho(D(M({},w),{side:"quote"}))]:[]]}).versionBuild({txVersion:o})}};import{MintLayout as vd,TOKEN_2022_PROGRAM_ID as Nn,TOKEN_PROGRAM_ID as Zo}from"@solana/spl-token";import mu from"bn.js";var Tr=class extends xe{constructor(t){super(t);this._tokenList=[];this._tokenMap=new Map;this._blackTokenMap=new Map;this._tokenPrice=new Map;this._tokenPriceOrg=new Map;this._tokenPriceFetched={prevCount:0,fetched:0};this._mintGroup={official:new Set,jup:new Set,extra:new Set};this._extraTokenList=[]}async load(t){this.checkDisabled();let{forceUpdate:n=!1,type:i="strict"}=t||{},{mintList:o,blacklist:s}=await this.scope.fetchV3TokenList(n),a=await this.scope.fetchJupTokenList(i,n);this._tokenList=[],this._tokenMap=new Map,this._blackTokenMap=new Map,this._mintGroup={official:new Set,jup:new Set,extra:new Set},this._tokenMap.set(Qe.address,Qe),this._mintGroup.official.add(Qe.address),s.forEach(u=>{this._blackTokenMap.set(u.address,D(M({},u),{priority:-1}))}),o.forEach(u=>{var c;this._blackTokenMap.has(u.address)||(this._tokenMap.set(u.address,D(M({},u),{type:"raydium",priority:2,programId:(c=u.programId)!=null?c:u.tags.includes("token-2022")?Nn.toBase58():Zo.toBase58()})),this._mintGroup.official.add(u.address))}),a.forEach(u=>{var c;this._blackTokenMap.has(u.address)||this._tokenMap.has(u.address)||(this._tokenMap.set(u.address,D(M({},u),{type:"jupiter",priority:1,programId:(c=u.programId)!=null?c:u.tags.includes("token-2022")?Nn.toBase58():Zo.toBase58()})),this._mintGroup.jup.add(u.address))}),this._extraTokenList.forEach(u=>{this._blackTokenMap.has(u.address)||this._tokenMap.has(u.address)||(this._tokenMap.set(u.address,D(M({},u),{type:"extra",priority:1,programId:u.programId||u.tags.includes("token-2022")?Nn.toBase58():Zo.toBase58()})),this._mintGroup.extra.add(u.address))}),this._tokenList=Array.from(this._tokenMap).map(u=>u[1])}get tokenList(){return this._tokenList}get tokenMap(){return this._tokenMap}get blackTokenMap(){return this._blackTokenMap}get mintGroup(){return this._mintGroup}async getChainTokenInfo(t){let n=gn({publicKey:t}),i=n.toBase58(),o=n.toString().substring(0,6);if(n.equals(de))return{token:new oe({decimals:Qe.decimals,name:Qe.name,symbol:Qe.symbol,skipMint:!0,mint:""}),tokenInfo:Qe};let a=await this.scope.api.getTokenInfo(n);if(a){this._mintGroup.extra.add(i);let m=D(M({},a),{priority:2});return this._tokenMap.set(i,m),{token:new oe({mint:n,decimals:a.decimals,symbol:a.symbol||o,name:a.name||o,isToken2022:a.programId===Nn.toBase58()}),tokenInfo:m}}let u=await this.scope.connection.getAccountInfo(n);u||this.logAndCreateError("On chain token not found, mint:",n.toBase58());let c=vd.decode(u.data),l={chainId:101,address:i,programId:u.owner.toBase58(),logoURI:"",symbol:o,name:o,decimals:c.decimals,tags:[],extensions:{},priority:0};return this._tokenMap.has(i)||(this._mintGroup.extra.add(i),this._tokenMap.set(i,l)),{token:new oe({mint:n,decimals:c.decimals,symbol:o,name:o,isToken2022:u.owner.equals(Nn)}),tokenInfo:l}}mintToToken(t){let n=gn({publicKey:t}),i=this._tokenMap.get(n.toBase58());i||this.logAndCreateError("token not found, mint:",n.toBase58(),", use getChainTokenInfo to get info instead");let{decimals:o,name:s,symbol:a}=i,u=n.equals(de);return new oe({decimals:o,name:s,symbol:a,skipMint:u,mint:u?"":t,isToken2022:i.programId===Nn.toBase58()})}mintToTokenAmount({mint:t,amount:n,decimalDone:i,token:o}){let s=o||this.mintToToken(t);if(i){let a=mt(n),u=Fr(new j(a.numerator,a.denominator));return new pe(s,u)}return new pe(s,this.decimalAmount({mint:t,amount:n,decimalDone:i}))}decimalAmount({mint:t,amount:n,token:i}){let o=mt(n),s=i||this.mintToToken(t);return Fr(new j(o.numerator,o.denominator).mul(new mu(10**s.decimals)))}uiAmount({mint:t,amount:n,token:i}){let o=mt(n),s=i||this.mintToToken(t);return s?new j(o.numerator,o.denominator).div(new mu(10**s.decimals)).toSignificant(s.decimals):""}};var mi=class{constructor(e){this.rawBalances=new Map;let{connection:t,cluster:n,owner:i,api:o,defaultChainTime:s,defaultChainTimeOffset:a,apiCacheTime:u}=e;this._connection=t,this.cluster=n,this._owner=i?new dt(i):void 0,this._signAllTransactions=e.signAllTransactions,this.api=o,this._apiCacheTime=u||5*60*1e3,this.logger=se("Raydium"),this.farm=new ur({scope:this,moduleName:"Raydium_Farm"}),this.account=new Jn({scope:this,moduleName:"Raydium_Account",tokenAccounts:e.tokenAccounts,tokenAccountRawInfos:e.tokenAccountRawInfos}),this.liquidity=new gr({scope:this,moduleName:"Raydium_LiquidityV2"}),this.token=new Tr({scope:this,moduleName:"Raydium_tokenV2"}),this.tradeV2=new kr({scope:this,moduleName:"Raydium_tradeV2"}),this.clmm=new wr({scope:this,moduleName:"Raydium_clmm"}),this.utils1216=new at({scope:this,moduleName:"Raydium_utils1216"}),this.marketV2=new Ln({scope:this,moduleName:"Raydium_marketV2"}),this.ido=new On({scope:this,moduleName:"Raydium_ido"}),this.availability={};let c=new Date().getTime();this.apiData={},a&&(this._chainTime={fetched:c,value:{chainTime:s||Date.now()-a,offset:a}})}static async load(e){let t=Wd({cluster:"mainnet",owner:null,apiRequestInterval:3e5,apiRequestTimeout:1e4},e),{cluster:n,apiRequestTimeout:i,logCount:o,logRequests:s,urlConfigs:a}=t,u=new Yr({cluster:n,timeout:i,urlConfigs:a,logCount:o,logRequests:s}),c=new mi(D(M({},t),{api:u}));return await c.fetchAvailabilityStatus(e.disableFeatureCheck),await c.token.load({type:e.jupTokenType,fetchTokenPrice:e.preloadTokenPrice}),c}get owner(){return this._owner}get ownerPubKey(){if(!this._owner)throw new Error(Qr);return this._owner.publicKey}setOwner(e){return this._owner=e?new dt(e):void 0,this}get connection(){if(!this._connection)throw new Error(vs);return this._connection}setConnection(e){return this._connection=e,this}get signAllTransactions(){return this._signAllTransactions}setSignAllTransactions(e){return this._signAllTransactions=e,this}checkOwner(){if(!this.owner)throw this.logger.error(Qr),new Error(Qr)}isCacheInvalidate(e){return new Date().getTime()-e>this._apiCacheTime}async fetchChainTime(){try{let e=await this.api.getChainTimeOffset();this._chainTime={fetched:Date.now(),value:{chainTime:Date.now()-e.offset*1e3,offset:e.offset*1e3}}}catch{this._chainTime=void 0}}async fetchV3TokenList(e){if(this.apiData.tokenList&&!this.isCacheInvalidate(this.apiData.tokenList.fetched)&&!e)return this.apiData.tokenList.data;let t=await this.api.getTokenList(),n={fetched:Date.now(),data:t};return this.apiData.tokenList=n,n.data}async fetchJupTokenList(e,t){var o;let n=(o=this.apiData.jupTokenList)==null?void 0:o[e];if(n&&!this.isCacheInvalidate(n.fetched)&&!t)return n.data;let i=await this.api.getJupTokenList(e);return this.apiData.jupTokenList=D(M({},this.apiData.jupTokenList),{[e]:{fetched:Date.now(),data:i}}),this.apiData.jupTokenList[e].data}get chainTimeData(){var e;return(e=this._chainTime)==null?void 0:e.value}async chainTimeOffset(){var e;return this._chainTime&&Date.now()-this._chainTime.fetched<=1e3*60*5?this._chainTime.value.offset:(await this.fetchChainTime(),((e=this._chainTime)==null?void 0:e.value.offset)||0)}async currentBlockChainTime(){var e;return this._chainTime&&Date.now()-this._chainTime.fetched<=1e3*60*5?this._chainTime.value.chainTime:(await this.fetchChainTime(),((e=this._chainTime)==null?void 0:e.value.chainTime)||Date.now())}async fetchEpochInfo(){return this._epochInfo&&Date.now()-this._epochInfo.fetched<=1e3*30?this._epochInfo.value:(this._epochInfo={fetched:Date.now(),value:await this.connection.getEpochInfo()},this._epochInfo.value)}async getChainTokenInfo(e){return this.token.getChainTokenInfo(e)}async fetchAvailabilityStatus(e){if(e)return{};try{let t=await this.api.fetchAvailabilityStatus(),n=t.all===!1;return this.availability={all:t.all,swap:n?!1:t.swap,createConcentratedPosition:n?!1:t.createConcentratedPosition,addConcentratedPosition:n?!1:t.addConcentratedPosition,addStandardPosition:n?!1:t.addStandardPosition,removeConcentratedPosition:n?!1:t.removeConcentratedPosition,removeStandardPosition:n?!1:t.removeStandardPosition,addFarm:n?!1:t.addFarm,removeFarm:n?!1:t.removeFarm},t}catch{return{}}}mintToToken(e){return this.token.mintToToken(e)}mintToTokenAmount(e){return this.token.mintToTokenAmount(e)}solToWsolTokenAmount(e){return e.token.mint.equals(de)?this.token.mintToTokenAmount({mint:ee,amount:e.toExact()}):e}solToWsolTransferAmountFee(e){return e.amount.token.mint.equals(de)?{amount:this.token.mintToTokenAmount({mint:ee,amount:e.amount.toExact()}),fee:e.fee?this.token.mintToTokenAmount({mint:ee,amount:e.fee.toExact()}):e.fee,expirationTime:e.expirationTime}:e}decimalAmount(e){return this.token.decimalAmount(e)}uiAmount(e){return this.token.uiAmount(e)}};var du={[Xr.toBase58()]:3},pu={3:Xr};var Dd=R([we(5),we(8),B("ownAddress"),g("vaultSignerNonce"),B("baseMint"),B("quoteMint"),B("baseVault"),g("baseDepositsTotal"),g("baseFeesAccrued"),B("quoteVault"),g("quoteDepositsTotal"),g("quoteFeesAccrued"),g("quoteDustThreshold"),B("requestQueue"),B("eventQueue"),B("bids"),B("asks"),g("baseLotSize"),g("quoteLotSize"),g("feeRateBps"),g("referrerRebatesAccrued"),we(7)]),fu={3:Dd};import{PublicKey as yu}from"@solana/web3.js";var di=se("Serum"),bu=class{static getProgramId(e){let t=pu[e];return t||di.logWithError("invalid version","version",e),t}static getVersion(e){let t=e.toBase58(),n=du[t];return n||di.logWithError("invalid program id","programId",t),n}static getStateLayout(e){let t=fu[e];return t||di.logWithError(!!t,"invalid version","version",e),t}static getLayouts(e){return{state:this.getStateLayout(e)}}static getAssociatedAuthority({programId:e,marketId:t}){let n=[t.toBuffer()],i=0,o;for(;i<100;){try{let s=n.concat(Buffer.from([i]),Buffer.alloc(7));o=yu.createProgramAddressSync(s,e)}catch(s){if(s instanceof TypeError)throw s;i++;continue}return{publicKey:o,nonce:i}}return di.logWithError("unable to find a viable program address nonce","params",{programId:e,marketId:t}),{publicKey:yu.default,nonce:i}}};var vB=r=>r;export{my as ACCOUNT_TYPE_SIZE,Vy as ALL_PROGRAM_ID,od as AMM_CONFIG_SEED,jc as AMM_STABLE,Qc as AMM_V4,ap as ANAMint,Gt as API_URLS,Uc as AccountType,$h as AmmConfigLayout,Yr as Api,va as BIT_PRECISION,In as BNDivCeil,on as BNLayout,bf as BN_100,gf as BN_1000,wf as BN_10000,yf as BN_FIVE,Vr as BN_ONE,en as BN_TEN,ff as BN_THREE,pf as BN_TWO,Se as BN_ZERO,vb as BitStructure,qs as Blob,Hc as CLMM_PROGRAM_ID,Bi as CLOCK_PROGRAM_ID,wr as Clmm,Te as ClmmInstrument,Wn as Currency,tn as CurrencyAmount,pt as DEV_API_URLS,Gm as DataElement,up as ETHMint,Mo as EXTENSION_TICKARRAY_BITMAP_SIZE,la as FARM_LOCK_MINT,ma as FARM_LOCK_VAULT,vi as FARM_PROGRAM_ID_V3,Wi as FARM_PROGRAM_ID_V5,Tn as FARM_PROGRAM_ID_V6,yt as FARM_PROGRAM_TO_VERSION,pa as FARM_VERSION_TO_LEDGER_LAYOUT,da as FARM_VERSION_TO_STATE_LAYOUT,ui as FEE_RATE_DENOMINATOR,pd as FETCH_TICKARRAY_COUNT,dd as Fee,j as Fraction,Qn as IDO_ALL_PROGRAM,Jc as IDO_PROGRAM_ID_V1,$c as IDO_PROGRAM_ID_V2,el as IDO_PROGRAM_ID_V3,tl as IDO_PROGRAM_ID_V4,Nr as INSTRUCTION_PROGRAM_ID,_ as InstructionType,Di as JupTokenType,AP as LIQUIDITY_FEES_DENOMINATOR,kP as LIQUIDITY_FEES_NUMERATOR,Ad as LIQUIDITY_VERSION_TO_SERUM_VERSION,dA as LIQUIDITY_VERSION_TO_STATE_LAYOUT,Wa as LOG_B_2_X32,Da as LOG_B_P_ERR_MARGIN_LOWER_X64,qa as LOG_B_P_ERR_MARGIN_UPPER_X64,Ur as LOOKUP_TABLE_CACHE,jn as Layout,ae as LiquidityMath,hu as LogLevel,bi as Logger,Xo as MARKET_STATE_LAYOUT_V2,Dd as MARKET_STATE_LAYOUT_V3,fu as MARKET_VERSION_TO_STATE_LAYOUT,Rs as MAX_BASE64_SIZE,Bt as MAX_SQRT_PRICE_X64,Ze as MAX_TICK,wn as MEMO_PROGRAM_ID,kn as METADATA_PROGRAM_ID,xt as MIN_SQRT_PRICE_X64,ze as MIN_TICK,Cn as MODEL_DATA_PUBKEY,bu as Market,Z as MathUtil,No as MaxU64,Fa as MaxUint128,Vt as NEGATIVE_ONE,sp as NRVMint,Xe as ONE,Yc as OPEN_BOOK_PROGRAM,ld as OPERATION_SEED,Vo as ObservationInfoLayout,bd as ObservationLayout,Ya as OperationLayout,Qi as OptionLayout,dt as Owner,$d as PAIMint,ud as POOL_REWARD_VAULT_SEED,sd as POOL_SEED,md as POOL_TICK_ARRAY_BITMAP_SEED,ad as POOL_VAULT_SEED,_a as POSITION_SEED,qe as Percent,il as PoolFetchType,eP as PoolInfoLayout,Fe as PoolUtils,Xa as PositionInfoLayout,wd as PositionRewardInfoLayout,yr as PositionUtils,De as Price,tP as ProtocolPositionLayout,ai as Q128,rt as Q64,Jd as RAYMint,it as RENT_PROGRAM_ID,mi as Raydium,gd as RewardInfo,Ri as Rounding,Zc as Router,du as SERUM_PROGRAMID_TO_VERSION,Xr as SERUM_PROGRAM_ID_V3,pu as SERUM_VERSION_TO_PROGRAMID,Fs as SESSION_KEY,de as SOLMint,Qe as SOL_INFO,Gk as SPL_MINT_LAYOUT,ep as SRMMint,qi as STORAGE_KEY,H as SqrtPriceMath,ii as StableLayout,ji as Structure,mn as SwapMath,ln as TICK_ARRAY_BITMAP_SIZE,cd as TICK_ARRAY_SEED,Le as TICK_ARRAY_SIZE,qA as TICK_SPACINGS,Re as TOKEN_WSOL,Et as TickArrayBitmap,za as TickArrayBitmapExtensionLayout,fr as TickArrayBitmapExtensionUtils,pr as TickArrayLayout,kd as TickLayout,dn as TickMath,ue as TickQuery,G as TickUtils,oe as Token,pe as TokenAmount,Gr as TxBuilder,Dn as TxVersion,dr as U64Resolution,GA as U64_IGNORE_RANGE,Xi as UInt,tp as USDCMint,op as USDHMint,np as USDTMint,zc as UTIL1216,Hi as Union,ua as Voter,Im as VoterDepositEntry,Tm as VoterLockup,aa as VoterRegistrar,Pm as VoterVotingMintConfig,ee as WSOLMint,Hr as WideBits,Nt as WrappedLayout,me as ZERO,ks as _100_PERCENT,k as accountMeta,$p as add,An as addComputeBudget,xo as addLiquidityLayout,Ig as array,io as associatedLedgerAccountLayout,zi as bits,we as blob,je as bool,wo as calFarmRewardAmount,qn as checkLegacyTxSize,Un as checkV0TxSize,Vi as chunkArray,hr as claimLayout,Mt as closeAccountInstruction,Ii as commonSystemAccountMeta,ba as createAssociatedLedgerAccountInstruction,se as createLogger,Ia as createPoolFeeLayout,Ca as createPoolV4InstructionV2,mA as createPoolV4Layout,ht as createWSolAccountInstructions,pg as cstr,Ep as currencyEquals,Rc as decimalToFraction,$l as decodeBool,jp as div,Er as divCeil,He as dwLayout,em as encodeBool,xb as endlessRetry,Kc as eq,ug as f32,cg as f32be,lg as f64,mg as f64be,uo as farmAddRewardLayout,Cw as farmLedgerLayoutV3_1,er as farmLedgerLayoutV3_2,Rw as farmLedgerLayoutV5_1,oa as farmLedgerLayoutV5_2,sa as farmLedgerLayoutV6_1,ya as farmRewardInfoToConfig,so as farmRewardLayout,ao as farmRewardRestartLayout,hm as farmRewardTimeInfoLayout,ra as farmStateV3Layout,ia as farmStateV5Layout,$n as farmStateV6Layout,tk as fetchMultipleFarmInfoAndUpdate,NP as fetchMultipleInfo,dy as fetchMultipleMintInfos,le as findProgramAddress,Po as fixedSwapInLayout,To as fixedSwapOutLayout,Lt as forecastTransactionSize,ed as formatLayout,Ge as generatePubKey,Ae as getATAAddress,fa as getAssociatedAuthority,vo as getAssociatedConfigId,tt as getAssociatedLedgerAccount,nr as getAssociatedLedgerPoolAccount,Id as getAssociatedOpenOrders,$a as getAssociatedPoolKeys,_s as getDate,ko as getDepositEntryIndex,wA as getDxByDyBaseIn,gA as getDyByDxBaseIn,ny as getEpochInfo,ni as getFarmLedgerLayout,xm as getFarmStateLayout,xd as getLiquidityAssociatedAuthority,pn as getLiquidityAssociatedId,Ch as getLiquidityFromAmounts,Jp as getMax,kt as getMultipleAccountsInfo,Pn as getMultipleAccountsInfoWithCustomFlags,Ei as getMultipleLookupTableInfo,vA as getPdaAmmConfigId,Tt as getPdaExBitmapAccount,si as getPdaMetadataKey,mr as getPdaOperationAccount,Pt as getPdaPersonalPositionAddress,Va as getPdaPoolId,Ea as getPdaPoolRewardVaulId,Oo as getPdaPoolVaultId,cn as getPdaProtocolPositionAddress,be as getPdaTickArrayAddress,hn as getRecentBlockHash,mo as getRegistrarAddress,ol as getSessionKey,kA as getStablePrice,Xc as getTime,Xf as getTimestamp,go as getTokenOwnerRecordAddress,xn as getTransferAmountFee,Oe as getTransferAmountFeeV2,yo as getVoterAddress,bo as getVoterWeightRecordAddress,fo as getVotingMintAuthority,po as getVotingTokenMint,Mm as governanceCreateTokenOwnerRecord,Wb as greedy,Sc as gt,Qp as gte,js as i128,MA as i16ToBytes,oi as i32ToBytes,Zr as i64,Qs as i8,Io as initPoolLayout,no as initTokenAccountInstruction,_d as initializeMarket,Cy as intersection,Es as isDateAfter,Vs as isDateBefore,Lc as isDecimal,Zp as isMeaningfulNumber,Ms as isNumber,co as isValidFarmVersion,lr as isZero,fe as jsonInfo2PoolKeys,nk as judgeFarmType,Ro as leadingZeros,Ma as leastSignificantBit,Dm as liquidityStateV4Layout,qm as liquidityStateV5Layout,zp as lt,Yp as lte,rp as mSOLMint,Ra as makeAMMSwapInstruction,Ka as makeAddLiquidityInstruction,ho as makeAddNewRewardInstruction,li as makeClaimInstruction,Ho as makeClaimInstructionV4,ga as makeCreateFarmInstruction,uu as makeCreateMarketInstruction,wa as makeCreatorWithdrawFarmRewardInstruction,ka as makeDepositInstructionV3,Aa as makeDepositInstructionV5,ha as makeDepositInstructionV6,kk as makeDepositTokenInstruction,hk as makeDepositWithdrawInstruction,OA as makeInitPoolInstructionV4,sx as makePurchaseInstruction,Ao as makeRestartRewardInstruction,La as makeSimulatePoolInfoInstruction,rd as makeSwapFixedInInstruction,id as makeSwapFixedOutInstruction,ru as makeSwapInstruction,Zn as makeTransferInstruction,ar as makeWithdrawInstructionV3,sr as makeWithdrawInstructionV5,or as makeWithdrawInstructionV6,Ak as makeWithdrawTokenInstruction,rn as minExpirationTime,UA as mockCreatePoolInfo,Ua as mockV3CreatePoolInfo,Xm as modelDataInfoLayout,Na as mostSignificantBit,Ni as mul,Mi as notInnerObject,tg as ns64,ag as ns64be,Us as nu64,jb as nu64be,Yi as offset,Ny as offsetDateTime,kg as option,q as parseBigNumberish,mt as parseNumberInfo,Os as parseSimulateLogToJson,Ot as parseSimulateValue,na as parseTokenAccountResp,Jk as parseTokenInfo,Ht as poolTypeV6,nn as printSimulate,B as publicKey,Yo as purchaseLayout,wm as realFarmStateV3Layout,km as realFarmStateV5Layout,Am as realFarmV6Layout,Ps as recursivelyDecimalToFraction,Co as removeLiquidityInstruction,Bo as removeLiquidityLayout,JT as route1Instruction,$T as route2Instruction,Bd as routeInstruction,Tg as rustEnum,Zb as s16,ng as s16be,Jb as s24,rg as s24be,Ee as s32,ig as s32be,$b as s40,og as s40be,eg as s48,sg as s48be,Hb as s8,U as seq,zd as setLoggerLevel,Cc as shakeFractionDecimal,Ls as simulateMultipleInstruction,LA as simulatePoolInfoInstruction,Fc as simulateTransaction,xs as sleep,qt as solToWSol,tA as solToWSolToken,zt as splAccountLayout,Is as splitNumber,ip as stSOLMint,Pg as str,R as struct,Hp as sub,hg as tagged,Li as tenExponential,Fr as toBN,vc as toBuffer,Ts as toFraction,Xp as toFractionWithDecimals,kf as toPercent,Ta as toToken,eA as toTokenAmount,$k as toTokenInfo,Af as toTokenPrice,hf as toTotalPrice,hs as toUsdCurrency,Lo as trailingZeros,xi as tryParsePublicKey,z as u128,Xt as u16,Oa as u16ToBytes,Gb as u16be,Db as u24,Xb as u24be,Ue as u32,_A as u32ToBytes,zb as u32be,qb as u40,Yb as u40be,Ub as u48,Qb as u48be,g as u64,V as u8,xg as union,vB as unionArr,dg as unionLayoutDiscriminator,Ly as uniq,Bm as updateFarmPoolInfo,zr as updateReqHistory,fg as utf8,gn as validateAndParsePublicKey,lo as validateFarmRewards,Ag as vec,tm as vecU8,Vm as voterStakeRegistryCreateDepositEntry,_m as voterStakeRegistryCreateVoter,Lm as voterStakeRegistryDeposit,Om as voterStakeRegistryUpdateVoterWeightRecord,Nm as voterStakeRegistryWithdraw,nA as wSolToSolToken,oo as withdrawRewardLayout,Ry as xor,Bg as zeros};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=index.mjs.map